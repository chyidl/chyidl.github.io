<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Docker Tips &amp; Tricks</title>
    <url>/2021/09/01/Docker-Intro/</url>
    <content><![CDATA[<h2 id="Docker-Info"><a href="#Docker-Info" class="headerlink" title="Docker  Info"></a>Docker  Info</h2><figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line">å®¹å™¨æŠ€æœ¯çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå°±æ˜¯é€šè¿‡çº¦æŸå’Œä¿®æ”¹è¿›ç¨‹çš„åŠ¨æ€è¡¨ç°ï¼Œä»è€Œä¸ºå…¶åˆ›é€ å‡ºä¸€ä¸ªâ€œè¾¹ç•Œâ€</span><br><span class="line"></span><br><span class="line">CgroupsæŠ€æœ¯æ˜¯ç”¨æ¥åˆ¶é€ çº¦æŸçš„ä¸»è¦æ‰‹æ®µ</span><br><span class="line"><span class="keyword">Namespace</span>æŠ€æœ¯åˆ™æ˜¯ç”¨æ¥ä¿®æ”¹è¿›ç¨‹è¯•å›¾çš„ä¸»è¦æ–¹æ³•</span><br></pre></td></tr></table></figure>
<span id="more"></span>

<h2 id="Docker-architecture"><a href="#Docker-architecture" class="headerlink" title="Docker architecture"></a>Docker architecture</h2><blockquote>
<p>Docker uses a client-server architecture.</p>
</blockquote>
<p><img src="/misc/images/architecture.svg" alt="docker architecture"></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Docker ä»“åº“æ“ä½œ</span></span><br><span class="line">  docker pull/push</span><br><span class="line"></span><br><span class="line"><span class="comment"># Docker é•œåƒç®¡ç†</span></span><br><span class="line">  docker images/rmi/build</span><br><span class="line"></span><br><span class="line"><span class="comment"># Docker ç”Ÿå‘½å‘¨æœŸç®¡ç†</span></span><br><span class="line">  docker run/<span class="built_in">start</span>/stop/<span class="built_in">rm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># to delete all containers including its volumes use,</span></span><br><span class="line"><span class="variable">$</span> docker <span class="built_in">rm</span> <span class="literal">-vf</span> <span class="variable">$</span>(docker <span class="built_in">ps</span> <span class="literal">-a</span> <span class="literal">-q</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># to delete all the images</span></span><br><span class="line"><span class="variable">$</span> docker rmi <span class="operator">-f</span> <span class="variable">$</span>(docker images <span class="literal">-a</span> <span class="literal">-q</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Docker-Tips"><a href="#Docker-Tips" class="headerlink" title="Docker Tips"></a>Docker Tips</h2><ul>
<li><p><strong>Docker Tip #1</strong>: Docker å®¹å™¨è¿›ç¨‹</p>
<blockquote>
<p>A Docker container is just a process/service that runs directly on your machine. It is slightly different than a regular process because the Docker daemon along with the linux kernel do a few things(<strong>Cgroups</strong>ã€<strong>Namespace</strong>) to ensure it runs in total isolation<br>Dockerå®¹å™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿›ç¨‹,å’Œè™šæ‹Ÿæœºå·®åˆ«å¾ˆå¤§</p>
</blockquote>
</li>
<li><p><strong>Docker Tip #2</strong>: COPY vs. ADD in a Dockerfile</p>
<blockquote>
<p>COPY å’Œ ADD åŠŸèƒ½å¾ˆç›¸ä¼¼ï¼Œéƒ½å¯ä»¥ä»æŒ‡å®šç›®å½•æ‹·è´æ•°æ®åˆ°Dockeré•œåƒä¸­.</p>
</blockquote>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line"># <span class="keyword">COPY</span> å’Œ <span class="keyword">ADD</span> åŒºåˆ«</span><br><span class="line"><span class="number">1</span>. <span class="keyword">COPY</span>: åªèƒ½ä»æœ¬æœºæ–‡ä»¶æˆ–ç›®å½•ä¸­æ‹·è´åˆ°é•œåƒä¸­</span><br><span class="line"><span class="number">2</span>. <span class="keyword">ADD</span>: ä¸ä»…å¯ä»¥ä»æœ¬æœºæ–‡ä»¶æˆ–ç›®å½•ä¸­æ‹·è´ï¼Œè¿˜å¯ä»¥ä½¿ç”¨URLå¼•å…¥å¤–éƒ¨çš„æ–‡ä»¶åœ°å€æ‹·è´åˆ°é•œåƒä¸­</span><br><span class="line">  $ <span class="keyword">ADD</span> rootfs.tar.gz /</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #3</strong>: è¿½åŠ  Docker Run æŒ‡ä»¤å‡å°‘é•œåƒå¤§å°</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Before Dockerfile -- æ–°å¢ä¸‰ä¸ªå±‚lager</span></span><br><span class="line">RUN wget -O myfile.tar.gz http:<span class="regexp">//</span>example.com/myfile.tar.gz</span><br><span class="line">RUN tar -xvf myfile.tar.gz -C <span class="regexp">/usr/</span>src/myapp</span><br><span class="line">RUN rm myfile.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># After Dockerfile -- æ–°å¢ä¸€ä¸ªå±‚layer</span></span><br><span class="line">RUN wget -O myfile.tar.gz http:<span class="regexp">//</span>example.com/myfile.tar.gz \</span><br><span class="line">  &amp;&amp; tar -xvf myfile.tar.gz -C <span class="regexp">/usr/</span>src/myapp \</span><br><span class="line">  &amp;&amp; rm myfile.tar.gz</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #4</strong>: Docker Baseé•œåƒOSå’ŒHost OSæ²¡æœ‰å…³ç³»</p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line">Docker <span class="built_in">Image</span> OS: å®šä¹‰åœ¨Dockerfileæ–‡ä»¶çš„Baseé•œåƒçš„ç³»ç»Ÿ</span><br><span class="line">Host OS: è¿è¡ŒDocker <span class="built_in">image</span>çš„ç¯å¢ƒ</span><br><span class="line">You can use whatever base <span class="built_in">image</span> you want <span class="keyword">for</span> your Docker images.</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #5</strong>: ä½¿ç”¨ç›¸åŒBaseé•œåƒçš„å¥½å¤„</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">You could use a different base OS <span class="keyword">for</span> <span class="keyword">each</span> Docker image, but <span class="keyword">then</span> you lose <span class="keyword">out</span> <span class="keyword">on</span> the ability <span class="keyword">to</span> <span class="keyword">cache</span> it across all of your images</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #6</strong>: RUN vs. CMD in a Dockerfile</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">RUN:</span> åœ¨é•œåƒå†…æ‰§è¡Œå‘½ä»¤ï¼Œè¿™äº›æŒ‡ä»¤ä»…ä»…åœ¨æ„å»ºbuildé•œåƒä¸­æ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”å°†æ„å»ºç»“æœå†™å…¥æ–°largerå±‚ä¸­.</span><br><span class="line"><span class="symbol">CMD:</span> åœ¨å¯åŠ¨å®¹å™¨æ—¶å®šä¹‰é»˜è®¤çš„è¿è¡Œçš„æŒ‡ä»¤, è¿™ç§åŠ¨ä½œå‘ç”Ÿè¿è¡Œæ—¶run-time, è¦†ç›–æ–¹å¼</span><br><span class="line"><span class="symbol">ENTRYPOINT:</span> æ‰§è¡Œå‘½ä»¤å‚æ•°è¿½åŠ æ–¹å¼</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #7</strong>: Base Docker Image Alpine</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">Why Alpine?</span><br><span class="line">&gt; Small. Simple. Secure. Alpine Linux is a security-<span class="keyword">oriented, </span>lightweight Linux <span class="keyword">distribution </span><span class="keyword">based </span>on musl libc <span class="keyword">and </span><span class="keyword">busybox.</span></span><br><span class="line"><span class="keyword"></span>&gt; Alpine is about <span class="number">30</span>x smaller than Debian.</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #8</strong>: Project Structure with Multiple Dockerfiles and Docker Compose</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">ubuntu in ~/chyi/micro-services at <span class="number">3</span>BPlus <span class="keyword">on</span> ğŸ³ v20.<span class="number">10.8</span></span><br><span class="line">âœ tree -L <span class="number">2</span></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ auth</span><br><span class="line">â”‚Â Â  â””â”€â”€ Dockerfile</span><br><span class="line">â”œâ”€â”€ billing</span><br><span class="line">â”‚Â Â  â””â”€â”€ Dockerfile</span><br><span class="line">â”œâ”€â”€ contact</span><br><span class="line">â”‚Â Â  â””â”€â”€ Dockerfile</span><br><span class="line">â”œâ”€â”€ docker-compose.yml</span><br><span class="line">â””â”€â”€ user</span><br><span class="line">    â””â”€â”€ Dockerfile</span><br><span class="line"></span><br><span class="line"><span class="number">4</span> directories, <span class="number">5</span> <span class="keyword">files</span></span><br><span class="line"></span><br><span class="line">The docker-compose.yaml</span><br><span class="line">ubuntu in ~/chyi/micro-services at <span class="number">3</span>BPlus <span class="keyword">on</span> ğŸ³ v20.<span class="number">10.8</span></span><br><span class="line">âœ <span class="keyword">cat</span> docker-compose.yml</span><br><span class="line"><span class="keyword">version</span>: <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line">service<span class="variable">s:</span></span><br><span class="line">    auth:</span><br><span class="line">        build: <span class="string">&#x27;./auth&#x27;</span></span><br><span class="line">    billin<span class="variable">g:</span></span><br><span class="line">        build: <span class="string">&#x27;./billing&#x27;</span></span><br><span class="line">    contac<span class="variable">t:</span></span><br><span class="line">        build: <span class="string">&#x27;./contact&#x27;</span></span><br><span class="line">    user:</span><br><span class="line">        build: <span class="string">&#x27;./user&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #9</strong>: ä½¿ç”¨Volumes</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># docker-compose.yaml</span></span><br><span class="line"><span class="attr">services</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">app</span>:<span class="string"></span></span><br><span class="line"><span class="comment">    # Mount the crrent directoy into `/app` inside the running container.</span></span><br><span class="line">    <span class="attr">volumes</span>:<span class="string"></span></span><br><span class="line">      <span class="meta">-</span> <span class="string">&#x27;.:/app&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #10</strong>: Published Ports</p>
<blockquote>
<p>Creates a firwaall rule which maps a container port to a port on the Docker host to the outside world.</p>
</blockquote>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">Flag value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-p 8080:80</td>
<td align="left">Map TCP port 80 in the container to port 8080 on the Docker host.</td>
</tr>
<tr>
<td align="left">-p 192.168.1.100:8080:80</td>
<td align="left">Map TCP port 80 in the container to port 8080 on the Docker host for connections to host IP 192.168.1.100.</td>
</tr>
<tr>
<td align="left">-p 8080:80/udp</td>
<td align="left">Map UDP port 80 in the container to port 8080 on the Docker host.</td>
</tr>
<tr>
<td align="left">-p 8080:80/tcp -p 8080:80/udp</td>
<td align="left">Map TCP port 80 in the container to TCP port 8080 on the Docker host, and map UDP port 80 in the container to UDP port 8080 on the Docker host.</td>
</tr>
</tbody></table>
<ul>
<li><p><strong>Docker Tip #11</strong>: dockerignore file</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">.dockerignore</span>: ignore certain files and folders from your Docker images</span><br><span class="line">  <span class="string">.git</span></span><br><span class="line">  <span class="string">.dockerignore</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #12</strong>: Manage Docker without sudo on Linux</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Add a docker group and then add your user to it:</span></span><br><span class="line"><span class="variable">$ </span>sudo groupadd docker</span><br><span class="line"><span class="variable">$ </span>docker usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #13</strong>: Measure Docker Containerâ€™s Resources</p>
<blockquote>
<p>How much resources containers are using</p>
</blockquote>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line">$ docker stats</span><br><span class="line">CONTAINER ID   NAME                                                                                         <span class="meta">CPU</span> %     MEM USAGE / LIMIT     MEM %     NET I/O     BLOCK I/O         PIDS</span><br><span class="line">298d90f942e1   k8s_POD_kafka-zookeeper-0_default_a243d677-<span class="number">101b</span>-493b-a076-d94f46785f22_0                     <span class="number">0.00</span>%     724KiB / <span class="number">3.</span>704GiB     <span class="number">0.02</span>%     <span class="number">0B</span> / <span class="number">0B</span>     <span class="number">0B</span> / <span class="number">0B</span>           <span class="number">1</span></span><br><span class="line">1d92a13e4a6f   k8s_POD_kafka-0_default_f7374645-<span class="number">9904</span>-436c-bc8d-43ed415833c1_0                               <span class="number">0.00</span>%     872KiB / <span class="number">3.</span>704GiB     <span class="number">0.02</span>%     <span class="number">0B</span> / <span class="number">0B</span>     <span class="number">0B</span> / <span class="number">0B</span>           <span class="number">1</span></span><br><span class="line">b638c1bbd855   k8s_POD_postgres-postgresql-0_infrastructure_d9067ee1-<span class="number">6874</span>-<span class="number">4018</span>-a008-09362ad9330d_16         <span class="number">0.00</span>%     868KiB / <span class="number">3.</span>704GiB     <span class="number">0.02</span>%     <span class="number">0B</span> / <span class="number">0B</span>     <span class="number">0B</span> / <span class="number">0B</span>           <span class="number">1</span></span><br><span class="line">0fdc76799b4e   k8s_kube-flannel_kube-flannel-<span class="built_in">ds</span>-nk6tj_kube-system_0a186e7a-c0d7-<span class="number">4282</span>-9f5d-65ee20d0e13a_12   <span class="number">0.07</span>%     <span class="number">15.</span>4MiB / 50MiB       <span class="number">30.80</span>%    <span class="number">0B</span> / <span class="number">0B</span>     <span class="number">33.</span>1MB / <span class="number">0B</span>       <span class="number">11</span></span><br><span class="line">4c3705247efa   k8s_kube-proxy_kube-proxy-xwfvl_kube-system_f46216cb-d018-4d82-b510-9be5e01cefca_12          <span class="number">0.00</span>%     <span class="number">23.</span>36MiB / <span class="number">3.</span>704GiB   <span class="number">0.62</span>%     <span class="number">0B</span> / <span class="number">0B</span>     <span class="number">43.</span>7MB / <span class="number">12.</span>3kB   <span class="number">8</span></span><br><span class="line">16d5db1e7447   k8s_POD_kube-proxy-xwfvl_kube-system_f46216cb-d018-4d82-b510-9be5e01cefca_13                 <span class="number">0.00</span>%     <span class="number">1.</span>996MiB / <span class="number">3.</span>704GiB   <span class="number">0.05</span>%     <span class="number">0B</span> / <span class="number">0B</span>     487kB / <span class="number">0B</span>        <span class="number">1</span></span><br><span class="line">496aacf5fddf   k8s_POD_kube-flannel-<span class="built_in">ds</span>-nk6tj_kube-system_0a186e7a-c0d7-<span class="number">4282</span>-9f5d-65ee20d0e13a_13            <span class="number">0.00</span>%     768KiB / <span class="number">3.</span>704GiB     <span class="number">0.02</span>%     <span class="number">0B</span> / <span class="number">0B</span>     <span class="number">0B</span> / <span class="number">0B</span>           <span class="number">1</span></span><br><span class="line">1e328afeb116   dapr_zipkin                                                                                  <span class="number">0.17</span>%     <span class="number">250.</span>2MiB / <span class="number">3.</span>704GiB   <span class="number">6.60</span>%     18MB / <span class="number">0B</span>   60MB / <span class="number">0B</span>         <span class="number">55</span></span><br><span class="line">27872f88cae3   dapr_placement                                                                               <span class="number">0.11</span>%     <span class="number">5.</span>992MiB / <span class="number">3.</span>704GiB   <span class="number">0.16</span>%     18MB / <span class="number">0B</span>   <span class="number">13.</span>6MB / <span class="number">0B</span>       <span class="number">10</span></span><br><span class="line">27c1f6daa81c   dapr_redis                                                                                   <span class="number">0.35</span>%     <span class="number">5.</span>633MiB / <span class="number">3.</span>704GiB   <span class="number">0.15</span>%     18MB / <span class="number">0B</span>   <span class="number">10.</span>7MB / <span class="number">0B</span>       <span class="number">5</span></span><br><span class="line"></span><br><span class="line">$ docker stats --format <span class="string">&quot;table &#123;&#123;.Container&#125;&#125;\t&#123;&#123;.CPUPerc&#125;&#125;\t&#123;&#123;.MemUsage&#125;&#125;&quot;</span></span><br><span class="line">CONTAINER      <span class="meta">CPU</span> %     MEM USAGE / LIMIT</span><br><span class="line">298d90f942e1   <span class="number">0.00</span>%     724KiB / <span class="number">3.</span>704GiB</span><br><span class="line">1d92a13e4a6f   <span class="number">0.00</span>%     872KiB / <span class="number">3.</span>704GiB</span><br><span class="line">b638c1bbd855   <span class="number">0.00</span>%     868KiB / <span class="number">3.</span>704GiB</span><br><span class="line">0fdc76799b4e   <span class="number">2.37</span>%     <span class="number">15.</span>42MiB / 50MiB</span><br><span class="line">4c3705247efa   <span class="number">0.00</span>%     <span class="number">23.</span>36MiB / <span class="number">3.</span>704GiB</span><br><span class="line">16d5db1e7447   <span class="number">0.00</span>%     <span class="number">1.</span>996MiB / <span class="number">3.</span>704GiB</span><br><span class="line">496aacf5fddf   <span class="number">0.00</span>%     768KiB / <span class="number">3.</span>704GiB</span><br><span class="line">1e328afeb116   <span class="number">0.21</span>%     <span class="number">250.</span>2MiB / <span class="number">3.</span>704GiB</span><br><span class="line">27872f88cae3   <span class="number">0.12</span>%     <span class="number">5.</span>992MiB / <span class="number">3.</span>704GiB</span><br><span class="line">27c1f6daa81c   <span class="number">0.34</span>%     <span class="number">5.</span>633MiB / <span class="number">3.</span>704GiB</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #14</strong>: Docker Compose vs Docker Stack</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Docker Compose: is an official tool that helps you manage your Docker containers by letting you define everything through a docker-compose.yml file.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># docker stack: is a command that&#x27;s embedded into the Docker CLI. Lets you manage a cluster of Docker containers through Docker Swarm.</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #15</strong>: Metadata Docker Images with Labels</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Dockerfile example of adding 2 labels with 1 LABEL instruction:</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> &lt;key&gt;=&lt;value&gt;</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> version=<span class="string">&quot;1.0&quot;</span> maintainer=<span class="string">&quot;chyi &lt;nick.chyi@gmail.com&gt;&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Docker build example to add dynamic labels to your Docker images:</span></span><br><span class="line">$ docker build . --<span class="keyword">label</span><span class="bash"> <span class="string">&quot;version=1.0&quot;</span> --label <span class="string">&quot;maintaner=chyi &lt;nick.chyi@gmail.com&gt;&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># docker inspect images</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #16</strong>: Named Volumes vs Path Based Volumes</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Named volumes</span></span><br><span class="line">  postgres:<span class="regexp">/var/</span>lib<span class="regexp">/postgresql/</span>data</span><br><span class="line"></span><br><span class="line">  docker-compose automatically create the postgres volume, <span class="keyword">if</span> not you could running __$ docker volume create postgres__.</span><br><span class="line">  On Linux, the volume will get saved to <span class="regexp">/var/</span>lib<span class="regexp">/docker/</span>volumes<span class="regexp">/postgres/</span>_data</span><br><span class="line"></span><br><span class="line"><span class="comment"># Path based volumes</span></span><br><span class="line">  .<span class="regexp">/postgres:/</span>var<span class="regexp">/lib/</span>postgresql/data</span><br><span class="line"></span><br><span class="line">  postgres/ directory would get created <span class="keyword">in</span> the current directory on the Docker host.</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #17</strong>: The Volume or Mount Flag</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Setting up a volume the old way with docker run:</span></span><br><span class="line">$ docker container run â€¦ -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>:/myapp</span><br><span class="line"></span><br><span class="line"><span class="comment"># Setting up the same volumes using the mount flag with docker run:</span></span><br><span class="line">$ docker container run â€¦ --mount <span class="built_in">type</span>=<span class="built_in">bind</span>,<span class="built_in">source</span>=<span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>,target=/myapp</span><br><span class="line"></span><br><span class="line"><span class="comment"># Docker compose</span></span><br><span class="line">volumes:</span><br><span class="line">  - <span class="built_in">type</span>: <span class="string">&quot;bind&quot;</span></span><br><span class="line">    <span class="built_in">source</span>: <span class="string">&quot;.&quot;</span></span><br><span class="line">    target: <span class="string">&quot;/myapp&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #18</strong>: Connect to a Service Running on Docker Host</p>
<blockquote>
<p>Implementation of connecting to Docker host over a custom network with a static IP address.</p>
</blockquote>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Create a custom bridge Docker network</span></span><br><span class="line">ubuntu <span class="keyword">in</span> ~ at <span class="number">3</span>BPlus</span><br><span class="line">âœ docker network create -d bridge --subnet <span class="number">192.168</span>.<span class="number">0.0</span>/<span class="number">24</span> --gateway <span class="number">192.168</span>.<span class="number">0.1</span> mynet</span><br><span class="line"><span class="number">0330</span>b879fcc8fb23eeb092cb66fd86f1796e7f0abe37df4978903cf8fd07217b</span><br><span class="line"></span><br><span class="line">ubuntu <span class="keyword">in</span> ~ at <span class="number">3</span>BPlus</span><br><span class="line">âœ ifconfig</span><br><span class="line">br-<span class="number">0330</span>b879fcc8: flags=<span class="number">4099</span>&lt;UP,BROADCAST,MULTICAST&gt;  mtu <span class="number">1500</span></span><br><span class="line">        inet <span class="number">192.168</span>.<span class="number">0.1</span>  netmask <span class="number">255.255</span>.<span class="number">255.0</span>  broadcast <span class="number">192.168</span>.<span class="number">0.255</span></span><br><span class="line">        ether <span class="number">02</span>:<span class="number">42</span>:<span class="number">16</span>:<span class="number">0</span>c:c0:<span class="number">51</span>  txqueuelen <span class="number">0</span>  (Ethernet)</span><br><span class="line">        RX packets <span class="number">0</span>  bytes <span class="number">0</span> (<span class="number">0.0</span> B)</span><br><span class="line">        RX errors <span class="number">0</span>  dropped <span class="number">0</span>  overruns <span class="number">0</span>  frame <span class="number">0</span></span><br><span class="line">        TX packets <span class="number">0</span>  bytes <span class="number">0</span> (<span class="number">0.0</span> B)</span><br><span class="line">        TX errors <span class="number">0</span>  dropped <span class="number">0</span> overruns <span class="number">0</span>  carrier <span class="number">0</span>  collisions <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Start the Alpine container and drop into a Shell prompt.</span></span><br><span class="line">ubuntu <span class="keyword">in</span> ~ at <span class="number">3</span>BPlus</span><br><span class="line">âœ docker container run --rm -it alpine sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install the ping utility.</span></span><br><span class="line">/ <span class="comment"># apk update &amp;&amp; apk add iputils</span></span><br><span class="line">fetch https:<span class="regexp">//</span>dl-cdn.alpinelinux.org<span class="regexp">/alpine/</span>v3.<span class="number">14</span><span class="regexp">/main/</span>aarch64/APKINDEX.tar.gz</span><br><span class="line">fetch https:<span class="regexp">//</span>dl-cdn.alpinelinux.org<span class="regexp">/alpine/</span>v3.<span class="number">14</span><span class="regexp">/community/</span>aarch64/APKINDEX.tar.gz</span><br><span class="line">v3.<span class="number">14.2</span>-<span class="number">5</span>-gd4163d4c6c [https:<span class="regexp">//</span>dl-cdn.alpinelinux.org<span class="regexp">/alpine/</span>v3.<span class="number">14</span>/main]</span><br><span class="line">v3.<span class="number">14.2</span>-<span class="number">4</span>-ga15b4dc067 [https:<span class="regexp">//</span>dl-cdn.alpinelinux.org<span class="regexp">/alpine/</span>v3.<span class="number">14</span>/community]</span><br><span class="line">OK: <span class="number">14810</span> distinct packages available</span><br><span class="line">(<span class="number">1</span>/<span class="number">2</span>) Installing libcap (<span class="number">2.50</span>-r0)</span><br><span class="line">(<span class="number">2</span>/<span class="number">2</span>) Installing iputils (<span class="number">20210202</span>-r0)</span><br><span class="line">Executing busybox-<span class="number">1.33</span>.<span class="number">1</span>-r3.trigger</span><br><span class="line">OK: <span class="number">6</span> MiB <span class="keyword">in</span> <span class="number">16</span> packages</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ping the custom IP address we set up.</span></span><br><span class="line">/ <span class="comment"># ping 192.168.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># You should see this output (hit CTRL+C to stop it)</span></span><br><span class="line">PING <span class="number">192.168</span>.<span class="number">0.1</span> (<span class="number">192.168</span>.<span class="number">0.1</span>) <span class="number">56</span>(<span class="number">84</span>) bytes of data.</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">192.168</span>.<span class="number">0.1</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">0.336</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">192.168</span>.<span class="number">0.1</span>: icmp_seq=<span class="number">2</span> ttl=<span class="number">64</span> time=<span class="number">0.293</span> ms</span><br><span class="line">^C</span><br><span class="line">--- <span class="number">192.168</span>.<span class="number">0.1</span> ping statistics ---</span><br><span class="line"><span class="number">2</span> packets transmitted, <span class="number">2</span> received, <span class="number">0</span>% packet loss, time <span class="number">1013</span>ms</span><br><span class="line">rtt min<span class="regexp">/avg/m</span>ax<span class="regexp">/mdev = 0.293/</span><span class="number">0.314</span><span class="regexp">/0.336/</span><span class="number">0.021</span> ms</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #19</strong>: Show Total Disk Space Used by Docker</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">ubuntu in ~ at 3BPlus</span><br><span class="line">âœ docker system df</span><br><span class="line">TYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLE</span><br><span class="line">Images         <span class="number"> 3 </span>       <span class="number"> 2 </span>        203.9MB   198.5MB (97%)</span><br><span class="line">Containers     <span class="number"> 3 </span>       <span class="number"> 1 </span>        2.524MB   0B (0%)</span><br><span class="line">Local Volumes  <span class="number"> 1 </span>       <span class="number"> 0 </span>        0B        0B</span><br><span class="line">Build Cache    <span class="number"> 0 </span>       <span class="number"> 0 </span>        0B        0B</span><br><span class="line"></span><br><span class="line"><span class="comment"># -v flag (verbose) - will show the unique image size for each image</span></span><br><span class="line">ubuntu in ~ at 3BPlus</span><br><span class="line">âœ docker system df -v</span><br><span class="line">Images space usage:</span><br><span class="line"></span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED       SIZE      SHARED SIZE   UNIQUE SIZE   CONTAINERS</span><br><span class="line">alpine                latest    bb3de5531c18  <span class="number"> 4 </span>days ago    5.337MB   0B            5.337MB       2</span><br><span class="line">hello-world           latest    bc11b176a293  <span class="number"> 7 </span>weeks ago   9.136kB   0B            9.136kB       1</span><br><span class="line">bahamat/unix-1st-ed   latest    37aa142d2113  <span class="number"> 5 </span>years ago   198.5MB   0B            198.5MB       0</span><br><span class="line"></span><br><span class="line">Containers space usage:</span><br><span class="line"></span><br><span class="line">CONTAINER ID   IMAGE         COMMAND            LOCAL VOLUMES   SIZE      CREATED       STATUS                   NAMES</span><br><span class="line">9023720cdee7   alpine        &quot;sh&quot;              <span class="number"> 0 </span>              2.52MB   <span class="number"> 5 </span>hours ago   Up<span class="number"> 5 </span>hours               upbeat_kepler</span><br><span class="line">9e272ab58362   alpine        &quot;sh -c &#x27;exit 1&#x27;&quot;  <span class="number"> 0 </span>              0B       <span class="number"> 6 </span>hours ago   Exited (1)<span class="number"> 6 </span>hours ago   naughty_blackburn</span><br><span class="line">d95cc7e19d43   hello-world   &quot;/hello&quot;          <span class="number"> 0 </span>              0B       <span class="number"> 7 </span>weeks ago   Exited (0)<span class="number"> 7 </span>weeks ago   nifty_hellman</span><br><span class="line"></span><br><span class="line">Local Volumes space usage:</span><br><span class="line"></span><br><span class="line">VOLUME NAME   LINKS     SIZE</span><br><span class="line">user_my-db   <span class="number"> 0 </span>        0B</span><br><span class="line"></span><br><span class="line">Build cache usage: 0B</span><br><span class="line"></span><br><span class="line">CACHE ID   CACHE TYPE   SIZE      CREATED   LAST USED   USAGE     SHARED</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #20</strong>: Docker Compose Stop vs Down</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="comment"># docker-compose stop</span></span><br><span class="line">&gt; stop container, <span class="keyword">but</span> <span class="keyword">it</span> won&#x27;t remove them</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker-compose down</span></span><br><span class="line">&gt; stop container, removes <span class="keyword">the</span> stopped containers <span class="keyword">as</span> well <span class="keyword">as</span> any networks <span class="keyword">that</span> were created.</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker-compose down -v</span></span><br><span class="line">&gt; add remove all volumes too.</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #21</strong>: Difference between Docker Create, Start and Run</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Create:</span></span><br><span class="line">  adds a writeable container <span class="keyword">on</span> top <span class="keyword">of</span> your image <span class="keyword">and</span> sets <span class="keyword">it</span> up <span class="keyword">for</span> <span class="built_in">running</span> whatever command you specified <span class="keyword">in</span> you CMD. The container ID <span class="keyword">is</span> reported <span class="keyword">back</span> <span class="keyword">but</span> <span class="keyword">it</span>&#x27;s <span class="keyword">not</span> started.</span><br><span class="line"></span><br><span class="line"><span class="comment"># Start:</span></span><br><span class="line">  will start any stopped container.</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run:</span></span><br><span class="line">  combination <span class="keyword">of</span> create <span class="keyword">and</span> start, It creates <span class="keyword">the</span> container <span class="keyword">and</span> starts <span class="keyword">it</span>.</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #22</strong>: Docker Mem Limit</p>
<figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> <span class="javascript">é»˜è®¤æƒ…å†µä¸‹å®¹å™¨ä½¿ç”¨çš„èµ„æºä¸å—é™åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸»æœºå†…æ ¸è°ƒåº¦å™¨æ‰€å…è®¸çš„æœ€å¤§èµ„æº</span></span><br><span class="line"><span class="meta">&gt;</span> <span class="javascript">é™åˆ¶å®¹å™¨ä¸èƒ½è¿‡å¤šçš„ä½¿ç”¨ä¸»æœºçš„å†…å­˜ï¼Œä¸€æ—¦å†…å­˜æ£€æµ‹åˆ°æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å¯ä»¥åˆ†é…ï¼Œå°±ä¼šå‡ºç°OOM(Out Of Memory Exception). å¹¶å¼€å§‹éšæœºKillä¸€äº›è¿›ç¨‹ç”¨äºé‡Šæ”¾å†…å­˜ç©ºé—´ï¼Œdockerå°è¯•è°ƒæ•´docker daemon çš„OOMä¼˜å…ˆçº§è¿›è¡Œç¼“è§£ï¼Œå†…æ ¸åœ¨é€‰æ‹©æ€æ­»çš„è¿›ç¨‹æ—¶ä¼šå¯¹æ‰€æœ‰çš„è¿›ç¨‹æ‰“åˆ†ï¼Œç›´æ¥æ€æ­»å¾—åˆ†æœ€é«˜çš„è¿›ç¨‹ï¼Œdocker daemonçš„OOMä¼˜å…ˆçº§è¢«é™ä½</span></span><br></pre></td></tr></table></figure>
<ul>
<li><a href="/misc/code/script/show_process_score.sh">show_process_score.sh</a><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è„šæœ¬è¾“å‡ºå¾—åˆ†æœ€é«˜çš„10ä¸ªè¿›ç¨‹,å¹¶æ’åº</span></span><br><span class="line">  âœ ./show_process_score.sh</span><br><span class="line">  <span class="number">672</span>  <span class="number">1510</span> <span class="regexp">/usr/</span>bin/gnome-shell</span><br><span class="line">  <span class="number">669</span>  <span class="number">1811</span> <span class="regexp">/usr/</span>libexec/gnome-initial-setup --existing-user</span><br><span class="line">  <span class="number">668</span>  <span class="number">1010</span> <span class="regexp">/usr/</span>lib<span class="regexp">/xorg/</span>Xorg vt2 -displayfd <span class="number">3</span> -auth <span class="regexp">/run/u</span>se</span><br><span class="line">  <span class="number">667</span>  <span class="number">2062</span> update-notifier</span><br><span class="line">  <span class="number">667</span>  <span class="number">1760</span> <span class="regexp">/usr/</span>libexec<span class="regexp">/evolution-data-server/</span>evolution-alarm</span><br><span class="line">  <span class="number">667</span>  <span class="number">1128</span> <span class="regexp">/usr/</span>libexec/goa-daemon</span><br><span class="line">  <span class="number">666</span>   <span class="number">996</span> <span class="regexp">/usr/</span>libexec/tracker-miner-fs</span><br><span class="line">  <span class="number">666</span>   <span class="number">994</span> <span class="regexp">/usr/</span>bin/pulseaudio --daemonize=no --log-target=jo</span><br><span class="line">  <span class="number">666</span>   <span class="number">988</span> (sd-pam)</span><br><span class="line">  <span class="number">666</span>   <span class="number">987</span> <span class="regexp">/lib/</span>systemd/systemd --user</span><br><span class="line"></span><br><span class="line"><span class="comment"># é™ä½OOMé£é™©:</span></span><br><span class="line">  - é€šè¿‡æµ‹è¯•æŒæ¡åº”ç”¨å¯¹å†…å­˜çš„éœ€æ±‚</span><br><span class="line">  - ä¿è¯è¿è¡Œå®¹å™¨çš„ä¸»æœºæœ‰å……è¶³çš„å†…å­˜</span><br><span class="line">  - é™åˆ¶å®¹å™¨å¯ä»¥ä½¿ç”¨çš„å†…å­˜</span><br><span class="line">  - ä¸ºä¸»æœºé…ç½®Swap</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>å‹åŠ›æµ‹è¯•å·¥å…· stress<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="comment"># stress</span></span><br><span class="line">&gt; a tool for generating workload. <span class="keyword">It</span> can produce CPU, memory, I/O, <span class="keyword">and</span> disk stress.</span><br></pre></td></tr></table></figure></li>
<li><a href="/misc/code/devops/benchmark/stress.Dockerfile">stress.Dockerfile</a><figure class="highlight tap"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºé•œåƒ</span></span><br><span class="line">âœ docker build -f stress.Dockerfile -t chyiyaqing/u-stress:latest .</span><br><span class="line"></span><br><span class="line"><span class="comment"># é™åˆ¶å†…å­˜ä½¿ç”¨ä¸Šé™(memory-swapå€¼åŒ…å«å®¹å™¨å¯ç”¨å†…å­˜å’Œå¯ç”¨swap;)</span></span><br><span class="line">âœ docker run -it -m 300M --memory-swap -1 --name con1 chyiyaqing/u-stress /bin/bash</span><br><span class="line">root@1a3df043e956:/<span class="comment"># stress --vm 1 --vm-bytes 500M</span></span><br><span class="line">stress: info: [9] dispatching hogs:<span class="number"> 0 </span>cpu,<span class="number"> 0 </span>io,<span class="number"> 1 </span>vm,<span class="number"> 0 </span>hdd</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker stats æŸ¥çœ‹</span></span><br><span class="line">$ docker stats</span><br><span class="line">CONTAINER ID   NAME      CPU %     MEM USAGE / LIMIT   MEM %     NET I/O       BLOCK I/O     PIDS</span><br><span class="line">1a3df043e956   con1      71.85%    300MiB / 300MiB     100.00%   6.71kB / 0B   3.45GB / 0B   3</span><br><span class="line"></span><br><span class="line"><span class="comment"># Topå‘½ä»¤æŸ¥çœ‹stressè¿›ç¨‹å†…å­˜å®é™…æƒ…å†µ</span></span><br><span class="line">chyiyaqing in ~ at chyiyaqing-PowerEdge-R720 took 5s</span><br><span class="line"><span class="comment"># pgrep å‘½ä»¤æŸ¥è¯¢stresså‘½ä»¤ç›¸å…³è¿›ç¨‹</span></span><br><span class="line">âœ pgrep stress</span><br><span class="line">48622</span><br><span class="line">48623</span><br><span class="line"></span><br><span class="line">chyiyaqing in ~ at chyiyaqing-PowerEdge-R720</span><br><span class="line">âœ top -p 48623</span><br><span class="line">top - 22:40:23 up<span class="number"> 2 </span>days,  5:40, <span class="number"> 4 </span>users,  load average: 0.95, 0.47, 0.18</span><br><span class="line">Tasks:  <span class="number"> 1 </span>total,  <span class="number"> 1 </span>running,  <span class="number"> 0 </span>sleeping,  <span class="number"> 0 </span>stopped,  <span class="number"> 0 </span>zombie</span><br><span class="line">%Cpu(s):  0.1 us,  2.0 sy,  0.0 ni, 97.1 id,  0.8 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">MiB Mem :  32106.2 total,  27283.4 free,   1420.6 used,   3402.2 buff/cache</span><br><span class="line">MiB Swap:   2048.0 total,   1545.3 free,    502.7 used.  30224.1 avail Mem</span><br><span class="line"></span><br><span class="line">    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND</span><br><span class="line"> <span class="number"> 48623 </span>root     <span class="number"> 20 </span> <span class="number"> 0 </span><span class="number"> 515868 </span>305460   <span class="number"> 272 </span>R  71.7   0.9   2:02.53 stress</span><br><span class="line"></span><br><span class="line"><span class="comment"># VIRT è¿›ç¨‹è™šæ‹Ÿå†…å­˜å¤§å°; RES å®é™…åˆ†é…ç‰©ç†å†…å­˜å¤§å°</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>Docker Tip #23</strong>: Docker CPU Limit</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">&gt; é»˜è®¤æƒ…å†µä¸‹å®¹å™¨å¯ä»¥ä¸å—é™åˆ¶çš„ä½¿ç”¨CPU/å†…å­˜èµ„æº, å¦‚æœä¸å¯¹å®¹å™¨ä½¿ç”¨è¿›è¡Œé™åˆ¶ï¼Œä¸€æ—¦å‘ç”Ÿå®¹å™¨ç¨‹åºå¼‚å¸¸ä½¿ç”¨CPU/Memæƒ…å†µï¼Œå¯èƒ½ä¼šæŠŠæ•´ä¸ªä¸»æœºCPU/Memèµ„æºè€—å°½.</span><br><span class="line"></span><br><span class="line"># é™åˆ¶å¯ç”¨CPUä¸ªæ•°</span><br><span class="line">âœ docker run --rm -it --cpus=<span class="number">2</span> chyiyaqing/<span class="keyword">u</span>-stress /bin/bash</span><br><span class="line"></span><br><span class="line">root@f11127fe7c50:/# stress -<span class="keyword">c</span> <span class="number">4</span></span><br><span class="line">stres<span class="variable">s:</span> info: [<span class="number">9</span>] dispatching hog<span class="variable">s:</span> <span class="number">4</span> cpu, <span class="number">0</span> io, <span class="number">0</span> <span class="keyword">vm</span>, <span class="number">0</span> hdd</span><br><span class="line"></span><br><span class="line"># docker stats</span><br><span class="line">CONTAINER ID   NAME                CPU %     MEM USAGE / LIMIT     MEM %     NET I/O       BLOCK I/O   PIDS</span><br><span class="line">f11127fe7c50   competent_noether   <span class="number">198.98</span>%   <span class="number">1.695</span>MiB / <span class="number">31.35</span>GiB   <span class="number">0.01</span>%     <span class="number">39.7</span>kB / <span class="number">0</span>B   <span class="number">0</span>B / <span class="number">0</span>B     <span class="number">6</span></span><br><span class="line"></span><br><span class="line"># Top</span><br><span class="line">Task<span class="variable">s:</span> <span class="number">468</span> total,   <span class="number">5</span> running, <span class="number">463</span> sleeping,   <span class="number">0</span> stopped,   <span class="number">0</span> zombie</span><br><span class="line">%Cpu0  :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu1  :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu2  : <span class="number">50.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni, <span class="number">50.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span>     --</span><br><span class="line">%Cpu3  :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu4  :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu5  :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu6  :  <span class="number">5.0</span> us,  <span class="number">5.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni, <span class="number">90.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu7  :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu8  :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu9  :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu10 :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu11 : <span class="number">50.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni, <span class="number">50.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span>     --</span><br><span class="line">%Cpu12 :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu13 : <span class="number">47.4</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni, <span class="number">52.6</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span>     --</span><br><span class="line">%Cpu14 :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu15 :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu16 :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu17 :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu18 :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu19 :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu20 :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu21 :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu22 :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu23 :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu24 :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu25 :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu26 :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu27 :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu28 :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu29 :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu30 :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu31 : <span class="number">50.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni, <span class="number">50.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span>     --</span><br><span class="line">MiB Mem :  <span class="number">32106.2</span> total,  <span class="number">27901.2</span> free,   <span class="number">1119.0</span> used,   <span class="number">3086.0</span> buff/cache</span><br><span class="line">MiB Swap:   <span class="number">2048.0</span> total,   <span class="number">2044.6</span> free,      <span class="number">3.4</span> used.  <span class="number">30537.0</span> avail Mem</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹TopçœŸå®æƒ…å†µä¸æ˜¯ä¸¤ä¸ªCPUè´Ÿè½½<span class="number">100</span>%, è€Œæ˜¯å®¹å™¨æ¶ˆè€—CPUæ€»å…±<span class="number">200</span>%çš„è´Ÿè½½ï¼Œè¿›ç¨‹æ²¡æœ‰CPUæ•°çš„é™åˆ¶ï¼Œåªèƒ½é€šè¿‡è¿›ç¨‹æ¶ˆè€—CPUæ—¶é—´ç‰‡ç»Ÿè®¡å‡ºè¿›ç¨‹å ç”¨CPUçš„ç™¾åˆ†æ¯”</span><br><span class="line"></span><br><span class="line"># æŒ‡å®šå›ºå®šCPU</span><br><span class="line">  &gt; é€šè¿‡--cpuset-cpusè®¾ç½®å®¹å™¨è¿è¡Œåœ¨å‡ ä¸ªå›ºå®šçš„CPUä¸Š, å› ä¸ºå¤šæ ¸ç³»ç»Ÿæ¯ä¸ªæ ¸å¿ƒéƒ½æœ‰è‡ªå·±çš„ç¼“å­˜,é¢‘ç¹çš„è°ƒåº¦è¿›ç¨‹åœ¨ä¸åŒçš„æ ¸å¿ƒä¸Šæ‰§è¡Œä¼šå¸¦æ¥ç¼“å­˜å¤±æ•ˆçš„å¼€é”€</span><br><span class="line">  chyiyaqing in ~ at chyiyaqing-PowerEdge-R720</span><br><span class="line">  âœ docker run --rm -it --cpuset-cpus=<span class="string">&quot;0,1,2,3&quot;</span> chyiyaqing/<span class="keyword">u</span>-stress /bin/bash</span><br><span class="line"></span><br><span class="line"># å¯åŠ¨å¡”é‡Œæµ‹è¯•å‘½ä»¤</span><br><span class="line">root@<span class="number">95110</span>b6915af:/# stress -<span class="keyword">c</span> <span class="number">10</span></span><br><span class="line">stres<span class="variable">s:</span> info: [<span class="number">12</span>] dispatching hog<span class="variable">s:</span> <span class="number">4</span> cpu, <span class="number">0</span> io, <span class="number">0</span> <span class="keyword">vm</span>, <span class="number">0</span> hdd</span><br><span class="line"></span><br><span class="line"># docker stats</span><br><span class="line">CONTAINER ID   NAME                 CPU %     MEM USAGE / LIMIT    MEM %     NET I/O      BLOCK I/O   PIDS</span><br><span class="line"><span class="number">39</span>b4ce536148   frosty_stonebraker   <span class="number">399.38</span>%   <span class="number">2.43</span>MiB / <span class="number">31.35</span>GiB   <span class="number">0.01</span>%     <span class="number">3.9</span>kB / <span class="number">0</span>B   <span class="number">0</span>B / <span class="number">0</span>B     <span class="number">12</span></span><br><span class="line"></span><br><span class="line"># Top</span><br><span class="line">âœ top</span><br><span class="line">top - <span class="number">23</span>:<span class="number">08</span>:<span class="number">19</span> <span class="keyword">up</span> <span class="number">2</span> days,  <span class="number">6</span>:<span class="number">08</span>,  <span class="number">4</span> users,  load average: <span class="number">6.97</span>, <span class="number">3.73</span>, <span class="number">2.01</span></span><br><span class="line">Task<span class="variable">s:</span> <span class="number">496</span> total,  <span class="number">11</span> running, <span class="number">485</span> sleeping,   <span class="number">0</span> stopped,   <span class="number">0</span> zombie</span><br><span class="line">%Cpu0  :<span class="number">100.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,  <span class="number">0.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu1  :<span class="number">100.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,  <span class="number">0.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu2  :<span class="number">100.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,  <span class="number">0.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu3  :<span class="number">100.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,  <span class="number">0.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu4  :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni, <span class="number">97.7</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">2.3</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line"></span><br><span class="line"># è®¾ç½®CPUçš„æƒé‡</span><br><span class="line">&gt; è®¾ç½®CPUæƒé‡åªæœ‰åœ¨å®¹å™¨äº‰ç”¨CPUèµ„æºçš„æƒ…å†µä¸‹ï¼ŒCPUçš„æƒé‡æ‰èƒ½è®©ä¸åŒçš„å®¹å™¨åˆ†åˆ°ä¸åŒçš„CPUç”¨é‡ --cpu-shares è®¾ç½®CPUæƒé‡ï¼Œé»˜è®¤å€¼ä¸º<span class="number">1024</span>,</span><br><span class="line"></span><br><span class="line"># è¿è¡Œä¸¤ä¸ªå®¹å™¨ï¼ŒæŒ‡å®šä½¿ç”¨CPU0ï¼Œåˆ†åˆ«è®¾ç½®--cpu-shares <span class="number">512</span>,<span class="number">1024</span></span><br><span class="line">  âœ docker run --rm -it --cpuset-cpus=<span class="string">&quot;0&quot;</span> --cpu-shares=<span class="number">512</span> chyiyaqing/<span class="keyword">u</span>-stress /bin/bash</span><br><span class="line">  âœ docker run --rm -it --cpuset-cpus=<span class="string">&quot;0&quot;</span> --cpu-shares=<span class="number">1024</span> chyiyaqing/<span class="keyword">u</span>-stress /bin/bash</span><br><span class="line"></span><br><span class="line"># ä¸¤ä¸ªå®¹å™¨éƒ½è¿è¡Œstress -<span class="keyword">c</span> <span class="number">4</span></span><br><span class="line"></span><br><span class="line"># top</span><br><span class="line">âœ top</span><br><span class="line">top - <span class="number">23</span>:<span class="number">14</span>:<span class="number">14</span> <span class="keyword">up</span> <span class="number">2</span> days,  <span class="number">6</span>:<span class="number">14</span>,  <span class="number">5</span> users,  load average: <span class="number">5.30</span>, <span class="number">5.25</span>, <span class="number">3.42</span></span><br><span class="line">Task<span class="variable">s:</span> <span class="number">495</span> total,   <span class="number">9</span> running, <span class="number">486</span> sleeping,   <span class="number">0</span> stopped,   <span class="number">0</span> zombie</span><br><span class="line">%Cpu0  :<span class="number">100.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,  <span class="number">0.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line">%Cpu1  :  <span class="number">0.0</span> us,  <span class="number">0.0</span> <span class="keyword">sy</span>,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> <span class="keyword">wa</span>,  <span class="number">0.0</span> <span class="keyword">hi</span>,  <span class="number">0.0</span> si,  <span class="number">0.0</span> <span class="keyword">st</span></span><br><span class="line"></span><br><span class="line"># docker stats</span><br><span class="line">CONTAINER ID   NAME                CPU %     MEM USAGE / LIMIT     MEM %     NET I/O       BLOCK I/O   PIDS</span><br><span class="line">f9c8864fab87   beautiful_neumann   <span class="number">66.39</span>%    <span class="number">1.695</span>MiB / <span class="number">31.35</span>GiB   <span class="number">0.01</span>%     <span class="number">5.23</span>kB / <span class="number">0</span>B   <span class="number">0</span>B / <span class="number">0</span>B     <span class="number">6</span></span><br><span class="line"><span class="number">6</span>b69afc7fea5   pensive_vaughan     <span class="number">33.41</span>%    <span class="number">1.676</span>MiB / <span class="number">31.35</span>GiB   <span class="number">0.01</span>%     <span class="number">7.17</span>kB / <span class="number">0</span>B   <span class="number">0</span>B / <span class="number">0</span>B     <span class="number">6</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Have-a-Fun"><a href="#Have-a-Fun" class="headerlink" title="Have a Fun"></a>Have a Fun</h2><ul>
<li>Run the First Edition of Unix (1972) with Docker<blockquote>
<p>Run a PDP-11 simulator through Docker to interact with Unix as it was back in 1972</p>
</blockquote>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">$ docker <span class="keyword">run</span> --<span class="keyword">rm</span> -it bahamat/unix-1st-<span class="keyword">ed</span></span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>Docker</tag>
        <tag>Dockerfile</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo-next-gitalk</title>
    <url>/2021/09/01/hexo-next-gitalk/</url>
    <content><![CDATA[<h3 id="ç«™ç‚¹æ­å»ºè¿‡ç¨‹"><a href="#ç«™ç‚¹æ­å»ºè¿‡ç¨‹" class="headerlink" title="ç«™ç‚¹æ­å»ºè¿‡ç¨‹"></a>ç«™ç‚¹æ­å»ºè¿‡ç¨‹</h3><ul>
<li><a href="https://hexo.io/zh-cn/">hexo</a> : å¿«é€Ÿã€ç®€æ´ä¸”é«˜æ ¡çš„åšå®¢æ¡†æ¶</li>
<li><a href="https://github.com/next-theme/hexo-theme-next/blob/master/docs/zh-CN/README.md">next</a> : Hexoä¸»é¢˜</li>
<li><a href="https://github.com/gitalk/gitalk">gitalk</a> : ä¾é GitHub issueçš„è¯„è®ºç³»ç»Ÿ</li>
</ul>
<span id="more"></span>

<h3 id="Settings-amp-Tips"><a href="#Settings-amp-Tips" class="headerlink" title="Settings &amp; Tips"></a>Settings &amp; Tips</h3><ul>
<li><p><strong>Show descripion</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"># ä¿®æ”¹themes/next/_config.yml</span><br><span class="line">excerpt_description: true</span><br><span class="line"></span><br><span class="line"># æ–‡ç« æˆªæ–­</span><br><span class="line"><span class="comment">&lt;!--more--&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>å­—æ•°ç»Ÿè®¡</strong></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…æ’ä»¶ hexo-symbols-count-time</span></span><br><span class="line"><span class="string">$</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">hexo-symbols-count-time</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹hexoé…ç½®æ–‡ä»¶_config.yml</span></span><br><span class="line">  <span class="comment"># Symbols count and time to read of articles for Hexo.</span></span><br><span class="line">  <span class="attr">symbols_count_time:</span></span><br><span class="line">      <span class="attr">symbols:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">time:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">total_symbols:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">total_time:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹Nexté…ç½®æ–‡ä»¶</span></span><br><span class="line">  <span class="comment"># Post wordcount display settings</span></span><br><span class="line">  <span class="comment"># Dependencies: https://github.com/next-theme/hexo-word-counter</span></span><br><span class="line">  <span class="attr">symbols_count_time:</span></span><br><span class="line">    <span class="attr">separated_meta:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">item_text_post:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">item_text_total:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">awl:</span> <span class="number">4</span></span><br><span class="line">    <span class="attr">wpm:</span> <span class="number">275</span></span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>blog</tag>
      </tags>
  </entry>
  <entry>
    <title>micro-services</title>
    <url>/2021/09/01/micro-services/</url>
    <content><![CDATA[<blockquote>
<p>é¡¹ç›®å·¥ç¨‹åŒ–ã€å¾®æœåŠ¡ç›¸å…³ä»‹ç»</p>
</blockquote>
<span id="more"></span>

<h2 id="é¡¹ç›®å·¥ç¨‹åŒ–"><a href="#é¡¹ç›®å·¥ç¨‹åŒ–" class="headerlink" title="é¡¹ç›®å·¥ç¨‹åŒ–"></a>é¡¹ç›®å·¥ç¨‹åŒ–</h2><ul>
<li><p>å¼€æºè§„èŒƒ</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># å¼€æºåè®®</span></span><br><span class="line"><span class="bullet">  1.</span> GPL - General Public License</span><br><span class="line"><span class="code">    &gt; è¡ç”Ÿä»£ç çš„åˆ†å‘éœ€è¦å¼€æºå¹¶ä¸”ä¹Ÿè¦éµå®ˆæ­¤åè®®</span></span><br><span class="line"><span class="code">  2. MPL</span></span><br><span class="line"><span class="code">    &gt; å…è®¸å…è´¹é‡å‘å¸ƒã€å…è´¹ä¿®æ”¹ï¼Œä½†è¦æ±‚ä¿®æ”¹çš„ä»£ç ç‰ˆæƒå½’è½¯ä»¶å‘èµ·è€…ï¼Œè¿™ç§æˆæƒç»´æŠ¤äº†å•†ä¸šè½¯ä»¶çš„åˆ©ç›Šï¼Œè¦æ±‚åŸºäºè¿™ç§è½¯ä»¶çš„ä¿®æ”¹æ— å¿è´¡çŒ®ç‰ˆæƒç»™è¯¥è½¯ä»¶</span></span><br><span class="line"><span class="code">  3. LGPL</span></span><br><span class="line"><span class="code">  4. Apache</span></span><br><span class="line"><span class="code">    &gt; Apache 2.0åè®®é™¤äº†ä¸ºç”¨æˆ·æä¾›ç‰ˆæƒè®¸å¯ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸“åˆ©è®¸å¯ï¼Œé€‚åˆè®¾è®¡ä¸“åˆ©å†…å®¹çš„é¡¹ç›®</span></span><br><span class="line"><span class="code">  5. BSD</span></span><br><span class="line"><span class="code">    &gt;</span></span><br><span class="line"><span class="code">  6. MIT</span></span><br><span class="line"><span class="code">    &gt; MIT åè®®æ˜¯æ‰€æœ‰å¼€æºè®¸å¯ä¸­æœ€å®½æ¾çš„ä¸€ä¸ªï¼Œé™¤äº†ç»†ç¬”åŒ…å«è®¸å¯å£°æ˜ä¹‹å¤–ï¼Œå†æ— ä»»ä½•é™åˆ¶</span></span><br></pre></td></tr></table></figure></li>
<li><p>å¼€æºè§„èŒƒ</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> é¡¹ç›®ç»“æ„:</span><br><span class="line"><span class="bullet">2.</span> ä¸¥æ ¼éµå¾ªä»£ç è§„èŒƒ:</span><br><span class="line"><span class="bullet">3.</span> ä»£ç è´¨é‡:</span><br><span class="line"><span class="bullet">4.</span> å•å…ƒæµ‹è¯•è¦†ç›–ç‡:</span><br><span class="line"><span class="bullet">5.</span> ç‰ˆæœ¬å‘å¸ƒè§„èŒƒ:</span><br><span class="line"><span class="bullet">6.</span> å‘ä¸‹å…¼å®¹:</span><br><span class="line"><span class="bullet">7.</span> è¯¦ç»†çš„æ–‡æ¡£è¯´æ˜:</span><br><span class="line"><span class="bullet">8.</span> å®‰å…¨:</span><br></pre></td></tr></table></figure></li>
<li><p>æ–‡æ¡£è§„èŒƒ</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> READMEæ–‡æ¡£</span><br><span class="line">  ä»‹ç»é¡¹ç›®åŠŸèƒ½ã€å®‰è£…ã€éƒ¨ç½²ã€ä½¿ç”¨</span><br><span class="line"><span class="bullet">2.</span> é¡¹ç›®æ–‡æ¡£</span><br><span class="line">  å¼€å‘æ–‡æ¡£: è¯´æ˜é¡¹ç›®çš„å¼€å‘æµç¨‹</span><br><span class="line">  ç”¨æˆ·æ–‡æ¡£:</span><br><span class="line"><span class="bullet">3.</span> APIæ¥å£æ–‡æ¡£</span><br></pre></td></tr></table></figure></li>
<li><p>ç‰ˆæœ¬è§„èŒƒ</p>
<figure class="highlight tp"><table><tr><td class="code"><pre><span class="line">è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ: SemVer: ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å· (<span class="keyword">X</span>.<span class="keyword">Y</span>.<span class="keyword">Z</span>), XYZä¸ºéè´Ÿçš„æ•´æ•°ï¼Œç¦æ­¢åœ¨æ•°å­—å‰æ–¹è¡¥é›¶</span><br><span class="line">  ä¸»ç‰ˆæœ¬å·: MAJOR: å½“åšäº†ä¸å…¼å®¹APIä¿®æ”¹</span><br><span class="line">  æ¬¡ç‰ˆæœ¬å·: MINOR: å½“åšäº†å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ–°å¢åŠä¿®æ”¹ -- å¶æ•°ä¸ºç¨³å®šç‰ˆæœ¬ï¼Œå¥‡æ•°ä¸ºå¼€å‘ç‰ˆæœ¬</span><br><span class="line">  ä¿®è®¢å·:PATCH: å‘ä¸‹å…¼å®¹é—®é¢˜ä¿®æ­£</span><br><span class="line"></span><br><span class="line"><span class="keyword">X</span>.<span class="keyword">Y</span>.<span class="keyword">Z</span>[-å…ˆè¡Œç‰ˆæœ¬å·][+ç‰ˆæœ¬ç¼–è¯‘å…ƒæ•°æ®]</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. å®é™…å¼€å‘çš„æ—¶å€™ï¼Œä½¿ç”¨<span class="number">0</span><span class="number">.1</span><span class="number">.0</span>ä½œä¸ºç¬¬ä¸€å¼€å‘ç‰ˆæœ¬å·</span><br><span class="line">fixç±»å‹çš„commit å¯ä»¥å°†ä¿®è®¢å·+<span class="number">1</span></span><br><span class="line">featç±»å‹çš„commitå¯ä»¥å°†æ¬¡ç‰ˆæœ¬å·+<span class="number">1</span></span><br><span class="line">breaking changeçš„commitå°†ä¸»ç‰ˆæœ¬å·+<span class="number">1</span></span><br></pre></td></tr></table></figure></li>
<li><p>Commit è§„èŒƒ</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line">Commit MessageåŒ…å«ä¸‰éƒ¨åˆ†:</span><br><span class="line"><span class="symbol">  Header:</span> <span class="params">&lt;type&gt;</span>[optional scope]: <span class="params">&lt;description&gt;</span></span><br><span class="line"><span class="symbol">    type:</span></span><br><span class="line"><span class="symbol">      feat:</span> æ–°å¢åŠŸèƒ½</span><br><span class="line"><span class="symbol">      fix:</span> Bugä¿®å¤</span><br><span class="line"><span class="symbol">      perf:</span> æé«˜ä»£ç æ€§èƒ½çš„å˜æ›´</span><br><span class="line"><span class="symbol">      style:</span> ä»£ç æ ¼å¼ç±»çš„å˜æ›´</span><br><span class="line"><span class="symbol">      refactor:</span> å…¶ä»–ä»£ç ç±»çš„å˜æ›´ï¼Œè¿™äº›å˜æ›´ä¸å±äºfeat,fix,perfå’Œstyle. ç®€åŒ–ä»£ç ï¼Œé‡å‘½åå˜é‡ã€åˆ é™¤å†—ä½™ä»£ç </span><br><span class="line"><span class="symbol">      test:</span> æ–°å¢æµ‹è¯•ç”¨ä¾‹æˆ–æ˜¯æ›´æ–°ç°æœ‰æµ‹è¯•ç”¨ä¾‹</span><br><span class="line"><span class="symbol">      ci:</span> æŒç»­é›†æˆå’Œéƒ¨ç½²æƒ³å¹²æ”¹åŠ¨ï¼Œ</span><br><span class="line"><span class="symbol">      docs:</span> æ–‡æ¡£ç±»æ›´æ–°</span><br><span class="line"><span class="symbol">      chore:</span> å…¶ä»–ç±»å‹ï¼Œæ„å»ºæµç¨‹ã€ä¾èµ–ç®¡ç†æˆ–è€…è¾…åŠ©å·¥å…·çš„å˜åŠ¨</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">    scope:</span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">    description:</span> åŠ¨è¯å¼€å¤´ï¼Œä½¿ç”¨ç°åœ¨æ—¶</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">  Body:</span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">  Footer:</span></span><br><span class="line"></span><br><span class="line">git rebase: é‡å†™å†å²</span><br><span class="line">  git rebase -i <span class="params">&lt;commit ID&gt;</span> è¿™é‡Œæ˜¯éœ€è¦åˆå¹¶commitä¸­æœ€æ—§commitçš„çˆ¶commit ID</span><br><span class="line"></span><br><span class="line">git reset HEAD~<span class="number">3</span>A æ’¤é”€è¿‡å»çš„commit,é‡æ–°æäº¤</span><br><span class="line"></span><br><span class="line">git commit --amend: ä¿®æ”¹æœ€è¿‘ä¸€æ¬¡commit çš„ message</span><br><span class="line"></span><br><span class="line">Commit Messageæ˜¯commitæ•°æ®ç»“æ„ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œå¦‚æœCommit Messageæœ‰å˜æ›´ï¼Œåˆ™commit IDä¸€å®šä¼šå˜ï¼Œgit commit --amendåªä¼šå˜æ›´æœ€åä¸€æ¬¡çš„commit ID, git rebase -i ä¼šå˜æ›´çˆ¶commit IDä¹‹åçš„æ‰€æœ‰æäº¤commit ID.</span><br><span class="line"></span><br><span class="line">å¦‚æœå½“å‰åˆ†ä¹‹æœ‰æœªcommitçš„ä»£ç ï¼Œéœ€è¦å…ˆæ‰§è¡Œgit stashå°†å·¥ä½œçŠ¶æ€è¿›è¡Œæš‚å­˜ï¼Œå½“ä¿®æ”¹å®Œæˆååœ¨æ‰§è¡Œgit stash popæ¢å¤ä¹‹å‰çš„å·¥ä½œçŠ¶æ€</span><br></pre></td></tr></table></figure></li>
<li><p>ç›®å½•ç»“æ„è®¾è®¡</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç»“æ„åŒ–ç›®å½•ç»“æ„</span></span><br><span class="line">  /cmd            <span class="comment">-- ç»„ä»¶</span></span><br><span class="line">  /internal       <span class="comment">-- ç§æœ‰åº”ç”¨å’Œåº“ä»£ç ,ä¸å¸Œæœ›åœ¨å…¶ä»–åº”ç”¨å’Œåº“ä¸­è¢«å¯¼å…¥</span></span><br><span class="line">  /pkg            <span class="comment">-- å­˜æ”¾å¯ä»¥è¢«å¤–éƒ¨åº”ç”¨ä½¿ç”¨çš„ä»£ç åº“</span></span><br><span class="line"><span class="comment"># å¹³é“ºå¼ç›®å½•ç»“æ„</span></span><br><span class="line">  &gt; è¿™ç§æ–¹å¼åœ¨å¾ˆå¤šæ¡†æ¶/åº“ä¸­å­˜åœ¨,å¥½å¤„å¼å¼•ç”¨è·¯å¾„é•¿åº¦çŸ­</span><br></pre></td></tr></table></figure></li>
<li><p>å·¥ä½œæµè®¾è®¡</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é›†ä¸­å¼å·¥ä½œæµ</span></span><br><span class="line">  &gt; é€‚ç”¨äºå›¢é˜Ÿäººæ•°å°‘ã€å¼€å‘ä¸é¢‘ç¹ã€ä¸éœ€è¦åŒæ—¶ç»´æŠ¤å¤šä¸ªç‰ˆæœ¬çš„å°é¡¹ç›®</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠŸèƒ½åˆ†æ”¯å·¥ä½œæµ</span></span><br><span class="line">  &gt; ä¸åŒåŠŸèƒ½åœ¨ä¸åŒçš„åˆ†æ”¯è¿›è¡Œå¼€å‘ï¼Œæœ€ååˆå¹¶åˆ°<span class="literal">master</span>åˆ†æ”¯</span><br><span class="line">  Merge pull request:</span><br><span class="line">    <span class="number">1</span>. Create a merge commit: git merge --no-ff. featureåˆ†æ”¯ä¸Šæ‰€æœ‰çš„commitéƒ½ä¼šåŠ åˆ°<span class="literal">master</span>åˆ†æ”¯ä¸Šï¼Œå¹¶ä¸”ä¼šç”Ÿæˆä¸€ä¸ªmerge commitã€‚</span><br><span class="line">    <span class="number">2</span>. Squash <span class="keyword">and</span> merge: git merge --squash. featureåˆ†æ”¯ä¸Šæ‰€æœ‰çš„commitéƒ½åˆå¹¶æˆä¸€ä¸ªcommit.ç„¶ååŠ åˆ°<span class="literal">master</span>åˆ†æ”¯,åŸæ¥çš„commitå†å²ä¼šä¸¢å¤±</span><br><span class="line">    <span class="number">3</span>. Rebase <span class="keyword">and</span> merge: git rebase. å°†pull requestä¸Šæ‰€æœ‰æäº¤å†å²æŒ‰ç…§åŸæœ‰é¡ºåºä¾æ¬¡æ·»åŠ åˆ°<span class="literal">master</span>åˆ†æ”¯çš„å¤´éƒ¨HEAD.</span><br><span class="line"></span><br><span class="line"><span class="comment"># Git Flowå·¥ä½œæµ</span></span><br><span class="line">  &gt; æ¯”è¾ƒé€‚åˆå¤§å‹çš„é¡¹ç›®æˆ–è€…è¿­ä»£é€Ÿåº¦å¿«çš„é¡¹ç›®</span><br><span class="line">  <span class="literal">master</span>: è¯¥åˆ†æ”¯æœ€æ–°ä»£ç æ˜¯å‘å¸ƒçŠ¶æ€ï¼Œä¸èƒ½ç›´æ¥åœ¨è¯¥åˆ†æ”¯ä¸Šå¼€å‘ï¼Œ<span class="literal">master</span>åˆ†æ”¯æ¯åˆå¹¶ä¸€ä¸ªhotfix/releaseåˆ†æ”¯ï¼Œéƒ½ä¼šæ‰“ä¸€ä¸ªç‰ˆæœ¬æ ‡ç­¾</span><br><span class="line">  develop: è¯¥åˆ†æ”¯æ˜¯å¼€å‘ä¸­çš„æœ€æ–°ä»£ç ï¼Œè¯¥åˆ†æ”¯åªåšåˆå¹¶æ“ä½œï¼Œä¸èƒ½ç›´æ¥åœ¨è¯¥åˆ†æ”¯ä¸Šå¼€å‘</span><br><span class="line">  feature: åŠŸèƒ½å¼€å‘,åŸºäºdevelopåˆ†æ”¯æ–°å»ºä¸€ä¸ªfeatureåˆ†æ”¯ï¼Œfeatureåˆ†æ”¯åˆå¹¶ä¹‹å‰å…ˆpullä¸€ä¸‹developåˆ†æ”¯ï¼Œ</span><br><span class="line">  release: åœ¨å‘å¸ƒé˜¶æ®µä½œä¸ºç‰ˆæœ¬å‘å¸ƒçš„é¢„å‘å¸ƒåˆ†æ”¯ï¼ŒåŸºäºdevelopåˆ†æ”¯åˆ›å»º, æµ‹è¯•é€šè¿‡åï¼Œå°†releaseåˆ†æ”¯åˆå¹¶åˆ°<span class="literal">master</span>å’Œdevelopï¼Œå¹¶åœ¨<span class="literal">master</span>åˆ†æ”¯ä¸Šç‰ˆæœ¬æ ‡ç­¾ï¼Œæœ€ååˆ é™¤releaseç‰ˆæœ¬åˆ†æ”¯</span><br><span class="line">  hotfix: åœ¨ç»´æŠ¤é˜¶æ®µåšç´§æ€¥Bugä¿®å¤åˆ†æ”¯ï¼Œhotfixåˆ†æ”¯åˆå¹¶åˆ°<span class="literal">master</span>å’Œdevelopåˆ†æ”¯ï¼Œå¹¶åœ¨<span class="literal">master</span>åˆ†æ”¯æ‰“ä¸Šä¿®å¤åçš„ç‰ˆæœ¬æ ‡ç­¾,æœ€ååˆ é™¤hotfixåˆ†æ”¯</span><br><span class="line"></span><br><span class="line"><span class="comment"># Forking å·¥ä½œæµ</span></span><br><span class="line">  é¡¹ç›®è¿œç¨‹ä»“åº“å’Œå¼€å‘è€…è¿œç¨‹ä»“åº“å®Œå…¨ç‹¬ç«‹ï¼Œå¼€å‘è€…é€šè¿‡Pull Requestçš„æ–¹å¼ç»™è¿œç¨‹ä»“åº“è´¡çŒ®ä»£ç ï¼Œé¡¹ç›®ç»´æŠ¤è€…é€‰æ‹©æ€§åœ°æ¥æ”¶ä»»ä½•å¼€å‘è€…çš„æäº¤ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥é¿å…å¼€å‘è€…é¡¹ç›®è¿œç¨‹ä»“åº“çš„æƒé™,ä»è€Œæé«˜é¡¹ç›®è¿œç¨‹ä»“åº“çš„å®‰å…¨æ€§</span><br></pre></td></tr></table></figure></li>
<li><p>ç ”å‘æµç¨‹</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># éœ€æ±‚é˜¶æ®µ</span></span><br><span class="line"><span class="bullet">  1.</span> å¸‚åœºè°ƒç ” - PDM(Product Manager) äº§å“ç»ç†</span><br><span class="line"><span class="bullet">  2.</span> éœ€æ±‚åˆ†æ - PM(Project Manager) é¡¹ç›®ç»ç†</span><br><span class="line"><span class="bullet">  3.</span> éœ€æ±‚æ–‡æ¡£ - æœ€ç»ˆäº§ç‰©</span><br><span class="line"><span class="bullet">  4.</span> éœ€æ±‚è¯„å®¡</span><br><span class="line"></span><br><span class="line"><span class="section"># è®¾è®¡é˜¶æ®µ</span></span><br><span class="line"><span class="bullet">  1.</span> äº¤äº’è®¾è®¡ - UX(User Experience) äº¤äº’è®¾è®¡å¸ˆ</span><br><span class="line"><span class="bullet">  2.</span> è§†è§‰è®¾è®¡ - UI(User Interface) è§†è§‰è®¾è®¡å¸ˆ</span><br><span class="line"><span class="bullet">  3.</span> æŠ€æœ¯è®¾è®¡</span><br><span class="line"><span class="bullet">  4.</span> æŠ€æœ¯è¯„å®¡ - æœ€ç»ˆäº§ç‰©</span><br><span class="line"><span class="bullet">  5.</span> éœ€æ±‚æ’æœŸ</span><br><span class="line"></span><br><span class="line"><span class="section"># å¼€å‘é˜¶æ®µ</span></span><br><span class="line"><span class="bullet">  -</span> å¼€å‘ - Makefile - RD(Research and Development engineer) ç ”å‘å·¥ç¨‹å¸ˆ</span><br><span class="line"><span class="bullet">    1.</span> Git Flowå·¥ä½œæµ</span><br><span class="line"><span class="bullet">    2.</span> ç”Ÿæˆä»£ç  -- å°½å¯èƒ½è‡ªåŠ¨ç”Ÿæˆä»£ç </span><br><span class="line"><span class="bullet">    3.</span> ç‰ˆæƒæ£€æŸ¥</span><br><span class="line"><span class="bullet">    4.</span> é™æ€ä»£ç æ£€æŸ¥</span><br><span class="line"><span class="bullet">    5.</span> å•å…ƒæµ‹è¯•</span><br><span class="line"><span class="bullet">    6.</span> ç¼–è¯‘</span><br><span class="line"><span class="bullet">    7.</span> è‡ªæµ‹</span><br><span class="line"><span class="bullet">    8.</span> Code Review</span><br><span class="line"><span class="bullet">    9.</span> Merge</span><br><span class="line"><span class="bullet">  -</span> æ„å»º - CI/CD</span><br><span class="line"><span class="bullet">    1.</span> ä»£ç æ‰«æ</span><br><span class="line"><span class="bullet">    2.</span> å•å…ƒæµ‹è¯•</span><br><span class="line"><span class="bullet">    3.</span> ç¼–è¯‘æ‰“åŒ…</span><br><span class="line"><span class="bullet">    4.</span> å½’æ¡£[é•œåƒä»“åº“]</span><br><span class="line"></span><br><span class="line"><span class="section"># æµ‹è¯•é˜¶æ®µ</span></span><br><span class="line">  &gt; æµ‹è¯•é˜¶æ®µä¸ºäº†ä¸é˜»å¡æµ‹è¯•ï¼Œç¡®ä¿é¡¹ç›®æŒ‰æ—¶å‘å¸ƒï¼Œç ”å‘äººå‘˜åº”è¯¥ä¼˜å…ˆè§£å†³æµ‹è¯•åŒå­¦çš„Bug,è‡³å°‘æ˜¯é˜»å¡ç±»çš„Bug</span><br><span class="line"><span class="bullet">  1.</span> åŠŸèƒ½æµ‹è¯• - QA(Quality Assurance) è´¨é‡ç®¡ç†å·¥ç¨‹å¸ˆ</span><br><span class="line"><span class="bullet">  2.</span> æ€§èƒ½æµ‹è¯• - QE(Quality Engineering) è´¨é‡å·¥ç¨‹å¸ˆ</span><br><span class="line"><span class="bullet">  3.</span> é›†æˆæµ‹è¯•</span><br><span class="line"><span class="bullet">  4.</span> ç³»ç»Ÿæµ‹è¯•</span><br><span class="line"></span><br><span class="line"><span class="section"># å‘å¸ƒé˜¶æ®µ</span></span><br><span class="line"><span class="bullet">  -</span> ä»£ç å‘å¸ƒ</span><br><span class="line"><span class="bullet">    1.</span> åˆå¹¶åˆ°ä¸»å¹² - Masteråˆ†æ”¯</span><br><span class="line"><span class="bullet">    2.</span> ç”Ÿæˆç‰ˆæœ¬å·</span><br><span class="line"><span class="bullet">    3.</span> æ‰“æ ‡ç­¾</span><br><span class="line"><span class="bullet">    4.</span> ä»£ç æ‰«æ</span><br><span class="line"><span class="bullet">    5.</span> å•å…ƒæµ‹è¯•</span><br><span class="line"><span class="bullet">    6.</span> ç¼–è¯‘</span><br><span class="line"><span class="bullet">    7.</span> å‘å¸ƒæ„å»ºäº§ç‰©</span><br><span class="line"><span class="bullet">  -</span> å‘å¸ƒå®¡æ‰¹</span><br><span class="line"><span class="bullet">    1.</span> èµ„æºç”³è¯·</span><br><span class="line"><span class="bullet">    2.</span> åˆ›å»ºå‘å¸ƒè®¡åˆ’</span><br><span class="line"><span class="bullet">    3.</span> åˆ›å»ºå‘å¸ƒå•</span><br><span class="line"><span class="bullet">    4.</span> å‘å¸ƒå•å®¡æ‰¹</span><br><span class="line"><span class="bullet">  -</span> æœåŠ¡å‘å¸ƒ</span><br><span class="line"><span class="bullet">    1.</span> é¢„å‘éƒ¨ç½²</span><br><span class="line"><span class="bullet">    2.</span> é¢„å‘éªŒè¯</span><br><span class="line"><span class="bullet">    3.</span> ç°ç½‘éƒ¨ç½²</span><br><span class="line"><span class="bullet">    4.</span> ç°ç½‘éªŒè¯</span><br><span class="line"></span><br><span class="line"><span class="section"># è¿è¥é˜¶æ®µ</span></span><br><span class="line"><span class="bullet">  -</span> äº§å“è¿è¥</span><br><span class="line"><span class="bullet">    1.</span> æŠ€æœ¯æ²™é¾™</span><br><span class="line"><span class="bullet">    2.</span> æŠ€æœ¯æ¨æ–‡</span><br><span class="line"><span class="bullet">  -</span> è¿ç»´è¿è¥ - OP(Operation) è¿ç»´å·¥ç¨‹å¸ˆ</span><br><span class="line"><span class="bullet">    1.</span> è¿ç»´å·¥å…·</span><br><span class="line"><span class="bullet">    2.</span> æ—¥å¿—ç³»ç»Ÿ</span><br><span class="line"><span class="bullet">    3.</span> ç›‘æ§å‘Šè­¦</span><br></pre></td></tr></table></figure></li>
<li><p>åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># ç ”å‘æ¨¡å¼</span></span><br><span class="line"><span class="bullet">  -</span> ç€‘å¸ƒæ¨¡å¼</span><br><span class="line"><span class="bullet">    -</span> ä¼˜ç‚¹:</span><br><span class="line"><span class="bullet">      1.</span> ä¸¥æ ¼æŒ‰ç…§ç ”å‘é˜¶æ®µæ¨è¿›ç ”å‘è¿›åº¦ï¼Œæµç¨‹æ¸…æ™°ï¼Œé€‚åˆæŒ‰é¡¹ç›®äº¤ä»˜çš„åº”ç”¨</span><br><span class="line"><span class="bullet">    -</span> ç¼ºç‚¹:</span><br><span class="line"><span class="bullet">      1.</span> å˜æ›´å›°éš¾</span><br><span class="line"><span class="bullet">      2.</span> ç ”å‘å‘¨æœŸé•¿</span><br><span class="line"><span class="bullet">  -</span> è¿­ä»£æ¨¡å¼</span><br><span class="line"><span class="code">    &gt; ä¸è¦æ±‚æ¯ä¸ªé˜¶æ®µçš„ä»»åŠ¡åšåˆ°æœ€å®Œç¾ï¼Œè€Œæ˜¯å…ˆæŠŠä¸»è¦åŠŸèƒ½æ­å»ºèµ·æ¥ï¼Œç„¶åé€šè¿‡å®¢æˆ·çš„åé¦ˆä¿¡æ¯ä¸æ–­å®Œå–„</span></span><br><span class="line"><span class="code">  - æ•æ·æ¨¡å¼</span></span><br><span class="line"><span class="code">    &gt; æ•æ·æ¨¡å¼æŠŠä¸€ä¸ªå¤§çš„éœ€æ±‚åˆ†æˆå¤šä¸ªã€å¯åˆ†é˜¶æ®µå®Œæˆçš„å°è¿­ä»£ï¼Œæ¯ä¸ªè¿­ä»£äº¤ä»˜çš„éƒ½æ˜¯ä¸€ä¸ªå¯ä½¿ç”¨çš„è½¯ä»¶ï¼Œå¼€å‘è¿‡ç¨‹ä¸­ï¼Œè½¯ä»¶è¦ä¸€è‡´å¤„äºå¯ä½¿ç”¨çŠ¶æ€</span></span><br><span class="line"><span class="code">    - Scrumå¼€å‘æ¨¡å¼</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># CI/CD</span></span><br><span class="line">  CI: Continuous Integration, æŒç»­é›†æˆ</span><br><span class="line">  CD: Continous Delivery, æŒç»­äº¤ä»˜</span><br><span class="line">  CD: Continous Deployment, æŒç»­éƒ¨ç½²</span><br><span class="line"></span><br><span class="line"><span class="section"># DevOps: ç ”å‘è¿ç»´ä¸€ä½“åŒ–</span></span><br><span class="line"><span class="bullet">  -</span> AIOps: èŒèƒ½è¿ç»´</span><br><span class="line"><span class="bullet">  -</span> ChatOps: é€šè¿‡èŠå¤©çª—å£çš„æœºå™¨äººBotå‡ºå‘ä»»åŠ¡</span><br><span class="line"><span class="bullet">  -</span> GitOps:</span><br><span class="line"><span class="code">    &gt; å¼€å‘äººå‘˜å¼€å‘å®Œä»£ç åæ¨é€Gitä»“åº“ï¼Œè§¦å‘CIæµç¨‹ï¼ŒCIæµç¨‹é€šè¿‡ç¼–è¯‘æ„å»ºå‡ºDockeré•œåƒï¼Œå¹¶å°†é•œåƒpushåˆ°Dockeré•œåƒä»“åº“ï¼ŒPushåŠ¨ä½œè§¦å‘Pushäº‹ä»¶ï¼Œé€šè¿‡webhookå½¢å¼é€šçŸ¥Config UpdateræœåŠ¡ï¼ŒConfig UpdateræœåŠ¡ä»é•œåƒä»“åº“ä¸­ä¸‹è½½é•œåƒï¼Œå¹¶æ›´æ–°Gitä»“åº“ä¸­çš„kubernetes YAMLæ–‡ä»¶</span></span><br><span class="line"><span class="code">  - NoOps:</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="ä»‹ç»Webæ¡†æ¶"><a href="#ä»‹ç»Webæ¡†æ¶" class="headerlink" title="ä»‹ç»Webæ¡†æ¶"></a>ä»‹ç»Webæ¡†æ¶</h2><ul>
<li>Gin<blockquote>
<p>Goç¼–å†™çš„webæ¡†æ¶ï¼Œæ˜¯ä¸€ä¸ªç±»ä¼¼martiniæ€§èƒ½æ›´å¥½çš„APIæ¡†æ¶</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> Engine: åˆå§‹åŒ–ginå¯¹è±¡å®ä¾‹ï¼Œ</span><br><span class="line">  æ—¥å¿—</span><br><span class="line">  ä¸­é—´ä»¶</span><br><span class="line">  è·¯ç”±æ§åˆ¶</span><br><span class="line">  handlercontext</span><br><span class="line"><span class="bullet">2.</span> Router: å®šä¹‰å„ç§è·¯ç”±è§„åˆ™å’Œæ¡ä»¶</span><br><span class="line"><span class="bullet">3.</span> Context: å…è®¸åœ¨ä¸­é—´ä»¶ä¸­å…±äº«å˜é‡ï¼Œç®¡ç†æ•´ä¸ªæµç¨‹ï¼ŒéªŒè¯è¯·æ±‚çš„jsonä»¥åŠæä¾›</span><br><span class="line"><span class="bullet">4.</span> Bind:</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="ä»‹ç»å¾®æœåŠ¡æ¶æ„è®¾è®¡"><a href="#ä»‹ç»å¾®æœåŠ¡æ¶æ„è®¾è®¡" class="headerlink" title="ä»‹ç»å¾®æœåŠ¡æ¶æ„è®¾è®¡"></a>ä»‹ç»å¾®æœåŠ¡æ¶æ„è®¾è®¡</h2><ul>
<li><p>æœåŠ¡åŒ–åŸºç¡€è®¾æ–½æŠ€æœ¯é€‰å‹</p>
<ul>
<li>æœåŠ¡é—´é€šä¿¡ä¸­é—´ä»¶<ul>
<li>åŒæ­¥æ–¹å¼: RPC</li>
<li>å¼‚æ­¥æ–¹å¼: MQ</li>
</ul>
</li>
</ul>
</li>
<li><p>å®¢æˆ·ç«¯ä¸€è‡´æ€§</p>
<blockquote>
<p>å…±äº«ç›¸åŒconnectionå¯ä»¥åœ¨åŒä¸€ä¸ªäº‹åŠ¡é‡Œ</p>
</blockquote>
<figure class="highlight sas"><table><tr><td class="code"><pre><span class="line">1. begin tx å¼€å¯æœ¬åœ°äº‹åŠ¡</span><br><span class="line">2. <span class="meta">do</span> work æ‰§è¡Œä¸šåŠ¡æ“ä½œ</span><br><span class="line">3. <span class="meta">insert</span> <span class="meta">message</span> å‘åŒå®ä¾‹æ¶ˆæ¯åº“æ’å…¥æ¶ˆæ¯</span><br><span class="line">4. <span class="meta">end</span> tx äº‹åŠ¡æäº¤</span><br><span class="line">5. send <span class="meta">message</span> ç½‘ç»œå‘serverå‘é€æ¶ˆæ¯</span><br><span class="line">6. response server å›åº”æ¶ˆæ¯</span><br><span class="line">7. <span class="meta">delete</span> <span class="meta">message</span> å¦‚æœserverå›å¤æˆåŠŸåˆ™åˆ é™¤æ¶ˆæ¯</span><br><span class="line">8. scan <span class="meta">message</span> è¡¥å¿ä»»åŠ¡æ‰«ææœªå‘é€æ¶ˆæ¯</span><br><span class="line">9. send <span class="meta">message</span> è¡¥å¿ä»»åŠ¡è¡¥å¿æ¶ˆæ¯</span><br><span class="line">10. <span class="meta">delete</span> <span class="meta">message</span> è¡¥å¿ä»»åŠ¡åˆ é™¤è¡¥å¿æˆåŠŸçš„æ¶ˆæ¯</span><br></pre></td></tr></table></figure></li>
<li><p>æœåŠ¡ç«¯å­˜å‚¨æ¨¡å‹</p>
<figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"># Kafka RocketMQåŸºäºpartitionå­˜å‚¨æ¨¡å‹</span><br><span class="line"><span class="meta">&gt;</span> <span class="javascript">æ¯ä¸ªsubjectåˆ†ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªpartitionï¼Œè€ŒServeræ”¶åˆ°æ¶ˆæ¯åå°†å…¶åˆ†å‘åˆ°æŸä¸ªpartitionä¸Šï¼Œè€Œconcumeræ¶ˆè´¹çš„æ—¶å€™ä¸partitionå¯¹åº”ã€‚åˆç†çš„åˆ†é…ç­–ç•¥æ˜¯partitionä¸ªæ•°ä¸consumerä¸ªæ•°æˆå€æ•°å…³ç³».</span></span><br><span class="line"><span class="meta">&gt;</span> <span class="javascript">é™æ€ç»‘å®šå…³ç³»å¯¼è‡´consumeræ‰©å®¹ç¼©å®¹æ¯”è¾ƒéº»çƒ¦</span></span><br><span class="line"><span class="meta">&gt;</span> <span class="javascript">é¡ºåºappendæ–‡ä»¶ï¼Œæä¾›å¾ˆå¥½çš„æ€§èƒ½</span></span><br><span class="line"><span class="meta">&gt;</span> <span class="javascript">é¡ºåºæ¶ˆè´¹æ–‡ä»¶ï¼Œä½¿ç”¨offsetè¡¨ç¤ºæ¶ˆè´¹è¿›åº¦ï¼Œä¸ç»™ç»™ä¸ªæ¶ˆæ¯è®°å½•æ¶ˆè´¹çŠ¶æ€,æˆæœ¬æä½</span></span><br><span class="line"><span class="meta">&gt;</span> <span class="javascript">å°†æ‰€æœ‰subjectçš„æ¶ˆæ¯åˆå¹¶åœ¨ä¸€èµ·</span></span><br><span class="line"></span><br><span class="line"># ä¸šåŠ¡ä½¿ç”¨æ¶ˆæ¯ vs. æ•°æ®æµå¤„ç†åŒºåˆ«</span><br><span class="line">  &gt; æ•°æ®æµä¸­æ¶ˆæ¯ä¸»é¢˜å°‘ï¼Œæ¯ä¸ªæ¶ˆæ¯ä¸»é¢˜çš„ååé‡æå¤§</span><br><span class="line">  &gt; ä¸šåŠ¡ä¸­æ¶ˆæ¯ä¸»é¢˜æå¤šï¼Œå¾ˆå¤šä¸»é¢˜é‡çº§å¾ˆå°</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="è®¾è®¡åŸåˆ™"><a href="#è®¾è®¡åŸåˆ™" class="headerlink" title="è®¾è®¡åŸåˆ™"></a>è®¾è®¡åŸåˆ™</h2><ul>
<li>è®¡ç®—ä¸­æ‰€æœ‰æ–‡ä»¶éƒ½å¯ä»¥é€šè¿‡æ·»åŠ ä¸€ä¸ªä¸­é—´å±‚æ¥è§£å†³ï¼Œä¸€ä¸ªä¸­é—´å±‚è§£å†³ä¸äº†å°±æ·»åŠ ä¸¤ä¸ª</li>
</ul>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç§‘å­¦</category>
      </categories>
      <tags>
        <tag>å¾®æœåŠ¡</tag>
        <tag>DDD</tag>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>å·¥ç¨‹åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>Distributed ID Generator</title>
    <url>/2021/09/02/Distributed-ID-Generator/</url>
    <content><![CDATA[<blockquote>
<p>åˆ†å¸ƒå¼IDç”Ÿæˆå™¨</p>
</blockquote>
<span id="more"></span>

<h1 id="Distributed-ID-Generator"><a href="#Distributed-ID-Generator" class="headerlink" title="Distributed ID Generator"></a>Distributed ID Generator</h1><ul>
<li>UUID<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">  <span class="string">&quot;testing&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;github.com/google/uuid&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func BenchmarkUUID(t *testing.B) &#123;</span><br><span class="line">  for i := 0; i &lt; t.N; i++ &#123;</span><br><span class="line">    _ = uuid.New()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">~/Downloads/uuid_demo via ğŸ¹ v1.17 took 13s</span><br><span class="line">âœ go test -bench=.</span><br><span class="line"><span class="section">goos: darwin</span></span><br><span class="line"><span class="section">goarch: amd64</span></span><br><span class="line"><span class="section">pkg: uuid_demo</span></span><br><span class="line"><span class="section">cpu: Intel(R) Core(TM) i5-5257U CPU @ 2.70GHz</span></span><br><span class="line">BenchmarkUUID-4   	 1390710	       844.7 ns/op</span><br><span class="line">PASS</span><br><span class="line">ok  	uuid_demo	2.351s</span><br><span class="line"></span><br><span class="line"><span class="comment"># UUIDs are 128-bit hexadecimal numbers that are globally unique</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¼˜ç‚¹:</span></span><br><span class="line">  1. ç”Ÿæˆè¶³å¤Ÿç®€å•ï¼Œæœ¬åœ°ç”Ÿæˆæ— ç½‘ç»œæ¶ˆè€—ï¼Œå…·æœ‰å”¯ä¸€æ€§</span><br><span class="line"><span class="comment"># ç¼ºç‚¹:</span></span><br><span class="line">  1. æ— åºçš„å­—ç¬¦ä¸²ï¼Œä¸å…·å¤‡è¶‹åŠ¿è‡ªå¢ç‰¹æ€§</span><br><span class="line">  2. æ²¡æœ‰å…·ä½“çš„ä¸šåŠ¡å«ä¹‰</span><br><span class="line">  3. é•¿åº¦è¿‡é•¿16å­—èŠ‚128ä½,36ä½é•¿åº¦çš„å­—ç¬¦ä¸²,å­˜å‚¨ä»¥åŠæŸ¥è¯¢æ•°æ®åº“æ€§èƒ½æ¶ˆè€—è¾ƒå¤§,æ•°æ®åº“å»ºè®®ä¸»é”®å°½é‡è¶ŠçŸ­è¶Šå¥½ï¼Œä½œä¸ºæ•°æ®åº“ä¸»é”®UUIDçš„æ— åºæ€§ä¼šå¯¼è‡´æ•°æ®ä½ç½®é¢‘ç¹å˜åŠ¨ï¼Œä¸¥é‡å½±å“æ€§èƒ½</span><br></pre></td></tr></table></figure></li>
<li>åŸºäºæ•°æ®åº“è‡ªå¢ID<blockquote>
<p>åŸºäºæ•°æ®åº“çš„auto_incrementè‡ªå¢IDå®Œæˆå¯ä»¥å……å½“åˆ†å¸ƒå¼ID</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"># åˆ›å»ºæ•°æ®è¡¨</span><br><span class="line">mysql&gt; <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> SEQUENCE_ID (id <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> auto_increment, <span class="keyword">value</span> <span class="type">char</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span>, <span class="keyword">PRIMARY KEY</span> (id)) ENGINE=MyISAM;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected, <span class="number">1</span> <span class="built_in">warning</span> (<span class="number">0.08</span> sec)</span><br><span class="line"></span><br><span class="line"># MySQLä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æ’å…¥æ•°æ®</span><br><span class="line"><span class="keyword">delimiter</span> $$<span class="pgsql"></span></span><br><span class="line"><span class="pgsql"><span class="keyword">create</span> <span class="keyword">procedure</span> bench_insert(count <span class="type">int</span> unsigned)</span></span><br><span class="line"><span class="pgsql"><span class="keyword">BEGIN</span></span></span><br><span class="line"><span class="pgsql">  <span class="keyword">declare</span> num <span class="type">int</span> unsigned <span class="keyword">default</span> <span class="number">1</span>;</span></span><br><span class="line"><span class="pgsql">  <span class="keyword">declare</span> c <span class="type">char</span>(<span class="number">10</span>) <span class="keyword">default</span> repeat(<span class="string">&#x27;c&#x27;</span>,<span class="number">10</span>);</span></span><br><span class="line"><span class="pgsql">  <span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span></span><br><span class="line"><span class="pgsql">  <span class="keyword">while</span> num &lt;= count <span class="keyword">DO</span></span></span><br><span class="line"><span class="pgsql">    <span class="keyword">insert</span> <span class="keyword">into</span> SEQUENCE_ID(`<span class="keyword">value</span>`) <span class="keyword">values</span>(c);</span></span><br><span class="line"><span class="pgsql">    <span class="keyword">set</span> num=num+<span class="number">1</span>;</span></span><br><span class="line"><span class="pgsql">  <span class="keyword">end</span> <span class="keyword">while</span>;</span></span><br><span class="line"><span class="pgsql"><span class="keyword">COMMIT</span>;</span></span><br><span class="line"><span class="pgsql"><span class="keyword">END</span>$$</span> <span class="keyword">delimiter</span> ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> bench_insert(<span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">PROCEDURE</span> bench_insert;</span><br><span class="line"></span><br><span class="line"># å½“éœ€è¦IDçš„æ—¶å€™ï¼Œå‘è¡¨ä¸­æ’å…¥è®°å½•è¿”å›ä¸»é”®ID.</span><br><span class="line"></span><br><span class="line"># ä¼˜ç‚¹:</span><br><span class="line">  <span class="number">1.</span> å®ç°ç®€å•ã€IDå•è°ƒè‡ªå¢ã€æ•°å€¼ç±»å‹æŸ¥è¯¢é€Ÿåº¦å¿«</span><br><span class="line"></span><br><span class="line">ç¼ºç‚¹:</span><br><span class="line">  <span class="number">1.</span> DBå•ç‚¹å­˜åœ¨å®•æœºé£é™©ï¼Œæ— æ³•æ‰›ä½é«˜å¹¶å‘åœºæ™¯</span><br></pre></td></tr></table></figure></li>
<li>åŸºäºæ•°æ®åº“é›†ç¾¤æ¨¡å¼<blockquote>
<p>å¤šæ•°æ®åº“å®ä¾‹å•ç‹¬ç”Ÿäº§è‡ªå¢ID</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># è®¾ç½®å¯å§‹å€¼å’Œè‡ªå¢å¸ƒé•¿</span><br><span class="line">  DB1:</span><br><span class="line">    <span class="keyword">set</span> @<span class="variable">@auto</span>_increment_offset <span class="operator">=</span> <span class="number">1</span>; <span class="comment">-- èµ·å§‹å€¼</span></span><br><span class="line">    <span class="keyword">set</span> @<span class="variable">@auto</span>_increment_increment <span class="operator">=</span> <span class="number">2</span>; <span class="comment">-- æ­¥é•¿</span></span><br><span class="line">  DB2:</span><br><span class="line">    <span class="keyword">set</span> @<span class="variable">@auto</span>_increment_offset <span class="operator">=</span> <span class="number">2</span>; <span class="comment">-- èµ·å§‹å€¼</span></span><br><span class="line">    <span class="keyword">set</span> @<span class="variable">@auto</span>_increment_increment <span class="operator">=</span> <span class="number">2</span>; <span class="comment">-- æ­¥é•¿</span></span><br><span class="line"></span><br><span class="line"># ä¼˜ç‚¹:</span><br><span class="line">  è§£å†³DBå•ç‚¹é—®é¢˜</span><br><span class="line"></span><br><span class="line"># ç¼ºç‚¹:</span><br><span class="line">  ä¸åˆ©äºåç»­æ‰©å®¹ï¼Œè€Œä¸”å®é™…ä¸Šå•ä¸ªæ•°æ®åº“è‡ªèº«å‹åŠ›è¿˜æ˜¯å¾ˆå¤§ï¼Œä¾æ—§æ— æ³•æ»¡è¶³é«˜å¹¶å‘åœºæ™¯</span><br></pre></td></tr></table></figure></li>
<li>åŸºäºæ•°æ®åº“çš„å·æ®µæ¨¡å¼<blockquote>
<p>å·æ®µæ¨¡å¼æ˜¯åˆ†å¸ƒå¼IDç”Ÿæˆå™¨ä¸»æµå®ç°æ–¹å¼ä¹‹ä¸€ï¼Œæ‰¹é‡è·å–è‡ªå¢IDï¼Œæ¯æ¬¡ä»æ•°æ®åº“å–å‡ºä¸€ä¸ªå·æ®µèŒƒå›´ï¼Œå…·ä½“ä¸šåŠ¡æœåŠ¡å°†æœ¬å·æ®µç”Ÿæˆçš„è‡ªå¢IDåŠ è½½å†…å­˜</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">  mysql&gt; <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> id_generator (id <span class="type">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, max_id <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;å½“å‰æœ€å¤§id&#x27;</span>, step <span class="type">int</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;å·æ®µçš„å¸ƒé•¿&#x27;</span>, biz_type <span class="type">int</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;ä¸šåŠ¡ç±»å‹&#x27;</span>, <span class="keyword">version</span> <span class="type">int</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;ç‰ˆæœ¬å·&#x27;</span>, <span class="keyword">PRIMARY KEY</span>(`id`));</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected, <span class="number">5</span> warnings (<span class="number">0.11</span> sec)</span><br><span class="line"></span><br><span class="line">  mysql&gt; describe id_generator;</span><br><span class="line">  +<span class="comment">----------+--------+------+-----+---------+-------+</span></span><br><span class="line">  | Field    | <span class="keyword">Type</span>   | <span class="keyword">Null</span> | Key | <span class="keyword">Default</span> | Extra |</span><br><span class="line">  +<span class="comment">----------+--------+------+-----+---------+-------+</span></span><br><span class="line">  | id       | <span class="type">int</span>    | <span class="keyword">NO</span>   | PRI | <span class="keyword">NULL</span>    |       |</span><br><span class="line">  | max_id   | <span class="type">bigint</span> | <span class="keyword">NO</span>   |     | <span class="keyword">NULL</span>    |       |  <span class="comment">-- å½“å‰æœ€å¤§çš„å¯ç”¨id</span></span><br><span class="line">  | step     | <span class="type">int</span>    | <span class="keyword">NO</span>   |     | <span class="keyword">NULL</span>    |       |  <span class="comment">-- ä»£è¡¨å·æ®µçš„é•¿åº¦</span></span><br><span class="line">  | biz_type | <span class="type">int</span>    | <span class="keyword">NO</span>   |     | <span class="keyword">NULL</span>    |       |  <span class="comment">-- ä¸åŒä¸šåŠ¡ç±»å‹</span></span><br><span class="line">  | <span class="keyword">version</span>  | <span class="type">int</span>    | <span class="keyword">NO</span>   |     | <span class="keyword">NULL</span>    |       |  <span class="comment">-- ä¹è§‚é”ï¼Œæ¯æ¬¡éƒ½æ›´æ–°versionï¼Œä¿è¯å¹¶å‘æ—¶æ•°æ®çš„æ­£ç¡®æ€§</span></span><br><span class="line">  +<span class="comment">----------+--------+------+-----+---------+-------+</span></span><br><span class="line">  <span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.04</span> sec)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">update</span> id_generator <span class="keyword">set</span> max_id = #&#123;max_id+step&#125;, version = <span class="keyword">version</span> + <span class="number">1</span> <span class="keyword">where</span> version = # &#123;<span class="keyword">version</span>&#125; <span class="keyword">and</span> biz_type = XXX</span><br></pre></td></tr></table></figure></li>
<li>åŸºäºRedisæ¨¡å¼<blockquote>
<p>åˆ©ç”¨redis Incr åŸå­æ€§è‡ªå¢</p>
</blockquote>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  <span class="number">172.30.1.23</span>:<span class="number">6002</span>&gt; set seq_id <span class="number">1</span></span><br><span class="line">  OK</span><br><span class="line">  <span class="number">172.30.1.23</span>:<span class="number">6002</span>&gt; incr seq_id</span><br><span class="line">  (integer) <span class="number">2</span></span><br><span class="line">  <span class="number">172.30.1.23</span>:<span class="number">6002</span>&gt; get seq_id</span><br><span class="line">  &quot;<span class="number">2</span>&quot;</span><br><span class="line">  <span class="number">172.30.1.23</span>:<span class="number">6002</span>&gt;</span><br><span class="line"></span><br><span class="line"># Benchmark</span><br><span class="line">ubuntu in ~ at <span class="number">3</span>BPlus took <span class="number">4</span>s</span><br><span class="line">âœ redis-benchmark -n <span class="number">1000000</span> -t set,get,incr -P <span class="number">16</span> -q -h <span class="number">127.0.0.1</span> -p <span class="number">6001</span> --cluster</span><br><span class="line">Cluster has <span class="number">3</span> master nodes:</span><br><span class="line"></span><br><span class="line">Master <span class="number">0</span>: a733c21d3b735b9d026eb4d462ef6b367d8ebb<span class="number">98 172.30.1</span>.<span class="number">23</span>:<span class="number">6002</span></span><br><span class="line">Master <span class="number">1</span>: <span class="number">9</span>c35a4e211f6534861ed768dba592e<span class="number">85539b1377</span> <span class="number">172.30.1.23</span>:<span class="number">6003</span></span><br><span class="line">Master <span class="number">2</span>: a901e497cb72819cf0765e9e4eb16c36399c437b <span class="number">172.30.1.23</span>:<span class="number">6001</span></span><br><span class="line"></span><br><span class="line">SET: <span class="number">47001.32</span> requests per second, p<span class="number">50=15.199</span> msec</span><br><span class="line">GET: <span class="number">101936.80</span> requests per second, p<span class="number">50=5.679</span> msec</span><br><span class="line">INCR: <span class="number">46496.49</span> requests per second, p<span class="number">50=13.879</span> msec   -- å¹¶å‘<span class="number">5</span>ä¸‡/s</span><br></pre></td></tr></table></figure></li>
<li>twitter snowflake<blockquote>
<p>é›ªèŠ±ç®—æ³• (Snowflake) Twitterå†…éƒ¨åˆ†å¸ƒå¼é‡‡ç”¨çš„IDç”Ÿæˆç®—æ³•</p>
</blockquote>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="section"># The default Twitter format shown below.</span></span><br><span class="line"><span class="section">+--------------------------------------------------------------------------+</span></span><br><span class="line"><span class="section">| 1 Bit Unused | 41 Bit Timestamp |  10 Bit NodeID  |   12 Bit Sequence ID |</span></span><br><span class="line"><span class="section">+--------------------------------------------------------------------------+</span></span><br><span class="line"></span><br><span class="line">41 bits: store a timestamp with millisecond precision</span><br><span class="line">10 bits: store a node id - a range from 0 through 1023</span><br><span class="line">12 bits: store a sequence number - a range from 0 through 4095</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>ID Generator</tag>
      </tags>
  </entry>
  <entry>
    <title>Kafka Tips &amp; Tracks</title>
    <url>/2021/09/02/Kafka-Tips-Tracks/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>MySQL Tips &amp; Tracks</title>
    <url>/2021/09/02/MySQL-Tips-Tracks/</url>
    <content><![CDATA[<h1 id="æ•°æ®åº“-ä¸‰å¤§èŒƒå¼"><a href="#æ•°æ®åº“-ä¸‰å¤§èŒƒå¼" class="headerlink" title="æ•°æ®åº“-ä¸‰å¤§èŒƒå¼"></a>æ•°æ®åº“-ä¸‰å¤§èŒƒå¼</h1><ul>
<li>åŸå­æ€§: å­—æ®µä¸å¯åˆ†</li>
<li>å”¯ä¸€æ€§: æœ‰ä¸»é”®(æ²¡æœ‰ä¸»é”®å°±æ²¡æœ‰å”¯ä¸€æ€§)ï¼Œéä¸»é”®å­—æ®µä¾èµ–ä¸»é”®</li>
<li>æ¶ˆé™¤å†—ä½™: æ¯åˆ—éƒ½ä¸ä¸»é”®æœ‰ç›´æ¥å…³ç³», éä¸»é”®å­—æ®µä¸èƒ½ç›¸äº’ä¾èµ–</li>
</ul>
<span id="more"></span>

<h2 id="MySQLäº‹åŠ¡æ¨¡å‹-ACID"><a href="#MySQLäº‹åŠ¡æ¨¡å‹-ACID" class="headerlink" title="MySQLäº‹åŠ¡æ¨¡å‹ ACID"></a>MySQLäº‹åŠ¡æ¨¡å‹ ACID</h2><blockquote>
<p>MySQLäº‹åŠ¡çš„å››ä¸ªç‰¹æ€§ä¸­ACDä¸‰ä¸ªç‰¹æ€§æ˜¯é€šè¿‡Redo Log(é‡åšæ—¥å¿—)å’ŒUndo Log(æ’¤é”€æ—¥å¿—)å®ç°,è€ŒIéš”ç¦»å‹é€šè¿‡Lockå®ç°</p>
</blockquote>
<ul>
<li><p>äº‹åŠ¡æ˜¯å¯ä»¥æäº¤æˆ–å›æ»šçš„åŸå­å·¥ä½œå•å…ƒ</p>
</li>
<li><p>ACIDæ¨¡å‹æ˜¯ä¸€ç»„æ•°æ®åº“è®¾è®¡åŸåˆ™</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">A:</span> atomicityåŸå­æ€§: äº‹åŠ¡ä¸­ä¸€ç³»åˆ—çš„æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨éƒ½æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨éƒ½ä¸æ‰§è¡Œ</span><br><span class="line"><span class="symbol">C:</span> consistencyä¸€è‡´æ€§(é€šè¿‡AIDä¿è¯): æ•°æ®åº“äº‹åŠ¡ä¸èƒ½ç ´åå…³ç³»æ•°æ®çš„å®Œæ•´æ€§ä»¥åŠä¸šåŠ¡é€»è¾‘ä¸Šçš„ä¸€è‡´æ€§</span><br><span class="line"><span class="symbol">I:</span> isolation éš”ç¦»æ€§(äº‹åŠ¡çš„éš”ç¦»çº§åˆ«): å¹¶å‘ç¯å¢ƒä¸‹ï¼Œä¸åŒäº‹åŠ¡åŒæ—¶æ“ä½œç›¸åŒçš„æ•°æ®ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰å„è‡ªçš„å®Œæˆæ•°æ®ç©ºé—´</span><br><span class="line"><span class="symbol">D:</span> durabilityæŒä¹…æ€§: åªè¦äº‹åŠ¡æˆåŠŸç»“æŸï¼Œå¯¹æ•°æ®åº“æ‰€åšçš„æ›´æ–°å°±æ°¸ä¹…ä¿å­˜ä¸‹æ¥ï¼Œå³ä½¿å‘ç”Ÿç³»ç»Ÿå´©æºƒï¼Œé‡æ–°å¯åŠ¨æ•°æ®åº“ï¼Œæ•°æ®åº“è¿˜èƒ½æ¢å¤åˆ°äº‹åŠ¡æˆåŠŸç»“æŸæ—¶çš„çŠ¶æ€</span><br></pre></td></tr></table></figure></li>
<li><p>InnoDB å­˜å‚¨å¼•æ“æ¶æ„<br><img src="/misc/images/InnoDB-architecture.jpeg" alt="InnoDB Architecture"></p>
</li>
<li><p>å¹¶å‘é—®é¢˜</p>
<ul>
<li>è„è¯»: Drity Read: è¯»å–åˆ°æœªæäº¤çš„æ•°æ®</li>
<li>ä¸å¯é‡å¤è¯»: Non-repeatable read: ä¸¤æ¬¡è¯»å–ç»“æœä¸åŒ</li>
<li>å¹»è¯» Phantom Read: selectæ“ä½œå¾—åˆ°çš„ç»“æœæ‰€è¡¨è¯çš„æ•°æ®çŠ¶æ€æ— æ³•æ”¯æ’‘åç»­çš„ä¸šåŠ¡æ“ä½œ</li>
</ul>
</li>
<li><p>InnoDB å››ç§éš”ç¦»çº§åˆ«</p>
<ul>
<li>READ UNCOMMITED è¯»æœªæäº¤ â€“&gt; è„è¯»</li>
<li>READ COMMITTED è¯»å·²æäº¤ â€“&gt;  ä¸å¯é‡å¤è¯»</li>
<li>REPEATABLE READ å¯é‡å¤è¯» â€“&gt; å¹»è¯»</li>
<li>SERIALIZABLE ä¸²è¡ŒåŒ–</li>
</ul>
</li>
</ul>
<h2 id="æ•°æ®åº“æ—¥å¿—"><a href="#æ•°æ®åº“æ—¥å¿—" class="headerlink" title="æ•°æ®åº“æ—¥å¿—"></a>æ•°æ®åº“æ—¥å¿—</h2><ul>
<li><p>WAL - Write Ahead Log</p>
<blockquote>
<p>å®é™…å†™æ•°æ®å‰ï¼Œå…ˆæŠŠä¿®æ”¹çš„æ•°æ®è®°åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿æ•…éšœæ—¶è¿›è¡Œä¿®å¤</p>
</blockquote>
</li>
<li><p>é‡åšæ—¥å¿— - redo log</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> è®°å½•ä¿®æ”¹åçš„æ•°æ®</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> ç”¨äºå¼‚å¸¸æ¢å¤</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> å¾ªç¯å†™æ–‡ä»¶</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt; write Pos: å†™å…¥ä½ç½®</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt; Check Point: åˆ·ç›˜ä½ç½®</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt; Check Point -&gt; Write Pos: å¾…è½ç›˜</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt; innodb_flush_log_at_trx_commit: åˆ·ç›˜æ—¶æœº</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; 0 commit æ¯ç§’å†™æ–‡ä»¶,å¹¶åˆ·ç›˜</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; 1 commit æ¯æ¬¡æäº¤æ—¶å†™æ–‡ä»¶ï¼Œ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> MySQL redo-log:</span></span><br><span class="line">  1. ä½“ç§¯å°ï¼Œè®°å½•é¡µçš„ä¿®æ”¹ï¼Œæ¯”å†™å…¥é¡µä»£ä»·ä½</span><br><span class="line">  2. æœ«å°¾è¿½åŠ ï¼Œéšæœºå†™å˜é¡ºåºå†™ï¼Œå‘ç”Ÿæ”¹å˜çš„é¡µä¸å›ºå®š</span><br></pre></td></tr></table></figure></li>
<li><p>å›æ»šæ—¥å¿— - Undo Log</p>
<blockquote>
<p>å›æ»šæ—¥å¿—è®°å½•çš„é›†åˆï¼ŒåŒ…å«å¦‚ä½•æ’¤é”€äº‹åŠ¡å¯¹èšé›†ç´¢å¼•è®°å½•çš„æœ€æ–°æ›´æ–°çš„ä¿¡æ¯</p>
</blockquote>
<ul>
<li><p>ä¿è¯äº‹åŠ¡åŸå­æ€§</p>
</li>
<li><p>å®ç°æ•°æ®å¤šç‰ˆæœ¬</p>
</li>
<li><p>delete undo log: ç”¨äºå›æ»šï¼Œæäº¤å³æ¸…ç†</p>
</li>
<li><p>update undo log:</p>
</li>
<li><p>undo logå¦‚ä½•æ¸…ç†:</p>
<ul>
<li>ä¾æ®ç³»ç»Ÿæ´»è·ƒçš„æœ€å°æ´»è·ƒäº‹åŠ¡ID Read view</li>
</ul>
</li>
<li><h2 id="ä¸ºä»€ä¹ˆInnoDB-count-è¿™ä¹ˆæ…¢"><a href="#ä¸ºä»€ä¹ˆInnoDB-count-è¿™ä¹ˆæ…¢" class="headerlink" title="ä¸ºä»€ä¹ˆInnoDB count(*) è¿™ä¹ˆæ…¢?"></a>ä¸ºä»€ä¹ˆInnoDB count(*) è¿™ä¹ˆæ…¢?</h2></li>
</ul>
</li>
</ul>
<h2 id="MySQlå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶-MVCC"><a href="#MySQlå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶-MVCC" class="headerlink" title="MySQlå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ - MVCC"></a>MySQlå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ - MVCC</h2><blockquote>
<p>ä½¿å¾—InnoDBçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹æ‰§è¡Œä¸€è‡´æ€§è¯»æ“ä½œæœ‰ä¿è¯, æŸ¥è¯¢ä¸€ä¸ªè¢«å¦ä¸€ä¸ªäº‹åŠ¡æ›´æ–°çš„è¡Œï¼Œå¯ä»¥çœ‹åˆ°è¢«æ›´æ–°ä¹‹å‰çš„å€¼<br>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œè§£å†³è¯»å†™å†²çªé—®é¢˜</p>
</blockquote>
<ul>
<li>InnoDB MVCCå®ç°<ul>
<li>å½“å‰è¯» â€“ Select for update</li>
<li>å¿«ç…§è¯» â€“ Select Current_TRX_ID</li>
<li>å¯è§æ€§åˆ¤æ–­<ul>
<li>åˆ›å»ºå¿«ç…§è¿™ä¸€åˆ»ï¼Œè¿˜æœªæäº¤çš„äº‹åŠ¡ï¼Œåœ¨æ­¤ç”Ÿå‘½å‘¨æœŸä¸­æ— æ³•è¯»å–</li>
<li>åˆ›å»ºå¿«ç…§ä¹‹ååˆ›å»ºçš„äº‹åŠ¡æ— æ³•è¯»å–</li>
</ul>
</li>
<li>Read View<ul>
<li>å¿«ç…§è¯» æ´»è·ƒäº‹åŠ¡åˆ—è¡¨</li>
<li>æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ä¸­æœ€å°äº‹åŠ¡ID</li>
<li>æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ä¸­æœ€å¤§äº‹åŠ¡ID<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">InnoDB</span>å‘æ•°æ®åº“ä¸­å­˜å‚¨çš„æ¯ä¸€è¡Œæ•°æ®æ·»åŠ ä¸‰ä¸ªå­—æ®µéšè—å­—æ®µ</span><br><span class="line"><span class="attribute">1</span>. DB_TRX_ID: <span class="number">6</span>å­—èŠ‚ è¡¨ç¤ºæ’å…¥æˆ–æ›´æ–°æœ€åä¸€ä¸ªäº‹åŠ¡çš„äº‹åŠ¡æ ‡è¯†ç¬¦ å…¨å±€é€’å¢</span><br><span class="line"><span class="attribute">2</span>. DB_ROLL_PTR: <span class="number">7</span>å­—èŠ‚ å›æ»šæŒ‡é’ˆ roll pointer, æŒ‡å‘å†™å…¥å›æ»šæ®µæ’¤é”€æ—¥å¿—Undo Log</span><br><span class="line"><span class="attribute">3</span>. DB_ROW_ID: <span class="number">6</span>å­—èŠ‚ éšç€æ–°è¡Œæ’å…¥è€Œå•è°ƒå¢åŠ çš„è¡ŒID</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>  <img src="/misc/images/mvcc.jpeg" alt="mvcc"></p>
<ul>
<li>InnoDB Locking<ul>
<li>Shared and Exclusive Locks - å…±äº«é”å’Œæ’ä»–é”<ul>
<li>A Shared Lock å…è®¸æŒæœ‰é”çš„äº‹åŠ¡è¯»å–è¯¥è¡Œ</li>
<li>An Exclusive Lock å…è®¸æŒæœ‰é”çš„äº‹åŠ¡æ›´æ–°å’Œåˆ é™¤è¯¥è¡Œ<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">å‡è®¾äº‹åŠ¡T1å¯¹æ•°æ®è¡ŒræŒæœ‰å…±äº«é”(Shared <span class="keyword">Lock</span>),å¦ä¸€ä¸ªäº‹åŠ¡T2å¯¹åŒä¸€æ•°æ®è¡Œrçš„æ“ä½œåˆ†ä¸‹é¢ä¸¤ç§æƒ…å†µ:</span><br><span class="line">  <span class="number">1.</span> T2å¯¹æ•°æ®è¡Œrä»…ä»…æ˜¯è¯»å–è¯·æ±‚æŒæœ‰(Shared <span class="keyword">Lock</span>)æˆåŠŸï¼Œç»“æœæ˜¯T1å’ŒT2å¯¹æ•°æ®è¡Œréƒ½æŒæœ‰å…±äº«é”</span><br><span class="line">  <span class="number">2.</span> T2å¯¹æ•°æ®è¡Œäººéœ€è¦<span class="keyword">Update</span>è¯·æ±‚æŒæœ‰(<span class="keyword">Exclusive</span> <span class="keyword">Lock</span>)ä¼šå¤±è´¥</span><br><span class="line"></span><br><span class="line">å‡è®¾äº‹åŠ¡T1å¯¹æ•°æ®è¡ŒræŒæœ‰æ’ä»–é”(<span class="keyword">exclusive</span> <span class="keyword">lock</span>),å¦ä¸€ä¸ªäº‹åŠ¡T2å¯¹åŒä¸€æ•°æ®è¡Œrçš„é”è¯·æ±‚(å…±äº«é”/æ’ä»–é”)éƒ½ä¼šå¤±è´¥,äº‹åŠ¡T2ä¸å¾—ä¸ç­‰å¾…äº‹åŠ¡T1é‡Šæ”¾é”</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="MySQL-å­˜å‚¨å¼•æ“"><a href="#MySQL-å­˜å‚¨å¼•æ“" class="headerlink" title="MySQL å­˜å‚¨å¼•æ“"></a>MySQL å­˜å‚¨å¼•æ“</h2><ul>
<li><p>Page</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">&gt; é¡µPage : 16KB, å­˜å‚¨IOçš„åŸºæœ¬å•å…ƒ</span><br><span class="line">Page Header: é¡µå¤´, è®°å½•é¡µé¢çš„æ§åˆ¶ä¿¡æ¯ï¼Œå ç”¨56å­—èŠ‚ï¼ŒåŒ…æ‹¬é¡µçš„å·¦å³å…„å¼Ÿé¡µé¢æŒ‡é’ˆï¼Œé¡µé¢ç©ºé—´ä½¿ç”¨æƒ…å†µ</span><br><span class="line"><span class="section">è™šè®°å½•:</span></span><br><span class="line">  æœ€å¤§è™šè®°å½•,æ¯”é¡µå†…æœ€å¤§ä¸»é”®å¤§</span><br><span class="line">  æœ€å°è™šè®°å½•,æ¯”é¡µå†…æœ€å°ä¸»é”®å°</span><br><span class="line"><span class="section">è®°å½•å †: è¡Œè®°å½•å­˜å‚¨åŒº</span></span><br><span class="line">  æœ‰æ•ˆè®°å½•</span><br><span class="line">  å·²åˆ é™¤è®°å½•</span><br><span class="line"><span class="section">è‡ªç”±ç©ºé—´é“¾è¡¨: å·²åˆ é™¤è®°å½•ç»„æˆçš„é“¾è¡¨</span></span><br><span class="line"><span class="section">æœªåˆ†é…ç©ºé—´: é¡µå†…æœªä½¿ç”¨çš„å­˜å‚¨ç©ºé—´</span></span><br><span class="line">Slot åŒº: è¿ç»­ç©ºé—´å¹³å‡åˆ†é…</span><br><span class="line">Page Tailer: é¡µå°¾, å 8å­—èŠ‚ï¼Œå­˜å‚¨é¡µé¢çš„æ ¡éªŒä¿¡æ¯</span><br></pre></td></tr></table></figure></li>
<li><p>ç´¢å¼•B+æ ‘</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># é¡ºåºä¿è¯</span></span><br><span class="line"><span class="bullet">  -</span> ç‰©ç†æœ‰åº: æ•°ç»„ï¼ŒäºŒåˆ†æŸ¥æ‰¾, æ”¯æŒéšæœºè¯»,</span><br><span class="line"><span class="bullet">  -</span> é€»è¾‘æœ‰åº: é“¾è¡¨, æ”¯æŒéšæœºå†™,</span><br><span class="line"><span class="section"># æ’å…¥ç­–ç•¥</span></span><br><span class="line"><span class="bullet">  -</span> è‡ªç”±ç©ºé—´é“¾è¡¨</span><br><span class="line"><span class="bullet">  -</span> æœªä½¿ç”¨ç©ºé—´</span><br><span class="line"><span class="bullet">  -</span> æ”¶ç¼©æ•°æ®åº“,è§£å†³æ•°æ®åº“pageç¢ç‰‡</span><br><span class="line"><span class="section"># é¡µå†…æŸ¥è¯¢</span></span><br><span class="line"><span class="bullet">  -</span> éå†</span><br><span class="line"><span class="bullet">  -</span> äºŒåˆ†æŸ¥æ‰¾</span><br><span class="line"><span class="bullet">  -</span> skip list</span><br></pre></td></tr></table></figure></li>
<li><p>InnoDBå†…å­˜ç®¡ç†</p>
<figure class="highlight haml"><table><tr><td class="code"><pre><span class="line">-<span class="ruby"> é¢„åˆ†é…å†…å­˜ç©ºé—´:</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> Buffer Pool(é¢„åˆ†é…å†…å­˜æ± )<span class="symbol">:</span>é¡µé¢åŠ è½½å•ä½Page</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> <span class="symbol">Page:</span> Buffer Pool çš„æœ€å°å•ä½</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> Free <span class="symbol">List:</span> ç©ºé—²Pageç»„æˆçš„é“¾è¡¨</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> Flush <span class="symbol">List:</span> è„é¡µåˆ—è¡¨</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> Page Hashè¡¨: ç»´æŠ¤å†…å­˜Pageå’Œæ–‡ä»¶Pageçš„æ˜ å°„å…³ç³»</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> <span class="symbol">LRU:</span> å†…å­˜æ·˜æ±°ç®—æ³•- é‡Šæ”¾åˆ·ç›˜</span></span><br><span class="line"><span class="ruby"></span>      LRU_new: å­˜å‚¨çƒ­æ•°æ®</span><br><span class="line">      LRU_old: å­˜å‚¨å†·æ•°æ®</span><br><span class="line">      Midpoint:</span><br><span class="line">-<span class="ruby"> æ•°æ®é¡µé¢åŠ è½½å•å…ƒ:</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> ç£ç›˜æ•°æ®åˆ°å†…å­˜</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby"> æ•°æ®å†…å¤–å­˜äº¤æ¢:</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby"> å†…å­˜ç®¡ç†çš„æŠ€æœ¯ç‚¹:</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> å†…å­˜æ± </span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> å†…å­˜é¡µé¢ç®¡ç†</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> ç©ºé—²é¡µ</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> æ•°æ®é¡µ</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> è„é¡µ: æ•°æ®è¢«Update éœ€è¦åˆ·ç›˜</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> é¡µé¢æ˜ å°„</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> é¡µé¢æ•°æ®ç®¡ç†</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> æ•°æ®æ·˜æ±°:</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> <span class="symbol">LRU:</span> æœ€ç»å¸¸è¢«è®¿é—®çš„æ•°æ®æ”¾åœ¨è¡¨å¤´ï¼Œé»˜è®¤åˆ é™¤è¡¨å°¾</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> <span class="symbol">LFU:</span> ä½¿ç”¨é¢‘ç‡æ·˜æ±°ç®—æ³•, Redis ä½¿ç”¨ä½¿ç”¨LFUæ·˜æ±°ç®—æ³•</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> åŒ<span class="symbol">LRU:</span> çƒ­è¡¨LRUï¼Œå†·è¡¨LRU</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> å…¨è¡¨æ‰«æå¯¹å†…å­˜çš„å½±å“?</span></span><br><span class="line"><span class="ruby"></span>      &gt; å¯¼è‡´çƒ­æ•°æ®è¢«æ›¿æ¢, ç¼“å†²åŒºè¢«æ±¡æŸ“ï¼Œå¯¼è‡´æ•°æ®åº“æ€§èƒ½ä¸‹é™</span><br><span class="line">    -<span class="ruby"> é¿å…å…¨è¡¨æ‰«æå¯¹çƒ­æ•°æ®çš„å½±å“</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="MySQL-é”å®ç°åŸç†"><a href="#MySQL-é”å®ç°åŸç†" class="headerlink" title="MySQL é”å®ç°åŸç†"></a>MySQL é”å®ç°åŸç†</h2><ul>
<li><p>é”é¢—ç²’åº¦</p>
<ul>
<li>è¡Œçº§é”<ul>
<li>ä½œç”¨åœ¨ç´¢å¼•(èšç°‡ç´¢å¼•ã€äºŒçº§ç´¢å¼•)è¡Œ</li>
<li>æ˜¯å¦æ˜¯å”¯ä¸€ç´¢å¼•</li>
</ul>
</li>
<li>é—´éš™é”<ul>
<li>è§£å†³å¯é‡å¤è¯»æ¨¡å¼ä¸‹çš„å¹»è¯»é—®é¢˜</li>
<li>GAPé”ä¸æ˜¯åŠ è½½è®°å½•ä¸Š</li>
<li>GAPé”é”ä½çš„ä½ç½®æ˜¯ä¸¤æ¡è®°å½•ä¹‹é—´çš„GAP</li>
<li>ä¿è¯ä¸¤æ¬¡å½“å‰è¯»è¿”å›ä¸€è‡´çš„è®°å½•</li>
</ul>
</li>
<li>è¡¨çº§é”<ul>
<li>lock tables</li>
<li>å…ƒæ•°æ®é”(meta data lock, MDL)</li>
<li>å…¨è¡¨æ‰«æâ€è¡¨é”â€</li>
</ul>
</li>
</ul>
</li>
<li><p>ç±»å‹</p>
<ul>
<li>å…±äº«é”S<ul>
<li>è¯»é”ï¼Œå¯ä»¥åŒæ—¶è¢«å¤šä¸ªäº‹åŠ¡è·å–ï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡å¯¹è®°å½•çš„ä¿®æ”¹</li>
</ul>
</li>
<li>æ’ä»–é”X<ul>
<li>å†™é”</li>
</ul>
</li>
</ul>
</li>
<li><h2 id="æ‰€æœ‰å½“å‰è¯»åŠ æ’ä»–é”"><a href="#æ‰€æœ‰å½“å‰è¯»åŠ æ’ä»–é”" class="headerlink" title="æ‰€æœ‰å½“å‰è¯»åŠ æ’ä»–é”:"></a>æ‰€æœ‰å½“å‰è¯»åŠ æ’ä»–é”:</h2></li>
</ul>
<h2 id="æ•°æ®åº“ç´¢å¼•"><a href="#æ•°æ®åº“ç´¢å¼•" class="headerlink" title="æ•°æ®åº“ç´¢å¼•"></a>æ•°æ®åº“ç´¢å¼•</h2><ul>
<li><p>in, not in, exists, not exists</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">âœ mysql -h 127.0.0.1 -u chyi -P 13306 -p</span><br><span class="line">Enter password:</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 223</span><br><span class="line">Server version: 8.0.26-0ubuntu0.20.04.2 (Ubuntu)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2021, Oracle and/or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="emphasis">&#x27;help;&#x27;</span> or <span class="emphasis">&#x27;\h&#x27;</span> for help. Type <span class="emphasis">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; use develop;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; DROP TABLE IF EXISTS <span class="code">`t1`</span>;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE TABLE <span class="code">`t1`</span> (<span class="code">`id`</span> int(11) NOT NULL AUTO_INCREMENT, <span class="code">`name`</span> varchar(255) DEFAULT NULL, <span class="code">`addreee`</span> varchar(255) DEFAULT NULL, PRIMARY KEY(<span class="code">`id`</span>)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.06 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT INTO <span class="string">`t1` VALUES (&#x27;</span>1001&#x27;, <span class="emphasis">&#x27;å¼ ä¸‰&#x27;</span>, <span class="emphasis">&#x27;åŒ—äº¬&#x27;</span>), (<span class="emphasis">&#x27;1002&#x27;</span>, <span class="emphasis">&#x27;æå››&#x27;</span>, <span class="emphasis">&#x27;å¤©æ´¥&#x27;</span>), (<span class="emphasis">&#x27;1003&#x27;</span>, <span class="emphasis">&#x27;ç‹äº”&#x27;</span>, <span class="emphasis">&#x27;åŒ—äº¬&#x27;</span>), (<span class="emphasis">&#x27;1004&#x27;</span>, <span class="emphasis">&#x27;èµµå…­&#x27;</span>, <span class="emphasis">&#x27;æ²³åŒ—&#x27;</span>), (<span class="emphasis">&#x27;1005&#x27;</span>, <span class="emphasis">&#x27;æ°å…‹&#x27;</span>, <span class="emphasis">&#x27;æ²³å—&#x27;</span>), (<span class="emphasis">&#x27;1006&#x27;</span>, <span class="emphasis">&#x27;æ±¤å§†&#x27;</span>, <span class="emphasis">&#x27;æ²³å—&#x27;</span>), (<span class="emphasis">&#x27;1007&#x27;</span>, <span class="emphasis">&#x27;è´å°”&#x27;</span>, <span class="emphasis">&#x27;ä¸Šæµ·&#x27;</span>), (<span class="emphasis">&#x27;1008&#x27;</span>, <span class="emphasis">&#x27;å­™çª&#x27;</span>, <span class="emphasis">&#x27;åŒ—äº¬&#x27;</span>);</span><br><span class="line">Query OK, 8 rows affected (0.04 sec)</span><br><span class="line">Records: 8  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line"><span class="section">mysql&gt; select * from t1;</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line"><span class="section">| id   | name   | addreee |</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line">| 1001 | å¼ ä¸‰   | åŒ—äº¬    |</span><br><span class="line">| 1002 | æå››   | å¤©æ´¥    |</span><br><span class="line">| 1003 | ç‹äº”   | åŒ—äº¬    |</span><br><span class="line">| 1004 | èµµå…­   | æ²³åŒ—    |</span><br><span class="line">| 1005 | æ°å…‹   | æ²³å—    |</span><br><span class="line">| 1006 | æ±¤å§†   | æ²³å—    |</span><br><span class="line">| 1007 | è´å°”   | ä¸Šæµ·    |</span><br><span class="line"><span class="section">| 1008 | å­™çª   | åŒ—äº¬    |</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line">8 rows in set (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; DROP TABLE IF EXISTS <span class="code">`t2`</span>;</span><br><span class="line">Query OK, 0 rows affected (0.05 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE TABLE <span class="code">`t2`</span> (<span class="code">`id`</span> int(11) NOT NULL AUTO_INCREMENT, <span class="code">`name`</span> varchar(255), <span class="code">`address`</span> varchar(255), PRIMARY KEY(<span class="code">`id`</span>)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.06 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT INTO <span class="string">`t2` VALUES (1001, &#x27;</span>å¼ ä¸‰<span class="emphasis">&#x27;, &#x27;</span>åŒ—äº¬<span class="emphasis">&#x27;);</span></span><br><span class="line"><span class="emphasis">Query OK, 1 row affected (0.04 sec)</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"></span>mysql&gt; INSERT INTO <span class="string">`t2` VALUES (1004, &#x27;</span>èµµå…­<span class="emphasis">&#x27;, &#x27;</span>æ²³åŒ—<span class="emphasis">&#x27;);</span></span><br><span class="line"><span class="emphasis">Query OK, 1 row affected (0.05 sec)</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"></span>mysql&gt; INSERT INTO <span class="string">`t2` VALUES (1005, &#x27;</span>æ°å…‹<span class="emphasis">&#x27;, &#x27;</span>æ²³å—<span class="emphasis">&#x27;);</span></span><br><span class="line"><span class="emphasis">Query OK, 1 row affected (0.04 sec)</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"></span>mysql&gt; INSERT INTO <span class="string">`t2` VALUES (1007, &#x27;</span>è´å°”<span class="emphasis">&#x27;, &#x27;</span>ä¸Šæµ·<span class="emphasis">&#x27;);</span></span><br><span class="line"><span class="emphasis">Query OK, 1 row affected (0.03 sec)</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"></span>mysql&gt; INSERT INTO <span class="string">`t2` VALUES (1008, &#x27;</span>å­™çª<span class="emphasis">&#x27;, &#x27;</span>åŒ—äº¬<span class="emphasis">&#x27;);</span></span><br><span class="line"><span class="emphasis">Query OK, 1 row affected (0.04 sec)</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"></span>mysql&gt; INSERT INTO <span class="string">`t2` VALUES (1009, &#x27;</span>æ›¹æ“<span class="emphasis">&#x27;, &#x27;</span>é­å›½<span class="emphasis">&#x27;);</span></span><br><span class="line"><span class="emphasis">Query OK, 1 row affected (0.04 sec)</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"></span>mysql&gt; INSERT INTO <span class="string">`t2` VALUES (1010, &#x27;</span>åˆ˜å¤‡<span class="emphasis">&#x27;, &#x27;</span>èœ€å›½<span class="emphasis">&#x27;);</span></span><br><span class="line"><span class="emphasis">Query OK, 1 row affected (0.04 sec)</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"></span>mysql&gt; INSERT INTO <span class="string">`t2` VALUES (1011, &#x27;</span>å­™æƒ<span class="emphasis">&#x27;, &#x27;</span>å´å›½<span class="emphasis">&#x27;);</span></span><br><span class="line"><span class="emphasis">Query OK, 1 row affected (0.04 sec)</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"></span>mysql&gt; INSERT INTO <span class="string">`t2` VALUES (1012, &#x27;</span>è¯¸è‘›äº®<span class="emphasis">&#x27;, &#x27;</span>èœ€å›½<span class="emphasis">&#x27;);</span></span><br><span class="line"><span class="emphasis">Query OK, 1 row affected (0.04 sec)</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"></span>mysql&gt; INSERT INTO <span class="string">`t2` VALUES (1013, &#x27;</span>å…¸éŸ¦<span class="emphasis">&#x27;, &#x27;</span>é­å›½<span class="emphasis">&#x27;);</span></span><br><span class="line"><span class="emphasis">Query OK, 1 row affected (0.04 sec)</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"></span><span class="section">mysql&gt; select * FROM t1 where name not in (select name from t2);</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line"><span class="section">| id   | name   | addreee |</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line">| 1002 | æå››   | å¤©æ´¥    |</span><br><span class="line">| 1003 | ç‹äº”   | åŒ—äº¬    |</span><br><span class="line"><span class="section">| 1006 | æ±¤å§†   | æ²³å—    |</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line">3 rows in set (0.04 sec)</span><br><span class="line"></span><br><span class="line"><span class="section">mysql&gt; select * from t1 where not exists (select name from t2 where t1.name = t2.name);</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line"><span class="section">| id   | name   | addreee |</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line">| 1002 | æå››   | å¤©æ´¥    |</span><br><span class="line">| 1003 | ç‹äº”   | åŒ—äº¬    |</span><br><span class="line"><span class="section">| 1006 | æ±¤å§†   | æ²³å—    |</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line">3 rows in set (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT INTO <span class="string">`t2` VALUES (1014, NULL, &#x27;</span>é­å›½<span class="emphasis">&#x27;);</span></span><br><span class="line"><span class="emphasis">Query OK, 1 row affected (0.05 sec)</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"></span># not in éœ€è¦ä¿è¯è‡ªæŸ¥è¯¢çš„åŒ¹é…å­—æ®µæ˜¯éç©ºçš„</span><br><span class="line">mysql&gt; select * FROM t1 where name not in (select name from t2);</span><br><span class="line">Empty set (0.04 sec)</span><br><span class="line"></span><br><span class="line"># exists è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªbooleanå€¼ trueæˆ–è€…false,è€Œä¸å…³å¿ƒæŸä¸ªç»“æœé›†</span><br><span class="line"><span class="section">mysql&gt; select * from t1 where not exists (select name from t2 where t1.name = t2.name);</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line"><span class="section">| id   | name   | addreee |</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line">| 1002 | æå››   | å¤©æ´¥    |</span><br><span class="line">| 1003 | ç‹äº”   | åŒ—äº¬    |</span><br><span class="line"><span class="section">| 1006 | æ±¤å§†   | æ²³å—    |</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line">3 rows in set (0.04 sec)</span><br><span class="line"></span><br><span class="line"># è‡ªæŸ¥è¯¢ä¸­nameå¯ä»¥ä¿®æ”¹ä¸ºå…¶ä»–ä»»æ„çš„å­—æ®µ,æ‰§è¡Œæ•ˆç‡ä¸Š1&gt;column&gt;*</span><br><span class="line"><span class="section">mysql&gt; select * from t1 where not exists (select 1 from t2 where t1.name = t2.name);</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line"><span class="section">| id   | name   | addreee |</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line">| 1002 | æå››   | å¤©æ´¥    |</span><br><span class="line">| 1003 | ç‹äº”   | åŒ—äº¬    |</span><br><span class="line"><span class="section">| 1006 | æ±¤å§†   | æ²³å—    |</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line">3 rows in set (0.04 sec)</span><br><span class="line"></span><br><span class="line"># in, exists æ‰§è¡Œæµç¨‹</span><br><span class="line"># å¯¹äºinæŸ¥è¯¢æ¥è¯´ï¼Œä¼šå…ˆæ‰§è¡Œå­æŸ¥è¯¢ï¼Œç„¶åæŠŠæŸ¥è¯¢å¾—åˆ°çš„ç»“æœå’Œå¤–è¡¨t1åšç¬›å¡å°”ï¼Œé€šè¿‡æ¡ä»¶è¿›è¡Œç­›é€‰(nameæ˜¯å¦ç›¸ç­‰)</span><br><span class="line"><span class="section">mysql&gt; select * from t1 where name in (select name from t2);</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line"><span class="section">| id   | name   | addreee |</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line">| 1001 | å¼ ä¸‰   | åŒ—äº¬    |</span><br><span class="line">| 1004 | èµµå…­   | æ²³åŒ—    |</span><br><span class="line">| 1005 | æ°å…‹   | æ²³å—    |</span><br><span class="line">| 1007 | è´å°”   | ä¸Šæµ·    |</span><br><span class="line"><span class="section">| 1008 | å­™çª   | åŒ—äº¬    |</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line">5 rows in set (0.04 sec)</span><br><span class="line"></span><br><span class="line"># exists,å…ˆæŸ¥è¯¢ä¾¿åˆ©å¤–è¡¨t1,ç„¶åæ¯æ¬¡éå†æ—¶ï¼Œåœ¨æ£€æŸ¥å†…æ ‡æ˜¯å¦ç¬¦åˆåŒ¹é…æ¡ä»¶</span><br><span class="line"><span class="section">mysql&gt; select * from t1 where exists (select 1 from t2 where t1.name = t2.name);</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line"><span class="section">| id   | name   | addreee |</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line">| 1001 | å¼ ä¸‰   | åŒ—äº¬    |</span><br><span class="line">| 1004 | èµµå…­   | æ²³åŒ—    |</span><br><span class="line">| 1005 | æ°å…‹   | æ²³å—    |</span><br><span class="line">| 1007 | è´å°”   | ä¸Šæµ·    |</span><br><span class="line"><span class="section">| 1008 | å­™çª   | åŒ—äº¬    |</span></span><br><span class="line"><span class="section">+------+--------+---------+</span></span><br><span class="line">5 rows in set (0.03 sec)</span><br><span class="line"></span><br><span class="line"># å½“ in å€¼å¤šäº†ä¹‹åï¼Œå°±ä¸èµ°ç´¢å¼•äº†; æ¨æµ‹MySQLå¯¹inæŸ¥è¯¢çš„æˆæœ¬ä¼˜åŒ–å™¨CBO</span><br><span class="line"><span class="section">mysql&gt; explain select * from t1 where id in (1001, 1002, 1003, 1004, 1005, 1006, 1007);</span></span><br><span class="line"><span class="section">+----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="section">| id | select_type | table | partitions | type  | possible_keys | key     | key_len | ref  | rows | filtered | Extra       |</span></span><br><span class="line"><span class="section">+----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="section">|  1 | SIMPLE      | t1    | NULL       | range | PRIMARY       | PRIMARY | 4       | NULL |    7 |   100.00 | Using where |</span></span><br><span class="line"><span class="section">+----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-------------+</span></span><br><span class="line">1 row in set, 1 warning (0.03 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">mysql&gt; explain select * from t1 where id in (1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009, 1010);</span></span><br><span class="line"><span class="section">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="section">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |</span></span><br><span class="line"><span class="section">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line"><span class="section">|  1 | SIMPLE      | t1    | NULL       | ALL  | PRIMARY       | NULL | NULL    | NULL |    8 |   100.00 | Using where |</span></span><br><span class="line"><span class="section">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">1 row in set, 1 warning (0.03 sec)</span><br><span class="line"></span><br><span class="line"># å¦‚æœæŸ¥è¯¢çš„ä¸¤ä¸ªè¡¨å¤§å°ç›¸å½“ï¼Œç”¨inå’Œexistå·®åˆ«ä¸å¤§ï¼Œå¦‚æœä¸¤ä¸ªè¡¨ä¸­ä¸€ä¸ªè¾ƒå°ä¸€ä¸ªè¾ƒå¤§ï¼Œåˆ™å­æŸ¥è¯¢è¡¨å¤§çš„ç”¨exists,å­æŸ¥è¯¢è¡¨å°çš„ç”¨in.</span><br><span class="line"></span><br><span class="line"><span class="section">mysql&gt; explain select * from t1 where id in (select id from t2);</span></span><br><span class="line"><span class="section">+----+-------------+-------+------------+--------+---------------+---------+---------+---------------+------+----------+-------------+</span></span><br><span class="line"><span class="section">| id | select_type | table | partitions | type   | possible_keys | key     | key_len | ref           | rows | filtered | Extra       |</span></span><br><span class="line"><span class="section">+----+-------------+-------+------------+--------+---------------+---------+---------+---------------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | t1    | NULL       | ALL    | PRIMARY       | NULL    | NULL    | NULL          |    8 |   100.00 | NULL        |</span><br><span class="line"><span class="section">|  1 | SIMPLE      | t2    | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | develop.t1.id |    1 |   100.00 | Using index |</span></span><br><span class="line"><span class="section">+----+-------------+-------+------------+--------+---------------+---------+---------+---------------+------+----------+-------------+</span></span><br><span class="line">2 rows in set, 1 warning (0.05 sec)</span><br><span class="line"></span><br><span class="line"># æœ¬æ„æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯ï¼Œä½†æ˜¯å’Œexplainä½¿ç”¨ï¼Œä¼šæ˜¾ç¤ºä¼˜åŒ–åçš„sql</span><br><span class="line"><span class="section">mysql&gt; show warnings;</span></span><br><span class="line"><span class="section">+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="section">| Level | Code | Message                                                                                                                                                                                                           |</span></span><br><span class="line"><span class="section">+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="section">| Note  | 1003 | /* select#1 */ select `develop`.`t1`.`id` AS `id`,`develop`.`t1`.`name` AS `name`,`develop`.`t1`.`addreee` AS `addreee` from `develop`.`t2` join `develop`.`t1` where (`develop`.`t2`.`id` = `develop`.`t1`.`id`) |</span></span><br><span class="line"><span class="section">+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">1 row in set (0.04 sec)</span><br><span class="line"></span><br><span class="line"># å¤–å±‚å¤§è¡¨å†…å­˜å°è¡¨ï¼Œç”¨in, å¤–å±‚å°è¡¨å†…å±‚å¤§è¡¨ï¼Œinå’Œexistsæ•ˆç‡å·®ä¸å¤š.</span><br></pre></td></tr></table></figure></li>
<li><p>join åµŒå¥—å¾ªç¯ Nested-Loop Join</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>. ç®€å•åµŒå¥—å¾ªç¯è¿æ¥ Simple <span class="keyword">Nested</span>-<span class="keyword">Loop</span> <span class="keyword">Join</span></span><br><span class="line">  inner <span class="keyword">join</span> - å†…è¿æ¥ åŒå±‚å¾ªç¯éå†ä¸¤å¼ è¡¨</span><br><span class="line">  ä¸€èˆ¬sqlä¸­ä¼šä»¥å°è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œå¤–å±‚å¾ªç¯ï¼Œå†…å±‚å¾ªç¯ä½œä¸ºè¢«é©±åŠ¨è¡¨</span><br><span class="line"><span class="number">2</span>. ç´¢å¼•åµŒå¥—å¾ªç¯è¿æ¥</span><br><span class="line">  å†…å­˜è¡¨åˆ—è¦æœ‰ç´¢å¼•</span><br><span class="line"><span class="number">3</span>. å¿«ç´¢å¼•åµŒå¥—è¿æ¥ <span class="keyword">Block</span> <span class="keyword">Nested</span> <span class="keyword">Loop</span> <span class="keyword">Join</span></span><br><span class="line">  &gt; ç¼“å­˜å¤–å±‚è¡¨çš„æ•°æ®åˆ°<span class="keyword">join</span> bufferä¸­ï¼Œç„¶åbufferä¸­æ•°æ®æ‰¹é‡å’Œå†…å±‚è¡¨æ•°æ®è¿›è¡ŒåŒ¹é…ï¼Œä»è€Œå‡å°‘å†…å­˜å¾ªç¯çš„æ¬¡æ•°</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>æ•°æ®åº“</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis Tips &amp; Tracks</title>
    <url>/2021/09/02/Redis-Tips-Tracks/</url>
    <content><![CDATA[<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><blockquote>
<p>Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache, and message broker.</p>
</blockquote>
<span id="more"></span>

<h2 id="RedisçŸ¥è¯†çš„å…¨æ™¯å›¾"><a href="#RedisçŸ¥è¯†çš„å…¨æ™¯å›¾" class="headerlink" title="RedisçŸ¥è¯†çš„å…¨æ™¯å›¾"></a>RedisçŸ¥è¯†çš„å…¨æ™¯å›¾</h2><p><img src="/misc/images/redis-knowledge.jpg" alt="Redis çŸ¥è¯†å…¨æ™¯å›¾"></p>
<ul>
<li>åº”ç”¨çº¬åº¦:<ul>
<li>ç¼“å­˜åº”ç”¨<ul>
<li>å†…åµŒKeyè¿‡æœŸæœºåˆ¶å’Œæ·˜æ±°ç­–ç•¥</li>
</ul>
</li>
<li>é›†ç¾¤åº”ç”¨<ul>
<li>ä¸»ä»é›†ç¾¤ã€åˆ‡ç‰‡é›†ç¾¤</li>
</ul>
</li>
<li>æ•°æ®ç»“æ„åº”ç”¨<ul>
<li>String</li>
<li>Hash</li>
<li>List</li>
<li>Set</li>
<li>Sorted Set</li>
</ul>
</li>
</ul>
</li>
<li>ç³»ç»Ÿçº¬åº¦:<ul>
<li>å¤„ç†å±‚:<ul>
<li>çº¿ç¨‹æ¨¡å‹</li>
</ul>
</li>
<li>å†…å­˜å±‚:<ul>
<li>æ•°æ®ç»“æ„</li>
</ul>
</li>
<li>å­˜å‚¨å±‚:<ul>
<li>AOF</li>
<li>RDB</li>
</ul>
</li>
<li>ç½‘ç»œå±‚:<ul>
<li>epoolç½‘ç»œæ¡†æ¶</li>
</ul>
</li>
</ul>
</li>
<li>é«˜æ€§èƒ½ä¸»çº¿:<ul>
<li>çº¿ç¨‹æ¨¡å‹</li>
<li>æ•°æ®ç»“æ„<ul>
<li>é›†åˆç±»å‹é‡‡ç”¨æœ‰åºç´¢å¼•ï¼Œå¯ä»¥æ”¯æŒèŒƒå›´æ“ä½œ</li>
<li>è€ƒè™‘ä¸åŒæ•°æ®ç»“æ„çš„å†…å­˜æ•ˆç‡ã€è®¾è®¡äº†å‹ç¼©åˆ—è¡¨ã€æ•´æ•°æ•°ç»„è¿™äº›ç²¾ç®€çš„åº•å±‚æ•°æ®ç»“æ„ã€èŠ‚çœå†…å­˜å¼€é”€</li>
</ul>
</li>
<li>å†…å­˜åˆ†é…å™¨<ul>
<li>jemallocå’Œtcmallocæ¯”glibcæ•ˆç‡é«˜</li>
</ul>
</li>
<li>æŒä¹…åŒ–<ul>
<li>æ”¯æŒRDBã€AOFæŒä¹…åŒ–æ•°æ®ï¼Œæ”¯æŒä¸»ä»åº“é›†ç¾¤</li>
</ul>
</li>
<li>ç½‘ç»œæ¡†æ¶</li>
</ul>
</li>
<li>é«˜å¯ç”¨ä¸»çº¿:<ul>
<li>ä¸»ä»å¤åˆ¶</li>
<li>å“¨å…µæœºåˆ¶</li>
<li>åˆ‡ç‰‡é›†ç¾¤</li>
</ul>
</li>
<li>é«˜æ‰©å±•ä¸»çº¿:<ul>
<li>æ•°æ®åˆ†ç‰‡</li>
<li>è´Ÿè½½å‡è¡¡</li>
</ul>
</li>
</ul>
<h2 id="Redisé—®é¢˜ç”»åƒå›¾"><a href="#Redisé—®é¢˜ç”»åƒå›¾" class="headerlink" title="Redisé—®é¢˜ç”»åƒå›¾"></a>Redisé—®é¢˜ç”»åƒå›¾</h2><p><img src="/misc/images/redis-problems.jpeg" alt="Redisé—®é¢˜ç”»åƒ"></p>
<h2 id="Redis-åŸºç¡€"><a href="#Redis-åŸºç¡€" class="headerlink" title="Redis åŸºç¡€"></a>Redis åŸºç¡€</h2><ul>
<li><p>åŸºç¡€æ¶æ„</p>
<figure class="highlight haml"><table><tr><td class="code"><pre><span class="line"># æ•°æ®æ¨¡å‹: key-value</span><br><span class="line">  &gt; Redisèƒ½å¤Ÿåœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­å¹¿æ³›çš„åº”ç”¨ï¼Œå°±æ˜¯å¾—ç›Šäºæ”¯æŒå¤šæ ·åŒ–ç±»å‹çš„value</span><br><span class="line"></span><br><span class="line"># æ“ä½œæ¥å£:</span><br><span class="line">  -<span class="ruby"> <span class="symbol">PUT:</span></span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> <span class="symbol">GET:</span></span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> <span class="symbol">DELETE:</span></span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> <span class="symbol">SCAN:</span></span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"># è®¿é—®æ¡†æ¶:</span><br><span class="line">  -<span class="ruby"> åŠ¨æ€åº“è®¿é—®</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> ç½‘ç»œæ¡†æ¶è®¿é—®<span class="symbol">:</span>åŒ…æ‹¬Socket Serverå’Œåè®®è§£æ</span></span><br><span class="line"><span class="ruby"></span># æ“ä½œæ¨¡å—:</span><br><span class="line">  -<span class="ruby"> Redis é”®-å€¼æ˜ å°„æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> å“ˆå¸Œè¡¨: å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸ªå…ƒç´ netryç§°ä¸ºä¸€ä¸ªå“ˆå¸Œæ¡¶(æ¡¶ä¸­å…ƒç´ å­˜å‚¨çš„æ˜¯æŒ‡å‘keyå’Œvalueçš„æŒ‡é’ˆ).</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> O(<span class="number">1</span>)æ—¶é—´å¤æ‚åº¦å¿«é€ŸæŸ¥æ‰¾é”®å€¼å¯¹</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> å“ˆå¸Œè¡¨å†²çªé—®é¢˜</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> Redisè§£å†³å“ˆå¸Œå†²çªä½¿ç”¨é“¾å¼å“ˆå¸Œ,æŒ‡å‘åŒä¸€ä¸ªå“ˆå¸Œæ¡¶ä¸­çš„å¤šä¸ªå…ƒç´ ç”¨é“¾è¡¨ä¿å­˜ï¼Œä¹‹é—´ä¾æ¬¡ç”¨æŒ‡é’ˆè¿æ¥</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> Rehashæ“ä½œ:</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> è£…è½½å› å­ load factor = æ‰€æœ‰entryä¸ªæ•°/å“ˆå¸Œè¡¨çš„å“ˆå¸Œæ¡¶ä¸ªæ•°</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> rehashæ“ä½œå°±æ˜¯å¢åŠ ç°æœ‰å“ˆå¸Œæ¡¶æ•°é‡ï¼Œè®©å¢å¤šçš„entryå…ƒç´ èƒ½åœ¨æ›´å¤šçš„æ¡¶ä¹‹é—´åˆ†æ•£ä¿å­˜ï¼Œå‡å°‘å•ä¸ªæ¡¶ä¸­å…ƒç´ æ•°é‡,ä»è€Œå‡å°‘å•ä¸ªæ¡¶ä¸­å†²çª</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> Redisé»˜è®¤é‡‡ç”¨ä¸¤ä¸ªå…¨å±€å“ˆå¸Œè¡¨,å“ˆå¸Œè¡¨<span class="number">1</span>ï¼Œå“ˆå¸Œè¡¨<span class="number">2</span>, Rehashè¿‡ç¨‹:</span></span><br><span class="line"><span class="ruby"></span>          -<span class="ruby"> hash2åˆ†é…æ›´å¤§ç©ºé—´ <span class="number">2</span> * hash1</span></span><br><span class="line"><span class="ruby"></span>          -<span class="ruby"> å°†hash1ä¸­æ•°æ®é‡æ–°æ˜ å°„å¹¶æ‹·è´åˆ°hash2</span></span><br><span class="line"><span class="ruby"></span>          -<span class="ruby"> é‡Šæ”¾hash1ç©ºé—´</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> æ¸è¿›å¼<span class="symbol">rehash:</span></span></span><br><span class="line"><span class="ruby"></span>          -<span class="ruby"> å·§å¦™çš„æŠŠä¸€æ¬¡æ€§å¤§é‡æ‹·è´çš„å¼€é”€åˆ†æ‘Šåˆ°å¤šæ¬¡å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼Œé¿å…è€—æ—¶æ“ä½œï¼Œä¿è¯æ•°æ®çš„å¿«é€Ÿè®¿é—®</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line">  -<span class="ruby"> Rediså€¼çš„æ•°æ®ç±»å‹:</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> å­—ç¬¦ä¸²<span class="symbol">String:</span></span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> åº•å±‚æ•°æ®ç±»å‹:</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> ç®€å•åŠ¨æ€å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> åˆ—è¡¨List</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> åº•å±‚æ•°æ®ç±»å‹:</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> åŒå‘é“¾è¡¨</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> å‹ç¼©åˆ—è¡¨</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> é›†åˆSet</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> åº•å±‚æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> å‹ç¼©åˆ—è¡¨</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> æ•´æ•°æ•°ç»„</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> æœ‰åºé›†åˆSorted Set</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> åº•å±‚æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> å‹ç¼©åˆ—è¡¨</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> è·³è¡¨</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> å“ˆå¸ŒHash</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> åº•å±‚æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> å‹ç¼©åˆ—è¡¨</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> å“ˆå¸Œè¡¨</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> Redisåº•å±‚æ•°æ®ç»“æ„</span></span><br><span class="line"><span class="ruby"></span>    &gt; Redisä¹‹æ‰€ä»¥é‡‡ç”¨ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œæ˜¯åœ¨æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨æ•ˆç‡ä¹‹é—´è¿›è¡Œå¹³è¡¡</span><br><span class="line">    -<span class="ruby"> ç®€å•åŠ¨æ€å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> åŒå‘é“¾è¡¨</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> å‹ç¼©åˆ—è¡¨<span class="symbol">:</span>ç±»ä¼¼æ•°ç»„</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> è¡¨å¤´:</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> <span class="symbol">zlbytes:</span> åˆ—è¡¨é•¿åº¦</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> <span class="symbol">zltail:</span> åˆ—è¡¨å°¾çš„åç§»é‡</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> <span class="symbol">zllen:</span> åˆ—è¡¨ä¸­entryä¸ªæ•°</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> è¡¨å°¾:</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> <span class="symbol">zlend:</span> è¡¨ç¤ºç»“æŸ</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> å“ˆå¸Œè¡¨</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> è·³è¡¨: è·³è¡¨åœ¨é“¾è¡¨çš„åŸºç¡€ä¸Šå¢åŠ å¤šçº§ç´¢å¼•ï¼Œé€šè¿‡ç´¢å¼•ä½ç½®çš„å‡ ä¸ªè·³è½¬ï¼Œå®ç°æ•°æ®çš„å¿«é€Ÿå®šä½</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> æŸ¥æ‰¾å¤æ‚åº¦O(logN)</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> æ•´æ•°æ•°ç»„</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"># ç´¢å¼•æ¨¡å—:</span><br><span class="line">  -<span class="ruby"> ç´¢å¼•çš„ä½œç”¨æ˜¯è®©é”®å€¼æ•°æ®åº“æ ¹æ®Keyæ‰¾åˆ°å“åº”valueçš„å­˜å‚¨ä½ç½®ï¼Œè¿›è€Œæ‰§è¡Œæ“ä½œ</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> å“ˆå¸Œè¡¨: redis, mamcachedé‡‡ç”¨</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> å†…å­˜çš„é«˜æ€§èƒ½éšæœºè®¿é—®å¯ä»¥å¾ˆå¥½ä¸å“ˆå¸Œè¡¨O(<span class="number">1</span>)æ“ä½œå¤æ‚åº¦ç›¸åŒ¹é…</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> B+æ ‘</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> å­—å…¸æ ‘</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> skip <span class="symbol">list:</span> RocksDBé‡‡ç”¨</span></span><br><span class="line"><span class="ruby"></span># å­˜å‚¨æ¨¡å—:</span><br><span class="line">  -<span class="ruby"> å†…å­˜åˆ†é…å™¨</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> <span class="symbol">glibc:</span> malloc/free</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> æŒä¹…åŒ–</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> æ—¥å¿—AOF</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> å¿«ç…§RDB</span></span><br><span class="line"><span class="ruby"></span># IOæ¨¡å‹è®¾è®¡</span><br><span class="line">  &gt; Rediså•çº¿ç¨‹æ˜¯æŒ‡ç½‘ç»œIOå’Œé”®å€¼å¯¹è¯»å†™æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹å®Œæˆ. å…¶ä»–åŠŸèƒ½æŒä¹…åŒ–ã€å¼‚æ­¥åˆ é™¤ã€é›†ç¾¤æ•°æ®åŒæ­¥æ˜¯ç”±é¢å¤–çš„çº¿ç¨‹æ‰§è¡Œ.</span><br><span class="line">  -<span class="ruby"> å¤šçº¿ç¨‹ç¼–ç¨‹æ¨¡å¼:</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> é¢ä¸´å…±äº«èµ„æºçš„å¹¶å‘è®¿é—®æ§åˆ¶é—®é¢˜</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> é‡‡ç”¨å¤šçº¿ç¨‹å¼€å‘ä¼šå¼•å…¥åŒæ­¥åŸè¯­æ¥ä¿æŠ¤å…±äº«èµ„æºçš„å¹¶å‘è®¿é—®</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> å•çº¿ç¨‹ç¼–ç¨‹æ¨¡å¼:</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> RedisåŸºæœ¬IOæ¨¡å‹ä¸­ï¼Œä¸»è¦æ˜¯ä¸»çº¿ç¨‹åœ¨æ‰§è¡Œæ“ä½œï¼Œä»»ä½•è€—æ—¶çš„æ“ä½œï¼Œbigkeyã€å…¨é‡è¿”å›ç­‰æ“ä½œï¼Œéƒ½æ˜¯æ½œåœ¨çš„æ€§èƒ½ç“¶é¢ˆ</span></span><br></pre></td></tr></table></figure></li>
<li><p>Sockerç½‘ç»œæ¨¡å‹</p>
<table>
<thead>
<tr>
<th align="left">è°ƒç”¨æ–¹æ³•</th>
<th align="left">è¿”å›å¥—æ¥å­—ç±»å‹</th>
<th align="left">éé˜»å¡æ¨¡å¼</th>
<th align="left">æ•ˆæœ</th>
</tr>
</thead>
<tbody><tr>
<td align="left">socket()</td>
<td align="left">ä¸»åŠ¨å¥—æ¥å­—</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">listen()</td>
<td align="left">ç›‘å¬å¥—æ¥å­—</td>
<td align="left">å¯è®¾ç½®</td>
<td align="left">accept()éé˜»å¡</td>
</tr>
<tr>
<td align="left">accept()</td>
<td align="left">å·²è¿æ¥å¥—æ¥å­—</td>
<td align="left">å¯è®¾ç½®</td>
<td align="left">send()/recv()éé˜»å¡</td>
</tr>
</tbody></table>
</li>
<li><p>Rediså¤šè·¯å¤ç”¨IOæ¨¡å‹<br><img src="/misc/images/redis-epoll.jpg" alt="åŸºäºå¤šè·¯å¤ç”¨çš„Redisé«˜æ€§èƒ½IOæ¨¡å‹"></p>
<blockquote>
<p>ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªIOæµ.è¯¥æœºåˆ¶å…è®¸å†…æ ¸ä¸­åŒæ—¶å­˜åœ¨å¤šä¸ªç›‘å¬å¥—æ¥å­—å’Œå·²è¿æ¥å¥—æ¥å­—.<br>select/epollæä¾›åŸºäºäº‹ä»¶çš„å›è°ƒæœºåˆ¶ï¼Œé’ˆå¯¹ä¸åŒäº‹ä»¶çš„å‘ç”Ÿï¼Œè°ƒç”¨å“åº”çš„å¤„ç†å‡½æ•°</p>
</blockquote>
</li>
<li><p>åº•å±‚æ•°æ®ç»“æ„æ—¶é—´å¤æ‚åº¦åˆ†ç±»</p>
<table>
<thead>
<tr>
<th align="left">åç§°</th>
<th align="left">æ—¶é—´å¤æ‚åº¦</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å“ˆå¸Œè¡¨</td>
<td align="left">O(1)</td>
</tr>
<tr>
<td align="left">è·³è¡¨</td>
<td align="left">O(logN)</td>
</tr>
<tr>
<td align="left">åŒå‘é“¾è¡¨</td>
<td align="left">O(N)</td>
</tr>
<tr>
<td align="left">å‹ç¼©åˆ—è¡¨</td>
<td align="left">O(N)</td>
</tr>
<tr>
<td align="left">æ•´æ•°æ•°ç»„</td>
<td align="left">O(N)</td>
</tr>
</tbody></table>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># å•å…ƒç´ æ“ä½œæ˜¯åŸºç¡€</span></span><br><span class="line"><span class="meta"># èŒƒå›´æ“ä½œéå¸¸è€—æ—¶</span></span><br><span class="line">  - èŒƒå›´æ“ä½œæ˜¯æŒ‡é›†åˆç±»å‹ä¸­çš„éå†æ“ä½œ: O(N)</span><br><span class="line">  - SCANæ“ä½œå®ç°æ¸è¿›å¼éå†ï¼Œåªè¿”å›æœ‰é™æ•°é‡çš„æ•°æ®.</span><br><span class="line"><span class="meta"># ç»Ÿè®¡æ“ä½œé€šå¸¸é«˜æ ¡</span></span><br><span class="line">  å‹ç¼©åˆ—è¡¨å’ŒåŒå‘é“¾è¡¨éƒ½ä¼šè®°å½•è¡¨å¤´å’Œè¡¨å°¾çš„åç§»é‡</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><ul>
<li>é€šä¿¡åè®®<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">rediså®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å‘é€çš„å‘½ä»¤å’Œæ•°æ®ä¸€å¾‹ä»¥\r\n (CR LF)ç»“å°¾</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯·æ±‚åè®®:</span></span><br><span class="line">  *&lt;å‚æ•°æ•°é‡&gt; CR LF</span><br><span class="line">  $&lt;å‚æ•°çš„å­—èŠ‚æ•°é‡&gt; CR LF</span><br><span class="line">  &lt;å‚æ•°çš„æ•°æ®&gt; CR LF</span><br><span class="line"></span><br><span class="line">  ubuntu <span class="keyword">in</span> / î‚¢ at 3BPlus took 11s</span><br><span class="line">  âœ tail appendonly.aof</span><br><span class="line">  <span class="number">*3</span>        - è¡¨ç¤ºå½“å‰å‘½ä»¤æœ‰å•ä¸ªéƒ¨åˆ†</span><br><span class="line">  <span class="variable">$3</span>        - å­—èŠ‚æ•°</span><br><span class="line">  <span class="builtin-name">set</span></span><br><span class="line">  <span class="variable">$4</span></span><br><span class="line">  name</span><br><span class="line">  <span class="variable">$10</span></span><br><span class="line">  chyiyaqing</span><br><span class="line"></span><br><span class="line"><span class="comment"># å›å¤åè®®:</span></span><br><span class="line">  &gt; åœ¨å›å¤åè®®ä¸­ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œç¡®å®šè¿™ä¸ªå›å¤æ˜¯ä»€ä¹ˆç±»å‹</span><br><span class="line">  - çŠ¶æ€å›å¤ (status reply) ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ <span class="string">&quot;+&quot;</span></span><br><span class="line">  - é”™è¯¯å›å¤ (<span class="builtin-name">error</span> reply) ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ <span class="string">&quot;-&quot;</span></span><br><span class="line">  - æ•´æ•°å›å¤ (integer reply) ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ <span class="string">&quot;.&quot;</span></span><br><span class="line">  - æ‰¹é‡å›å¤ (bulk reply) ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ <span class="string">&quot;$&quot;</span></span><br><span class="line">  - å¤šæ¡æ‰¹é‡å›å¤ (multi bulk reply) ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="æ€§èƒ½è°ƒä¼˜"><a href="#æ€§èƒ½è°ƒä¼˜" class="headerlink" title="æ€§èƒ½è°ƒä¼˜"></a>æ€§èƒ½è°ƒä¼˜</h2><h2 id="æ•°æ®æŒä¹…åŒ–"><a href="#æ•°æ®æŒä¹…åŒ–" class="headerlink" title="æ•°æ®æŒä¹…åŒ–"></a>æ•°æ®æŒä¹…åŒ–</h2><blockquote>
<p>Redis æŒä¹…åŒ–ä¸»è¦ä¸¤å¤§æœºåˆ¶: AOF (Append Only File) æ—¥å¿—å’ŒRDB å¿«ç…§</p>
</blockquote>
<ul>
<li><p>AOF - Append Only File</p>
<figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> <span class="javascript">AOFæ—¥å¿—æ˜¯Redisæ‰§è¡Œå®Œå‘½ä»¤ï¼ŒæŠŠæ•°æ®å†™å…¥å†…å­˜ï¼Œç„¶åæ‰è®°å½•æ—¥å¿—,é¿å…å‡ºç°è®°å½•é”™è¯¯å‘½ä»¤çš„æƒ…å†µ,è®°å½•çš„æ˜¯Redisæ”¶åˆ°çš„æ¯ä¸€æ¡å‘½ä»¤, è¿™äº›å‘½ä»¤ä»¥æ–‡æœ¬å½¢å¼ä¿å­˜</span></span><br></pre></td></tr></table></figure>
<ul>
<li>AOF æ½œåœ¨çš„é£é™©<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> æ‰§è¡Œå®Œå‘½ä»¤è¿˜æ²¡æœ‰æ¥å¾—åŠè®°æ—¥å¿—å°±å®•æœºï¼Œè¿™ä¸ªå‘½ä»¤å’Œç›¸å…³çš„æ•°æ®æœ‰ä¸¢å¤±çš„é£é™©?</span><br><span class="line"><span class="bullet">-</span> AOFå†™æ—¥å¿—åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå¦‚æœç£ç›˜å†™å‹åŠ›è¿‡å¤§ï¼Œå°±ä¼šå¯¼è‡´å†™ç›˜å¾ˆæ…¢ï¼Œè¿›è€Œå¯¼è‡´åç»­çš„æ“ä½œæ— æ³•æ‰§è¡Œ</span><br><span class="line"><span class="section"># å†™å›ç£ç›˜ç­–ç•¥ appendfsync</span></span><br><span class="line"><span class="bullet">  1.</span> Always: åŒæ­¥å†™å›, æ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œç«‹é©¬åŒæ­¥å°†æ—¥å¿—å†™å›ç£ç›˜</span><br><span class="line"><span class="code">    &gt; è½ç›˜æ“ä½œå±äºæ…¢é€Ÿï¼Œå›å½±å“ä¸»çº¿ç¨‹æ€§èƒ½</span></span><br><span class="line"><span class="code">  2. Everysec: æ¯ç§’å†™å›,æ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ°AOFæ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œæ¯éš”ä¸€ç§’æŠŠç¼“å†²åŒºä¸­çš„å†…å®¹å†™å…¥ç£ç›˜</span></span><br><span class="line"><span class="code">    &gt; åœ¨é¿å…å½±å“ä¸»çº¿ç¨‹å’Œé¿å…æ•°æ®ä¸¢å¤±ä¸¤è€…ä¹‹é—´trade-offæ–¹å¼</span></span><br><span class="line"><span class="code">  3. No: æ“ä½œç³»ç»Ÿæ§åˆ¶å†™å›ï¼Œæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œåªæ˜¯å…ˆæŠŠæ—¥å¿—å†™åˆ°AOFæ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†ç¼“å†²åŒºå†…å®¹å†™å›ç£ç›˜</span></span><br><span class="line"><span class="code">    &gt; è½ç›˜æ—¶æœºäº¤ç»™æ“ä½œç³»ç»Ÿï¼Œåªè¦AOFè®°å½•æ²¡æœ‰å†™å›ç£ç›˜ï¼Œå®•æœºå¯¹åº”çš„æ•°æ®å°±ä¸¢å¤±</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th align="left">é…ç½®é¡¹</th>
<th align="left">å†™å›æ—¶æœº</th>
<th align="left">ä¼˜ç‚¹</th>
<th align="left">ç¼ºç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Always</td>
<td align="left">åŒæ­¥å†™å›</td>
<td align="left">å¯é æ€§é«˜ï¼Œæ•°æ®åŸºæœ¬ä¸ä¸¢å¤±</td>
<td align="left">æ¯ä¸ªå†™å‘½ä»¤éƒ½è¦è½ç›˜ï¼Œæ€§èƒ½å½±å“è¾ƒå¤§</td>
</tr>
<tr>
<td align="left">EverySec</td>
<td align="left">æ¯ç§’å†™å›</td>
<td align="left">æ€§èƒ½é€‚ä¸­</td>
<td align="left">å®•æœºæ—¶ä¸¢å¤±1ç§’å†…çš„æ•°æ®</td>
</tr>
<tr>
<td align="left">No</td>
<td align="left">æ“ä½œç³»ç»Ÿæ§åˆ¶å†™å›</td>
<td align="left">æ€§èƒ½å¥½</td>
<td align="left">å®•æœºä¸¢å¤±æ•°æ®è¾ƒå¤š</td>
</tr>
</tbody></table>
</li>
<li>AOFæ–‡ä»¶è¿‡å¤§çš„æ€§èƒ½é—®é¢˜<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> æ–‡ä»¶ç³»ç»Ÿæœ¬èº«å¯¹æ–‡ä»¶å¤§å°æœ‰é™åˆ¶ï¼Œæ— æ³•ä¿å­˜è¿‡å¤§çš„æ–‡ä»¶</span><br><span class="line"><span class="bullet">2.</span> æ–‡ä»¶è¿‡å¤§ï¼Œè¿½åŠ å‘½ä»¤è®°å½•æ•ˆç‡å˜ä½</span><br><span class="line"><span class="bullet">3.</span> å‘ç”Ÿå®•æœºï¼ŒAOFè®°å½•å‘½ä»¤è¦è¢«é‡æ–°æ‰§è¡Œï¼Œæ•…éšœæ¢å¤æ¯”è¾ƒç¼“æ…¢ï¼Œä¼šå½±å“Redisæ­£å¸¸ä½¿ç”¨</span><br></pre></td></tr></table></figure></li>
<li>AOFé‡å†™æœºåˆ¶:<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">ç›´æ¥æ ¹æ®æ•°æ®åº“ä¸­æ•°æ®çš„æœ€æ–°çŠ¶æ€ï¼Œç”Ÿæˆè¿™äº›æ•°æ®çš„æ’å…¥å‘½ä»¤</span><br><span class="line"><span class="quote">&gt; é‡å†™æœºåˆ¶å¯ä»¥å°†æ—§æ—¥å¿—æ–‡ä»¶ä¸­çš„å¤šæ¡å‘½ä»¤ï¼Œåœ¨é‡å†™åçš„æ–°æ—¥å¿—ä¸­å˜æˆä¸€æ¡å‘½ä»¤</span></span><br><span class="line"><span class="quote">&gt; AOFé‡å†™è¿‡ç¨‹æ˜¯ç”±åå°å­è¿›ç¨‹bgrewriteaofå®Œæˆï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™</span></span><br><span class="line"><span class="bullet">-</span> &quot;ä¸€ä¸ªæ‹·è´ï¼Œä¸¤å¤„æ—¥å¿—&quot;</span><br><span class="line"><span class="bullet">  -</span> ä¸€ä¸ªæ‹·è´: æ¯æ¬¡æ‰§è¡Œé‡å†™æ—¶ï¼Œä¸»çº¿ç¨‹forkå‡ºåå°çš„bgrewriteaofå­è¿›ç¨‹ï¼Œæ­¤æ—¶ï¼Œforkä¼šæŠŠä¸»çº¿ç¨‹çš„å†…å­˜æ‹·è´ä¸€ä»½ç»™bgrewriteaofå­è¿›ç¨‹ï¼Œç„¶åbgrewriteaofå­è¿›ç¨‹åœ¨ä¸å½±å“ä¸»çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œé€ä¸€æŠŠæ‹·è´çš„æ•°æ®å†™æˆæ“ä½œï¼Œè®°å…¥é‡å†™æ—¥å¿—.</span><br><span class="line"><span class="bullet">  -</span> ä¸¤å¤„æ—¥å¿—: ä¸€ä¸ªæ˜¯æ­£åœ¨ä½¿ç”¨çš„AOFæ—¥å¿—ï¼ŒRedisä¼šæŠŠæ“ä½œå†™åˆ°å®ƒçš„ç¼“å†²åŒºï¼Œç¬¬äºŒå¤„æ—¥å¿—æ˜¯æ–°çš„AOFé‡å†™æ—¥å¿—ï¼Œç­‰åˆ°æ‹·è´æ•°æ®çš„æ‰€æœ‰æ“ä½œè®°å½•é‡å†™å®Œæˆåï¼Œé‡å†™æ—¥å¿—è®°å½•çš„æ“ä½œä¹Ÿä¼šå†™å…¥æ–°çš„AOFæ–‡ä»¶ï¼Œä¿è¯æ•°æ®åº“æœ€æ–°çŠ¶æ€çš„è®°å½•</span><br></pre></td></tr></table></figure>
<img src="/misc/images/bgrewriteaof.jpg" alt="AOFéé˜»å¡é‡å†™è¿‡ç¨‹"></li>
</ul>
</li>
<li><p>RDB(Redis DataBase) - å†…å­˜å¿«ç…§</p>
<figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> <span class="javascript">å†…å­˜å¿«ç…§ï¼šæŒ‡å†…å­˜ä¸­çš„æ•°æ®åœ¨æŸä¸€ä¸ªæ—¶åˆ»çš„çŠ¶æ€è®°å½•</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Redisä¸¤ç§å‘½ä»¤ç”ŸæˆRDBæ–‡ä»¶<ul>
<li>save: åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œä¼šå¯¼è‡´é˜»å¡</li>
<li>bgsave: åˆ›å»ºå­è¿›ç¨‹ï¼Œä¸“é—¨ç”¨äºå†™å…¥RDBæ–‡ä»¶ï¼Œé¿å…ä¸»çº¿ç¨‹é˜»å¡, é»˜è®¤é…ç½®<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="quote">&gt; bgsaveå­è¿›ç¨‹ç”±ä¸»çº¿ç¨‹forkç”Ÿæˆï¼Œå…±äº«ä¸»çº¿ç¨‹çš„æ‰€æœ‰å†…å­˜æ•°æ®ï¼Œbgsaveå­è¿›ç¨‹è¿è¡Œåï¼Œå¼€å§‹è¯»å–ä¸»çº¿ç¨‹çš„å†…å­˜æ•°æ®ï¼Œå¹¶æŠŠæ•°æ®å†™å…¥RDBæ–‡ä»¶</span></span><br><span class="line"><span class="bullet">  1.</span> é¢‘ç¹å°†å…¨é‡æ•°æ®å†™å…¥ç£ç›˜ï¼Œä¼šç»™ç£ç›˜å¸¦æ¥å¾ˆå¤§å‹åŠ›.</span><br><span class="line"><span class="bullet">  2.</span> bgsaveå­è¿›ç¨‹éœ€è¦forkæ“ä½œä»ä¸»çº¿ç¨‹åˆ›å»ºå‡ºæ¥, forkæ“ä½œä¼šé˜»å¡ä¸»çº¿ç¨‹</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>COW - Copy-On-Write<br><img src="/misc/images/redis-cow.jpg" alt="å†™æ—¶å¤åˆ¶æœºåˆ¶"><figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">å†™æ—¶å¤åˆ¶æŠ€æœ¯å…·ä½“æ¥è¯´ï¼Œä¸»çº¿ç¨‹åœ¨æœ‰å†™æ“ä½œæ—¶ï¼Œæ‰ä¼šæŠŠè¿™ä¸ªæ–°å†™æˆ–è€…ä¿®æ”¹çš„æ•°æ®å†™å…¥åˆ°æ–°çš„ç‰©ç†åœ°å€,å¹¶ä¿®æ”¹è‡ªå·±çš„é¡µè¡¨æ˜ å°„.</span><br><span class="line">ä¿è¯å¿«ç…§çš„å®Œæ•´æ€§ï¼Œä¹Ÿå…è®¸ä¸»çº¿ç¨‹åŒæ—¶å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œé¿å…å¯¹æ­£å¸¸ä¸šåŠ¡çš„å½±å“</span><br></pre></td></tr></table></figure></li>
<li>Redis 4.0 æ··åˆAOF+RDB<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># å¢é‡å¿«ç…§:</span></span><br><span class="line"><span class="quote">&gt; åšä¸€æ¬¡å…¨é‡å¿«ç…§åï¼Œåç»­çš„å¿«ç…§æ”¯é˜Ÿä¿®æ”¹çš„æ•°æ®è¿›è¡Œå¿«ç…§è®°å½•ï¼Œå¯ä»¥é¿å…æ¯æ¬¡å…¨é‡å¿«ç…§çš„å¼€é”€</span></span><br><span class="line"></span><br><span class="line"><span class="section"># æ··åˆä½¿ç”¨AOFæ—¥å¿—å’Œå†…å­˜å¿«ç…§</span></span><br><span class="line"><span class="quote">&gt; å†…å­˜å¿«ç…§ä»¥ä¸€å®šçš„é¢‘ç‡æ‰§è¡Œï¼Œä¸¤æ¬¡å¿«ç…§ä¹‹é—´ï¼Œä½¿ç”¨AOFæ—¥å¿—è®°å½•è¿™æœŸé—´çš„æ‰€æœ‰å‘½ä»¤æ“ä½œ</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="æ•°æ®åŒæ­¥"><a href="#æ•°æ®åŒæ­¥" class="headerlink" title="æ•°æ®åŒæ­¥"></a>æ•°æ®åŒæ­¥</h2><ul>
<li>Redis ä¸»ä»åº“æ¨¡å¼<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="quote">&gt; ä¸»ä»åº“é‡‡ç”¨è¯»å†™åˆ†ç¦»æ–¹å¼</span></span><br><span class="line"><span class="bullet">  -</span> è¯»æ“ä½œ: ä¸»åº“ã€ä»åº“éƒ½å¯ä»¥æ¥æ”¶</span><br><span class="line"><span class="bullet">  -</span> å†™æ“ä½œ: é¦–å…ˆåˆ°ä¸»åº“æ‰§è¡Œï¼Œç„¶åï¼Œä¸»åº“å°†å†™æ“ä½œåŒæ­¥ç»™ä»åº“</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸»ä»åº“å¦‚ä½•è¿›è¡Œç¬¬ä¸€æ¬¡åŒæ­¥?<br><img src="/misc/images/master-slave-sync.jpg" alt="ä¸»ä»åº“ç¬¬ä¸€æ¬¡åŒæ­¥æµç¨‹"><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># ä¸‰ä¸ªé˜¶æ®µ</span></span><br><span class="line"><span class="bullet">  1.</span> ç¬¬ä¸€é˜¶æ®µ: å»ºç«‹è¿æ¥ã€åå•†åŒæ­¥</span><br><span class="line"><span class="bullet">    -</span> psync ? -1</span><br><span class="line"><span class="bullet">    -</span> runID: Rediså®ä¾‹è‡ªåŠ¨ç”Ÿæˆçš„éšæœºID</span><br><span class="line"><span class="bullet">    -</span> offset: å¤åˆ¶çš„åç§»é‡</span><br><span class="line"><span class="bullet">    -</span> FULLRESYNC: è¡¨ç¤ºç¬¬ä¸€æ¬¡å¤åˆ¶é‡‡ç”¨å…¨é‡å¤åˆ¶ï¼Œä¸»åº“ä¼šæŠŠå½“å‰æ‰€æœ‰çš„æ•°æ®éƒ½å¤åˆ¶ç»™ä»åº“</span><br><span class="line"><span class="bullet">  2.</span> ç¬¬äºŒé˜¶æ®µ: ä¸»åº“åŒæ­¥æ•°æ®ç»™ä»åº“</span><br><span class="line"><span class="bullet">    -</span> ä¸»åº“å°†æ‰€æœ‰æ•°æ®åŒæ­¥ç»™ä»åº“,ä»åº“æ”¶åˆ°æ•°æ®åï¼Œåœ¨æœ¬åœ°å®Œæˆæ•°æ®åŠ è½½</span><br><span class="line"><span class="bullet">    -</span> replication buffer: ä¸»ä»åº“åœ¨è¿›è¡Œå…¨é‡å¤åˆ¶æ—¶ï¼Œä¸»åº“ä¸Šç”¨äºå’Œä»åº“è¿æ¥çš„å®¢æˆ·ç«¯buffer</span><br><span class="line"><span class="bullet">  3.</span> ç¬¬ä¸‰é˜¶æ®µ: ä¸»åº“å‘é€æ–°å†™å‘½ä»¤ç»™ä»åº“</span><br><span class="line"><span class="bullet">    -</span> ä¸»åº“æŠŠreplication buffer æ“ä½œå‘ç»™ä»åº“</span><br><span class="line"><span class="bullet">    -</span> ä¸»åº“ä¼šç»™æ¯ä¸ªä»åº“å»ºç«‹ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œæ‰€ä»¥replication bufferä¸æ˜¯å…±äº«çš„ï¼Œè€Œæ˜¯æ¯ä¸ªä»åº“éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„å®¢æˆ·ç«¯</span><br><span class="line"></span><br><span class="line"><span class="section"># ä¸»ä»åº“å¤åˆ¶é‡‡ç”¨RDB,ä¸é‡‡ç”¨AOF?</span></span><br><span class="line"><span class="bullet">  1.</span> RDB æ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ— è®ºè¦æŠŠRDBå†™å…¥ç£ç›˜è¿˜æ˜¯é€šè¿‡ç½‘ç»œä¼ è¾“RDBï¼ŒIOæ•ˆç‡æ¯”è®°å½•çš„çº¯æ–‡æœ¬AOFé«˜</span><br><span class="line"><span class="bullet">  2.</span> åœ¨ä»åº“è¿›è¡Œæ¢å¤æ—¶ï¼Œç”¨RDBçš„æ¢å¤æ•ˆç‡æ¯”AOFé«˜</span><br></pre></td></tr></table></figure></li>
<li>ä¸» - ä» - ä»<figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> <span class="javascript">é€šè¿‡â€œä¸»-ä»-ä»â€æ¨¡å¼å°†ä¸»åº“ç”ŸæˆRDBå’Œä¼ è¾“RDBçš„å‹åŠ›ï¼Œä»¥çº§è”çš„æ–¹å¼åˆ†æ•£åˆ°ä»åº“ä¸­</span></span><br></pre></td></tr></table></figure></li>
<li>åŸºäºé•¿è¿æ¥çš„å‘½ä»¤ä¼ æ’­<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># repl_backlog_size:</span></span><br><span class="line"><span class="meta"># repl_backlog_buffer: ä¸ºäº†æ”¯æŒä»åº“å¢é‡å¤åˆ¶ï¼Œä¸»åº“ä¸Šç”¨äºæŒç»­ä¿æŒå†™æ“ä½œçš„ä¸€å—ä¸“ç”¨buffer, æ‰€æœ‰ä»åº“å…±äº«</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>å“¨å…µæœºåˆ¶<br><img src="/misc/images/redis-sentinel.jpg" alt="å“¨å…µæœºåˆ¶ä»»åŠ¡"><figure class="highlight haml"><table><tr><td class="code"><pre><span class="line">  &gt; Redisä¸»ä»é›†ç¾¤ä¸­ï¼Œå“¨å…µæœºåˆ¶å®ç°ä¸»ä»åº“è‡ªåŠ¨åˆ‡æ¢, è§£å†³ä¸»ä»å¤åˆ¶æ¨¡å¼ä¸‹æ•…éšœè½¬ç§»</span><br><span class="line">  # å“¨å…µé›†ç¾¤:</span><br><span class="line">    &gt; é‡‡ç”¨å¤šå®ä¾‹ç»„æˆçš„é›†ç¾¤æ¨¡å¼è¿›è¡Œéƒ¨ç½², å¼•å…¥å¤šå“¨å…µåˆ¤æ–­é¿å…å•ä¸ªå“¨å…µè‡ªèº«ç½‘ç»œçŠ¶æ€ä¸å¥½ï¼Œè¯¯åˆ¤ä¸»åº“ä¸‹çº¿</span><br><span class="line">    &gt; Nä¸ªå“¨å…µå®ä¾‹ï¼Œæœ€å¥½è¦æœ‰N/2+1å®ä¾‹åˆ¤æ–­ä¸»åº“ä¸º&quot;ä¸»è§‚ä¸‹çº¿&quot;, æœ€ç»ˆåˆ¤å®šä¸»åº“ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€</span><br><span class="line"></span><br><span class="line">  # å“¨å…µè´Ÿè´£çš„ä»»åŠ¡:</span><br><span class="line">    -<span class="ruby"> ç›‘æ§</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> å‘¨æœŸæ€§å‘æ‰€æœ‰çš„ä¸»ä»åº“å‘é€PINGå‘½ä»¤</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> å“¨å…µå¯¹ä¸»åº“ä¸‹çº¿åˆ¤æ–­:</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> ä¸»è§‚ä¸‹çº¿: å“¨å…µè¿›ç¨‹ä½¿ç”¨PINGå‘½ä»¤æ£€æµ‹è‡ªå·±å’Œä¸»ã€ä»åº“çš„ç½‘ç»œè¿æ¥æƒ…å†µï¼Œåˆ¤æ–­å®ä¾‹çš„çŠ¶æ€</span></span><br><span class="line"><span class="ruby"></span>          -<span class="ruby"> è¯¯åˆ¤: å‘ç”Ÿåœ¨é›†ç¾¤ç½‘ç»œå‹åŠ›è¾ƒå¤§ã€ç½‘ç»œæ‹¥èµ›ï¼Œæˆ–è€…ä¸»åº“æœ¬èº«å‹åŠ›è¾ƒå¤§</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> å®¢è§‚ä¸‹çº¿:</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> é€‰ä¸»</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> ä¸»åº“æŒ‚äº†ä¹‹åï¼Œå“¨å…µéœ€è¦ä»å¾ˆå¤šä»åº“ä¸­é€‰æ‹©ä¸€ä¸ªä»åº“å®ä¾‹</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> <span class="string">&quot;ç­›é€‰&quot;</span> + <span class="string">&quot;æ‰“åˆ†&quot;</span>:</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> <span class="string">&quot;ç­›é€‰&quot;</span>: æ£€æŸ¥ä»åº“çš„å½“å‰åœ¨çº¿çŠ¶æ€ï¼Œåˆ¤æ–­ç½‘ç»œè¿æ¥çŠ¶æ€</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> <span class="string">&quot;æ‰“åˆ†&quot;</span>: ä»åº“ä¼˜å…ˆçº§ã€ä»åº“å¤åˆ¶è¿›åº¦ä»¥åŠä»åº“IDå·</span></span><br><span class="line"><span class="ruby"></span>          -<span class="ruby"> replica-priority <span class="number">100</span></span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> é€šçŸ¥</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> å“¨å…µä¼šæŠŠæ–°ä¸»åº“çš„è¿æ¥ä¿¡æ¯å‘ç»™å…¶ä»–ä»åº“ï¼Œè®©ä»–ä»¬æ‰§è¡Œreplicaofå‘½ä»¤ï¼Œå’Œæ–°ä¸»åº“å»ºç«‹è¿æ¥ï¼Œå¹¶è¿›è¡Œæ•°æ®å¤åˆ¶,åŒæ—¶å“¨å…µæŠŠæ–°ä¸»åº“çš„è¿æ¥ä¿¡æ¯é€šçŸ¥ç»™å®¢æˆ·ç«¯ï¼Œè¯·æ±‚æ“ä½œå‘åˆ°æ–°ä¸»åº“ä¸Š.</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"># åŸºäºpub/sub æœºåˆ¶çš„å“¨å…µé›†ç¾¤</span><br><span class="line">  &gt; å“¨å…µåªè¦å’Œä¸»åº“å»ºç«‹è¿æ¥ï¼Œå°±å¯ä»¥åœ¨ä¸»åº“ä¸Šå‘å¸ƒæ¶ˆæ¯ï¼Œæ¯”å¦‚å‘å¸ƒè‡ªå·±çš„è¿æ¥ä¿¡æ¯(IPå’Œç«¯å£),ä»ä¸»åº“ä¸Šè®¢é˜…æ¶ˆæ¯ï¼Œè·å–å…¶ä»–å“¨å…µå‘å¸ƒçš„è¿æ¥ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">  -<span class="ruby"> å“¨å…µè·å–ä»åº“çš„IP+ç«¯å£</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> å“¨å…µå‘ä¸»åº“å‘é€INFOå‘½ä»¤,æŸ¥çœ‹ä»åº“åˆ—è¡¨,è¿›è€Œä¸ä»åº“å»ºç«‹è¿æ¥</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> pub/subå®¢æˆ·ç«¯äº‹ä»¶é€šçŸ¥</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Redisåˆ‡ç‰‡é›†ç¾¤"><a href="#Redisåˆ‡ç‰‡é›†ç¾¤" class="headerlink" title="Redisåˆ‡ç‰‡é›†ç¾¤"></a>Redisåˆ‡ç‰‡é›†ç¾¤</h2>  <figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> <span class="javascript">åˆ‡ç‰‡é›†ç¾¤(åˆ†ç‰‡é›†ç¾¤)å¯ä»¥ä¿å­˜å¤§é‡æ•°æ®ï¼Œå¯¹Redisä¸»çº¿ç¨‹é˜»å¡å½±å“è¾ƒå°</span></span><br></pre></td></tr></table></figure>
<ul>
<li>çºµå‘æ‰©å±•(scale up):</li>
<li>æ¨ªå‘æ‰©å±•(scale out):<ul>
<li>Redis Cluster:<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line">&gt; Redis Cluster é‡‡ç”¨å“ˆå¸Œæ§½(Hash Slot)å¤„ç†æ•°æ®å’Œå®ä¾‹ä¹‹é—´çš„æ˜ å°„å…³ç³». <span class="number">2</span>^<span class="number">14</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># keyæ˜ å°„å“ˆå¸Œslot</span></span><br><span class="line">  <span class="number">1.</span> æ ¹æ®é”®å€¼keyï¼ŒæŒ‰ç…§CRC16ç®—æ³•è®¡ç®—<span class="number">16</span>-bitå€¼ï¼Œç„¶åå¯¹<span class="number">16384</span>å–æ¨¡,æ¯ä¸ªæ‘¸æ•°ä»£è¡¨å“åº”ç¼–å·çš„å“ˆå¸Œæ§½ã€‚</span><br><span class="line"></span><br><span class="line"><span class="meta"># é‡å®šå‘æœºåˆ¶</span></span><br><span class="line">  &gt; å®¢æˆ·ç«¯ç»™ä¸€ä¸ªå®ä¾‹å‘é€æ•°æ®è¯»å†™æ“ä½œæ—¶ï¼Œè¿™ä¸ªå®ä¾‹ä¸Šå¹¶æ²¡æœ‰ç›¸åº”çš„æ•°æ®ï¼Œå®¢æˆ·ç«¯è¦å†ç»™ä¸€ä¸ªæ–°å®ä¾‹å‘é€æ“ä½œå‘½ä»¤</span><br><span class="line">  <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6001</span>&gt; <span class="keyword">get</span> name</span><br><span class="line">  -&gt; Redirected to slot [<span class="number">5798</span>] located at <span class="number">172.30</span><span class="number">.1</span><span class="number">.23</span>:<span class="number">6002</span></span><br><span class="line">  <span class="string">&quot;chyiyaqing&quot;</span></span><br><span class="line">  <span class="number">172.30</span><span class="number">.1</span><span class="number">.23</span>:<span class="number">6002</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta"># ASK:</span></span><br><span class="line">  ASKå‘½ä»¤å¹¶ä¸ä¼šæ›´æ–°å®¢æˆ·ç«¯ç¼“å­˜çš„å“ˆå¸Œæ§½åˆ†é…ä¿¡æ¯</span><br><span class="line"><span class="meta"># MOVED:</span></span><br><span class="line">  æ›´æ”¹æœ¬åœ°ç¼“å­˜ï¼Œè®©åç»­æ‰€æœ‰å‘½ä»¤éƒ½å‘å¾€æ–°å®ä¾‹</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="Redis-åº”ç”¨åœºæ™¯-æ¶ˆæ¯é˜Ÿåˆ—"><a href="#Redis-åº”ç”¨åœºæ™¯-æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="Redis åº”ç”¨åœºæ™¯ - æ¶ˆæ¯é˜Ÿåˆ—"></a>Redis åº”ç”¨åœºæ™¯ - æ¶ˆæ¯é˜Ÿåˆ—</h2>  <figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># æ¶ˆæ¯é˜Ÿåˆ—éœ€è¦æ»¡è¶³çš„åŠŸèƒ½:</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">  1.</span> æ”¯æŒé˜»å¡ç­‰å¾…æ‹‰å–æ¶ˆæ¯</span><br><span class="line"><span class="bullet">  2.</span> æ”¯æŒå‘å¸ƒ/è®¢é˜…æ¨¡å¼</span><br><span class="line"><span class="bullet">  3.</span> æ¶ˆè´¹å¤±è´¥ï¼Œå¯é‡æ–°æ¶ˆè´¹ï¼Œæ¶ˆæ¯ä¸ä¸¢å¤±</span><br><span class="line"><span class="bullet">  4.</span> å®ä¾‹å®•æœºï¼Œæ¶ˆæ¯ä¸ä¸¢å¤±ã€æ•°æ®å¯æŒä¹…åŒ–</span><br><span class="line"><span class="bullet">  5.</span> æ¶ˆæ¯å¯å †ç§¯</span><br></pre></td></tr></table></figure>

<ul>
<li><p>List - é˜Ÿåˆ—:</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line">ubuntu in ~ at 3BPlus</span><br><span class="line">âœ redis-cli -c -p <span class="number">6001</span></span><br><span class="line"><span class="number">127.0.0.1:6001</span>&gt; ping</span><br><span class="line">PONG</span><br><span class="line"><span class="number">127.0.0.1:6001</span>&gt; LPUSH queue msg1    # å¢åŠ æ¶ˆæ¯</span><br><span class="line">-&gt; Redirected to slot <span class="string">[13011]</span> located at <span class="number">172</span>.<span class="number">30</span>.<span class="number">1</span>.<span class="number">23</span>:<span class="number">6003</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">172.30.1.23:6003</span>&gt; LPUSH queue msg2</span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">172.30.1.23:6003</span>&gt; RPOP queue        # æ‹‰å–æ¶ˆæ¯</span><br><span class="line"><span class="string">&quot;msg1&quot;</span></span><br><span class="line"><span class="number">172.30.1.23:6003</span>&gt; RPOP queue</span><br><span class="line"><span class="string">&quot;msg2&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6001</span>&gt; RPOP queue          # é˜Ÿåˆ—ä¸ºç©ºï¼ŒRPOPè¿”å›NULL</span><br><span class="line">-&gt; Redirected to slot <span class="string">[13011]</span> located at <span class="number">172</span>.<span class="number">30</span>.<span class="number">1</span>.<span class="number">23</span>:<span class="number">6003</span></span><br><span class="line">(nil)</span><br><span class="line"><span class="number">127.0.0.1:6001</span>&gt; BRPOP queue <span class="number">5</span>       # BRPOPé˜»å¡å¼æ‹‰å–æ¶ˆæ¯ï¼Œæ”¯æŒä¼ å…¥è¶…æ—¶æ—¶é—´</span><br><span class="line">-&gt; Redirected to slot <span class="string">[13011]</span> located at <span class="number">172</span>.<span class="number">30</span>.<span class="number">1</span>.<span class="number">23</span>:<span class="number">6003</span></span><br><span class="line">(nil)</span><br><span class="line">(<span class="number">5</span>.00s)</span><br><span class="line"><span class="number">172.30.1.23:6003</span>&gt; BRPOP queue <span class="number">0</span>     # ä¸è®¾ç½®è¶…æ—¶ï¼Œç›´åˆ°æœ‰æ–°æ¶ˆæ¯æ‰è¿”å›</span><br><span class="line">^C</span><br><span class="line"><span class="number">172.30.1.23:6003</span>&gt; exit</span><br><span class="line"></span><br><span class="line">æ³¨æ„: å¦‚æœè®¾ç½®è¶…æ—¶æ—¶é—´å¤ªé•¿ï¼Œè¿æ¥å¤ªä¹…æ²¡æœ‰æ´»è·ƒï¼Œæœ‰å¯èƒ½ä¼šè¢«Redis serveråˆ¤å®šä¸ºæ— æ•ˆè¿æ¥ï¼Œä¹‹åRedis Serverä¼šå¼ºåˆ¶æŠŠè¿™ä¸ªå®¢æˆ·ç«¯è¸¢ä¸‹çº¿ï¼Œå®¢æˆ·ç«¯è¦æœ‰é‡è¿æœºåˆ¶</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. ä¸æ”¯æŒé‡å¤æ¶ˆè´¹ï¼šæ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯åï¼Œè¯¥æ¶ˆæ¯å°±ä»Listä¸­åˆ é™¤ï¼Œæ— æ³•è¢«å…¶ä»–æ¶ˆè´¹è€…åœ¨æ­¤æ¶ˆè´¹ï¼Œå³ä¸æ”¯æŒå¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹åŒä¸€æ‰¹æ•°æ®</span><br><span class="line"><span class="number">2</span>. æ¶ˆæ¯ä¸¢å¤±ï¼Œæ¶ˆè´¹è€…æ‹‰å–åˆ°æ¶ˆæ¯åï¼Œå¦‚æœå‘ç”Ÿå¼‚å¸¸å®•æœºï¼Œè¿™æ¡æ¶ˆæ¯å°±ä¸¢å¤±</span><br><span class="line"></span><br><span class="line"># å•æœºæµ‹è¯„</span><br><span class="line">ubuntu in ~ at 3BPlus took 37s</span><br><span class="line">âœ redis-benchmark -n <span class="number">1000000</span> -t lpush,rpop -P <span class="number">16</span> -q -h <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> -p <span class="number">6001</span> --cluster</span><br><span class="line">Cluster has <span class="number">3</span> master nodes:</span><br><span class="line"></span><br><span class="line">Master <span class="number">0</span>: a733c21d3b735b9d026eb4d462ef6b367d8ebb98 <span class="number">172</span>.<span class="number">30</span>.<span class="number">1</span>.<span class="number">23</span>:<span class="number">6002</span></span><br><span class="line">Master <span class="number">1</span>: 9c35a4e211f6534861ed768dba592e85539b1377 <span class="number">172</span>.<span class="number">30</span>.<span class="number">1</span>.<span class="number">23</span>:<span class="number">6003</span></span><br><span class="line">Master <span class="number">2</span>: a901e497cb72819cf0765e9e4eb16c36399c437b <span class="number">172</span>.<span class="number">30</span>.<span class="number">1</span>.<span class="number">23</span>:<span class="number">6001</span></span><br><span class="line"></span><br><span class="line">LPUSH: <span class="number">41529</span>.<span class="number">96</span> requests per second, p50=<span class="number">17</span>.<span class="number">199</span> msec</span><br><span class="line">RPOP: <span class="number">46539</span>.<span class="number">77</span> requests per second, p50=<span class="number">15</span>.<span class="number">463</span> msec</span><br></pre></td></tr></table></figure></li>
<li><p>Pub/Sub - å‘å¸ƒè®¢é˜…æ¨¡å‹</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¶ˆè´¹è€…1</span></span><br><span class="line">ubuntu <span class="keyword">in</span> ~ <span class="keyword">at</span> <span class="number">3</span>BPlus</span><br><span class="line">âœ redis-cli -c -p <span class="number">6001</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6001</span>&gt; SUBSCRIBE queue</span><br><span class="line">Reading messages... (press Ctrl-C <span class="keyword">to</span> quit)</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;queue&quot;</span></span><br><span class="line"><span class="number">3</span>) (<span class="built_in">integer</span>) <span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;message&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;queue&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;msg1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¶ˆè´¹è€…2</span></span><br><span class="line">ubuntu <span class="keyword">in</span> ~ <span class="keyword">at</span> <span class="number">3</span>BPlus</span><br><span class="line">âœ redis-cli -c -p <span class="number">6001</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6001</span>&gt; SUBSCRIBE queue</span><br><span class="line">Reading messages... (press Ctrl-C <span class="keyword">to</span> quit)</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;queue&quot;</span></span><br><span class="line"><span class="number">3</span>) (<span class="built_in">integer</span>) <span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;message&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;queue&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;msg1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿäº§è€…</span></span><br><span class="line">ubuntu <span class="keyword">in</span> ~ <span class="keyword">at</span> <span class="number">3</span>BPlus</span><br><span class="line">âœ redis-cli -c -p <span class="number">6001</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6001</span>&gt; PUBLISH queue msg1</span><br><span class="line">(<span class="built_in">integer</span>) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6001</span>&gt; PUBLISH queue msg2</span><br><span class="line">(<span class="built_in">integer</span>) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6001</span>&gt; <span class="keyword">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pub/Sub æ”¯æŒé˜»å¡å¼æ‹‰å–æ¶ˆæ¯ï¼Œæ»¡è¶³å¤šç»„æ¶ˆè´¹è€…ï¼ŒåŒ¹é…è®¢é˜…æ¨¡å¼,å…è®¸æ¶ˆè´¹è€…è®¢é˜…å¤šä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6001</span>&gt; PUBLISH queue.p1 msg1       <span class="comment">-- ç”Ÿäº§è€…</span></span><br><span class="line">(<span class="built_in">integer</span>) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6001</span>&gt; PUBLISH queue.p2 msg2</span><br><span class="line">(<span class="built_in">integer</span>) <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6001</span>&gt; PSUBSCRIBE queue.*          <span class="comment">-- æ¶ˆè´¹è€… åŒ¹é…è®¢é˜…</span></span><br><span class="line">Reading messages... (press Ctrl-C <span class="keyword">to</span> quit)</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;psubscribe&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;queue.*&quot;</span></span><br><span class="line"><span class="number">3</span>) (<span class="built_in">integer</span>) <span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;pmessage&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;queue.*&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;queue.p1&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;msg1&quot;</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;pmessage&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;queue.*&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;queue.p2&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;msg2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pub/Sub å®ç°åŸç†</span></span><br><span class="line">&gt; æ²¡æœ‰åŸºäºä»»ä½•æ•°æ®ç±»å‹ï¼Œæ²¡æœ‰åšä»»ä½•æ•°æ®å­˜å‚¨ï¼Œåªæ˜¯å•çº¯åœ°ä¸ºç”Ÿäº§è€…ã€æ¶ˆè´¹è€…å»ºç«‹æ•°æ®è½¬å‘é€šé“ï¼ŒæŠŠç¬¦åˆè§„åˆ™çš„æ•°æ®ï¼Œä»ä¸€ç«¯è½¬å‘åˆ°å¦ä¸€ç«¯</span><br><span class="line">&gt; **åœ¨ä½¿ç”¨Pub/Subæ—¶ï¼Œæ¶ˆè´¹è€…å¿…é¡»å…ˆè®¢é˜…é˜Ÿåˆ—ï¼Œç”Ÿäº§è€…æ‰èƒ½å‘å¸ƒæ¶ˆæ¯ï¼Œå¦åˆ™æ¶ˆæ¯ä¼šä¸¢å¤±**</span><br><span class="line">&gt; Listå±äºâ€œæ‹‰å–æ¨¡å¼â€, Pub/Subå±äºâ€œæ¨æ¨¡å¼â€</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ä½¿ç”¨Pub/Subä¼šä¸¢æ•°æ®</span></span><br><span class="line"><span class="number">1.</span> æ¶ˆè´¹è€…ä¸‹çº¿,é‡æ–°ä¸Šçº¿ï¼Œåªèƒ½æ¥æ”¶æ–°çš„æ¶ˆæ¯ï¼Œåœ¨ä¸‹çº¿æœŸé—´ç”Ÿäº§è€…å‘å¸ƒçš„æ¶ˆæ¯ï¼Œå› ä¸ºæ‰¾ä¸åˆ°æ¶ˆè´¹è€…ï¼Œä¼šè¢«ä¸¢å¼ƒæ‰.</span><br><span class="line"><span class="number">2.</span> Rediså®•æœº, Pub/Subç›¸å…³æ“ä½œï¼Œä¸ä¼šå†™å…¥RDBå’ŒAOFä¸­ï¼Œå½“Rediså®•æœºé‡å¯ï¼ŒPub/Subçš„æ•°æ®ä¼šå…¨éƒ¨ä¸¢å¤±</span><br><span class="line"><span class="number">3.</span> æ¶ˆè´¹å †ç§¯, æ¯ä¸ªæ¶ˆè´¹è€…è®¢é˜…ä¸€ä¸ªé˜Ÿåˆ—ï¼ŒRediséƒ½ä¼šåœ¨Serverç»™æ¶ˆè´¹è€…åˆ†é…ä¸€ä¸ªã€ç¼“å†²åŒºã€‘,è¿™ä¸ªç¼“å†²åŒºå…¶å®å°±æ˜¯ä¸€å—å†…å­˜ï¼Œå½“ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯æ—¶ï¼ŒRediså…ˆæŠŠæ¶ˆæ¯å†™åˆ°å¯¹åº”æ¶ˆè´¹è€…çš„ç¼“å†²åŒº,ä¹‹åæ¶ˆè´¹è€…ä¸æ–­ä»ç¼“å†²åŒºè¯»å–ã€å¤„ç†æ¶ˆæ¯, ç¼“å†²åŒºä¸Šçº¿,ä¼šè¢«å¼ºåˆ¶ä¸‹çº¿.</span><br></pre></td></tr></table></figure></li>
<li><p>Stream</p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Stream é€šè¿‡XADD å’Œ XREADå®Œæˆç®€å•çš„ç”Ÿäº§ã€æ¶ˆè´¹æ¨¡å‹</span></span><br><span class="line">  XADD: å‘å¸ƒæ¶ˆæ¯</span><br><span class="line">  XREAD: è¯»å–æ¶ˆæ¯</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6001</span>&gt; XADD <span class="keyword">queue</span> * name <span class="number">2021</span>      <span class="comment"># * è¡¨ç¤ºè‡ªåŠ¨ç”Ÿæˆå”¯ä¸€æ¶ˆæ¯ID</span></span><br><span class="line">-&gt; Redirected <span class="keyword">to</span> slot [<span class="number">13011</span>] located at <span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span></span><br><span class="line"><span class="string">&quot;1630886765690-0&quot;</span>                           <span class="comment">#æ¶ˆæ¯IDæ ¼å¼: æ—¶é—´æˆ³-è‡ªå¢åºå·</span></span><br><span class="line"><span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span>&gt; XADD <span class="keyword">queue</span> * name <span class="number">09</span>-<span class="number">06</span></span><br><span class="line"><span class="string">&quot;1630886777470-0&quot;</span></span><br><span class="line"><span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6001</span>&gt; XREAD COUNT <span class="number">5</span> STREAMS <span class="keyword">queue</span> <span class="number">0</span>-<span class="number">0</span>   <span class="comment"># ä»å¼€å¤´è¯»å–5æ¡æ¶ˆæ¯ï¼Œ0-0è¡¨ç¤ºä»å¼€å¤´è¯»å–</span></span><br><span class="line">-&gt; Redirected <span class="keyword">to</span> slot [<span class="number">13011</span>] located at <span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span></span><br><span class="line"><span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;queue&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;1630886765690-0&quot;</span></span><br><span class="line">         <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line">            <span class="number">2</span>) <span class="string">&quot;2021&quot;</span></span><br><span class="line">      <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;1630886777470-0&quot;</span></span><br><span class="line">         <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line">            <span class="number">2</span>) <span class="string">&quot;09-06&quot;</span></span><br><span class="line"><span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span>&gt; XREAD COUNT <span class="number">5</span> STREAMS <span class="keyword">queue</span> <span class="number">1630886777470</span>-<span class="number">0</span>  <span class="comment"># ç»§ç»­æ‹‰å–æ¶ˆæ¯,ä¼ å…¥ä¸Šä¸€æ¡æ¶ˆæ¯çš„ID</span></span><br><span class="line"><span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span>&gt; XREAD COUNT <span class="number">5</span> BLOCK <span class="number">0</span> STREAMS <span class="keyword">queue</span> <span class="number">1630886777470</span>-<span class="number">0</span>  <span class="comment"># BLOCK é˜»å¡å¼æ‹‰å–æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Stream æ”¯æŒå‘å¸ƒ/è®¢é˜…æ¨¡å¼</span></span><br><span class="line">  - XGROUP: åˆ›å»ºæ¶ˆè´¹è€…ç»„</span><br><span class="line">  - XREADGROUP: åœ¨æŒ‡å®šæ¶ˆè´¹ç»„ä¸‹ï¼Œå¼€å¯æ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯</span><br><span class="line"></span><br><span class="line">  <span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span>&gt; XGROUP CREATE <span class="keyword">queue</span> group1 <span class="number">0</span>-<span class="number">0</span>  <span class="comment"># åˆ›å»ºæ¶ˆè´¹è€…ç»„1ï¼Œ 0-0è¡¨ç¤ºä»å¤´æ‹‰å–æ¶ˆè´¹</span></span><br><span class="line">  OK</span><br><span class="line">  <span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span>&gt; XGROUP CREATE <span class="keyword">queue</span> group2 <span class="number">0</span>-<span class="number">0</span>  <span class="comment"># åˆ›å»ºæ¶ˆè´¹è€…ç»„2ï¼Œ0-0</span></span><br><span class="line">  OK</span><br><span class="line"></span><br><span class="line">  <span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span>&gt; XREADGROUP GROUP group1 consumer COUNT <span class="number">5</span> STREAMS <span class="keyword">queue</span> &gt;  <span class="comment"># group1 çš„consumerå¼€å§‹æ¶ˆè´¹ï¼Œ&gt;è¡¨ç¤ºæ‹‰å–æœ€æ–°æ•°æ®</span></span><br><span class="line"><span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;queue&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;1630886765690-0&quot;</span></span><br><span class="line">         <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line">            <span class="number">2</span>) <span class="string">&quot;2021&quot;</span></span><br><span class="line">      <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;1630886777470-0&quot;</span></span><br><span class="line">         <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line">            <span class="number">2</span>) <span class="string">&quot;09-06&quot;</span></span><br><span class="line">      <span class="number">3</span>) <span class="number">1</span>) <span class="string">&quot;1630887243865-0&quot;</span></span><br><span class="line">         <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line">            <span class="number">2</span>) <span class="string">&quot;08-14&quot;</span></span><br><span class="line">  <span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span>&gt; XREADGROUP GROUP group2 consumer COUNT <span class="number">5</span> STREAMS <span class="keyword">queue</span> &gt;</span><br><span class="line"><span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;queue&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;1630886765690-0&quot;</span></span><br><span class="line">         <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line">            <span class="number">2</span>) <span class="string">&quot;2021&quot;</span></span><br><span class="line">      <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;1630886777470-0&quot;</span></span><br><span class="line">         <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line">            <span class="number">2</span>) <span class="string">&quot;09-06&quot;</span></span><br><span class="line">      <span class="number">3</span>) <span class="number">1</span>) <span class="string">&quot;1630887243865-0&quot;</span></span><br><span class="line">         <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line">            <span class="number">2</span>) <span class="string">&quot;08-14&quot;</span></span><br><span class="line">  <span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span>&gt; XACK <span class="keyword">queue</span> group1 <span class="number">1630887243865</span>-<span class="number">0</span>  <span class="comment"># XACK å‘½ä»¤å‘ŠçŸ¥Redisæ¶ˆè´¹è€…å¤„ç†å®Œ</span></span><br><span class="line">  (integer) <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Stream æ•°æ®ä¼šå†™å…¥RDBå’ŒAOFåšæŒä¹…åŒ–A</span></span><br><span class="line"><span class="comment"># æ¶ˆæ¯å †ç§¯ï¼ŒStreamä¼šåªä¿ç•™å›ºå®šé•¿åº¦çš„æ–°æ¶ˆæ¯,å½“é˜Ÿåˆ—é•¿åº¦è¶…è¿‡ä¸Šé™ï¼Œå°±æ¶ˆæ¯ä¼šè¢«åˆ é™¤ï¼Œåªä¿ç•™å›ºå®šé•¿åº¦çš„æ–°æ¶ˆæ¯</span></span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>ç¼“å­˜</tag>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>echo-go-web-framework</title>
    <url>/2021/09/02/echo-go-web-framework/</url>
    <content><![CDATA[<h1 id="Echo"><a href="#Echo" class="headerlink" title="Echo"></a>Echo</h1><blockquote>
<p>é«˜æ€§èƒ½ã€å¯æ‰©å±•ã€ç²¾ç®€çš„Go Webæ¡†æ¶</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">âœ go run main.go</span><br><span class="line"></span><br><span class="line">   <span class="strong">____</span>    <span class="strong">__</span></span><br><span class="line"><span class="strong">  / __</span>/<span class="strong">__<span class="emphasis">_/ /  <span class="strong">__<span class="emphasis">_</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"> / _</span>// __</span>/ _</span> \/ <span class="emphasis">_ \</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">/<span class="strong">__<span class="emphasis">_/\<span class="strong">__/<span class="emphasis">_//_</span>/\__</span>_</span>/ v4.5.0</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">High performance, minimalist Go web framework</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">https://echo.labstack.com</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">__</span><span class="strong">____</span><span class="strong">____</span><span class="strong">____</span><span class="strong">____</span><span class="strong">____</span><span class="strong">____</span><span class="strong">____</span><span class="strong">____</span><span class="strong">__O/__</span><span class="strong">____</span>_</span></span></span><br><span class="line"><span class="strong">                                    O\</span></span><br><span class="line"><span class="strong">â‡¨ http server started on [::]:8080</span></span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h2 id="åŠŸèƒ½æ¦‚è¿°"><a href="#åŠŸèƒ½æ¦‚è¿°" class="headerlink" title="åŠŸèƒ½æ¦‚è¿°"></a>åŠŸèƒ½æ¦‚è¿°</h2><ul>
<li>Optimized HTTP router which smartly prioritize routes</li>
<li>Build robust and scalable RESTful APIs</li>
<li>Group APIs</li>
<li>Extensible middleware framework</li>
<li>Define middleware at root, group or route level</li>
<li>Data binding for JSON, XML and form payload</li>
<li>Handy functions to send variety of HTTP response</li>
<li>Centralized HTTP error handling</li>
<li>Template rendering with any template engine</li>
<li>Define your format for the logger</li>
<li>Highly customizable</li>
<li>Automatic TLS via Letâ€™s Encrypt</li>
<li>HTTP/2 support</li>
</ul>
]]></content>
      <tags>
        <tag>æ¡†æ¶</tag>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title>Dev-Ops Tips &amp; Tracks</title>
    <url>/2021/09/03/Dev-Ops-Tips-Tracks/</url>
    <content><![CDATA[<h1 id="DevOps-BOOTCAMP"><a href="#DevOps-BOOTCAMP" class="headerlink" title="DevOps BOOTCAMP"></a>DevOps BOOTCAMP</h1><span id="more"></span>

<h2 id="DevOps"><a href="#DevOps" class="headerlink" title="DevOps"></a>DevOps</h2><ul>
<li>Pipeline<figure class="highlight xl"><table><tr><td class="code"><pre><span class="line">C<span class="function"><span class="title">ollaborate</span> -&gt;</span> B<span class="function"><span class="title">uild</span> -&gt;</span> T<span class="function"><span class="title">est</span> -&gt;</span> D<span class="function"><span class="title">eploy</span> -&gt;</span> R<span class="function"><span class="title">un</span> -&gt;</span> C<span class="function"><span class="title">onfigure</span> -&gt;</span> Monitor</span><br></pre></td></tr></table></figure></li>
<li>Tradition: Development vs Operations<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># Development</span></span><br><span class="line"><span class="bullet">  -</span> programming languages</span><br><span class="line"><span class="bullet">  -</span> test frameworks</span><br><span class="line"><span class="bullet">  -</span> databases</span><br><span class="line"><span class="bullet">  -</span> version control</span><br><span class="line"></span><br><span class="line"><span class="section"># Operations</span></span><br><span class="line"><span class="bullet">  -</span> OS, mostly Linux</span><br><span class="line"><span class="bullet">  -</span> command-line</span><br><span class="line"><span class="bullet">  -</span> scripting</span><br><span class="line"><span class="bullet">  -</span> monitoring tools</span><br></pre></td></tr></table></figure></li>
<li>DevOps culture<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> DevOps was just a way <span class="keyword">of</span> working <span class="keyword">between</span> DEV<span class="string">&#x27;s and OP&#x27;</span>s</span><br><span class="line"><span class="number">2.</span> Common <span class="keyword">language</span> <span class="keyword">to</span> communicate</span><br></pre></td></tr></table></figure></li>
<li>Waterfall vs. Agile<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># Waterfall: ç€‘å¸ƒå¼€å‘</span></span><br><span class="line">  &gt; ineffective process</span><br><span class="line">  &gt; over time new requirements may arise</span><br><span class="line">  &gt; many places of failure and miscommunication</span><br><span class="line"><span class="bullet">  -</span> Requirements:</span><br><span class="line"><span class="bullet">    -</span> plan everything beforehend</span><br><span class="line"><span class="bullet">  -</span> Development:</span><br><span class="line"><span class="bullet">    -</span> developers code complete app</span><br><span class="line"><span class="bullet">  -</span> Testing:</span><br><span class="line"><span class="bullet">    -</span> testing after everything has developed</span><br><span class="line"><span class="bullet">  -</span> Operations:</span><br><span class="line"><span class="bullet">    -</span> huge preparation</span><br><span class="line"></span><br><span class="line"><span class="section"># Agile: æ•æ·å¼€å‘</span></span><br><span class="line">  &gt; speed of development, testing and development cycles</span><br><span class="line">  &gt; each feature gets tested, deployed</span><br><span class="line">  &gt; immediate feedback</span><br><span class="line">  &gt; fast development and deployment process</span><br><span class="line"><span class="bullet">  -</span> Continuous Integration:</span><br><span class="line"><span class="bullet">  -</span> Continuous Delivery:</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Operating-Systems"><a href="#Operating-Systems" class="headerlink" title="Operating Systems"></a>Operating Systems</h2><ul>
<li><p>OS &amp; Linux</p>
<figure class="highlight haml"><table><tr><td class="code"><pre><span class="line"># Intro Operating Systems</span><br><span class="line">  -<span class="ruby"> Hardware of <span class="symbol">Computer:</span></span></span><br><span class="line"><span class="ruby"></span>    &gt; CPU + Memory + Storage + I/O devices</span><br><span class="line">  -<span class="ruby"> Operating <span class="symbol">System:</span></span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> Translator</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> Manages Resources</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> CPU <span class="symbol">Management:</span></span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> Memory Management (RAM = Rapid Access Memory)</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> Memory Swape (Swap-out/Swap-<span class="keyword">in</span>)</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> Storage <span class="symbol">Management:</span></span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> Manage File <span class="symbol">System:</span></span></span><br><span class="line"><span class="ruby"></span>          -<span class="ruby"> stored <span class="keyword">in</span> a structured way</span></span><br><span class="line"><span class="ruby"></span>          -<span class="ruby"> <span class="keyword">in</span> Unix <span class="symbol">systems:</span> tree file system</span></span><br><span class="line"><span class="ruby"></span>          -<span class="ruby"> <span class="keyword">in</span> Windows <span class="symbol">OS:</span> multiple root folders</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> Management I/O Devices</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> Security &amp; Networking</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> <span class="symbol">Security:</span></span></span><br><span class="line"><span class="ruby"></span>          -<span class="ruby"> managing users <span class="keyword">and</span> permissions</span></span><br><span class="line"><span class="ruby"></span>        -<span class="ruby"> <span class="symbol">Networking:</span></span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> Isolates(éš”ç¦») content of application</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> Operating system <span class="symbol">Components:</span></span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> <span class="symbol">kernel:</span></span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> kernel is a program</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> Consists of device drivers, dispatcher, scheduler, File System etc.</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> <span class="symbol">POSIX:</span> Portable Operating System Interface</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> Linux <span class="keyword">and</span> MacOS both POSIX compliant</span></span><br></pre></td></tr></table></figure></li>
<li><p>Virtualizationè™šæ‹ŸåŒ–</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment"># VirtualBox:</span></span><br><span class="line">  &gt; VirtualBox takes<span class="built_in"> hardware </span>resources <span class="keyword">from</span> Host OS.</span><br><span class="line">  &gt; Creates virtual CPU, virtual RAM, virtual storage <span class="keyword">for</span> each virtual machine.</span><br><span class="line">  &gt;<span class="built_in"> Hardware </span>resources are shared</span><br><span class="line"></span><br><span class="line"><span class="comment"># Bare Metal(for server): Hardware -&gt; Hypervisor -&gt; Guest OS</span></span><br><span class="line">  - wmware ESXi</span><br><span class="line">  - Microsoft Hyper-v</span><br><span class="line"></span><br><span class="line">  - Efficient usage of<span class="built_in"> hardware </span>resources</span><br><span class="line">    - use all the resources of performant big<span class="built_in"> server</span></span><br><span class="line"><span class="built_in"></span>    -<span class="built_in"> Users </span>can choose any resources combinations</span><br><span class="line">  - Abstraction of the Operating<span class="built_in"> System </span><span class="keyword">from</span> the<span class="built_in"> hardware</span></span><br><span class="line"><span class="built_in"></span>    - Secure very easily</span><br><span class="line">    - Portable</span><br><span class="line">    - <span class="keyword">Not</span> dependent on physical<span class="built_in"> server</span></span><br><span class="line"><span class="built_in"></span><span class="comment"># Sharing things is not good for isolation</span></span><br></pre></td></tr></table></figure></li>
<li><p>Linux File System</p>
<figure class="highlight tcl"><table><tr><td class="code"><pre><span class="line">&gt; Everything in Linux is a File</span><br><span class="line"><span class="comment"># Linux File System</span></span><br><span class="line">  - hierarchical tree structure</span><br><span class="line">  - <span class="number">1</span> root folder</span><br><span class="line">  - multiple users on computer</span><br><span class="line">  - each user has its own space</span><br><span class="line">  - each user can have own configurations</span><br><span class="line">  - programs installed system wide, are avaiable <span class="keyword">for</span> all users</span><br><span class="line"></span><br><span class="line">  âœ tree / -L <span class="number">1</span></span><br><span class="line">  /</span><br><span class="line">  â”œâ”€â”€ bin -&gt; usr/bin      -- executables <span class="keyword">for</span> most essential user commands</span><br><span class="line">  â”œâ”€â”€ boot                -- contains files required <span class="keyword">for</span> booting (Read Only Folders)</span><br><span class="line">  â”œâ”€â”€ core</span><br><span class="line">  â”œâ”€â”€ dev                 -- location of device files, like webcam, keyboard, hard drive etc.</span><br><span class="line">  â”œâ”€â”€ etc                 -- place where configuration <span class="keyword">for</span> system-wide applications is stored</span><br><span class="line">  â”œâ”€â”€ home</span><br><span class="line">  â”œâ”€â”€ k8s_data</span><br><span class="line">  â”œâ”€â”€ lib -&gt; usr/lib      -- Essential shared libraries that executables from /bin or /sbin use</span><br><span class="line">  â”œâ”€â”€ lost+found</span><br><span class="line">  â”œâ”€â”€ media               -- contains subdirectories, where removable media devices inserted into the computer are mounted.</span><br><span class="line">  â”œâ”€â”€ mnt                 -- historically, sys admins mounted temporary <span class="keyword">file</span> systems there</span><br><span class="line">  â”œâ”€â”€ opt                 -- third-party program you install</span><br><span class="line">  â”œâ”€â”€ <span class="keyword">proc</span></span><br><span class="line">  â”œâ”€â”€<span class="title"> root</span></span><br><span class="line">  â”œâ”€â”€<span class="title"> run</span></span><br><span class="line">  â”œâ”€â”€<span class="title"> sbin</span> -&gt;<span class="title"> usr/sbin</span>    --<span class="title"> system</span> binaries:<span class="title"> essential</span> system<span class="title"> binaries</span> programs<span class="title"> that</span> admin<span class="title"> would</span> use (need<span class="title"> superuser</span> privilige)</span><br><span class="line">  â”œâ”€â”€<span class="title"> snap</span></span><br><span class="line">  â”œâ”€â”€<span class="title"> srv</span></span><br><span class="line">  â”œâ”€â”€<span class="title"> sys</span></span><br><span class="line">  â”œâ”€â”€<span class="title"> tmp</span>                 --<span class="title"> temporary</span> resources<span class="title"> required</span> for<span class="title"> some</span> process,<span class="title"> kept</span> here<span class="title"> temporarily</span></span><br><span class="line">  â”œâ”€â”€<span class="title"> usr</span>                 --<span class="title"> this</span> was<span class="title"> used</span> for<span class="title"> user</span> home<span class="title"> directories</span></span><br><span class="line">    â”œâ”€â”€<span class="title"> bin</span></span><br><span class="line">    â”œâ”€â”€<span class="title"> config</span></span><br><span class="line">    â”œâ”€â”€<span class="title"> games</span></span><br><span class="line">    â”œâ”€â”€<span class="title"> include</span></span><br><span class="line">    â”œâ”€â”€<span class="title"> lib</span></span><br><span class="line">    â”œâ”€â”€<span class="title"> libexec</span></span><br><span class="line">    â”œâ”€â”€<span class="title"> local</span>             --<span class="title"> Programs</span> that<span class="title"> you</span> install<span class="title"> on</span> the<span class="title"> computer;</span> will<span class="title"> be</span> avaiable<span class="title"> for</span> all<span class="title"> users</span> on<span class="title"> the</span> computer</span><br><span class="line">    â”œâ”€â”€<span class="title"> sbin</span></span><br><span class="line">    â”œâ”€â”€<span class="title"> share</span></span><br><span class="line">    â””â”€â”€<span class="title"> src</span></span><br><span class="line">  â””â”€â”€<span class="title"> var</span>                 --<span class="title"> contains</span> files<span class="title"> to</span> which<span class="title"> the</span> system<span class="title"> writes</span> data</span><br><span class="line">    â”œâ”€â”€<span class="title"> backups</span></span><br><span class="line">    â”œâ”€â”€<span class="title"> cache</span>             --<span class="title"> contains</span> cached<span class="title"> data</span> from<span class="title"> application</span> programs</span><br><span class="line">    â”œâ”€â”€<span class="title"> crash</span></span><br><span class="line">    â”œâ”€â”€<span class="title"> lib</span></span><br><span class="line">    â”œâ”€â”€<span class="title"> local</span></span><br><span class="line">    â”œâ”€â”€<span class="title"> lock</span> -&gt; /run/lock</span><br><span class="line">    â”œâ”€â”€<span class="title"> log</span>               --<span class="title"> contains</span> log<span class="title"> files</span></span><br><span class="line">    â”œâ”€â”€<span class="title"> mail</span></span><br><span class="line">    â”œâ”€â”€<span class="title"> opt</span></span><br><span class="line">    â”œâ”€â”€<span class="title"> run</span> -&gt; /run</span><br><span class="line">    â”œâ”€â”€<span class="title"> snap</span></span><br><span class="line">    â”œâ”€â”€<span class="title"> spool</span></span><br><span class="line">    â”œâ”€â”€<span class="title"> tmp</span></span><br><span class="line">    â””â”€â”€<span class="title"> www</span></span><br><span class="line">  21<span class="title"> directories,</span> 1<span class="title"> file</span></span><br><span class="line"></span><br><span class="line">  - /usr/local<span class="title"> vs.</span> /opt</span><br><span class="line">    - /usr/local:</span><br><span class="line">      -<span class="title"> programs,</span> which<span class="title"> split</span> its<span class="title"> components</span></span><br><span class="line">    - /opt:</span><br><span class="line">      -<span class="title"> programs,</span> which<span class="title"> NOT</span> split<span class="title"> its</span> components</span><br><span class="line"></span><br><span class="line">#<span class="title"> Hidden</span> Files</span><br><span class="line">  -<span class="title"> ls</span> primarily<span class="title"> used</span> to<span class="title"> help</span> prevent<span class="title"> important</span> data<span class="title"> from</span> being<span class="title"> accientally</span> deleted</span><br><span class="line">  -<span class="title"> Automatically</span> generated<span class="title"> by</span> programs<span class="title"> or</span> operating<span class="title"> system</span></span><br><span class="line">  -<span class="title"> File</span> name<span class="title"> starts</span> with<span class="title"> a</span> dot</span><br><span class="line">  -<span class="title"> In</span> UNIX<span class="title"> also</span> called &quot;dotfiles&quot;</span><br><span class="line"></span><br><span class="line">#<span class="title"> Windows</span> File<span class="title"> System</span></span><br><span class="line">  -<span class="title"> multiple</span> root<span class="title"> folders</span></span><br><span class="line">  -<span class="title"> A,B:</span> Removable<span class="title"> Disks</span></span><br><span class="line">  -<span class="title"> C:</span> Local<span class="title"> Disk</span> -<span class="title"> Internal</span> hard<span class="title"> drive</span></span><br></pre></td></tr></table></figure></li>
<li><p>Basic Linux Command</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line"><span class="comment"># GUI vs. CLI</span></span><br><span class="line">  - GUI = A graphical user interface</span><br><span class="line">  - CLI = Command Line Interface</span><br><span class="line"></span><br><span class="line">ubuntu <span class="keyword">in</span> ~ <span class="keyword">at</span> k8s-node1 via ğŸ¹ v1<span class="number">.16</span><span class="number">.5</span> via ğŸ <span class="number">3.8</span><span class="number">.6</span></span><br><span class="line">âœ</span><br><span class="line">  - ubuntu: user name</span><br><span class="line">  - k8s-node1: computer name</span><br><span class="line">  - ~: home <span class="built_in">directory</span></span><br><span class="line">  - $: represents regular user</span><br><span class="line">  - <span class="comment">#: sign for root user</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Folder Operations</span></span><br><span class="line">  - pwd: Show current <span class="built_in">directory</span></span><br><span class="line">  - ls: List <span class="built_in">folders</span> <span class="keyword">and</span> <span class="built_in">files</span></span><br><span class="line">    - ls -<span class="keyword">a</span> = Show all (including hidden)</span><br><span class="line">  - cd: Change <span class="built_in">directory</span> <span class="built_in">to</span> [dir]</span><br><span class="line">  - mkdir: Make <span class="built_in">directory</span> [dirname]</span><br><span class="line"></span><br><span class="line"><span class="comment"># File Operations</span></span><br><span class="line">  - touch [filename]: Create [filename]</span><br><span class="line">  - rm [filename]: Delete [filename]</span><br><span class="line">    - rm -r [dirname]: Delete <span class="keyword">a</span> non-<span class="literal">empty</span> <span class="built_in">directory</span> <span class="keyword">and</span> all <span class="keyword">the</span> <span class="built_in">files</span> <span class="keyword">within</span> <span class="keyword">it</span>.</span><br><span class="line">    - rm -d [dirname] <span class="keyword">or</span> rmdir [dirname]: Delete <span class="keyword">an</span> <span class="literal">empty</span> <span class="built_in">directory</span></span><br><span class="line">  - mv [filename] [new_filename] = Rename <span class="keyword">the</span> <span class="built_in">file</span> <span class="built_in">to</span> <span class="keyword">a</span> <span class="built_in">new</span> filename</span><br><span class="line">  - cp -r [dirname] [new_dirname] = Copy dirname <span class="built_in">to</span> new_dirname</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display OS Information</span></span><br><span class="line">  - uname -<span class="keyword">a</span>: Show <span class="keyword">system</span> <span class="keyword">and</span> kernel</span><br><span class="line">  Linux k8s-node1 <span class="number">5.4</span><span class="number">.0</span><span class="number">-1043</span>-raspi <span class="comment">#47-Ubuntu SMP PREEMPT Mon Aug 23 09:41:31 UTC 2021 aarch64 aarch64 aarch64 GNU/Linux</span></span><br><span class="line"></span><br><span class="line">  âœ cat /etc/os-release</span><br><span class="line">  NAME=<span class="string">&quot;Ubuntu&quot;</span></span><br><span class="line">  VERSION=<span class="string">&quot;20.04.3 LTS (Focal Fossa)&quot;</span></span><br><span class="line">  ID=ubuntu</span><br><span class="line">  ID_LIKE=debian</span><br><span class="line">  PRETTY_NAME=<span class="string">&quot;Ubuntu 20.04.3 LTS&quot;</span></span><br><span class="line">  VERSION_ID=<span class="string">&quot;20.04&quot;</span></span><br><span class="line">  HOME_URL=<span class="string">&quot;https://www.ubuntu.com/&quot;</span></span><br><span class="line">  SUPPORT_URL=<span class="string">&quot;https://help.ubuntu.com/&quot;</span></span><br><span class="line">  BUG_REPORT_URL=<span class="string">&quot;https://bugs.launchpad.net/ubuntu/&quot;</span></span><br><span class="line">  PRIVACY_POLICY_URL=<span class="string">&quot;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy&quot;</span></span><br><span class="line">  VERSION_CODENAME=focal</span><br><span class="line">  UBUNTU_CODENAME=focal</span><br><span class="line"></span><br><span class="line">  - lscpu:</span><br><span class="line">  - lsmem:</span><br><span class="line">  - sudo: Allows regular users <span class="built_in">to</span> run programs <span class="keyword">with</span> <span class="keyword">the</span> security privileges <span class="keyword">of</span> <span class="keyword">the</span> superusere <span class="keyword">or</span> root</span><br><span class="line">  - su - chyi: <span class="keyword">switch</span> user</span><br><span class="line"></span><br><span class="line"><span class="comment"># Some More Useful Commands</span></span><br><span class="line">  - <span class="built_in">clear</span>: Clears <span class="keyword">the</span> terminal</span><br><span class="line">  - history: Gives <span class="keyword">a</span> list <span class="keyword">of</span> all past commands typed <span class="keyword">in</span> <span class="keyword">the</span> current terminal session</span><br><span class="line">  - Ctrl + r: Search history</span><br><span class="line">  - Ctrl + c: Stop current <span class="keyword">command</span></span><br><span class="line">  - cat [filename]: Display <span class="keyword">the</span> <span class="built_in">file</span> content</span><br></pre></td></tr></table></figure></li>
<li><p>Package Manager</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">  <span class="number">1</span>. central plcae to install, upgrade,configure, remove software</span><br><span class="line"></span><br><span class="line"># APT - Advanced <span class="keyword">Package</span> <span class="title">Tool</span></span><br><span class="line">  &gt; Dependencies are shared</span><br><span class="line">  &gt; Only <span class="keyword">for</span> specific Linux distributions (<span class="keyword">package</span> <span class="title">type .deb)</span></span><br><span class="line">  &gt; Manual Updates</span><br><span class="line">  - apt search &lt;package_name&gt; = Search <span class="keyword">for</span> a given <span class="keyword">package</span></span><br><span class="line">  <span class="title">- apt install &lt;package_name&gt; = Install a given <span class="keyword">package</span></span></span><br><span class="line">  - apt remove &lt;package_name&gt; = Remove installed <span class="keyword">package</span></span><br><span class="line">  <span class="title">- apt update = Updates the packages index</span></span><br><span class="line"></span><br><span class="line"># Repositories:</span><br><span class="line">  &gt; storage location, containing thousands <span class="keyword">of</span> programs</span><br><span class="line"></span><br><span class="line"># Snap <span class="keyword">Package</span> <span class="title">Manager:</span></span><br><span class="line">  &gt; A snap <span class="keyword">is</span> a bundle <span class="keyword">of</span> an app <span class="keyword">and</span> its dependencies</span><br><span class="line">  &gt; Supports universal Linux packages (<span class="keyword">package</span> <span class="title">type .snap)</span></span><br><span class="line">  &gt; Automatic Updates</span><br><span class="line">  - Self-contained - dependencies contained <span class="keyword">in</span> the <span class="keyword">package</span></span><br><span class="line"></span><br><span class="line"><span class="title"># Add Repository to official l</span>ist <span class="keyword">of</span> repos (add-apt-repository)</span><br><span class="line"># PPA = Personal <span class="keyword">Package</span> <span class="title">Archive</span></span><br><span class="line">  - PPAs are provided by the community</span><br><span class="line"></span><br><span class="line"># Debian Based:   <span class="comment">-- APT/APT-GET</span></span><br><span class="line">  - Ubuntu</span><br><span class="line">  - Debian</span><br><span class="line">  - Mint</span><br><span class="line"># Red Had Based:  <span class="comment">-- Yum</span></span><br><span class="line">  - RHEL</span><br><span class="line">  - CentOS</span><br><span class="line">  - Fedora</span><br></pre></td></tr></table></figure></li>
<li><p>Vim Editor</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"># Vim Mode:</span><br><span class="line">  - Command Mode:</span><br><span class="line">    - Navigate, Search, <span class="keyword">Delete</span>, Undo etc.</span><br><span class="line">    - Whatever you <span class="built_in">type</span> <span class="keyword">is</span> interpreted <span class="keyword">as</span> a command</span><br><span class="line">  - <span class="keyword">Insert</span> Mode:</span><br><span class="line">#</span><br><span class="line">- Press i <span class="keyword">key</span> = Switch <span class="keyword">to</span> <span class="keyword">insert</span> Mode</span><br><span class="line">- Press esc <span class="keyword">key</span> = Switch <span class="keyword">to</span> Command Mode</span><br><span class="line">- <span class="built_in">Type</span> dd = <span class="keyword">Delete</span> entire line</span><br><span class="line">- <span class="built_in">Type</span> d10 = <span class="keyword">Delete</span> next <span class="number">10</span> lines</span><br><span class="line">- <span class="built_in">Type</span> u = Undo</span><br><span class="line">- <span class="built_in">Type</span> $ = Jump <span class="keyword">to</span> <span class="keyword">end</span> of the line</span><br><span class="line">- <span class="built_in">Type</span> <span class="number">0</span> = Jump <span class="keyword">to</span> <span class="keyword">start</span> of the line</span><br><span class="line">- <span class="built_in">Type</span> /pattern = Search <span class="keyword">for</span> pattern</span><br><span class="line">- <span class="built_in">Type</span> :%s/old/new = <span class="built_in">Replace</span> old <span class="keyword">with</span> new throughout the file</span><br></pre></td></tr></table></figure></li>
<li><p>Users &amp; Permissions</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># User Accounts:</span></span><br><span class="line">  - Superuser Account:</span><br><span class="line">  - <span class="keyword">User</span> <span class="title">Account</span>:</span><br><span class="line">  - Service Account:</span><br><span class="line">    - Don&#x27;t run services with root user!</span><br><span class="line"></span><br><span class="line">  - adduser <span class="tag">&lt;username&gt;</span> = Create a new <span class="keyword">user</span></span><br><span class="line"></span><br><span class="line"><span class="title"># Groups</span> &amp; Ownership</span><br><span class="line">  - <span class="keyword">User</span> <span class="title">Level</span>:</span><br><span class="line">  - <span class="keyword">Group</span> <span class="title">Level</span>:</span><br><span class="line"></span><br><span class="line"><span class="comment"># Access Control Files:</span></span><br><span class="line">  - /etc/passwd:</span><br><span class="line">    - Stores <span class="keyword">user</span> <span class="title">account</span> <span class="literal">inf</span>ormation</span><br><span class="line">    - Everyone can <span class="keyword">read</span> it, but only root <span class="keyword">user</span> <span class="title">can</span> change the file</span><br><span class="line"></span><br><span class="line">    âœ cat /etc/passwd | grep pi</span><br><span class="line">    pi:x:<span class="number">1000</span>:<span class="number">1000</span>:,,,:/home/pi:/usr/bin/zsh</span><br><span class="line">    USERNAME:PASSWORD:UID:GID:GECOS:HOMEDIR:SHELL</span><br><span class="line">      - PASSWORD(x) means, that encrypted password is stored <span class="keyword">in</span> /etc/shadow file</span><br><span class="line">      - <span class="keyword">User</span> <span class="title">ID</span>(UID): Each <span class="keyword">user</span> <span class="title">has</span> a unique ID. UID <span class="number">0</span> is reserved for root</span><br><span class="line">  - /etc/shadow</span><br><span class="line">  - /etc/<span class="keyword">group</span></span><br><span class="line"></span><br><span class="line"><span class="title"># File</span> Permissions</span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux Commands for Managing Users and their permissions</span></span><br><span class="line">  - passwd <span class="tag">&lt;username&gt;</span> = Change password of a <span class="keyword">user</span></span><br><span class="line">  <span class="title">- su</span> - <span class="tag">&lt;username&gt;</span> = Login as username (su = switch user)</span><br><span class="line">  - su - = Login as root</span><br><span class="line">  - groupadd <span class="tag">&lt;groupname&gt;</span> = Create new <span class="keyword">group</span></span><br><span class="line">  <span class="title">- usermod</span> [OPTIONS] <span class="tag">&lt;username&gt;</span> = Modify a <span class="keyword">user</span> <span class="title">account</span></span><br><span class="line">  - useradd [OPTIONS] <span class="tag">&lt;username&gt;</span> = Create a new <span class="keyword">user</span></span><br><span class="line">  <span class="title">- groups</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Different User &amp; Group Commands</span></span><br><span class="line">  - adduser/addgroup/deluser/delgroup:</span><br><span class="line">    - More <span class="keyword">User</span> <span class="title">Friendly</span></span><br><span class="line">  - useradd/groupadd/userdel/groupdel:</span><br><span class="line">    - Low-level utilties</span><br></pre></td></tr></table></figure></li>
<li><p>Shell Scripting</p>
</li>
<li><p>Environmemt Variables</p>
</li>
<li><p>Networking</p>
</li>
<li><p>SSH - Secure Shell</p>
</li>
</ul>
<h2 id="Version-Control"><a href="#Version-Control" class="headerlink" title="Version Control"></a>Version Control</h2><ul>
<li>GUI Git<ul>
<li>github</li>
<li>gitlab<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Git global setup</span></span><br><span class="line"><span class="meta">  $</span><span class="bash"> git config --global user.name <span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="meta">  $</span><span class="bash"> git config --global user.email <span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Create a new repository</span></span><br><span class="line"><span class="meta">  $</span><span class="bash"> git <span class="built_in">clone</span> git@gitlab.com:</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Push an existing folder</span></span><br><span class="line"><span class="meta">  $</span><span class="bash"> <span class="built_in">cd</span> existing_folder</span></span><br><span class="line"><span class="meta">  $</span><span class="bash"> git init</span></span><br><span class="line"><span class="meta">  $</span><span class="bash"> git remote add origin https://gitlab.com/chyiyaqing/my-project.git</span></span><br><span class="line"><span class="meta">  $</span><span class="bash"> git branch -M main</span></span><br><span class="line"><span class="meta">  $</span><span class="bash"> git push -uf origin main</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨SSH Key</span></span><br><span class="line">  - GitHub/GitLab can authenticate us when pushing/pulling from repository</span><br><span class="line">  - without providing username and password each time.</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>Git<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># Git Stages</span></span><br><span class="line"><span class="bullet">  -</span> Working Directory (git add -&gt; Staging Area)</span><br><span class="line"><span class="bullet">  -</span> Staging Area (git commit -&gt; Local Repository)</span><br><span class="line"><span class="bullet">  -</span> Local Repository</span><br><span class="line"></span><br><span class="line"><span class="section"># Git Command Tools</span></span><br><span class="line"><span class="bullet">  -</span> git status : status of local git repo</span><br><span class="line"><span class="bullet">  -</span> git add:</span><br><span class="line"><span class="bullet">  -</span> git commit:</span><br><span class="line"><span class="bullet">  -</span> git log: history of local repository changes</span><br><span class="line"><span class="bullet">  -</span> git init:</span><br><span class="line"><span class="bullet">  -</span> git pull:</span><br><span class="line"><span class="bullet">  -</span> git checkout <span class="xml"><span class="tag">&lt;<span class="name">branch</span> <span class="attr">name</span>&gt;</span></span> = switch branches</span><br><span class="line"><span class="bullet">  -</span> git checkout -b <span class="xml"><span class="tag">&lt;<span class="name">branch</span> <span class="attr">name</span>&gt;</span></span> = creating and switching to new branch</span><br><span class="line"><span class="section"># Branch</span></span><br><span class="line"><span class="bullet">  -</span> Master branch = main branch is created by default, when initializing a git repo</span><br><span class="line"><span class="bullet">    -</span> best practice: 1 branch per bugfix or feature</span><br><span class="line"><span class="bullet">    -</span> big feature branches long open, increase the chanceee of merge conflicts</span><br><span class="line"><span class="bullet">    -</span> only master branch for continuous integration/delivery</span><br><span class="line"><span class="bullet">    -</span> pipeline is triggered whenever feature/bugfix code is merged into master</span><br><span class="line"><span class="bullet">    -</span> must be stable and ready for production</span><br><span class="line"><span class="bullet">  -</span> Develop Branch</span><br><span class="line"><span class="bullet">    -</span> dev branch: intermediary master</span><br><span class="line"></span><br><span class="line"><span class="section"># Merge Requests:</span></span><br><span class="line"><span class="bullet">  -</span> Best practice: Other developer reviews code changes before merging</span><br><span class="line"><span class="section"># Git åè¯è§£é‡Š</span></span><br><span class="line"><span class="bullet">  -</span> origin = your remote git project/repo</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Build-Tools"><a href="#Build-Tools" class="headerlink" title="Build Tools"></a>Build Tools</h2><h2 id="Artifact-Repository-Manager"><a href="#Artifact-Repository-Manager" class="headerlink" title="Artifact Repository Manager"></a>Artifact Repository Manager</h2><h2 id="CI-CD"><a href="#CI-CD" class="headerlink" title="CI/CD"></a>CI/CD</h2><h2 id="Cloud-IaaS"><a href="#Cloud-IaaS" class="headerlink" title="Cloud - IaaS"></a>Cloud - IaaS</h2><h2 id="Infrastructure-Privisioning"><a href="#Infrastructure-Privisioning" class="headerlink" title="Infrastructure Privisioning"></a>Infrastructure Privisioning</h2><h2 id="Programming"><a href="#Programming" class="headerlink" title="Programming"></a>Programming</h2><h2 id="Containers"><a href="#Containers" class="headerlink" title="Containers"></a>Containers</h2><h2 id="Container-Orchestration"><a href="#Container-Orchestration" class="headerlink" title="Container Orchestration"></a>Container Orchestration</h2><h2 id="Configuration-Management"><a href="#Configuration-Management" class="headerlink" title="Configuration Management"></a>Configuration Management</h2><h2 id="Monitoring"><a href="#Monitoring" class="headerlink" title="Monitoring"></a>Monitoring</h2><h2 id="ä¸“ä¸šåè¯"><a href="#ä¸“ä¸šåè¯" class="headerlink" title="ä¸“ä¸šåè¯"></a>ä¸“ä¸šåè¯</h2><ul>
<li>LTS = Long Term Support</li>
</ul>
<h2 id="Wrap-Up-æ€»ç»“"><a href="#Wrap-Up-æ€»ç»“" class="headerlink" title="Wrap Up: æ€»ç»“"></a>Wrap Up: æ€»ç»“</h2><ul>
<li>Pipeline<br><img src="/misc/images/devops-pipeline.png" alt="Pipeline å¼€å‘æµç¨‹"></li>
</ul>
]]></content>
      <tags>
        <tag>DevOps</tag>
        <tag>Bootcamp</tag>
      </tags>
  </entry>
  <entry>
    <title>Distribute Scraping for Gophers</title>
    <url>/2021/09/03/Distribute-Scraping-for-Gophers/</url>
    <content><![CDATA[<h1 id="åˆ†å¸ƒå¼çˆ¬è™«"><a href="#åˆ†å¸ƒå¼çˆ¬è™«" class="headerlink" title="åˆ†å¸ƒå¼çˆ¬è™«"></a>åˆ†å¸ƒå¼çˆ¬è™«</h1><blockquote>
<p>åˆ†å¸ƒå¼çˆ¬è™«æ˜¯ä¸€å¥—ä»»åŠ¡åˆ†å‘å’Œæ‰§è¡Œç³»ç»Ÿï¼Œå¸¸è§çš„ä»»åŠ¡åˆ†å‘ï¼Œå› ä¸ºä¸Šä¸‹æ¸¸å­˜åœ¨é€Ÿåº¦ä¸åŒ¹é…é—®é¢˜ï¼Œéœ€è¦å€ŸåŠ©æ¶ˆæ¯é˜Ÿåˆ—</p>
</blockquote>
<span id="more"></span>

<h2 id="åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—"><a href="#åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—"></a>åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—</h2><ul>
<li>nats<blockquote>
<p>natsæ˜¯Goå®ç°çš„é«˜æ€§èƒ½åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé€‚ç”¨äºé«˜å¹¶å‘ååé‡çš„æ¶ˆæ¯åˆ†å‘åœºæ™¯.</p>
</blockquote>
</li>
</ul>
]]></content>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>çˆ¬è™«</tag>
      </tags>
  </entry>
  <entry>
    <title>Elasticsearch Tips &amp; Tracks</title>
    <url>/2021/09/03/Elasticsearch-Tips-Tracks/</url>
    <content><![CDATA[<h1 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h1><blockquote>
<p>Elasticsearchæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æœç´¢ä¸åˆ†æå¼•æ“ï¼Œæä¾›è¿‘å®æ—¶æœç´¢å’ŒèšåˆåŠŸèƒ½<br>Elastic Stackä¸»è¦åº”ç”¨äºï¼šæœç´¢ã€æ—¥å¿—ç®¡ç†ã€å®‰å…¨åˆ†æã€æŒ‡æ ‡åˆ†æã€ä¸šåŠ¡åˆ†æã€åº”ç”¨æ€§èƒ½ç›‘æ§ç­‰å¤šä¸ªé¢†åŸŸ<br>â€œSearch is something that any application should have.â€</p>
</blockquote>
<span id="more"></span>

<h2 id="Elastic-Stack-ç”Ÿæ€åœˆ"><a href="#Elastic-Stack-ç”Ÿæ€åœˆ" class="headerlink" title="Elastic Stack ç”Ÿæ€åœˆ"></a>Elastic Stack ç”Ÿæ€åœˆ</h2><ul>
<li><p>è§£å†³æ–¹æ¡ˆ:</p>
<ul>
<li>æœç´¢</li>
<li>æ—¥å¿—åˆ†æ</li>
<li>æŒ‡æ ‡åˆ†æ</li>
<li>å®‰å…¨åˆ†æ</li>
</ul>
</li>
<li><p>å¯è§†åŒ–:</p>
<ul>
<li>Kibana: å¯è§†åŒ–åˆ†æ</li>
</ul>
</li>
<li><p>å­˜å‚¨/è®¡ç®—:</p>
<ul>
<li>Elasticsearch: æ ¸å¿ƒå¼•æ“,æä¾›æ•°æ®å­˜å‚¨ã€æœç´¢å’Œèšåˆçš„èƒ½åŠ›</li>
</ul>
</li>
<li><p>æ•°æ®æŠ“å–:</p>
<ul>
<li>Logstash<blockquote>
<p>å¼€æºçš„æœåŠ¡å™¨ç«¯æ•°æ®å¤„ç†ç®¡é“ï¼Œæ”¯æŒä»ä¸åŒæ¥æºé‡‡é›†æ•°æ®ï¼Œè½¬æ¢æ•°æ®ï¼Œå¹¶å°†æ•°æ®å‘é€åˆ°ä¸åŒçš„å­˜å‚¨åº“ä¸­</p>
</blockquote>
</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># ç‰¹æ€§:</span></span><br><span class="line"><span class="bullet">  1.</span> å®æ—¶è§£æå’Œè½¬æ¢æ•°æ®</span><br><span class="line"><span class="code">    &gt; ä»IPåœ°å€ç ´è¯‘åœ°ç†ä½ç½®</span></span><br><span class="line"><span class="code">    &gt; ä»PIIæ•°æ®åŒ¿ååŒ–ï¼Œæ’é™¤æ•æ„Ÿå­—æ®µ</span></span><br><span class="line"><span class="code">  2. å¯æ‰©å±•</span></span><br><span class="line"><span class="code">  3. å¯é æ€§å®‰å…¨æ€§</span></span><br><span class="line"><span class="code">    &gt; Logstash é€šè¿‡æŒä¹…åŒ–é˜Ÿåˆ—ä¿è¯è‡³å°‘å°†è¿è¡Œä¸­çš„äº‹ä»¶é€è¾¾ä¸€æ¬¡</span></span><br><span class="line"><span class="code">    &gt; æ•°æ®ä¼ è¾“åŠ å¯†</span></span><br><span class="line"><span class="code">  4. åŠ å¯†</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Beats<blockquote>
<p>è½»é‡çº§åˆ«æ•°æ®é‡‡é›†å™¨</p>
</blockquote>
</li>
</ul>
</li>
<li><p>X-Pack: å•†ä¸šåŒ–å¥—ä»¶</p>
</li>
</ul>
<blockquote>
<p>Elasticsearchä¸æ•°æ®åº“çš„é›†æˆ</p>
</blockquote>
<p><img src="/misc/images/Elastichsearch.png" alt="Elastichsearch"></p>
<blockquote>
<p>æŒ‡æ ‡åˆ†æ/æ—¥å¿—åˆ†æ</p>
</blockquote>
<ul>
<li>Data Collection(beats) -&gt; Buffering(redis,Kafkak) -&gt; Data Aggregation &amp; Processing(logstash) -&gt; Indexing &amp; storage(elasticsearch) -&gt; Analysis &amp; visualization(Kbana)</li>
</ul>
<h2 id="Elasticsearch-1"><a href="#Elasticsearch-1" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h2><ul>
<li><p>Elasticsearch ç›®å½•ç»“æ„</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">ubuntu <span class="keyword">in</span> ~/elasticsearch-<span class="number">7.14</span>.<span class="number">1</span> <span class="keyword">at</span> k8s-node1 took <span class="number">45</span>s</span><br><span class="line">âœ tree -L <span class="number">1</span></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ bin                 <span class="comment">-- è„šæœ¬æ–‡ä»¶ï¼ŒåŒ…æ‹¬å¯åŠ¨elasticsearch,å®‰è£…æ’ä»¶ï¼Œè¿è¡Œç»Ÿè®¡æ•°æ®</span></span><br><span class="line">â”œâ”€â”€ config              <span class="comment">-- elasticsearch.yml é›†ç¾¤é…ç½®æ–‡ä»¶ï¼Œuser, role based ç›¸å…³é…ç½®</span></span><br><span class="line">â”œâ”€â”€ jdk                 <span class="comment">-- Java è¿è¡Œç¯å¢ƒ</span></span><br><span class="line">â”œâ”€â”€ lib                 <span class="comment">-- Java ç±»åº“</span></span><br><span class="line">â”œâ”€â”€ LICENSE.txt</span><br><span class="line">â”œâ”€â”€ logs                <span class="comment">-- path.log æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">â”œâ”€â”€ modules             <span class="comment">-- åŒ…å«æ‰€æœ‰ESæ¨¡å—</span></span><br><span class="line">â”œâ”€â”€ NOTICE.txt</span><br><span class="line">â”œâ”€â”€ plugins             <span class="comment">-- åŒ…å«æ‰€æœ‰å·²å®‰è£…æ’ä»¶</span></span><br><span class="line">â””â”€â”€ README.asciidoc</span><br></pre></td></tr></table></figure></li>
<li><p>JVM é…ç½®</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line"><span class="attr"># ä¿®æ”¹JVM - config/jvm.options</span></span><br><span class="line"><span class="attr">  -Xmså’ŒXms æœ€å°æœ€å¤§å†…å­˜è®¾ç½®æˆä¸€æ ·</span></span><br><span class="line"><span class="attr">  -Xmxä¸è¶…è¿‡æœºå™¨å†…å­˜çš„50</span><span class="meta">%</span></span><br></pre></td></tr></table></figure></li>
<li><p>Run</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">$ bin/elasticsearch</span><br><span class="line"><span class="symbol">~ took 11m 31s</span></span><br><span class="line"><span class="symbol">âœ curl http</span>:<span class="comment">//localhost:9200</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span> : <span class="string">&quot;a714f28827d5&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;docker-cluster&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;96jmRuNUQxqFsGeWJjIo6g&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;number&quot;</span> : <span class="string">&quot;7.14.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_flavor&quot;</span> : <span class="string">&quot;default&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_type&quot;</span> : <span class="string">&quot;docker&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_hash&quot;</span> : <span class="string">&quot;66b55ebfa59c92c15db3f69a335d500018b3331e&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_date&quot;</span> : <span class="string">&quot;2021-08-26T09:01:05.390870785Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_snapshot&quot;</span> : false,</span><br><span class="line">    <span class="string">&quot;lucene_version&quot;</span> : <span class="string">&quot;8.9.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_wire_compatibility_version&quot;</span> : <span class="string">&quot;6.8.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_index_compatibility_version&quot;</span> : <span class="string">&quot;6.0.0-beta1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;tagline&quot;</span> : <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Plugin æœºåˆ¶å¯¹ç³»ç»Ÿæ‰©å±•</p>
<blockquote>
<p>Discovery Plugin<br>Analysis Plugin<br>Security Plugin<br>Management Plugin<br>Ingest Plugin<br>Mapper Plugin<br>Backup Plugin</p>
</blockquote>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">ubuntu <span class="keyword">in</span> ~ at k8s-node1 via ğŸ <span class="number">3.8</span><span class="number">.6</span></span><br><span class="line">âœ elasticsearch-plugin install analysis-icu  # åˆ†è¯æ’ä»¶</span><br><span class="line">-&gt; Installing analysis-icu</span><br><span class="line">-&gt; Downloading analysis-icu <span class="keyword">from</span> elastic</span><br><span class="line">[=================================================] <span class="number">100</span>%</span><br><span class="line">-&gt; Installed analysis-icu</span><br><span class="line">-&gt; Please restart Elasticsearch to activate any plugins installed</span><br><span class="line"></span><br><span class="line">ubuntu <span class="keyword">in</span> ~ at k8s-node1 via ğŸ <span class="number">3.8</span><span class="number">.6</span> took <span class="number">23</span>s</span><br><span class="line">âœ elasticsearch-plugin list</span><br><span class="line">analysis-icu</span><br><span class="line"></span><br><span class="line">ubuntu <span class="keyword">in</span> ~ at k8s-node1 via ğŸ <span class="number">3.8</span><span class="number">.6</span></span><br><span class="line">âœ curl http:<span class="comment">//localhost:9200/_cat/plugins</span></span><br><span class="line">k8s-node1 analysis-icu <span class="number">7.14</span><span class="number">.1</span></span><br></pre></td></tr></table></figure></li>
<li><p>å¤šé›†ç¾¤<br><a href="/misc/code/elasticsearch/docker-compose.yml">docker-compose.yml</a></p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line">âœ curl -X GET <span class="string">&quot;localhost:9200/_cat/nodes?v=true&amp;pretty&quot;</span></span><br><span class="line">ip         heap.percent ram.percent cpu load_1m load_5m load_15m node.role   master name</span><br><span class="line"><span class="number">172.24.0.2</span>           <span class="number">41</span>          <span class="number">97</span>  <span class="number">85</span>    <span class="number">4</span>.<span class="number">28</span>    <span class="number">1</span>.<span class="number">24</span>     <span class="number">0</span>.<span class="number">43</span> cdfhilmrstw -      es01</span><br><span class="line"><span class="number">172.24.0.3</span>           <span class="number">56</span>          <span class="number">97</span>  <span class="number">85</span>    <span class="number">4</span>.<span class="number">28</span>    <span class="number">1</span>.<span class="number">24</span>     <span class="number">0</span>.<span class="number">43</span> cdfhilmrstw -      es03</span><br><span class="line"><span class="number">172.24.0.4</span>           <span class="number">27</span>          <span class="number">97</span>  <span class="number">85</span>    <span class="number">4</span>.<span class="number">28</span>    <span class="number">1</span>.<span class="number">24</span>     <span class="number">0</span>.<span class="number">43</span> cdfhilmrstw *      es02</span><br></pre></td></tr></table></figure></li>
<li><p>Kibana:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> <span class="built_in">curl</span> http://localhost:<span class="number">5601</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Kibana Plugins æ’ä»¶</span></span><br><span class="line"><span class="variable">$</span> kibana<span class="literal">-plugin</span> install</span><br><span class="line"><span class="variable">$</span> kibana<span class="literal">-plugin</span> list</span><br><span class="line"><span class="variable">$</span> kibana remove</span><br></pre></td></tr></table></figure></li>
<li><p>Logstash:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Elasticsearch-åŸºæœ¬æ¦‚å¿µ"><a href="#Elasticsearch-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="Elasticsearch åŸºæœ¬æ¦‚å¿µ"></a>Elasticsearch åŸºæœ¬æ¦‚å¿µ</h2><ul>
<li><p>æ–‡æ¡£ Document</p>
<blockquote>
<p>Elasticsearch æ˜¯é¢å‘æ–‡æ¡£çš„ï¼Œæ–‡æ¡£æ˜¯æ‰€æœ‰å¯æœç´¢æ•°æ®çš„æœ€å°å•ä½<br>æ–‡æ¡£ä¼šè¢«åºåˆ—åŒ–æˆJSONæ ¼å¼ï¼Œä¿å­˜åœ¨Elasticsearchä¸­<br>æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰ä¸€ä¸ªUnique ID</p>
</blockquote>
<figure class="highlight elm"><table><tr><td class="code"><pre><span class="line"># æ–‡æ¡£å…ƒæ•°æ®<span class="type">Metadata</span> - æ ‡æ³¨æ–‡æ¡£çš„ç›¸å…³ä¿¡æ¯</span><br><span class="line">  _index - æ–‡æ¡£æ‰€å±çš„ç´¢å¼•å</span><br><span class="line">  _<span class="keyword">type</span>  - æ–‡æ¡£æ‰€å±ç±»å‹å</span><br><span class="line">  _id    - æ–‡æ¡£å”¯ä¸€<span class="type">ID</span></span><br><span class="line">  _source - æ–‡æ¡£åŸå§‹<span class="type">JSON</span>æ•°æ®</span><br><span class="line">  _version - æ–‡æ¡£çš„ç‰ˆæœ¬ä¿¡æ¯ <span class="comment">-- è§£å†³å¹¶å‘è¯»å†™å†²çª</span></span><br><span class="line">  _score  - ç›¸å…³æ€§æ‰“åˆ†</span><br></pre></td></tr></table></figure></li>
<li><p>ç´¢å¼• Index</p>
<blockquote>
<p>å°†æ–‡æ¡£å†™å…¥Elasticsearchçš„è¿‡ç¨‹å«ç´¢å¼•indexing</p>
</blockquote>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">Mapping:</span> å®šä¹‰åŒ…å«çš„æ–‡æ¡£çš„å­—æ®µåå’Œå­—æ®µç±»å‹</span><br><span class="line"><span class="symbol">Setting:</span> å®šä¹‰ä¸åŒæ•°æ®åˆ†å¸ƒ</span><br><span class="line"><span class="symbol">Shard:</span> ç´¢å¼•ä¸­çš„æ•°æ®åˆ†æ•£åœ¨Shardsä¸Š</span><br></pre></td></tr></table></figure></li>
<li><p>èŠ‚ç‚¹ Node</p>
<blockquote>
<p>èŠ‚ç‚¹æ˜¯Elasticsearch å®ä¾‹</p>
</blockquote>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">-E node.<span class="attr">name=</span>node1</span><br><span class="line">æ¯ä¸ªèŠ‚ç‚¹å¯åŠ¨åï¼Œä¼šåˆ†é…ä¸€ä¸ªUIDï¼Œä¿å­˜åœ¨dataç›®å½•ä¸‹</span><br><span class="line"></span><br><span class="line"><span class="comment"># Master-eligible nodes å’Œ Master Node</span></span><br><span class="line">  <span class="number">1</span>. èŠ‚ç‚¹å¯åŠ¨é»˜è®¤æ˜¯ä¸€ä¸ª<span class="literal">Master</span>-eligibleèŠ‚ç‚¹, -E node.<span class="literal">master</span>:<span class="literal">false</span> ç¦æ­¢</span><br><span class="line">  <span class="number">2</span>. <span class="literal">Master</span>-eligibleèŠ‚ç‚¹å¯ä»¥å‚åŠ é€‰ä¸»æµç¨‹ï¼Œç§°ä¸º<span class="literal">Master</span>èŠ‚ç‚¹</span><br><span class="line">  <span class="number">3</span>. æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¿å­˜é›†ç¾¤çŠ¶æ€ï¼Œåªæœ‰<span class="literal">master</span>èŠ‚ç‚¹æ‰èƒ½ä¿®æ”¹é›†ç¾¤çŠ¶æ€</span><br><span class="line"></span><br><span class="line"><span class="comment"># é›†ç¾¤çŠ¶æ€ Cluster State</span></span><br><span class="line">  <span class="number">1</span>. æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯</span><br><span class="line">  <span class="number">2</span>. æ‰€æœ‰çš„ç´¢å¼•å’Œç›¸å…³Mapping ä¸ Settingä¿¡æ¯</span><br><span class="line">  <span class="number">3</span>. åˆ†ç‰‡çš„è·¯ç”±ä¿¡æ¯</span><br><span class="line"></span><br><span class="line"><span class="comment"># Data Node &amp; Coordinating Node</span></span><br><span class="line">  <span class="number">1</span>. Data <span class="keyword">Node</span><span class="title">: å¯ä»¥ä¿å­˜æ•°æ®çš„èŠ‚ç‚¹ï¼Œä¿å­˜åˆ†ç‰‡æ•°æ®</span></span><br><span class="line"><span class="title">  2</span>. Coordinating <span class="keyword">Node</span><span class="title">: è´Ÿè´£æ¥å—Client</span>è¯·æ±‚ï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°åˆé€‚çš„èŠ‚ç‚¹ï¼Œæœ€ç»ˆæŠŠç»“æœæ±‡é›†åˆ°ä¸€èµ·</span><br><span class="line"></span><br><span class="line"><span class="comment"># Hot &amp; Warm Node</span></span><br><span class="line"><span class="comment"># Machine Learning Node</span></span><br><span class="line"><span class="comment"># Tribe Node</span></span><br></pre></td></tr></table></figure></li>
<li><p>åˆ†ç‰‡ Primary Shard &amp; Replica Shard</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section">#ä¸»åˆ†ç‰‡: è§£å†³æ•°æ®æ°´å¹³æ‰©å±•çš„é—®é¢˜</span></span><br><span class="line"><span class="bullet">  1.</span> ä¸€ä¸ªåˆ†ç‰‡æ˜¯ä¸€ä¸ªè¿è¡Œçš„Luceneçš„å®ä¾‹</span><br><span class="line"><span class="bullet">  2.</span> ä¸»åˆ†ç‰‡åœ¨ç´¢å¼•åˆ›å»ºæ—¶æŒ‡å®šï¼Œåç»­ä¸å…è®¸ä¿®æ”¹,ä½¿ç”¨ Reindexä¿®æ”¹</span><br><span class="line"></span><br><span class="line"><span class="section">#å‰¯æœ¬: è§£å†³æ•°æ®é«˜å¯ç”¨çš„é—®é¢˜</span></span><br><span class="line"><span class="bullet">  1.</span> å‰¯æœ¬åˆ†ç‰‡æ•°ï¼Œå¯ä»¥åŠ¨æ€è°ƒæ•´</span><br><span class="line"><span class="bullet">  2.</span> å¢åŠ å‰¯æœ¬æ•°ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜æœåŠ¡çš„å¯ç”¨æ€§ (è¯»å–çš„åå)</span><br><span class="line"></span><br><span class="line"><span class="section">#åˆ†ç‰‡è®¾å®š-å®¹é‡è§„åˆ’</span></span><br><span class="line"><span class="bullet">  1.</span> åˆ†ç‰‡æ•°è®¾ç½®è¿‡å°:</span><br><span class="line"><span class="code">    a. åç»­æ— æ³•å¢åŠ èŠ‚ç‚¹å®ç°æ°´å¹³æ‰©å±•</span></span><br><span class="line"><span class="code">    b. å•ä¸ªåˆ†ç‰‡çš„æ•°æ®é‡è¿‡å¤§ï¼Œå¯¼è‡´æ•°æ®é‡æ–°åˆ†é…è€—æ—¶</span></span><br><span class="line"><span class="code">  2. åˆ†ç‰‡è®¾ç½®è¿‡å¤§:</span></span><br><span class="line"><span class="code">    a. å½±å“æœç´¢ç»“æœçš„ç›¸å…³æ€§æ‰“åˆ†ï¼Œå½±å“ç»Ÿè®¡ç»“æœå‡†ç¡®æ€§</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</span></span><br><span class="line">  Green: ä¸»åˆ†ç‰‡å’Œå‰¯ç‰‡æ­£å¸¸</span><br><span class="line">  Yellow: ä¸»åˆ†ç‰‡æ­£å¸¸ï¼Œå‰¯ç‰‡ä¸æ­£å¸¸</span><br><span class="line">  Red: ä¸»åˆ†ç‰‡æœªèƒ½åˆ†é…</span><br></pre></td></tr></table></figure></li>
<li><p>Elasticsearch vs å…³ç³»å‹æ•°æ®åº“ æŠ½è±¡ä¸ç±»æ¯”</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">RDBMS</th>
<th align="left">Elasticsearch</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Table</td>
<td align="left">Index</td>
</tr>
<tr>
<td align="left">Row</td>
<td align="left">Document</td>
</tr>
<tr>
<td align="left">Column</td>
<td align="left">Field</td>
</tr>
<tr>
<td align="left">Schema</td>
<td align="left">Mapping</td>
</tr>
<tr>
<td align="left">SQL</td>
<td align="left">DSL</td>
</tr>
</tbody></table>
<ul>
<li><p>æ–‡æ¡£Document CRUD</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">//</span>create document. è‡ªåŠ¨ç”Ÿæˆ_id</span><br><span class="line">POST users/_doc</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;user&quot;</span>: <span class="string">&quot;Mike&quot;</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;trying out Kibana&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>create document. æŒ‡å®šId, å¦‚æœIDå·²ç»å­˜åœ¨ï¼ŒæŠ¥é”™</span><br><span class="line">PUT users<span class="regexp">/_doc/</span><span class="number">1</span>?op_type=create</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;user&quot;</span>: <span class="string">&quot;Jack&quot;</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;trying out Elasticsearch&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>create document. æŒ‡å®šId, å¦‚æœIDå·²ç»å­˜åœ¨ï¼ŒæŠ¥é”™</span><br><span class="line">PUT users<span class="regexp">/_create/</span><span class="number">1</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;user&quot;</span>: <span class="string">&quot;Jack&quot;</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;trying out Elasticsearch&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> Get the document by ID</span><br><span class="line">GET users<span class="regexp">/_doc/</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> Index</span><br><span class="line">PUT users<span class="regexp">/_doc/</span><span class="number">1</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;user&quot;</span>: <span class="string">&quot;Mike&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>Update åœ¨åŸæ–‡æ¡£ä¸Šå¢åŠ å­—æ®µ</span><br><span class="line">POST users<span class="regexp">/_update/</span><span class="number">1</span>/</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;doc&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;message&quot;</span>: <span class="string">&quot;trying out Elasticsearch 3&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><ul>
<li>Bulk API<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">1. æ”¯æŒåœ¨ä¸€æ¬¡APIè°ƒç”¨ä¸­ï¼Œå¯¹ä¸åŒçš„ç´¢å¼•è¿›è¡Œæ“ä½œ</span><br><span class="line">2. æ”¯æŒå››ç§ç±»å‹æ“ä½œ:</span><br><span class="line">  <span class="keyword">Index</span></span><br><span class="line">  <span class="keyword">Create</span></span><br><span class="line">  <span class="keyword">Update</span></span><br><span class="line">  <span class="keyword">Delete</span></span><br><span class="line"><span class="number">3.</span> æ“ä½œå•æ¡æ“ä½œå¤±è´¥ï¼Œä¸ä¼šå½±å“å…¶ä»–æ“ä½œ</span><br><span class="line"><span class="number">4.</span> è¿”å›ç»“æœåŒ…æ‹¬æ¯ä¸€æ¡æ“ä½œçš„æ‰§è¡Œç»“æœ</span><br><span class="line"></span><br><span class="line">//Bulkæ“ä½œ</span><br><span class="line">POST _bulk</span><br><span class="line">&#123;<span class="string">&quot;index&quot;</span>: &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;test&quot;</span>, <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;field1&quot;</span>: <span class="string">&quot;value1&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;delete&quot;</span>: &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;test&quot;</span>, <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;2&quot;</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;create&quot;</span>: &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;test2&quot;</span>, <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;3&quot;</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;field1&quot;</span>: <span class="string">&quot;value3&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;update&quot;</span>: &#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>, <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;test&quot;</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;doc&quot;</span>: &#123;<span class="string">&quot;field2&quot;</span>: <span class="string">&quot;value2&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>mget</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">//mg</span>et -- æ‰¹é‡è¯»å–</span><br><span class="line"><span class="regexp">//</span>å¯ä»¥å‡å°‘ç½‘ç»œè¿æ¥ï¼Œæé«˜æ€§èƒ½</span><br><span class="line">GET _mget</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;docs&quot;</span>: [</span><br><span class="line">    &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;users&quot;</span>, <span class="string">&quot;_id&quot;</span>:<span class="number">1</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;comment&quot;</span>, <span class="string">&quot;_id&quot;</span>:<span class="number">1</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Elasticsearch-åŸç†"><a href="#Elasticsearch-åŸç†" class="headerlink" title="Elasticsearch åŸç†"></a>Elasticsearch åŸç†</h2><ul>
<li>å›¾ä¹¦å’Œæœç´¢å¼•æ“ç±»æ¯”</li>
</ul>
<table>
<thead>
<tr>
<th align="left">Type</th>
<th align="left">æ­£æ’ç´¢å¼•</th>
<th align="left">å€’æ’ç´¢å¼•</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å›¾ä¹¦</td>
<td align="left">ç›®å½•é¡µ</td>
<td align="left">ç´¢å¼•é¡µ</td>
</tr>
<tr>
<td align="left">æœç´¢å¼•æ“</td>
<td align="left">æ–‡æ¡£ID-&gt;æ–‡æ¡£å†…å®¹å’Œå•è¯çš„å…³è”</td>
<td align="left">å•è¯åˆ°æ–‡æ¡£IDçš„å…³ç³»</td>
</tr>
</tbody></table>
<ul>
<li><p>Elasticsearch å€’æ’ç´¢å¼•</p>
<blockquote>
<p>Elasticsearchçš„JSONæ–‡æ¡£ä¸­æ¯ä¸ªå­—æ®µï¼Œéƒ½æœ‰è‡ªå·±çš„å€’æ’ç´¢å¼•</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># å•è¯è¯å…¸(Term Dictionary)</span></span><br><span class="line"><span class="quote">&gt; è®°å½•æ‰€æœ‰æ–‡æ¡£çš„å•è¯ï¼Œè®°å½•å•è¯åˆ°å€’æ’åˆ—è¡¨çš„å…³è”å…³ç³»</span></span><br><span class="line"><span class="quote">&gt; é€šè¿‡B+æ ‘æˆ–å“ˆå¸Œé“¾è¡¨å®ç°ï¼Œæ»¡è¶³é«˜æ€§èƒ½çš„æ’å…¥ä¸æŸ¥è¯¢</span></span><br><span class="line"></span><br><span class="line"><span class="section"># å€’æ’åˆ—è¡¨(Posting List)</span></span><br><span class="line"><span class="quote">&gt; è®°å½•å•è¯å¯¹åº”çš„æ–‡æ¡£ç»“åˆ</span></span><br><span class="line"><span class="bullet">  -</span> å€’æ’ç´¢å¼•é¡¹(Posting)</span><br><span class="line"><span class="bullet">    -</span> æ–‡æ¡£ID</span><br><span class="line"><span class="bullet">    -</span> è¯é¢‘TF - å•è¯åœ¨æ–‡æ¡£å‡ºç°çš„æ¬¡æ•°</span><br><span class="line"><span class="bullet">    -</span> ä½ç½®Position - å•è¯åœ¨æ–‡æ¡£ä¸­åˆ†è¯çš„ä½ç½®ï¼Œç”¨äºè¯­å¥æœç´¢ phrase query</span><br><span class="line"><span class="bullet">    -</span> åç§»Offset - è®°å½•å•è¯çš„å¼€å§‹ç»“æŸä½ç½®ï¼Œå®ç°é«˜é‡æ˜¾ç¤º</span><br></pre></td></tr></table></figure></li>
<li><p>Elasticsearch åˆ†è¯å™¨</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Analysis</span></span><br><span class="line">  - Analysis: æ–‡æœ¬åˆ†ææ˜¯æŠŠå…¨æ–‡æœ¬è½¬æ¢ä¸€ç³»åˆ—å•è¯ term/tokençš„è¿‡ç¨‹</span><br><span class="line">  - Analysisæ˜¯é€šè¿‡Analyzerå®ç°</span><br><span class="line"></span><br><span class="line"><span class="comment"># Analyzer:</span></span><br><span class="line">  - Character Filters: é’ˆå¯¹åŸå§‹æ–‡æœ¬å¤„ç†</span><br><span class="line">    - HTML strip - å»é™¤htmlæ ‡ç­¾</span><br><span class="line">    - Mapping - å­—ç¬¦ä¸²æ›¿æ¢</span><br><span class="line">    - Pattern repalce - æ­£åˆ™åŒ¹é…æ›¿æ¢</span><br><span class="line"></span><br><span class="line">  - Tokenizer: å°†åŸå§‹çš„æ–‡æœ¬æŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼Œåˆ‡åˆ†ä¸ºè¯ term or token</span><br><span class="line">    - whitespace</span><br><span class="line">    - standard</span><br><span class="line">    - uax_url_email</span><br><span class="line">    - pattern</span><br><span class="line">    - keyward</span><br><span class="line">    - path hierarchy</span><br><span class="line"></span><br><span class="line">  - Token Filter: å°†åˆ‡åˆ†çš„å•è¯è¿›è¡ŒåŠ å·¥ï¼Œå°å†™ï¼Œåˆ é™¤stopwords,å¢åŠ åŒä¹‰è¯</span><br><span class="line">    - Lowercase</span><br><span class="line">    - stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># Elasticsearchå†…ç½®åˆ†è¯å™¨</span></span><br><span class="line"><span class="regexp">//</span>é»˜è®¤åˆ†è¯å™¨ standard</span><br><span class="line"><span class="regexp">//</span> æŒ‰è¯åˆ‡åˆ†ï¼Œå°å†™å¤„ç†</span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;standard&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>Simple Analyzer</span><br><span class="line"><span class="regexp">//</span> æŒ‰ç…§éå­—æ¯åˆ‡åˆ†ï¼Œéå­—æ¯è¢«å»é™¤</span><br><span class="line"><span class="regexp">//</span> å°å†™å¤„ç†</span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;simple&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> Whitespace Analyzer</span><br><span class="line"><span class="regexp">//</span> æŒ‰ç…§ç©ºæ ¼åˆ‡åˆ†</span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;whitespace&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> Stop Analyzer</span><br><span class="line"><span class="regexp">//</span> stop filter: å»é™¤the, a, is ä¿®é¥°æ€§è¯</span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;stop&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>Keyward Analyzer</span><br><span class="line"><span class="regexp">//</span>ä¸åˆ†è¯ï¼Œç›´æ¥å°†è¾“å…¥å½“è¾“å‡º</span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œåˆ†è¯</span><br><span class="line"><span class="regexp">//</span>é»˜è®¤éå­—ç¬¦çš„ç¬¦å·è¿›è¡Œåˆ†éš”</span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;pattern&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>english</span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;english&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> analysis_icu</span><br><span class="line"><span class="regexp">//</span> elasticsearch-plugin install analysis_icu</span><br><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;icu_analyzer&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>:<span class="string">&quot;ä»–è¯´çš„ç¡®å®åœ¨ç†&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Search API</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># URI Search - é€šè¿‡URI queryå®ç°æœç´¢</span></span><br><span class="line">  q: æŒ‡å®šæŸ¥è¯¢è¯­å¥, ä½¿ç”¨Query String Syntax</span><br><span class="line">  df: é»˜è®¤å­—æ®µ, ä¸æŒ‡å®šä¼šå¯¹æ‰€æœ‰å­—æ®µè¿›è¡ŒæŸ¥è¯¢</span><br><span class="line">  Sort: æ’åº/from å’Œ size ç”¨äºåˆ†é¡µ</span><br><span class="line">  Profile: æŸ¥çœ‹æŸ¥è¯¢æ˜¯å¦‚ä½•è¢«æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">  <span class="number">1</span>. æŒ‡å®šå­—æ®µ vs. æ³›æŸ¥è¯¢</span><br><span class="line">  <span class="regexp">//</span>å¸¦profile æ™®é€šæŸ¥è¯¢</span><br><span class="line">  GET <span class="regexp">/movies/</span>_search?q=<span class="number">2012</span>&amp;df=title</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;profile&quot;</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="regexp">//</span>å¸¦profile æ³›æŸ¥è¯¢</span><br><span class="line">  GET <span class="regexp">/movies/</span>_search?q=<span class="number">2012</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;profile&quot;</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="regexp">//</span>å¸¦profile æŒ‡å®šå­—æ®µ</span><br><span class="line">  GET <span class="regexp">/movies/</span>_search?q=title:<span class="number">2012</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;profile&quot;</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">2</span>. Term vs. Phrase</span><br><span class="line">    <span class="comment"># Term: Beautiful Mind ç­‰æ•ˆäº Beautiful OR Mind</span></span><br><span class="line">    <span class="comment"># Phrase: &quot;Beautifuk Mind&quot; ç­‰æ•ˆäº Beautiful And Mind, å‰åé¡ºåºä¿æŒä¸€è‡´</span></span><br><span class="line">  <span class="regexp">//</span>ä½¿ç”¨å¼•å· æŸ¥è¯¢</span><br><span class="line">  GET <span class="regexp">/movies/</span>_search?q=title:<span class="string">&quot;Beautiful Mind&quot;</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;profile&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="regexp">//</span>ä½¿ç”¨å¼•å· Mind æ³› æŸ¥è¯¢</span><br><span class="line">  GET <span class="regexp">/movies/</span>_search?q=title:Beautiful Mind</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;profile&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="regexp">//</span>ä½¿ç”¨å¼•å· Bool æ³› æŸ¥è¯¢</span><br><span class="line">  GET <span class="regexp">/movies/</span>_search?q=title:(Beautiful Mind)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;profile&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">3</span>. å¸ƒå°”æ“ä½œ</span><br><span class="line">    AND <span class="regexp">/ OR /</span> NOT æˆ–è€… &amp;&amp; <span class="regexp">/ || /</span> !</span><br><span class="line">    title:(matrix NOT reloaded)</span><br><span class="line"></span><br><span class="line">  <span class="number">4</span>. åˆ†ç»„</span><br><span class="line">    + è¡¨ç¤º must</span><br><span class="line">    - è¡¨ç¤º must_not</span><br><span class="line">    title:(+matrix -reloaded)</span><br><span class="line"></span><br><span class="line">  <span class="number">5</span>. èŒƒå›´æŸ¥è¯¢</span><br><span class="line">    []é—­åŒºé—´ &#123;&#125;å¼€åŒºé—´</span><br><span class="line"></span><br><span class="line">  <span class="number">6</span>. ç®—æ•°ç¬¦å·</span><br><span class="line">    year:&gt;<span class="number">2010</span></span><br><span class="line"></span><br><span class="line">  <span class="number">7</span>. é€šé…ç¬¦æŸ¥è¯¢(é€šé…ç¬¦æŸ¥è¯¢æ•ˆç‡ä½ï¼Œå ç”¨å†…å­˜å¤§ï¼Œä¸å»ºè®®ä½¿ç”¨)</span><br><span class="line">    ? ä»£è¡¨<span class="number">1</span>ä¸ªå­—ç¬¦</span><br><span class="line">    * ä»£è¡¨<span class="number">0</span>æˆ–å¤šä¸ªå­—ç¬¦</span><br><span class="line"></span><br><span class="line">  <span class="number">8</span>. æ­£åˆ™è¡¨è¾¾å¼</span><br><span class="line">    title:[bt]oy</span><br><span class="line"></span><br><span class="line">  <span class="number">9</span>. æ¨¡ç³ŠåŒ¹é…ä¸è¿‘ä¼¼æŸ¥è¯¢</span><br><span class="line">    title:befutifl~<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Request Body Search</span></span><br><span class="line">  <span class="number">1</span>. åˆ†é¡µ:</span><br><span class="line">    from, size</span><br><span class="line"></span><br><span class="line">  <span class="number">2</span>. sort:</span><br><span class="line"></span><br><span class="line">  <span class="number">3</span>. _source filtering: å¦‚æœ_sourceæ²¡æœ‰å­˜å‚¨ï¼Œå°±åªè¿”å›åŒ¹é…çš„æ–‡æ¡£çš„å…ƒæ•°æ®</span><br><span class="line"></span><br><span class="line">  <span class="number">4</span>. è„šæœ¬å­—æ®µ:</span><br><span class="line"></span><br><span class="line">  <span class="number">5</span>. æŸ¥è¯¢è¡¨è¾¾å¼ - Match</span><br><span class="line"></span><br><span class="line">  <span class="number">6</span>. Match</span><br><span class="line"></span><br><span class="line"><span class="comment"># Page Rankç®—æ³•</span></span><br><span class="line">  <span class="number">1</span>. è¡¡é‡ç›¸å…³æ€§ Information Retrieval</span><br><span class="line">    a. Precision (æŸ¥å‡†ç‡) - å°½å¯èƒ½è¿”å›è¾ƒå°‘çš„æ— å…³æ–‡æ¡£</span><br><span class="line">    b. Recall(æŸ¥å…¨ç‡)     - å°½é‡è¿”å›è¾ƒå¤šçš„ç›¸å…³æ–‡æ¡£</span><br><span class="line">    c. Ranking            - æ˜¯å¦èƒ½å¤ŸæŒ‰ç…§ç›¸å…³åº¦è¿›è¡Œæ’åº</span><br></pre></td></tr></table></figure></li>
<li><p>Mapping</p>
<blockquote>
<p>ç±»ä¼¼æ•°æ®åº“ä¸­çš„scehmaå®šä¹‰</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> å®šä¹‰ç´¢å¼•ä¸­çš„å­—æ®µåç§°</span><br><span class="line"><span class="number">2.</span> å®šä¹‰å­—æ®µçš„æ•°æ®ç±»å‹</span><br><span class="line"><span class="keyword">Mapping</span> æŠŠ<span class="type">JSON</span>æ–‡æ¡£æ˜ å°„æˆLuceneæ‰€éœ€è¦çš„æ‰å¹³æ ¼å¼</span><br><span class="line">ä¸€ä¸ª<span class="keyword">Mapping</span>å±äºä¸€ä¸ªç´¢å¼•çš„<span class="keyword">type</span></span><br><span class="line"></span><br><span class="line"># å››ç§ä¸åŒçº§åˆ«çš„<span class="keyword">Index</span> <span class="keyword">Options</span> - æ§åˆ¶å€’æ’ç´¢å¼•è®°å½•çš„å†…å®¹</span><br><span class="line">  docs - è®°å½•doc id</span><br><span class="line">  freqs - è®°å½• doc id å’Œ term frequencies</span><br><span class="line">  positions - è®°å½• doc id/term frequencies/term position</span><br><span class="line">  offsets - è®°å½• doc id/term frequencies/term position/<span class="type">character</span> offsets</span><br></pre></td></tr></table></figure></li>
<li><p>æ•°æ®ç±»å‹<br>JSON -&gt; Elasticsearchç±»å‹</p>
<table>
<thead>
<tr>
<th align="left">JSONç±»å‹</th>
<th align="left">Elasticsearch ç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å­—ç¬¦ä¸²</td>
<td align="left">åŒ¹é…æ—¥æœŸæ ¼å¼ -&gt; Date</td>
</tr>
<tr>
<td align="left">å¸ƒå°”å€¼</td>
<td align="left">boolean</td>
</tr>
<tr>
<td align="left">æµ®ç‚¹æ•°</td>
<td align="left">float</td>
</tr>
<tr>
<td align="left">æ•´æ•°</td>
<td align="left">long</td>
</tr>
<tr>
<td align="left">å¯¹è±¡</td>
<td align="left">Object</td>
</tr>
<tr>
<td align="left">æ•°ç»„</td>
<td align="left">ç”±ç¬¬ä¸€ä¸ªéç©ºæ•°å€¼çš„ç±»å‹æ‰€å†³å®š</td>
</tr>
<tr>
<td align="left">ç©ºå€¼</td>
<td align="left">å¿½ç•¥</td>
</tr>
</tbody></table>
</li>
</ul>
  <figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># ç®€å•ç±»å‹:</span></span><br><span class="line"><span class="bullet">  1.</span> Text/Keyword</span><br><span class="line"><span class="bullet">  2.</span> Date</span><br><span class="line"><span class="bullet">  3.</span> Integer / Floating</span><br><span class="line"><span class="bullet">  4.</span> Boolean</span><br><span class="line"><span class="bullet">  5.</span> IPv4 &amp; IPv6</span><br><span class="line"></span><br><span class="line"><span class="section"># å¤æ‚ç±»å‹ - å¯¹è±¡å’ŒåµŒå¥—å¯¹è±¡</span></span><br><span class="line">  å¯¹è±¡ç±»å‹/åµŒå¥—ç±»å‹</span><br><span class="line"></span><br><span class="line"><span class="section"># ç‰¹æ®Šç±»å‹</span></span><br><span class="line">  geo<span class="emphasis">_point &amp; geo_</span>shape / percolator</span><br></pre></td></tr></table></figure>

<h2 id="Elasticsearch-èšåˆ-Aggregation"><a href="#Elasticsearch-èšåˆ-Aggregation" class="headerlink" title="Elasticsearch èšåˆ (Aggregation)"></a>Elasticsearch èšåˆ (Aggregation)</h2><blockquote>
<p>Elasticsearch é™¤äº†æœç´¢ä»¥å¤–è¿˜æä¾›é’ˆå¯¹ESæ•°æ®è¿›è¡Œç»Ÿè®¡åˆ†æ</p>
</blockquote>
<ul>
<li>é›†åˆåˆ†ç±»<figure class="highlight q"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> Bucket Aggregation: æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æ–‡æ¡£é›†åˆ</span><br><span class="line">  <span class="built_in">group</span> <span class="keyword">by</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> Metric Aggregation: æ•°å­¦è¿ç®—ï¼Œå¯¹æ–‡æ¡£å­—æ®µç»Ÿè®¡åˆ†æ</span><br><span class="line">  <span class="built_in">min</span>/<span class="built_in">max</span>/<span class="built_in">sum</span>/<span class="built_in">avg</span>/cardinality</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> Pipeline Aggregation: å¯¹èšåˆç»“æœè¿›è¡ŒäºŒæ¬¡èšåˆ</span><br><span class="line"><span class="number">4.</span> Matrix Aggregation: æ”¯æŒå¤šä¸ªå­—æ®µçš„æ“ä½œå¹¶æä¾›ç»“æœçŸ©é˜µ</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Elasticsearch-åˆ†å¸ƒå¼ç»“æ„"><a href="#Elasticsearch-åˆ†å¸ƒå¼ç»“æ„" class="headerlink" title="Elasticsearch åˆ†å¸ƒå¼ç»“æ„"></a>Elasticsearch åˆ†å¸ƒå¼ç»“æ„</h2><ul>
<li><p>é«˜å¯ç”¨</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> æœåŠ¡å¯ç”¨æ€§ - å…è®¸æœ‰èŠ‚ç‚¹åœæ­¢æœåŠ¡</span><br><span class="line"><span class="bullet">2.</span> æ•°æ®å¯ç”¨æ€§ - éƒ¨åˆ†èŠ‚ç‚¹ä¸¢å¤±ï¼Œä¸ä¼šä¸¢å¤±æ•°æ®</span><br></pre></td></tr></table></figure></li>
<li><p>å¯æ‰©å±•æ€§</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> è¯·æ±‚é‡æå‡/æ•°æ®ä¸æ–­å¢åŠ (å°†æ•°æ®åˆ†å¸ƒåˆ°æ‰€æœ‰èŠ‚ç‚¹ä¸Š)</span><br></pre></td></tr></table></figure></li>
<li><p>Elasticsearchåˆ†å¸ƒå¼æ¶æ„</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> ä¸åŒçš„é›†ç¾¤é€šè¿‡ä¸åŒçš„åå­—åŒºåˆ†ï¼Œ-E <span class="keyword">cluster</span>.name=geektime</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="ELK-å¤§æ•°æ®åˆ†æ"><a href="#ELK-å¤§æ•°æ®åˆ†æ" class="headerlink" title="ELK å¤§æ•°æ®åˆ†æ"></a>ELK å¤§æ•°æ®åˆ†æ</h2>]]></content>
      <tags>
        <tag>æœç´¢å¼•æ“</tag>
        <tag>ES</tag>
      </tags>
  </entry>
  <entry>
    <title>golang pkg Tips &amp; Tracks</title>
    <url>/2021/09/03/golang-pkg-Tips-Tracks/</url>
    <content><![CDATA[<h2 id="Golang"><a href="#Golang" class="headerlink" title="Golang"></a>Golang</h2><ul>
<li>Goals<blockquote>
<p>The efficientcy of a statically-typed compiled language with the ease of programming of a dynamic language.<br>Safety: type-safe and memory-safe<br>Good support for concurrency and communication.<br>Efficient, latency-free garbage collection.<br>High-speed compilation.</p>
</blockquote>
</li>
</ul>
<span id="more"></span>

<ul>
<li><p>Design principles</p>
<blockquote>
<p>Keep concept orthogonal(æ­£äº¤).<br>Keep the grammar regular and simple.<br>Reduce typing. Let the language work things out.<br>Reduce typing. Keep the type system clear.</p>
</blockquote>
</li>
<li><p>The Big Picture</p>
<blockquote>
<p>Fundamentals:</p>
</blockquote>
<ul>
<li>Clean, concise syntax.</li>
<li>Lightweight type system.</li>
<li>No implicit conversions: keep things explicit.</li>
<li>Untyped unsized constants:</li>
<li>Strict separation of interface and implementation.<blockquote>
<p>Run-time:</p>
</blockquote>
</li>
<li>Garbage collection.</li>
<li>Strings, maps, communication channels</li>
<li>Concurrency.<blockquote>
<p>Package model:<br>Explicit dependencies to enable faster builds.</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h2 id="Go-Identifiers"><a href="#Go-Identifiers" class="headerlink" title="Go Identifiers"></a>Go Identifiers</h2><h2 id="Go-é¡¹ç›®ç»„ç»‡"><a href="#Go-é¡¹ç›®ç»„ç»‡" class="headerlink" title="Go é¡¹ç›®ç»„ç»‡"></a>Go é¡¹ç›®ç»„ç»‡</h2><ul>
<li><p>Goåº”ç”¨</p>
<blockquote>
<p>ç¼–å†™é«˜è´¨é‡çš„Goåº”ç”¨</p>
</blockquote>
<ul>
<li>ä»£ç ç»“æ„<ol>
<li>ç›®å½•ç»“æ„</li>
<li>æŒ‰åŠŸèƒ½æ‹†åˆ†æ¨¡å—</li>
</ol>
<ul>
<li>å±‚æ¬¡æ‹†åˆ† - MVC</li>
<li>åŠŸèƒ½æ‹†åˆ† - å®ç°é«˜å†…èšä½è€¦åˆçš„è®¾è®¡å“²å­¦</li>
</ul>
</li>
<li>ä»£ç è§„èŒƒ - UBer_Go_Guid</li>
<li>ä»£ç è´¨é‡</li>
<li>ç¼–ç¨‹å“²å­¦<ul>
<li>é¢å‘æ¥å£ç¼–ç¨‹<ol>
<li>ä»£ç æ‰©å±•æ€§æ›´å¼º</li>
<li>è§£è€¦ä¸Šä¸‹æ¸¸çš„å®ç°</li>
<li>æé«˜ä»£ç çš„å¯æµ‹æ€§</li>
</ol>
</li>
<li>é¢å‘â€œå¯¹è±¡â€ç¼–ç¨‹<ol>
<li>ç±»ã€æŠ½è±¡ã€å°è£…é€šè¿‡ç»“æ„ä½“æ¥å®ç°</li>
<li>å®ä¾‹é€šè¿‡ç»“æ„ä½“å˜é‡æ¥å®ç°</li>
<li>ç»§æ‰¿é€šè¿‡ç»„åˆæ¥å®ç°,ä¸€ä¸ªç»“æ„ä½“åµŒåˆ°å¦ä¸€ä¸ªç»“æ„ä½“ï¼Œç§°ä½œç»„åˆ</li>
<li>å¤šæ€é€šè¿‡ç»“æ„æ¥å®ç°<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸºç±»: Bird</span></span><br><span class="line"><span class="keyword">type</span> Bird <span class="keyword">struct</span> &#123;</span><br><span class="line">  Type <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¸Ÿæ¥çš„ç±»åˆ«</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bird *Bird)</span> <span class="title">Class</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> bird.Type</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰é¸Ÿç±»</span></span><br><span class="line"><span class="keyword">type</span> Birds <span class="keyword">interface</span> &#123;</span><br><span class="line">  Name() <span class="keyword">string</span></span><br><span class="line">  Class() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¸Ÿç±»: é‡‘ä¸é›€</span></span><br><span class="line"><span class="keyword">type</span> Canary <span class="keyword">struct</span> &#123;</span><br><span class="line">  Bird</span><br><span class="line">  name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Canary)</span> <span class="title">Name</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> c.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¸Ÿç±»: ä¹Œé¸¦</span></span><br><span class="line"><span class="keyword">type</span> Crow <span class="keyword">struct</span> &#123;</span><br><span class="line">  Bird</span><br><span class="line">  name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Crow)</span> <span class="title">Name</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> c.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCrow</span><span class="params">(name <span class="keyword">string</span>)</span> *<span class="title">Crow</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &amp;Crow&#123;</span><br><span class="line">    Bird: Bird&#123;</span><br><span class="line">      Type: <span class="string">&quot;Crow&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    name: name,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCanary</span><span class="params">(name <span class="keyword">string</span>)</span> *<span class="title">Canary</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &amp;Canary&#123;</span><br><span class="line">    Bird: Bird&#123;</span><br><span class="line">      Type: <span class="string">&quot;Canary&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    name: name,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BirdInfo</span><span class="params">(birds Birds)</span></span> &#123;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;I&#x27;m %s, I belong to %s bird class!\n&quot;</span>, birds.Name(), birds.Class())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  canary := NewCanary(<span class="string">&quot;CanaryA&quot;</span>)</span><br><span class="line">  crow := NewCrow(<span class="string">&quot;CrowA&quot;</span>)</span><br><span class="line">  BirdInfo(canary)</span><br><span class="line">  BirdInfo(crow)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
</li>
<li>è½¯ä»¶è®¾è®¡æ–¹æ³•<ul>
<li>è®¾è®¡æ¨¡å¼ Design Pattern<blockquote>
<p>é’ˆå¯¹ç‰¹å®šåœºæ™¯æ€»ç»“å‡ºæ¥çš„æœ€ä½³å®ç°æ–¹å¼ï¼Œç‰¹ç‚¹æ˜¯è§£å†³åœºæ™¯æ¯”è¾ƒå…·ä½“ï¼Œå®æ–½èµ·æ¥æ¯”è¾ƒç®€å•</p>
</blockquote>
<ul>
<li>åˆ›å»ºå‹æ¨¡å¼ Creational Patterns<blockquote>
<p>æä¾›ä¸€ç§åœ¨åˆ›å»ºå¯¹è±¡çš„åŒæ—¶éšè—åˆ›å»ºé€»è¾‘çš„æ–¹å¼ï¼Œä¸ä½¿ç”¨newè¿ç®—ç¬¦ç›´æ¥å®ä¾‹åŒ–å¯¹è±¡</p>
</blockquote>
<ul>
<li>å•ä¾‹æ¨¡å¼ Singleton Pattern<blockquote>
<p>å•ä¾‹æ¨¡å¼ä½¿å…¨å±€åªæœ‰ä¸€ä¸ªå®ä¾‹,å¹¶ä¸”è´Ÿè´£åˆ›å»ºè‡ªå·±çš„å¯¹è±¡ï¼Œæ¯”è¾ƒé€‚åˆå…¨å±€å…±äº«ä¸€ä¸ªå®ä¾‹ï¼Œä¸”åªéœ€è¦è¢«åˆå§‹åŒ–ä¸€æ¬¡çš„åœºæ™¯. [æ•°æ®åº“å®ä¾‹ã€å…¨å±€é…ç½®ã€å…¨å±€ä»»åŠ¡æ± ]</p>
</blockquote>
<ul>
<li>é¥¿æ±‰æ¨¡å¼: å…¨å±€å®ä¾‹åœ¨åŒ…è¢«åŠ è½½æ—¶åˆ›å»º<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> singleton</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> singleton <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ins *singleton</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">//å¯¼å…¥æ—¶ åˆå§‹åŒ–é™æ€å®ä¾‹</span></span><br><span class="line">  ins = &amp;singleton&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetInsOr</span><span class="params">()</span> *<span class="title">singleton</span></span> &#123;</span><br><span class="line">  <span class="comment">// è¿”å›åˆ›å»ºå¥½çš„åˆå§‹åŒ–å®ä¾‹</span></span><br><span class="line">  <span class="keyword">return</span> ins</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>æ‡’æ±‰æ¨¡å¼: å…¨å±€å®ä¾‹åœ¨åŒ…è¢«ä½¿ç”¨æ—¶åˆ›å»º<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> singleton</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;sync&quot;</span></span><br><span class="line"><span class="keyword">type</span> singleton <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ins *singleton</span><br><span class="line"><span class="keyword">var</span> once sync.Once</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetInsOr</span><span class="params">()</span> *<span class="title">singleton2</span></span> &#123;</span><br><span class="line">  <span class="comment">// Do is intended for initialization that must be run exactly once</span></span><br><span class="line">	once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		ins2 = &amp;singleton&#123;<span class="string">&quot;Chyi&quot;</span>&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">return</span> ins</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>ç®€å•å·¥å‚æ¨¡å¼<blockquote>
<p>ä¼ å…¥å‚æ•°å¹¶è¿”å›ä¸€ä¸ªç»“æ„ä½“çš„å®ä¾‹</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> factory</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span> <span class="title">Greet</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Hi! My name is %s&quot;</span>, p.Name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç®€å•å·¥å‚æ¨¡å¼ç¡®ä¿æˆ‘ä»¬åˆ›å»ºçš„å®ä¾‹å…·æœ‰éœ€è¦çš„å‚æ•°ï¼Œè¿›è€Œä¿è¯å®ä¾‹æŒ‰ç…§é¢„æœŸæ‰§è¡Œ</span></span><br><span class="line"><span class="comment">// è¿”å›éæŒ‡é’ˆçš„å®ä¾‹ï¼Œå¯ä»¥ç¡®ä¿å®ä¾‹å±æ€§é¿å…å±æ€§è¢«æ„å¤–/ä»»æ„ä¿®æ”¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewPerson</span><span class="params">(name <span class="keyword">string</span>, age <span class="keyword">int</span>)</span> <span class="title">Person</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> Person&#123;</span><br><span class="line">		Name: name,</span><br><span class="line">		Age:  age,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>æŠ½è±¡å·¥å‚æ¨¡å¼<blockquote>
<p>ä¸ç®€å•å·¥å‚æ¨¡å¼åŒºåˆ«æ˜¯è¿”å›çš„æ˜¯æ¥å£è€Œä¸æ˜¯ç»“æ„ä½“, åœ¨ä¸å…¬å¼€å†…éƒ¨å®ç°çš„æƒ…å†µä¸‹ï¼Œè®©è°ƒç”¨è€…ä½¿ç”¨</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> abstract_factory</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">interface</span> &#123;</span><br><span class="line">	Greet()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">	age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p person)</span> <span class="title">Greet</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Hi!, my name is %s&quot;</span>, p.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Here, NewPerson returns an interface, and not the person struct iteself</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewPerson</span><span class="params">(name <span class="keyword">string</span>, age <span class="keyword">int</span>)</span> <span class="title">Person</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> person&#123;</span><br><span class="line">		name: name,</span><br><span class="line">		age:  age,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>å·¥å‚æ–¹æ³•æ¨¡å¼<blockquote>
<p>ä¾èµ–å·¥å‚æ¥å£ï¼Œé€šè¿‡å®ç°å·¥å‚æ¥å£æ¥åˆ›å»ºå¤šç§å·¥å‚ï¼Œå°†å¯¹è±¡åˆ›å»ºä»ä¸€ä¸ªå¯¹è±¡è´Ÿè´£æ‰€æœ‰é›†ä½“ç±»çš„å®ä¾‹åŒ–ï¼Œç¼–ç¨‹ç”±ä¸€ç¾¤å­ç±»è´Ÿè´£å¯¹å…·ä½“ç±»çš„å®ä¾‹åŒ–,ä»è€Œå°†è¿‡ç¨‹è§£è€¦</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> method_factory</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">	age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewPersonFactory</span><span class="params">(age <span class="keyword">int</span>)</span> <span class="title">func</span><span class="params">(name <span class="keyword">string</span>)</span> <span class="title">Person</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(name <span class="keyword">string</span>)</span> <span class="title">Person</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> Person&#123;</span><br><span class="line">			name: name,</span><br><span class="line">			age:  age,</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>å»ºé€ è€…æ¨¡å¼</li>
<li>åŸå‹æ¨¡å¼</li>
</ul>
</li>
<li>ç»“æ„å‹æ¨¡å¼ Structural Patterns<ul>
<li>è®¿é—®è€…æ¨¡å¼</li>
<li>æ¨¡ç‰ˆæ¨¡å¼ Template Pattern<blockquote>
<p>å°†ä¸€ä¸ªç±»ä¸­èƒ½å¤Ÿå…¬å…±ä½¿ç”¨çš„æ–¹æ³•æ”¾ç½®åœ¨æŠ½è±¡ç±»ä¸­å®ç°ï¼Œå°†ä¸èƒ½å…¬å…±ä½¿ç”¨çš„æ–¹æ³•ä½œä¸ºæŠ½è±¡æ–¹æ³•ï¼Œå¼ºåˆ¶å­ç±»å®ç°ï¼Œè¿™æ ·å°±åšåˆ°ä¸€ä¸ªç±»ä½œä¸ºæ¨¡ç‰ˆï¼Œè®©å¼€å‘è€…å¡«å……éœ€è¦å¡«å……çš„åœ°æ–¹</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> template</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Cooker <span class="keyword">interface</span> &#123;</span><br><span class="line">	fire()</span><br><span class="line">	cooke()</span><br><span class="line">	outfire()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»ä¼¼ä¸€ä¸ªæŠ½è±¡ç±»</span></span><br><span class="line"><span class="keyword">type</span> CookMenu <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(CookMenu)</span> <span class="title">fire</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;å¼€ç«&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åšèœ äº¤ç»™å…·ä½“çš„å­ç±»å®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(CookMenu)</span> <span class="title">cooke</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(CookMenu)</span> <span class="title">outfire</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;å…³ç«&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°è£…å…·ä½“æ­¥éª¤</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doCook</span><span class="params">(cook Cooker)</span></span> &#123;</span><br><span class="line">	cook.fire()</span><br><span class="line">	cook.cooke()</span><br><span class="line">	cook.outfire()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> XiHongShi <span class="keyword">struct</span> &#123;</span><br><span class="line">	CookMenu</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*XiHongShi)</span> <span class="title">cooke</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;åšè¥¿çº¢æŸ¿&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ChaoJiDan <span class="keyword">struct</span> &#123;</span><br><span class="line">	CookMenu</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ChaoJiDan)</span> <span class="title">cooke</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;åšç‚’é¸¡è›‹&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestTemplate</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"> <span class="comment">// åšè¥¿çº¢æŸ¿</span></span><br><span class="line"> xihongshi := &amp;XiHongShi&#123;&#125;</span><br><span class="line">  doCook(xihongshi)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åšç‚’é¸¡è›‹</span></span><br><span class="line">  chaojidan := &amp;ChaoJiDan&#123;&#125;</span><br><span class="line">  doCook(chaojidan)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>ç­–ç•¥æ¨¡å¼ Strategy Pattern<blockquote>
<p>é‡‡ç”¨ä¸åŒç­–ç•¥çš„åœºæ™¯</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> strategy</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­–ç•¥æ¨¡å¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªç­–ç•¥ç±»</span></span><br><span class="line"><span class="keyword">type</span> IStrategy <span class="keyword">interface</span> &#123;</span><br><span class="line">	do(<span class="keyword">int</span>, <span class="keyword">int</span>) <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­–ç•¥å®ç°: åŠ </span></span><br><span class="line"><span class="keyword">type</span> add <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*add)</span> <span class="title">do</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­–ç•¥å®ç°: å‡</span></span><br><span class="line"><span class="keyword">type</span> reduce <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*reduce)</span> <span class="title">do</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> a - b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“ç­–ç•¥çš„æ‰§è¡Œè€…</span></span><br><span class="line"><span class="keyword">type</span> Operator <span class="keyword">struct</span> &#123;</span><br><span class="line">	strategy IStrategy</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ç­–ç•¥</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(operator *Operator)</span> <span class="title">setStrategy</span><span class="params">(strategy IStrategy)</span></span> &#123;</span><br><span class="line">	operator.strategy = strategy</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨ç­–ç•¥ä¸­çš„æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(operator *Operator)</span> <span class="title">calculate</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> operator.strategy.do(a, b)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestStrategy</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	operator := Operator&#123;&#125;</span><br><span class="line"></span><br><span class="line">	operator.setStrategy(&amp;add&#123;&#125;)</span><br><span class="line">	result := operator.calculate(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">	fmt.Println(<span class="string">&quot;add:&quot;</span>, result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>çŠ¶æ€æ¨¡å¼</li>
<li>è§‚å¯Ÿè€…æ¨¡å¼</li>
<li>å¤‡å¿˜å½•æ¨¡å¼</li>
<li>ä¸­ä»‹è€…æ¨¡å¼</li>
<li>è¿­ä»£å™¨æ¨¡å¼</li>
<li>è§£é‡Šå™¨æ¨¡å¼</li>
<li>å‘½ä»¤æ¨¡å¼</li>
<li>è´£ä»»é“¾æ¨¡å¼</li>
</ul>
</li>
<li>è¡Œä¸ºå‹æ¨¡å¼ Behavioral Patterns<blockquote>
<p>å…³æ³¨å¯¹è±¡ä¹‹é—´çš„é€šä¿¡</p>
</blockquote>
<ul>
<li>é€‚é…å™¨æ¨¡å¼</li>
<li>æ¡¥æ¥æ¨¡å¼</li>
<li>ç»„åˆæ¨¡å¼</li>
<li>è£…é¥°æ¨¡å¼</li>
<li>å¤–è§‚æ¨¡å¼</li>
<li>äº«å…ƒæ¨¡å¼</li>
<li>ä»£ç†æ¨¡å¼ Proxy Pattern<blockquote>
<p>å¯ä»¥ä¸ºå¦ä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªæ›¿èº«æˆ–è€…å ä½ç¬¦ï¼Œä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®</p>
</blockquote>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">package proxy</span><br><span class="line"></span><br><span class="line">import <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Seller interface &#123;</span><br><span class="line">	sell(name <span class="built_in">string</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç«è½¦ç«™</span></span><br><span class="line"><span class="keyword">type</span> Station <span class="keyword">struct</span> &#123;</span><br><span class="line">	stock <span class="built_in">int</span> <span class="comment">// åº“å­˜</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (station *Station) sell(name <span class="built_in">string</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> station.stock &gt; <span class="number">0</span> &#123;</span><br><span class="line">		station.stock--</span><br><span class="line">		fmt.<span class="constructor">Printf(<span class="string">&quot;ä»£ç†ç‚¹ä¸­: %sä¹°äº†ä¸€å¼ ç¥¨ï¼Œå‰©ä½™: %d \n&quot;</span>, <span class="params">name</span>, <span class="params">station</span>.<span class="params">stock</span>)</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.<span class="constructor">Println(<span class="string">&quot;ç¥¨å·²å”®ç©º&quot;</span>)</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç«è½¦ä»£ç†ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> StationProxy <span class="keyword">struct</span> &#123;</span><br><span class="line">	station *Station <span class="comment">// æŒæœ‰ç«è½¦ç«™å¯¹è±¡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (proxy *StationProxy) sell(name <span class="built_in">string</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> proxy.station.stock &gt; <span class="number">0</span> &#123;</span><br><span class="line">		proxy.station.stock--</span><br><span class="line">		fmt.<span class="constructor">Printf(<span class="string">&quot;ä»£ç†ç‚¹ä¸­: %sä¹°äº†ä¸€å¼ ç¥¨,å‰©ä½™: %d \n&quot;</span>, <span class="params">name</span>, <span class="params">proxy</span>.<span class="params">station</span>.<span class="params">stock</span>)</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.<span class="constructor">Println(<span class="string">&quot;ç¥¨å·²å”®ç©º&quot;</span>)</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>é€‰é¡¹æ¨¡å¼ Options Pattern<blockquote>
<p>ç»“æ„ä½“å‚æ•°å¾ˆå¤šï¼ŒæœŸæœ›åˆ›å»ºä¸€ä¸ªæºå¸¦é»˜è®¤å€¼çš„ç»“æ„ä½“å˜é‡ï¼Œå¹¶é€‰æ‹©æ€§ä¿®æ”¹å…¶ä¸­ä¸€äº›å‚æ•°çš„å€¼</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> options</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Connection <span class="keyword">struct</span> &#123;</span><br><span class="line">	addr    <span class="keyword">string</span></span><br><span class="line">	cache   <span class="keyword">bool</span></span><br><span class="line">	timeout time.Duration</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	defaultTimeout = <span class="number">10</span></span><br><span class="line">	defaultCaching = <span class="literal">false</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> options <span class="keyword">struct</span> &#123;</span><br><span class="line">	timeout time.Duration</span><br><span class="line">	caching <span class="keyword">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Option override behavior of Connect</span></span><br><span class="line"><span class="keyword">type</span> Option <span class="keyword">interface</span> &#123;</span><br><span class="line">	apply(*options)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> optionFunc <span class="function"><span class="keyword">func</span><span class="params">(*options)</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f optionFunc)</span> <span class="title">apply</span><span class="params">(o *options)</span></span> &#123;</span><br><span class="line">	f(o)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithTimeout</span><span class="params">(t time.Duration)</span> <span class="title">Option</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> optionFunc(<span class="function"><span class="keyword">func</span><span class="params">(o *options)</span></span> &#123;</span><br><span class="line">		o.timeout = t</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithCaching</span><span class="params">(cache <span class="keyword">bool</span>)</span> <span class="title">Option</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> optionFunc(<span class="function"><span class="keyword">func</span><span class="params">(o *options)</span></span> &#123;</span><br><span class="line">		o.caching = cache</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewConnect create a connection.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewConnect</span><span class="params">(addr <span class="keyword">string</span>, opts ...Option)</span> <span class="params">(*Connection, error)</span></span> &#123;</span><br><span class="line">	options := options&#123;</span><br><span class="line">		timeout: defaultTimeout,</span><br><span class="line">		caching: defaultCaching,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, o := <span class="keyword">range</span> opts &#123;</span><br><span class="line">		o.apply(&amp;options)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> &amp;Connection&#123;</span><br><span class="line">		addr:    addr,</span><br><span class="line">		cache:   options.caching,</span><br><span class="line">		timeout: options.timeout,</span><br><span class="line">	&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestOptions</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"> connect, err := NewConnect(<span class="string">&quot;127.0.0.1&quot;</span>, WithCaching(<span class="literal">true</span>), WithTimeout(<span class="number">5</span>))</span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  log.Fatal(err)</span><br><span class="line"> &#125;</span><br><span class="line"> fmt.Println(connect)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li>SOLIDåŸåˆ™<blockquote>
<p>ä¾§é‡è®¾è®¡åŸåˆ™,è®¾è®¡ä»£ç æŒ‡å¯¼æ–¹é’ˆ</p>
</blockquote>
<ul>
<li>SRP: å•ä¸€åŠŸèƒ½åŸåˆ™, ä¸€ä¸ªç±»æˆ–è€…æ¨¡å—åªè´Ÿè´£å®Œæˆä¸€ä¸ªæŒ‡è´£</li>
<li>OCP: å¼€é—­åŸåˆ™,è½¯ä»¶å®ä½“åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­</li>
<li>LSP: é‡Œæ°æ›¿æ¢åŸåˆ™, å¦‚æœSæ˜¯Tçš„å­ç±»å‹ï¼Œåˆ™ç±»å‹Tçš„å¯¹è±¡å¯ä»¥æ›¿æ¢ä¸ºç±»å‹Sçš„å¯¹è±¡ï¼Œè€Œä¸ä¼šç ´åç¨‹åº</li>
<li>DIP: ä¾èµ–å€’ç½®åŸåˆ™ï¼Œä¾èµ–äºæŠ½è±¡è€Œä¸æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œå…¶æœ¬è´¨æ˜¯è¦é¢å‘æ¥å£ç¼–ç¨‹ï¼Œä¸è¦é¢å‘å®ç°ç¼–ç¨‹</li>
<li>ISP: æ¥å£åˆ†ç¦»åŸåˆ™ï¼Œå®¢æˆ·ç«¯ç¨‹åºä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ–¹æ³•</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>é¡¹ç›®ç®¡ç†</p>
</li>
<li><p>é¡¹ç›®æ–‡æ¡£</p>
</li>
</ul>
<h2 id="Go-å·¥å…·é›†"><a href="#Go-å·¥å…·é›†" class="headerlink" title="Go å·¥å…·é›†"></a>Go å·¥å…·é›†</h2><table>
<thead>
<tr>
<th align="left">å·¥å…·å</th>
<th align="left">åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td align="left">golines</td>
<td align="left">æ ¼å¼åŒ–é•¿è¡Œ</td>
</tr>
<tr>
<td align="left">goimports</td>
<td align="left">å¯¼å…¥åŒ…ç®¡ç†ï¼Œè‡ªåŠ¨å¢åˆ ä¾èµ–åŒ…ï¼ŒæŒ‰ç…§å­—æ¯æ’åº</td>
</tr>
<tr>
<td align="left">mockgen</td>
<td align="left">æ¥å£Mockå·¥å…·</td>
</tr>
<tr>
<td align="left">gotests</td>
<td align="left">æ ¹æ®Goä»£ç è‡ªåŠ¨ç”Ÿæˆå•å…ƒæµ‹è¯•æ¨¡ç‰ˆ</td>
</tr>
<tr>
<td align="left">go-junit-report</td>
<td align="left">go testè¾“å‡ºè½¬æ¢ä¸ºjunit xml</td>
</tr>
<tr>
<td align="left">richgo</td>
<td align="left">ç”¨æ–‡æœ¬è£…é¥°ä¸°å¯Œgo testçš„è¾“å‡º</td>
</tr>
<tr>
<td align="left">golangci-lint</td>
<td align="left">é™æ€ä»£ç æ£€æŸ¥å·¥å…·</td>
</tr>
<tr>
<td align="left">rts</td>
<td align="left">response to struct æ ¹æ®æœåŠ¡å™¨çš„å“åº”ç”ŸæˆGoç»“æ„ä½“</td>
</tr>
<tr>
<td align="left">protoc-go-inject-tag</td>
<td align="left">é€šè¿‡protocå·¥å…·ç”Ÿæˆpb.goæ–‡ä»¶ä¸­æ³¨å…¥è‡ªå®šä¹‰æ ‡ç­¾</td>
</tr>
<tr>
<td align="left">db2struct</td>
<td align="left">å°†æ•°æ®åº“è¡¨ä¸€é”®è½¬æ¢ä¸ºgo struct,æ”¯æŒè‡ªå®šä¹‰Tagå’Œå¤šç§å‘½åæ ¼å¼é…ç½®</td>
</tr>
<tr>
<td align="left">gsemver</td>
<td align="left">æ ¹æ®git commitè§„èŒƒè‡ªåŠ¨ç”Ÿæˆè¯­ä¹‰åŒ–ç‰ˆæœ¬</td>
</tr>
<tr>
<td align="left">git-chglog</td>
<td align="left">æ ¹æ®git commit è‡ªåŠ¨ç”ŸæˆCHANGELOG</td>
</tr>
<tr>
<td align="left">github-release</td>
<td align="left">å‘½ä»¤è¡Œå·¥å…·ï¼Œåˆ›å»ºã€ä¿®æ”¹github release</td>
</tr>
<tr>
<td align="left">go-mod-outdated</td>
<td align="left">æ£€æŸ¥ä¾èµ–åŒ…æ˜¯å¦æœ‰æ›´æ–°</td>
</tr>
<tr>
<td align="left">depth</td>
<td align="left">é€šè¿‡åˆ†æå¯¼å…¥çš„åº“ï¼Œå°†æŸä¸ªåŒ…çš„ä¾èµ–å…³ç³»ç”¨æ ‘çŠ¶ç»“æ„æ˜¾ç¤ºå‡ºæ¥</td>
</tr>
<tr>
<td align="left">go-callvis</td>
<td align="left">å¯è§†åŒ–æ˜¾ç¤ºGoè°ƒç”¨å…³ç³»</td>
</tr>
<tr>
<td align="left">cfssl</td>
<td align="left">CouldFlareçš„PKIçš„TLSå·¥å…·é›†</td>
</tr>
<tr>
<td align="left">addllicense</td>
<td align="left">é€šè¿‡æ‰«ææŒ‡å®šæ–‡ä»¶çš„æ–‡ä»¶ï¼Œç¡®ä¿æºç æ–‡ä»¶æœ‰ç‰ˆæƒå¤´</td>
</tr>
<tr>
<td align="left">gothanks</td>
<td align="left">è‡ªåŠ¨åœ¨githubä¸ŠStaré¡¹ç›®çš„ä¾èµ–åŒ…æ‰€åœ¨çš„github repository</td>
</tr>
<tr>
<td align="left">swagger</td>
<td align="left">è‡ªåŠ¨ç”ŸæˆGo Swaggeræ–‡æ¡£</td>
</tr>
</tbody></table>
<h2 id="Go-Guide"><a href="#Go-Guide" class="headerlink" title="Go Guide"></a>Go Guide</h2><h2 id="Golang-Frequently-Asked-Questions-FAQ"><a href="#Golang-Frequently-Asked-Questions-FAQ" class="headerlink" title="Golang Frequently Asked Questions (FAQ)"></a>Golang Frequently Asked Questions (FAQ)</h2><ul>
<li><p>Map access is unsafe only when updates are occurring.</p>
</li>
<li><p>How can I gurantee my type satisfies an interface?</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> I <span class="keyword">interface</span> &#123;</span><br><span class="line">    Say(<span class="keyword">string</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> T <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *T)</span> <span class="title">Say</span><span class="params">(s <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    fmt.Println(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨äºè§¦å‘ç¼–è¯‘æœŸçš„æ¥å£çš„åˆç†æ€§æ£€æŸ¥æœºåˆ¶</span></span><br><span class="line"><span class="comment">// å¦‚æœTæ²¡æœ‰å®ç°Iï¼Œä¼šåœ¨ç¼–è¯‘æœŸæŠ¥é”™</span></span><br><span class="line"><span class="comment">// èµ‹å€¼å³è¾¹æ˜¯æ–­è¨€ç±»å‹çš„é›¶å€¼ï¼Œå¯¹äºæŒ‡é’ˆç±»å‹ã€åˆ‡ç‰‡ã€mapæ˜¯nilï¼Œå¯¹äºç»“æ„ä½“ç±»å‹æ˜¯ç©ºç»“æ„</span></span><br><span class="line"><span class="comment">// Ask the compiler to check that the type T implements the interface I by</span></span><br><span class="line"><span class="keyword">var</span> _ I = (*T)(<span class="literal">nil</span>) <span class="comment">// Verify that *T implements I.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    t := T&#123;&#125;</span><br><span class="line">    t.Say(<span class="string">&quot;Say Hello&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Should I define methods on values or pointers?</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">func (s *MyStruct) pointerMethod() &#123;&#125;   // <span class="keyword">method</span> <span class="keyword">on</span> pointer</span><br><span class="line">func (s MyStruct) valueMethod() &#123;&#125;      // <span class="keyword">method</span> <span class="keyword">on</span> <span class="keyword">value</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="keyword">When</span> defining a <span class="keyword">method</span> <span class="keyword">on</span> a <span class="keyword">type</span>, the receiver behaves exactly <span class="keyword">as</span> <span class="keyword">if</span> it were an argument <span class="keyword">to</span> the <span class="keyword">method</span>. Whether <span class="keyword">to</span> define the receiver <span class="keyword">as</span> a <span class="keyword">value</span> <span class="keyword">or</span> <span class="keyword">as</span> a pointer <span class="keyword">is</span> the same question, <span class="keyword">then</span>, <span class="keyword">as</span> whether a <span class="keyword">function</span> argument should be a <span class="keyword">value</span> <span class="keyword">or</span> poiner.</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> First, <span class="keyword">and</span> most important, does the <span class="keyword">method</span> need <span class="keyword">to</span> modify the receiver?</span><br><span class="line"><span class="number">2.</span> Second <span class="keyword">is</span> the consideration <span class="keyword">of</span> efficiency. <span class="keyword">If</span> the receiver <span class="keyword">is</span> <span class="keyword">large</span>, a big struct <span class="keyword">for</span> instance, it will be much cheaper <span class="keyword">to</span> use a pointer receiver.</span><br></pre></td></tr></table></figure></li>
<li><p>What operations are atomic? What about mutexes?</p>
<blockquote>
<p>Do not communicate by sharing memory. Instead, share memory by communicating.</p>
</blockquote>
</li>
<li><p>How can I control the number of CPUs?</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">The runtime can allocate more threads than the value of GOMAXPROCS to service multiple outstanding I/O requests. GOMAXPROCS only affects how many goroutines can actually<span class="built_in"> execute </span>at once; arbitrarily more may be blocked in<span class="keyword"> system</span> calls.</span><br></pre></td></tr></table></figure></li>
<li><p>Who do I write a unit test?</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> Create a <span class="keyword">new</span> file ending <span class="keyword">in</span> <span class="module-access"><span class="module"><span class="identifier">_test</span>.</span></span>go <span class="keyword">in</span> the same directory <span class="keyword">as</span> your package sources. Inside that file, import <span class="string">&quot;testing&quot;</span> <span class="keyword">and</span> write functions <span class="keyword">of</span> the form</span><br><span class="line"></span><br><span class="line">func <span class="constructor">TestFoo(<span class="params">t</span> <span class="operator">*</span><span class="params">testing</span>.T)</span> &#123;</span><br><span class="line">  â€¦</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>What compiler technology is used to build the compilers?</p>
<blockquote>
<p>The default compiler, gc, was originally written in C, but since the Go 1.5 release the compiler has been a Go program.</p>
</blockquote>
</li>
<li><p>Why do garbage collection? Wonâ€™t it be too expensive?</p>
<figure class="highlight mercury"><table><tr><td class="code"><pre><span class="line">The current <span class="keyword">implementation</span> <span class="keyword">is</span> a mark-and-sweep collector.</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="User-Goè¯­è¨€ç¼–ç è§„èŒƒ"><a href="#User-Goè¯­è¨€ç¼–ç è§„èŒƒ" class="headerlink" title="User Goè¯­è¨€ç¼–ç è§„èŒƒ"></a>User Goè¯­è¨€ç¼–ç è§„èŒƒ</h2><ul>
<li><p>æŒ‡å¯¼åŸåˆ™:</p>
<ul>
<li><p>æŒ‡å‘interfaceçš„æŒ‡é’ˆ</p>
<ol>
<li>ä½¿ç”¨æŒ‡é’ˆä¼ é€’æ‰èƒ½é€šè¿‡æ¥å£æ–¹æ³•ä¿®æ”¹åŸºç¡€æ•°æ®</li>
</ol>
</li>
<li><p>Interface åˆç†æ€§éªŒè¯</p>
<ol>
<li>var _ http.Handler = (*Handler)(nil)  // è§¦å‘ç¼–è¯‘æœŸçš„æ¥å£åˆç†æ€§æ£€æŸ¥æœºåˆ¶ï¼Œå¦‚æœHandleræ²¡æœ‰å®ç°Http.Handler ä¼šæŠ¥é”™</li>
<li>èµ‹å€¼å³è¾¹æ˜¯æ–­è¨€ç±»å‹çš„é›¶å€¼ï¼ŒæŒ‡é’ˆç±»å‹ã€åˆ‡ç‰‡å’Œæ˜ å°„éƒ½æ˜¯nil,å¯¹äºç»“æ„ç±»å‹æ˜¯ç©ºç»“æ„</li>
</ol>
</li>
<li><p>æ¥æ”¶å™¨receiverä¸æ¥å£</p>
<ol>
<li>ä½¿ç”¨å€¼æ¥æ”¶å™¨çš„æ–¹æ³•å³å¯ä»¥é€šè¿‡å€¼è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŒ‡é’ˆè°ƒç”¨</li>
<li>å¸¦æŒ‡é’ˆæ¥æ”¶å™¨çš„æ–¹æ³•åªèƒ½é€šè¿‡æŒ‡é’ˆè°ƒç”¨<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> ä¸€ä¸ªç±»å‹å¯ä»¥æœ‰å€¼æ¥æ”¶å™¨æ–¹æ³•é›†å’ŒæŒ‡é’ˆæ¥æ”¶å™¨æ–¹æ³•é›†</span><br><span class="line">  ä¸€ä¸ªå€¼æ¥æ”¶å™¨æ–¹æ³•é›†æ˜¯æŒ‡é’ˆæ¥æ”¶å™¨æ–¹æ³•é›†çš„å­é›†</span><br><span class="line"><span class="bullet">2.</span> å€¼å¯¹è±¡åªå¯ä»¥ä½¿ç”¨å€¼æ¥æ”¶å™¨æ–¹æ³•é›†,æŒ‡é’ˆå¯¹è±¡å¯ä»¥ä½¿ç”¨å€¼æ¥æ”¶å™¨æ–¹æ³•é›†+æŒ‡é’ˆæ¥æ”¶å™¨æ–¹æ³•é›†</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>é›¶å€¼ Mutex</p>
<blockquote>
<p>é›¶å€¼sync.Mutex, sync.RWMutxæ˜¯æœ‰æ•ˆçš„ï¼ŒæŒ‡å‘Mutexçš„æŒ‡é’ˆåŸºæœ¬æ˜¯ä¸å¿…è¦çš„</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> ä½¿ç”¨ç»“æ„ä½“æŒ‡é’ˆï¼Œmutexåº”è¯¥ä½œä¸ºç»“æ„ä½“çš„éæŒ‡é’ˆå­—æ®µï¼Œå³ä½¿è¯¥ç»“æ„ä½“ä¸è¢«å¯¼å‡ºï¼Œä¸è¦å°†mutexåµŒå…¥åˆ°ç»“æ„ä½“ä¸­</span><br></pre></td></tr></table></figure></li>
<li><p>è¾¹ç•Œå¤„æ‹·è´Sliceså’ŒMaps</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> æ¥æ”¶Slices å’Œ Maps: å½“<span class="built_in">map</span>æˆ–<span class="built_in">slice</span>ä½œä¸ºå‡½æ•°å‚æ•°ä¼ å…¥æ—¶ï¼Œç”¨æˆ·å¯ä»¥å¯¹å…¶è¿›è¡Œä¿®æ”¹</span><br><span class="line"><span class="number">2.</span> æ³¨æ„ç”¨æˆ·å¯¹æŠ¥æ¼å†…éƒ¨çŠ¶æ€çš„<span class="built_in">map</span>æˆ–<span class="built_in">slice</span>çš„ä¿®æ”¹</span><br></pre></td></tr></table></figure></li>
<li><p>ä½¿ç”¨deferé‡Šæ”¾èµ„æº</p>
</li>
<li><p>Channelçš„sizeè¦ä¹ˆæ˜¯1ï¼Œè¦ä¹ˆæ˜¯æ— ç¼“å†²çš„</p>
</li>
<li><p>æšä¸¾ä»1å¼€å§‹:</p>
</li>
<li><p>ä½¿ç”¨timeå¤„ç†æ—¶é—´</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="built_in">time</span>.<span class="keyword">Time</span>è¡¨ç¤ºç¬æ—¶æ—¶é—´</span><br><span class="line"><span class="number">2.</span> <span class="built_in">time</span>.Durationè¡¨ç¤ºæ—¶é—´æ®µ</span><br><span class="line"><span class="number">3.</span> <span class="keyword">Time</span>.<span class="keyword">Add</span>: æŸä¸ªæ—¶åˆ»æ¯”å‰ä¸€ä¸ªæ—¶åˆ»æ™š</span><br><span class="line"><span class="number">4.</span> <span class="keyword">Time</span>.AddDate: ä¸‹ä¸€ä¸ªæ—¥å†æ—¥</span><br></pre></td></tr></table></figure></li>
<li><p>é”™è¯¯ç±»å‹</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> errors.New: å¯¹äºç®€å•é™æ€å­—ç¬¦ä¸²çš„é”™è¯¯</span><br><span class="line"><span class="bullet">2.</span> fmt.Errorf: å¯¹äºæ ¼å¼åŒ–çš„é”™è¯¯å­—ç¬¦ä¸²</span><br><span class="line"><span class="bullet">3.</span> å®ç°Error()æ–¹æ³•çš„è‡ªå®šä¹‰ç±»å‹</span><br><span class="line"><span class="bullet">4.</span> errors.Wrap: Wrapped errors</span><br></pre></td></tr></table></figure></li>
<li><p>é”™è¯¯åŒ…è£… Error Wrapping</p>
</li>
<li><p>å¤„ç†ç±»å‹æ–­è¨€å¤±è´¥</p>
</li>
<li><p>è¿½åŠ æ—¶ä¼˜å…ˆæ‰§è¡Œåˆ‡ç‰‡å®¹é‡</p>
</li>
</ul>
</li>
<li><p>æ€§èƒ½</p>
<ul>
<li>å°†åŸè¯­è½¬æ¢ä¸ºå­—ç¬¦ä¸²æˆ–ä»å­—ç¬¦ä¸²è½¬æ¢æ—¶ï¼Œstrconvé€Ÿåº¦æ¯”fmtå¿«</li>
<li>æŒ‡å®šå®¹å™¨å®¹é‡,ä»¥ä¾¿ä¸ºå®¹å™¨é¢„å…ˆåˆ†é…å†…å­˜ï¼Œå°†åœ¨æ·»åŠ å…ƒç´ æ—¶æœ€å°åŒ–åç»­åˆ†é… â€“ å®¹é‡æç¤º</li>
<li>æŒ‡å®šåˆ‡ç‰‡å®¹é‡,ç¼–è¯‘å™¨ä¸ºå…¶æä¾›make()çš„sliceçš„å®¹é‡åˆ†é…è¶³å¤Ÿçš„å†…å­˜</li>
</ul>
</li>
<li><p>è§„èŒƒ</p>
<ul>
<li><p>åŒ…å</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> å…¨éƒ¨å°å†™ï¼Œæ²¡æœ‰å¤§å†™æˆ–ä¸‹åˆ’çº¿</span><br><span class="line"><span class="bullet">2.</span> ä¸ä½¿ç”¨å¤æ•°</span><br><span class="line"><span class="bullet">3.</span> ä¸è¦ç”¨ common, util, shared, lib</span><br></pre></td></tr></table></figure></li>
<li><p>å¯¼å…¥åˆ«å</p>
<blockquote>
<p>é™¤éå¯¼å…¥ä¹‹é—´æœ‰ç›´æ¥å†²çªï¼Œå¦åˆ™é¿å…å¯¼å…¥åˆ«å</p>
</blockquote>
</li>
<li><p>å‡å°‘åµŒå¥—</p>
<blockquote>
<p>ä»£ç é€šè¿‡å°½å¯èƒ½å…ˆå¤„ç†é”™è¯¯æƒ…å†µ/ç‰¹æ®Šæƒ…å†µä»Šæ—©è¿”å›æˆ–ç»§ç»­å¾ªç¯å‡å°‘åµŒå¥—ï¼Œå‡å°‘åµŒå¥—å¤šä¸ªçº§åˆ«çš„ä»£ç çš„ä»£ç </p>
</blockquote>
</li>
<li><p>é¡¶å±‚å˜é‡å£°æ˜</p>
</li>
</ul>
</li>
</ul>
<h2 id="Golang-Tips-amp-Tracks"><a href="#Golang-Tips-amp-Tracks" class="headerlink" title="Golang Tips &amp; Tracks"></a>Golang Tips &amp; Tracks</h2><ul>
<li><strong>è´Ÿè½½å‡è¡¡ç®—æ³•å¯¹æ¯”</strong><blockquote>
<p>è´Ÿè½½å‡è¡¡æœ€é‡è¦çš„å°±æ˜¯å‡è¡¡</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;math/rand&quot;</span></span><br><span class="line">  <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">  rand.Seed(time.Now().UnixNano())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">normal_shuffle</span><span class="params">(slice []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(slice); i++ &#123;</span><br><span class="line">    a := rand.Intn(<span class="built_in">len</span>(slice))</span><br><span class="line">    b := rand.Intn(<span class="built_in">len</span>(slice))</span><br><span class="line">    slice[a], slice[b] = slice[b], slice[a]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">shuffle</span><span class="params">(indexes []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="built_in">len</span>(indexes); i &gt; <span class="number">0</span>; i-- &#123;</span><br><span class="line">    lastIdx := i - <span class="number">1</span></span><br><span class="line">    idx := rand.Intn(i)</span><br><span class="line">    indexes[lastIdx], indexes[idx] = indexes[idx], indexes[lastIdx]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> cnt1 = <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">var</span> sl = []<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;</span><br><span class="line">    normal_shuffle(sl)</span><br><span class="line">    cnt1[sl[<span class="number">0</span>]]++</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> cnt2 = <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">var</span> sl = []<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;</span><br><span class="line">    shuffle(sl)</span><br><span class="line">    cnt2[sl[<span class="number">0</span>]]++</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fmt.Println(<span class="string">&quot;normal shuffle: &quot;</span>, cnt1)</span><br><span class="line">  fmt.Println(<span class="string">&quot;fisher yates  : &quot;</span>, cnt2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">chyi/<span class="keyword">go</span>-awesome-prj/shuffle via ğŸ¹ v1<span class="number">.17</span> took <span class="number">38</span>s</span><br><span class="line">âœ <span class="keyword">go</span> run main.<span class="keyword">go</span></span><br><span class="line">normal shuffle:  <span class="keyword">map</span>[<span class="number">0</span>:<span class="number">224558</span> <span class="number">1</span>:<span class="number">128887</span> <span class="number">2</span>:<span class="number">129201</span> <span class="number">3</span>:<span class="number">129493</span> <span class="number">4</span>:<span class="number">129487</span> <span class="number">5</span>:<span class="number">129202</span> <span class="number">6</span>:<span class="number">129172</span>]</span><br><span class="line">fisher yates  :  <span class="keyword">map</span>[<span class="number">0</span>:<span class="number">142974</span> <span class="number">1</span>:<span class="number">143116</span> <span class="number">2</span>:<span class="number">142768</span> <span class="number">3</span>:<span class="number">142660</span> <span class="number">4</span>:<span class="number">142930</span> <span class="number">5</span>:<span class="number">142505</span> <span class="number">6</span>:<span class="number">143047</span>]</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>Go</tag>
      </tags>
  </entry>
  <entry>
    <title>CS - Basic Introduction</title>
    <url>/2021/09/06/CS-Time/</url>
    <content><![CDATA[<blockquote>
<p>è®¡ç®—æœºé€šè¯†ä»‹ç»</p>
</blockquote>
<span id="more"></span>

<h2 id="Time-æ—¶é—´"><a href="#Time-æ—¶é—´" class="headerlink" title="Time æ—¶é—´"></a>Time æ—¶é—´</h2><ul>
<li><p>Universal Time: ä¸–ç•Œæ—¶</p>
<blockquote>
<p>ä¾é è§‚æµ‹å¤©æ–‡ç°è±¡æ¥æµ‹é‡æ—¶é—´ï¼ŒåŸºäºåœ°çƒè‡ªè½¬è§„å¾‹</p>
</blockquote>
</li>
<li><p>International Atomic Time: å›½é™…åŸå­æ—¶</p>
<blockquote>
<p>ä»¥å¾®è§‚æ—¶é—´é“¯åŸå­çš„éœ‡è¡é¢‘ç‡ä¸ºåŸºå‡†ï¼Œåˆ¶é€ åŸå­é’Ÿ</p>
</blockquote>
</li>
<li><p>Coordinated Universal Time: åè°ƒä¸–ç•Œæ—¶</p>
<blockquote>
<p>æ ¹æ®ä¸–é—´æ—¶å’ŒåŸå­æ—¶ï¼Œæœ€ç»ˆç¡®ç«‹æ–°çš„æ—¶é—´æ ‡å‡†ï¼Œå®šä¹‰æˆä¸ºå…¨çƒçš„æ—¶é—´æ ‡å‡†</p>
</blockquote>
</li>
<li><p>NTP Network Time Protocol åŒæ­¥æ—¶é—´</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>. NTPå¦‚ä½•åŒæ­¥æ—¶é—´</span><br><span class="line">  &gt; å‡è®¾ç½‘ç»œæ¥å›è·¯å¾„å¯¹ç§°ï¼Œå¹¶ä¸”å»¶è¿Ÿç›¸åŒ</span><br><span class="line">  ç½‘ç»œå»¶æ—¶ = (t4 - t1) - (t3 - t2)</span><br><span class="line">  æ—¶é—´å·® = t2 - t1 - ç½‘ç»œå»¶è¿Ÿ<span class="regexp">/2 = ((t2-t1) + (t3-t4))/</span><span class="number">2</span></span><br><span class="line"><span class="number">2</span>. åŒæ­¥æ—¶é—´æ—¶ï¼Œå¯¹æ­£åœ¨è¿è¡Œçš„ç¨‹åºæœ‰æ²¡æœ‰å½±å“</span><br><span class="line">  <span class="comment"># å¢™ä¸Šæ—¶é’Ÿ: ä¸–ç•Œåè°ƒæ—¶UTCï¼Œæ ¡å‡†æ—¶é—´åï¼Œå¯èƒ½å‘ç”Ÿå›æ‹¨</span></span><br><span class="line">  <span class="comment"># å•è°ƒæ—¶é’Ÿ: è®¡ç®—æœºè‡ªå¯åŠ¨ä»¥åçš„çº³ç§’æ•°ï¼Œä¸ä¼šå›æ‹¨</span></span><br><span class="line"></span><br><span class="line">NTPæ ¡å‡†æ—¶é—´æä¾›<span class="number">2</span>ä¸­æ–¹å¼:</span><br><span class="line">  <span class="number">1</span>. ntpdate: ä¸€åˆ‡å·²æœåŠ¡å™¨ç«¯æ—¶é—´ä¸ºå‡†ï¼Œå¼ºåˆ¶ä¿®æ”¹æœ¬æœºæ—¶é—´</span><br><span class="line">  <span class="number">2</span>. ntpd: æŠŠæ—¶é—´å·®å‡æ‘Šåˆ°æ¯æ¬¡å°çš„è°ƒæ•´ä¸Š -- é¿å…å‘ç”Ÿå€’æµ</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>è®¡ç®—æœº</tag>
      </tags>
  </entry>
  <entry>
    <title>Middleware Tips &amp; Tracks</title>
    <url>/2021/09/06/Middleware-Tips-Tracks/</url>
    <content><![CDATA[<h2 id="æŠ€æœ¯é€‰å‹"><a href="#æŠ€æœ¯é€‰å‹" class="headerlink" title="æŠ€æœ¯é€‰å‹"></a>æŠ€æœ¯é€‰å‹</h2><blockquote>
<p>é¢å¯¹æŠ€æœ¯é€‰å‹æ—¶ï¼Œå°±æ˜¯ä¸€ä¸ªå…³äºå¦‚ä½•å–èˆçš„é—®é¢˜ï¼Œä¸è¦ä¸ç»è¿‡æ€è€ƒå°±è§‰å¾—é‚£ä¸ªæ–¹æ¡ˆå¥½ï¼Œé‚£ä¸ªæ–¹æ¡ˆä¸å¥½ã€‚éœ€è¦æ ¹æ®å…·ä½“åœºæ™¯åˆ†æ<br>æŠ€æœ¯é€‰å‹ä¸åªæ˜¯æŠ€æœ¯é—®é¢˜ï¼Œè¿˜ä¸å›¢é˜Ÿã€ç®¡ç†ã€ç»„ç»‡ç»“æ„æœ‰å…³</p>
</blockquote>
<ul>
<li>ä¸šåŠ¡åŠŸèƒ½è§’åº¦</li>
<li>æŠ€æœ¯èµ„æºè§’åº¦<blockquote>
<p>æ‰€å¤„çš„ç¯å¢ƒã€æŠ€æœ¯èµ„æºèƒ½å¦åŒ¹é…è¿™äº›æŠ€æœ¯æ–¹æ¡ˆ</p>
</blockquote>
</li>
</ul>
<span id="more"></span>

<h2 id="æ¶ˆæ¯ä¸­é—´ä»¶"><a href="#æ¶ˆæ¯ä¸­é—´ä»¶" class="headerlink" title="æ¶ˆæ¯ä¸­é—´ä»¶"></a>æ¶ˆæ¯ä¸­é—´ä»¶</h2><figure class="highlight haml"><table><tr><td class="code"><pre><span class="line"># ä¸“ä¸šæ¶ˆæ¯ä¸­é—´ä»¶éœ€è¦æ»¡è¶³:</span><br><span class="line">  1. æ¶ˆæ¯ä¸ä¸¢å¤±</span><br><span class="line">    a. ç”Ÿäº§è€…ä¼šä¸ä¼šä¸¢æ¶ˆæ¯?</span><br><span class="line">      -<span class="ruby"> æ¶ˆæ¯æ²¡å‘é€å‡ºå»: ç½‘ç»œæ•…éšœæˆ–è€…å…¶ä»–åŸå› å¯¼è‡´å‘å¸ƒå¤±è´¥ï¼Œä¸­é—´ä»¶ç›´æ¥è¿”å›å¤±è´¥</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> ä¸ç¡®å®šæ˜¯å¦å‘é€æˆåŠŸ: ç½‘ç»œé—®é¢˜å¯¼è‡´å‘å¸ƒè¶…æ—¶ï¼Œå¯èƒ½æ•°æ®å·²å‘é€æˆåŠŸï¼Œä½†æ˜¯è¯»å–å“åº”ç»“æœè¶…æ—¶</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line">      ç”Ÿäº§è€…è®¾ç½®æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œè¶…è¿‡ä¸Šé™ä¾æ—§å¤±è´¥ï¼Œéœ€è¦è®°å½•æ—¥å¿—æŠ¥è­¦å¤„ç†, ç”Ÿäº§è€…ä¼šä¸ä¼šä¸¢æ¶ˆæ¯ï¼Œå–å†³äºç”Ÿäº§è€…å¯¹äºå¼‚å¸¸æƒ…å†µçš„å¤„ç†æ˜¯å¦åˆç†, ä¿è¯æ¶ˆæ¯ä¸ä¸¢ï¼Œå®å¯é‡å‘ï¼Œä¹Ÿä¸èƒ½ä¸¢å¼ƒ</span><br><span class="line">    b. æ¶ˆè´¹è€…ä¼šä¸ä¼šä¸¢æ¶ˆæ¯?</span><br><span class="line">      -<span class="ruby"> æ¶ˆè´¹è€…åœ¨å¤„ç†å®Œæ¶ˆæ¯åï¼Œå¿…é¡»å‘ŠçŸ¥é˜Ÿåˆ—ä¸­é—´ä»¶ï¼Œé˜Ÿåˆ—ä¸­é—´ä»¶æ‰ä¼šæŠŠæ ‡è®°å·²å¤„ç†ï¼Œå¦åˆ™ä»æ—§æŠŠè¿™äº›æ•°æ®å‘ç»™æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="ruby"></span>    c. é˜Ÿåˆ—ä¸­é—´ä»¶ä¼šä¸ä¼šä¸¢æ¶ˆæ¯?</span><br><span class="line">      -<span class="ruby"> ç”Ÿäº§è€…åœ¨å‘å¸ƒæ¶ˆæ¯æ—¶ï¼Œé˜Ÿåˆ—ä¸­é—´ä»¶é€šå¸¸ä¼šå†™å¤šä¸ªèŠ‚ç‚¹ï¼Œä»¥æ­¤ä¿è¯æ¶ˆæ¯çš„å®Œæ•´æ€§ï¼Œå³ä¾¿å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹æŒ‚ï¼Œä¹Ÿèƒ½ä¿è¯é›†ç¾¤æ•°æ®ä¸ä¸¢å¤±</span></span><br><span class="line"><span class="ruby"></span>  2. æ¶ˆæ¯å¯å †ç§¯</span><br></pre></td></tr></table></figure>
<ul>
<li>Redis ä½œä¸ºæ¶ˆæ¯ä¸­é—´ä»¶<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> Redisæœ¬èº«å¯èƒ½ä¼šä¸¢æ•°æ®</span><br><span class="line"><span class="bullet">2.</span> é¢å¯¹æ¶ˆæ¯ç§¯å‹ï¼ŒRediså†…å­˜èµ„æºç´§å¼ </span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>ä¸­é—´ä»¶</tag>
        <tag>Middleware</tag>
      </tags>
  </entry>
  <entry>
    <title>Protocol Buffer Intro</title>
    <url>/2021/09/07/Protocol-Buffer-Intro/</url>
    <content><![CDATA[<h1 id="Protocol-Buffers"><a href="#Protocol-Buffers" class="headerlink" title="Protocol Buffers"></a>Protocol Buffers</h1><blockquote>
<p>Google å¼€å‘çš„ä¸€å¥—å¯¹æ•°æ®ç»“æ„è¿›è¡Œåºåˆ—åŒ–çš„æ–¹æ³•ï¼Œå¯ç”¨ä½œæ•°æ®é€šä¿¡åè®®ã€æ•°æ®å­˜å‚¨æ ¼å¼ã€‚</p>
</blockquote>
<ul>
<li>ä¸»è¦ç‰¹å¾<ul>
<li>æ›´å¿«çš„æ•°æ®ä¼ è¾“é€Ÿåº¦ï¼šprotobufä¼ è¾“å°†æ•°æ®åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶æ•°æ®ï¼ŒJSONæ–‡æœ¬ä¼ è¾“æ ¼å¼ èŠ‚çœå¤§é‡IOæ“ä½œï¼Œæé«˜æ•°æ®ä¼ è¾“é€Ÿåº¦</li>
<li>è·¨å¹³å°å¤šè¯­è¨€ï¼šprotobufç¼–è¯‘å·¥å…·protocåŸºäºprotobufå®šä¹‰æ–‡ä»¶ï¼Œç¼–è¯‘å‡ºä¸åŒè¯­è¨€çš„å®¢æˆ·ç«¯æˆ–è€…æœåŠ¡ç«¯</li>
<li>è‰¯å¥½çš„æ‰©å±•æ€§å’Œå…¼å®¹æ€§:</li>
<li>åŸºäºIDLæ–‡ä»¶å®šä¹‰æœåŠ¡ï¼Œé€šè¿‡proto3å·¥å…·ç”ŸæˆæŒ‡å®šè¯­è¨€çš„æ•°æ®ç»“æ„,æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ¥å£</li>
</ul>
</li>
</ul>
<span id="more"></span>


]]></content>
      <tags>
        <tag>Protocol Buffer</tag>
      </tags>
  </entry>
  <entry>
    <title>API Design</title>
    <url>/2021/09/07/RESTful-API-Design/</url>
    <content><![CDATA[<blockquote>
<p>ç›®å‰ä¸šç•Œå¸¸ç”¨çš„APIé£æ ¼</p>
</blockquote>
<ul>
<li>RESTful</li>
<li>RPC</li>
<li>GraphQL</li>
</ul>
<span id="more"></span>

<h2 id="RESTful-API"><a href="#RESTful-API" class="headerlink" title="RESTful API"></a>RESTful API</h2><blockquote>
<p>Representational State Transfer - è¡¨ç°å±‚çŠ¶æ€è½¬ç§»<br>RESTæ˜¯ä¸€ç§è½¯ä»¶æ¶æ„é£æ ¼ï¼Œæ˜¯ä¸€ç»„æ¶æ„çº¦æŸæ¡ä»¶å’ŒåŸåˆ™<br>RESTè§„èŒƒæŠŠæ‰€æœ‰å†…å®¹éƒ½è§†ä¸ºèµ„æº<br>RESTæ˜¯ä¸€ç§è§„èŒƒï¼Œè€ŒRESTful APIåˆ™æ˜¯æ»¡è¶³è¿™ç§è§„èŒƒçš„APIæ¥å£</p>
</blockquote>
<ul>
<li><p>HTTPåŠ¨è¯ä¸RESTé£æ ¼CRUDå¯¹åº”å…³ç³»</p>
<table>
<thead>
<tr>
<th align="left">HTTPæ–¹æ³•</th>
<th align="left">è¡Œä¸º</th>
<th align="left">URI</th>
<th align="left">ç¤ºä¾‹è¯´æ˜</th>
<th align="left">æ˜¯å¦å®‰å…¨</th>
<th align="left">æ˜¯å¦å¹‚ç­‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">GET</td>
<td align="left">è·å–èµ„æºåˆ—è¡¨</td>
<td align="left">/users</td>
<td align="left">è·å–ç”¨æˆ·åˆ—è¡¨</td>
<td align="left">æ˜¯</td>
<td align="left">æ˜¯</td>
</tr>
<tr>
<td align="left">GET</td>
<td align="left">è·å–ä¸€ä¸ªå…·ä½“èµ„æº</td>
<td align="left">/users/admin</td>
<td align="left">è·å–adminç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯</td>
<td align="left">æ˜¯</td>
<td align="left">æ˜¯</td>
</tr>
<tr>
<td align="left">POST</td>
<td align="left">åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„æº</td>
<td align="left">/users</td>
<td align="left">åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·</td>
<td align="left">å¦</td>
<td align="left">å¦</td>
</tr>
<tr>
<td align="left">PUT</td>
<td align="left">ä»¥æ•´ä½“çš„æ–¹å¼æ›´æ–°ä¸€ä¸ªèµ„æº</td>
<td align="left">/users/admin</td>
<td align="left">æ›´æ–°userä¸ºadminçš„ç”¨æˆ·</td>
<td align="left">å¦</td>
<td align="left">æ˜¯</td>
</tr>
<tr>
<td align="left">DELETE</td>
<td align="left">åˆ é™¤æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ªèµ„æº</td>
<td align="left">/users/admin</td>
<td align="left">åˆ é™¤userä¸ºadminçš„ç”¨æˆ·</td>
<td align="left">å¦</td>
<td align="left">æ˜¯</td>
</tr>
</tbody></table>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>. <span class="keyword">GET</span>,<span class="keyword">PUT</span>,POSTæ“ä½œçš„èµ„æºå±æ€§ä¸€è‡´</span><br><span class="line"><span class="number">2</span>. èµ„æºè¿›è¡ŒçŠ¶æ€/å±æ€§å˜æ›´ï¼Œè¦ç”¨<span class="keyword">PUT</span>æ–¹æ³•ï¼ŒPOSTæ–¹æ³•ç”¨æ¥åˆ›å»ºæˆ–è€…æ‰¹é‡åˆ é™¤</span><br></pre></td></tr></table></figure>

<ul>
<li><p>æ ¸å¿ƒç‰¹ç‚¹</p>
<ol>
<li>ä»¥èµ„æºresourceä¸ºä¸­å¿ƒ, æ‰€æœ‰çš„ä¸œè¥¿éƒ½æŠ½è±¡ç§°èµ„æºï¼Œæ‰€æœ‰çš„è¡Œä¸ºéƒ½åº”è¯¥æ˜¯åœ¨èµ„æºä¸Šçš„CRUDæ“ä½œ</li>
<li>èµ„æºæ˜¯æœ‰çŠ¶æ€çš„ï¼Œä½¿ç”¨JSON/XMLç­‰åœ¨HTTP Bodyé‡Œè¡¨å¾èµ„æºçš„çŠ¶æ€</li>
<li>å®¢æˆ·ç«¯é€šè¿‡å››ä¸ªHTTPåŠ¨è¯ï¼Œå¯¹æœåŠ¡å™¨èµ„æºè¿›è¡Œæ“ä½œ, å®ç°â€œè¡¨ç°å±‚çŠ¶æ€è½¬åŒ–â€</li>
<li>æ— çŠ¶æ€, å¯¹äºæœåŠ¡ç«¯çš„å¼¹æ€§æ‰©å®¹æ˜¯å¾ˆé‡è¦çš„</li>
</ol>
</li>
<li><p>RESTful API è®¾è®¡åŸåˆ™</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="comment"># URIè®¾è®¡</span></span><br><span class="line">  1. èµ„æºåä½¿ç”¨åè¯è€Œä¸æ˜¯åŠ¨è¯,å¹¶ä¸”ç”¨åè¯å¤æ•°è¡¨ç¤º</span><br><span class="line">  2. URIç»“å°¾ä¸åŒ…å«/</span><br><span class="line">  3. URIä¸­ä¸èƒ½å‡ºç°ä¸‹åˆ’çº¿,å¿…é¡»ä½¿ç”¨ä¸­æ ä»£æ›¿</span><br><span class="line">  4. URIè·¯å¾„shyingå°å†™ï¼Œä¸ä½¿ç”¨å¤§å†™</span><br><span class="line">  5. é¿å…å±‚çº§è¿‡æ·±çš„URIï¼Œè¶…è¿‡2å±‚çš„èµ„æºåµŒå¥—ä¼šå¾ˆä¹±,å»ºè®®å…¶ä»–èµ„æºè½¬æ¢ä¸º?å‚æ•°</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰å…¨æ€§: ä¸ä¼šæ”¹å˜èµ„æºçŠ¶æ€</span></span><br><span class="line"><span class="comment"># å¹‚ç­‰æ€§: æ‰§è¡Œ1æ¬¡å’Œæ‰§è¡ŒNæ¬¡ï¼Œå¯¹èµ„æºçŠ¶æ€æ”¹å˜çš„æ•ˆæœæ˜¯ç­‰ä»·çš„</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># APIç‰ˆæœ¬ç®¡ç†</span></span><br><span class="line">  1. URLä¸­ <span class="string">/v1/users</span></span><br><span class="line">  2. HTTP Headerä¸­, Accept: <span class="keyword">version</span>=1.0</span><br><span class="line">  3. Formå‚æ•°ä¸­, <span class="string">/users</span>?<span class="keyword">version</span>=v1</span><br><span class="line"></span><br><span class="line"><span class="comment"># APIå‘½å:</span></span><br><span class="line">  1. é©¼å³°å‘½åæ³• serverAddress</span><br><span class="line">  2. è›‡å½¢å‘½åæ³• server_address</span><br><span class="line">  3. è„ŠæŸ±å‘½åæ³• server-address -- GitHub API ä½¿ç”¨çš„è„ŠæŸ±å‘½å</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»Ÿä¸€åˆ†é¡µ/è¿‡æ»¤/æ’åº/æœç´¢åŠŸèƒ½</span></span><br><span class="line">  1. åˆ†é¡µ: <span class="string">/users</span>?offset=0&amp;limit20</span><br><span class="line">  2. è¿‡æ»¤: <span class="string">/users</span>?fields=email,username,address</span><br><span class="line">  3. æ’åº: <span class="string">/users</span>?sort=age,desc</span><br><span class="line">  4. æœç´¢:</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸŸå</span></span><br><span class="line">  1. https:<span class="string">//chyidl.com/api</span> : è¿™ç§æ–¹å¼é€‚åˆAPIä¸ä¼šæœ‰è¿›ä¸€æ­¥æ‰©å±•çš„æƒ…å†µ</span><br><span class="line">  2. https:<span class="string">//storage.api.chyidl.com</span> : chyidl.comåŸŸåä¸‹ä¼šæ–°å¢å¦ä¸€ä¸ªç³»ç»ŸAPI</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="RPC-API"><a href="#RPC-API" class="headerlink" title="RPC API"></a>RPC API</h2><blockquote>
<p>RPC (Remote Procedure Call) è¿œç¨‹è¿‡ç¨‹è°ƒç”¨</p>
</blockquote>
<ul>
<li><p>RPCè°ƒç”¨æµç¨‹</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="built_in">Client</span> é€šè¿‡æœ¬åœ°è°ƒç”¨<span class="built_in">Client</span> Stub --</span><br><span class="line"><span class="number">2.</span> <span class="built_in">Client</span> Stubå°†å‚æ•°æ‰“åŒ…ç§°ä¸€ä¸ªæ¶ˆæ¯ï¼Œç„¶åå‘é€è¿™ä¸ªæ¶ˆæ¯</span><br><span class="line"><span class="number">3.</span> <span class="built_in">Client</span>æ‰€åœ¨çš„OSå°†æ¶ˆæ¯å‘é€ç»™<span class="built_in">Server</span></span><br><span class="line"><span class="number">4.</span> <span class="built_in">Server</span>ç«¯æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå°†æ¶ˆæ¯ä¼ é€’ç»™<span class="built_in">Server</span> Stub</span><br><span class="line"><span class="number">5.</span> <span class="built_in">Server</span> Stubå°†æ¶ˆæ¯è§£åŒ…ï¼Œå¾—åˆ°å‚æ•°</span><br><span class="line"><span class="number">6.</span> <span class="built_in">Server</span> Stubè°ƒç”¨æœåŠ¡ç«¯çš„å­ç¨‹åºï¼Œå¤„ç†å®Œåï¼Œæœ€ç»ˆç»“æœæŒ‰ç…§ç›¸åçš„æ­¥éª¤è¿”å›ç»™<span class="built_in">Client</span></span><br><span class="line"></span><br><span class="line">Stub: è´Ÿè´£è°ƒç”¨å‚æ•°å’Œè¿”å›å€¼çš„æµåŒ–serializationã€å‚æ•°çš„æ‰“åŒ…å’Œè§£åŒ…ã€ä»¥åŠç½‘ç»œå±‚çš„é€šä¿¡.</span><br><span class="line"></span><br><span class="line">google gRPC</span><br><span class="line">Facebook Thrift</span><br></pre></td></tr></table></figure></li>
<li><p>RESTful VS gRPC</p>
<table>
<thead>
<tr>
<th align="left">å¯¹æ¯”é¡¹</th>
<th align="left">RESTful</th>
<th align="left">gRPC</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ä¼˜ç‚¹</td>
<td align="left">1. RESTæ›´è§„èŒƒã€æ›´æ ‡å‡†ã€æ›´é€šç”¨ æ— è®ºé‚£ç§è¯­è¨€éƒ½æ”¯æŒHTTPåè®®ï¼Œå¯ä»¥å¯¹æ¥å¤–éƒ¨å¾ˆå¤šç³»ç»Ÿ</td>
<td align="left">1. å±è”½ç½‘ç»œç»†èŠ‚ï¼Œè°ƒç”¨è¿œç¨‹æ¥å£åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ï¼Œè°ƒç”¨ç®€å•ã€æ–¹ä¾¿</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">2. RESTfulæ¥å£é‡‡ç”¨JSONä½œä¸ºæ•°æ®é€šä¿¡æ ¼å¼ï¼ŒJSONæ ¼å¼å¯è¯»æ€§å¼º</td>
<td align="left">2. gRPCé‡‡ç”¨Protocol Bufferä½œä¸ºæ•°æ®ä¼ è¾“æ ¼å¼ï¼Œæ•ˆç‡é«˜</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">3. å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ¾è€¦åˆ</td>
<td align="left">3.gRPCåŸºäºHTTP/2åè®®æ ‡å‡†ï¼Œæ€§èƒ½æ›´é«˜</td>
</tr>
<tr>
<td align="left">ç¼ºç‚¹</td>
<td align="left">1.æ‰©å±•æ€§å·®ï¼Œéšç€éœ€æ±‚å˜åŒ–</td>
<td align="left">1.Protobufæ•°æ®æ ¼å¼å¯è¯»æ€§å·®</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">2.æ€§èƒ½ç›¸å¯¹äºgRPCåä½</td>
<td align="left">2.gRPCä¸æ”¯æŒæµè§ˆå™¨è°ƒç”¨,è°ƒè¯•ä¸æ–¹ä¾¿</td>
</tr>
<tr>
<td align="left">ä½¿ç”¨åœºæ™¯</td>
<td align="left">1. æ¥å£å¯¹å¤–ï¼Œéœ€è¦æ¥å£è§„èŒƒæ˜“æ‡‚</td>
<td align="left">1.æ¶ˆæ¯å¯†é›†å‹ã€å¯¹ç³»ç»Ÿæ€§èƒ½å’Œå»¶æ—¶è¦æ±‚æ¯”è¾ƒé«˜</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">2.ç³»ç»Ÿèƒ½è¦æ±‚ä¸é«˜</td>
<td align="left">2.åå‘å†…éƒ¨çš„API</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">3.æä¾›APIå¤©ç”Ÿå›´ç»•èµ„æºã€å¯¹è±¡ã€ç®¡ç†å±•å¼€</td>
<td align="left">3.æä¾›APIå¾ˆéš¾è¿›è¡Œèµ„æºã€å¯¹è±¡æŠ½è±¡</td>
</tr>
</tbody></table>
</li>
</ul>
]]></content>
      <tags>
        <tag>API</tag>
      </tags>
  </entry>
  <entry>
    <title>gRPC Intro</title>
    <url>/2021/09/07/gRPC-Intro/</url>
    <content><![CDATA[<h1 id="gRPC"><a href="#gRPC" class="headerlink" title="gRPC"></a>gRPC</h1><blockquote>
<p>Googleå¼€å‘å…±æ€§èƒ½ã€å¼€æºã€è·¨ç¼–ç¨‹è¯­è¨€çš„é€šç”¨RPCæ¡†æ¶ï¼ŒåŸºäºHTTP2.0åè®®å¼€å‘ï¼Œé»˜è®¤é‡‡ç”¨Protocol Buffersæ•°æ®åºåˆ—åŒ–åè®®</p>
</blockquote>
]]></content>
      <tags>
        <tag>gRPC</tag>
      </tags>
  </entry>
  <entry>
    <title>Gin Crash Course</title>
    <url>/2021/09/08/Gin-Crash-Course/</url>
    <content><![CDATA[<h1 id="Gin-Web-Framework"><a href="#Gin-Web-Framework" class="headerlink" title="Gin Web Framework"></a>Gin Web Framework</h1><blockquote>
<p>Ginæ˜¯Goè¯­è¨€ç¼–å†™çš„Webæ¡†æ¶ï¼ŒåŠŸèƒ½å®Œå–„ï¼Œä½¿ç”¨ç®€å•ï¼Œæ€§èƒ½é«˜ï¼ŒGinæ ¸å¿ƒçš„è·¯ç”±åŠŸèƒ½æ˜¯é€šè¿‡HttpRouterå®ç°ï¼Œå…·æœ‰å¾ˆé«˜çš„è·¯ç”±æ€§èƒ½.</p>
</blockquote>
<span id="more"></span>

<h2 id="WebæœåŠ¡æ ¸å¿ƒåŠŸèƒ½"><a href="#WebæœåŠ¡æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="WebæœåŠ¡æ ¸å¿ƒåŠŸèƒ½"></a>WebæœåŠ¡æ ¸å¿ƒåŠŸèƒ½</h2><ul>
<li><p>åŸºç¡€åŠŸèƒ½</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># é€šä¿¡åè®®: HTTP/HTTPS/gRPC</span></span><br><span class="line"><span class="meta"># é€šä¿¡æ ¼å¼: JSON/Protobuf</span></span><br><span class="line"><span class="meta"># è·¯ç”±åŒ¹é…</span></span><br><span class="line">  &gt; HTTPæ–¹æ³•ï¼Œè¯·æ±‚è·¯å¾„åŒ¹é…åˆ°å¤„ç†è¿™ä¸ªè¯·æ±‚çš„å‡½æ•°,æœ€ç»ˆç”±æ”¹å‡½æ•°å¤„ç†è¿™æ¬¡è¯·æ±‚ï¼Œå¹¶è¿”å›ç»“æœ</span><br><span class="line"><span class="meta"># è·¯ç”±åˆ†ç»„</span></span><br><span class="line"><span class="meta"># ä¸€è¿›ç¨‹å¤šæœåŠ¡</span></span><br><span class="line"><span class="meta"># ä¸šåŠ¡å¤„ç†</span></span><br><span class="line">  <span class="number">1.</span> å‚æ•°è§£æ</span><br><span class="line">  <span class="number">2.</span> å‚æ•°æ ¡éªŒ</span><br><span class="line">  <span class="number">3.</span> é€»è¾‘å¤„ç†</span><br><span class="line">  <span class="number">4.</span> è¿”å›ç»“æœ</span><br></pre></td></tr></table></figure></li>
<li><p>é«˜çº§åŠŸèƒ½</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸­é—´ä»¶</span></span><br><span class="line">  &gt; Ginæ”¯æŒä¸­é—´ä»¶ï¼ŒHTTPè¯·æ±‚åœ¨è½¬å‘åˆ°å®é™…çš„å¤„ç†å‡½æ•°ä¹‹å‰ï¼Œä¼šè¢«ä¸€ç³»åˆ—åŠ è½½çš„ä¸­é—´ä»¶è¿›è¡Œå¤„ç†</span><br><span class="line">  gin.Engine.<span class="keyword">Use</span>() æ–¹æ³•åŠ è½½ä¸­é—´ä»¶</span><br></pre></td></tr></table></figure>
<p>gin.Logger(): Loggerä¸­é—´ä»¶å°†æ—¥å¿—å†™åˆ°gin.DefaultWriter, gin.DefaultWriteré»˜è®¤ä¸ºos.Stdout<br>gin.Recovery(): Recoveryä¸­é—´ä»¶å¯ä»¥ä»ä»»ä½•panicæ¢å¤ï¼Œå¹¶å†™å…¥500çŠ¶æ€<br>gin.CustomRecovery(handle gin.RecoverFunc):<br>gin.BasicAuth(): HTTP è¯·æ±‚åŸºæœ¬è®¤è¯</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">|<span class="string">ä¸­é—´ä»¶   </span>|<span class="string"> åŠŸèƒ½                  </span>|</span><br><span class="line">|<span class="string">:--------</span>|<span class="string">:----------------------</span>|</span><br><span class="line">|<span class="string"> gin-jwt </span>|<span class="string"> JWTä¸­é—´ä»¶ï¼Œå®ç°JWTè®¤è¯</span>|</span><br><span class="line">|<span class="string"> gin-swagger</span>|<span class="string"> è‡ªåŠ¨ç”ŸæˆSwagger 2.0æ ¼å¼çš„RESTful APIæ–‡æ¡£</span>|</span><br><span class="line">|<span class="string"> cors</span>|<span class="string"> å®ç°HTTPè¯·æ±‚è·¨åŸŸ</span>|</span><br><span class="line">|<span class="string">sessions</span>|<span class="string">ä¼šè¯ç®¡ç†ä¸­é—´ä»¶</span>|</span><br><span class="line">|<span class="string">authz</span>|<span class="string"> åŸºäºcasbinæˆæƒä¸­é—´ä»¶</span>|</span><br><span class="line">|<span class="string">pprof</span>|<span class="string"> gin pprof ä¸­é—´ä»¶</span>|</span><br><span class="line">|<span class="string">go-gin-prometheus</span>|<span class="string">Prometheus metrics exporter</span>|</span><br><span class="line">|<span class="string">gzip</span>|<span class="string"> æ”¯æŒHTTPè¯·æ±‚å’Œå“åº”çš„gzipå‹ç¼©</span>|</span><br><span class="line">|<span class="string">gin-limit</span>|<span class="string">HTTPè¯·æ±‚å¹¶å‘æ§åˆ¶ä¸­é—´ä»¶</span>|</span><br><span class="line">|<span class="string">requestid</span>|<span class="string">ç»™æ¯ä¸ªRequestç”Ÿæˆuuid,å¹¶æ·»åŠ åœ¨è¿”å›çš„X-Request-ID Headerä¸­</span>|</span><br><span class="line"></span><br><span class="line">  <span class="comment"># è®¤è¯</span></span><br></pre></td></tr></table></figure>
<p>è®¤è¯: Authentication: ç”¨æ¥éªŒè¯æŸä¸ªç”¨æˆ·æ˜¯å¦å…·æœ‰è®¿é—®ç³»ç»Ÿçš„æƒé™ â€“ è¯æ˜ä½ æ˜¯è°<br>æˆæƒ: Authorization: ç”¨æ¥éªŒè¯æŸä¸ªç”¨æˆ·æ˜¯å¦å…·æœ‰è®¿é—®æŸä¸ªèµ„æºçš„æƒé™ â€“ å†³å®šä½ èƒ½åšä»€ä¹ˆ</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> Basic: åŸºç¡€è®¤è¯</span><br></pre></td></tr></table></figure>
<p>   ç”¨æˆ·å:å¯†ç : base64ç¼–ç åï¼Œæ”¾åˆ°HTTP Authorization Header<br>  github.com/chyidl/noone via ğŸ¹ v1.17<br>  âœ basic=<code>echo -n &#39;admin:Admin@2021&#39;|base64</code></p>
<p>  github.com/chyidl/noone via ğŸ¹ v1.17<br>  âœ echo $basic<br>  YWRtaW46QWRtaW5AMjAyMQ==</p>
<p>  github.com/chyidl/noone via ğŸ¹ v1.17<br>  âœ echo $basic | base64 â€“decode<br>  admin:Admin@2021%</p>
<p>Basicè®¤è¯ç®€å•,ä½†æ˜¯ä¸å®‰å…¨, ä½¿ç”¨Basicè®¤è¯+SSLé…åˆä½¿ç”¨ç¡®ä¿æ•´ä¸ªè®¤è¯è¿‡ç¨‹å®‰å…¨</p>
<blockquote>
<p>ä¸è¦å†è¯·æ±‚å‚æ•°ä¸­ä½¿ç”¨æ˜æ–‡å¯†ç ï¼Œä¸è¦åœ¨ä»»ä½•å­˜å‚¨ä¸­ä¿å­˜æ˜æ–‡å¯†ç </p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">2.</span> Digest</span><br><span class="line"><span class="bullet">3.</span> OAuth</span><br><span class="line"><span class="bullet">4.</span> Bearer</span><br><span class="line"><span class="quote">&gt; Bearerè®¤è¯ç§°ä¸ºä»¤ç‰Œè®¤è¯ã€‚æ˜¯ä¸€ç§HTTPèº«ä»½éªŒè¯æ–¹å¼. Bearerè®¤è¯çš„æ ¸å¿ƒæ˜¯bearer token.</span></span><br></pre></td></tr></table></figure>
<p>bearer token: æ˜¯ä¸€ä¸ªåŠ å¯†å­—ç¬¦ä¸²ï¼Œç”±æœåŠ¡ç«¯æ ¹æ®å¯†é’¥ç”Ÿæˆ, å®¢æˆ·ç«¯åœ¨è¯·æ±‚æœåŠ¡ç«¯æ—¶ï¼Œå¿…é¡»åœ¨è¯·æ±‚å¤´åŒ…å«Authorization: Bearer <token>. æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚å¤´ï¼Œè§£æå‡º<token>.æ ¡éªŒ<token>åˆæ³•æ€§ï¼ŒBearerè®¤è¯é…åˆHTTPSä½¿ç”¨ï¼Œä¿è¯è®¤è¯å®‰å…¨æ€§</p>
<p>JSON Web Token: JWT<br>JWTæ˜¯Bearer Tokenä¸€ä¸ªå…·ä½“å®ç°ï¼Œç”±JSONæ•°æ®æ ¼å¼ç»„æˆ, é€šè¿‡HASHæ•£åˆ—ç®—æ³•ç”Ÿæˆå­—ç¬¦ä¸².</p>
<h1 id="JWT-è®¤è¯æµç¨‹"><a href="#JWT-è®¤è¯æµç¨‹" class="headerlink" title="JWT è®¤è¯æµç¨‹:"></a>JWT è®¤è¯æµç¨‹:</h1><blockquote>
<p>ä¸è¦å­˜æ”¾æ•æ„Ÿä¿¡æ¯åˆ°Tokenä¸­<br>Payload expå€¼ä¸è¦è®¾ç½®å¤ªå¤§ï¼Œä¸€èˆ¬å¼€å‘ç‰ˆæœ¬2å°æ—¶ï¼Œä¸Šçº¿ç‰ˆæœ¬7å¤©</p>
</blockquote>
<ol>
<li>å®¢æˆ·ç«¯ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç è¯·æ±‚ç™»é™†</li>
<li>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åï¼Œä¼šéªŒè¯ç”¨æˆ·åå’Œå¯†ç ï¼Œå¦‚æœç”¨æˆ·åå’Œå¯†ç éªŒè¯æˆåŠŸï¼ŒæœåŠ¡ç«¯ç­¾å‘Tokenè¿”å›ç»™å®¢æˆ·ç«¯</li>
<li>å®¢æˆ·ç«¯æ”¶åˆ°è¯·æ±‚åå°†Tokenç¼“å­˜èµ·æ¥ Cookieä¸­æˆ–è€…LocalStorage,ä¹‹åæ¯æ¬¡è¯·æ±‚éƒ½ä¼šæºå¸¦è¯¥Token</li>
<li>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åï¼ŒéªŒè¯è¯·æ±‚ä¸­çš„Token,éªŒè¯é€šè¿‡åˆ™è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œå¤„ç†å®Œè¿”å›å¤„ç†ç»“æœ</li>
</ol>
<h1 id="JWTæ ¼å¼"><a href="#JWTæ ¼å¼" class="headerlink" title="JWTæ ¼å¼:"></a>JWTæ ¼å¼:</h1><p>  1.Header</p>
<pre><code>- ç±»å‹å£°æ˜ JWT
- å£°æ˜åŠ å¯†ç®—æ³• HMAC SHA256
- å¯†é’¥ID å¯é€‰
  &#123;
    &quot;typ&quot;: &quot;JWT&quot;,
    &quot;alg&quot;: &quot;HS256&quot;
    &quot;kid&quot;: &quot;youknowwhoami&quot;
  &#125;
  Headerè¿›è¡Œbase64ç¼–ç 
  github.com/chyidl/noone via ğŸ¹ v1.17
  âœ echo -n &#39;&#123;&quot;typ&quot;:&quot;JWT&quot;,&quot;alg&quot;:&quot;HS256&quot;,&quot;kid&quot;:&quot;youknowwhoami&quot;&#125;&#39;|base64
  eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiIsImtpZCI6InlvdWtub3d3aG9hbWkifQ==
</code></pre>
<p>  2.Payload</p>
<pre><code>- JWTæ ‡å‡†ä¸­æ³¨å†Œçš„å£°æ˜
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">iss</span><span class="params">(Issuer)</span></span>: JWT Tokençš„ç­¾å‘è€…</span><br><span class="line"><span class="function"><span class="title">sub</span><span class="params">(Subject)</span></span>: ä¸»é¢˜</span><br><span class="line"><span class="function"><span class="title">exp</span><span class="params">(Expiration Time)</span></span>: JWT Tokenè¿‡æœŸæ—¶é—´</span><br><span class="line"><span class="function"><span class="title">aud</span><span class="params">(Audience)</span></span>: æ¥å—JWT Tokençš„ä¸€æ–¹</span><br><span class="line"><span class="function"><span class="title">iat</span><span class="params">(Issued At)</span></span>: JWT Tokenç­¾å‘æ—¶é—´</span><br><span class="line"><span class="function"><span class="title">nbf</span><span class="params">(Not Before)</span></span>: JWT Tokenç”Ÿæ•ˆæ—¶é—´</span><br><span class="line"><span class="function"><span class="title">jti</span><span class="params">(JWT ID)</span></span>: JWT Token ID,ä»¤ç‰Œçš„å”¯ä¸€æ ‡è¯†ç¬¦</span><br></pre></td></tr></table></figure>
- å…¬å…±çš„å£°æ˜
  &gt; æ·»åŠ ç”¨æˆ·ç›¸å…³ä¿¡æ¯æˆ–è€…å…¶ä»–ä¸šåŠ¡éœ€è¦ä¿¡æ¯
- ç§æœ‰çš„å£°æ˜
  &gt; å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å…±åŒå®šä¹‰çš„å£°æ˜ï¼Œbase64æ˜¯å¯¹ç§°åŠ å¯†ï¼Œä¸å»ºè®®å­˜æ”¾æ•æ„Ÿä¿¡æ¯
</code></pre>
<p>  3.Signature ç­¾å</p>
<pre><code>- header(base64åçš„)
- payload(base64å)
- secretKey: å¯†é’¥ï¼Œä¿å­˜åœ¨æœåŠ¡å™¨ä¸­ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶ä¿å­˜
- Salt(åŠ å¯†ç›)
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line">æœåŠ¡ç«¯æ”¶åˆ°<span class="built_in">Token</span>åä¼šè§£æå‡ºheader.payload ç„¶åç”¨ç›¸åŒçš„åŠ å¯†ç®—æ³•å’Œå¯†é’¥å¯¹header.payloadåœ¨è¿›è¡Œä¸€æ¬¡åŠ å¯†ï¼Œå¹¶å¯¹åŠ å¯†åçš„<span class="built_in">Token</span>å’Œæ”¶åˆ°çš„<span class="built_in">Token</span>æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒåˆ™éªŒè¯é€šè¿‡ï¼Œä¸ç›¸åŒè¿”å›HTTP <span class="number">401</span> Unauthrozied</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<h1 id="RequestID"><a href="#RequestID" class="headerlink" title="RequestID"></a>RequestID</h1><pre><code>&gt; å®šäºå’Œè·Ÿè¸ªRequestID
</code></pre>
<h1 id="è·¨åŸŸ"><a href="#è·¨åŸŸ" class="headerlink" title="è·¨åŸŸ"></a>è·¨åŸŸ</h1><pre><code>&gt; å½“å‰è½¯ä»¶æ¶æ„ä¸­é‡‡ç”¨å‰åç«¯åˆ†ç¦»ï¼Œå‰ç«¯è®¿é—®åœ°å€å’Œåç«¯æ–¹æ³•åœ°å€ä¸åŒï¼ŒWebæœåŠ¡éœ€è¦å¤„ç†æµè§ˆå™¨è·¨åŸŸè¯·æ±‚
</code></pre>
<h1 id="ä¼˜é›…å…³åœ"><a href="#ä¼˜é›…å…³åœ" class="headerlink" title="ä¼˜é›…å…³åœ"></a>ä¼˜é›…å…³åœ</h1>  <figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">```</span><br><span class="line"><span class="comment">// main.go</span></span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;golang.org/x/sync/errgroup&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Product struct &#123;</span><br><span class="line">	Username    string    `json:<span class="string">&quot;username&quot;</span> binding:<span class="string">&quot;required&quot;</span>`</span><br><span class="line">	Name        string    `json:<span class="string">&quot;name&quot;</span> binding:<span class="string">&quot;required&quot;</span>`</span><br><span class="line">	Category    string    `json:<span class="string">&quot;category&quot;</span> binding:<span class="string">&quot;required&quot;</span>`</span><br><span class="line">	Price       int       `json:<span class="string">&quot;price&quot;</span> binding:<span class="string">&quot;gte=0&quot;</span>`</span><br><span class="line">	Description string    `json:<span class="string">&quot;description&quot;</span>`</span><br><span class="line">	CreatedAt   time.Time `json:<span class="string">&quot;createdAt&quot;</span>`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> productHandler struct &#123;</span><br><span class="line">	sync.RWMutex</span><br><span class="line">	products map[string]Product</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func newProductHandler() *productHandler &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;productHandler&#123;</span><br><span class="line">		products: make(map[string]Product),</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (<span class="keyword">u</span> *productHandler) Create(c *gin.Context) &#123;</span><br><span class="line">	<span class="keyword">u</span>.Lock()</span><br><span class="line">	defer <span class="keyword">u</span>.Unlock()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 1. å‚æ•°è§£æ</span></span><br><span class="line">	<span class="keyword">var</span> product Product</span><br><span class="line">  <span class="comment">// å°†Bodyä¸­JSONæ ¼å¼æ•°æ®è§£æåˆ°æŒ‡å®šçš„Structä¸­</span></span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">err</span> := c.ShouldBindJSON(&amp;product); <span class="keyword">err</span> != nil &#123;</span><br><span class="line">    <span class="comment">// è¿”å›JSONæ ¼å¼æ•°æ®</span></span><br><span class="line">		c.JSON(http.StatusBadRequest, gin.<span class="keyword">H</span>&#123;<span class="string">&quot;error&quot;</span>: <span class="keyword">err</span>.<span class="keyword">Error</span>()&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. å‚æ•°æ ¡éªŒ</span></span><br><span class="line">	<span class="keyword">if</span> _, ok := <span class="keyword">u</span>.products[product.Name]; ok &#123;</span><br><span class="line">		c.JSON(http.StatusBadRequest, gin.<span class="keyword">H</span>&#123;<span class="string">&quot;error&quot;</span>: fmt.Sprintf(<span class="string">&quot;product %s already exist&quot;</span>, product.Name)&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	product.CreatedAt = time.Now()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3. é€»è¾‘å¤„ç†</span></span><br><span class="line">	<span class="keyword">u</span>.products[product.Name] = product</span><br><span class="line">	<span class="keyword">log</span>.Printf(<span class="string">&quot;Register product %s success&quot;</span>, product.Name)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 4. è¿”å›ç»“æœ</span></span><br><span class="line">	c.JSON(http.StatusOK, product)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (<span class="keyword">u</span> *productHandler) <span class="built_in">Get</span>(c *gin.Context) &#123;</span><br><span class="line">	<span class="keyword">u</span>.Lock()</span><br><span class="line">	defer <span class="keyword">u</span>.Unlock()</span><br><span class="line"></span><br><span class="line">	product, ok := <span class="keyword">u</span>.products[c.Param(<span class="string">&quot;name&quot;</span>)]</span><br><span class="line">	<span class="keyword">if</span> !ok &#123;</span><br><span class="line"></span><br><span class="line">		c.JSON(http.StatusNotFound, gin.<span class="keyword">H</span>&#123;<span class="string">&quot;error&quot;</span>: fmt.Errorf(<span class="string">&quot;can not found product %s&quot;</span>, c.Param(<span class="string">&quot;name&quot;</span>))&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	c.JSON(http.StatusOK, product)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func router() http.Handler &#123;</span><br><span class="line">	router := gin.Default()</span><br><span class="line">	productHandler := newProductHandler()</span><br><span class="line">	<span class="comment">// è·¯ç”±åˆ†ç»„/ä¸­é—´ä»¶/è®¤è¯</span></span><br><span class="line">	v1 := router.<span class="built_in">Group</span>(<span class="string">&quot;/v1&quot;</span>)</span><br><span class="line">	productv1 := v1.<span class="built_in">Group</span>(<span class="string">&quot;/products&quot;</span>)</span><br><span class="line">	productv1.<span class="keyword">POST</span>(<span class="string">&quot;&quot;</span>, productHandler.Create)</span><br><span class="line">  <span class="comment">// Ginæ”¯æŒä¸¤ç§è·¯ç”±åŒ¹é…è§„åˆ™</span></span><br><span class="line">  <span class="comment">//  /products/:name ç²¾ç¡®åŒ¹é…</span></span><br><span class="line">  <span class="comment">//  /products/*name æ¨¡ç³ŠåŒ¹é…</span></span><br><span class="line">	productv1.<span class="built_in">GET</span>(<span class="string">&quot;:name&quot;</span>, productHandler.Get)</span><br><span class="line">	<span class="keyword">return</span> router</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	<span class="keyword">var</span> eg errgroup.Group</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ä¸€è¿›ç¨‹å¤šç«¯å£</span></span><br><span class="line">  <span class="comment">// Ginæ˜¯åŸºäºnet/httpåŒ…å°è£…çš„webæ¡†æ¶</span></span><br><span class="line">	insecureServer := &amp;http.Server&#123;</span><br><span class="line">		Addr:         <span class="string">&quot;:8080&quot;</span>,</span><br><span class="line">		Handler:      router(),</span><br><span class="line">		ReadTimeout:  5 * time.Second,</span><br><span class="line">		WriteTimeout: 10 * time.Second,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	secureServer := &amp;http.Server&#123;</span><br><span class="line">		Addr:         <span class="string">&quot;:8443&quot;</span>,</span><br><span class="line">		Handler:      router(),</span><br><span class="line">		ReadTimeout:  5 * time.Second,</span><br><span class="line">		WriteTimeout: 10 * time.Second,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	eg.Go(func() <span class="keyword">error</span> &#123;</span><br><span class="line">		<span class="keyword">err</span> := insecureServer.ListenAndServe()</span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">err</span> != nil &amp;&amp; <span class="keyword">err</span> != http.ErrServerClosed &#123;</span><br><span class="line">			<span class="keyword">log</span>.Fatal(<span class="keyword">err</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">err</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	eg.Go(func() <span class="keyword">error</span> &#123;</span><br><span class="line">		path, <span class="keyword">err</span> := os.Getwd()</span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">err</span> != nil &#123;</span><br><span class="line">			<span class="keyword">log</span>.Println(<span class="keyword">err</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">log</span>.Println(path)</span><br><span class="line">		<span class="keyword">err</span> = secureServer.ListenAndServeTLS(<span class="string">&quot;./server.pem&quot;</span>, <span class="string">&quot;./server.key&quot;</span>)</span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">err</span> != nil &amp;&amp; <span class="keyword">err</span> != http.ErrServerClosed &#123;</span><br><span class="line">			<span class="keyword">log</span>.Fatal(<span class="keyword">err</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">err</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">err</span> := eg.Wait(); <span class="keyword">err</span> != nil &#123;</span><br><span class="line">		<span class="keyword">log</span>.Fatal(<span class="keyword">err</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h2><ul>
<li>æ”¯æŒHTTPæ–¹æ³•: GET/POST/PUT/PATCH/DELETE/OPTIONS</li>
<li>æ”¯æŒä¸åŒä½ç½®çš„HTTPå‚æ•°:<ul>
<li>è·¯å¾„å‚æ•° path tag uri /user/:name nameå°±æ˜¯è·¯å¾„å‚æ•°<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">è·¯å¾„å‚æ•°: ShouldBindUri, BindUri</span></span><br></pre></td></tr></table></figure></li>
<li>æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•° query tag form /welcome?firstname=xx firstnameå°±æ˜¯æŸ¥è¯¢å‚æ•°<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°: ShouldBindQuery, BindQuery</span></span><br></pre></td></tr></table></figure></li>
<li>è¡¨å•å‚æ•° form tag form curl -X POST -F â€˜username=colinsâ€™ <a href="http://mydomain.com/login">http://mydomain.com/login</a>, usernameå°±æ˜¯è¡¨å•å‚æ•°<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">è¡¨å•å‚æ•°: ShouldBind</span></span><br></pre></td></tr></table></figure></li>
<li>HTTPå¤´å‚æ•° header tag header curl -X POST -H â€˜Content-Type:application/jsonâ€™ <a href="http://mydomain.com/login">http://mydomain.com/login</a> Content-Typeå°±æ˜¯HTTPå¤´å‚æ•°<figure class="highlight ldif"><table><tr><td class="code"><pre><span class="line"><span class="attribute">HTTPå¤´å‚æ•°</span>: ShouldBindHeader, BindHeader</span><br></pre></td></tr></table></figure></li>
<li>æ¶ˆæ¯ä½“å‚æ•° body tag json/xml curl -X POST -H â€˜Content-Type:application/jsonâ€™ -d â€˜{â€œusernameâ€:â€colinsâ€}â€™ <a href="http://mydomain.com/login">http://mydomain.com/login</a>, usernameå°±æ˜¯æ¶ˆæ¯ä½“å‚æ•°<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">æ¶ˆæ¯ä½“å‚æ•°: ShouldBindJSON, BindJSON</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>æ”¯æŒHTTPè·¯ç”±å’Œè·¯ç”±åˆ†ç»„</li>
<li>æ”¯æŒè‡ªå®šä¹‰Log</li>
<li>æ”¯æŒbindingå’Œvalidation,</li>
<li>æ”¯æŒé‡å®šå‘</li>
<li>æ”¯æŒbasic auth middleware</li>
<li>æ”¯æŒè‡ªå®šä¹‰HTTPé…ç½®</li>
<li>æ”¯æŒä¼˜é›…å…³é—­</li>
<li>æ”¯æŒHTTP2</li>
<li>æ”¯æŒè®¾ç½®è·å–cookie</li>
</ul>
<h2 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h2><ul>
<li><p>ping-pong</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.GET(<span class="string">&quot;/ping&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;pong&quot;</span>&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯åŠ¨ &amp; è¿è¡Œ<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">âœ go run main.go</span><br><span class="line">[GIN-<span class="keyword">debug</span>] [<span class="built_in">WARNING</span>] Creating an Engine instance <span class="keyword">with</span> the Logger <span class="keyword">and</span> Recovery middleware already attached.</span><br><span class="line"></span><br><span class="line">[GIN-<span class="keyword">debug</span>] [<span class="built_in">WARNING</span>] Running <span class="keyword">in</span> &quot;debug&quot; mode. Switch <span class="keyword">to</span> &quot;release&quot; mode <span class="keyword">in</span> production.</span><br><span class="line"> - <span class="keyword">using</span> env:	export GIN_MODE=<span class="keyword">release</span></span><br><span class="line"> - <span class="keyword">using</span> code:	gin.SetMode(gin.ReleaseMode)</span><br><span class="line"></span><br><span class="line">[GIN-<span class="keyword">debug</span>] <span class="keyword">GET</span>    /ping                     <span class="comment">--&gt; main.main.func1 (3 handlers)</span></span><br><span class="line">[GIN-<span class="keyword">debug</span>] Environment variable PORT <span class="keyword">is</span> undefined. <span class="keyword">Using</span> port :<span class="number">8080</span> <span class="keyword">by</span> <span class="keyword">default</span></span><br><span class="line">[GIN-<span class="keyword">debug</span>] Listening <span class="keyword">and</span> serving HTTP <span class="keyword">on</span> :<span class="number">8080</span></span><br><span class="line"></span><br><span class="line"># è°ƒç”¨</span><br><span class="line">âœ curl -X <span class="keyword">GET</span> http://localhost:<span class="number">8080</span>/ping</span><br><span class="line">&#123;&quot;message&quot;:&quot;pong&quot;&#125;%</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>æºç åˆ†æ</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"># gin.Default</span><br><span class="line"></span><br><span class="line"><span class="comment">// Default returns an Engine instance with the Logger and Recovery middleware already attached.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Default</span><span class="params">()</span> *<span class="title">Engine</span></span> &#123;</span><br><span class="line">	debugPrintWARNINGDefault()  <span class="comment">// æ£€æŸ¥Goç‰ˆæœ¬æ˜¯å¦è¾¾åˆ°Ginæœ€ä½è¦æ±‚</span></span><br><span class="line">	engine := New()</span><br><span class="line">	engine.Use(Logger(), Recovery()) <span class="comment">// å¼•å…¥ä¸­é—´ä»¶</span></span><br><span class="line">	<span class="keyword">return</span> engine</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># gin.New</span><br><span class="line"><span class="comment">// New returns a new blank Engine instance without any middleware attached.</span></span><br><span class="line"><span class="comment">// By default the configuration is:</span></span><br><span class="line"><span class="comment">// - RedirectTrailingSlash:  true</span></span><br><span class="line"><span class="comment">// - RedirectFixedPath:      false</span></span><br><span class="line"><span class="comment">// - HandleMethodNotAllowed: false</span></span><br><span class="line"><span class="comment">// - ForwardedByClientIP:    true</span></span><br><span class="line"><span class="comment">// - UseRawPath:             false</span></span><br><span class="line"><span class="comment">// - UnescapePathValues:     true</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">()</span> *<span class="title">Engine</span></span> &#123;</span><br><span class="line">	debugPrintWARNINGNew()</span><br><span class="line">	engine := &amp;Engine&#123; <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">		RouterGroup: RouterGroup&#123; <span class="comment">// è·¯ç”±ç»„</span></span><br><span class="line">			Handlers: <span class="literal">nil</span>,</span><br><span class="line">			basePath: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">			root:     <span class="literal">true</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">		FuncMap:                template.FuncMap&#123;&#125;,</span><br><span class="line">		RedirectTrailingSlash:  <span class="literal">true</span>,</span><br><span class="line">		RedirectFixedPath:      <span class="literal">false</span>,</span><br><span class="line">		HandleMethodNotAllowed: <span class="literal">false</span>,</span><br><span class="line">		ForwardedByClientIP:    <span class="literal">true</span>,</span><br><span class="line">		RemoteIPHeaders:        []<span class="keyword">string</span>&#123;<span class="string">&quot;X-Forwarded-For&quot;</span>, <span class="string">&quot;X-Real-IP&quot;</span>&#125;,</span><br><span class="line">		TrustedProxies:         []<span class="keyword">string</span>&#123;<span class="string">&quot;0.0.0.0/0&quot;</span>&#125;,</span><br><span class="line">		AppEngine:              defaultAppEngine,</span><br><span class="line">		UseRawPath:             <span class="literal">false</span>,</span><br><span class="line">		RemoveExtraSlash:       <span class="literal">false</span>,</span><br><span class="line">		UnescapePathValues:     <span class="literal">true</span>,</span><br><span class="line">		MaxMultipartMemory:     defaultMultipartMemory, <span class="comment">// const defaultMultipartMemory = 32 &lt;&lt; 20 // 32 MB</span></span><br><span class="line">		trees:                  <span class="built_in">make</span>(methodTrees, <span class="number">0</span>, <span class="number">9</span>),</span><br><span class="line">		delims:                 render.Delims&#123;Left: <span class="string">&quot;&#123;&#123;&quot;</span>, Right: <span class="string">&quot;&#125;&#125;&quot;</span>&#125;, <span class="comment">// HTML æ¨¡ç‰ˆå·¦å³å®šç•Œç¬¦</span></span><br><span class="line">		secureJSONPrefix:       <span class="string">&quot;while(1);&quot;</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	engine.RouterGroup.engine = engine</span><br><span class="line">	engine.pool.New = <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">		<span class="keyword">return</span> engine.allocateContext()</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> engine</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># r.GET()</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="params">(group *RouterGroup)</span> <span class="title">handle</span><span class="params">(httpMethod, relativePath <span class="keyword">string</span>, handlers HandlersChain)</span> <span class="title">IRoutes</span></span> &#123;</span><br><span class="line">    absolutePath := group.calculateAbsolutePath(relativePath) <span class="comment">// è®¡ç®—è·¯ç”±çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line">    handlers = group.combineHandlers(handlers)</span><br><span class="line">    group.engine.addRoute(httpMethod, absolutePath, handlers) <span class="comment">// è¿½åŠ åˆ°æ ‘</span></span><br><span class="line">    <span class="keyword">return</span> group.returnObj()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"># r.Run()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Run attaches the router to a http.Server and starts listening and serving HTTP requests.</span></span><br><span class="line"><span class="comment">// It is a shortcut for http.ListenAndServe(addr, router)</span></span><br><span class="line"><span class="comment">// Note: this method will block the calling goroutine indefinitely unless an error happens.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(engine *Engine)</span> <span class="title">Run</span><span class="params">(addr ...<span class="keyword">string</span>)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; debugPrintError(err) &#125;()</span><br><span class="line"></span><br><span class="line">	trustedCIDRs, err := engine.prepareTrustedCIDRs()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	engine.trustedCIDRs = trustedCIDRs</span><br><span class="line">	address := resolveAddress(addr)</span><br><span class="line">	debugPrint(<span class="string">&quot;Listening and serving HTTP on %s\n&quot;</span>, address)</span><br><span class="line">	err = http.ListenAndServe(address, engine)</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸Šä¸‹æ–‡æ± åŒ–é˜²æ­¢é¢‘ç¹ç”Ÿæˆä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œæé«˜æ€§èƒ½</span></span><br><span class="line"><span class="comment">// ServeHTTP conforms to the http.Handler interface.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(engine *Engine)</span> <span class="title">ServeHTTP</span><span class="params">(w http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">	c := engine.pool.Get().(*Context) <span class="comment">// sync.Pool å¯¹è±¡æ± ä¸­è·å–ä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡</span></span><br><span class="line">	c.writermem.reset(w)</span><br><span class="line">	c.Request = req</span><br><span class="line">	c.reset()</span><br><span class="line"></span><br><span class="line">	engine.handleHTTPRequest(c)</span><br><span class="line"></span><br><span class="line">	engine.pool.Put(c) <span class="comment">// è¿”å›å¯¹è±¡æ± </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>Gin</tag>
        <tag>Webæ¡†æ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>Makefile Intro</title>
    <url>/2021/09/08/Makefile-Intro/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>MySQL Index Intro</title>
    <url>/2021/09/08/MySQL-Index-Intro/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>æ•°æ®ç»“æ„-Radix-Tree</title>
    <url>/2021/09/08/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-Radix-Tree/</url>
    <content><![CDATA[<h1 id="Radix-Tree-åŸºæ•°æ ‘"><a href="#Radix-Tree-åŸºæ•°æ ‘" class="headerlink" title="Radix Tree - åŸºæ•°æ ‘"></a>Radix Tree - åŸºæ•°æ ‘</h1><blockquote>
<p>radix treeç”¨äºè¡¨ç¤ºä¸€ç§ç©ºé—´ä¼˜åŒ–çš„tree. å‡å¦‚æ ‘ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å”¯ä¸€å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹å°†ä¼šä¸çˆ¶èŠ‚ç‚¹è¿›è¡Œåˆå¹¶ radix treeçš„è¾¹æ²¿edgeså¯ä»¥æ˜¯ä¸€ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ <br>å…ƒç´ ä¸ªæ•°ä¸æ˜¯å¤ªå¤šï¼Œä½†æ˜¯å…ƒç´ ä¹‹é—´é€šå¸¸æœ‰å¾ˆé•¿çš„ç›¸åŒå‰ç¼€æ—¶å¾ˆé€‚åˆé‡‡ç”¨radix treeå­˜å‚¨<br>Golangçš„webæ¡†æ¶ginä½¿ç”¨radix treeä½œä¸ºè·¯ç”±æŸ¥æ‰¾çš„ç®—æ³•.</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"># gin/gin.go</span><br><span class="line"></span><br><span class="line">// <span class="keyword">method</span> -&gt; HTTP <span class="keyword">Method</span> &#123;<span class="keyword">GET</span>,PUT,POST,<span class="keyword">DELETE</span>&#125;</span><br><span class="line">func (engine *Engine) addRoute(<span class="keyword">method</span>, <span class="type">path</span> string, handlers HandlersChain) &#123;</span><br><span class="line">	assert1(<span class="type">path</span>[<span class="number">0</span>] == <span class="string">&#x27;/&#x27;</span>, &quot;path must begin with &#x27;/&#x27;&quot;)</span><br><span class="line">	assert1(<span class="keyword">method</span> != &quot;&quot;, &quot;HTTP method can not be empty&quot;)</span><br><span class="line">	assert1(len(handlers) &gt; <span class="number">0</span>, &quot;there must be at least one handler&quot;)</span><br><span class="line"></span><br><span class="line">	debugPrintRoute(<span class="keyword">method</span>, <span class="type">path</span>, handlers)</span><br><span class="line"></span><br><span class="line">  // æ¯ä¸€ä¸ª<span class="keyword">method</span>å¯¹åº”ä¸€é¢—radix tree</span><br><span class="line">	root := engine.trees.<span class="keyword">get</span>(<span class="keyword">method</span>)</span><br><span class="line">	<span class="keyword">if</span> root == nil &#123;</span><br><span class="line">    // å¦‚æœè·å–ä¸åˆ°<span class="keyword">method</span>å¯¹åº”çš„æ ‘ï¼Œå°±åˆ›å»º</span><br><span class="line">		root = <span class="built_in">new</span>(node)</span><br><span class="line">		root.fullPath = &quot;/&quot;</span><br><span class="line">		engine.trees = append(engine.trees, methodTree&#123;<span class="keyword">method</span>: <span class="keyword">method</span>, root: root&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">	root.addRoute(<span class="type">path</span>, handlers)</span><br><span class="line"></span><br><span class="line">	// <span class="keyword">Update</span> maxParams</span><br><span class="line">	<span class="keyword">if</span> paramsCount := countParams(<span class="type">path</span>); paramsCount &gt; engine.maxParams &#123;</span><br><span class="line">		engine.maxParams = paramsCount</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
      </tags>
  </entry>
  <entry>
    <title>é™æ€ä»£ç æ£€æŸ¥ golangci-lint</title>
    <url>/2021/09/08/%E9%9D%99%E6%80%81%E4%BB%A3%E7%A0%81%E6%A3%80%E6%9F%A5-golangci-lint/</url>
    <content><![CDATA[<h1 id="é™æ€ä»£ç æ£€æŸ¥"><a href="#é™æ€ä»£ç æ£€æŸ¥" class="headerlink" title="é™æ€ä»£ç æ£€æŸ¥"></a>é™æ€ä»£ç æ£€æŸ¥</h1><span id="more"></span>

<h2 id="golangci-lint"><a href="#golangci-lint" class="headerlink" title="golangci-lint"></a>golangci-lint</h2><blockquote>
<p>golangci-lint is a fast Go linters runner. It runs linters in parallel, uses caching, supports yaml config, has integrations with all major IDE and has dozens of linters included.</p>
</blockquote>
]]></content>
      <tags>
        <tag>golangci-lint</tag>
      </tags>
  </entry>
  <entry>
    <title>Error Code Design Intro</title>
    <url>/2021/09/09/Error-Code-Design-Intro/</url>
    <content><![CDATA[<h1 id="é”™è¯¯ç è®¾è®¡"><a href="#é”™è¯¯ç è®¾è®¡" class="headerlink" title="é”™è¯¯ç è®¾è®¡"></a>é”™è¯¯ç è®¾è®¡</h1><ul>
<li>é”™è¯¯ç å®ç°æ–¹å¼<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>. æ— è®ºè¯·æ±‚æˆåŠŸæˆ–å¤±è´¥ï¼Œå§‹ç»ˆè¿”å›<span class="number">200</span> http status <span class="selector-tag">code</span></span><br><span class="line"> &gt; æ¯æ¬¡è¯·æ±‚ï¼Œéƒ½éœ€è¦è§£æHTTP <span class="selector-tag">Body</span>,ä»ä¸­è§£æå‡ºé”™è¯¯ç å’Œé”™è¯¯ä¿¡æ¯.</span><br><span class="line"><span class="number">2</span>. è¿”å›åˆé€‚çš„HTTP <span class="selector-tag">Code</span>. å¹¶åœ¨<span class="selector-tag">Body</span>ä¸­è¿”å›é”™è¯¯ä¿¡æ¯å’Œè‡ªå®šä¹‰ä¸šåŠ¡<span class="selector-tag">Code</span></span><br><span class="line"><span class="number">3</span>. è¿”å›åˆé€‚çš„HTTP <span class="selector-tag">Code</span>, å¹¶åœ¨<span class="selector-tag">Body</span>ä¸­è¯¦å°½çš„é”™è¯¯ä¿¡æ¯</span><br></pre></td></tr></table></figure></li>
<li>ä¸šåŠ¡Codeç è®¾è®¡</li>
</ul>
]]></content>
      <tags>
        <tag>Error</tag>
      </tags>
  </entry>
  <entry>
    <title>SwaggerAPI intro</title>
    <url>/2021/09/09/SwaggerAPI-intro/</url>
    <content><![CDATA[<h1 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h1><blockquote>
<p>Swaggeræ˜¯ä¸€å¥—å›´ç»•OpenAPIè§„èŒƒæ„å»ºçš„å¼€æºå·¥å…·,å¯ä»¥è®¾è®¡Â·æ„å»ºÂ·ç¼–å†™Â·ä½¿ç”¨RESTAPI</p>
</blockquote>
<ul>
<li>Swaggerç¼–è¾‘å™¨:</li>
<li>Swagger UI: å°†OpenAPIè§„èŒƒå‘ˆç°ä¸ºäº¤äº’å¼APIæ–‡æ¡£ï¼Œå¹¶å¯ä»¥åœ¨æµè§ˆå™¨ä¸­å°è¯•APIè°ƒç”¨</li>
<li>Swagger Codegen: æ ¹æ®OpenAPIè§„èŒƒï¼Œç”ŸæˆæœåŠ¡å™¨å­˜æ ¹å’Œå®¢æˆ·ç«¯ä»£ç åº“</li>
</ul>
<span id="more"></span>

<h2 id="Swaggerå’ŒOpenAPIåŒºåˆ«"><a href="#Swaggerå’ŒOpenAPIåŒºåˆ«" class="headerlink" title="Swaggerå’ŒOpenAPIåŒºåˆ«"></a>Swaggerå’ŒOpenAPIåŒºåˆ«</h2><ul>
<li>OpenAPI<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">OpenAPIæ˜¯ä¸€ä¸ªAPIè§„èŒƒï¼Œå‰èº«æ˜¯<span class="keyword">Swaggerè§„èŒƒ. </span><span class="keyword">Swaggeræ˜¯å®ç°è§„èŒƒçš„å·¥å…·</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="go-swaggerç”ŸæˆSwagger-API-æ–‡æ¡£"><a href="#go-swaggerç”ŸæˆSwagger-API-æ–‡æ¡£" class="headerlink" title="go-swaggerç”ŸæˆSwagger API æ–‡æ¡£"></a>go-swaggerç”ŸæˆSwagger API æ–‡æ¡£</h2><ul>
<li><p>go-swaggerç‰¹å¾</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> æ ¹æ®Swaggerå®šä¹‰æ–‡ä»¶ç”ŸæˆæœåŠ¡ç«¯ä»£ç </span><br><span class="line"><span class="bullet">2.</span> æ ¹æ®Swaggerå®šä¹‰æ–‡ä»¶ç”Ÿæˆå®¢æˆ·ç«¯ä»£ç </span><br><span class="line"><span class="bullet">3.</span> æ ¡éªŒSwaggerå®šä¹‰æ–‡ä»¶æ˜¯å¦æ­£ç¡®</span><br><span class="line"><span class="bullet">4.</span> å¯åŠ¨ä¸€ä¸ªHTTPæœåŠ¡å™¨ï¼Œä½¿æˆ‘ä»¬å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®APIæ–‡æ¡£</span><br><span class="line"><span class="bullet">5.</span> æ ¹æ®Swaggeræ–‡æ¡£å®šä¹‰çš„å‚æ•°ç”ŸæˆGo Modelç»“æ„ä½“å®šä¹‰</span><br></pre></td></tr></table></figure></li>
<li><p>Swaggerå·¥å…·</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">github.com<span class="regexp">/chyidl/</span>noone via ğŸ¹ v1.<span class="number">17</span></span><br><span class="line">âœ go get -u github.com<span class="regexp">/go-swagger/g</span>o-swagger<span class="regexp">/cmd/</span>swagger</span><br><span class="line"></span><br><span class="line">github.com<span class="regexp">/chyidl/</span>noone via ğŸ¹ v1.<span class="number">17</span> took <span class="number">25</span>s</span><br><span class="line">âœ swagger version</span><br><span class="line">version: v0.<span class="number">27.0</span></span><br><span class="line">commit: (unknown, mod sum: <span class="string">&quot;h1:K7+nkBuf4oS1jTBrdvWqYFpqD69V5CN8HamZzCDDhAI=&quot;</span>)</span><br><span class="line"></span><br><span class="line">github.com<span class="regexp">/chyidl/g</span>o-swagger-demo via ğŸ¹ v1.<span class="number">17</span></span><br><span class="line">âœ swagger generate spec -o swagger.yaml</span><br><span class="line">  -o: æŒ‡å®šè¾“å‡ºæ–‡ä»¶å</span><br><span class="line"></span><br><span class="line">github.com<span class="regexp">/chyidl/g</span>o-swagger-demo via ğŸ¹ v1.<span class="number">17</span></span><br><span class="line">âœ ls</span><br><span class="line">api          docs         go.mod       main.go      swagger.yaml</span><br><span class="line">github.com<span class="regexp">/chyidl/g</span>o-swagger-demo via ğŸ¹ v1.<span class="number">17</span></span><br><span class="line">âœ swagger serve --no-open -F=swagger --port <span class="number">36666</span> swagger.yaml</span><br><span class="line"><span class="number">2021</span><span class="regexp">/09/</span><span class="number">09</span> <span class="number">12</span>:<span class="number">58</span>:<span class="number">09</span> serving docs at http:<span class="regexp">//</span>localhost:<span class="number">36666</span>/docs</span><br><span class="line">  --no-open: ç¦æ­¢è°ƒç”¨æµè§ˆå™¨æ‰“å¼€</span><br><span class="line">  -F: æŒ‡å®šæ–‡æ¡£é£æ ¼</span><br><span class="line">  --port: æŒ‡å®šå¯åŠ¨çš„HTTPæœåŠ¡ç›‘å¬</span><br><span class="line"></span><br><span class="line">github.com<span class="regexp">/chyidl/g</span>o-swagger-demo via ğŸ¹ v1.<span class="number">17</span></span><br><span class="line">âœ swagger generate spec -i .<span class="regexp">/swagger.yaml -o ./</span>swagger.json</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> swagger:route POST /users user createUserRequest</span><br><span class="line"><span class="regexp">//</span> Create a user <span class="keyword">in</span> memory.</span><br><span class="line"><span class="regexp">//</span> responses:</span><br><span class="line"><span class="regexp">//</span>   <span class="number">200</span>: createUserResponse</span><br><span class="line"><span class="regexp">//</span>   default: errResponse</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> swagger:route GET <span class="regexp">/users/</span>&#123;name&#125; user getUserRequest</span><br><span class="line"><span class="regexp">//</span> Get a user from memory.</span><br><span class="line"><span class="regexp">//</span> responses:</span><br><span class="line"><span class="regexp">//</span>   <span class="number">200</span>: getUserResponse</span><br><span class="line"><span class="regexp">//</span>   default: errResponse</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>SwaggerAPI</tag>
      </tags>
  </entry>
  <entry>
    <title>gorm intro</title>
    <url>/2021/09/09/gorm-intro/</url>
    <content><![CDATA[<h1 id="GORM"><a href="#GORM" class="headerlink" title="GORM"></a>GORM</h1>]]></content>
      <tags>
        <tag>ORM</tag>
      </tags>
  </entry>
  <entry>
    <title>Go Concurrency Patterns</title>
    <url>/2021/09/10/Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="Golang"><a href="#Golang" class="headerlink" title="Golang"></a>Golang</h1><ul>
<li><p>Simplicity: ç®€å•</p>
<blockquote>
<p>Simplicity is prerequisite for reliability. ç®€å•æ˜¯å¯é çš„å…ˆè§‰æ¡ä»¶</p>
</blockquote>
</li>
<li><p>Readablity: å¯è¯»æ€§</p>
<blockquote>
<p>Readability is essential for maintainablity. å¯è¯»æ€§å¯¹äºå¯ç»´æŠ¤æ€§è‡³å…³é‡è¦<br>Programs must be written for people to read, and only incidentally for machine to execute. ç¨‹åºå¿…é¡»æ˜¯ä¸ºäººä»¬é˜…è¯»è€Œç¼–å†™çš„ï¼Œè€Œå¶ç„¶ä¸ºåŠå…¶æ‰§è¡Œè€Œç¼–å†™</p>
</blockquote>
</li>
<li><p>Productivity: ç”Ÿäº§åŠ›</p>
<blockquote>
<p>Design is the art of arranging code to work today, and be changeable forever.</p>
</blockquote>
</li>
</ul>
<span id="more"></span>

<h2 id="A-First-Look-Go-Programming-Language"><a href="#A-First-Look-Go-Programming-Language" class="headerlink" title="A First Look - Go Programming Language"></a>A First Look - Go Programming Language</h2><ul>
<li><p>Hello World</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">package main                    <span class="regexp">//</span> å£°æ˜æœ¬æ–‡ä»¶çš„åŒ…å</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> <span class="number">1</span>. åœ¨importä¸­å¯ä»¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ .<span class="regexp">/ ../</span> å¼•å…¥package</span><br><span class="line"><span class="regexp">//</span> <span class="number">2</span>. å¦‚æœæ²¡æœ‰ç›¸å¯¹è·¯å¾„ Goä¼šä»<span class="variable">$GOPATH</span><span class="regexp">/src/</span>ç›®å½•å¯»æ‰¾</span><br><span class="line">import <span class="string">&quot;fmt&quot;</span>                    <span class="regexp">//</span> importè¯­è¨€çš„fmtåº“ - ç”¨äºè¾“å‡º</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;hello world&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="regexp">//</span> fmt è¾“å‡ºæ ¼å¼</span><br><span class="line">  fmt.Printf(<span class="string">&quot;%t\n&quot;</span>, <span class="number">1</span> == <span class="number">2</span>)</span><br><span class="line"> fmt.Printf(<span class="string">&quot;äºŒè¿›åˆ¶: %b\n&quot;</span>, <span class="number">255</span>)</span><br><span class="line"> fmt.Printf(<span class="string">&quot;å…«è¿›åˆ¶: %o\n&quot;</span>, <span class="number">255</span>)</span><br><span class="line"> fmt.Printf(<span class="string">&quot;åå…­è¿›åˆ¶: %x\n&quot;</span>, <span class="number">255</span>)</span><br><span class="line"> fmt.Printf(<span class="string">&quot;æµ®ç‚¹æ•°: %f\n&quot;</span>, math.Pi)</span><br><span class="line"> fmt.Printf(<span class="string">&quot;å­—ç¬¦ä¸²: %s\n&quot;</span>, <span class="string">&quot;hello world&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>var &amp; const</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å£°æ˜åˆå§‹åŒ–ä¸€ä¸ªå˜é‡</span></span><br><span class="line"><span class="keyword">var</span> x <span class="keyword">int</span> = <span class="number">100</span></span><br><span class="line"><span class="keyword">var</span> str <span class="keyword">string</span> = <span class="string">&quot;hello world&quot;</span></span><br><span class="line"><span class="comment">// å£°æ˜åˆå§‹åŒ–å¤šä¸ªå˜é‡</span></span><br><span class="line"><span class="keyword">var</span> i, j, k <span class="keyword">int</span> = <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span></span><br><span class="line"><span class="comment">// ä¸æŒ‡æ˜ç±»å‹ï¼Œé€šè¿‡åˆå§‹åŒ–å€¼æ¨å¯¼</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="literal">true</span> <span class="comment">// bool ç±»å‹</span></span><br><span class="line">x := <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸¸é‡</span></span><br><span class="line"><span class="keyword">const</span> p <span class="keyword">string</span> = <span class="string">&quot;hello world&quot;</span></span><br><span class="line"><span class="keyword">const</span> pi <span class="keyword">float32</span> = <span class="number">3.1415926</span></span><br></pre></td></tr></table></figure></li>
<li><p>Array &amp; Slice</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Slices in the runtime are represented by three components:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// type slice struct &#123;</span></span><br><span class="line"><span class="comment">// 	ptr unsafe.Pointer          // æŒ‡å‘å­˜æ”¾æ•°æ®çš„æ•°ç»„æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">// 	len int                     // é•¿åº¦æœ‰å¤šå¤§</span></span><br><span class="line"><span class="comment">// 	cap int                     // å®¹é‡æœ‰å¤šå¤§</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨åå°„reflect.DeepEqual() è¿›è¡Œæ·±åº¦æ¯”è¾ƒ</span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> data <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="built_in">len</span> <span class="keyword">int</span></span><br><span class="line">	p   *<span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¯”è¾ƒä¸¤ä¸ªç»“æ„ä½“ä¸­æ•°æ®æ˜¯å¦ç›¸åŒ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	v1 := data&#123;&#125;</span><br><span class="line">	v2 := data&#123;&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;v1 == v2:&quot;</span>, reflect.DeepEqual(v1, v2))</span><br><span class="line">	<span class="comment">// prints: v1 == v2: true</span></span><br><span class="line"></span><br><span class="line">	m1 := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;<span class="string">&quot;one&quot;</span>: <span class="string">&quot;a&quot;</span>, <span class="string">&quot;two&quot;</span>: <span class="string">&quot;b&quot;</span>&#125;</span><br><span class="line">	m2 := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;<span class="string">&quot;two&quot;</span>: <span class="string">&quot;b&quot;</span>, <span class="string">&quot;one&quot;</span>: <span class="string">&quot;a&quot;</span>&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;m1 == m2:&quot;</span>, reflect.DeepEqual(m1, m2))</span><br><span class="line">	<span class="comment">// prints: m1 == m2: true</span></span><br><span class="line"></span><br><span class="line">	s1 := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">	s2 := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;s1 == s2:&quot;</span>, reflect.DeepEqual(s1, s2))</span><br><span class="line">	<span class="comment">// prints: s1 == s2: true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Go-Model-CSP"><a href="#Go-Model-CSP" class="headerlink" title="Go Model: CSP"></a>Go Model: CSP</h2><ul>
<li>CSP:<blockquote>
<p>Communicating Sequential Processes</p>
</blockquote>
</li>
</ul>
<h2 id="å¹¶å‘-Concurrency-amp-amp-å¹¶è¡Œ-Parallelism"><a href="#å¹¶å‘-Concurrency-amp-amp-å¹¶è¡Œ-Parallelism" class="headerlink" title="å¹¶å‘(Concurrency) &amp;&amp; å¹¶è¡Œ(Parallelism)"></a>å¹¶å‘(Concurrency) &amp;&amp; å¹¶è¡Œ(Parallelism)</h2><ul>
<li><p>å¹¶å‘(Concurrency):</p>
<blockquote>
<p>Programming as the composition of independently executing processes.<br>Concurrency is about dealing with lots of things at once.<br>Concurreny is about structure</p>
</blockquote>
</li>
<li><p>å¹¶è¡Œ(Parallelism)</p>
<blockquote>
<p>programming as the simultaneous execution of computations.<br>Parallelism is about doing lots of things at once.<br>Parallelism is about execution</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>A well-written concurrent program might run efficiently in parallel on a multiprocessor.</p>
</blockquote>
<h2 id="è¿›ç¨‹-amp-çº¿ç¨‹"><a href="#è¿›ç¨‹-amp-çº¿ç¨‹" class="headerlink" title="è¿›ç¨‹ &amp; çº¿ç¨‹"></a>è¿›ç¨‹ &amp; çº¿ç¨‹</h2><blockquote>
<p>è¿›ç¨‹ Process: ä¸€èˆ¬æ˜¯èµ„æºåˆ†é…å•å…ƒï¼Œä¸€ä¸ªè¿›ç¨‹æ‹¥æœ‰å †ã€æ ˆã€è™šå­˜ç©ºé—´(é¡µè¡¨)ã€æ–‡ä»¶æè¿°ç¬¦<br>çº¿ç¨‹ Thread: CPUè¿›è¡Œè°ƒåº¦å’Œæ‰§è¡Œçš„å®ä½“<br>ä¸»è¿›ç¨‹/ä¸»çº¿ç¨‹: å¦‚æœä¸€ä¸ªè¿›ç¨‹å¯åŠ¨åï¼Œæ²¡æœ‰åœ¨åˆ›å»ºé¢å¤–çš„çº¿ç¨‹ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿›ç¨‹ä¸€èˆ¬ç§°ä¸ºä¸»è¿›ç¨‹æˆ–ä¸»çº¿ç¨‹ã€‚</p>
</blockquote>
<h2 id="Goroutine"><a href="#Goroutine" class="headerlink" title="Goroutine"></a>Goroutine</h2><blockquote>
<p>Concurrent execution<br>A goroutine is a function running independently in the same address space as other goroutines<br>has its own call stack, which grows and shrinks as required.</p>
</blockquote>
<ul>
<li>goroutine ç”Ÿå‘½å‘¨æœŸç®¡ç†<ul>
<li>å°½é‡é¿å…åœ¨è¯·æ±‚ä¸­ç›´æ¥å¯åŠ¨goroutineå¤„ç†é—®é¢˜ï¼Œé€šè¿‡å¯åŠ¨workerè¿›è¡Œæ¶ˆè´¹ï¼Œé¿å…ç”±äºè¯·æ±‚é‡å¤§ï¼Œåˆ›å»ºå¤§é‡çš„goroutineå¯¼è‡´OOM<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	_ <span class="string">&quot;net/http/pprof&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setup</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// åˆå§‹åŒ–æ“ä½œ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	setup()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç›‘å¬æœåŠ¡é€€å‡º</span></span><br><span class="line">	done := <span class="built_in">make</span>(<span class="keyword">chan</span> error, <span class="number">2</span>)</span><br><span class="line">	<span class="comment">// æ§åˆ¶æœåŠ¡é€€å‡º</span></span><br><span class="line">	stop := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// for debug</span></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		done &lt;- pprof(stop)</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ä¸»ç¨‹åº</span></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		done &lt;- app(stop)</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> stoped <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">cap</span>(done); i++ &#123;</span><br><span class="line">		<span class="keyword">if</span> err := &lt;-done; err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Printf(<span class="string">&quot;server exit err: %+v&quot;</span>, err)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> !stoped &#123;</span><br><span class="line">			stoped = <span class="literal">true</span></span><br><span class="line">			<span class="built_in">close</span>(stop)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">app</span><span class="params">(stop &lt;-<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	mux := http.NewServeMux()</span><br><span class="line">	mux.HandleFunc(<span class="string">&quot;/ping&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">		w.Write([]<span class="keyword">byte</span>(<span class="string">&quot;pong&quot;</span>))</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> server(mux, <span class="string">&quot;:8080&quot;</span>, stop)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pprof</span><span class="params">(stop &lt;-<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		server(http.DefaultServeMux, <span class="string">&quot;:8081&quot;</span>, stop)</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	time.Sleep(<span class="number">5</span> * time.Second)</span><br><span class="line">	<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;mock pprof exit&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯åŠ¨æœåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">server</span><span class="params">(handler http.Handler, addr <span class="keyword">string</span>, stop &lt;-<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	s := http.Server&#123;</span><br><span class="line">		Handler: handler,</span><br><span class="line">		Addr:    addr,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		&lt;-stop</span><br><span class="line">		log.Printf(<span class="string">&quot;server will exiting, addr: %s&quot;</span>, addr)</span><br><span class="line">		s.Shutdown(context.Background())</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> s.ListenAndServe()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="Channels"><a href="#Channels" class="headerlink" title="Channels"></a>Channels</h2><blockquote>
<p>Synchronization and messaging<br>Channels are typed values that allow goroutines to synchronize and exchange information<br>Channels are first-class values<br>A channel in Go provides a connection between two goroutines, allowing them to communicate</p>
</blockquote>
<ul>
<li><p>æ— ç¼“å†²é€šé“ no-buffer channel</p>
<blockquote>
<p>å‘é€è€…sender å’Œ æ¥æ”¶è€… receiver å¿…é¡»åŒæ—¶å‡†å¤‡å¥½æ‰èƒ½è¿›è¡Œä¸‹å»</p>
</blockquote>
</li>
<li><p>ç¼“å†²é€šé“ buffer channel</p>
<blockquote>
<p>ç¼“å†²é€šé“è§£å†³åŒæ­¥ç­‰å¾…é—®é¢˜</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Declaring and initializing</span></span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Sending on a channel.</span></span><br><span class="line">c &lt;- <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Receiving from a channel</span></span><br><span class="line"><span class="comment">// The &quot;arrow&quot; indicates the direction of data flow.</span></span><br><span class="line">value = &lt;-c</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Select"><a href="#Select" class="headerlink" title="Select"></a>Select</h2><blockquote>
<p>Multi-way concurrent control<br>The select statement is like a switch, but the decision is based on ability to communicate rather than equal values</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Fan-in using select</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fanIn</span><span class="params">(input1, input2 &lt;- <span class="keyword">chan</span> <span class="keyword">string</span>)</span> &lt;- <span class="title">chan</span> <span class="title">string</span></span> &#123;</span><br><span class="line">  c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>)</span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">      <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> s := &lt;-input1: c &lt;- s</span><br><span class="line">        <span class="keyword">case</span> s := &lt;-input2: c &lt;- s</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;()</span><br><span class="line">  <span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Closures"><a href="#Closures" class="headerlink" title="Closures"></a>Closures</h2><h3 id="Demo-Project"><a href="#Demo-Project" class="headerlink" title="Demo Project"></a>Demo Project</h3><blockquote>
<p>Always use the right tool for the job</p>
</blockquote>
<ul>
<li>Google Search: A fake framework<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> google_search_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;math/rand&quot;</span></span><br><span class="line">	<span class="string">&quot;testing&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Result <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	Web    = fakeSearch(<span class="string">&quot;web&quot;</span>)</span><br><span class="line">	Web1   = fakeSearch(<span class="string">&quot;web1&quot;</span>)</span><br><span class="line">	Web2   = fakeSearch(<span class="string">&quot;web2&quot;</span>)</span><br><span class="line">	Image  = fakeSearch(<span class="string">&quot;image&quot;</span>)</span><br><span class="line">	Image1 = fakeSearch(<span class="string">&quot;Image1&quot;</span>)</span><br><span class="line">	Image2 = fakeSearch(<span class="string">&quot;Image2&quot;</span>)</span><br><span class="line">	Video  = fakeSearch(<span class="string">&quot;video&quot;</span>)</span><br><span class="line">	Video1 = fakeSearch(<span class="string">&quot;Video1&quot;</span>)</span><br><span class="line">	Video2 = fakeSearch(<span class="string">&quot;Video2&quot;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Search <span class="function"><span class="keyword">func</span><span class="params">(query <span class="keyword">string</span>)</span> <span class="title">Result</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fakeSearch</span><span class="params">(kind <span class="keyword">string</span>)</span> <span class="title">Search</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(query <span class="keyword">string</span>)</span> <span class="title">Result</span></span> &#123;</span><br><span class="line">		time.Sleep(time.Duration(rand.Intn(<span class="number">100</span>)) * time.Millisecond)</span><br><span class="line">		<span class="keyword">return</span> Result(fmt.Sprintf(<span class="string">&quot;%s result for %q\n&quot;</span>, kind, query))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Google</span><span class="params">(query <span class="keyword">string</span>)</span> <span class="params">(results []Result)</span></span> &#123;</span><br><span class="line">	results = <span class="built_in">append</span>(results, Web(query))</span><br><span class="line">	results = <span class="built_in">append</span>(results, Image(query))</span><br><span class="line">	results = <span class="built_in">append</span>(results, Video(query))</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GoogleV2</span><span class="params">(query <span class="keyword">string</span>)</span> <span class="params">(results []Result)</span></span> &#123;</span><br><span class="line">	<span class="comment">// Run the Web, Image, and Video searches concurrently</span></span><br><span class="line">	c := <span class="built_in">make</span>(<span class="keyword">chan</span> Result)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; c &lt;- Web(query) &#125;()</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; c &lt;- Image(query) &#125;()</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; c &lt;- Video(query) &#125;()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// wait for all results</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ &#123;</span><br><span class="line">		result := &lt;-c</span><br><span class="line">		results = <span class="built_in">append</span>(results, result)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GoogleV21</span><span class="params">(query <span class="keyword">string</span>)</span> <span class="params">(results []Result)</span></span> &#123;</span><br><span class="line">	<span class="comment">// Don;t wait for slow servers. No locks. No condition variables.</span></span><br><span class="line">	c := <span class="built_in">make</span>(<span class="keyword">chan</span> Result)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; c &lt;- Web(query) &#125;()</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; c &lt;- Image(query) &#125;()</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; c &lt;- Video(query) &#125;()</span><br><span class="line"></span><br><span class="line">	timeout := time.After(<span class="number">80</span> * time.Millisecond)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> result := &lt;-c:</span><br><span class="line">			results = <span class="built_in">append</span>(results, result)</span><br><span class="line">		<span class="keyword">case</span> &lt;-timeout:</span><br><span class="line">			fmt.Println(<span class="string">&quot;timed out&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GoogleV3</span><span class="params">(query <span class="keyword">string</span>)</span> <span class="params">(results []Result)</span></span> &#123;</span><br><span class="line">	c := <span class="built_in">make</span>(<span class="keyword">chan</span> Result)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; c &lt;- First(query, Web1, Web2) &#125;()</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; c &lt;- First(query, Image1, Image2) &#125;()</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; c &lt;- First(query, Video1, Video2) &#125;()</span><br><span class="line">	timeout := time.After(<span class="number">80</span> * time.Millisecond)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> result := &lt;-c:</span><br><span class="line">			results = <span class="built_in">append</span>(results, result)</span><br><span class="line">		<span class="keyword">case</span> &lt;-timeout:</span><br><span class="line">			fmt.Println(<span class="string">&quot;timed out&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">First</span><span class="params">(query <span class="keyword">string</span>, replicas ...Search)</span> <span class="title">Result</span></span> &#123;</span><br><span class="line">	c := <span class="built_in">make</span>(<span class="keyword">chan</span> Result)</span><br><span class="line">	searchReplica := <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123; c &lt;- replicas[i](query) &#125;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> replicas &#123;</span><br><span class="line">		<span class="keyword">go</span> searchReplica(i)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> &lt;-c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGoogle</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	rand.Seed(time.Now().UnixNano())</span><br><span class="line">	start := time.Now()</span><br><span class="line">	results := Google(<span class="string">&quot;golang&quot;</span>)</span><br><span class="line">	elapsed := time.Since(start)</span><br><span class="line">	fmt.Println(results)</span><br><span class="line">	fmt.Println(elapsed)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGoogleV2</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	rand.Seed(time.Now().UnixNano())</span><br><span class="line">	start := time.Now()</span><br><span class="line">	results := GoogleV2(<span class="string">&quot;golang&quot;</span>)</span><br><span class="line">	elapsed := time.Since(start)</span><br><span class="line">	fmt.Println(results)</span><br><span class="line">	fmt.Println(elapsed)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGoogleV21</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	rand.Seed(time.Now().UnixNano())</span><br><span class="line">	start := time.Now()</span><br><span class="line">	results := GoogleV21(<span class="string">&quot;golang&quot;</span>)</span><br><span class="line">	elapsed := time.Since(start)</span><br><span class="line">	fmt.Println(results)</span><br><span class="line">	fmt.Println(elapsed)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGoogleV3</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	rand.Seed(time.Now().UnixNano())</span><br><span class="line">	start := time.Now()</span><br><span class="line">	results := GoogleV3(<span class="string">&quot;golang&quot;</span>)</span><br><span class="line">	elapsed := time.Since(start)</span><br><span class="line">	fmt.Println(results)</span><br><span class="line">	fmt.Println(elapsed)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ go test -v google_search_test.go</span></span><br><span class="line"><span class="comment">// === RUN   TestGoogle</span></span><br><span class="line"><span class="comment">// [web result for &quot;golang&quot;</span></span><br><span class="line"><span class="comment">//  image result for &quot;golang&quot;</span></span><br><span class="line"><span class="comment">//  video result for &quot;golang&quot;</span></span><br><span class="line"><span class="comment">// ]</span></span><br><span class="line"><span class="comment">// 31.882269ms</span></span><br><span class="line"><span class="comment">// --- PASS: TestGoogle (0.03s)</span></span><br><span class="line"><span class="comment">// === RUN   TestGoogleV2</span></span><br><span class="line"><span class="comment">// [web result for &quot;golang&quot;</span></span><br><span class="line"><span class="comment">//  image result for &quot;golang&quot;</span></span><br><span class="line"><span class="comment">//  video result for &quot;golang&quot;</span></span><br><span class="line"><span class="comment">// ]</span></span><br><span class="line"><span class="comment">// 49.036197ms</span></span><br><span class="line"><span class="comment">// --- PASS: TestGoogleV2 (0.05s)</span></span><br><span class="line"><span class="comment">// === RUN   TestGoogleV21</span></span><br><span class="line"><span class="comment">// [web result for &quot;golang&quot;</span></span><br><span class="line"><span class="comment">//  video result for &quot;golang&quot;</span></span><br><span class="line"><span class="comment">//  image result for &quot;golang&quot;</span></span><br><span class="line"><span class="comment">// ]</span></span><br><span class="line"><span class="comment">// 53.507162ms</span></span><br><span class="line"><span class="comment">// --- PASS: TestGoogleV21 (0.05s)</span></span><br><span class="line"><span class="comment">// === RUN   TestGoogleV3</span></span><br><span class="line"><span class="comment">// [Video2 result for &quot;golang&quot;</span></span><br><span class="line"><span class="comment">//  web1 result for &quot;golang&quot;</span></span><br><span class="line"><span class="comment">//  Image1 result for &quot;golang&quot;</span></span><br><span class="line"><span class="comment">// ]</span></span><br><span class="line"><span class="comment">// 41.612001ms</span></span><br><span class="line"><span class="comment">// --- PASS: TestGoogleV3 (0.04s)</span></span><br><span class="line"><span class="comment">// PASS</span></span><br><span class="line"><span class="comment">// ok  	command-line-arguments	0.301s</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Best-Practice-Writing-Go-Code-æœ€ä½³å®è·µ"><a href="#Best-Practice-Writing-Go-Code-æœ€ä½³å®è·µ" class="headerlink" title="Best Practice Writing Go Code: æœ€ä½³å®è·µ"></a>Best Practice Writing Go Code: æœ€ä½³å®è·µ</h2><ul>
<li>software programming è½¯ä»¶ç¼–ç¨‹</li>
<li>software engineering è½¯ä»¶å·¥ç¨‹</li>
</ul>
<h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ul>
<li><a href="https://dave.cheney.net/practical-go/presentations/qcon-china.html">Practical Go: Real world advice for writing maintainable Go Programs</a></li>
</ul>
]]></content>
      <tags>
        <tag>Golang</tag>
        <tag>sync</tag>
      </tags>
  </entry>
  <entry>
    <title>Ansible Intro</title>
    <url>/2021/09/11/Ansible-Intro/</url>
    <content><![CDATA[<h1 id="Ansible"><a href="#Ansible" class="headerlink" title="Ansible"></a>Ansible</h1><blockquote>
<p>Tool to automate IT tasks.</p>
</blockquote>
<ul>
<li>SIMPLE<ul>
<li>Human readable automation</li>
<li>No special coding skills needed</li>
<li>Tasks executed in order</li>
</ul>
</li>
<li>POWERFUL<ul>
<li>App deployment</li>
<li>Configuration management</li>
<li>Workflow orchestration</li>
</ul>
</li>
<li>AGENTLESS<ul>
<li>Agentless architecture</li>
<li>Use OpenSSH &amp; WinRM</li>
</ul>
</li>
</ul>
<h2 id="What-Can-I-Use-Ansible-To-Do"><a href="#What-Can-I-Use-Ansible-To-Do" class="headerlink" title="What Can I Use Ansible To Do?"></a>What Can I Use Ansible To Do?</h2><ul>
<li>Config Management</li>
<li>App deployment</li>
<li>Provisioning</li>
<li>Continuous delivery</li>
<li>Security &amp; Compliance</li>
<li>orchestration</li>
</ul>
<h2 id="Ansible-Architecture"><a href="#Ansible-Architecture" class="headerlink" title="Ansible Architecture"></a>Ansible Architecture</h2><p><img src="/misc/images/ansible-architecture.png" alt="ansible architecture"></p>
<ul>
<li>MODULES:</li>
</ul>
<h2 id="Quick-Start-Ansible"><a href="#Quick-Start-Ansible" class="headerlink" title="Quick Start Ansible"></a>Quick Start Ansible</h2><ul>
<li>Installing an Ansible<figure class="highlight dsconfig"><table><tr><td class="code"><pre><span class="line">$ <span class="string">curl</span> <span class="string">https</span>://<span class="string">bootstrap</span>.<span class="string">pypa</span>.<span class="string">io</span>/<span class="built_in">get-pip.py</span> -<span class="string">o</span> <span class="built_in">get-pip.py</span></span><br><span class="line">$ <span class="string">python</span> <span class="built_in">get-pip.py</span> <span class="built_in">--user</span></span><br><span class="line">$ <span class="string">python</span> -<span class="string">m</span> <span class="string">pip</span> <span class="string">install</span> <span class="built_in">--user</span> <span class="string">ansible</span></span><br><span class="line"></span><br><span class="line">âœ <span class="string">ansible</span> <span class="built_in">--version</span></span><br><span class="line"><span class="string">ansible</span> [<span class="string">core</span> <span class="string">2</span>.<span class="string">11</span>.<span class="string">4</span>]</span><br><span class="line">  <span class="string">config</span> <span class="string">file</span> = <span class="string">None</span></span><br><span class="line">  <span class="string">configured</span> <span class="string">module</span> <span class="string">search</span> <span class="string">path</span> = [<span class="string">&#x27;/Users/chyiyaqing/.ansible/plugins/modules&#x27;</span>, <span class="string">&#x27;/usr/share/ansible/plugins/modules&#x27;</span>]</span><br><span class="line">  <span class="string">ansible</span> <span class="string">python</span> <span class="string">module</span> <span class="string">location</span> = /<span class="string">usr</span>/<span class="string">local</span>/<span class="string">lib</span>/<span class="string">python3</span>.<span class="string">9</span>/<span class="string">site-packages</span>/<span class="string">ansible</span></span><br><span class="line">  <span class="string">ansible</span> <span class="string">collection</span> <span class="string">location</span> = /<span class="string">Users</span>/<span class="string">chyiyaqing</span>/.<span class="string">ansible</span>/<span class="string">collections</span>:/<span class="string">usr</span>/<span class="string">share</span>/<span class="string">ansible</span>/<span class="string">collections</span></span><br><span class="line">  <span class="string">executable</span> <span class="string">location</span> = /<span class="string">usr</span>/<span class="string">local</span>/<span class="string">bin</span>/<span class="string">ansible</span></span><br><span class="line">  <span class="string">python</span> <span class="string">version</span> = <span class="string">3</span>.<span class="string">9</span>.<span class="string">6</span> (<span class="string">default</span>, <span class="string">Jun</span> <span class="string">29</span> <span class="string">2021</span>, <span class="string">05:25:</span><span class="string">02</span>) [<span class="string">Clang</span> <span class="string">12</span>.<span class="string">0</span>.<span class="string">5</span> (<span class="string">clang-1205</span>.<span class="string">0</span>.<span class="string">22</span>.<span class="string">9</span>)]</span><br><span class="line">  <span class="string">jinja</span> <span class="string">version</span> = <span class="string">2</span>.<span class="string">10</span>.<span class="string">1</span></span><br><span class="line">  <span class="string">libyaml</span> = <span class="string">True</span></span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>Go CLI Intro</title>
    <url>/2021/09/11/Go-CLI-Intro/</url>
    <content><![CDATA[<h2 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h2><blockquote>
<p>å‘½ä»¤è¡Œflagè§£æ</p>
</blockquote>
<ul>
<li><p>flag é•¿çŸ­é€‰é¡¹</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">	var name string</span><br><span class="line"></span><br><span class="line">  <span class="regexp">//</span> -flag: ä»…æ”¯æŒå¸ƒå°”ç±»å‹</span><br><span class="line">  <span class="regexp">//</span> -flag x: ä»…æ”¯æŒéå¸ƒå°”ç±»å‹</span><br><span class="line">  <span class="regexp">//</span> -flag=x: å‡æ”¯æŒ</span><br><span class="line">  <span class="regexp">//</span> é•¿çŸ­é€‰é¡¹ åˆ†å¼€ä¸¤æ¬¡è°ƒç”¨</span><br><span class="line">	flag.StringVar(&amp;name, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;Golang flag tour&quot;</span>, <span class="string">&quot;help&quot;</span>)</span><br><span class="line">	flag.StringVar(&amp;name, <span class="string">&quot;n&quot;</span>, <span class="string">&quot;Golang flag tour&quot;</span>, <span class="string">&quot;help&quot;</span>)</span><br><span class="line">	flag.Parse()</span><br><span class="line"></span><br><span class="line">	log.Printf(<span class="string">&quot;name: %s&quot;</span>, name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> âœ go run flag/demo.go -name=<span class="string">&#x27;hello world&#x27;</span> -n <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"><span class="regexp">//</span> <span class="number">2021</span><span class="regexp">/09/</span><span class="number">11</span> <span class="number">18</span>:<span class="number">26</span>:<span class="number">39</span> name: hello world</span><br></pre></td></tr></table></figure></li>
<li><p>flag å­å‘½ä»¤</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">	var name string</span><br><span class="line"></span><br><span class="line">	flag.Parse()</span><br><span class="line">	args := flag.Args()</span><br><span class="line">	<span class="keyword">if</span> len(args) &lt;= <span class="number">0</span> &#123;</span><br><span class="line">		return</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	switch args[<span class="number">0</span>] &#123;</span><br><span class="line">	case <span class="string">&quot;go&quot;</span>:</span><br><span class="line">		goCmd := flag.NewFlagSet(<span class="string">&quot;go&quot;</span>, flag.ExitOnError)</span><br><span class="line">		goCmd.StringVar(&amp;name, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;Golang language&quot;</span>, <span class="string">&quot;help&quot;</span>)</span><br><span class="line">		_ = goCmd.Parse(args[<span class="number">1</span>:])</span><br><span class="line">	case <span class="string">&quot;py&quot;</span>:</span><br><span class="line">		pyCmd := flag.NewFlagSet(<span class="string">&quot;py&quot;</span>, flag.ExitOnError)</span><br><span class="line">		pyCmd.StringVar(&amp;name, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;Python language&quot;</span>, <span class="string">&quot;help&quot;</span>)</span><br><span class="line">		_ = pyCmd.Parse(args[<span class="number">1</span>:])</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	log.Printf(<span class="string">&quot;name: %s&quot;</span>, name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> âœ go run flag/flag_sub_cli.go go -name=golang</span><br><span class="line"><span class="regexp">//</span> <span class="number">2021</span><span class="regexp">/09/</span><span class="number">11</span> <span class="number">18</span>:<span class="number">39</span>:<span class="number">47</span> name: golang</span><br><span class="line"><span class="regexp">//</span></span><br><span class="line"><span class="regexp">//</span> âœ go run flag/flag_sub_cli.go go -n=python</span><br><span class="line"><span class="regexp">//</span> flag provided but not defined: -n</span><br><span class="line"><span class="regexp">//</span> Usage of go:</span><br><span class="line"><span class="regexp">//</span>   -name string</span><br><span class="line"><span class="regexp">//</span>     	help (default <span class="string">&quot;Golang language&quot;</span>)</span><br><span class="line"><span class="regexp">//</span> <span class="keyword">exit</span> status <span class="number">2</span></span><br></pre></td></tr></table></figure></li>
<li><p>flag æºç åˆ†æ</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"># flag.Parse</span><br><span class="line"></span><br><span class="line"><span class="comment">// CommandLine is the default set of command-line flags, parsed from os.Args.</span></span><br><span class="line"><span class="comment">// The top-level functions such as BoolVar, Arg, and so on are wrappers for the</span></span><br><span class="line"><span class="comment">// methods of CommandLine.</span></span><br><span class="line"><span class="keyword">var</span> CommandLine = NewFlagSet(os.Args[<span class="number">0</span>], ExitOnError)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Parse parses the command-line flags from os.Args[1:]. Must be called</span></span><br><span class="line"><span class="comment">// after all flags are defined and before flags are accessed by the program.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Parse</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// Ignore errors; CommandLine is set for ExitOnError.</span></span><br><span class="line">	CommandLine.Parse(os.Args[<span class="number">1</span>:])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># FlagSet.Parse</span><br><span class="line">&gt; parseå¼‚å¸¸åˆ†æµå¤„ç†</span><br><span class="line"><span class="comment">// Parse parses flag definitions from the argument list, which should not</span></span><br><span class="line"><span class="comment">// include the command name. Must be called after all flags in the FlagSet</span></span><br><span class="line"><span class="comment">// are defined and before flags are accessed by the program.</span></span><br><span class="line"><span class="comment">// The return value will be ErrHelp if -help or -h were set but not defined.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *FlagSet)</span> <span class="title">Parse</span><span class="params">(arguments []<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	f.parsed = <span class="literal">true</span></span><br><span class="line">	f.args = arguments</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		seen, err := f.parseOne()</span><br><span class="line">		<span class="keyword">if</span> seen &#123;</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">switch</span> f.errorHandling &#123;</span><br><span class="line">		<span class="keyword">case</span> ContinueOnError:</span><br><span class="line">			<span class="keyword">return</span> err</span><br><span class="line">		<span class="keyword">case</span> ExitOnError:</span><br><span class="line">			<span class="keyword">if</span> err == ErrHelp &#123;</span><br><span class="line">				os.Exit(<span class="number">0</span>)</span><br><span class="line">			&#125;</span><br><span class="line">			os.Exit(<span class="number">2</span>)</span><br><span class="line">		<span class="keyword">case</span> PanicOnError:</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># FlagSet.parseOne</span><br><span class="line"><span class="comment">// parseOne parses one flag. It reports whether a flag was seen.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *FlagSet)</span> <span class="title">parseOne</span><span class="params">()</span> <span class="params">(<span class="keyword">bool</span>, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(f.args) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>, <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">	s := f.args[<span class="number">0</span>]</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(s) &lt; <span class="number">2</span> || s[<span class="number">0</span>] != <span class="string">&#x27;-&#x27;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>, <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">	numMinuses := <span class="number">1</span></span><br><span class="line">	<span class="keyword">if</span> s[<span class="number">1</span>] == <span class="string">&#x27;-&#x27;</span> &#123;</span><br><span class="line">		numMinuses++</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(s) == <span class="number">2</span> &#123; <span class="comment">// &quot;--&quot; terminates the flags</span></span><br><span class="line">			f.args = f.args[<span class="number">1</span>:]</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>, <span class="literal">nil</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	name := s[numMinuses:]</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(name) == <span class="number">0</span> || name[<span class="number">0</span>] == <span class="string">&#x27;-&#x27;</span> || name[<span class="number">0</span>] == <span class="string">&#x27;=&#x27;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>, f.failf(<span class="string">&quot;bad flag syntax: %s&quot;</span>, s)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// it&#x27;s a flag. does it have an argument?</span></span><br><span class="line">	f.args = f.args[<span class="number">1</span>:]</span><br><span class="line">	hasValue := <span class="literal">false</span></span><br><span class="line">	value := <span class="string">&quot;&quot;</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(name); i++ &#123; <span class="comment">// equals cannot be first</span></span><br><span class="line">		<span class="keyword">if</span> name[i] == <span class="string">&#x27;=&#x27;</span> &#123;</span><br><span class="line">			value = name[i+<span class="number">1</span>:]</span><br><span class="line">			hasValue = <span class="literal">true</span></span><br><span class="line">			name = name[<span class="number">0</span>:i]</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	m := f.formal</span><br><span class="line">	flag, alreadythere := m[name] <span class="comment">// BUG</span></span><br><span class="line">	<span class="keyword">if</span> !alreadythere &#123;</span><br><span class="line">		<span class="keyword">if</span> name == <span class="string">&quot;help&quot;</span> || name == <span class="string">&quot;h&quot;</span> &#123; <span class="comment">// special case for nice help message.</span></span><br><span class="line">			f.usage()</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>, ErrHelp</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>, f.failf(<span class="string">&quot;flag provided but not defined: -%s&quot;</span>, name)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> fv, ok := flag.Value.(boolFlag); ok &amp;&amp; fv.IsBoolFlag() &#123; <span class="comment">// special case: doesn&#x27;t need an arg</span></span><br><span class="line">		<span class="keyword">if</span> hasValue &#123;</span><br><span class="line">			<span class="keyword">if</span> err := fv.Set(value); err != <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>, f.failf(<span class="string">&quot;invalid boolean value %q for -%s: %v&quot;</span>, value, name, err)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> err := fv.Set(<span class="string">&quot;true&quot;</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>, f.failf(<span class="string">&quot;invalid boolean flag %s: %v&quot;</span>, name, err)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">// It must have a value, which might be the next argument.</span></span><br><span class="line">		<span class="keyword">if</span> !hasValue &amp;&amp; <span class="built_in">len</span>(f.args) &gt; <span class="number">0</span> &#123;</span><br><span class="line">			<span class="comment">// value is the next arg</span></span><br><span class="line">			hasValue = <span class="literal">true</span></span><br><span class="line">			value, f.args = f.args[<span class="number">0</span>], f.args[<span class="number">1</span>:]</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> !hasValue &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>, f.failf(<span class="string">&quot;flag needs an argument: -%s&quot;</span>, name)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> err := flag.Value.Set(value); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>, f.failf(<span class="string">&quot;invalid value %q for flag -%s: %v&quot;</span>, value, name, err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> f.actual == <span class="literal">nil</span> &#123;</span><br><span class="line">		f.actual = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]*Flag)</span><br><span class="line">	&#125;</span><br><span class="line">	f.actual[name] = flag</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Cobra"><a href="#Cobra" class="headerlink" title="Cobra"></a>Cobra</h2>]]></content>
      <tags>
        <tag>CLI</tag>
      </tags>
  </entry>
  <entry>
    <title>Go Constants</title>
    <url>/2021/09/12/Go-Constants/</url>
    <content><![CDATA[<h1 id="Constants-å¸¸é‡"><a href="#Constants-å¸¸é‡" class="headerlink" title="Constants å¸¸é‡"></a>Constants å¸¸é‡</h1><blockquote>
<p>Goæ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œä¸å…è®¸åŒæ­¥ç±»å‹çš„æ•°å€¼ç±»å‹è¿›è¡Œè®¡ç®—. ä¸å…è®¸float64 + int ç”šè‡³ int32 + int. å¦‚æœä½ å¸Œæœ›ä¸åŒç±»å‹è¿›è¡Œè®¡ç®—éœ€è¦æ˜¾å¼è½¬æ¢ååœ¨è¿›è¡Œ int(float64) + int.</p>
</blockquote>
<span id="more"></span>

<h2 id="å­—ç¬¦ä¸²å¸¸é‡"><a href="#å­—ç¬¦ä¸²å¸¸é‡" class="headerlink" title="å­—ç¬¦ä¸²å¸¸é‡"></a>å­—ç¬¦ä¸²å¸¸é‡</h2><blockquote>
<p>å­—ç¬¦ä¸²å¸¸é‡ä½¿ç”¨åŒå¼•å·(Goå¯ä»¥ä½¿ç”¨<code>raw string</code>)<br>  <figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># hello æ˜¯ä¸€ä¸ªæ— ç±»å‹çš„å­—ç¬¦ä¸²å¸¸é‡, èµ‹å€¼ç»™æœ‰ç±»å‹çš„å˜é‡ä¸ä¼šå¼•èµ·ç±»å‹é”™è¯¯.</span></span><br><span class="line"><span class="keyword">const</span> hello = <span class="string">&quot;Hello, ä¸–ç•Œ&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># helloæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡</span></span><br><span class="line"><span class="keyword">const</span> typedHello <span class="keyword">string</span> = <span class="string">&quot;Hello, ä¸–ç•Œ&quot;</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="é»˜è®¤ç±»å‹"><a href="#é»˜è®¤ç±»å‹" class="headerlink" title="é»˜è®¤ç±»å‹"></a>é»˜è®¤ç±»å‹</h2>  <figure class="highlight hsp"><table><tr><td class="code"><pre><span class="line"><span class="meta"># str := <span class="meta-string">&quot;Hello, ä¸–ç•Œ&quot;</span></span></span><br><span class="line">å¯èƒ½ä¼šæœ‰ç–‘æƒ‘ï¼Œå¦‚æœå¸¸é‡æ˜¯æ²¡æœ‰ç±»å‹çš„ï¼Œ<span class="keyword">str</span>å˜é‡å¦‚ä½•è·å–åˆ°ç±»å‹? ç­”æ¡ˆå°±æ˜¯æ— ç±»å‹çš„å¸¸é‡æœ‰ä¸€ä¸ªé»˜è®¤ç±»å‹ï¼Œå¦‚æœå˜é‡<span class="keyword">str</span>æ²¡æœ‰å£°æ˜ç±»å‹ä¼šä½¿ç”¨å³è¾¹è¡¨è¾¾å¼ä¸­çš„é»˜è®¤ç±»å‹.</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>å¸¸é‡</tag>
      </tags>
  </entry>
  <entry>
    <title>Go PProf Intro</title>
    <url>/2021/09/13/Go-PProf-Intro/</url>
    <content><![CDATA[<h1 id="Go-Profling-å‰–æ"><a href="#Go-Profling-å‰–æ" class="headerlink" title="Go Profling - å‰–æ"></a>Go Profling - å‰–æ</h1><blockquote>
<p>Using â€œpprofâ€ to profiling your program<br>Goè¯­è¨€å¯è§†åŒ–æ€§èƒ½åˆ†æå·¥å…·,PProfä»¥profile.protoè¯»å–åˆ†ææ ·æœ¬é›†åˆï¼Œå¹¶ç”ŸæˆæŠ¥å‘Šå¯è§†åŒ–å¸®åŠ©åˆ†ææ•°æ®(æ”¯æŒæ–‡æœ¬å’Œå›¾å½¢æŠ¥å‘Š)</p>
</blockquote>
<ul>
<li><p>ä½¿ç”¨åœºæ™¯</p>
<ul>
<li>runtime/pprof: é‡‡é›†ç¨‹åºæŒ‡å®šåŒºå—çš„è¿è¡Œæ•°æ®åˆ†æ</li>
<li>net/http/pprof: åŸºäºHTTP Serverè¿è¡Œ,é‡‡é›†è¿è¡Œæ—¶æ•°æ®åˆ†æ</li>
<li>go test: é€šè¿‡è¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼ŒæŒ‡å®šæ‰€éœ€æ ‡è¯†è¿›è¡Œé‡‡æ ·</li>
</ul>
</li>
<li><p>å®‰è£…å¯è§†åŒ–å·¥å…·graphvizæŸ¥çœ‹profile</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># Mac: $ brew install graphviz</span></span><br><span class="line"><span class="meta"># Linux: $ sudo apt install graphviz</span></span><br></pre></td></tr></table></figure></li>
<li><p>æ”¯æŒæ¨¡å¼</p>
<ul>
<li>æŠ¥å‘Šç”Ÿæˆ Report generation</li>
<li>äº¤äº’ç»ˆç«¯ä½¿ç”¨ Interactive terminal use</li>
<li>Webé¡µé¢ Web interface</li>
</ul>
</li>
<li><p>å¯ä»¥åšé‚£äº›</p>
<ul>
<li>CPU Profiling: CPUåˆ†æ<ul>
<li>æŒ‰ç…§ä¸€å®šé¢‘ç‡é‡‡é›†ç›‘å¬åº”ç”¨ç¨‹åºCPUä½¿ç”¨æƒ…å†µï¼Œç¡®å®šåº”ç”¨ç¨‹åºçš„ä¸»åŠ¨æ¶ˆè€—CPUå‘¨æœŸæ—¶èŠ±è´¹æ—¶é—´çš„ä½ç½®</li>
</ul>
</li>
<li>Memory Profiling: å†…å­˜åˆ†æ<ul>
<li>ç¨‹åºè¿›è¡Œå †åˆ†é…æ—¶è®°å½•å †æ ˆè·Ÿè¸ªï¼Œç›‘è§†å½“å‰å’Œå†å²å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œæ£€æŸ¥å†…å­˜æ³„æ¼</li>
</ul>
</li>
<li>Block Profiling: é˜»å¡åˆ†æ<ul>
<li>è®°å½•Goroutineé˜»å¡ç­‰å¾…åŒæ­¥çš„ä½ç½®ï¼Œé»˜è®¤ä¸å¼€å¯ï¼Œéœ€è¦è°ƒç”¨runtime.SetBlockProfileRate è®¾ç½®</li>
</ul>
</li>
<li>Mutex Profiling: äº’æ–¥é”åˆ†æ<ul>
<li>æŠ¥å‘Šäº’æ–¥é”çš„ç«äº‰æƒ…å†µ, é»˜è®¤ä¸å¼€å¯, runtime.SetMutexProfileFraction è®¾ç½®</li>
</ul>
</li>
<li>Goroutine Profiling: Goroutineåˆ†æ<ul>
<li>å¯¹å½“å‰åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œçš„Goroutineè¿›è¡Œå †æ ˆè·Ÿè¸ªå’Œåˆ†æ</li>
</ul>
</li>
</ul>
</li>
</ul>
<span id="more"></span>

<h2 id="How-to-Use"><a href="#How-to-Use" class="headerlink" title="How to Use"></a>How to Use</h2><ul>
<li>runtime/pprof<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="comment"># pprof useful command:</span></span><br><span class="line">  <span class="built_in">text</span>: show <span class="keyword">the</span> cpu report <span class="keyword">in</span> <span class="built_in">text</span> form</span><br><span class="line">  web: visualize graph <span class="keyword">through</span> web browser</span><br><span class="line">  top &lt;n&gt;: <span class="built_in">list</span> <span class="keyword">the</span> n highest entries <span class="keyword">in</span> <span class="built_in">text</span> form</span><br><span class="line">  <span class="built_in">list</span> &lt;function <span class="built_in">name</span>&gt;: reveal <span class="keyword">the</span> <span class="built_in">running</span> <span class="built_in">time</span> <span class="keyword">of</span> function</span><br><span class="line">  traces</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	_ <span class="string">&quot;net/http/pprof&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">var datas []string</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">	go <span class="keyword">func</span>() &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			log.Printf(<span class="string">&quot;len: %d&quot;</span>, Add(<span class="string">&quot;go-programming-tour-book&quot;</span>))</span><br><span class="line">			time.Sleep(time.Millisecond * <span class="number">10</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	_ = http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, nil)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> Add(str string) int &#123;</span><br><span class="line">	data := []byte(str)</span><br><span class="line">	datas = append(datas, string(data))</span><br><span class="line">	return len(datas)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> è®¿é—® http:<span class="regexp">//</span>localhost:<span class="number">8080</span><span class="regexp">/debug/</span>pprof</span><br><span class="line"><span class="regexp">//</span> <span class="regexp">/debug/</span>pprof/</span><br><span class="line"><span class="regexp">//</span></span><br><span class="line"><span class="regexp">//</span> Types of profiles available:</span><br><span class="line"><span class="regexp">//</span> Count	Profile</span><br><span class="line"><span class="regexp">//</span> <span class="number">3</span>	allocs                -- æŸ¥çœ‹è¿‡å»å†…å­˜åˆ†é…æ ·æœ¬</span><br><span class="line"><span class="regexp">//</span> <span class="number">0</span>	block                 -- æŸ¥çœ‹é˜»å¡</span><br><span class="line"><span class="regexp">//</span> <span class="number">0</span>	cmdline               -- å‘½ä»¤è¡Œè°ƒç”¨è·¯å¾„</span><br><span class="line"><span class="regexp">//</span> <span class="number">5</span>	goroutine             -- goroutineå †æ ˆè·Ÿè¸ª</span><br><span class="line"><span class="regexp">//</span> <span class="number">3</span>	heap                  -- å †ä¸Šå†…å­˜åˆ†é…</span><br><span class="line"><span class="regexp">//</span> <span class="number">0</span>	mutex                 -- äº’æ–¥é”ç«äº‰æŒæœ‰è€…å †æ ˆè·Ÿè¸ª</span><br><span class="line"><span class="regexp">//</span> <span class="number">0</span>	profile               -- é»˜è®¤<span class="number">30</span>ç§’CPU Profiling</span><br><span class="line"><span class="regexp">//</span> <span class="number">7</span>	threadcreate          --</span><br><span class="line"><span class="regexp">//</span> <span class="number">0</span>	trace</span><br><span class="line"><span class="regexp">//</span> full goroutine stack dump</span><br></pre></td></tr></table></figure>

<ul>
<li><p>CPU Profiling</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">âœ <span class="keyword">go</span> tool pprof http://localhos<span class="variable">t:8080</span>/<span class="keyword">debug</span>/pprof/<span class="keyword">profile</span>\?seconds\=<span class="number">5</span></span><br><span class="line">Fetching <span class="keyword">profile</span> over HTTP from http://localhos<span class="variable">t:8080</span>/<span class="keyword">debug</span>/pprof/<span class="keyword">profile</span>?seconds=<span class="number">5</span></span><br><span class="line">Saved <span class="keyword">profile</span> in /Users/chyiyaqing/pprof/pprof.samples.cpu.<span class="number">001</span>.pb.gz</span><br><span class="line">Type: cpu</span><br><span class="line">Time: Sep <span class="number">13</span>, <span class="number">2021</span> at <span class="number">5</span>:<span class="number">22</span>pm (CST)</span><br><span class="line">Duration: <span class="number">5</span>s, Total samples = <span class="number">20</span>ms (  <span class="number">0.4</span>%)</span><br><span class="line">Entering interactive <span class="keyword">mode</span> (<span class="built_in">type</span> <span class="string">&quot;help&quot;</span> <span class="keyword">for</span> commands, <span class="string">&quot;o&quot;</span> <span class="keyword">for</span> <span class="keyword">options</span>)</span><br><span class="line">(pprof) top10</span><br><span class="line">Showing nodes accounting <span class="keyword">for</span> <span class="number">20</span>ms, <span class="number">100</span>% of <span class="number">20</span>ms total</span><br><span class="line">Showing top <span class="number">10</span> nodes out of <span class="number">11</span></span><br><span class="line">      flat  flat%   sum%        cum   cum%</span><br><span class="line">      <span class="number">10</span>ms <span class="number">50.00</span>% <span class="number">50.00</span>%       <span class="number">10</span>ms <span class="number">50.00</span>%  <span class="keyword">runtime</span>.kevent</span><br><span class="line">      <span class="number">10</span>ms <span class="number">50.00</span>%   <span class="number">100</span>%       <span class="number">10</span>ms <span class="number">50.00</span>%  <span class="keyword">runtime</span>.pthread_cond_wait</span><br><span class="line">         <span class="number">0</span>     <span class="number">0</span>%   <span class="number">100</span>%       <span class="number">20</span>ms   <span class="number">100</span>%  <span class="keyword">runtime</span>.findrunnable</span><br><span class="line">         <span class="number">0</span>     <span class="number">0</span>%   <span class="number">100</span>%       <span class="number">10</span>ms <span class="number">50.00</span>%  <span class="keyword">runtime</span>.mPark</span><br><span class="line">         <span class="number">0</span>     <span class="number">0</span>%   <span class="number">100</span>%       <span class="number">20</span>ms   <span class="number">100</span>%  <span class="keyword">runtime</span>.mcall</span><br><span class="line">         <span class="number">0</span>     <span class="number">0</span>%   <span class="number">100</span>%       <span class="number">10</span>ms <span class="number">50.00</span>%  <span class="keyword">runtime</span>.netpoll</span><br><span class="line">         <span class="number">0</span>     <span class="number">0</span>%   <span class="number">100</span>%       <span class="number">10</span>ms <span class="number">50.00</span>%  <span class="keyword">runtime</span>.notesleep</span><br><span class="line">         <span class="number">0</span>     <span class="number">0</span>%   <span class="number">100</span>%       <span class="number">20</span>ms   <span class="number">100</span>%  <span class="keyword">runtime</span>.park_m</span><br><span class="line">         <span class="number">0</span>     <span class="number">0</span>%   <span class="number">100</span>%       <span class="number">20</span>ms   <span class="number">100</span>%  <span class="keyword">runtime</span>.schedule</span><br><span class="line">         <span class="number">0</span>     <span class="number">0</span>%   <span class="number">100</span>%       <span class="number">10</span>ms <span class="number">50.00</span>%  <span class="keyword">runtime</span>.semasleep</span><br><span class="line"></span><br><span class="line">fla<span class="variable">t:</span> å‡½æ•°è‡ªèº«è¿è¡Œè€—æ—¶</span><br><span class="line">flat%: å‡½æ•°è‡ªèº«åœ¨CPUè¿è¡Œè€—æ—¶æ€»æ¯”ä¾‹</span><br><span class="line">sum%: å‡½æ•°è‡ªèº«ç´¯è®¡ä½¿ç”¨CPUæ¯”ä¾‹</span><br><span class="line">cum%: å‡½æ•°è‡ªèº«åŠå…¶è°ƒç”¨å‡½æ•°è¿è¡Œæ€»è€—æ—¶</span><br><span class="line">cum%: å‡½æ•°è‡ªèº«åŠå…¶è°ƒç”¨å‡½æ•°çš„è¿è¡Œè€—æ—¶æ€»æ¯”ä¾‹</span><br><span class="line">Name: å‡½æ•°å</span><br></pre></td></tr></table></figure></li>
<li><p>Heap Profiling</p>
<ul>
<li>inuse_space: åˆ†æå¸¸é©»å†…å­˜å ç”¨<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">âœ go tool pprof -inuse_space http:<span class="comment">//localhost:8080/debug/pprof/heap</span></span><br><span class="line">Fetching profile over HTTP <span class="keyword">from</span> http:<span class="comment">//localhost:8080/debug/pprof/heap</span></span><br><span class="line">Saved profile in <span class="regexp">/Users/</span>chyiyaqing<span class="regexp">/pprof/</span>pprof.alloc_objects.alloc_space.inuse_objects.inuse_space.<span class="number">002</span>.pb.gz</span><br><span class="line">Type: inuse_space</span><br><span class="line">Time: Sep <span class="number">13</span>, <span class="number">2021</span> at <span class="number">5</span>:<span class="number">30</span>pm (CST)</span><br><span class="line">Entering interactive mode (type <span class="string">&quot;help&quot;</span> <span class="keyword">for</span> commands, <span class="string">&quot;o&quot;</span> <span class="keyword">for</span> <span class="keyword">options</span>)</span><br><span class="line">(pprof) top</span><br><span class="line">Showing nodes accounting <span class="keyword">for</span> <span class="number">6951.53</span>kB, <span class="number">100</span>% of <span class="number">6951.53</span>kB total</span><br><span class="line">Showing top <span class="number">10</span> nodes out of <span class="number">18</span></span><br><span class="line">      flat  flat%   sum%        cum   cum%</span><br><span class="line"> <span class="number">4898.20</span>kB <span class="number">70.46</span>% <span class="number">70.46</span>%  <span class="number">4898.20</span>kB <span class="number">70.46</span>%  main.Add (inline)</span><br><span class="line"> <span class="number">1025.12</span>kB <span class="number">14.75</span>% <span class="number">85.21</span>%  <span class="number">1025.12</span>kB <span class="number">14.75</span>%  <span class="keyword">runtime</span>.allocm</span><br><span class="line">  <span class="number">516.01</span>kB  <span class="number">7.42</span>% <span class="number">92.63</span>%   <span class="number">516.01</span>kB  <span class="number">7.42</span>%  unicode.init</span><br><span class="line">  <span class="number">512.20</span>kB  <span class="number">7.37</span>%   <span class="number">100</span>%   <span class="number">512.20</span>kB  <span class="number">7.37</span>%  <span class="keyword">runtime</span>.malg</span><br><span class="line">         <span class="number">0</span>     <span class="number">0</span>%   <span class="number">100</span>%  <span class="number">4898.20</span>kB <span class="number">70.46</span>%  main.main.func1</span><br><span class="line">         <span class="number">0</span>     <span class="number">0</span>%   <span class="number">100</span>%   <span class="number">516.01</span>kB  <span class="number">7.42</span>%  <span class="keyword">runtime</span>.doInit</span><br><span class="line">         <span class="number">0</span>     <span class="number">0</span>%   <span class="number">100</span>%   <span class="number">516.01</span>kB  <span class="number">7.42</span>%  <span class="keyword">runtime</span>.main</span><br><span class="line">         <span class="number">0</span>     <span class="number">0</span>%   <span class="number">100</span>%  <span class="number">1025.12</span>kB <span class="number">14.75</span>%  <span class="keyword">runtime</span>.mstart</span><br><span class="line">         <span class="number">0</span>     <span class="number">0</span>%   <span class="number">100</span>%  <span class="number">1025.12</span>kB <span class="number">14.75</span>%  <span class="keyword">runtime</span>.mstart0</span><br><span class="line">         <span class="number">0</span>     <span class="number">0</span>%   <span class="number">100</span>%  <span class="number">1025.12</span>kB <span class="number">14.75</span>%  <span class="keyword">runtime</span>.mstart1</span><br><span class="line">(pprof) traces</span><br><span class="line">Type: alloc_objects</span><br><span class="line">Time: Sep <span class="number">13</span>, <span class="number">2021</span> at <span class="number">5</span>:<span class="number">57</span>pm (CST)</span><br><span class="line">-----------+-------------------------------------------------------</span><br><span class="line">     bytes:  <span class="number">256</span>kB</span><br><span class="line">         <span class="number">2</span>   compress/flate.(*compressor).init</span><br><span class="line">             compress/flate.<span class="keyword">NewWriter</span></span><br><span class="line">             compress/gzip.(*Writer).<span class="keyword">Write</span></span><br><span class="line">             <span class="keyword">runtime</span>/pprof.(*profileBuilder).build</span><br><span class="line">             <span class="keyword">runtime</span>/pprof.printCountProfile</span><br><span class="line">             <span class="keyword">runtime</span>/pprof.writeRuntimeProfile</span><br><span class="line">             <span class="keyword">runtime</span>/pprof.writeGoroutine</span><br><span class="line">             <span class="keyword">runtime</span>/pprof.(*Profile).WriteTo</span><br><span class="line">             net<span class="regexp">/http/</span>pprof.handler.ServeHTTP</span><br><span class="line">             net<span class="regexp">/http/</span>pprof.Index</span><br><span class="line">             net/http.HandlerFunc.ServeHTTP</span><br><span class="line">             net/http.(*ServeMux).ServeHTTP</span><br><span class="line">             net/http.serverHandler.ServeHTTP</span><br><span class="line">             net/http.(*conn).serve</span><br><span class="line">-----------+-------------------------------------------------------</span><br></pre></td></tr></table></figure></li>
<li>alloc_space: åˆ†æåˆ†é…å†…å­˜ç©ºé—´å¤§å°</li>
<li>alloc_objects:</li>
<li>inuse_objects:</li>
</ul>
</li>
</ul>
<ul>
<li><p>Goroutine Profiling</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">âœ go tool pprof http:<span class="comment">//localhost:8080/debug/pprof/goroutine</span></span><br><span class="line">Fetching profile over HTTP from http:<span class="comment">//localhost:8080/debug/pprof/goroutine</span></span><br><span class="line">Saved profile <span class="keyword">in</span> /Users/chyiyaqing/pprof/pprof<span class="selector-class">.goroutine</span>.<span class="number">001</span><span class="selector-class">.pb</span><span class="selector-class">.gz</span></span><br><span class="line">Type: goroutine</span><br><span class="line">Time: Sep <span class="number">13</span>, <span class="number">2021</span> at <span class="number">5</span>:<span class="number">54</span>pm (CST)</span><br><span class="line">Entering interactive mode (type <span class="string">&quot;help&quot;</span> <span class="keyword">for</span> commands, <span class="string">&quot;o&quot;</span> <span class="keyword">for</span> options)</span><br><span class="line">(pprof) traces  <span class="comment">// æ‰“å°è°ƒç”¨æ ˆ</span></span><br><span class="line">Type: goroutine</span><br><span class="line">Time: Sep <span class="number">13</span>, <span class="number">2021</span> at <span class="number">5</span>:<span class="number">54</span>pm (CST)</span><br><span class="line">-----------+-------------------------------------------------------</span><br><span class="line">         <span class="number">1</span>   runtime<span class="selector-class">.gopark</span></span><br><span class="line">             runtime<span class="selector-class">.netpollblock</span></span><br><span class="line">             internal/poll<span class="selector-class">.runtime_pollWait</span></span><br><span class="line">             internal/poll.(*pollDesc)<span class="selector-class">.wait</span></span><br><span class="line">             internal/poll.(*pollDesc)<span class="selector-class">.waitRead</span> (inline)</span><br><span class="line">             internal/poll.(*FD)<span class="selector-class">.Read</span></span><br><span class="line">             net.(*netFD)<span class="selector-class">.Read</span></span><br><span class="line">             net.(*conn)<span class="selector-class">.Read</span></span><br><span class="line">             net/http.(*connReader)<span class="selector-class">.backgroundRead</span></span><br><span class="line">-----------+-------------------------------------------------------</span><br><span class="line">         <span class="number">1</span>   runtime<span class="selector-class">.gopark</span></span><br><span class="line">             runtime<span class="selector-class">.netpollblock</span></span><br><span class="line">             internal/poll<span class="selector-class">.runtime_pollWait</span></span><br><span class="line">             internal/poll.(*pollDesc)<span class="selector-class">.wait</span></span><br><span class="line">             internal/poll.(*pollDesc)<span class="selector-class">.waitRead</span> (inline)</span><br><span class="line">             internal/poll.(*FD)<span class="selector-class">.Accept</span></span><br><span class="line">             net.(*netFD)<span class="selector-class">.accept</span></span><br><span class="line">             net.(*TCPListener)<span class="selector-class">.accept</span></span><br><span class="line">             net.(*TCPListener)<span class="selector-class">.Accept</span></span><br><span class="line">             net/http.(*Server)<span class="selector-class">.Serve</span></span><br><span class="line">             net/http.(*Server)<span class="selector-class">.ListenAndServe</span></span><br><span class="line">             net/http<span class="selector-class">.ListenAndServe</span> (inline)</span><br><span class="line">             <span class="selector-tag">main</span><span class="selector-class">.main</span></span><br><span class="line">             runtime<span class="selector-class">.main</span></span><br><span class="line">-----------+-------------------------------------------------------</span><br><span class="line">         <span class="number">1</span>   runtime<span class="selector-class">.gopark</span></span><br><span class="line">             <span class="selector-tag">time</span><span class="selector-class">.Sleep</span></span><br><span class="line">             <span class="selector-tag">main</span><span class="selector-class">.main</span><span class="selector-class">.func1</span></span><br><span class="line">-----------+-------------------------------------------------------</span><br><span class="line">         <span class="number">1</span>   runtime/pprof<span class="selector-class">.runtime_goroutineProfileWithLabels</span></span><br><span class="line">             runtime/pprof<span class="selector-class">.writeRuntimeProfile</span></span><br><span class="line">             runtime/pprof<span class="selector-class">.writeGoroutine</span></span><br><span class="line">             runtime/pprof.(*Profile)<span class="selector-class">.WriteTo</span></span><br><span class="line">             net/http/pprof<span class="selector-class">.handler</span><span class="selector-class">.ServeHTTP</span></span><br><span class="line">             net/http/pprof<span class="selector-class">.Index</span></span><br><span class="line">             net/http<span class="selector-class">.HandlerFunc</span><span class="selector-class">.ServeHTTP</span></span><br><span class="line">             net/http.(*ServeMux)<span class="selector-class">.ServeHTTP</span></span><br><span class="line">             net/http<span class="selector-class">.serverHandler</span><span class="selector-class">.ServeHTTP</span></span><br><span class="line">             net/http.(*conn)<span class="selector-class">.serve</span></span><br><span class="line">-----------+-------------------------------------------------------</span><br></pre></td></tr></table></figure></li>
<li><p>Mutex Profiling</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">âœ go tool pprof http:<span class="regexp">//</span>localhost:<span class="number">8080</span><span class="regexp">/debug/</span>pprof/mutex</span><br><span class="line">Fetching profile over HTTP from http:<span class="regexp">//</span>localhost:<span class="number">8080</span><span class="regexp">/debug/</span>pprof/mutex</span><br><span class="line">Saved profile <span class="keyword">in</span> <span class="regexp">/Users/</span>chyiyaqing<span class="regexp">/pprof/</span>pprof.contentions.delay.<span class="number">003</span>.pb.gz</span><br><span class="line">Type: delay</span><br><span class="line">Time: Sep <span class="number">13</span>, <span class="number">2021</span> at <span class="number">6</span>:<span class="number">05</span>pm (CST)</span><br><span class="line">Entering interactive mode (type <span class="string">&quot;help&quot;</span> <span class="keyword">for</span> commands, <span class="string">&quot;o&quot;</span> <span class="keyword">for</span> options)</span><br><span class="line">(pprof) top</span><br><span class="line">Showing nodes accounting <span class="keyword">for</span> <span class="number">941.98</span>us, <span class="number">100</span>% of <span class="number">941.98</span>us total</span><br><span class="line">      flat  flat%   sum%        cum   cum%</span><br><span class="line">  <span class="number">941.98</span>us   <span class="number">100</span>%   <span class="number">100</span>%   <span class="number">941.98</span>us   <span class="number">100</span>%  sync.(*Mutex).Unlock</span><br><span class="line">         <span class="number">0</span>     <span class="number">0</span>%   <span class="number">100</span>%   <span class="number">941.98</span>us   <span class="number">100</span>%  main.main.func1</span><br><span class="line">(pprof) list main</span><br><span class="line">Total: <span class="number">941.98</span>us</span><br><span class="line">ROUTINE ======================== main.main.func1 <span class="keyword">in</span> <span class="regexp">/Users/</span>chyiyaqing<span class="regexp">/Downloads/</span>pprof<span class="regexp">/pprof/m</span>ain2.go</span><br><span class="line">         <span class="number">0</span>   <span class="number">941.98</span>us (flat, cum)   <span class="number">100</span>% of Total</span><br><span class="line">         .          .     <span class="number">18</span>:	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">999</span>; i++ &#123;</span><br><span class="line">         .          .     <span class="number">19</span>:		go <span class="keyword">func</span>(i int) &#123;</span><br><span class="line">         .          .     <span class="number">20</span>:			m.Lock()</span><br><span class="line">         .          .     <span class="number">21</span>:			defer m.Unlock()</span><br><span class="line">         .          .     <span class="number">22</span>:			datas[i] = struct&#123;&#125;&#123;&#125;</span><br><span class="line">         .   <span class="number">941.98</span>us     <span class="number">23</span>:		&#125;(i)</span><br><span class="line">         .          .     <span class="number">24</span>:	&#125;</span><br><span class="line">         .          .     <span class="number">25</span>:</span><br><span class="line">         .          .     <span class="number">26</span>:	_ = http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, nil)</span><br><span class="line">         .          .     <span class="number">27</span>:&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Block Profiling</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">âœ go tool pprof http:<span class="regexp">//</span>localhost:<span class="number">8080</span><span class="regexp">/debug/</span>pprof/block</span><br><span class="line">Fetching profile over HTTP from http:<span class="regexp">//</span>localhost:<span class="number">8080</span><span class="regexp">/debug/</span>pprof/block</span><br><span class="line">Saved profile <span class="keyword">in</span> <span class="regexp">/Users/</span>chyiyaqing<span class="regexp">/pprof/</span>pprof.contentions.delay.<span class="number">005</span>.pb.gz</span><br><span class="line">Type: delay</span><br><span class="line">Time: Sep <span class="number">13</span>, <span class="number">2021</span> at <span class="number">6</span>:<span class="number">17</span>pm (CST)</span><br><span class="line">Entering interactive mode (type <span class="string">&quot;help&quot;</span> <span class="keyword">for</span> commands, <span class="string">&quot;o&quot;</span> <span class="keyword">for</span> options)</span><br><span class="line">(pprof) top</span><br><span class="line">Showing nodes accounting <span class="keyword">for</span> <span class="number">92.66</span>ms, <span class="number">100</span>% of <span class="number">92.67</span>ms total</span><br><span class="line">Dropped <span class="number">4</span> nodes (cum &lt;= <span class="number">0.46</span>ms)</span><br><span class="line">      flat  flat%   sum%        cum   cum%</span><br><span class="line">   <span class="number">92.66</span>ms   <span class="number">100</span>%   <span class="number">100</span>%    <span class="number">92.66</span>ms   <span class="number">100</span>%  sync.(*Mutex).Lock (inline)</span><br><span class="line">         <span class="number">0</span>     <span class="number">0</span>%   <span class="number">100</span>%    <span class="number">92.66</span>ms   <span class="number">100</span>%  main.main.func1</span><br><span class="line">(pprof) list</span><br><span class="line">command list requires an argument</span><br><span class="line">(pprof) list main</span><br><span class="line">Total: <span class="number">92.67</span>ms</span><br><span class="line">ROUTINE ======================== main.main.func1 <span class="keyword">in</span> <span class="regexp">/Users/</span>chyiyaqing<span class="regexp">/Downloads/</span>pprof<span class="regexp">/pprof/m</span>ain2.go</span><br><span class="line">         <span class="number">0</span>    <span class="number">92.66</span>ms (flat, cum)   <span class="number">100</span>% of Total</span><br><span class="line">         .          .     <span class="number">17</span>:<span class="keyword">func</span> main() &#123;</span><br><span class="line">         .          .     <span class="number">18</span>:	var m sync.Mutex</span><br><span class="line">         .          .     <span class="number">19</span>:	var datas = make(map[int]struct&#123;&#125;)</span><br><span class="line">         .          .     <span class="number">20</span>:	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">999</span>; i++ &#123;</span><br><span class="line">         .          .     <span class="number">21</span>:		go <span class="keyword">func</span>(i int) &#123;</span><br><span class="line">         .    <span class="number">92.66</span>ms     <span class="number">22</span>:			m.Lock()</span><br><span class="line">         .          .     <span class="number">23</span>:			defer m.Unlock()</span><br><span class="line">         .          .     <span class="number">24</span>:			datas[i] = struct&#123;&#125;&#123;&#125;</span><br><span class="line">         .          .     <span class="number">25</span>:		&#125;(i)</span><br><span class="line">         .          .     <span class="number">26</span>:	&#125;</span><br><span class="line">         .          .     <span class="number">27</span>:</span><br></pre></td></tr></table></figure></li>
<li><p>æŸ¥çœ‹å¯è§†åŒ–ç•Œé¢</p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">âœ wget http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8080</span>/<span class="keyword">debug</span>/pprof/<span class="keyword">profile</span></span><br><span class="line">--<span class="number">2021</span>-<span class="number">09</span>-<span class="number">13</span> <span class="number">18</span>:<span class="number">25</span>:<span class="number">42</span>--  http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8080</span>/<span class="keyword">debug</span>/pprof/<span class="keyword">profile</span></span><br><span class="line">Connecting <span class="keyword">to</span> <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8080</span>... connected.</span><br><span class="line">HTTP request sent, awaiting response... <span class="number">200</span> OK</span><br><span class="line">Length: <span class="number">1290</span> (<span class="number">1.3</span>K) [application/octet-stream]</span><br><span class="line">Saving <span class="keyword">to</span>: â€˜<span class="keyword">profile</span>â€™</span><br><span class="line"></span><br><span class="line"><span class="keyword">profile</span>                            <span class="number">100</span>%[================================================================&gt;]   <span class="number">1.26</span>K  --.-KB/s    <span class="keyword">in</span> <span class="number">0</span>s</span><br><span class="line"></span><br><span class="line"><span class="number">2021</span>-<span class="number">09</span>-<span class="number">13</span> <span class="number">18</span>:<span class="number">26</span>:<span class="number">12</span> (<span class="number">205</span> MB/s) - â€˜<span class="keyword">profile</span>â€™ saved [<span class="number">1290</span>/<span class="number">1290</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€</span></span><br><span class="line">âœ go tool pprof -http=:<span class="number">6001</span> <span class="keyword">profile</span></span><br><span class="line">Serving web UI <span class="keyword">on</span> http://localhost:<span class="number">6001</span></span><br><span class="line">  <span class="comment"># Top</span></span><br><span class="line">  <span class="comment"># Graph: å‡½æ•°è°ƒç”¨æµç¨‹</span></span><br><span class="line">  <span class="comment"># Peek: ä¸Šä¸‹æ–‡ä¿¡æ¯</span></span><br><span class="line">  <span class="comment"># Source: æºä»£ç çš„è¿½è¸ªå’Œåˆ†æ</span></span><br><span class="line">  <span class="comment"># Flame Graph:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒ</span></span><br><span class="line">âœ go tool pprof <span class="keyword">profile</span></span><br><span class="line">Type: cpu</span><br><span class="line">Time: Sep <span class="number">13</span>, <span class="number">2021</span> at <span class="number">6</span>:<span class="number">25</span>pm (CST)</span><br><span class="line">Duration: <span class="number">30</span>s, Total samples = <span class="number">240</span>ms (  <span class="number">0.8</span>%)</span><br><span class="line">Entering interactive mode (type <span class="string">&quot;help&quot;</span> <span class="keyword">for</span> commands, <span class="string">&quot;o&quot;</span> <span class="keyword">for</span> options)</span><br><span class="line">(pprof) web</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>æ€§èƒ½åˆ†æ</tag>
      </tags>
  </entry>
  <entry>
    <title>Huawei LiteOS Intro</title>
    <url>/2021/09/14/Huawei-LiteOS-Intro/</url>
    <content><![CDATA[<h1 id="Huawei-LiteOS"><a href="#Huawei-LiteOS" class="headerlink" title="Huawei LiteOS"></a>Huawei LiteOS</h1><blockquote>
<p>é¢å‘IOTé¢†åŸŸï¼Œæ„å»ºè½»é‡çº§ç‰©è”ç½‘æ“ä½œç³»ç»Ÿ, ç›®å‰æ”¯æŒARM64,ARM Contex-A, ARM Cortex-M0, Cortex-M3, Cortex-M4, Cortex-M7</p>
</blockquote>
<ul>
<li>ä¼˜åŠ¿:<ul>
<li>é«˜å®æ—¶æ€§,é«˜ç¨³å®šæ€§</li>
<li>è¶…å°å†…æ ¸ï¼ŒåŸºç¡€å†…æ ¸ä½“ç§¯å¯ä»¥è£å‰ªè‡³ä¸åˆ°10K</li>
<li>ä½åŠŸè€—</li>
<li>æ”¯æŒåŠŸèƒ½é™æ€è£å‰ª</li>
</ul>
</li>
</ul>
<span id="more"></span>

<h2 id="æ¶æ„æ¡†å›¾"><a href="#æ¶æ„æ¡†å›¾" class="headerlink" title="æ¶æ„æ¡†å›¾"></a>æ¶æ„æ¡†å›¾</h2><p><img src="/misc/images/huawei-liteos-architecture.png" alt="Artecture"></p>
<ul>
<li>åŸºç¡€å†…æ ¸:<ul>
<li>æå°å†…æ ¸<ul>
<li>ä»»åŠ¡ç®¡ç†</li>
<li>å†…å­˜ç®¡ç†</li>
<li>ä¸­æ–­ç®¡ç†</li>
<li>å¼‚å¸¸ç®¡ç†</li>
<li>ç³»ç»Ÿæ—¶é’Ÿ</li>
</ul>
</li>
<li>å¯è£å‰ªå…¶ä»–æ¨¡å—<ul>
<li>ä¿¡å·é‡</li>
<li>äº’æ–¥é”</li>
<li>é˜Ÿåˆ—ç®¡ç†</li>
<li>äº‹ä»¶ç®¡ç†</li>
<li>è½¯ä»¶å®šæ—¶å™¨</li>
</ul>
</li>
</ul>
</li>
<li>å†…æ ¸å¢å¼º<ul>
<li>C++ æ”¯æŒ</li>
<li>è°ƒæµ‹ç»„ä»¶</li>
<li>shellå‘½ä»¤</li>
<li>Traceäº‹ä»¶è·Ÿè¸ª</li>
<li>CPUå ç”¨ç‡</li>
<li>LMS</li>
</ul>
</li>
<li>æ–‡ä»¶ç³»ç»Ÿ<ul>
<li>vfs</li>
<li>ramfs</li>
<li>fatfs</li>
</ul>
</li>
<li>ç³»ç»Ÿåº“æ¥å£<ul>
<li>libc</li>
<li>libm</li>
<li>posix</li>
<li>cmsis</li>
</ul>
</li>
<li>ç½‘ç»œåè®®æ ˆ<ul>
<li>CoAP</li>
<li>LwM2M</li>
<li>MQTT</li>
</ul>
</li>
</ul>
]]></content>
      <tags>
        <tag>IOT</tag>
      </tags>
  </entry>
  <entry>
    <title>Blockchain Intro</title>
    <url>/2021/09/17/Blockchain-Intro/</url>
    <content><![CDATA[<h1 id="Blockchain"><a href="#Blockchain" class="headerlink" title="Blockchain"></a>Blockchain</h1><blockquote>
<p>åŒºå—é“¾æŠ€æœ¯èŒèŠ½äºæ¯”ç‰¹å¸ï¼Œè¯ç”Ÿåœ¨ä»¥å¤ªåŠ, åŒºå—é“¾æ˜¯ä»·å€¼çš„è½½ä½“ï¼Œæ˜¯ä¸€ç§æ–°å‹çš„ç¤¾ä¼šç”Ÿäº§å…³ç³»ã€‚åŸºäºåŒºå—é“¾æŠ€æœ¯ï¼Œæ‰“é€šç°å®ä¸–ç•Œä¸ç½‘ç»œä¸–ç•Œçš„å±éšœï¼Œå°†ç‰©è´¨è™šæ‹ŸåŒ–ï¼Œå°†ä»·å€¼å®ä½“åŒ–.</p>
</blockquote>
<span id="more"></span>

<ul>
<li>æ•°å­—è´§å¸<ul>
<li>BTC:<figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> <span class="javascript"><span class="number">2008</span>å¹´,é‡‘èå±æœºèƒŒæ™¯ä¸‹ï¼Œä¸­æœ¬èªçœ‹åˆ°ç°ä»£é‡‘èä½“ç³»çš„ä¸è¶³ï¼Œåˆ›å»ºåŸºäºå¯†ç å­¦è€Œéä¿¡ä»»å…³ç³»çš„æ•°å­—è´§å¸ç³»ç»Ÿ -- æ¯”ç‰¹å¸</span></span><br><span class="line"><span class="meta">&gt;</span> <span class="javascript">åœ¨æ¯”ç‰¹å¸ä¸­ï¼ŒçŸ¿å·¥é€šè¿‡è®¡ç®—æ»¡è¶³æ¡ä»¶çš„åŒºå—è·å¾—æŒ–çŸ¿å¥–åŠ±ï¼Œä¸”å¤§æ¦‚æ¯å››å¹´å‡åŠï¼Œæ¯”ç‰¹å¸çš„è´§å¸ä¾›åº”éšç€æ—¶é—´é€æ¸å‡å°‘ï¼Œæ˜¯ä¸€ç§é€šç¼©å‹æ•°å­—è´§å¸.</span></span><br></pre></td></tr></table></figure></li>
<li>Etherenum:<figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> <span class="javascript">Vç¥åœ¨æ¯”ç‰¹å¸çš„åŸºç¡€ä¸Šï¼Œå°†æ™ºèƒ½åˆçº¦äºåŒºå—é“¾ç»“åˆ,åˆ›ç«‹å»ä¸­å¿ƒåŒ–åº”ç”¨å¹³å° -- ä»¥å¤ªåŠ</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ç¡¬åˆ†å‰åˆ†è£‚:<ul>
<li>ETH:</li>
<li>ETC:</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>è½¯åˆ†å‰: å¯å…¼å®¹çš„ç¨‹åºç‰ˆæœ¬æ›´æ–°</li>
<li>ç¡¬åˆ†å‰: ä¸å¯å…¼å®¹çš„ç¨‹åºç‰ˆæœ¬æ›´æ–°</li>
<li>å…¬é“¾åœˆ: ä¸“æ³¨äºæœ‰å¸çš„å…±æœ‰å¼€æ”¾åŒºå—é“¾ç½‘ç»œ<figure class="highlight haml"><table><tr><td class="code"><pre><span class="line"># åº”ç”¨å±‚é¢:</span><br><span class="line">  -<span class="ruby"> å»ä¸­å¿ƒåŒ–é‡‘è: Decentralised Finance</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> é‡‘è: é€šè¿‡é‡æ–°åˆ†é…èµ„äº§æ¥è·å¾—èµ„äº§å¢å€¼çš„ä¸€ç§æ¸ é“ï¼Œæœ¬è´¨åœ¨äºä¿¡ç”¨ã€é£é™©å’Œæ æ†ï¼Œé‡‘èæˆç«‹çš„å‰æå°±æ˜¯æ§åˆ¶ä¸ç¡®å®šæ€§é£é™©ã€‚</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> å»ä¸­å¿ƒåŒ–å­˜å‚¨:</span></span><br><span class="line"><span class="ruby"></span>    &gt; ä¸€ç§åˆ©ç”¨åˆ†å¸ƒå¼å­˜å‚¨æŠ€æœ¯ï¼Œå°†æ–‡ä»¶åˆ†å—å­˜å‚¨åœ¨ä¸åŒå­˜å‚¨èŠ‚ç‚¹çš„åº”ç”¨å‹åˆ›æ–°. ç›¸è¾ƒäºä¸­å¿ƒåŒ–å­˜å‚¨ï¼Œæ‹¥æœ‰æ›´é«˜çº§åˆ«çš„éšç§ä¿æŠ¤ï¼Œå­˜å‚¨æˆæœ¬æ›´ä½ï¼Œä¸”å…·å¤‡æ›´å†—ä½™çš„æ•°æ®å¤‡ä»½å‰¯æœ¬ï¼Œèƒ½æœ‰æ•ˆé¿å…å•ç‚¹æ•…éšœ</span><br><span class="line">    -<span class="ruby"> é¢ä¸´çš„é—®é¢˜:</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> <span class="number">1</span>. å¸ä»·æ³¢åŠ¨å¯¼è‡´æˆæœ¬ä¸ç¡®å®šæ€§</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> <span class="number">2</span>. å—åˆ¶äºç½‘ç»œç¯å¢ƒä»¥åŠç¡¬ç›˜æœ¬èº«ï¼Œæ•´ä¸ªå»ä¸­å¿ƒåŒ–ç½‘ç»œå­˜å‚¨æ€§èƒ½ä¸é«˜ï¼Œè¿œä¸å¦‚ä¸­å¿ƒåŒ–å­˜å‚¨ï¼Œåªé€‚ç”¨å†·æ•°æ®ä»¥åŠä¸ªäººæ•°æ®å­˜å‚¨.</span></span><br><span class="line"><span class="ruby"></span># æŠ€æœ¯åˆ›æ–°å±‚é¢:</span><br><span class="line">  &gt; è·¨é“¾: ä¸åŒåŒºå—é“¾ç½‘ç»œæ˜¯ç‹¬ç«‹ï¼Œæ˜¯ä¸€ä¸ªä¸ªæ•°æ®å­¤å²›ï¼Œè·¨é“¾æŠ€æœ¯æ˜¯åœ¨è¿™äº›å²›ä¹‹é—´æ„å»ºäº’é€šçš„æ¡¥æ¢,æä¾›ä¸åŒé“¾ä¹‹é—´æ•°æ®äº’é€šçš„å¯èƒ½æ€§.</span><br></pre></td></tr></table></figure></li>
<li>è”ç›Ÿé“¾åœˆ: ä¸“æ³¨äºåŒºå—é“¾æŠ€æœ¯åœ¨ä¼ä¸šé¢†åŸŸçš„ç ”ç©¶<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># æ•°æ®å­˜è¯:</span></span><br><span class="line">  &gt; åŒºå—é“¾æŠ€æœ¯å…·æœ‰æ—¶é—´è¿ç»­ï¼Œä¸å¯ç¯¡æ”¹ï¼Œå¯å›æº¯ç­‰ç‰¹æ€§ï¼Œéå¸¸é€‚åˆç•™å­˜è¯æ®çš„æ•°æ®å­˜å‚¨ã€‚å¤§å¤šæ•°åº”ç”¨åœ¨åŒºå—é“¾ä¸Šå­˜å‚¨åªæ˜¯æ•°æ®è¯æ˜ï¼Œè€ŒéåŸå§‹æ•°æ®ã€‚</span><br><span class="line"></span><br><span class="line"><span class="meta"># æ•°æ®äº¤æ¢:</span></span><br><span class="line">  &gt; é€šè¿‡åŒºå—é“¾æŠ€æœ¯è§£å†³å¤šæ–¹æ•°æ®äº¤äº’éœ€æ±‚ï¼Œå„æ–¹éƒ¨ç½²åŒºå—é“¾èŠ‚ç‚¹ï¼Œåªéœ€ä¸è‡ªèº«èŠ‚ç‚¹äº¤äº’ï¼ŒåŒºå—é“¾æœºåˆ¶è‡ªåŠ¨å°†æ•°æ®åŒæ­¥è‡³å…¶ä»–å‚ä¸æ–¹ï¼Œä»»ä¸€èŠ‚ç‚¹æ•°æ®æ›´æ–°ï¼ŒåŒºå—é“¾é€šçŸ¥æœºåˆ¶è‡ªåŠ¨é€šçŸ¥å„æ”¾</span><br><span class="line"></span><br><span class="line"><span class="meta"># ä»·å€¼è½¬ç§»:</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="BTC-æ¯”ç‰¹å¸ç™½çš®ä¹¦-â€“-é˜…è¯»"><a href="#BTC-æ¯”ç‰¹å¸ç™½çš®ä¹¦-â€“-é˜…è¯»" class="headerlink" title="BTC æ¯”ç‰¹å¸ç™½çš®ä¹¦ â€“ é˜…è¯»"></a>BTC æ¯”ç‰¹å¸ç™½çš®ä¹¦ â€“ é˜…è¯»</h2><blockquote>
<p>ä¸€ç§P2Pç”µå­è´§å¸ç³»ç»Ÿï¼ŒåŸºäºå¯†ç å­¦åŸç†è€Œä¸æ˜¯ä¿¡ä»»çš„ç”µå­æ”¯ä»˜ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿå…è®¸ä»»ä½•æœ‰äº¤æ˜“æ„æ„¿çš„åŒæ–¹èƒ½ç›´æ¥äº¤æ˜“è€Œä¸éœ€è¦ä¸€ä¸ªå¯ä¿¡ä»»ç¬¬ä¸‰æ–¹ã€‚åªè¦è¯šå®èŠ‚ç‚¹é›†ä½“æ§åˆ¶çš„CPUç®—åŠ›å¤§äºæ¯ä¸€ä¸ªåˆä½œæ”»å‡»èŠ‚ç‚¹ç¾¤çš„CPUç®—åŠ›ï¼Œè¿™ä¸ªç³»ç»Ÿå°±æ˜¯å®‰å…¨çš„ã€‚</p>
</blockquote>
<p><a href="https://bitcoin.org/zh_CN/bitcoin-paper">BTCç™½çš®ä¹¦</a></p>
<ul>
<li>äº¤æ˜“</li>
<li>äº‹ä»¶æˆ³æœåŠ¡å™¨</li>
<li>å·¥ä½œé‡è¯æ˜</li>
<li>ç½‘ç»œ</li>
<li>æ¿€åŠ±</li>
<li>å›æ”¶ç£ç›˜ç©ºé—´</li>
<li>åˆå¹¶å’Œåˆ†å‰²äº¤æ˜“é¢</li>
<li>éšç§</li>
<li>è®¡ç®—</li>
</ul>
<h2 id="æŠ€æœ¯åŸç†"><a href="#æŠ€æœ¯åŸç†" class="headerlink" title="æŠ€æœ¯åŸç†"></a>æŠ€æœ¯åŸç†</h2><ul>
<li><p>åŒºå—é“¾ç‰¹å¾:</p>
<ul>
<li>å»ä¸­å¿ƒåŒ–<figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> <span class="javascript">åŒºå—é“¾å­˜åœ¨çš„åˆè¡·å°±æ˜¯å»é™¤ä¸­å¿ƒåŒ–çš„ç¬¬ä¸‰æ–¹æœºæ„ï¼Œæ•´ä¸ªç½‘ç»œçš„æ•°æ®ä»¥åŠçŠ¶æ€æ˜¯ç”±ç½‘ç»œä¸­æ‰€æœ‰çš„èŠ‚ç‚¹å…±åŒç»´æŠ¤ï¼Œä»»ä¸€èŠ‚ç‚¹ç¦»çº¿ä¸ä¼šå½±å“ç³»ç»Ÿçš„è¿ä½œ.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span> <span class="javascript">èŠ‚ç‚¹äº’ä¸ºå½¼æ­¤çš„æ•°æ®ç”Ÿäº§è€…åŠæ¶ˆè´¹è€…</span></span><br><span class="line"><span class="meta">&gt;</span> <span class="javascript">ç°é˜¶æ®µåŒºå—é“¾å»ä¸­å¿ƒåŒ–æœ¬è´¨æ˜¯ç›¸å¯¹å»ä¸­å¿ƒåŒ–(å¤šä¸­å¿ƒåŒ–)</span></span><br></pre></td></tr></table></figure></li>
<li>å¯è¿½æº¯æ€§<figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> <span class="javascript">åŒºå—é“¾è¢«è®¤ä¸ºæ˜¯æ—¶åºæ•°æ®åº“,å¯¹èŠ‚ç‚¹æ•°æ®åº“å­˜å‚¨å“åº”çš„æ•°æ®ä»¥åŠæ—¥å¿—ï¼Œä¸”æ¯ä»½æ•°æ®æ˜¯æŒ‰ç…§é¡ºåºå‰åå…³è”åœ¨ä¸€èµ·ï¼Œæ–°çš„æ•°æ®ä¸€å®šä»æŸä¸€ç»„ä¹‹å‰å·²å­˜åœ¨çš„æ•°æ®æ´¾ç”Ÿè€Œæ¥</span></span><br></pre></td></tr></table></figure></li>
<li>ä¸å¯ç¯¡æ”¹<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># å¯†ç å­¦</span></span><br><span class="line"><span class="bullet">  -</span> å“ˆå¸Œç®—æ³•: ä»»æ„æ•°æ®è½¬æ¢ä¸ºå›ºå®šé•¿åº¦çš„æ•°æ®æŒ‡çº¹, å½¢æˆä¸€æ¡ç”±æ•°æ®æŒ‡çº¹ä¸²è”çš„ä¿¡æ¯é“¾æ¡</span><br><span class="line"><span class="section"># å…±è¯†ç®—æ³•</span></span><br><span class="line"><span class="bullet">  -</span> å¤§å¤šæ•°å…±è¯†ç®—æ³•éµå¾ªå°‘æ•°æœä»å¤šæ•°çš„åŸåˆ™</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>å­˜å‚¨:<br><img src="/misc/images/blockchain_store.jpg" alt="åŒºå—é“¾å­˜å‚¨"></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># å­˜å‚¨å†—ä½™</span></span><br><span class="line"><span class="bullet">  -</span> æ¯”ç‰¹å¸ç½‘ç»œç´¯è®¡è¶…è¿‡350Gçš„å†å²æ•°æ®, ä»¥å¤ªåŠä½†èŠ‚ç‚¹è¶…è¿‡8700Gçš„å†å²æ•°æ®</span><br><span class="line"><span class="bullet">  -</span> æ•°æ®å½’æ¡£: çš„æœ¬è´¨æ˜¯åœ¨ä¿æŒä¸å¯ç¯¡æ”¹çš„å‰æä¸‹ç‰ºç‰²éƒ¨åˆ†å¯è¿½æº¯æ€§</span><br><span class="line"><span class="bullet">  -</span> èŠ‚ç‚¹è§’è‰²:</span><br><span class="line"><span class="bullet">    -</span> Bitcoin Core å…¨èŠ‚ç‚¹: è·¯ç”±ã€é“¾å­˜å‚¨ã€æŒ–çŸ¿ã€é’±åŒ…</span><br><span class="line"><span class="bullet">    -</span> æ™®é€šå…¨èŠ‚ç‚¹: è·¯ç”±ã€é“¾å­˜å‚¨</span><br><span class="line"><span class="bullet">    -</span> SPVé’±åŒ…èŠ‚ç‚¹: è·¯ç”±ã€é’±åŒ…</span><br><span class="line"><span class="bullet">    -</span> æŒ–çŸ¿èŠ‚ç‚¹: è·¯ç”±ã€é“¾å­˜å‚¨ã€æŒ–çŸ¿</span><br><span class="line"></span><br><span class="line"><span class="section"># Transaction: äº¤æ˜“</span></span><br><span class="line">  &gt; äº¤æ˜“æ˜¯åŒºå—é“¾ç½‘ç»œä¸­æ•°æ®çš„æœ€å°ç»„æˆéƒ¨åˆ†, äº¤æ˜“æäº¤ååªèƒ½æœ‰ä¸¤ç§çŠ¶æ€(æˆåŠŸ/å¤±è´¥)</span><br><span class="line">  &gt; åŒºå—é“¾ä¸­æ‰€æœ‰çš„äº¤æ˜“åŸºæœ¬éƒ½æ˜¯ä»åŒºå—é“¾å¤–éƒ¨å‘èµ·ï¼ŒåŒºå—é“¾ç½‘ç»œåªæ¥æ”¶äº¤æ˜“è€Œä¸ç”Ÿäº§äº¤æ˜“, ä¸”ä¸å¯¹äº¤æ˜“åšä»»ä½•æ”¹åŠ¨ã€‚</span><br><span class="line"><span class="bullet">  -</span> äº¤æ˜“å±æ€§:</span><br><span class="line"><span class="bullet">    -</span> From: äº¤æ˜“çš„å‘èµ·æ–¹</span><br><span class="line"><span class="bullet">    -</span> To: äº¤æ˜“çš„æ¥æ”¶æ–¹</span><br><span class="line"><span class="bullet">    -</span> æ™ºèƒ½åˆçº¦: æ‰§è¡Œæ™ºèƒ½åˆçº¦çš„åç§°</span><br><span class="line"><span class="bullet">    -</span> æ–¹æ³•åç§°</span><br><span class="line"><span class="bullet">    -</span> å‚æ•°åˆ—è¡¨</span><br><span class="line"><span class="bullet">    -</span> ç­¾å: ç§é’¥å¯¹äº¤æ˜“è¿›è¡Œç­¾å</span><br><span class="line"><span class="bullet">    -</span> æ—¶é—´æˆ³: äº¤æ˜“åœ¨å®¢æˆ·ç«¯æ„å»ºçš„æ—¶é—´</span><br><span class="line"><span class="section"># åŒºå—</span></span><br><span class="line">  &gt; åŒºå—é“¾æ˜¯æ—¶é—´æ®µçš„æ•°æ®å‰åå…³è”ä¾æ¬¡ä¸²è”æ•´åˆæˆçš„ä¿¡æ¯é“¾æ¡ï¼Œè€Œæ¯ä¸€ä¸ªæ—¶é—´æ®µçš„æ•°æ®ç§°ä¸ºåŒºå—Block</span><br><span class="line">  &gt; åŒºå—æ˜¯æŒ‡å°†èŠ‚ç‚¹ä¸€æ®µæ—¶é—´å†…æ”¶åˆ°çš„æ‰€æœ‰(æœ‰æ•ˆ)äº¤æ˜“æ‰“åŒ…è€Œå½¢æˆçš„ä¸€ç§æ•°æ®ç»“æ„.</span><br><span class="line"><span class="bullet">  -</span> åŒºå—ç»“æ„:</span><br><span class="line"><span class="bullet">    -</span> åŒºå—å¤´:</span><br><span class="line"><span class="bullet">      -</span> å‰ç½®åŒºå—å“ˆå¸Œ: åŒºå—é—´çš„å…³è”</span><br><span class="line"><span class="bullet">      -</span> äº¤æ˜“æ ¹å“ˆå¸Œ: åŒºå—ä¸äº¤æ˜“çš„å…³è”</span><br><span class="line"><span class="bullet">      -</span> åŒºå—é«˜åº¦: å½“å‰åŒºå—åœ¨åŒºå—é“¾ä¸­çš„ä½ç½®</span><br><span class="line"><span class="bullet">      -</span> æ—¶é—´æˆ³: åŒºå—æ‰“åŒ…çš„æ—¶é—´</span><br><span class="line"><span class="bullet">    -</span> åŒºå—ä½“: ä¿å­˜äº¤æ˜“å¹¶æŒ‰ç…§äº¤æ˜“æ—¶é—´æ’åº</span><br><span class="line"><span class="bullet">  -</span> åŒºå—é—´å…³è”:</span><br><span class="line"><span class="bullet">    -</span> æ¯ä¸ªåŒºå—éƒ½ä¼šåŒ…å«å‰ç½®åŒºå—å“ˆå¸Œä½œä¸ºé€»è¾‘å…³è”ä¸¤ä¸ªåŒºå—çš„é”šç‚¹</span><br><span class="line"></span><br><span class="line"><span class="section"># è«å…‹å°”æ ‘:</span></span><br><span class="line">  &gt; æ ‘çŠ¶ç»“æ„ï¼Œè‡³å°‘ä¸‰å±‚ï¼Œåˆ†åˆ«æ˜¯å¶å­ç»“ç‚¹, ä¸­é—´èŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹</span><br><span class="line"><span class="bullet">  -</span> æ„å»ºé€»è¾‘:</span><br><span class="line"><span class="code">    &gt; ç›¸é‚»å¶å­ç»“ç‚¹è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œå¾—åˆ°å“ˆå¸Œå€¼ä½œä¸ºä¸¤ä¸ªå¶å­èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œè¿™æ ·ç”±å“ˆå¸Œå€¼æ„æˆçš„è«å…‹å°”æ ‘</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># StateçŠ¶æ€</span></span><br><span class="line"><span class="bullet">  -</span> æœ‰é™çŠ¶æ€æœº:</span><br><span class="line"><span class="code">    &gt; åœ¨ä¸€ä¸ªå°é—­çš„ç³»ç»Ÿä¸­ï¼Œå¦‚æœçŠ¶æ€èµ·å§‹æ¡ä»¶ä¸€è‡´ï¼ŒçŠ¶æ€æ”¹å˜æ¡ä»¶é¡ºåºä¸€è‡´ï¼Œæœ€ç»ˆä¸€å®šä¼šå¾—åˆ°ä¸€è‡´çš„ç»“æœ</span></span><br><span class="line"><span class="code">    &gt; åŒºå—é“¾ä¹Ÿæ˜¯ä¸€ç§æœ‰é™çŠ¶æ€æœº</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="bullet">  -</span> çŠ¶æ€æ¨¡å‹:</span><br><span class="line"><span class="bullet">    -</span> UTXO(Unspent Trasaction Outputs - æœªèŠ±è´¹çš„äº¤æ˜“è¾“å‡º)æ¨¡å‹:</span><br><span class="line"><span class="bullet">      -</span> æœªèŠ±è´¹çš„äº¤æ˜“è¾“å…¥å‘ŠçŸ¥è´§å¸æ˜¯ä»å“ªé‡Œæ¥ï¼ŒæœªèŠ±è´¹çš„äº¤æ˜“è¾“å‡ºå‘ŠçŸ¥è´§å¸å¾€å“ªé‡Œå»</span><br><span class="line"><span class="bullet">    -</span> è´¦æˆ·æ¨¡å‹: å®ç°è´¦æˆ·é—´ä½™é¢çš„åŠ¨æ€å¹³è¡¡</span><br><span class="line"><span class="bullet">    -</span> é€šç”¨æ¨¡å‹: æ²¡æœ‰å†…ç½®çŠ¶æ€å±æ€§ï¼Œå¯å­˜å‚¨ä»»æ„è‡ªå®šä¹‰æ•°æ®</span><br></pre></td></tr></table></figure></li>
<li><p>å¯†ç å­¦ç®—æ³•</p>
<figure class="highlight haml"><table><tr><td class="code"><pre><span class="line"># å“ˆå¸Œç®—æ³•</span><br><span class="line">  &gt; å“ˆå¸Œç®—æ³•ç§°ä¸ºæ•£åˆ—å‡½æ•°ï¼Œå¯ä»¥å°†ä»»æ„é•¿åº¦çš„æ•°æ®è½¬æ¢æˆçŸ­çš„ã€å›ºå®šé•¿åº¦çš„æ•°æ®æŒ‡çº¹</span><br><span class="line">  -<span class="ruby"> å¸¸ç”¨çš„å“ˆå¸Œç®—æ³•:</span></span><br><span class="line"><span class="ruby"></span>    &gt; å“ˆå¸Œç®—æ³•ç›¸å½“äºæ˜¯å¯¹ä¿¡æ¯æå–æ‘˜è¦,æ˜¯æ•°æ®çš„æŒ‡çº¹.ç”¨äºæ•°æ®å®Œæ•´æ€§æ ¡éªŒ</span><br><span class="line">    -<span class="ruby"> <span class="symbol">MD5:</span> <span class="number">32</span> byte</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> SHA-<span class="number">256</span>:</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> å“ˆå¸Œç®—æ³•æ ‡å‡†</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> æ­£å‘å¿«é€Ÿ:</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> é€†å‘å›°éš¾:</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> è¾“å…¥æ•æ„Ÿ:</span></span><br><span class="line"><span class="ruby"></span>    -<span class="ruby"> é¿å…ç¢°æ’:</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"># éå¯¹ç§°åŠ å¯†ç®—æ³•:</span><br><span class="line">  &gt; éå¯¹ç§°åˆ†ä¸ºå…¬é’¥å’Œç§é’¥, å…¬é’¥åŠ å¯† -&gt; ç§é’¥è§£å¯†; ç§é’¥åŠ å¯† -&gt; å…¬é’¥è§£å¯†</span><br><span class="line">  &gt; åŒºå—é“¾ä¸­ä½¿ç”¨çš„éå¯¹ç§°åŠ å¯†ç®—æ³•å¹¶ä¸æ˜¯ç›´æ¥ç”¨äºæ•°æ®åŠ å¯†ï¼Œè€Œæ˜¯ä¸»è¦ç”¨ä½œäº¤æ˜“ç­¾å, æ•°å­—ç­¾åé›†æˆäº†å“ˆå¸Œç®—æ³•ä¸éå¯¹ç§°åŠ å¯†ç®—æ³•çš„åŒé‡ç‰¹å¾ï¼Œåœ¨ä¿è¯äº¤æ˜“å®Œæ•´æ€§çš„åŒæ—¶ï¼Œè¯æ˜äº¤æ˜“å‘èµ·äººçš„èº«ä»½.</span><br><span class="line">  -<span class="ruby"> <span class="symbol">RSA:</span></span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> <span class="symbol">ECC:</span></span></span><br><span class="line"><span class="ruby"></span># å¯¹ç§°åŠ å¯†ç®—æ³•:</span><br><span class="line">  &gt; å¯¹ç§°è¡¨ç¤ºåŠ å¯†å’Œè§£å¯†éƒ½ä½¿ç”¨åŒä¸€å¥—å¯†é’¥</span><br><span class="line"># æ•°å­—ç­¾å:</span><br><span class="line">  &gt; åŒºå—é“¾ä¸­ä¸ç›´æ¥ä½¿ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œè€Œæ˜¯ä½¿ç”¨æ•°å­—ç­¾å</span><br></pre></td></tr></table></figure></li>
<li><p>ç½‘ç»œæ¨¡å‹</p>
<ul>
<li>å®¢æˆ·ç«¯/æœåŠ¡ç«¯æ¨¡å‹<figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> <span class="javascript">å®¢æˆ·ç«¯/æœåŠ¡ç«¯æ¨¡å‹ï¼šå±äºä¸­å¿ƒåŒ–çš„ç½‘ç»œæ¶æ„ï¼ŒæœåŠ¡èƒ½åŠ›å–å†³äºä¸­å¿ƒçš„æœåŠ¡å™¨</span></span><br></pre></td></tr></table></figure></li>
<li>ç‚¹å¯¹ç‚¹ç½‘ç»œæ¨¡å‹<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>ç½‘ç»œæ‹“æ‰‘ç»“æ„<ul>
<li>ä¸­å¿ƒç´¢å¼•èŠ‚ç‚¹<figure class="highlight"><table><tr><td class="code"><pre><span class="line">ä¸­å¿ƒç´¢å¼•èŠ‚ç‚¹ä¿å­˜æ‰€æœ‰èŠ‚ç‚¹çš„æ¥å…¥ä¿¡æ¯ï¼Œæ–°èŠ‚ç‚¹çš„åŠ å…¥å°†è‡ªèº«ä¿¡æ¯ä¼ å…¥ä¸­å¿ƒèŠ‚ç‚¹ï¼Œä»è€Œæ¢å–å·²åœ¨ç½‘ç»œä¸­å…¶ä»–èŠ‚ç‚¹çš„è¿æ¥ä¿¡æ¯, æœ‰å¯èƒ½å­˜åœ¨å•ç‚¹æ•…éšœçš„å¯èƒ½æ€§ï¼Œä¸€æ—¦ä¸­å¿ƒç´¢å¼•èŠ‚ç‚¹å®•æœºï¼Œæ–°èŠ‚ç‚¹å°†æ— æ³•åŠ å…¥ç½‘ç»œ</span><br></pre></td></tr></table></figure></li>
<li>æ— ä¸ºè€Œæ²»<figure class="highlight"><table><tr><td class="code"><pre><span class="line">æ–°èŠ‚ç‚¹é€‰æ‹©è¿æ¥ä¸€ä¸ªå·²å­˜åœ¨ç½‘ç»œä¸­çš„èŠ‚ç‚¹ï¼Œè¢«è¿æ¥çš„èŠ‚ç‚¹å¯ä»¥å‘ŠçŸ¥æ–°èŠ‚ç‚¹è¿æ¥çš„å…¶ä»–èŠ‚ç‚¹ä¿¡æ¯ï¼Œè¿™æ ·æ–°èŠ‚ç‚¹å¯ä»¥éšæœºé€‰æ‹©è¿æ¥å…¶ä»–èŠ‚ç‚¹</span><br></pre></td></tr></table></figure></li>
<li>æ•´ä½“åˆ†æ•£å±€éƒ¨é›†ä¸­çš„æ··åˆç»“æ„<figure class="highlight"><table><tr><td class="code"><pre><span class="line">æ•´ä¸ªç½‘ç»œç”±å¤šä¸ªç§å­èŠ‚ç‚¹å½¢æˆä¸»å¹²ç½‘ç»œï¼Œå…¶ä»–æ™®é€šèŠ‚ç‚¹åˆ™è¿æ¥åˆ°æŸä¸ªå­èŠ‚ç‚¹ï¼Œå°±å½¢æˆæ•´ä½“åˆ†æ•£å±€éƒ¨é›†ä¸­çš„æ··åˆç»“æ„</span><br></pre></td></tr></table></figure></li>
<li>æœ‰åºç»“æ„åŒ–ç½‘ç»œ<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>åŒºå—é“¾ç½‘ç»œæ‹“æ‰‘:<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> BTC</span></span><br><span class="line"><span class="meta">  &gt;</span><span class="bash"> é‡‡ç”¨æ··åˆå‹çš„ç½‘ç»œæ‹“æ‰‘ç»“æ„ï¼Œä¸€ä¸ªæ–°èŠ‚ç‚¹çš„åŠ å…¥éœ€è¦ç»™èŠ‚ç‚¹æŒ‡å®šå‡ ä¸ªå·²åœ¨BTCç½‘ç»œä¸­çš„ç›¸é‚»èŠ‚ç‚¹(æ™®é€šèŠ‚ç‚¹æˆ–ç§å­èŠ‚ç‚¹)ä¿¡æ¯, å½“å»ºç«‹èŠ‚ç‚¹é—´è¿æ¥ä»¥åï¼Œæ–°èŠ‚ç‚¹å°†è‡ªèº«ä¿¡æ¯å‘é€ç»™ç›¸é‚»èŠ‚ç‚¹ï¼Œç›¸é‚»èŠ‚ç‚¹å†å°†æ–°èŠ‚ç‚¹çš„ä¿¡æ¯ä¾æ¬¡è½¬å‘ç»™å„è‡ªç›¸é‚»èŠ‚ç‚¹ï¼Œä»è€Œé€‰æ‹©æ€§è¿æ¥æ›´å¤šèŠ‚ç‚¹ï¼Œå¢å¼ºèŠ‚ç‚¹è‡ªèº«ä¸æ•´ä½“ç½‘ç»œè¿æ¥çš„ç¨³å®šæ€§</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ETC</span></span><br><span class="line"><span class="meta">  &gt;</span><span class="bash"> ä»¥å¤ªåŠé‡‡ç”¨ç»“æ„åŒ–ç½‘ç»œæ‹“æ‰‘ï¼ŒåŸºäºåˆ†å¸ƒå¼å“ˆå¸Œè¡¨Kademliaç®—æ³•ã€‚</span></span><br><span class="line"><span class="meta">  &gt;</span><span class="bash"> èŠ‚ç‚¹é—´çš„è·ç¦»æ˜¯é€»è¾‘è·ç¦»ï¼Œè€Œéç‰©ç†è·ç¦».</span></span><br></pre></td></tr></table></figure></li>
<li>äº¤æ˜“æ‰©æ•£<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="quote">&gt; Gossip å…«å¦åè®®:</span></span><br><span class="line"><span class="bullet">-</span> ETC: ä»¥å¤ªåŠç½‘ç»œçš„èŠ‚ç‚¹åªä¸è‡ªå·±æœ€è¿‘è·ç¦»çš„ç›¸é‚»èŠ‚ç‚¹è¿æ¥ï¼Œäº¤æ˜“çš„æ‰©æ•£ä¸å­˜åœ¨å›è·¯çš„å¯èƒ½æ€§ï¼Œæ‰©æ•£æ›´åƒæ˜¯ä¸€ç§æŒç»­å‘å¤–å¹¿æ’­ã€‚äº¤æ˜“ä¼šé€æ¸è¿œç¦»æœ€åˆçš„èŠ‚ç‚¹ï¼Œäº¤æ˜“æ‰©æ•£æ•ˆç‡è¾ƒé«˜</span><br><span class="line"><span class="bullet">-</span> BTC: ç½‘ç»œæ‹“æ‰‘æ˜¯éšæœºçš„ï¼Œäº¤æ˜“æ‰©æ•£æ˜¯æ‰©æ•£åˆ°è¿æ¥èŠ‚ç‚¹ï¼Œæ‰©æ•£å‰æ— æ³•æŒ‡å¯¼å¯¹æ–¹æ˜¯å¦å·²ç»æ¥æ”¶åˆ°ç›¸åŒçš„äº¤æ˜“ï¼Œç½‘ç»œæ‰©æ•£çš„æ•ˆç‡è¾ƒä½</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>å…±è¯†ç®—æ³•</p>
<figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> <span class="javascript">å…±è¯†ç®—æ³•çš„åŸºç¡€æ˜¯å°‘æ•°æœä»å¤šæ•°</span></span><br><span class="line"><span class="meta">&gt;</span> <span class="javascript">åŒºå—é“¾å¼•å…¥å…±è¯†ç®—æ³•ä¿è¯èŠ‚ç‚¹é—´çŠ¶æ€çš„ä¸€è‡´</span></span><br><span class="line"><span class="meta">&gt;</span> <span class="javascript">åŒºå—é“¾ä¸­å¯¹çŠ¶æ€çš„å…±è¯†å®è´¨å°±æ˜¯å¯¹åŒºå—çš„å…±è¯†, åªè¦åŒºå—ä¸€è‡´çŠ¶æ€å°±ä¸€å®šä¸€è‡´</span></span><br><span class="line"># æ‹œå åº­å°†å†›é—®é¢˜:</span><br></pre></td></tr></table></figure>
<ul>
<li>æ¿€åŠ±å…±è¯†:<ul>
<li>PoW - å·¥ä½œé‡è¯æ˜ç®—æ³•<figure class="highlight erlang-repl"><table><tr><td class="code"><pre><span class="line">åˆ©ç”¨å“ˆå¸Œç®—æ³•è®¡ç®—åŒºå—å“ˆå¸Œï¼Œä½¿å¾—åŒºå—å“ˆå¸Œä»¥Nä¸ª<span class="number">0</span>å¼€å¤´,</span><br><span class="line">æ¯”ç‰¹å¸ç½‘ç»œå…è®¸æœ‰å¤šæ¡åŒºå—é“¾å­˜åœ¨ï¼Œä½†åªè®¤åŒèŠ‚ç‚¹èƒ½æ¥æ”¶åˆ°çš„æœ€é•¿çš„é‚£æ¡åŒºå—é“¾æ˜¯å…¨ç½‘ç½‘ç»œå…±è¯†çš„é“¾</span><br><span class="line">å¯¹æ¯”ç‰¹å¸ç½‘ç»œçš„ç¯¡æ”¹ï¼Œå®è´¨æ˜¯å¯¹è®¡ç®—èµ„æº(ç®—åŠ›)çš„äº‰å¤ºï¼Œè°æ‹¥æœ‰æ›´å¤šçš„è®¡ç®—èµ„æºï¼Œç¡çš„è¯è¯­æƒå°±å¤§ï¼Œå°±æ˜¯é€šå¸¸å¬åˆ°çš„<span class="number">51</span><span class="comment">%æ”»å‡»</span></span><br></pre></td></tr></table></figure></li>
<li>PoS - æƒç›Šè¯æ˜ç®—æ³•</li>
<li>DPos - å§”æ‰˜æƒç›Šè¯æ˜ç®—æ³•</li>
</ul>
</li>
<li>BPFT - æ‹œå åº­å®¹é”™ç®—æ³•<figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> <span class="javascript">åªè¦å…±è¯†ç½‘ç»œä¸­ä½œæ¶èŠ‚ç‚¹çš„æ•°é‡æœªè¶…è¿‡æ€»èŠ‚ç‚¹æ•°çš„<span class="number">1</span>/<span class="number">3</span>ï¼Œå…±è¯†ä¾æ—§å¯ä»¥è¾¾æˆ</span></span><br><span class="line"><span class="meta">&gt;</span> <span class="javascript">BFTç±»çš„å…±è¯†ç®—æ³•ä¸»è¦ç”¨åœ¨è”ç›Ÿé“¾ä¸­ï¼Œå› ä¸ºè”ç›Ÿé“¾ä¸»è¦å‚ä¸å¯¹è±¡æ˜¯ä¼ä¸šï¼Œæœ‰å‡†å…¥æœºåˆ¶çš„å­˜åœ¨ï¼Œä¸€æ¡é“¾çš„å‚ä¸æ–¹ä¸ä¼šå¾ˆå¤šä¹Ÿå¾ˆå°‘å­˜åœ¨åŠ¨æ€å¢åˆ èŠ‚ç‚¹çš„æƒ…å½¢</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="æ™ºèƒ½åˆçº¦"><a href="#æ™ºèƒ½åˆçº¦" class="headerlink" title="æ™ºèƒ½åˆçº¦"></a>æ™ºèƒ½åˆçº¦</h2><pre><code><figure class="highlight"><table><tr><td class="code"><pre><span class="line">ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„åˆåŒåè®®çš„çº¦æŸåŠ›æ¥è‡ªäºæƒå¨æœºæ„èƒŒä¹¦</span><br><span class="line">æ™ºèƒ½åˆçº¦å®è´¨æ˜¯ä¸€æ®µè®¡ç®—æœºç¨‹åºä»£ç </span><br><span class="line">æ™ºèƒ½åˆçº¦çš„æ ‡å‡†åŒ–æ˜¯ä»·å€¼ç½‘ç»œè½åœ°çš„å‰æ</span><br></pre></td></tr></table></figure>
- NTF - éåŒè´¨åŒ–ä»£å¸
<figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> <span class="javascript">NTF - ä¸€ç§æ‰‹æ®µå°†è™šæ‹Ÿä¸ç°å®çš„ä»·å€¼é”šå®š.</span></span><br></pre></td></tr></table></figure>
- å…ƒå®‡å®™
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">å…ƒå®‡å®™ä»£è¡¨çš„æ˜¯ä¸€ä¸ªæ²‰æµ¸å¼çš„è™šæ‹Ÿä¸–ç•Œï¼Œç©å®¶èƒ½åœ¨å…¶ä¸­è¿›è¡Œæ–‡åŒ–ã€ç¤¾äº¤ã€å¨±ä¹ç­‰æ´»åŠ¨</span><br><span class="line">å…ƒå®‡å®™æ˜¯ç”±åŒºå—é“¾ã€æ¸¸æˆã€ç½‘ç»œå’Œæ˜¾ç¤ºå››å¤§æŠ€æœ¯èåˆè€Œæˆçš„è™šæ‹Ÿä¸–ç•Œ</span><br></pre></td></tr></table></figure>
</code></pre>
<h2 id="é‡å­è®¡ç®—"><a href="#é‡å­è®¡ç®—" class="headerlink" title="é‡å­è®¡ç®—"></a>é‡å­è®¡ç®—</h2><ul>
<li>ç»å…¸è®¡ç®—æœºä¸é‡å­è®¡ç®—æœºå­˜å‚¨æ•°æ®åŒºåˆ«<figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> <span class="javascript">ç»å…¸è®¡ç®—æœºå­˜å‚¨å…·ä½“çš„å€¼</span></span><br><span class="line"><span class="meta">&gt;</span> <span class="javascript">é‡å­è®¡ç®—å­˜å‚¨å€¼çš„æ¦‚ç‡</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="åŒºå—é“¾"><a href="#åŒºå—é“¾" class="headerlink" title="åŒºå—é“¾+"></a>åŒºå—é“¾+</h2><ul>
<li>å¯ä¿¡ä¸Šé“¾<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">1.ç¡®ä¿åŒºå—é“¾ä¸Šé“¾æ•°æ®çš„çœŸå®æ€§?</span><br><span class="line"><span class="bullet">  -</span> æƒå¨æœºæ„çš„ä¿¡æ¯å‘å¸ƒ</span><br><span class="line"><span class="bullet">  -</span> æ‘†è„±æ•°æ®çš„è®¤ä¸ºå¹²é¢„</span><br></pre></td></tr></table></figure></li>
<li>é¢„è¨€æœº<figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> <span class="javascript">å°†å¤–ç•ŒçœŸå®çš„ä¿¡æ¯è¾“å…¥åˆ°åŒºå—é“¾ç½‘ç»œä¸­ï¼Œå®ç°é“¾å¤–ä¸é“¾å†…çš„æ•°æ®äº’é€š.</span></span><br></pre></td></tr></table></figure></li>
<li>5G ç‰©è”ç½‘<figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> <span class="javascript">5G ä¾æ‰˜å…¨æ–°çš„ç½‘ç»œæ¶æ„ï¼Œå…·å¤‡é«˜é€Ÿç‡ã€ä½å»¶è¿Ÿã€é«˜å¯é æ€§ã€å¤§å¸¦å®½ç­‰ä¼˜åŠ¿ï¼Œå¯ä»¥æ»¡è¶³äººä¸äººä¹‹é—´çš„é€šä¿¡éœ€æ±‚ï¼Œè§£å†³ç‰©ä¸ç‰©çš„é€šä¿¡è¿æ¥é—®é¢˜.</span></span><br></pre></td></tr></table></figure></li>
<li>æ•°å­—äººæ°‘å¸<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="quote">&gt; æ•°å­—äººæ°‘å¸æ˜¯ä¸­å›½äººæ°‘é“¶è¡Œå‘è¡Œçš„æ³•å®šè´§å¸çš„æ•°å­—åŒ–ï¼Œæ˜¯ç”±å›½å®¶ä¿¡ç”¨åœ¨èƒŒåä½œæ”¯æ’‘ï¼Œå…¶å‘è¡Œæƒå±äºå›½å®¶.</span></span><br><span class="line"><span class="quote">&gt; æ•°å­—äººæ°‘å¸çš„å®šä½æ˜¯ç°é‡‘ç±»æ”¯ä»˜å‡­è¯ï¼Œæ„å‘³ç€æ•°å­—äººæ°‘å¸å’Œçº¸å¸ã€ç¡¬å¸çš„å®šä½æ˜¯ä¸€è‡´çš„</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> ä¸è®¡åˆ©æ¯</span><br><span class="line"><span class="bullet">-</span> æ— æ‰‹ç»­è´¹</span><br><span class="line"><span class="bullet">-</span> å¯æ§åŒ¿å: å°é¢åŒ¿åã€å¤§é¢ä¾æ³•å¯æº¯</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> æ•°å­—äººæ°‘å¸çš„å‘è¡Œæ˜¯ä¸æ¯”ä½¿ç”¨åŒºå—é“¾æŠ€æœ¯çš„</span><br></pre></td></tr></table></figure></li>
<li>æ•°å­—ç¤¾ä¼š<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> äº‘è®¡ç®—:</span><br><span class="line"><span class="bullet">  -</span> äº‘è®¡ç®—åˆ©ç”¨è™šæ‹ŸåŒ–æŠ€æœ¯å°†ç‰©ç†æœåŠ¡å™¨ã€å­˜å‚¨å’Œç½‘ç»œç­‰ç¡¬ä»¶ä»¥æœåŠ¡çš„å½¢å¼æä¾›ç»™ç”¨æˆ·ä½¿ç”¨</span><br><span class="line"><span class="bullet">-</span> åŒºå—é“¾:</span><br><span class="line"><span class="bullet">  -</span> åŒºå—é“¾ä¸äº‘è®¡ç®—çš„ç»“åˆå‚¬ç”Ÿå‡ºåŒºå—é“¾å³æœåŠ¡å¹³å°</span><br><span class="line"><span class="bullet">  -</span> Baas, Blockchain as a Service</span><br><span class="line"><span class="bullet">  -</span> Paas, Platform as a service</span><br><span class="line"><span class="bullet">-</span> å¤§æ•°æ®:</span><br><span class="line"><span class="bullet">  -</span> Volume: æ•°æ®é‡å¤§ï¼Œé€šè¿‡å¤§æ•°æ®çš„æ•°æ®é‡æ˜¯ä»¥TBï¼ŒPBæ¥è®¡ç®—</span><br><span class="line"><span class="bullet">  -</span> Volocity: é«˜é€Ÿ, å¤§æ•°æ®éœ€è¦ç”¨è¾ƒé«˜çš„é€Ÿåº¦æ¥æ”¶ç”šè‡³æ˜¯å¤„ç†æ•°æ®</span><br><span class="line"><span class="bullet">  -</span> Variety: å¤šæ ·æ€§, å¤§æ•°æ®çš„æ•°æ®æºå¾ˆå¤šï¼Œä¸”å¤§å¤šæ•°å±äºéç»“æ„åŒ–çš„æ•°æ®</span><br><span class="line"><span class="bullet">  -</span> Value: ä»·å€¼, å¤§æ•°æ®æ‰€é¢å¯¹çš„æ•°æ®æ˜¯æµ·é‡çš„ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®éƒ½æœ‰ä»·å€¼ï¼Œéœ€è¦é€šè¿‡æ•°æ®æ¸…æ´—ã€è¿‡æ»¤å‡ºæœ‰ä»·å€¼çš„æ•°æ®</span><br><span class="line"><span class="bullet">  -</span> Veracity: çœŸå®, éœ€è¦ä¿è¯æ•°æ®çš„çœŸå®æ€§ã€å‡†ç¡®æ€§ï¼Œæ‰èƒ½æé«˜æ•°æ®è´¨é‡</span><br><span class="line"><span class="bullet">-</span> äººå·¥æ™ºèƒ½:</span><br><span class="line"><span class="bullet">  -</span> è¯­éŸ³è¯†åˆ«</span><br><span class="line"><span class="bullet">  -</span> å›¾åƒè¯†åˆ«</span><br><span class="line"><span class="bullet">  -</span> è‡ªç„¶è¯­è¨€å¤„ç†</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>Blockchain</tag>
        <tag>åŒºå—é“¾</tag>
      </tags>
  </entry>
  <entry>
    <title>Raspberry Pico Intro</title>
    <url>/2021/09/17/Raspberry-Pico-Intro/</url>
    <content><![CDATA[<h1 id="Raspberry-Pi-Pico"><a href="#Raspberry-Pi-Pico" class="headerlink" title="Raspberry Pi Pico"></a>Raspberry Pi Pico</h1><blockquote>
<p>a microcontroller development board,</p>
</blockquote>
<ul>
<li><p>RP2040</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="quote">&gt; new microcontroller chip designed by Raspberry Pi in the UK.</span></span><br><span class="line"><span class="bullet">  -</span> dual-core Arm Cortex-M0+</span><br><span class="line"><span class="bullet">  -</span> 264KB RAM</span><br><span class="line"><span class="bullet">  -</span> 16MB off-chip Flash</span><br></pre></td></tr></table></figure></li>
<li><p>Micro USB Port</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">- provide power make Pico <span class="builtin-name">run</span></span><br><span class="line">- USB<span class="built_in"> port </span>talk <span class="keyword">to</span> pico</span><br></pre></td></tr></table></figure></li>
<li><p>BOOTSEL</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">- <span class="keyword">BOOTSEL </span>is <span class="keyword">short </span>for <span class="keyword">boot </span>selection.</span><br></pre></td></tr></table></figure></li>
</ul>
<span id="more"></span>

<h2 id="Raspberry-Picoâ€™s-pins"><a href="#Raspberry-Picoâ€™s-pins" class="headerlink" title="Raspberry Picoâ€™s pins"></a>Raspberry Picoâ€™s pins</h2><p><img src="/misc/images/pico-pins.png" alt="The Raspberry Pi Pico&#39;s pins"></p>
<ul>
<li><p>Raspberry Pi Pico pins functions</p>
<table>
<thead>
<tr>
<th align="left">â€¦</th>
<th align="left">â€¦</th>
<th align="left">â€¦</th>
</tr>
</thead>
<tbody><tr>
<td align="left">3V3</td>
<td align="left">3.3 volts power</td>
<td align="left">Pico 3.3V ä» VSYS è·å–</td>
</tr>
<tr>
<td align="left">VSYS</td>
<td align="left">~2-5 volts power</td>
<td align="left">è¿æ¥Picoå†…éƒ¨ç”µæº</td>
</tr>
<tr>
<td align="left">VBUS</td>
<td align="left">5 volts power</td>
<td align="left">5V power taken from Picoâ€™s micro USB port</td>
</tr>
<tr>
<td align="left">GND</td>
<td align="left">0 volts ground</td>
<td align="left">åœ°</td>
</tr>
<tr>
<td align="left">GPxx</td>
<td align="left">General-purpose input/output pin</td>
<td align="left">é€šç”¨GPIOå£</td>
</tr>
<tr>
<td align="left">GPxx_ADCx</td>
<td align="left">GPIO/ADC input</td>
<td align="left">æ™®é€šGPIOå£æˆ–ADCè¾“å…¥å£</td>
</tr>
<tr>
<td align="left">ADC_VREF</td>
<td align="left">Analogue-to-digital coverter (ADC) voltage reference</td>
<td align="left">æ¨¡æ‹Ÿæ•°å­—è½¬æ¢å‚è€ƒç”µå‹è¾“å…¥</td>
</tr>
<tr>
<td align="left">AGND</td>
<td align="left">Anaglogue-to-digital coverter (ADC) 0 volts ground</td>
<td align="left">ADCè¾“å…¥ç”µå‹å‚è€ƒ0volts</td>
</tr>
<tr>
<td align="left">RUN</td>
<td align="left">Enable/disable Pico</td>
<td align="left">å¯åŠ¨/å…³é—­Pico</td>
</tr>
</tbody></table>
</li>
<li><p>MicroPython - Hello, LED!</p>
<figure class="highlight vhdl"><table><tr><td class="code"><pre><span class="line">import machine</span><br><span class="line">import utime</span><br><span class="line"></span><br><span class="line"># <span class="keyword">on</span>-board LED <span class="keyword">is</span> connected <span class="keyword">to</span> one <span class="keyword">of</span> RP2040<span class="symbol">&#x27;s</span> general-purpose input/output pins. GP25.</span><br><span class="line">led_onboard = machine.Pin(<span class="number">25</span>, machine.Pin.<span class="keyword">OUT</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    led_onboard.toggle()</span><br><span class="line">    utime.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="MicroPython-on-Raspberry-Pi-Pico"><a href="#MicroPython-on-Raspberry-Pi-Pico" class="headerlink" title="MicroPython on Raspberry Pi Pico"></a>MicroPython on Raspberry Pi Pico</h2><ul>
<li><p>Installing MicroPython</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">&gt; MicroPython is <span class="keyword">a</span> full implementation <span class="keyword">of</span> <span class="keyword">the</span> Python <span class="number">3</span> Programming language that runs directly <span class="keyword">on</span> <span class="title">embedded</span> <span class="title">hardware</span> <span class="title">like</span> <span class="title">Raspberry</span> <span class="title">Pi</span> <span class="title">Pico</span>.</span><br><span class="line"><span class="comment"># Hold BOOTSEL button down 3 seconds then let go</span></span><br><span class="line">  /Volumes/RPI-RP2</span><br><span class="line">  âœ tree</span><br><span class="line">  .</span><br><span class="line">  â”œâ”€â”€ INDEX.HTM</span><br><span class="line">  â””â”€â”€ INFO_UF2.TXT  <span class="comment">-- hold information about your Pico</span></span><br><span class="line"></span><br><span class="line">  <span class="number">0</span> <span class="built_in">directories</span>, <span class="number">2</span> <span class="built_in">files</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Darg-and-Drop MicroPython</span></span><br><span class="line">  - Drag <span class="keyword">and</span> drop <span class="keyword">the</span> MicroPython UF2 onto <span class="keyword">the</span> RPI-RP2 volume, auto flash <span class="keyword">the</span> firmware onto its internal storage.</span><br></pre></td></tr></table></figure></li>
<li><p>Programming with MicroPython</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&gt; MicroPython <span class="keyword">is</span> a Python-compatible programming language developed specifically <span class="keyword">for</span> microcontrollers.</span><br><span class="line"></span><br><span class="line"><span class="comment"># Thonny - IDE</span></span><br><span class="line">MicroPython v1<span class="number">.17</span> on <span class="number">2021</span>-09-02; Raspberry Pi Pico <span class="keyword">with</span> RP2040</span><br><span class="line"><span class="type">Type</span> <span class="string">&quot;help()&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">Hello, World!</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Rust-on-Raspberry-Pi-Pico"><a href="#Rust-on-Raspberry-Pi-Pico" class="headerlink" title="Rust on Raspberry Pi Pico"></a>Rust on Raspberry Pi Pico</h2><h2 id="Getting-Started-with-FreeRTOS-on-the-Raspberry-Pi-Pico"><a href="#Getting-Started-with-FreeRTOS-on-the-Raspberry-Pi-Pico" class="headerlink" title="Getting Started with FreeRTOS on the Raspberry Pi Pico"></a>Getting Started with FreeRTOS on the Raspberry Pi Pico</h2><blockquote>
<p>RTOS - Real Time Operating System</p>
<blockquote>
<p>Allows multiple tasks to execute â€œat the same timeâ€<br>Schedules based on task priority<br>â€œTask Priorityâ€ allows the programmer to define what needs to happen first</p>
</blockquote>
</blockquote>
]]></content>
      <tags>
        <tag>åµŒå…¥å¼</tag>
        <tag>Raspberry Pi</tag>
      </tags>
  </entry>
  <entry>
    <title>Dell PowerEdge R720 Intro</title>
    <url>/2021/09/18/Dell-PowerEdge-R720-Intro/</url>
    <content><![CDATA[<h1 id="Dell-EMC-PowerEdge-R720"><a href="#Dell-EMC-PowerEdge-R720" class="headerlink" title="Dell EMC PowerEdge R720"></a>Dell EMC PowerEdge R720</h1><span id="more"></span>

<h2 id="Dell-iDRAC"><a href="#Dell-iDRAC" class="headerlink" title="Dell iDRAC"></a>Dell iDRAC</h2><figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> <span class="javascript">iDRAC (Integrated Dell Remote Access Controller) è¿œç¨‹æ§åˆ¶å¡, iDRACç›¸å½“äºé™„åŠ åœ¨æœåŠ¡å™¨ä¸Šè®¡ç®—æœºï¼Œå¯ä»¥å®ç°ä¸€å¯¹ä¸€çš„æœåŠ¡å™¨è¿œç¨‹ç®¡ç†ä¸ç›‘æ§ï¼Œé€šè¿‡ä¸æœåŠ¡å™¨ä¸»æ¿ä¸Šçš„ç®¡ç†èŠ¯ç‰‡BMCè¿›è¡Œé€šä¿¡,ç›‘æ§å’Œç®¡ç†æœåŠ¡å™¨çš„ç¡¬ä»¶çŠ¶æ€ä¿¡æ¯ï¼Œæ‹¥æœ‰è‡ªå·±çš„ç³»ç»Ÿå’ŒIPåœ°å€ï¼Œä¸æœåŠ¡å™¨ä¸Šçš„OSæ— å…³,æ˜¯ç®¡ç†å‘˜è¿›è¡Œè¿œç¨‹è®¿é—®å’Œç®¡ç†çš„åˆ©å™¨.</span></span><br><span class="line"><span class="meta">&gt;</span> <span class="javascript">iDRACç™»é™†ç•Œé¢é»˜è®¤çš„ç”¨æˆ·åæ˜¯rootå¯†ç calvin</span></span><br></pre></td></tr></table></figure>

<h2 id="vSphere-ESXi-vCenter-åŒºåˆ«"><a href="#vSphere-ESXi-vCenter-åŒºåˆ«" class="headerlink" title="vSphere,ESXi,vCenter åŒºåˆ«"></a>vSphere,ESXi,vCenter åŒºåˆ«</h2><ul>
<li>VMware Inc. è½¯ä»¶å…¬å¸æä¾›åŒ…æ‹¬äº‘äº§å“ï¼Œæ•°æ®ä¸­å¿ƒäº§å“å’Œæ¡Œé¢äº§å“</li>
<li>vSphere<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">æ•°æ®ä¸­å¿ƒäº§å“ä¸‹çš„ä¸€å¥—è½¯ä»¶, åŒ…æ‹¬vCenter, EXSiå’ŒvSphere <span class="keyword">client</span>, vSphereä¸æ˜¯ä¸€ä¸ªå¯ä»¥å®‰è£…ä½¿ç”¨çš„è½¯ä»¶ï¼Œåªæ˜¯ä¸€ä¸ªåŒ…å«å…¶ä»–ç»„ä»¶çš„é›†åˆ.</span><br></pre></td></tr></table></figure></li>
<li>vSphere client<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">vSphere <span class="keyword">client</span>å…è®¸ç®¡ç†å‘˜è®¿é—®ESXiæœåŠ¡å¹¶ç®¡ç†è™šæ‹Ÿæœºã€‚vSphere <span class="keyword">client</span>æ˜¯å®‰è£…åœ¨å®¢æˆ·ç«¯ä¸Šé¢ï¼ŒvSphere <span class="keyword">client</span>ç”¨æ¥è¿æ¥ESXiæœåŠ¡å™¨å’Œç®¡ç†ä»»åŠ¡, ç”¨æ¥è®¿é—®ESXiæœåŠ¡å®‰è£…å’Œç®¡ç†ä¸Šé¢çš„è™šæ‹Ÿæœº</span><br><span class="line">vSphere <span class="keyword">client</span>å¯ä»¥åœ¨å°ç¯å¢ƒä¸­ç›´æ¥ç®¡ç†ESXiæœåŠ¡ï¼Œå¯ä»¥åœ¨å¤§è§„æ¨¡çš„ç¯å¢ƒä¸­ï¼Œé€šè¿‡vCenteræœåŠ¡é—´æ¥ç®¡ç†ESXiæœåŠ¡</span><br></pre></td></tr></table></figure></li>
<li>EXSi<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">ESXiæ˜¯è™šæ‹ŸåŒ–æœåŠ¡ï¼Œæ‰€æœ‰çš„è™šæ‹Ÿæœºéƒ½è¿è¡Œåœ¨ESXiæœåŠ¡ä¸Šé¢,ä¸ºäº†å®‰è£…ï¼Œç®¡ç†å’Œè®¿é—®è™šæ‹Ÿæœºï¼Œéœ€è¦vSphere clientæˆ–vCenter.</span><br><span class="line">ESXiå®‰è£…åœ¨ç‰©ç†æœºä¸Šé¢çš„æœåŠ¡.</span><br></pre></td></tr></table></figure></li>
<li>vCenter server<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">VMware vCenter <span class="keyword">server</span>æ˜¯ä¸€ä¸ªä¼ä¸šçº§åˆ«çš„äº§å“, ä¸­å¿ƒåŒ–çš„ç®¡ç†åº”ç”¨ï¼Œå¯ä»¥é€šè¿‡ç®¡ç†æ‰€æœ‰çš„è™šæ‹Ÿæœºå’ŒESXiç‰©ç†æœº</span><br><span class="line">vCenteræœåŠ¡ç”¨åœ¨æœ‰å¾ˆå¤šEXSiæœåŠ¡å’Œè®¸å¤šè™šæ‹Ÿæœºçš„å¤§è§„æ¨¡ç¯å¢ƒä¸­</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Install-Ubuntu-20-04-on-R720"><a href="#Install-Ubuntu-20-04-on-R720" class="headerlink" title="Install Ubuntu 20.04 on R720"></a>Install Ubuntu 20.04 on R720</h2><ul>
<li>Show Hardware and Network Infomation<figure class="highlight tcl"><table><tr><td class="code"><pre><span class="line">chyiyaqing in ~ at chyiyaqing-PowerEdge-R720</span><br><span class="line">âœ wget -qO- bench.sh | bash</span><br><span class="line"></span><br><span class="line">grep: /<span class="keyword">proc</span>/1/environ:<span class="title"> Permission</span> denied</span><br><span class="line">----------------------------------------------------------------------<span class="title"></span></span><br><span class="line"><span class="title"> CPU</span> Model             :<span class="title"> Intel(R)</span> Xeon(R)<span class="title"> CPU</span> E5-2650<span class="title"> v2</span> @ 2.60GHz<span class="title"></span></span><br><span class="line"><span class="title"> CPU</span> Cores             : 32<span class="title"></span></span><br><span class="line"><span class="title"> CPU</span> Frequency         : 1204.573<span class="title"> MHz</span></span><br><span class="line"><span class="title"> CPU</span> Cache             : 20480<span class="title"> KB</span></span><br><span class="line"><span class="title"> Total</span> Disk            : 1127.3<span class="title"> GB</span> (9.2<span class="title"> GB</span> Used)<span class="title"></span></span><br><span class="line"><span class="title"> Total</span> Mem             : 32106<span class="title"> MB</span> (1015<span class="title"> MB</span> Used)<span class="title"></span></span><br><span class="line"><span class="title"> Total</span> Swap            : 2047<span class="title"> MB</span> (0<span class="title"> MB</span> Used)<span class="title"></span></span><br><span class="line"><span class="title"> System</span> uptime         : 0<span class="title"> days,</span> 0<span class="title"> hour</span> 22<span class="title"> min</span></span><br><span class="line"><span class="title"> Load</span> average          : 0.07, 0.09, 0.17<span class="title"></span></span><br><span class="line"><span class="title"> OS</span>                    :<span class="title"> Ubuntu</span> 20.04.3<span class="title"> LTS</span></span><br><span class="line"><span class="title"> Arch</span>                  :<span class="title"> x86_64</span> (64<span class="title"> Bit)</span></span><br><span class="line"><span class="title"> Kernel</span>                : 5.11.0-36-generic<span class="title"></span></span><br><span class="line"><span class="title"> TCP</span> CC                :<span class="title"> cubic</span></span><br><span class="line"><span class="title"> Virtualization</span>        :<span class="title"> Dedicated</span></span><br><span class="line">----------------------------------------------------------------------<span class="title"></span></span><br><span class="line"><span class="title"> I/O</span> Speed(1st<span class="title"> run)</span>    : 323<span class="title"> MB/s</span></span><br><span class="line"><span class="title"> I/O</span> Speed(2nd<span class="title"> run)</span>    : 267<span class="title"> MB/s</span></span><br><span class="line"><span class="title"> I/O</span> Speed(3rd<span class="title"> run)</span>    : 275<span class="title"> MB/s</span></span><br><span class="line"><span class="title"> Average</span> I/O<span class="title"> speed</span>     : 288.3<span class="title"> MB/s</span></span><br><span class="line">----------------------------------------------------------------------<span class="title"></span></span><br><span class="line"><span class="title"> Node</span> Name<span class="title">        Upload</span> Speed<span class="title">      Download</span> Speed<span class="title">      Latency</span></span><br><span class="line"><span class="title"> Shanghai</span> <span class="title">  CT</span>    49.45<span class="title"> Mbps</span>        256.81<span class="title"> Mbps</span>         9.34<span class="title"> ms</span></span><br><span class="line"><span class="title"> Shanghai</span> <span class="title">  CU</span>    50.03<span class="title"> Mbps</span>        263.91<span class="title"> Mbps</span>         17.96<span class="title"> ms</span></span><br><span class="line"><span class="title"> Guangzhou</span> <span class="title"> CT</span>    55.97<span class="title"> Mbps</span>        264.49<span class="title"> Mbps</span>         35.69<span class="title"> ms</span></span><br><span class="line"><span class="title"> Guangzhou</span> <span class="title"> CU</span>    50.19<span class="title"> Mbps</span>        257.02<span class="title"> Mbps</span>         31.51<span class="title"> ms</span></span><br><span class="line">----------------------------------------------------------------------</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>Rust language Intro</title>
    <url>/2021/09/18/Rust-language-Intro/</url>
    <content><![CDATA[]]></content>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetes Intro</title>
    <url>/2021/09/19/Kubernetes-Intro/</url>
    <content><![CDATA[<h1 id="Kubernetes"><a href="#Kubernetes" class="headerlink" title="Kubernetes"></a>Kubernetes</h1><h2 id="å®¹å™¨åŸºç¡€"><a href="#å®¹å™¨åŸºç¡€" class="headerlink" title="å®¹å™¨åŸºç¡€"></a>å®¹å™¨åŸºç¡€</h2><blockquote>
<p>å®¹å™¨æŠ€æœ¯çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå°±æ˜¯é€šè¿‡çº¦æŸå’Œä¿®æ”¹è¿›ç¨‹çš„åŠ¨æ€è¡¨ç°ï¼Œä»è€Œä¸ºå…¶åˆ›å»ºå‡ºä¸€ä¸ªâ€œè¾¹ç•Œâ€<br>å®¹å™¨ï¼Œå…¶å®æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿›ç¨‹è€Œå·²</p>
</blockquote>
<ul>
<li>Cgroups: åˆ¶é€ çº¦æŸ</li>
<li>Namespace: ä¿®æ”¹è¿›ç¨‹è§†å›¾<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">&gt; NamespaceæŠ€æœ¯å®é™…ä¸Šä¿®æ”¹åº”ç”¨ç¨‹åºçœ‹å¾…æ•´ä¸ªè®¡ç®—æœº<span class="string">&quot;è§†å›¾&quot;</span>,å³å®ƒçš„<span class="string">&quot;è§†çº¿&quot;</span>è¢«æ“ä½œç³»ç»Ÿåšäº†é™åˆ¶ï¼Œåªèƒ½<span class="string">&quot;çœ‹åˆ°&quot;</span>æŸäº›æŒ‡å®šçš„å†…å®¹.</span><br><span class="line"><span class="comment">// æ–°åˆ›å»ºçš„è¿›ç¨‹â€œçœ‹åˆ°â€å…¨æ–°çš„è¿›ç¨‹ç©ºé—´,</span></span><br><span class="line"><span class="keyword">int</span> pid = clone(main_function, stack_size, <span class="built_in">CLONE_NEWPID</span> | SIGCHLD, <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure></li>
<li>å®¹å™¨åŒ–<figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"> &gt; Dockerdå®é™…ä¸Šæ˜¯åœ¨åˆ›å»ºå®¹å™¨è¿›ç¨‹æ—¶ï¼ŒæŒ‡å®šè¿›ç¨‹æ‰€éœ€è¦å¯åŠ¨çš„ä¸€ç»„Namespaceå‚æ•°ï¼Œè¿™æ ·ï¼Œå®¹å™¨åªèƒ½â€œçœ‹â€åˆ°å½“å‰Namespaceæ‰€é™å®šçš„èµ„æºã€æ–‡ä»¶ã€è®¾å¤‡ã€çŠ¶æ€ã€æˆ–é…ç½®ï¼Œè€Œå¯¹äºå®¿ä¸»æœºä»¥åŠå…¶ä»–ä¸ç›¸å…³çš„ç¨‹åºï¼Œå°±å®Œå…¨çœ‹ä¸åˆ°</span><br><span class="line"><span class="meta">&gt;</span> <span class="javascript"><span class="string">&quot;æ•æ·&quot;</span>å’Œ<span class="string">&quot;é«˜æ€§èƒ½&quot;</span>æ˜¯å®¹å™¨ç›¸è¾ƒäºè™šæ‹Ÿæœºæœ€å¤§çš„ä¼˜åŠ¿ï¼Œä¹Ÿæ˜¯å®ƒèƒ½å¤Ÿåœ¨PaaSè¿™ç§æ›´ç»†ç²’åº¦çš„èµ„æºç®¡ç†å¹³å°ä¸Šå¤§è¡Œå…¶é“çš„é‡è¦åŸå› .</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="éƒ¨ç½²Kubernetes"><a href="#éƒ¨ç½²Kubernetes" class="headerlink" title="éƒ¨ç½²Kubernetes"></a>éƒ¨ç½²Kubernetes</h2><ul>
<li><p>installing kubeadm, kubelet and kubectl</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">- kubeadm: the command <span class="keyword">to</span> bootstrap the <span class="keyword">cluster</span></span><br><span class="line">- kubelet: the component that runs <span class="keyword">on</span> <span class="keyword">all</span> <span class="keyword">of</span> the machines <span class="keyword">in</span> your <span class="keyword">cluster</span> <span class="keyword">and</span> does things <span class="keyword">like</span> starting pods <span class="keyword">and</span> containers.</span><br><span class="line">- kubectl: the command <span class="type">line</span> util <span class="keyword">to</span> talk <span class="keyword">to</span> your <span class="keyword">cluster</span></span><br></pre></td></tr></table></figure></li>
<li><p>kubeadm</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="meta"># åˆ›å»ºä¸€ä¸ªMasterèŠ‚ç‚¹</span></span><br><span class="line">$ kubeadm <span class="keyword">init</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># å°†ä¸€ä¸ªNodeèŠ‚ç‚¹åŠ å…¥å½“å‰é›†ç¾¤</span></span><br><span class="line">$ kubeadm <span class="keyword">join</span> &lt;MasterèŠ‚ç‚¹çš„IPå’Œç«¯å£&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Prometheus+Grafana Intro</title>
    <url>/2021/09/19/Prometheus-Grafana-Intro/</url>
    <content><![CDATA[<h2 id="Prometheus"><a href="#Prometheus" class="headerlink" title="Prometheus"></a>Prometheus</h2><ul>
<li>First Steps<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Downloading Prometheus</span></span><br><span class="line">  âœ wget https:<span class="regexp">//gi</span>thub.com<span class="regexp">/prometheus/</span>prometheus<span class="regexp">/releases/</span>download<span class="regexp">/v2.30.0/</span>prometheus-<span class="number">2.30</span>.<span class="number">0</span>.linux-arm64.tar.gz</span><br><span class="line">  âœ tar -xvf prometheus-<span class="number">2.30</span>.<span class="number">0</span>.linux-arm64.tar.gz</span><br><span class="line">  âœ cd prometheus-<span class="number">2.30</span>.<span class="number">0</span>.linux-arm64</span><br><span class="line"></span><br><span class="line"><span class="comment"># Configuring Prometheus</span></span><br><span class="line">  âœ tree -L <span class="number">1</span></span><br><span class="line">  .</span><br><span class="line">  â”œâ”€â”€ console_libraries</span><br><span class="line">  â”œâ”€â”€ consoles</span><br><span class="line">  â”œâ”€â”€ LICENSE</span><br><span class="line">  â”œâ”€â”€ NOTICE</span><br><span class="line">  â”œâ”€â”€ prometheus</span><br><span class="line">  â”œâ”€â”€ prometheus.yml      -- a sample configuration</span><br><span class="line">  â””â”€â”€ promtool</span><br><span class="line"></span><br><span class="line">  <span class="number">2</span> directories, <span class="number">5</span> files</span><br><span class="line"></span><br><span class="line"><span class="comment"># Starting Prometheus</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>ç›‘æ§</tag>
      </tags>
  </entry>
  <entry>
    <title>Cyclic redundancy check Intro</title>
    <url>/2021/09/21/Cyclic-redundancy-check-Intro/</url>
    <content><![CDATA[<h1 id="CRC-Cyclic-redundancy-check"><a href="#CRC-Cyclic-redundancy-check" class="headerlink" title="CRC - Cyclic redundancy check"></a>CRC - Cyclic redundancy check</h1><blockquote>
<p>A cyclic redundancy check (CRC) is an error-detecting code commonly used in digital network and storage device to detect accidental changes to raw data.</p>
</blockquote>
<h2 id="CRC-16-æ ¡éªŒç "><a href="#CRC-16-æ ¡éªŒç " class="headerlink" title="CRC-16 æ ¡éªŒç "></a>CRC-16 æ ¡éªŒç </h2>]]></content>
      <tags>
        <tag>Algorithm</tag>
      </tags>
  </entry>
  <entry>
    <title>Have Read - Structure and Interpretation of Computer Programs</title>
    <url>/2021/09/21/Have-Read-Structure-and-Interpretation-of-Computer-Programs/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Docker Intro</title>
    <url>/2021/09/26/Docker-Intro/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Go Tips Tracks</title>
    <url>/2021/09/27/Go-Tips-Tracks/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Awesome Tools Intro</title>
    <url>/2021/09/28/Awesome-Tools-Intro/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Code Review Intro</title>
    <url>/2021/09/28/Code-Review-Intro/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Hyperledger Fabric Intro</title>
    <url>/2021/09/28/Hyperledger-Fabric-Intro/</url>
    <content><![CDATA[<h1 id="Hyperledger-Fabric"><a href="#Hyperledger-Fabric" class="headerlink" title="Hyperledger Fabric"></a>Hyperledger Fabric</h1><blockquote>
<p>Hyperledger Fabric 1.4 LTS - long-term support release<br>Hyperledger Fabric is a permissioned blockchain network(è®¸å¯åŒºå—é“¾ç½‘ç»œ).</p>
</blockquote>
<span id="more"></span>

<h2 id="Hyperledger-Fabric-Architecture"><a href="#Hyperledger-Fabric-Architecture" class="headerlink" title="Hyperledger Fabric Architecture"></a>Hyperledger Fabric Architecture</h2><ul>
<li>Simplest Hyperledger Fabric network with two organizations joining the same channel<br><img src="/misc/images/fabric-network-1.png" alt="Simplest Fabric network with two organizations joining the same channel"></li>
</ul>
  <figure class="highlight pf"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Fabric components</span></span><br><span class="line">  - Peer:</span><br><span class="line">    &gt; is blockchain node that stores <span class="literal">all</span> transactions <span class="keyword">on</span> a joining channel.</span><br><span class="line"></span><br><span class="line">  - Orderer:</span><br><span class="line">    &gt; is the most important components used <span class="keyword">in</span> the Farbic consensus mechanism (å…±è¯†æœºåˆ¶)</span><br><span class="line">    &gt; is a service responsible <span class="keyword">for</span> ordering transactions(äº¤æ˜“æ’åº), creating a new <span class="built_in">block</span> of ordered transactions, and distributing a newly created <span class="built_in">block</span> <span class="keyword">to</span> <span class="literal">all</span> peers <span class="keyword">on</span> a relevant channel.</span><br><span class="line"></span><br><span class="line">  - CA (Certificate Authority) è¯ä¹¦é¢å‘æœºæ„:</span><br><span class="line">    - ç®¡ç†ç”¨æˆ·è¯ä¹¦:</span><br><span class="line">      - <span class="keyword">user</span> registration: ç”¨æˆ·æ³¨å†Œ</span><br><span class="line">      - <span class="keyword">user</span> enrollment: ç”¨æˆ·ç™»è®°</span><br><span class="line">      - <span class="keyword">user</span> revocation: ç”¨æˆ·æ’¤é”€</span><br><span class="line"></span><br><span class="line">    - standard certificate: æ ‡å‡†è¯ä¹¦</span><br><span class="line">      - Hyperledger Fabric uses an X.<span class="number">509</span> srandard certificate <span class="keyword">to</span> represent permissions, roles, and attributes <span class="keyword">to</span> each <span class="keyword">user</span>.</span><br><span class="line">      - <span class="keyword">user</span> is able <span class="keyword">to</span> query or invoke <span class="literal">any</span> transaction <span class="keyword">on</span> <span class="literal">any</span> channel based <span class="keyword">on</span> permissions, roles, and attributes possesses.</span><br><span class="line"></span><br><span class="line">  - Client:</span><br><span class="line">    &gt; is considered <span class="keyword">to</span> be an application that interacts with Fabric blockchain network.</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Endorsing Peer(èƒŒä¹¦) vs Committing Peer()<br><img src="/misc/images/fabric_endorse_peer_commit_peer.png" alt="Endorsing Peer vs Committing Peer"></p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Chaincode (Smart Contract)</span></span><br><span class="line">  - three language (Golang, Nodejs, Java) program Fabric chaincode - é“¾ç </span><br><span class="line">  - è¦éƒ¨ç½²é“¾ç ï¼Œç½‘ç»œç®¡ç†å‘˜å°†é“¾ç å®‰è£…åˆ°ç›®æ ‡peer,ç„¶åè°ƒç”¨ordereræ’åºèŠ‚ç‚¹å°†é“¾ç å®ä¾‹åŒ–åˆ°ç‰¹å®šchannelé€šé“ä¸Š.</span><br><span class="line">  - Endorsement policy defines which peers need <span class="keyword">to</span> agree <span class="keyword">on</span> <span class="keyword">the</span> results <span class="keyword">of</span> a <span class="keyword">transaction</span> <span class="keyword">before</span> <span class="keyword">the</span> <span class="keyword">transaction</span> can be added <span class="keyword">onto</span> ledgers <span class="keyword">of</span> all peers <span class="keyword">on</span> <span class="keyword">the</span> channel.</span><br><span class="line">  - A chaincode developer must opt <span class="keyword">to</span> use either LevelDB <span class="keyword">or</span> CouchDB when developing a chaincode.</span><br><span class="line"></span><br><span class="line"><span class="comment"># Endorsing Peer èƒŒä¹¦èŠ‚ç‚¹</span></span><br><span class="line">  &gt; which consists <span class="keyword">of</span> an installed chaincode <span class="keyword">and</span> a <span class="keyword">local</span> ledger <span class="keyword">on</span> <span class="keyword">it</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Committing Peer</span></span><br><span class="line">  &gt; would have only a <span class="keyword">local</span> ledger <span class="keyword">on</span> <span class="keyword">it</span>.</span><br></pre></td></tr></table></figure></li>
<li><p>Interior components inside the Peerâ€™s ledger<br><img src="/misc/images/fabric-ledger-components.png" alt="Interior components inside the Peer&#39;s ledger"></p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Blockchain</span></span><br><span class="line">  &gt; the history of alll transactions <span class="keyword">for</span> every chaincode <span class="keyword">on</span> a particular channel.</span><br><span class="line"></span><br><span class="line"><span class="comment"># World State:</span></span><br><span class="line">  &gt; maintains the current <span class="keyword">state</span> of variables <span class="keyword">for</span> each specific chaincode.</span><br><span class="line"></span><br><span class="line">  - Two type database:</span><br><span class="line">    - LevelDB:</span><br><span class="line">      &gt; key-value database built <span class="keyword">on</span> Fabric Peer</span><br><span class="line"></span><br><span class="line">    - CouchDB:</span><br><span class="line">      &gt; JSON-based database supporting rich querying operations based <span class="keyword">on</span> JSON objects.</span><br></pre></td></tr></table></figure></li>
<li><p>Fabric network with chaincodes and ledgers attached multiple channels<br><img src="/misc/images/fabric-network-2.png" alt="Fabric network with chaincodes and ledgers attached"></p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">&gt; Actually, <span class="keyword">the</span> <span class="keyword">system</span> chaincodes <span class="keyword">and</span> ledgers are also deployed <span class="keyword">on</span> <span class="title">peers</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># System Chaincodes</span></span><br><span class="line">  &gt; collect network, channel, <span class="keyword">and</span> underlying <span class="keyword">system</span> configurations <span class="keyword">for</span> Fabric virtual machine <span class="built_in">to</span> work properly.</span><br><span class="line"></span><br><span class="line">  - QSCC (Query System Chaincode): <span class="keyword">for</span> ledger <span class="keyword">and</span> Fabric-related queries</span><br><span class="line">  - CSCC (Configuration System Chaincode): which helps regulate access control</span><br><span class="line">  - LSCC (Lifecycle System Chaincode): which defines <span class="keyword">the</span> rules <span class="keyword">for</span> <span class="keyword">the</span> channel</span><br><span class="line">  - ESCC (Endorsement System Chaincode): endorsing transactions</span><br><span class="line">  - VSCC (Validation System Chaincode): validating transactions</span><br><span class="line"></span><br><span class="line"><span class="comment"># System Ledgers</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Channel</span></span><br><span class="line">  &gt; organizations that join <span class="keyword">the</span> same channel can secretly share business transaction <span class="keyword">or</span> information together <span class="keyword">with</span> confidence.</span><br><span class="line"></span><br><span class="line"><span class="comment"># Chaincode:</span></span><br><span class="line">  - <span class="literal">one</span> chaincode can call another chaincode <span class="keyword">on</span> <span class="title">the</span> <span class="title">same</span> <span class="title">channel</span>.</span><br></pre></td></tr></table></figure></li>
<li><p>Fabric transaction invocation workflow (æŠ•ç¥¨æµç¨‹å›¾)<br><img src="/misc/images/fabric-transaction-invocation-workflow.png" alt="Fabric transaction invocation workflow"></p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line"><span class="comment"># consensus(å…±è¯†) divided into tree phases</span></span><br><span class="line">  - <span class="number">1</span>. Endorsement (èƒŒä¹¦) (Steps <span class="number">1</span>-<span class="number">3</span>)</span><br><span class="line">  - <span class="number">2</span>. Ordering (æ’åº) (Steps <span class="number">4</span>-<span class="number">5</span>)</span><br><span class="line">  - <span class="number">3</span>. Validation and Commitment(éªŒè¯å’Œæ‰¿è¯º) (Steps <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Fabric transaction workflow:</span></span><br><span class="line">  - <span class="number">1</span>. Client:åˆ›å»ºäº¤æ˜“æè®®ï¼Œå¹¶ä½¿ç”¨ç”¨æˆ·è¯ä¹¦è¿›è¡Œç­¾åï¼Œç„¶åå‘é€äº¤æ˜“åˆ°ç‰¹å®šé€šé“ä¸Šé¢„å…ˆç¡®å®šçš„èƒŒä¹¦èŠ‚ç‚¹ä¸Š</span><br><span class="line">  - <span class="number">2</span>. (Endorsing Peer) é¦–å…ˆä»äº¤æ˜“æè®®ä¸­éªŒè¯ç”¨æˆ·èº«ä»½å’Œæˆæƒ, éªŒè¯é€šè¿‡åï¼ŒèƒŒä¹¦èŠ‚ç‚¹æ¨¡æ‹Ÿäº¤æ˜“, ç”Ÿæˆç›¸åº”å’Œè¯»å†™é›†ï¼Œå¹¶ä½¿ç”¨è¯ä¹¦å¯¹ç”Ÿæˆçš„å“åº”è¿›è¡ŒèƒŒä¹¦</span><br><span class="line">  - <span class="number">3</span>. Client: accumulateå¹¶æ£€æŸ¥æ¥è‡ªèƒŒä¹¦èŠ‚ç‚¹çš„èƒŒä¹¦ææ¡ˆå“åº”.</span><br><span class="line">  - <span class="number">4</span>. Client: å°†é™„æœ‰èƒŒä¹¦ææ¡ˆå“åº”çš„äº¤æ˜“å‘ç»™Orderer.</span><br><span class="line">  - <span class="number">5</span>. Orderer: å¯¹æ¥æ”¶åˆ°çš„äº¤æ˜“è¿›è¡Œæ’åºï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„æœ‰åºäº¤æ˜“å¿«ï¼Œå¹¶ç”¨å…¶è¯ä¹¦å¯¹ç”Ÿæˆçš„å¿«è¿›è¡Œç­¾å</span><br><span class="line">  - <span class="number">6</span>. Orderer: å°†ç”Ÿæˆçš„å¿«å¹¿æ’­ç»™ç›¸å…³é€šé“ä¸Šçš„æ‰€æœ‰å¯¹ç­‰(endorse peer, commit peer)èŠ‚ç‚¹. ç„¶åæ¯ä¸ªPeerç¡®ä¿æ¥æ”¶åˆ°çš„åŒºå—ä¸­çš„æ¯æ¬¡äº¤æ˜“éƒ½ç”±é€‚å½“çš„èƒŒä¹¦(Endorsing Peers)ç­¾å(æ ¹æ®è°ƒç”¨çš„é“¾ç çš„èƒŒä¹¦ç­–ç•¥ç¡®å®š)å¹¶ä¸”å­˜åœ¨è¶³å¤Ÿçš„èƒŒä¹¦. ä¹‹åï¼Œå°†è¿›è¡Œç‰ˆæœ¬æ£€æŸ¥(Multi-version concurrency control MVCC æ£€æŸ¥) ä»¥éªŒè¯æ¥æ”¶åˆ°çš„å¿«çš„äº¤æ˜“çš„æ­£ç¡®æ€§. æ¯ä¸€ä¸ªPeerèŠ‚ç‚¹éƒ½ä¼šå°†æ¯ä¸ªäº¤æ˜“çš„readsetä¸å…¶åˆ†ç±»å¸çš„ä¸–ç•ŒçŠ¶æ€è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœéªŒè¯æ£€æŸ¥é€šè¿‡ï¼Œåˆ™äº¤æ˜“è¢«æ ‡è®°ä¸ºæœ‰æ•ˆï¼Œå¹¶ä¸”æ¯ä¸ªPeerçš„word <span class="keyword">state</span>éƒ½ä¼šæ›´æ–°, å¦åˆ™ï¼Œäº¤æ˜“è¢«æ ‡è®°ä¸ºæ— æ•ˆè€Œä¸æ›´æ–°world <span class="keyword">state</span>. æœ€åï¼Œæ— è®ºè¯¥<span class="built_in">block</span>æ˜¯å¦åŒ…å«ä»»ä½•æ— æ•ˆçš„äº¤æ˜“ï¼Œæ¥æ”¶åˆ°çš„<span class="built_in">block</span>éƒ½ä¼šè¿½åŠ åˆ°PeerèŠ‚ç‚¹çš„æœ¬åœ°blockchainä¸­.</span><br><span class="line">  - <span class="number">7</span>. Client: å®¢æˆ·ç«¯ä»EventHubæœåŠ¡æ¥å—è®¢é˜…çš„äº‹ä»¶</span><br></pre></td></tr></table></figure></li>
<li><p>Fabric Orderer Service</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">&gt; It acts as a Hub for <span class="keyword">distributing </span><span class="keyword">blocks </span>of transactions to all peers on a relevant channel.</span><br><span class="line">&gt; <span class="keyword">Orderer </span>might <span class="keyword">be </span>considered to <span class="keyword">be </span>the weakest point in the Fabric network.</span><br><span class="line"></span><br><span class="line"><span class="comment"># two type of Fabric Orderer service</span></span><br><span class="line">  - Solo-<span class="keyword">based </span><span class="keyword">ordering </span>service (ä»…ç”¨äºå¼€å‘é˜¶æ®µ)</span><br><span class="line"></span><br><span class="line">  - Kafka-<span class="keyword">based </span><span class="keyword">ordering </span>service (æ­å»ºKafkaé›†ç¾¤)</span><br><span class="line">    - Kafka provide Crash Fault tolerance (CFTå´©æºƒå®¹é”™) consensus(å…±è¯†)</span><br></pre></td></tr></table></figure></li>
<li><p>Fabric network in a production environment<br><img src="/misc/images/fabric-network-production.png" alt="Fabric network in a production environment"></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># Client application interact with Fabric blockchain network in two ways:</span></span><br><span class="line"><span class="bullet">  -</span> Fabric SDK</span><br><span class="line"><span class="code">    &gt; Fabric SDK supports Go, Node.js and Java language</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="bullet">  -</span> Fabric CLI</span><br><span class="line"><span class="code">    &gt; use in development or maintenance mode</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># CA: ç”¨æˆ·ç®¡ç†å’Œè¯ä¹¦é¢å‘</span></span><br><span class="line"><span class="bullet">  -</span> Two ways to deploy Fabric CA:</span><br><span class="line"><span class="bullet">    -</span> 1. Fabric CA without LDAP Server:</span><br><span class="line"><span class="code">      &gt; Fabric CA è´Ÿè´£ ç”¨æˆ·æ³¨å†Œã€ç”¨æˆ·è®¤è¯ã€é¢å‘ç”¨æˆ·è¯ä¹¦.</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="bullet">    -</span> 2. Fabric CA with LDAP Server:</span><br><span class="line"><span class="code">      &gt; Fabric CA è´Ÿè´£é¢å‘ç”¨æˆ·è¯ä¹¦</span></span><br><span class="line"><span class="code">      &gt; LDAP Server è´Ÿè´£ ç”¨æˆ·æ³¨å†Œã€ç”¨æˆ·è®¤è¯ã€æ’¤é”€ç”¨æˆ·</span></span><br><span class="line"><span class="code">      &gt; è¿™ç§æ–¹å¼é€‚åˆç»„ç»‡å­˜åœ¨çš„AD,LDAP or Radius server.</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># CouchDB:</span></span><br><span class="line">  &gt; æ”¯æŒJSON æŸ¥è¯¢ï¼Œæ•°æ®åº“ç´¢å¼•ï¼Œæ•°æ®æ‹·è´ï¼ŒACID å±æ€§</span><br><span class="line"></span><br><span class="line"><span class="section"># LevelDB:</span></span><br><span class="line">  &gt; æ”¯æŒæœ‰é™çš„æ“ä½œ</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Private-Data-Collection"><a href="#Private-Data-Collection" class="headerlink" title="Private Data Collection"></a>Private Data Collection</h2>  <figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> <span class="javascript">Fabric <span class="number">1.2</span>æ”¯æŒè¯¥ç‰¹æ€§</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>Overview of Private Data Collection<br><img src="/misc/images/fabric-private-data-collection.png" alt="Peer&#39;s ledger enabled for Private Data Collection use"></p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line"><span class="comment"># public data section:</span></span><br><span class="line">  - public <span class="built_in">block</span> storage: å…¬å…±å¿«å­˜å‚¨</span><br><span class="line">    &gt; is a blockchain that holds the history of <span class="literal">all</span> public transactions <span class="keyword">for</span> every chaincode instantiated <span class="keyword">on</span> a channel.</span><br><span class="line"></span><br><span class="line">  - public <span class="keyword">state</span> database å…¬å…±çŠ¶æ€æ•°æ®åº“</span><br><span class="line">    &gt; maintains the current <span class="keyword">state</span> of public variables <span class="keyword">for</span> a specific chaincode.</span><br><span class="line"></span><br><span class="line">  &gt; å¯¹äºä»»ä½•ç‰¹å®šé€šé“channel,å³å…¬å…±æ•°æ®éƒ¨åˆ†ä»…åŒ…å«å•ä¸ªå…¬å…±å¿«å­˜å‚¨(public <span class="built_in">block</span> storage)å®ä¾‹, ä½†è¯¥éƒ¨åˆ†å¯ä»¥åŒ…å«åŸºäºåœ¨é€šé“ä¸Šå®ä¾‹åŒ–çš„å¤šä¸ªé“¾ç (chaincode)çš„å¤šä¸ªå…¬å…±çŠ¶æ€æ•°æ®åº“å®ä¾‹.</span><br><span class="line"></span><br><span class="line"><span class="comment"># private data section:</span></span><br><span class="line">  - private writeset storage: ç§æœ‰å†™å…¥é›†å­˜å‚¨</span><br><span class="line">    &gt; æ”¶é›†ç‰¹å®šç§æœ‰æ•°æ®é›†åˆçš„æ‰€æœ‰ç§æœ‰äº¤æ˜“çš„å†å²è®°å½•</span><br><span class="line">    &gt; è¿™ç§å­˜å‚¨ä¸æ˜¯åŒºå—é“¾ï¼Œè€Œæ˜¯ä¸€ç§å…¸å‹çš„æ—¥å¿—æŒä¹…åŒ–æ•°æ®åº“</span><br><span class="line"></span><br><span class="line">  - private <span class="keyword">state</span> database:</span><br><span class="line">    &gt;</span><br><span class="line"></span><br><span class="line">  - transient store database: ç¬æ€å­˜å‚¨æ•°æ®åº“</span><br><span class="line">    &gt; è¿™ç§æ•°æ®åº“ç”¨ä½œä¸´æ—¶æ•°æ®åº“ï¼Œç”¨äºåœ¨äº¤æ˜“è°ƒç”¨è¿‡ç¨‹ä¸­ä¸´æ—¶å­˜å‚¨ç§æœ‰æ•°æ®</span><br></pre></td></tr></table></figure></li>
<li><p>Peers maintaining multiple Private Data Collections<br><img src="/misc/images/fabric-private-data-collection-2.png" alt="Peers maintaining multiple Private Data Collections"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">Public State Database:</span></span><br><span class="line"><span class="meta">  &gt;</span><span class="bash"> (å…¬å…±çŠ¶æ€æ•°æ®åº“)å­˜å‚¨ç‰¹å®šé“¾ç çš„å…¬å…±å˜é‡çš„å½“å‰å€¼, è¿˜å­˜å‚¨ä¸è¯¥ç‰¹å®šé“¾ç å…³è”çš„ä¿®æ”¹åçš„ç§æœ‰æ•°æ®é›†çš„å“ˆå¸Œå€¼.</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Private data collections:</span></span><br><span class="line"><span class="meta">  &gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p>  <a href="https://medium.com/coinmonks/demystifying-hyperledger-fabric-2-3-private-data-collection-164220ecafa5">Demystifying Hyperledger Fabric</a></p>
]]></content>
      <tags>
        <tag>Blockchain</tag>
      </tags>
  </entry>
  <entry>
    <title>LevelDB Intro</title>
    <url>/2021/09/28/LevelDB-Intro/</url>
    <content><![CDATA[<h1 id="LevelDB"><a href="#LevelDB" class="headerlink" title="LevelDB"></a>LevelDB</h1><blockquote>
<p>LevelDB is a fast key-value storage library written at Google that provides an ordered mapping from string keys to string values.</p>
</blockquote>
<span id="more"></span>

<h2 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h2><ul>
<li>keyå’Œvalueæ”¯æŒå­˜å‚¨ä»»æ„é•¿åº¦çš„å­—èŠ‚æ•°ç»„</li>
<li>æ•°æ®å­˜å‚¨æ ¹æ®Keyæ’åº</li>
<li>æ”¯æŒè‡ªå®šä¹‰æ’åºè§„åˆ™</li>
<li>åŸºæœ¬æ“ä½œæ˜¯Put(Key,value), Get(Key), Delete(Key)</li>
<li>æ”¯æŒæ‰¹é‡åŸå­æ“ä½œ</li>
<li>æ”¯æŒåˆ›å»ºäº‹åŠ¡å¿«ç…§è·å–ä¸€è‡´æ€§è§†å›¾æ•°æ®</li>
<li>Forward and backward iteration is supported over the data.</li>
<li>è‡ªåŠ¨ä½¿ç”¨Snappyç®—æ³•å‹ç¼©æ•°æ®</li>
</ul>
<h2 id="Limitations"><a href="#Limitations" class="headerlink" title="Limitations"></a>Limitations</h2><ul>
<li>Not SQL database</li>
<li>Only a single process (possibly multi-threaded) can access a particular database at a time</li>
<li>No client-server support builtin to the library</li>
</ul>
]]></content>
      <tags>
        <tag>Key-Value DB</tag>
      </tags>
  </entry>
</search>
