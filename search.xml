<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Docker Tips &amp; Tricks</title>
    <url>/2021/09/01/Docker-Intro/</url>
    <content><![CDATA[<h2 id="Docker-Info"><a href="#Docker-Info" class="headerlink" title="Docker  Info"></a>Docker  Info</h2><figure class="highlight oxygene"><table><tr><td class="code"><pre><code class="hljs oxygene">å®¹å™¨æŠ€æœ¯çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå°±æ˜¯é€šè¿‡çº¦æŸå’Œä¿®æ”¹è¿›ç¨‹çš„åŠ¨æ€è¡¨ç°ï¼Œä»è€Œä¸ºå…¶åˆ›é€ å‡ºä¸€ä¸ªâ€œè¾¹ç•Œâ€<br><br>CgroupsæŠ€æœ¯æ˜¯ç”¨æ¥åˆ¶é€ çº¦æŸçš„ä¸»è¦æ‰‹æ®µ<br><span class="hljs-keyword">Namespace</span>æŠ€æœ¯åˆ™æ˜¯ç”¨æ¥ä¿®æ”¹è¿›ç¨‹è¯•å›¾çš„ä¸»è¦æ–¹æ³•<br></code></pre></td></tr></table></figure>
<span id="more"></span>

<h2 id="Docker-architecture"><a href="#Docker-architecture" class="headerlink" title="Docker architecture"></a>Docker architecture</h2><blockquote>
<p>Docker uses a client-server architecture.</p>
</blockquote>
<p><img src="/misc/images/architecture.svg" alt="docker architecture"></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># Docker ä»“åº“æ“ä½œ</span><br>  docker pull/push<br><br><span class="hljs-comment"># Docker é•œåƒç®¡ç†</span><br>  docker images/rmi/build<br><br><span class="hljs-comment"># Docker ç”Ÿå‘½å‘¨æœŸç®¡ç†</span><br>  docker run/<span class="hljs-built_in">start</span>/stop/<span class="hljs-built_in">rm</span><br><br><span class="hljs-comment"># to delete all containers including its volumes use,</span><br><span class="hljs-variable">$</span> docker <span class="hljs-built_in">rm</span> <span class="hljs-literal">-vf</span> <span class="hljs-variable">$</span>(docker <span class="hljs-built_in">ps</span> <span class="hljs-literal">-a</span> <span class="hljs-literal">-q</span>)<br><br><span class="hljs-comment"># to delete all Docker images</span><br><span class="hljs-variable">$</span> docker rmi <span class="hljs-variable">$</span>(docker images <span class="hljs-literal">-q</span>)<br><br><span class="hljs-comment"># stop all Docker containers</span><br>&gt; docker <span class="hljs-built_in">ps</span> -- list all running containers<br>&gt;   <span class="hljs-literal">-q</span> flag will only list the IDs <span class="hljs-keyword">for</span> those containers<br><span class="hljs-variable">$</span> docker <span class="hljs-built_in">kill</span> <span class="hljs-variable">$</span>(docker <span class="hljs-built_in">ps</span> <span class="hljs-literal">-q</span>)<br><br><span class="hljs-comment"># Remove all Docker containers</span><br><span class="hljs-variable">$</span> docker <span class="hljs-built_in">rm</span> <span class="hljs-variable">$</span>(docker <span class="hljs-built_in">ps</span> <span class="hljs-literal">-a</span> <span class="hljs-literal">-q</span>)<br></code></pre></td></tr></table></figure>

<h2 id="Docker-Tips"><a href="#Docker-Tips" class="headerlink" title="Docker Tips"></a>Docker Tips</h2><ul>
<li><p><strong>Docker Tip #1</strong>: Docker å®¹å™¨è¿›ç¨‹</p>
<blockquote>
<p>A Docker container is just a process/service that runs directly on your machine. It is slightly different than a regular process because the Docker daemon along with the linux kernel do a few things(<strong>Cgroups</strong>ã€<strong>Namespace</strong>) to ensure it runs in total isolation<br>Dockerå®¹å™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿›ç¨‹,å’Œè™šæ‹Ÿæœºå·®åˆ«å¾ˆå¤§</p>
</blockquote>
</li>
<li><p><strong>Docker Tip #2</strong>: COPY vs. ADD in a Dockerfile</p>
<blockquote>
<p>COPY å’Œ ADD åŠŸèƒ½å¾ˆç›¸ä¼¼ï¼Œéƒ½å¯ä»¥ä»æŒ‡å®šç›®å½•æ‹·è´æ•°æ®åˆ°Dockeré•œåƒä¸­.</p>
</blockquote>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><code class="hljs oxygene"># <span class="hljs-keyword">COPY</span> å’Œ <span class="hljs-keyword">ADD</span> åŒºåˆ«<br><span class="hljs-number">1</span>. <span class="hljs-keyword">COPY</span>: åªèƒ½ä»æœ¬æœºæ–‡ä»¶æˆ–ç›®å½•ä¸­æ‹·è´åˆ°é•œåƒä¸­<br><span class="hljs-number">2</span>. <span class="hljs-keyword">ADD</span>: ä¸ä»…å¯ä»¥ä»æœ¬æœºæ–‡ä»¶æˆ–ç›®å½•ä¸­æ‹·è´ï¼Œè¿˜å¯ä»¥ä½¿ç”¨URLå¼•å…¥å¤–éƒ¨çš„æ–‡ä»¶åœ°å€æ‹·è´åˆ°é•œåƒä¸­<br>  $ <span class="hljs-keyword">ADD</span> rootfs.tar.gz /<br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #3</strong>: è¿½åŠ  Docker Run æŒ‡ä»¤å‡å°‘é•œåƒå¤§å°</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># Before Dockerfile -- æ–°å¢ä¸‰ä¸ªå±‚lager</span><br>RUN wget -O myfile.tar.gz http:<span class="hljs-regexp">//</span>example.com/myfile.tar.gz<br>RUN tar -xvf myfile.tar.gz -C <span class="hljs-regexp">/usr/</span>src/myapp<br>RUN rm myfile.tar.gz<br><br><span class="hljs-comment"># After Dockerfile -- æ–°å¢ä¸€ä¸ªå±‚layer</span><br>RUN wget -O myfile.tar.gz http:<span class="hljs-regexp">//</span>example.com/myfile.tar.gz \<br>  &amp;&amp; tar -xvf myfile.tar.gz -C <span class="hljs-regexp">/usr/</span>src/myapp \<br>  &amp;&amp; rm myfile.tar.gz<br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #4</strong>: Docker Baseé•œåƒOSå’ŒHost OSæ²¡æœ‰å…³ç³»</p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><code class="hljs sqf">Docker <span class="hljs-built_in">Image</span> OS: å®šä¹‰åœ¨Dockerfileæ–‡ä»¶çš„Baseé•œåƒçš„ç³»ç»Ÿ<br>Host OS: è¿è¡ŒDocker <span class="hljs-built_in">image</span>çš„ç¯å¢ƒ<br>You can use whatever base <span class="hljs-built_in">image</span> you want <span class="hljs-keyword">for</span> your Docker images.<br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #5</strong>: ä½¿ç”¨ç›¸åŒBaseé•œåƒçš„å¥½å¤„</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql">You could use a different base OS <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> Docker image, but <span class="hljs-keyword">then</span> you lose <span class="hljs-keyword">out</span> <span class="hljs-keyword">on</span> the ability <span class="hljs-keyword">to</span> <span class="hljs-keyword">cache</span> it across all of your images<br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #6</strong>: RUN vs. CMD in a Dockerfile</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">RUN:</span> åœ¨é•œåƒå†…æ‰§è¡Œå‘½ä»¤ï¼Œè¿™äº›æŒ‡ä»¤ä»…ä»…åœ¨æ„å»ºbuildé•œåƒä¸­æ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”å°†æ„å»ºç»“æœå†™å…¥æ–°largerå±‚ä¸­.<br><span class="hljs-symbol">CMD:</span> åœ¨å¯åŠ¨å®¹å™¨æ—¶å®šä¹‰é»˜è®¤çš„è¿è¡Œçš„æŒ‡ä»¤, è¿™ç§åŠ¨ä½œå‘ç”Ÿè¿è¡Œæ—¶run-time, è¦†ç›–æ–¹å¼<br><span class="hljs-symbol">ENTRYPOINT:</span> æ‰§è¡Œå‘½ä»¤å‚æ•°è¿½åŠ æ–¹å¼<br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #7</strong>: Base Docker Image Alpine</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><code class="hljs mipsasm">Why Alpine?<br>&gt; Small. Simple. Secure. Alpine Linux is a security-<span class="hljs-keyword">oriented, </span>lightweight Linux <span class="hljs-keyword">distribution </span><span class="hljs-keyword">based </span>on musl libc <span class="hljs-keyword">and </span><span class="hljs-keyword">busybox.</span><br><span class="hljs-keyword"></span>&gt; Alpine is about <span class="hljs-number">30</span>x smaller than Debian.<br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #8</strong>: Project Structure with Multiple Dockerfiles and Docker Compose</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><code class="hljs vim">ubuntu in ~/chyi/micro-services at <span class="hljs-number">3</span>BPlus <span class="hljs-keyword">on</span> ğŸ³ v20.<span class="hljs-number">10.8</span><br>âœ tree -L <span class="hljs-number">2</span><br>.<br>â”œâ”€â”€ auth<br>â”‚Â Â  â””â”€â”€ Dockerfile<br>â”œâ”€â”€ billing<br>â”‚Â Â  â””â”€â”€ Dockerfile<br>â”œâ”€â”€ contact<br>â”‚Â Â  â””â”€â”€ Dockerfile<br>â”œâ”€â”€ docker-compose.yml<br>â””â”€â”€ user<br>    â””â”€â”€ Dockerfile<br><br><span class="hljs-number">4</span> directories, <span class="hljs-number">5</span> <span class="hljs-keyword">files</span><br><br>The docker-compose.yaml<br>ubuntu in ~/chyi/micro-services at <span class="hljs-number">3</span>BPlus <span class="hljs-keyword">on</span> ğŸ³ v20.<span class="hljs-number">10.8</span><br>âœ <span class="hljs-keyword">cat</span> docker-compose.yml<br><span class="hljs-keyword">version</span>: <span class="hljs-string">&#x27;3&#x27;</span><br><br>service<span class="hljs-variable">s:</span><br>    auth:<br>        build: <span class="hljs-string">&#x27;./auth&#x27;</span><br>    billin<span class="hljs-variable">g:</span><br>        build: <span class="hljs-string">&#x27;./billing&#x27;</span><br>    contac<span class="hljs-variable">t:</span><br>        build: <span class="hljs-string">&#x27;./contact&#x27;</span><br>    user:<br>        build: <span class="hljs-string">&#x27;./user&#x27;</span><br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #9</strong>: ä½¿ç”¨Volumes</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># docker-compose.yaml</span><br><span class="hljs-attr">services</span>:<span class="hljs-string"></span><br>  <span class="hljs-attr">app</span>:<span class="hljs-string"></span><br><span class="hljs-comment">    # Mount the crrent directoy into `/app` inside the running container.</span><br>    <span class="hljs-attr">volumes</span>:<span class="hljs-string"></span><br>      <span class="hljs-meta">-</span> <span class="hljs-string">&#x27;.:/app&#x27;</span><br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #10</strong>: Published Ports</p>
<blockquote>
<p>Creates a firwaall rule which maps a container port to a port on the Docker host to the outside world.</p>
</blockquote>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">Flag value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-p 8080:80</td>
<td align="left">Map TCP port 80 in the container to port 8080 on the Docker host.</td>
</tr>
<tr>
<td align="left">-p 192.168.1.100:8080:80</td>
<td align="left">Map TCP port 80 in the container to port 8080 on the Docker host for connections to host IP 192.168.1.100.</td>
</tr>
<tr>
<td align="left">-p 8080:80/udp</td>
<td align="left">Map UDP port 80 in the container to port 8080 on the Docker host.</td>
</tr>
<tr>
<td align="left">-p 8080:80/tcp -p 8080:80/udp</td>
<td align="left">Map TCP port 80 in the container to TCP port 8080 on the Docker host, and map UDP port 80 in the container to UDP port 8080 on the Docker host.</td>
</tr>
</tbody></table>
<ul>
<li><p><strong>Docker Tip #11</strong>: dockerignore file</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">.dockerignore</span>: ignore certain files and folders from your Docker images<br>  <span class="hljs-string">.git</span><br>  <span class="hljs-string">.dockerignore</span><br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #12</strong>: Manage Docker without sudo on Linux</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><code class="hljs elixir"><span class="hljs-comment"># Add a docker group and then add your user to it:</span><br><span class="hljs-variable">$ </span>sudo groupadd docker<br><span class="hljs-variable">$ </span>docker usermod -aG docker <span class="hljs-variable">$USER</span><br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #13</strong>: Measure Docker Containerâ€™s Resources</p>
<blockquote>
<p>How much resources containers are using</p>
</blockquote>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><code class="hljs x86asm">$ docker stats<br>CONTAINER ID   NAME                                                                                         <span class="hljs-meta">CPU</span> %     MEM USAGE / LIMIT     MEM %     NET I/O     BLOCK I/O         PIDS<br>298d90f942e1   k8s_POD_kafka-zookeeper-0_default_a243d677-<span class="hljs-number">101b</span>-493b-a076-d94f46785f22_0                     <span class="hljs-number">0.00</span>%     724KiB / <span class="hljs-number">3.</span>704GiB     <span class="hljs-number">0.02</span>%     <span class="hljs-number">0B</span> / <span class="hljs-number">0B</span>     <span class="hljs-number">0B</span> / <span class="hljs-number">0B</span>           <span class="hljs-number">1</span><br>1d92a13e4a6f   k8s_POD_kafka-0_default_f7374645-<span class="hljs-number">9904</span>-436c-bc8d-43ed415833c1_0                               <span class="hljs-number">0.00</span>%     872KiB / <span class="hljs-number">3.</span>704GiB     <span class="hljs-number">0.02</span>%     <span class="hljs-number">0B</span> / <span class="hljs-number">0B</span>     <span class="hljs-number">0B</span> / <span class="hljs-number">0B</span>           <span class="hljs-number">1</span><br>b638c1bbd855   k8s_POD_postgres-postgresql-0_infrastructure_d9067ee1-<span class="hljs-number">6874</span>-<span class="hljs-number">4018</span>-a008-09362ad9330d_16         <span class="hljs-number">0.00</span>%     868KiB / <span class="hljs-number">3.</span>704GiB     <span class="hljs-number">0.02</span>%     <span class="hljs-number">0B</span> / <span class="hljs-number">0B</span>     <span class="hljs-number">0B</span> / <span class="hljs-number">0B</span>           <span class="hljs-number">1</span><br>0fdc76799b4e   k8s_kube-flannel_kube-flannel-<span class="hljs-built_in">ds</span>-nk6tj_kube-system_0a186e7a-c0d7-<span class="hljs-number">4282</span>-9f5d-65ee20d0e13a_12   <span class="hljs-number">0.07</span>%     <span class="hljs-number">15.</span>4MiB / 50MiB       <span class="hljs-number">30.80</span>%    <span class="hljs-number">0B</span> / <span class="hljs-number">0B</span>     <span class="hljs-number">33.</span>1MB / <span class="hljs-number">0B</span>       <span class="hljs-number">11</span><br>4c3705247efa   k8s_kube-proxy_kube-proxy-xwfvl_kube-system_f46216cb-d018-4d82-b510-9be5e01cefca_12          <span class="hljs-number">0.00</span>%     <span class="hljs-number">23.</span>36MiB / <span class="hljs-number">3.</span>704GiB   <span class="hljs-number">0.62</span>%     <span class="hljs-number">0B</span> / <span class="hljs-number">0B</span>     <span class="hljs-number">43.</span>7MB / <span class="hljs-number">12.</span>3kB   <span class="hljs-number">8</span><br>16d5db1e7447   k8s_POD_kube-proxy-xwfvl_kube-system_f46216cb-d018-4d82-b510-9be5e01cefca_13                 <span class="hljs-number">0.00</span>%     <span class="hljs-number">1.</span>996MiB / <span class="hljs-number">3.</span>704GiB   <span class="hljs-number">0.05</span>%     <span class="hljs-number">0B</span> / <span class="hljs-number">0B</span>     487kB / <span class="hljs-number">0B</span>        <span class="hljs-number">1</span><br>496aacf5fddf   k8s_POD_kube-flannel-<span class="hljs-built_in">ds</span>-nk6tj_kube-system_0a186e7a-c0d7-<span class="hljs-number">4282</span>-9f5d-65ee20d0e13a_13            <span class="hljs-number">0.00</span>%     768KiB / <span class="hljs-number">3.</span>704GiB     <span class="hljs-number">0.02</span>%     <span class="hljs-number">0B</span> / <span class="hljs-number">0B</span>     <span class="hljs-number">0B</span> / <span class="hljs-number">0B</span>           <span class="hljs-number">1</span><br>1e328afeb116   dapr_zipkin                                                                                  <span class="hljs-number">0.17</span>%     <span class="hljs-number">250.</span>2MiB / <span class="hljs-number">3.</span>704GiB   <span class="hljs-number">6.60</span>%     18MB / <span class="hljs-number">0B</span>   60MB / <span class="hljs-number">0B</span>         <span class="hljs-number">55</span><br>27872f88cae3   dapr_placement                                                                               <span class="hljs-number">0.11</span>%     <span class="hljs-number">5.</span>992MiB / <span class="hljs-number">3.</span>704GiB   <span class="hljs-number">0.16</span>%     18MB / <span class="hljs-number">0B</span>   <span class="hljs-number">13.</span>6MB / <span class="hljs-number">0B</span>       <span class="hljs-number">10</span><br>27c1f6daa81c   dapr_redis                                                                                   <span class="hljs-number">0.35</span>%     <span class="hljs-number">5.</span>633MiB / <span class="hljs-number">3.</span>704GiB   <span class="hljs-number">0.15</span>%     18MB / <span class="hljs-number">0B</span>   <span class="hljs-number">10.</span>7MB / <span class="hljs-number">0B</span>       <span class="hljs-number">5</span><br><br>$ docker stats --format <span class="hljs-string">&quot;table &#123;&#123;.Container&#125;&#125;\t&#123;&#123;.CPUPerc&#125;&#125;\t&#123;&#123;.MemUsage&#125;&#125;&quot;</span><br>CONTAINER      <span class="hljs-meta">CPU</span> %     MEM USAGE / LIMIT<br>298d90f942e1   <span class="hljs-number">0.00</span>%     724KiB / <span class="hljs-number">3.</span>704GiB<br>1d92a13e4a6f   <span class="hljs-number">0.00</span>%     872KiB / <span class="hljs-number">3.</span>704GiB<br>b638c1bbd855   <span class="hljs-number">0.00</span>%     868KiB / <span class="hljs-number">3.</span>704GiB<br>0fdc76799b4e   <span class="hljs-number">2.37</span>%     <span class="hljs-number">15.</span>42MiB / 50MiB<br>4c3705247efa   <span class="hljs-number">0.00</span>%     <span class="hljs-number">23.</span>36MiB / <span class="hljs-number">3.</span>704GiB<br>16d5db1e7447   <span class="hljs-number">0.00</span>%     <span class="hljs-number">1.</span>996MiB / <span class="hljs-number">3.</span>704GiB<br>496aacf5fddf   <span class="hljs-number">0.00</span>%     768KiB / <span class="hljs-number">3.</span>704GiB<br>1e328afeb116   <span class="hljs-number">0.21</span>%     <span class="hljs-number">250.</span>2MiB / <span class="hljs-number">3.</span>704GiB<br>27872f88cae3   <span class="hljs-number">0.12</span>%     <span class="hljs-number">5.</span>992MiB / <span class="hljs-number">3.</span>704GiB<br>27c1f6daa81c   <span class="hljs-number">0.34</span>%     <span class="hljs-number">5.</span>633MiB / <span class="hljs-number">3.</span>704GiB<br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #14</strong>: Docker Compose vs Docker Stack</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># Docker Compose: is an official tool that helps you manage your Docker containers by letting you define everything through a docker-compose.yml file.</span><br><br><span class="hljs-comment"># docker stack: is a command that&#x27;s embedded into the Docker CLI. Lets you manage a cluster of Docker containers through Docker Swarm.</span><br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #15</strong>: Metadata Docker Images with Labels</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># Dockerfile example of adding 2 labels with 1 LABEL instruction:</span><br><span class="hljs-keyword">LABEL</span><span class="bash"> &lt;key&gt;=&lt;value&gt;</span><br><span class="hljs-keyword">LABEL</span><span class="bash"> version=<span class="hljs-string">&quot;1.0&quot;</span> maintainer=<span class="hljs-string">&quot;chyi &lt;nick.chyi@gmail.com&gt;&quot;</span></span><br><br><span class="hljs-comment"># Docker build example to add dynamic labels to your Docker images:</span><br>$ docker build . --<span class="hljs-keyword">label</span><span class="bash"> <span class="hljs-string">&quot;version=1.0&quot;</span> --label <span class="hljs-string">&quot;maintaner=chyi &lt;nick.chyi@gmail.com&gt;&quot;</span></span><br><br><span class="hljs-comment"># docker inspect images</span><br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #16</strong>: Named Volumes vs Path Based Volumes</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># Named volumes</span><br>  postgres:<span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/postgresql/</span>data<br><br>  docker-compose automatically create the postgres volume, <span class="hljs-keyword">if</span> not you could running __$ docker volume create postgres__.<br>  On Linux, the volume will get saved to <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/docker/</span>volumes<span class="hljs-regexp">/postgres/</span>_data<br><br><span class="hljs-comment"># Path based volumes</span><br>  .<span class="hljs-regexp">/postgres:/</span>var<span class="hljs-regexp">/lib/</span>postgresql/data<br><br>  postgres/ directory would get created <span class="hljs-keyword">in</span> the current directory on the Docker host.<br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #17</strong>: The Volume or Mount Flag</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Setting up a volume the old way with docker run:</span><br>$ docker container run â€¦ -v <span class="hljs-string">&quot;<span class="hljs-subst">$(pwd)</span>&quot;</span>:/myapp<br><br><span class="hljs-comment"># Setting up the same volumes using the mount flag with docker run:</span><br>$ docker container run â€¦ --mount <span class="hljs-built_in">type</span>=<span class="hljs-built_in">bind</span>,<span class="hljs-built_in">source</span>=<span class="hljs-string">&quot;<span class="hljs-subst">$(pwd)</span>&quot;</span>,target=/myapp<br><br><span class="hljs-comment"># Docker compose</span><br>volumes:<br>  - <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;bind&quot;</span><br>    <span class="hljs-built_in">source</span>: <span class="hljs-string">&quot;.&quot;</span><br>    target: <span class="hljs-string">&quot;/myapp&quot;</span><br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #18</strong>: Connect to a Service Running on Docker Host</p>
<blockquote>
<p>Implementation of connecting to Docker host over a custom network with a static IP address.</p>
</blockquote>
<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># Create a custom bridge Docker network</span><br>ubuntu <span class="hljs-keyword">in</span> ~ at <span class="hljs-number">3</span>BPlus<br>âœ docker network create -d bridge --subnet <span class="hljs-number">192.168</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">24</span> --gateway <span class="hljs-number">192.168</span>.<span class="hljs-number">0.1</span> mynet<br><span class="hljs-number">0330</span>b879fcc8fb23eeb092cb66fd86f1796e7f0abe37df4978903cf8fd07217b<br><br>ubuntu <span class="hljs-keyword">in</span> ~ at <span class="hljs-number">3</span>BPlus<br>âœ ifconfig<br>br-<span class="hljs-number">0330</span>b879fcc8: flags=<span class="hljs-number">4099</span>&lt;UP,BROADCAST,MULTICAST&gt;  mtu <span class="hljs-number">1500</span><br>        inet <span class="hljs-number">192.168</span>.<span class="hljs-number">0.1</span>  netmask <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span>  broadcast <span class="hljs-number">192.168</span>.<span class="hljs-number">0.255</span><br>        ether <span class="hljs-number">02</span>:<span class="hljs-number">42</span>:<span class="hljs-number">16</span>:<span class="hljs-number">0</span>c:c0:<span class="hljs-number">51</span>  txqueuelen <span class="hljs-number">0</span>  (Ethernet)<br>        RX packets <span class="hljs-number">0</span>  bytes <span class="hljs-number">0</span> (<span class="hljs-number">0.0</span> B)<br>        RX errors <span class="hljs-number">0</span>  dropped <span class="hljs-number">0</span>  overruns <span class="hljs-number">0</span>  frame <span class="hljs-number">0</span><br>        TX packets <span class="hljs-number">0</span>  bytes <span class="hljs-number">0</span> (<span class="hljs-number">0.0</span> B)<br>        TX errors <span class="hljs-number">0</span>  dropped <span class="hljs-number">0</span> overruns <span class="hljs-number">0</span>  carrier <span class="hljs-number">0</span>  collisions <span class="hljs-number">0</span><br><br><span class="hljs-comment"># Start the Alpine container and drop into a Shell prompt.</span><br>ubuntu <span class="hljs-keyword">in</span> ~ at <span class="hljs-number">3</span>BPlus<br>âœ docker container run --rm -it alpine sh<br><br><span class="hljs-comment"># Install the ping utility.</span><br>/ <span class="hljs-comment"># apk update &amp;&amp; apk add iputils</span><br>fetch https:<span class="hljs-regexp">//</span>dl-cdn.alpinelinux.org<span class="hljs-regexp">/alpine/</span>v3.<span class="hljs-number">14</span><span class="hljs-regexp">/main/</span>aarch64/APKINDEX.tar.gz<br>fetch https:<span class="hljs-regexp">//</span>dl-cdn.alpinelinux.org<span class="hljs-regexp">/alpine/</span>v3.<span class="hljs-number">14</span><span class="hljs-regexp">/community/</span>aarch64/APKINDEX.tar.gz<br>v3.<span class="hljs-number">14.2</span>-<span class="hljs-number">5</span>-gd4163d4c6c [https:<span class="hljs-regexp">//</span>dl-cdn.alpinelinux.org<span class="hljs-regexp">/alpine/</span>v3.<span class="hljs-number">14</span>/main]<br>v3.<span class="hljs-number">14.2</span>-<span class="hljs-number">4</span>-ga15b4dc067 [https:<span class="hljs-regexp">//</span>dl-cdn.alpinelinux.org<span class="hljs-regexp">/alpine/</span>v3.<span class="hljs-number">14</span>/community]<br>OK: <span class="hljs-number">14810</span> distinct packages available<br>(<span class="hljs-number">1</span>/<span class="hljs-number">2</span>) Installing libcap (<span class="hljs-number">2.50</span>-r0)<br>(<span class="hljs-number">2</span>/<span class="hljs-number">2</span>) Installing iputils (<span class="hljs-number">20210202</span>-r0)<br>Executing busybox-<span class="hljs-number">1.33</span>.<span class="hljs-number">1</span>-r3.trigger<br>OK: <span class="hljs-number">6</span> MiB <span class="hljs-keyword">in</span> <span class="hljs-number">16</span> packages<br><br><span class="hljs-comment"># Ping the custom IP address we set up.</span><br>/ <span class="hljs-comment"># ping 192.168.0.1</span><br><br><span class="hljs-comment"># You should see this output (hit CTRL+C to stop it)</span><br>PING <span class="hljs-number">192.168</span>.<span class="hljs-number">0.1</span> (<span class="hljs-number">192.168</span>.<span class="hljs-number">0.1</span>) <span class="hljs-number">56</span>(<span class="hljs-number">84</span>) bytes of data.<br><span class="hljs-number">64</span> bytes from <span class="hljs-number">192.168</span>.<span class="hljs-number">0.1</span>: icmp_seq=<span class="hljs-number">1</span> ttl=<span class="hljs-number">64</span> time=<span class="hljs-number">0.336</span> ms<br><span class="hljs-number">64</span> bytes from <span class="hljs-number">192.168</span>.<span class="hljs-number">0.1</span>: icmp_seq=<span class="hljs-number">2</span> ttl=<span class="hljs-number">64</span> time=<span class="hljs-number">0.293</span> ms<br>^C<br>--- <span class="hljs-number">192.168</span>.<span class="hljs-number">0.1</span> ping statistics ---<br><span class="hljs-number">2</span> packets transmitted, <span class="hljs-number">2</span> received, <span class="hljs-number">0</span>% packet loss, time <span class="hljs-number">1013</span>ms<br>rtt min<span class="hljs-regexp">/avg/m</span>ax<span class="hljs-regexp">/mdev = 0.293/</span><span class="hljs-number">0.314</span><span class="hljs-regexp">/0.336/</span><span class="hljs-number">0.021</span> ms<br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #19</strong>: Show Total Disk Space Used by Docker</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><code class="hljs tap">ubuntu in ~ at 3BPlus<br>âœ docker system df<br>TYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLE<br>Images         <span class="hljs-number"> 3 </span>       <span class="hljs-number"> 2 </span>        203.9MB   198.5MB (97%)<br>Containers     <span class="hljs-number"> 3 </span>       <span class="hljs-number"> 1 </span>        2.524MB   0B (0%)<br>Local Volumes  <span class="hljs-number"> 1 </span>       <span class="hljs-number"> 0 </span>        0B        0B<br>Build Cache    <span class="hljs-number"> 0 </span>       <span class="hljs-number"> 0 </span>        0B        0B<br><br><span class="hljs-comment"># -v flag (verbose) - will show the unique image size for each image</span><br>ubuntu in ~ at 3BPlus<br>âœ docker system df -v<br>Images space usage:<br><br>REPOSITORY            TAG       IMAGE ID       CREATED       SIZE      SHARED SIZE   UNIQUE SIZE   CONTAINERS<br>alpine                latest    bb3de5531c18  <span class="hljs-number"> 4 </span>days ago    5.337MB   0B            5.337MB       2<br>hello-world           latest    bc11b176a293  <span class="hljs-number"> 7 </span>weeks ago   9.136kB   0B            9.136kB       1<br>bahamat/unix-1st-ed   latest    37aa142d2113  <span class="hljs-number"> 5 </span>years ago   198.5MB   0B            198.5MB       0<br><br>Containers space usage:<br><br>CONTAINER ID   IMAGE         COMMAND            LOCAL VOLUMES   SIZE      CREATED       STATUS                   NAMES<br>9023720cdee7   alpine        &quot;sh&quot;              <span class="hljs-number"> 0 </span>              2.52MB   <span class="hljs-number"> 5 </span>hours ago   Up<span class="hljs-number"> 5 </span>hours               upbeat_kepler<br>9e272ab58362   alpine        &quot;sh -c &#x27;exit 1&#x27;&quot;  <span class="hljs-number"> 0 </span>              0B       <span class="hljs-number"> 6 </span>hours ago   Exited (1)<span class="hljs-number"> 6 </span>hours ago   naughty_blackburn<br>d95cc7e19d43   hello-world   &quot;/hello&quot;          <span class="hljs-number"> 0 </span>              0B       <span class="hljs-number"> 7 </span>weeks ago   Exited (0)<span class="hljs-number"> 7 </span>weeks ago   nifty_hellman<br><br>Local Volumes space usage:<br><br>VOLUME NAME   LINKS     SIZE<br>user_my-db   <span class="hljs-number"> 0 </span>        0B<br><br>Build cache usage: 0B<br><br>CACHE ID   CACHE TYPE   SIZE      CREATED   LAST USED   USAGE     SHARED<br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #20</strong>: Docker Compose Stop vs Down</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># docker-compose stop</span><br>&gt; stop container, <span class="hljs-keyword">but</span> <span class="hljs-keyword">it</span> won&#x27;t remove them<br><br><span class="hljs-comment"># docker-compose down</span><br>&gt; stop container, removes <span class="hljs-keyword">the</span> stopped containers <span class="hljs-keyword">as</span> well <span class="hljs-keyword">as</span> any networks <span class="hljs-keyword">that</span> were created.<br><br><span class="hljs-comment"># docker-compose down -v</span><br>&gt; add remove all volumes too.<br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #21</strong>: Difference between Docker Create, Start and Run</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># Create:</span><br>  adds a writeable container <span class="hljs-keyword">on</span> top <span class="hljs-keyword">of</span> your image <span class="hljs-keyword">and</span> sets <span class="hljs-keyword">it</span> up <span class="hljs-keyword">for</span> <span class="hljs-built_in">running</span> whatever command you specified <span class="hljs-keyword">in</span> you CMD. The container ID <span class="hljs-keyword">is</span> reported <span class="hljs-keyword">back</span> <span class="hljs-keyword">but</span> <span class="hljs-keyword">it</span>&#x27;s <span class="hljs-keyword">not</span> started.<br><br><span class="hljs-comment"># Start:</span><br>  will start any stopped container.<br><br><span class="hljs-comment"># Run:</span><br>  combination <span class="hljs-keyword">of</span> create <span class="hljs-keyword">and</span> start, It creates <span class="hljs-keyword">the</span> container <span class="hljs-keyword">and</span> starts <span class="hljs-keyword">it</span>.<br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #22</strong>: Docker Mem Limit</p>
<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">é»˜è®¤æƒ…å†µä¸‹å®¹å™¨ä½¿ç”¨çš„èµ„æºä¸å—é™åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸»æœºå†…æ ¸è°ƒåº¦å™¨æ‰€å…è®¸çš„æœ€å¤§èµ„æº</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">é™åˆ¶å®¹å™¨ä¸èƒ½è¿‡å¤šçš„ä½¿ç”¨ä¸»æœºçš„å†…å­˜ï¼Œä¸€æ—¦å†…å­˜æ£€æµ‹åˆ°æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å¯ä»¥åˆ†é…ï¼Œå°±ä¼šå‡ºç°OOM(Out Of Memory Exception). å¹¶å¼€å§‹éšæœºKillä¸€äº›è¿›ç¨‹ç”¨äºé‡Šæ”¾å†…å­˜ç©ºé—´ï¼Œdockerå°è¯•è°ƒæ•´docker daemon çš„OOMä¼˜å…ˆçº§è¿›è¡Œç¼“è§£ï¼Œå†…æ ¸åœ¨é€‰æ‹©æ€æ­»çš„è¿›ç¨‹æ—¶ä¼šå¯¹æ‰€æœ‰çš„è¿›ç¨‹æ‰“åˆ†ï¼Œç›´æ¥æ€æ­»å¾—åˆ†æœ€é«˜çš„è¿›ç¨‹ï¼Œdocker daemonçš„OOMä¼˜å…ˆçº§è¢«é™ä½</span><br></code></pre></td></tr></table></figure>
<ul>
<li><a href="/misc/code/script/show_process_score.sh">show_process_score.sh</a><figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># è„šæœ¬è¾“å‡ºå¾—åˆ†æœ€é«˜çš„10ä¸ªè¿›ç¨‹,å¹¶æ’åº</span><br>  âœ ./show_process_score.sh<br>  <span class="hljs-number">672</span>  <span class="hljs-number">1510</span> <span class="hljs-regexp">/usr/</span>bin/gnome-shell<br>  <span class="hljs-number">669</span>  <span class="hljs-number">1811</span> <span class="hljs-regexp">/usr/</span>libexec/gnome-initial-setup --existing-user<br>  <span class="hljs-number">668</span>  <span class="hljs-number">1010</span> <span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/xorg/</span>Xorg vt2 -displayfd <span class="hljs-number">3</span> -auth <span class="hljs-regexp">/run/u</span>se<br>  <span class="hljs-number">667</span>  <span class="hljs-number">2062</span> update-notifier<br>  <span class="hljs-number">667</span>  <span class="hljs-number">1760</span> <span class="hljs-regexp">/usr/</span>libexec<span class="hljs-regexp">/evolution-data-server/</span>evolution-alarm<br>  <span class="hljs-number">667</span>  <span class="hljs-number">1128</span> <span class="hljs-regexp">/usr/</span>libexec/goa-daemon<br>  <span class="hljs-number">666</span>   <span class="hljs-number">996</span> <span class="hljs-regexp">/usr/</span>libexec/tracker-miner-fs<br>  <span class="hljs-number">666</span>   <span class="hljs-number">994</span> <span class="hljs-regexp">/usr/</span>bin/pulseaudio --daemonize=no --log-target=jo<br>  <span class="hljs-number">666</span>   <span class="hljs-number">988</span> (sd-pam)<br>  <span class="hljs-number">666</span>   <span class="hljs-number">987</span> <span class="hljs-regexp">/lib/</span>systemd/systemd --user<br><br><span class="hljs-comment"># é™ä½OOMé£é™©:</span><br>  - é€šè¿‡æµ‹è¯•æŒæ¡åº”ç”¨å¯¹å†…å­˜çš„éœ€æ±‚<br>  - ä¿è¯è¿è¡Œå®¹å™¨çš„ä¸»æœºæœ‰å……è¶³çš„å†…å­˜<br>  - é™åˆ¶å®¹å™¨å¯ä»¥ä½¿ç”¨çš„å†…å­˜<br>  - ä¸ºä¸»æœºé…ç½®Swap<br><br></code></pre></td></tr></table></figure></li>
<li>å‹åŠ›æµ‹è¯•å·¥å…· stress<figure class="highlight armasm"><table><tr><td class="code"><pre><code class="hljs armasm"><span class="hljs-comment"># stress</span><br>&gt; a tool for generating workload. <span class="hljs-keyword">It</span> can produce CPU, memory, I/O, <span class="hljs-keyword">and</span> disk stress.<br></code></pre></td></tr></table></figure></li>
<li><a href="/misc/code/devops/benchmark/stress.Dockerfile">stress.Dockerfile</a><figure class="highlight tap"><table><tr><td class="code"><pre><code class="hljs tap"><span class="hljs-comment"># åˆ›å»ºé•œåƒ</span><br>âœ docker build -f stress.Dockerfile -t chyiyaqing/u-stress:latest .<br><br><span class="hljs-comment"># é™åˆ¶å†…å­˜ä½¿ç”¨ä¸Šé™(memory-swapå€¼åŒ…å«å®¹å™¨å¯ç”¨å†…å­˜å’Œå¯ç”¨swap;)</span><br>âœ docker run -it -m 300M --memory-swap -1 --name con1 chyiyaqing/u-stress /bin/bash<br>root@1a3df043e956:/<span class="hljs-comment"># stress --vm 1 --vm-bytes 500M</span><br>stress: info: [9] dispatching hogs:<span class="hljs-number"> 0 </span>cpu,<span class="hljs-number"> 0 </span>io,<span class="hljs-number"> 1 </span>vm,<span class="hljs-number"> 0 </span>hdd<br><br><span class="hljs-comment"># docker stats æŸ¥çœ‹</span><br>$ docker stats<br>CONTAINER ID   NAME      CPU %     MEM USAGE / LIMIT   MEM %     NET I/O       BLOCK I/O     PIDS<br>1a3df043e956   con1      71.85%    300MiB / 300MiB     100.00%   6.71kB / 0B   3.45GB / 0B   3<br><br><span class="hljs-comment"># Topå‘½ä»¤æŸ¥çœ‹stressè¿›ç¨‹å†…å­˜å®é™…æƒ…å†µ</span><br>chyiyaqing in ~ at chyiyaqing-PowerEdge-R720 took 5s<br><span class="hljs-comment"># pgrep å‘½ä»¤æŸ¥è¯¢stresså‘½ä»¤ç›¸å…³è¿›ç¨‹</span><br>âœ pgrep stress<br>48622<br>48623<br><br>chyiyaqing in ~ at chyiyaqing-PowerEdge-R720<br>âœ top -p 48623<br>top - 22:40:23 up<span class="hljs-number"> 2 </span>days,  5:40, <span class="hljs-number"> 4 </span>users,  load average: 0.95, 0.47, 0.18<br>Tasks:  <span class="hljs-number"> 1 </span>total,  <span class="hljs-number"> 1 </span>running,  <span class="hljs-number"> 0 </span>sleeping,  <span class="hljs-number"> 0 </span>stopped,  <span class="hljs-number"> 0 </span>zombie<br>%Cpu(s):  0.1 us,  2.0 sy,  0.0 ni, 97.1 id,  0.8 wa,  0.0 hi,  0.0 si,  0.0 st<br>MiB Mem :  32106.2 total,  27283.4 free,   1420.6 used,   3402.2 buff/cache<br>MiB Swap:   2048.0 total,   1545.3 free,    502.7 used.  30224.1 avail Mem<br><br>    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND<br> <span class="hljs-number"> 48623 </span>root     <span class="hljs-number"> 20 </span> <span class="hljs-number"> 0 </span><span class="hljs-number"> 515868 </span>305460   <span class="hljs-number"> 272 </span>R  71.7   0.9   2:02.53 stress<br><br><span class="hljs-comment"># VIRT è¿›ç¨‹è™šæ‹Ÿå†…å­˜å¤§å°; RES å®é™…åˆ†é…ç‰©ç†å†…å­˜å¤§å°</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>Docker Tip #23</strong>: Docker CPU Limit</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><code class="hljs vim">&gt; é»˜è®¤æƒ…å†µä¸‹å®¹å™¨å¯ä»¥ä¸å—é™åˆ¶çš„ä½¿ç”¨CPU/å†…å­˜èµ„æº, å¦‚æœä¸å¯¹å®¹å™¨ä½¿ç”¨è¿›è¡Œé™åˆ¶ï¼Œä¸€æ—¦å‘ç”Ÿå®¹å™¨ç¨‹åºå¼‚å¸¸ä½¿ç”¨CPU/Memæƒ…å†µï¼Œå¯èƒ½ä¼šæŠŠæ•´ä¸ªä¸»æœºCPU/Memèµ„æºè€—å°½.<br><br># é™åˆ¶å¯ç”¨CPUä¸ªæ•°<br>âœ docker run --rm -it --cpus=<span class="hljs-number">2</span> chyiyaqing/<span class="hljs-keyword">u</span>-stress /bin/bash<br><br>root@f11127fe7c50:/# stress -<span class="hljs-keyword">c</span> <span class="hljs-number">4</span><br>stres<span class="hljs-variable">s:</span> info: [<span class="hljs-number">9</span>] dispatching hog<span class="hljs-variable">s:</span> <span class="hljs-number">4</span> cpu, <span class="hljs-number">0</span> io, <span class="hljs-number">0</span> <span class="hljs-keyword">vm</span>, <span class="hljs-number">0</span> hdd<br><br># docker stats<br>CONTAINER ID   NAME                CPU %     MEM USAGE / LIMIT     MEM %     NET I/O       BLOCK I/O   PIDS<br>f11127fe7c50   competent_noether   <span class="hljs-number">198.98</span>%   <span class="hljs-number">1.695</span>MiB / <span class="hljs-number">31.35</span>GiB   <span class="hljs-number">0.01</span>%     <span class="hljs-number">39.7</span>kB / <span class="hljs-number">0</span>B   <span class="hljs-number">0</span>B / <span class="hljs-number">0</span>B     <span class="hljs-number">6</span><br><br># Top<br>Task<span class="hljs-variable">s:</span> <span class="hljs-number">468</span> total,   <span class="hljs-number">5</span> running, <span class="hljs-number">463</span> sleeping,   <span class="hljs-number">0</span> stopped,   <span class="hljs-number">0</span> zombie<br>%Cpu0  :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu1  :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu2  : <span class="hljs-number">50.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni, <span class="hljs-number">50.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span>     --<br>%Cpu3  :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu4  :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu5  :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu6  :  <span class="hljs-number">5.0</span> us,  <span class="hljs-number">5.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni, <span class="hljs-number">90.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu7  :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu8  :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu9  :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu10 :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu11 : <span class="hljs-number">50.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni, <span class="hljs-number">50.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span>     --<br>%Cpu12 :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu13 : <span class="hljs-number">47.4</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni, <span class="hljs-number">52.6</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span>     --<br>%Cpu14 :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu15 :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu16 :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu17 :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu18 :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu19 :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu20 :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu21 :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu22 :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu23 :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu24 :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu25 :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu26 :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu27 :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu28 :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu29 :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu30 :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu31 : <span class="hljs-number">50.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni, <span class="hljs-number">50.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span>     --<br>MiB Mem :  <span class="hljs-number">32106.2</span> total,  <span class="hljs-number">27901.2</span> free,   <span class="hljs-number">1119.0</span> used,   <span class="hljs-number">3086.0</span> buff/cache<br>MiB Swap:   <span class="hljs-number">2048.0</span> total,   <span class="hljs-number">2044.6</span> free,      <span class="hljs-number">3.4</span> used.  <span class="hljs-number">30537.0</span> avail Mem<br><br>æŸ¥çœ‹TopçœŸå®æƒ…å†µä¸æ˜¯ä¸¤ä¸ªCPUè´Ÿè½½<span class="hljs-number">100</span>%, è€Œæ˜¯å®¹å™¨æ¶ˆè€—CPUæ€»å…±<span class="hljs-number">200</span>%çš„è´Ÿè½½ï¼Œè¿›ç¨‹æ²¡æœ‰CPUæ•°çš„é™åˆ¶ï¼Œåªèƒ½é€šè¿‡è¿›ç¨‹æ¶ˆè€—CPUæ—¶é—´ç‰‡ç»Ÿè®¡å‡ºè¿›ç¨‹å ç”¨CPUçš„ç™¾åˆ†æ¯”<br><br># æŒ‡å®šå›ºå®šCPU<br>  &gt; é€šè¿‡--cpuset-cpusè®¾ç½®å®¹å™¨è¿è¡Œåœ¨å‡ ä¸ªå›ºå®šçš„CPUä¸Š, å› ä¸ºå¤šæ ¸ç³»ç»Ÿæ¯ä¸ªæ ¸å¿ƒéƒ½æœ‰è‡ªå·±çš„ç¼“å­˜,é¢‘ç¹çš„è°ƒåº¦è¿›ç¨‹åœ¨ä¸åŒçš„æ ¸å¿ƒä¸Šæ‰§è¡Œä¼šå¸¦æ¥ç¼“å­˜å¤±æ•ˆçš„å¼€é”€<br>  chyiyaqing in ~ at chyiyaqing-PowerEdge-R720<br>  âœ docker run --rm -it --cpuset-cpus=<span class="hljs-string">&quot;0,1,2,3&quot;</span> chyiyaqing/<span class="hljs-keyword">u</span>-stress /bin/bash<br><br># å¯åŠ¨å¡”é‡Œæµ‹è¯•å‘½ä»¤<br>root@<span class="hljs-number">95110</span>b6915af:/# stress -<span class="hljs-keyword">c</span> <span class="hljs-number">10</span><br>stres<span class="hljs-variable">s:</span> info: [<span class="hljs-number">12</span>] dispatching hog<span class="hljs-variable">s:</span> <span class="hljs-number">4</span> cpu, <span class="hljs-number">0</span> io, <span class="hljs-number">0</span> <span class="hljs-keyword">vm</span>, <span class="hljs-number">0</span> hdd<br><br># docker stats<br>CONTAINER ID   NAME                 CPU %     MEM USAGE / LIMIT    MEM %     NET I/O      BLOCK I/O   PIDS<br><span class="hljs-number">39</span>b4ce536148   frosty_stonebraker   <span class="hljs-number">399.38</span>%   <span class="hljs-number">2.43</span>MiB / <span class="hljs-number">31.35</span>GiB   <span class="hljs-number">0.01</span>%     <span class="hljs-number">3.9</span>kB / <span class="hljs-number">0</span>B   <span class="hljs-number">0</span>B / <span class="hljs-number">0</span>B     <span class="hljs-number">12</span><br><br># Top<br>âœ top<br>top - <span class="hljs-number">23</span>:<span class="hljs-number">08</span>:<span class="hljs-number">19</span> <span class="hljs-keyword">up</span> <span class="hljs-number">2</span> days,  <span class="hljs-number">6</span>:<span class="hljs-number">08</span>,  <span class="hljs-number">4</span> users,  load average: <span class="hljs-number">6.97</span>, <span class="hljs-number">3.73</span>, <span class="hljs-number">2.01</span><br>Task<span class="hljs-variable">s:</span> <span class="hljs-number">496</span> total,  <span class="hljs-number">11</span> running, <span class="hljs-number">485</span> sleeping,   <span class="hljs-number">0</span> stopped,   <span class="hljs-number">0</span> zombie<br>%Cpu0  :<span class="hljs-number">100.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,  <span class="hljs-number">0.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu1  :<span class="hljs-number">100.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,  <span class="hljs-number">0.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu2  :<span class="hljs-number">100.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,  <span class="hljs-number">0.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu3  :<span class="hljs-number">100.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,  <span class="hljs-number">0.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu4  :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni, <span class="hljs-number">97.7</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">2.3</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br><br># è®¾ç½®CPUçš„æƒé‡<br>&gt; è®¾ç½®CPUæƒé‡åªæœ‰åœ¨å®¹å™¨äº‰ç”¨CPUèµ„æºçš„æƒ…å†µä¸‹ï¼ŒCPUçš„æƒé‡æ‰èƒ½è®©ä¸åŒçš„å®¹å™¨åˆ†åˆ°ä¸åŒçš„CPUç”¨é‡ --cpu-shares è®¾ç½®CPUæƒé‡ï¼Œé»˜è®¤å€¼ä¸º<span class="hljs-number">1024</span>,<br><br># è¿è¡Œä¸¤ä¸ªå®¹å™¨ï¼ŒæŒ‡å®šä½¿ç”¨CPU0ï¼Œåˆ†åˆ«è®¾ç½®--cpu-shares <span class="hljs-number">512</span>,<span class="hljs-number">1024</span><br>  âœ docker run --rm -it --cpuset-cpus=<span class="hljs-string">&quot;0&quot;</span> --cpu-shares=<span class="hljs-number">512</span> chyiyaqing/<span class="hljs-keyword">u</span>-stress /bin/bash<br>  âœ docker run --rm -it --cpuset-cpus=<span class="hljs-string">&quot;0&quot;</span> --cpu-shares=<span class="hljs-number">1024</span> chyiyaqing/<span class="hljs-keyword">u</span>-stress /bin/bash<br><br># ä¸¤ä¸ªå®¹å™¨éƒ½è¿è¡Œstress -<span class="hljs-keyword">c</span> <span class="hljs-number">4</span><br><br># top<br>âœ top<br>top - <span class="hljs-number">23</span>:<span class="hljs-number">14</span>:<span class="hljs-number">14</span> <span class="hljs-keyword">up</span> <span class="hljs-number">2</span> days,  <span class="hljs-number">6</span>:<span class="hljs-number">14</span>,  <span class="hljs-number">5</span> users,  load average: <span class="hljs-number">5.30</span>, <span class="hljs-number">5.25</span>, <span class="hljs-number">3.42</span><br>Task<span class="hljs-variable">s:</span> <span class="hljs-number">495</span> total,   <span class="hljs-number">9</span> running, <span class="hljs-number">486</span> sleeping,   <span class="hljs-number">0</span> stopped,   <span class="hljs-number">0</span> zombie<br>%Cpu0  :<span class="hljs-number">100.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,  <span class="hljs-number">0.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br>%Cpu1  :  <span class="hljs-number">0.0</span> us,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>,  <span class="hljs-number">0.0</span> ni,<span class="hljs-number">100.0</span> id,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>,  <span class="hljs-number">0.0</span> si,  <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span><br><br># docker stats<br>CONTAINER ID   NAME                CPU %     MEM USAGE / LIMIT     MEM %     NET I/O       BLOCK I/O   PIDS<br>f9c8864fab87   beautiful_neumann   <span class="hljs-number">66.39</span>%    <span class="hljs-number">1.695</span>MiB / <span class="hljs-number">31.35</span>GiB   <span class="hljs-number">0.01</span>%     <span class="hljs-number">5.23</span>kB / <span class="hljs-number">0</span>B   <span class="hljs-number">0</span>B / <span class="hljs-number">0</span>B     <span class="hljs-number">6</span><br><span class="hljs-number">6</span>b69afc7fea5   pensive_vaughan     <span class="hljs-number">33.41</span>%    <span class="hljs-number">1.676</span>MiB / <span class="hljs-number">31.35</span>GiB   <span class="hljs-number">0.01</span>%     <span class="hljs-number">7.17</span>kB / <span class="hljs-number">0</span>B   <span class="hljs-number">0</span>B / <span class="hljs-number">0</span>B     <span class="hljs-number">6</span><br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #24</strong>: Docker import/export vs. load/save</p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><code class="hljs vbnet">âœ docker --help | grep -E <span class="hljs-string">&quot;(export|import|load|save)&quot;</span><br>export      Export a container<span class="hljs-comment">&#x27;s filesystem as a tar archive</span><br>import      Import the contents <span class="hljs-keyword">from</span> a tarball <span class="hljs-keyword">to</span> create a filesystem image<br>load        Load an image <span class="hljs-keyword">from</span> a tar archive <span class="hljs-built_in">or</span> STDIN<br>save        Save one <span class="hljs-built_in">or</span> more images <span class="hljs-keyword">to</span> a tar archive (streamed <span class="hljs-keyword">to</span> STDOUT <span class="hljs-keyword">by</span> <span class="hljs-keyword">default</span>)<br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #25</strong>: Dockerç½‘ç»œæ¨¡å¼</p>
<table>
<thead>
<tr>
<th align="left">Docker ç½‘ç»œæ¨¡å¼</th>
<th align="left">é…ç½®</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">hostæ¨¡å¼</td>
<td align="left">-net=host</td>
<td align="left">å®¹å™¨å’Œå®¿ä¸»æœºå…±äº«Network namespace</td>
</tr>
<tr>
<td align="left">container æ¨¡å¼</td>
<td align="left">-net=container:NAME_or_ID</td>
<td align="left">å®¹å™¨ä¸å¦å¤–ä¸€ä¸ªå®¹å™¨å…±äº«Network namespace, kubernetesä¸­çš„podå°±æ˜¯å¤šä¸ªå®¹å™¨å…±äº«ä¸€ä¸ªNetwork namespace</td>
</tr>
<tr>
<td align="left">noneæ¨¡å¼</td>
<td align="left">-net=none</td>
<td align="left">å®¹å™¨æœ‰ç‹¬ç«‹çš„Network namespace,ä½†å¹¶æ²¡æœ‰å¯¹å…¶è¿›è¡Œä»»ä½•ç½‘ç»œè®¾ç½®</td>
</tr>
<tr>
<td align="left">bridgeæ¨¡å¼</td>
<td align="left">-net=bridge</td>
<td align="left">é»˜è®¤ä¸ºè¯¥æ¨¡å¼</td>
</tr>
</tbody></table>
<figure class="highlight less"><table><tr><td class="code"><pre><code class="hljs less"># å®ç°åŸç†<br>  &gt; å®¿ä¸»æœºè™šæ‹Ÿä¸€ä¸ª<span class="hljs-selector-tag">Docker</span>å®¹å™¨ç½‘æ¡¥(docker0), <span class="hljs-selector-tag">Docker</span>å¯åŠ¨ä¸€ä¸ªå®¹å™¨æ—¶ä¼šæ ¹æ®<span class="hljs-selector-tag">Docker</span>ç½‘æ¡¥(docker0)çš„ç½‘æ®µåˆ†é…ç»™å®¹å™¨ä¸€ä¸ª<span class="hljs-selector-tag">IP</span>åœ°å€ï¼Œç§°ä¸º<span class="hljs-selector-tag">Container-IP</span>,åŒæ—¶<span class="hljs-selector-tag">Docker</span>ç½‘æ¡¥æ˜¯æ¯ä¸ªå®¹å™¨çš„é»˜è®¤ç½‘å…³.å› ä¸ºåŒä¸€å®¿ä¸»æœºå†…çš„å®¹å™¨éƒ½æ¥å…¥åŒä¸€ç½‘æ¡¥ï¼Œè¿™æ ·å®¹å™¨ä¹‹é—´å°±èƒ½å¤Ÿé€šè¿‡å®¹å™¨çš„<span class="hljs-selector-tag">Container-IP</span>ç›´æ¥é€šä¿¡.<br>  &gt; <span class="hljs-selector-tag">Docker</span>ç½‘æ¡¥æ˜¯å®¿ä¸»ä¸»æœºè™šæ‹Ÿå‡ºæ¥çš„ï¼Œå¹¶ä¸æ˜¯çœŸæ˜¯å­˜åœ¨çš„ç½‘ç»œè®¾å¤‡ï¼Œå¤–éƒ¨ç½‘ç»œæ˜¯æ— æ³•å¯»å€åˆ°ï¼Œå¦‚æœå®¹å™¨å¸Œæœ›å¤–éƒ¨èƒ½å¤Ÿè®¿é—®åˆ°ï¼Œå¯ä»¥é€šè¿‡æ˜ å°„å®¹å™¨ç«¯å£åˆ°å®¿ä¸»ä¸»æœº(ç«¯å£æ˜ å°„),è®¿é—®å®¹å™¨çš„æ—¶å€™å°±é€šè¿‡<span class="hljs-selector-attr">[å®¿ä¸»ä¸»æœºIP]</span>:<span class="hljs-selector-attr">[å®¹å™¨ç«¯å£]</span>è®¿é—®å®¹å™¨<br><br></code></pre></td></tr></table></figure>
<ul>
<li>hostæ¨¡å¼<br><img src="/misc/images/docker-network-host.png" alt="Hostæ¨¡å¼"><figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">å®¹å™¨ä½¿ç”¨hostæ¨¡å¼å°†ä½¿ç”¨å®¿ä¸»ä¸»æœºçš„IPå’Œç«¯å£,å®¹å™¨çš„å…¶ä»–æ–¹é¢ï¼Œæ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹åˆ—è¡¨è¿˜æ˜¯å’Œå®¿ä¸»ä¸»æœºéš”ç¦»</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">ä½¿ç”¨hostæ¨¡å¼çš„å®¹å™¨å¯ä»¥ç›´æ¥ä½¿ç”¨å®¿ä¸»ä¸»æœºçš„IPåœ°å€ä¸å¤–ç•Œé€šä¿¡ï¼Œå®¹å™¨å†…éƒ¨çš„æœåŠ¡ç«¯å£ä¹Ÿå¯ä»¥ä½¿ç”¨å®¿ä¸»ä¸»æœºçš„ç«¯å£ï¼Œä¸éœ€è¦è¿›è¡ŒNATï¼Œhostæœ€å¤§ä¼˜åŠ¿æ˜¯ç½‘ç»œæ€§èƒ½æ¯”è¾ƒå¥½ï¼Œä½†æ˜¯docker hostä¸Šå·²ç»ä½¿ç”¨çš„ç«¯å£å°±ä¸èƒ½å†ä½¿ç”¨,ç½‘ç»œéš”ç¦»å‹ä¸å¥½</span><br></code></pre></td></tr></table></figure></li>
<li>containeræ¨¡å¼<br><img src="/misc/images/docker-network-container.png" alt="Containeræ¨¡å¼"><figure class="highlight armasm"><table><tr><td class="code"><pre><code class="hljs armasm">&gt; æ–°åˆ›å»ºçš„å®¹å™¨å’Œå·²ç»å­˜åœ¨çš„ä¸€ä¸ªå®¹å™¨å…±äº«ä¸€ä¸ªNetwork Namespace.æ–°åˆ›å»ºçš„å®¹å™¨ä¸ä¼šåˆ›å»ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„<span class="hljs-built_in">IP</span>ï¼Œè€Œæ˜¯å’ŒæŒ‡å®šçš„å®¹å™¨å…±äº«<span class="hljs-built_in">IP</span>å’Œç«¯å£èŒƒå›´, ä¸¤ä¸ªå®¹å™¨çš„è¿›ç¨‹å¯ä»¥é€šè¿‡loç½‘å¡è®¾å¤‡é€šä¿¡<br></code></pre></td></tr></table></figure></li>
<li>noneæ¨¡å¼<br><img src="/misc/images/docker-network-none.png" alt="Noneæ¨¡å¼"><figure class="highlight fortran"><table><tr><td class="code"><pre><code class="hljs fortran">&gt; <span class="hljs-keyword">None</span>æ¨¡å¼,Dockerå®¹å™¨æ‹¥æœ‰è‡ªå·±çš„Network Namespace,ä½†æ˜¯ï¼Œå¹¶ä¸ä¸ºDockerå®¹å™¨è¿›è¡Œä»»ä½•ç½‘ç»œé…ç½®ï¼ŒDockerå®¹å™¨æ²¡æœ‰ç½‘å¡ã€IPã€è·¯ç”±,éœ€è¦è‡ªå·±å¯¹Dockerå®¹å™¨æ·»åŠ ç½‘å¡ã€é…ç½®IP<br>&gt; <span class="hljs-keyword">None</span>æ¨¡å¼ä¸‹åªæœ‰loå›ç¯ç½‘ç»œï¼Œæ²¡æœ‰å…¶ä»–ç½‘å¡ï¼Œ<span class="hljs-keyword">None</span>æ¨¡å¼å¯ä»¥åœ¨å®¹å™¨åˆ›å»ºæ—¶é€šè¿‡network=<span class="hljs-keyword">None</span>æŒ‡å®šï¼Œè¿™ç±»ç½‘ç»œæ²¡åŠæ³•è”ç½‘ï¼Œå°é—­çš„ç½‘ç»œèƒ½å¾ˆå¥½çš„ä¿è¯å®¹å™¨çš„å®‰å…¨<br></code></pre></td></tr></table></figure></li>
<li>bridgeæ¨¡å¼<br><img src="/misc/images/docker-network-bridge.png" alt="Bridgeæ¨¡å¼"><figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">bridgeæ¨¡å¼æ˜¯dockeré»˜è®¤ç½‘ç»œæ¨¡å¼,ä¸å†™--netå‚æ•°å°±æ˜¯bridgeæ¨¡å¼</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>Docker Tip #26</strong>: Alphine Linux Dockerfile</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><code class="hljs subunit">chyiyaqing in core at chyiyaqing-PowerEdge-R720 on î‚  feat/adaptation-kingbases [!?] via ğŸ¹ v1.17.1 on ğŸ³ v20.10.10<br>âœ docker run core:BF<span class="hljs-string">-9748</span><br><span class="hljs-keyword">Error </span>relocating /root/core/blocface-core: __vfprintf_chk: symbol not found<br><span class="hljs-keyword">Error </span>relocating /root/core/blocface-core: __fprintf_chk: symbol not found<br><br>åœ¨Alpine Linuxä¸Š, not foundé”™è¯¯æ˜¯åŠ¨æ€é“¾æ¥å¤±è´¥çš„å…¸å‹ç‰¹å¾ï¼Œmuslçš„lddé“¾æ¥å™¨å­˜åœ¨ä¸€ä¸ªç›¸å½“æ··ä¹±çš„é”™è¯¯ï¼Œå¤§å¤šæ•°Linuxè½¯ä»¶éƒ½æ˜¯ä¸glibc(GNUlibcåº“)ç›¸é“¾æ¥(libcæä¾›äº†æ ‡å‡†çš„Cåº“å’Œposixapi),å¤§å¤šæ•°Linuxå‘è¡Œç‰ˆæœ¬éƒ½æ˜¯åŸºäºglibc, alpineLinuxæ˜¯åŸºäºmuslibcåº“(è¿™æ˜¯æœ€å°çš„å®ç°ï¼Œä¸¥æ ¼éµå®ˆPOSIX).<br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #27</strong>: é˜²æ­¢å®¹å™¨è‡ªåŠ¨é€€å‡º</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><code class="hljs gherkin">&gt; dockerå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸæ˜¯åŒå®¹å™¨ä¸­çš„å‰ç½®è¿›ç¨‹ç›¸å…³åœ¨ä¸€èµ·,å‰ç½®è¿›ç¨‹è¿è¡Œç»“æŸåï¼Œå®¹å™¨ä¾¿è‡ªåŠ¨é€€å‡º<br><br>ä¸‹æ–‡ä½¿ç”¨alpineé•œåƒåšä¸ºåŸºç¡€é•œåƒï¼Œåˆ›å»ºä¸€ä¸ªalpineç³»ç»Ÿå°å®¹å™¨,è®©å…¶å¯ä»¥å¸¸é©»è¿è¡Œï¼Œä»¥ä¾¿æˆ‘ä»¬ç™»é™†äº¤äº’æ‰§è¡Œ<br><br>  <span class="hljs-comment"># ä½¿ç”¨alpineç³»ç»Ÿé•œåƒåˆ›å»ºå®¹å™¨</span><br>  <span class="hljs-comment"># -i interactive=true å¼€å¯stdin</span><br>  <span class="hljs-comment"># -t tty=true åˆ†é…ä¼šè¯ç»ˆç«¯</span><br>  <span class="hljs-comment"># -d å®ˆæŠ¤æ¨¡å¼ ä¸åŠ å°±ç›´æ¥è¿›å…¥å®¹å™¨ä¸­éœ€è¦ctrl+p+qåˆ‡å‡ºï¼Œ</span><br><br>  chyiyaqing in ~ at chyiyaqing-PowerEdge-R720 took 9s<br>  âœ docker run -it -d --name my_alpine alpine sh<br>  Unable to find image &#x27;alpine:latest&#x27; locally<br>  latest: Pulling from library/alpine<br>  a0d0a0d46f8b: Pull complete<br>  Digest: sha256:e1c082e3d3c45cccac829840a25941e679c25d438cc8412c2fa221cf1a824e6a<br>  Status: Downloaded newer image for alpine:latest<br>  78c0429dd98fe42addaa2071ffe1ca6c22295ea6d6d465ff1f970644f6234a37<br><br>  <span class="hljs-comment"># my_alpine å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€</span><br>  chyiyaqing in ~ at chyiyaqing-PowerEdge-R720 took 8s<br>  âœ docker ps |<span class="hljs-string"> grep alpine</span><br><span class="hljs-string">  78c0429dd98f   alpine                                                          &quot;sh&quot;                     34 seconds ago   Up 34 seconds                                                         my_alpine</span><br><span class="hljs-string"></span><br><span class="hljs-string">  # ç™»å…¥å®¹å™¨</span><br><span class="hljs-string">  chyiyaqing in ~ at chyiyaqing-PowerEdge-R720</span><br><span class="hljs-string">  âœ docker exec -it my_alpine sh</span><br><span class="hljs-string"></span><br><span class="hljs-string">  # æŸ¥çœ‹ sh ä¼šè¯æ•°é‡</span><br><span class="hljs-string">  / # ps</span><br><span class="hljs-string">  PID   USER     TIME  COMMAND</span><br><span class="hljs-string">      1 root      0:00 sh</span><br><span class="hljs-string">      7 root      0:00 sh</span><br><span class="hljs-string">     13 root      0:00 ps</span><br><span class="hljs-string"></span><br><span class="hljs-string">  # alpineä½¿ç”¨apkåšä¸ºåŒ…ç®¡ç†</span><br><span class="hljs-string">  / # apk add sl</span><br><span class="hljs-string">  fetch https://dl-cdn.alpinelinux.org/alpine/v3.14/main/x86_64/APKINDEX.tar.gz</span><br><span class="hljs-string">  fetch https://dl-cdn.alpinelinux.org/alpine/v3.14/community/x86_64/APKINDEX.tar.gz</span><br><span class="hljs-string">  (1/3) Installing ncurses-terminfo-base (6.2_p20210612-r0)</span><br><span class="hljs-string">  (2/3) Installing ncurses-libs (6.2_p20210612-r0)</span><br><span class="hljs-string">  (3/3) Installing sl (5.02-r0)</span><br><span class="hljs-string">  Executing busybox-1.33.1-r3.trigger</span><br><span class="hljs-string">  OK: 6 MiB in 17 packages</span><br><span class="hljs-string">  / # sl</span><br><span class="hljs-string">            (@@@@)</span><br><span class="hljs-string"></span><br><span class="hljs-string">          (   )</span><br><span class="hljs-string">        ====        ________                ___________</span><br><span class="hljs-string">    _D _</span>|<span class="hljs-string">  </span>|<span class="hljs-string">_______/        \__I_I_____===__</span>|<span class="hljs-string">_________</span>|<br>     |<span class="hljs-string">(_)---  </span>|<span class="hljs-string">   H\________/ </span>|<span class="hljs-string">   </span>|<span class="hljs-string">        =</span>|<span class="hljs-string">___ ___</span>|<span class="hljs-string">      _________________</span><br><span class="hljs-string">     /     </span>|<span class="hljs-string">  </span>|<span class="hljs-string">   H  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">     </span>|<span class="hljs-string">   </span>|<span class="hljs-string">         </span>||<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>||<span class="hljs-string">     _</span>|<span class="hljs-string">                \_____A</span><br><span class="hljs-string">    </span>|<span class="hljs-string">      </span>|<span class="hljs-string">  </span>|<span class="hljs-string">   H  </span>|<span class="hljs-string">__--------------------</span>|<span class="hljs-string"> [___] </span>|<span class="hljs-string">   =</span>|<span class="hljs-string">                        </span>|<br>    |<span class="hljs-string"> ________</span>|<span class="hljs-string">___H__/__</span>|<span class="hljs-string">_____/[][]~\_______</span>|<span class="hljs-string">       </span>|<span class="hljs-string">   -</span>|<span class="hljs-string">                        </span>|<br>    |<span class="hljs-string">/ </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-----------I_____I [][] []  D   </span>|<span class="hljs-string">=======</span>|<span class="hljs-string">____</span>|<span class="hljs-string">________________________</span>|_<br>  __/ =|<span class="hljs-string"> o </span>|<span class="hljs-string">=-~O=====O=====O=====O\ ____Y___________</span>|<span class="hljs-string">__</span>|<span class="hljs-string">__________________________</span>|_<br>   |<span class="hljs-string">/-=</span>|<span class="hljs-string">___</span>|<span class="hljs-string">=    </span>||<span class="hljs-string">    </span>||<span class="hljs-string">    </span>||<span class="hljs-string">    </span>|<span class="hljs-string">_____/~\___/          </span>|<span class="hljs-string">_D__D__D_</span>|<span class="hljs-string">  </span>|<span class="hljs-string">_D__D__D_</span>|<br>    \_/      \__/  \__/  \__/  \__/      \_/               \_/   \_/    \_/   \_/<br><br><span class="hljs-comment"># æäº¤å®¹å™¨å˜æ›´ç”Ÿæˆæ–°çš„é•œåƒ</span><br>chyiyaqing in ~ at chyiyaqing-PowerEdge-R720 took 2m 57s<br>âœ docker commit -m <span class="hljs-string">&quot;alpine with sl cmd&quot;</span> -a <span class="hljs-string">&quot;big_cat&quot;</span> my_alpine chyiyaqing/alpine_sl<br>sha256:79981bb43b0e638cc193570456ad93793a8cb481c8940e4fd899a0cc60a8bd46<br><br><span class="hljs-comment"># å‘å¸ƒåˆ°Docker Hub</span><br>chyiyaqing in ~ at chyiyaqing-PowerEdge-R720 took 10s<br>âœ docker push chyiyaqing/alpine_sl<br>Using default tag: latest<br>The push refers to repository [docker.io/chyiyaqing/alpine_sl]<br>102b73ff0977: Pushed<br>e2eb06d8af82: Mounted from library/alpine<br>latest: digest: sha256:500e9b9536a4fec460c487867d3cd7084da934ba37151aa122f4be438cc06d57 size: 739<br><br><span class="hljs-comment"># åœæ­¢/å¯åŠ¨å®¹å™¨</span><br>$ docker stop/start  my_alpine<br></code></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #28</strong>: Dockerç›®å½•ç©ºé—´</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><code class="hljs perl"><span class="hljs-comment"># æŸ¥çœ‹dockerå·¥ä½œæ ¹ç›®å½•</span><br>[hyperchain@mini <span class="hljs-keyword">package</span>]$ docker info | <span class="hljs-keyword">grep</span>  <span class="hljs-string">&#x27;Docker Root Dir&#x27;</span><br>Docker Root Dir: <span class="hljs-regexp">/var/li</span>b/docker<br><br><span class="hljs-comment"># æŸ¥çœ‹å·¥ä½œç›®å½•å ç”¨ç©ºé—´å¤§å°</span><br>[hyperchain@mini <span class="hljs-keyword">package</span>]$ sudo du -sh /var/lib/docker/<br><span class="hljs-number">65</span>G     /var/lib/docker/<br><br><span class="hljs-comment"># æŸ¥çœ‹dockerå ç”¨ç£ç›˜ç©ºé—´</span><br>[hyperchain@mini <span class="hljs-keyword">package</span>]$ docker <span class="hljs-keyword">system</span> df<br>TYPE                TOTAL               ACTIVE              SIZE                RECLAIMABLE<br>Images              <span class="hljs-number">22</span>                  <span class="hljs-number">0</span>                   <span class="hljs-number">11.07</span>GB             <span class="hljs-number">11.07</span>GB (<span class="hljs-number">100</span>%)<br>Containers          <span class="hljs-number">0</span>                   <span class="hljs-number">0</span>                   0B                  0B<br>Local Volumes       <span class="hljs-number">120</span>                 <span class="hljs-number">0</span>                   <span class="hljs-number">56.7</span>GB              <span class="hljs-number">56.7</span>GB (<span class="hljs-number">100</span>%)<br>Build Cache         <span class="hljs-number">0</span>                   <span class="hljs-number">0</span>                   0B                  0B<br><br><span class="hljs-comment"># æ¸…ç†dockeræ²¡æœ‰è¢«ä½¿ç”¨çš„dockeré•œåƒ</span><br>[hyperchain@mini <span class="hljs-keyword">package</span>]$ docker <span class="hljs-keyword">system</span> prune -a<br>WARNING! This will remove:<br>        - all stopped containers<br>        - all networks <span class="hljs-keyword">not</span> used by at least one container<br>        - all dangling images<br>        - all dangling build cache<br>Are you sure you want to <span class="hljs-keyword">continue</span>? [<span class="hljs-keyword">y</span>/N] <span class="hljs-keyword">y</span><br>Total reclaimed space: 0B<br><br><span class="hljs-comment"># åœæ­¢dockeræœåŠ¡</span><br>[hyperchain@mini <span class="hljs-keyword">package</span>]$ systemctl stop docker<br>==== AUTHENTICATING FOR org.freedesktop.systemd1.manage-units ====<br>Authentication is required to stop <span class="hljs-string">&#x27;docker.service&#x27;</span>.<br>Authenticating as: hyperchain<br>Password:<br>==== AUTHENTICATION COMPLETE ====<br>[hyperchain@mini <span class="hljs-keyword">package</span>]$<br><br><span class="hljs-comment"># åˆ é™¤ volumnes</span><br>[hyperchain@mini <span class="hljs-keyword">package</span>]$ docker volume prune<br>WARNING! This will remove all <span class="hljs-keyword">local</span> volumes <span class="hljs-keyword">not</span> used by at least one container.<br>Are you sure you want to <span class="hljs-keyword">continue</span>? [<span class="hljs-keyword">y</span>/N] <span class="hljs-keyword">y</span><br>Deleted Volumes:<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Have-a-Fun"><a href="#Have-a-Fun" class="headerlink" title="Have a Fun"></a>Have a Fun</h2><ul>
<li>Run the First Edition of Unix (1972) with Docker<blockquote>
<p>Run a PDP-11 simulator through Docker to interact with Unix as it was back in 1972</p>
</blockquote>
<figure class="highlight stata"><table><tr><td class="code"><pre><code class="hljs stata">$ docker <span class="hljs-keyword">run</span> --<span class="hljs-keyword">rm</span> -it bahamat/unix-1st-<span class="hljs-keyword">ed</span><br></code></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>Cloud Native</category>
      </categories>
  </entry>
  <entry>
    <title>hexo-next-gitalk</title>
    <url>/2021/09/01/hexo-next-gitalk/</url>
    <content><![CDATA[<h3 id="ç«™ç‚¹æ­å»ºè¿‡ç¨‹"><a href="#ç«™ç‚¹æ­å»ºè¿‡ç¨‹" class="headerlink" title="ç«™ç‚¹æ­å»ºè¿‡ç¨‹"></a>ç«™ç‚¹æ­å»ºè¿‡ç¨‹</h3><ul>
<li><a href="https://hexo.io/zh-cn/">hexo</a> : å¿«é€Ÿã€ç®€æ´ä¸”é«˜æ ¡çš„åšå®¢æ¡†æ¶</li>
<li><a href="https://github.com/next-theme/hexo-theme-next/blob/master/docs/zh-CN/README.md">next</a> : Hexoä¸»é¢˜</li>
<li><a href="https://github.com/gitalk/gitalk">gitalk</a> : ä¾é GitHub issueçš„è¯„è®ºç³»ç»Ÿ</li>
</ul>
<span id="more"></span>

<h3 id="Settings-amp-Tips"><a href="#Settings-amp-Tips" class="headerlink" title="Settings &amp; Tips"></a>Settings &amp; Tips</h3><ul>
<li><p><strong>Show descripion</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"># ä¿®æ”¹themes/next/_config.yml<br>excerpt_description: true<br><br># æ–‡ç« æˆªæ–­<br><span class="hljs-comment">&lt;!--more--&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p><strong>å­—æ•°ç»Ÿè®¡</strong></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># å®‰è£…æ’ä»¶ hexo-symbols-count-time</span><br><span class="hljs-string">$</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-string">hexo-symbols-count-time</span><br><br><span class="hljs-comment"># ä¿®æ”¹hexoé…ç½®æ–‡ä»¶_config.yml</span><br>  <span class="hljs-comment"># Symbols count and time to read of articles for Hexo.</span><br>  <span class="hljs-attr">symbols_count_time:</span><br>      <span class="hljs-attr">symbols:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">time:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">total_symbols:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">total_time:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment"># ä¿®æ”¹Nexté…ç½®æ–‡ä»¶</span><br>  <span class="hljs-comment"># Post wordcount display settings</span><br>  <span class="hljs-comment"># Dependencies: https://github.com/next-theme/hexo-word-counter</span><br>  <span class="hljs-attr">symbols_count_time:</span><br>    <span class="hljs-attr">separated_meta:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">item_text_post:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">item_text_total:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">awl:</span> <span class="hljs-number">4</span><br>    <span class="hljs-attr">wpm:</span> <span class="hljs-number">275</span><br></code></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>Computer Science</category>
      </categories>
  </entry>
  <entry>
    <title>micro-services</title>
    <url>/2021/09/01/micro-services/</url>
    <content><![CDATA[<blockquote>
<p>é¡¹ç›®å·¥ç¨‹åŒ–ã€å¾®æœåŠ¡ç›¸å…³ä»‹ç»</p>
</blockquote>
<span id="more"></span>

<h2 id="é¡¹ç›®å·¥ç¨‹åŒ–"><a href="#é¡¹ç›®å·¥ç¨‹åŒ–" class="headerlink" title="é¡¹ç›®å·¥ç¨‹åŒ–"></a>é¡¹ç›®å·¥ç¨‹åŒ–</h2><ul>
<li><p>å¼€æºè§„èŒƒ</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># å¼€æºåè®®</span><br><span class="hljs-bullet">  1.</span> GPL - General Public License<br><span class="hljs-code">    &gt; è¡ç”Ÿä»£ç çš„åˆ†å‘éœ€è¦å¼€æºå¹¶ä¸”ä¹Ÿè¦éµå®ˆæ­¤åè®®</span><br><span class="hljs-code">  2. MPL</span><br><span class="hljs-code">    &gt; å…è®¸å…è´¹é‡å‘å¸ƒã€å…è´¹ä¿®æ”¹ï¼Œä½†è¦æ±‚ä¿®æ”¹çš„ä»£ç ç‰ˆæƒå½’è½¯ä»¶å‘èµ·è€…ï¼Œè¿™ç§æˆæƒç»´æŠ¤äº†å•†ä¸šè½¯ä»¶çš„åˆ©ç›Šï¼Œè¦æ±‚åŸºäºè¿™ç§è½¯ä»¶çš„ä¿®æ”¹æ— å¿è´¡çŒ®ç‰ˆæƒç»™è¯¥è½¯ä»¶</span><br><span class="hljs-code">  3. LGPL</span><br><span class="hljs-code">  4. Apache</span><br><span class="hljs-code">    &gt; Apache 2.0åè®®é™¤äº†ä¸ºç”¨æˆ·æä¾›ç‰ˆæƒè®¸å¯ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸“åˆ©è®¸å¯ï¼Œé€‚åˆè®¾è®¡ä¸“åˆ©å†…å®¹çš„é¡¹ç›®</span><br><span class="hljs-code">  5. BSD</span><br><span class="hljs-code">    &gt;</span><br><span class="hljs-code">  6. MIT</span><br><span class="hljs-code">    &gt; MIT åè®®æ˜¯æ‰€æœ‰å¼€æºè®¸å¯ä¸­æœ€å®½æ¾çš„ä¸€ä¸ªï¼Œé™¤äº†ç»†ç¬”åŒ…å«è®¸å¯å£°æ˜ä¹‹å¤–ï¼Œå†æ— ä»»ä½•é™åˆ¶</span><br></code></pre></td></tr></table></figure></li>
<li><p>å¼€æºè§„èŒƒ</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> é¡¹ç›®ç»“æ„:<br><span class="hljs-bullet">2.</span> ä¸¥æ ¼éµå¾ªä»£ç è§„èŒƒ:<br><span class="hljs-bullet">3.</span> ä»£ç è´¨é‡:<br><span class="hljs-bullet">4.</span> å•å…ƒæµ‹è¯•è¦†ç›–ç‡:<br><span class="hljs-bullet">5.</span> ç‰ˆæœ¬å‘å¸ƒè§„èŒƒ:<br><span class="hljs-bullet">6.</span> å‘ä¸‹å…¼å®¹:<br><span class="hljs-bullet">7.</span> è¯¦ç»†çš„æ–‡æ¡£è¯´æ˜:<br><span class="hljs-bullet">8.</span> å®‰å…¨:<br></code></pre></td></tr></table></figure></li>
<li><p>æ–‡æ¡£è§„èŒƒ</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> READMEæ–‡æ¡£<br>  ä»‹ç»é¡¹ç›®åŠŸèƒ½ã€å®‰è£…ã€éƒ¨ç½²ã€ä½¿ç”¨<br><span class="hljs-bullet">2.</span> é¡¹ç›®æ–‡æ¡£<br>  å¼€å‘æ–‡æ¡£: è¯´æ˜é¡¹ç›®çš„å¼€å‘æµç¨‹<br>  ç”¨æˆ·æ–‡æ¡£:<br><span class="hljs-bullet">3.</span> APIæ¥å£æ–‡æ¡£<br></code></pre></td></tr></table></figure></li>
<li><p>ç‰ˆæœ¬è§„èŒƒ</p>
<figure class="highlight tp"><table><tr><td class="code"><pre><code class="hljs tp">è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ: SemVer: ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å· (<span class="hljs-keyword">X</span>.<span class="hljs-keyword">Y</span>.<span class="hljs-keyword">Z</span>), XYZä¸ºéè´Ÿçš„æ•´æ•°ï¼Œç¦æ­¢åœ¨æ•°å­—å‰æ–¹è¡¥é›¶<br>  ä¸»ç‰ˆæœ¬å·: MAJOR: å½“åšäº†ä¸å…¼å®¹APIä¿®æ”¹<br>  æ¬¡ç‰ˆæœ¬å·: MINOR: å½“åšäº†å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ–°å¢åŠä¿®æ”¹ -- å¶æ•°ä¸ºç¨³å®šç‰ˆæœ¬ï¼Œå¥‡æ•°ä¸ºå¼€å‘ç‰ˆæœ¬<br>  ä¿®è®¢å·:PATCH: å‘ä¸‹å…¼å®¹é—®é¢˜ä¿®æ­£<br><br><span class="hljs-keyword">X</span>.<span class="hljs-keyword">Y</span>.<span class="hljs-keyword">Z</span>[-å…ˆè¡Œç‰ˆæœ¬å·][+ç‰ˆæœ¬ç¼–è¯‘å…ƒæ•°æ®]<br><br><span class="hljs-number">1</span>. å®é™…å¼€å‘çš„æ—¶å€™ï¼Œä½¿ç”¨<span class="hljs-number">0</span><span class="hljs-number">.1</span><span class="hljs-number">.0</span>ä½œä¸ºç¬¬ä¸€å¼€å‘ç‰ˆæœ¬å·<br>fixç±»å‹çš„commit å¯ä»¥å°†ä¿®è®¢å·+<span class="hljs-number">1</span><br>featç±»å‹çš„commitå¯ä»¥å°†æ¬¡ç‰ˆæœ¬å·+<span class="hljs-number">1</span><br>breaking changeçš„commitå°†ä¸»ç‰ˆæœ¬å·+<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li>
<li><p>Commit è§„èŒƒ</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><code class="hljs dts">Commit MessageåŒ…å«ä¸‰éƒ¨åˆ†:<br><span class="hljs-symbol">  Header:</span> <span class="hljs-params">&lt;type&gt;</span>[optional scope]: <span class="hljs-params">&lt;description&gt;</span><br><span class="hljs-symbol">    type:</span><br><span class="hljs-symbol">      feat:</span> æ–°å¢åŠŸèƒ½<br><span class="hljs-symbol">      fix:</span> Bugä¿®å¤<br><span class="hljs-symbol">      perf:</span> æé«˜ä»£ç æ€§èƒ½çš„å˜æ›´<br><span class="hljs-symbol">      style:</span> ä»£ç æ ¼å¼ç±»çš„å˜æ›´<br><span class="hljs-symbol">      refactor:</span> å…¶ä»–ä»£ç ç±»çš„å˜æ›´ï¼Œè¿™äº›å˜æ›´ä¸å±äºfeat,fix,perfå’Œstyle. ç®€åŒ–ä»£ç ï¼Œé‡å‘½åå˜é‡ã€åˆ é™¤å†—ä½™ä»£ç <br><span class="hljs-symbol">      test:</span> æ–°å¢æµ‹è¯•ç”¨ä¾‹æˆ–æ˜¯æ›´æ–°ç°æœ‰æµ‹è¯•ç”¨ä¾‹<br><span class="hljs-symbol">      ci:</span> æŒç»­é›†æˆå’Œéƒ¨ç½²æƒ³å¹²æ”¹åŠ¨ï¼Œ<br><span class="hljs-symbol">      docs:</span> æ–‡æ¡£ç±»æ›´æ–°<br><span class="hljs-symbol">      chore:</span> å…¶ä»–ç±»å‹ï¼Œæ„å»ºæµç¨‹ã€ä¾èµ–ç®¡ç†æˆ–è€…è¾…åŠ©å·¥å…·çš„å˜åŠ¨<br><span class="hljs-symbol"></span><br><span class="hljs-symbol">    scope:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">    description:</span> åŠ¨è¯å¼€å¤´ï¼Œä½¿ç”¨ç°åœ¨æ—¶<br><span class="hljs-symbol"></span><br><span class="hljs-symbol">  Body:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">  Footer:</span><br><br>git rebase: é‡å†™å†å²<br>  git rebase -i <span class="hljs-params">&lt;commit ID&gt;</span> è¿™é‡Œæ˜¯éœ€è¦åˆå¹¶commitä¸­æœ€æ—§commitçš„çˆ¶commit ID<br><br>git reset HEAD~<span class="hljs-number">3</span>A æ’¤é”€è¿‡å»çš„commit,é‡æ–°æäº¤<br><br>git commit --amend: ä¿®æ”¹æœ€è¿‘ä¸€æ¬¡commit çš„ message<br><br>Commit Messageæ˜¯commitæ•°æ®ç»“æ„ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œå¦‚æœCommit Messageæœ‰å˜æ›´ï¼Œåˆ™commit IDä¸€å®šä¼šå˜ï¼Œgit commit --amendåªä¼šå˜æ›´æœ€åä¸€æ¬¡çš„commit ID, git rebase -i ä¼šå˜æ›´çˆ¶commit IDä¹‹åçš„æ‰€æœ‰æäº¤commit ID.<br><br>å¦‚æœå½“å‰åˆ†ä¹‹æœ‰æœªcommitçš„ä»£ç ï¼Œéœ€è¦å…ˆæ‰§è¡Œgit stashå°†å·¥ä½œçŠ¶æ€è¿›è¡Œæš‚å­˜ï¼Œå½“ä¿®æ”¹å®Œæˆååœ¨æ‰§è¡Œgit stash popæ¢å¤ä¹‹å‰çš„å·¥ä½œçŠ¶æ€<br></code></pre></td></tr></table></figure></li>
<li><p>ç›®å½•ç»“æ„è®¾è®¡</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># ç»“æ„åŒ–ç›®å½•ç»“æ„</span><br>  /cmd            <span class="hljs-comment">-- ç»„ä»¶</span><br>  /internal       <span class="hljs-comment">-- ç§æœ‰åº”ç”¨å’Œåº“ä»£ç ,ä¸å¸Œæœ›åœ¨å…¶ä»–åº”ç”¨å’Œåº“ä¸­è¢«å¯¼å…¥</span><br>  /pkg            <span class="hljs-comment">-- å­˜æ”¾å¯ä»¥è¢«å¤–éƒ¨åº”ç”¨ä½¿ç”¨çš„ä»£ç åº“</span><br><span class="hljs-comment"># å¹³é“ºå¼ç›®å½•ç»“æ„</span><br>  &gt; è¿™ç§æ–¹å¼åœ¨å¾ˆå¤šæ¡†æ¶/åº“ä¸­å­˜åœ¨,å¥½å¤„å¼å¼•ç”¨è·¯å¾„é•¿åº¦çŸ­<br></code></pre></td></tr></table></figure></li>
<li><p>å·¥ä½œæµè®¾è®¡</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><code class="hljs crmsh"><span class="hljs-comment"># é›†ä¸­å¼å·¥ä½œæµ</span><br>  &gt; é€‚ç”¨äºå›¢é˜Ÿäººæ•°å°‘ã€å¼€å‘ä¸é¢‘ç¹ã€ä¸éœ€è¦åŒæ—¶ç»´æŠ¤å¤šä¸ªç‰ˆæœ¬çš„å°é¡¹ç›®<br><br><span class="hljs-comment"># åŠŸèƒ½åˆ†æ”¯å·¥ä½œæµ</span><br>  &gt; ä¸åŒåŠŸèƒ½åœ¨ä¸åŒçš„åˆ†æ”¯è¿›è¡Œå¼€å‘ï¼Œæœ€ååˆå¹¶åˆ°<span class="hljs-literal">master</span>åˆ†æ”¯<br>  Merge pull request:<br>    <span class="hljs-number">1</span>. Create a merge commit: git merge --no-ff. featureåˆ†æ”¯ä¸Šæ‰€æœ‰çš„commitéƒ½ä¼šåŠ åˆ°<span class="hljs-literal">master</span>åˆ†æ”¯ä¸Šï¼Œå¹¶ä¸”ä¼šç”Ÿæˆä¸€ä¸ªmerge commitã€‚<br>    <span class="hljs-number">2</span>. Squash <span class="hljs-keyword">and</span> merge: git merge --squash. featureåˆ†æ”¯ä¸Šæ‰€æœ‰çš„commitéƒ½åˆå¹¶æˆä¸€ä¸ªcommit.ç„¶ååŠ åˆ°<span class="hljs-literal">master</span>åˆ†æ”¯,åŸæ¥çš„commitå†å²ä¼šä¸¢å¤±<br>    <span class="hljs-number">3</span>. Rebase <span class="hljs-keyword">and</span> merge: git rebase. å°†pull requestä¸Šæ‰€æœ‰æäº¤å†å²æŒ‰ç…§åŸæœ‰é¡ºåºä¾æ¬¡æ·»åŠ åˆ°<span class="hljs-literal">master</span>åˆ†æ”¯çš„å¤´éƒ¨HEAD.<br><br><span class="hljs-comment"># Git Flowå·¥ä½œæµ</span><br>  &gt; æ¯”è¾ƒé€‚åˆå¤§å‹çš„é¡¹ç›®æˆ–è€…è¿­ä»£é€Ÿåº¦å¿«çš„é¡¹ç›®<br>  <span class="hljs-literal">master</span>: è¯¥åˆ†æ”¯æœ€æ–°ä»£ç æ˜¯å‘å¸ƒçŠ¶æ€ï¼Œä¸èƒ½ç›´æ¥åœ¨è¯¥åˆ†æ”¯ä¸Šå¼€å‘ï¼Œ<span class="hljs-literal">master</span>åˆ†æ”¯æ¯åˆå¹¶ä¸€ä¸ªhotfix/releaseåˆ†æ”¯ï¼Œéƒ½ä¼šæ‰“ä¸€ä¸ªç‰ˆæœ¬æ ‡ç­¾<br>  develop: è¯¥åˆ†æ”¯æ˜¯å¼€å‘ä¸­çš„æœ€æ–°ä»£ç ï¼Œè¯¥åˆ†æ”¯åªåšåˆå¹¶æ“ä½œï¼Œä¸èƒ½ç›´æ¥åœ¨è¯¥åˆ†æ”¯ä¸Šå¼€å‘<br>  feature: åŠŸèƒ½å¼€å‘,åŸºäºdevelopåˆ†æ”¯æ–°å»ºä¸€ä¸ªfeatureåˆ†æ”¯ï¼Œfeatureåˆ†æ”¯åˆå¹¶ä¹‹å‰å…ˆpullä¸€ä¸‹developåˆ†æ”¯ï¼Œ<br>  release: åœ¨å‘å¸ƒé˜¶æ®µä½œä¸ºç‰ˆæœ¬å‘å¸ƒçš„é¢„å‘å¸ƒåˆ†æ”¯ï¼ŒåŸºäºdevelopåˆ†æ”¯åˆ›å»º, æµ‹è¯•é€šè¿‡åï¼Œå°†releaseåˆ†æ”¯åˆå¹¶åˆ°<span class="hljs-literal">master</span>å’Œdevelopï¼Œå¹¶åœ¨<span class="hljs-literal">master</span>åˆ†æ”¯ä¸Šç‰ˆæœ¬æ ‡ç­¾ï¼Œæœ€ååˆ é™¤releaseç‰ˆæœ¬åˆ†æ”¯<br>  hotfix: åœ¨ç»´æŠ¤é˜¶æ®µåšç´§æ€¥Bugä¿®å¤åˆ†æ”¯ï¼Œhotfixåˆ†æ”¯åˆå¹¶åˆ°<span class="hljs-literal">master</span>å’Œdevelopåˆ†æ”¯ï¼Œå¹¶åœ¨<span class="hljs-literal">master</span>åˆ†æ”¯æ‰“ä¸Šä¿®å¤åçš„ç‰ˆæœ¬æ ‡ç­¾,æœ€ååˆ é™¤hotfixåˆ†æ”¯<br><br><span class="hljs-comment"># Forking å·¥ä½œæµ</span><br>  é¡¹ç›®è¿œç¨‹ä»“åº“å’Œå¼€å‘è€…è¿œç¨‹ä»“åº“å®Œå…¨ç‹¬ç«‹ï¼Œå¼€å‘è€…é€šè¿‡Pull Requestçš„æ–¹å¼ç»™è¿œç¨‹ä»“åº“è´¡çŒ®ä»£ç ï¼Œé¡¹ç›®ç»´æŠ¤è€…é€‰æ‹©æ€§åœ°æ¥æ”¶ä»»ä½•å¼€å‘è€…çš„æäº¤ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥é¿å…å¼€å‘è€…é¡¹ç›®è¿œç¨‹ä»“åº“çš„æƒé™,ä»è€Œæé«˜é¡¹ç›®è¿œç¨‹ä»“åº“çš„å®‰å…¨æ€§<br></code></pre></td></tr></table></figure></li>
<li><p>ç ”å‘æµç¨‹</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># éœ€æ±‚é˜¶æ®µ</span><br><span class="hljs-bullet">  1.</span> å¸‚åœºè°ƒç ” - PDM(Product Manager) äº§å“ç»ç†<br><span class="hljs-bullet">  2.</span> éœ€æ±‚åˆ†æ - PM(Project Manager) é¡¹ç›®ç»ç†<br><span class="hljs-bullet">  3.</span> éœ€æ±‚æ–‡æ¡£ - æœ€ç»ˆäº§ç‰©<br><span class="hljs-bullet">  4.</span> éœ€æ±‚è¯„å®¡<br><br><span class="hljs-section"># è®¾è®¡é˜¶æ®µ</span><br><span class="hljs-bullet">  1.</span> äº¤äº’è®¾è®¡ - UX(User Experience) äº¤äº’è®¾è®¡å¸ˆ<br><span class="hljs-bullet">  2.</span> è§†è§‰è®¾è®¡ - UI(User Interface) è§†è§‰è®¾è®¡å¸ˆ<br><span class="hljs-bullet">  3.</span> æŠ€æœ¯è®¾è®¡<br><span class="hljs-bullet">  4.</span> æŠ€æœ¯è¯„å®¡ - æœ€ç»ˆäº§ç‰©<br><span class="hljs-bullet">  5.</span> éœ€æ±‚æ’æœŸ<br><br><span class="hljs-section"># å¼€å‘é˜¶æ®µ</span><br><span class="hljs-bullet">  -</span> å¼€å‘ - Makefile - RD(Research and Development engineer) ç ”å‘å·¥ç¨‹å¸ˆ<br><span class="hljs-bullet">    1.</span> Git Flowå·¥ä½œæµ<br><span class="hljs-bullet">    2.</span> ç”Ÿæˆä»£ç  -- å°½å¯èƒ½è‡ªåŠ¨ç”Ÿæˆä»£ç <br><span class="hljs-bullet">    3.</span> ç‰ˆæƒæ£€æŸ¥<br><span class="hljs-bullet">    4.</span> é™æ€ä»£ç æ£€æŸ¥<br><span class="hljs-bullet">    5.</span> å•å…ƒæµ‹è¯•<br><span class="hljs-bullet">    6.</span> ç¼–è¯‘<br><span class="hljs-bullet">    7.</span> è‡ªæµ‹<br><span class="hljs-bullet">    8.</span> Code Review<br><span class="hljs-bullet">    9.</span> Merge<br><span class="hljs-bullet">  -</span> æ„å»º - CI/CD<br><span class="hljs-bullet">    1.</span> ä»£ç æ‰«æ<br><span class="hljs-bullet">    2.</span> å•å…ƒæµ‹è¯•<br><span class="hljs-bullet">    3.</span> ç¼–è¯‘æ‰“åŒ…<br><span class="hljs-bullet">    4.</span> å½’æ¡£[é•œåƒä»“åº“]<br><br><span class="hljs-section"># æµ‹è¯•é˜¶æ®µ</span><br>  &gt; æµ‹è¯•é˜¶æ®µä¸ºäº†ä¸é˜»å¡æµ‹è¯•ï¼Œç¡®ä¿é¡¹ç›®æŒ‰æ—¶å‘å¸ƒï¼Œç ”å‘äººå‘˜åº”è¯¥ä¼˜å…ˆè§£å†³æµ‹è¯•åŒå­¦çš„Bug,è‡³å°‘æ˜¯é˜»å¡ç±»çš„Bug<br><span class="hljs-bullet">  1.</span> åŠŸèƒ½æµ‹è¯• - QA(Quality Assurance) è´¨é‡ç®¡ç†å·¥ç¨‹å¸ˆ<br><span class="hljs-bullet">  2.</span> æ€§èƒ½æµ‹è¯• - QE(Quality Engineering) è´¨é‡å·¥ç¨‹å¸ˆ<br><span class="hljs-bullet">  3.</span> é›†æˆæµ‹è¯•<br><span class="hljs-bullet">  4.</span> ç³»ç»Ÿæµ‹è¯•<br><br><span class="hljs-section"># å‘å¸ƒé˜¶æ®µ</span><br><span class="hljs-bullet">  -</span> ä»£ç å‘å¸ƒ<br><span class="hljs-bullet">    1.</span> åˆå¹¶åˆ°ä¸»å¹² - Masteråˆ†æ”¯<br><span class="hljs-bullet">    2.</span> ç”Ÿæˆç‰ˆæœ¬å·<br><span class="hljs-bullet">    3.</span> æ‰“æ ‡ç­¾<br><span class="hljs-bullet">    4.</span> ä»£ç æ‰«æ<br><span class="hljs-bullet">    5.</span> å•å…ƒæµ‹è¯•<br><span class="hljs-bullet">    6.</span> ç¼–è¯‘<br><span class="hljs-bullet">    7.</span> å‘å¸ƒæ„å»ºäº§ç‰©<br><span class="hljs-bullet">  -</span> å‘å¸ƒå®¡æ‰¹<br><span class="hljs-bullet">    1.</span> èµ„æºç”³è¯·<br><span class="hljs-bullet">    2.</span> åˆ›å»ºå‘å¸ƒè®¡åˆ’<br><span class="hljs-bullet">    3.</span> åˆ›å»ºå‘å¸ƒå•<br><span class="hljs-bullet">    4.</span> å‘å¸ƒå•å®¡æ‰¹<br><span class="hljs-bullet">  -</span> æœåŠ¡å‘å¸ƒ<br><span class="hljs-bullet">    1.</span> é¢„å‘éƒ¨ç½²<br><span class="hljs-bullet">    2.</span> é¢„å‘éªŒè¯<br><span class="hljs-bullet">    3.</span> ç°ç½‘éƒ¨ç½²<br><span class="hljs-bullet">    4.</span> ç°ç½‘éªŒè¯<br><br><span class="hljs-section"># è¿è¥é˜¶æ®µ</span><br><span class="hljs-bullet">  -</span> äº§å“è¿è¥<br><span class="hljs-bullet">    1.</span> æŠ€æœ¯æ²™é¾™<br><span class="hljs-bullet">    2.</span> æŠ€æœ¯æ¨æ–‡<br><span class="hljs-bullet">  -</span> è¿ç»´è¿è¥ - OP(Operation) è¿ç»´å·¥ç¨‹å¸ˆ<br><span class="hljs-bullet">    1.</span> è¿ç»´å·¥å…·<br><span class="hljs-bullet">    2.</span> æ—¥å¿—ç³»ç»Ÿ<br><span class="hljs-bullet">    3.</span> ç›‘æ§å‘Šè­¦<br></code></pre></td></tr></table></figure></li>
<li><p>åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># ç ”å‘æ¨¡å¼</span><br><span class="hljs-bullet">  -</span> ç€‘å¸ƒæ¨¡å¼<br><span class="hljs-bullet">    -</span> ä¼˜ç‚¹:<br><span class="hljs-bullet">      1.</span> ä¸¥æ ¼æŒ‰ç…§ç ”å‘é˜¶æ®µæ¨è¿›ç ”å‘è¿›åº¦ï¼Œæµç¨‹æ¸…æ™°ï¼Œé€‚åˆæŒ‰é¡¹ç›®äº¤ä»˜çš„åº”ç”¨<br><span class="hljs-bullet">    -</span> ç¼ºç‚¹:<br><span class="hljs-bullet">      1.</span> å˜æ›´å›°éš¾<br><span class="hljs-bullet">      2.</span> ç ”å‘å‘¨æœŸé•¿<br><span class="hljs-bullet">  -</span> è¿­ä»£æ¨¡å¼<br><span class="hljs-code">    &gt; ä¸è¦æ±‚æ¯ä¸ªé˜¶æ®µçš„ä»»åŠ¡åšåˆ°æœ€å®Œç¾ï¼Œè€Œæ˜¯å…ˆæŠŠä¸»è¦åŠŸèƒ½æ­å»ºèµ·æ¥ï¼Œç„¶åé€šè¿‡å®¢æˆ·çš„åé¦ˆä¿¡æ¯ä¸æ–­å®Œå–„</span><br><span class="hljs-code">  - æ•æ·æ¨¡å¼</span><br><span class="hljs-code">    &gt; æ•æ·æ¨¡å¼æŠŠä¸€ä¸ªå¤§çš„éœ€æ±‚åˆ†æˆå¤šä¸ªã€å¯åˆ†é˜¶æ®µå®Œæˆçš„å°è¿­ä»£ï¼Œæ¯ä¸ªè¿­ä»£äº¤ä»˜çš„éƒ½æ˜¯ä¸€ä¸ªå¯ä½¿ç”¨çš„è½¯ä»¶ï¼Œå¼€å‘è¿‡ç¨‹ä¸­ï¼Œè½¯ä»¶è¦ä¸€è‡´å¤„äºå¯ä½¿ç”¨çŠ¶æ€</span><br><span class="hljs-code">    - Scrumå¼€å‘æ¨¡å¼</span><br><span class="hljs-code"></span><br><span class="hljs-section"># CI/CD</span><br>  CI: Continuous Integration, æŒç»­é›†æˆ<br>  CD: Continous Delivery, æŒç»­äº¤ä»˜<br>  CD: Continous Deployment, æŒç»­éƒ¨ç½²<br><br><span class="hljs-section"># DevOps: ç ”å‘è¿ç»´ä¸€ä½“åŒ–</span><br><span class="hljs-bullet">  -</span> AIOps: èŒèƒ½è¿ç»´<br><span class="hljs-bullet">  -</span> ChatOps: é€šè¿‡èŠå¤©çª—å£çš„æœºå™¨äººBotå‡ºå‘ä»»åŠ¡<br><span class="hljs-bullet">  -</span> GitOps:<br><span class="hljs-code">    &gt; å¼€å‘äººå‘˜å¼€å‘å®Œä»£ç åæ¨é€Gitä»“åº“ï¼Œè§¦å‘CIæµç¨‹ï¼ŒCIæµç¨‹é€šè¿‡ç¼–è¯‘æ„å»ºå‡ºDockeré•œåƒï¼Œå¹¶å°†é•œåƒpushåˆ°Dockeré•œåƒä»“åº“ï¼ŒPushåŠ¨ä½œè§¦å‘Pushäº‹ä»¶ï¼Œé€šè¿‡webhookå½¢å¼é€šçŸ¥Config UpdateræœåŠ¡ï¼ŒConfig UpdateræœåŠ¡ä»é•œåƒä»“åº“ä¸­ä¸‹è½½é•œåƒï¼Œå¹¶æ›´æ–°Gitä»“åº“ä¸­çš„kubernetes YAMLæ–‡ä»¶</span><br><span class="hljs-code">  - NoOps:</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="ä»‹ç»Webæ¡†æ¶"><a href="#ä»‹ç»Webæ¡†æ¶" class="headerlink" title="ä»‹ç»Webæ¡†æ¶"></a>ä»‹ç»Webæ¡†æ¶</h2><ul>
<li>Gin<blockquote>
<p>Goç¼–å†™çš„webæ¡†æ¶ï¼Œæ˜¯ä¸€ä¸ªç±»ä¼¼martiniæ€§èƒ½æ›´å¥½çš„APIæ¡†æ¶</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> Engine: åˆå§‹åŒ–ginå¯¹è±¡å®ä¾‹ï¼Œ<br>  æ—¥å¿—<br>  ä¸­é—´ä»¶<br>  è·¯ç”±æ§åˆ¶<br>  handlercontext<br><span class="hljs-bullet">2.</span> Router: å®šä¹‰å„ç§è·¯ç”±è§„åˆ™å’Œæ¡ä»¶<br><span class="hljs-bullet">3.</span> Context: å…è®¸åœ¨ä¸­é—´ä»¶ä¸­å…±äº«å˜é‡ï¼Œç®¡ç†æ•´ä¸ªæµç¨‹ï¼ŒéªŒè¯è¯·æ±‚çš„jsonä»¥åŠæä¾›<br><span class="hljs-bullet">4.</span> Bind:<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="ä»‹ç»å¾®æœåŠ¡æ¶æ„è®¾è®¡"><a href="#ä»‹ç»å¾®æœåŠ¡æ¶æ„è®¾è®¡" class="headerlink" title="ä»‹ç»å¾®æœåŠ¡æ¶æ„è®¾è®¡"></a>ä»‹ç»å¾®æœåŠ¡æ¶æ„è®¾è®¡</h2><ul>
<li><p>æœåŠ¡åŒ–åŸºç¡€è®¾æ–½æŠ€æœ¯é€‰å‹</p>
<ul>
<li>æœåŠ¡é—´é€šä¿¡ä¸­é—´ä»¶<ul>
<li>åŒæ­¥æ–¹å¼: RPC</li>
<li>å¼‚æ­¥æ–¹å¼: MQ</li>
</ul>
</li>
</ul>
</li>
<li><p>å®¢æˆ·ç«¯ä¸€è‡´æ€§</p>
<blockquote>
<p>å…±äº«ç›¸åŒconnectionå¯ä»¥åœ¨åŒä¸€ä¸ªäº‹åŠ¡é‡Œ</p>
</blockquote>
<figure class="highlight sas"><table><tr><td class="code"><pre><code class="hljs sas">1. begin tx å¼€å¯æœ¬åœ°äº‹åŠ¡<br>2. <span class="hljs-meta">do</span> work æ‰§è¡Œä¸šåŠ¡æ“ä½œ<br>3. <span class="hljs-meta">insert</span> <span class="hljs-meta">message</span> å‘åŒå®ä¾‹æ¶ˆæ¯åº“æ’å…¥æ¶ˆæ¯<br>4. <span class="hljs-meta">end</span> tx äº‹åŠ¡æäº¤<br>5. send <span class="hljs-meta">message</span> ç½‘ç»œå‘serverå‘é€æ¶ˆæ¯<br>6. response server å›åº”æ¶ˆæ¯<br>7. <span class="hljs-meta">delete</span> <span class="hljs-meta">message</span> å¦‚æœserverå›å¤æˆåŠŸåˆ™åˆ é™¤æ¶ˆæ¯<br>8. scan <span class="hljs-meta">message</span> è¡¥å¿ä»»åŠ¡æ‰«ææœªå‘é€æ¶ˆæ¯<br>9. send <span class="hljs-meta">message</span> è¡¥å¿ä»»åŠ¡è¡¥å¿æ¶ˆæ¯<br>10. <span class="hljs-meta">delete</span> <span class="hljs-meta">message</span> è¡¥å¿ä»»åŠ¡åˆ é™¤è¡¥å¿æˆåŠŸçš„æ¶ˆæ¯<br></code></pre></td></tr></table></figure></li>
<li><p>æœåŠ¡ç«¯å­˜å‚¨æ¨¡å‹</p>
<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"># Kafka RocketMQåŸºäºpartitionå­˜å‚¨æ¨¡å‹<br><span class="hljs-meta">&gt;</span> <span class="javascript">æ¯ä¸ªsubjectåˆ†ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªpartitionï¼Œè€ŒServeræ”¶åˆ°æ¶ˆæ¯åå°†å…¶åˆ†å‘åˆ°æŸä¸ªpartitionä¸Šï¼Œè€Œconcumeræ¶ˆè´¹çš„æ—¶å€™ä¸partitionå¯¹åº”ã€‚åˆç†çš„åˆ†é…ç­–ç•¥æ˜¯partitionä¸ªæ•°ä¸consumerä¸ªæ•°æˆå€æ•°å…³ç³».</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">é™æ€ç»‘å®šå…³ç³»å¯¼è‡´consumeræ‰©å®¹ç¼©å®¹æ¯”è¾ƒéº»çƒ¦</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">é¡ºåºappendæ–‡ä»¶ï¼Œæä¾›å¾ˆå¥½çš„æ€§èƒ½</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">é¡ºåºæ¶ˆè´¹æ–‡ä»¶ï¼Œä½¿ç”¨offsetè¡¨ç¤ºæ¶ˆè´¹è¿›åº¦ï¼Œä¸ç»™ç»™ä¸ªæ¶ˆæ¯è®°å½•æ¶ˆè´¹çŠ¶æ€,æˆæœ¬æä½</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">å°†æ‰€æœ‰subjectçš„æ¶ˆæ¯åˆå¹¶åœ¨ä¸€èµ·</span><br><br># ä¸šåŠ¡ä½¿ç”¨æ¶ˆæ¯ vs. æ•°æ®æµå¤„ç†åŒºåˆ«<br>  &gt; æ•°æ®æµä¸­æ¶ˆæ¯ä¸»é¢˜å°‘ï¼Œæ¯ä¸ªæ¶ˆæ¯ä¸»é¢˜çš„ååé‡æå¤§<br>  &gt; ä¸šåŠ¡ä¸­æ¶ˆæ¯ä¸»é¢˜æå¤šï¼Œå¾ˆå¤šä¸»é¢˜é‡çº§å¾ˆå°<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="BFF-Backend-For-Frontend-æœåŠ¡äºå‰ç«¯çš„åç«¯"><a href="#BFF-Backend-For-Frontend-æœåŠ¡äºå‰ç«¯çš„åç«¯" class="headerlink" title="BFF - Backend For Frontend æœåŠ¡äºå‰ç«¯çš„åç«¯"></a>BFF - Backend For Frontend æœåŠ¡äºå‰ç«¯çš„åç«¯</h2><blockquote>
<p>ç”¨æˆ·ä½“éªŒé€‚é…å™¨</p>
</blockquote>
<h2 id="è®¾è®¡åŸåˆ™"><a href="#è®¾è®¡åŸåˆ™" class="headerlink" title="è®¾è®¡åŸåˆ™"></a>è®¾è®¡åŸåˆ™</h2><ul>
<li>è®¡ç®—ä¸­æ‰€æœ‰æ–‡ä»¶éƒ½å¯ä»¥é€šè¿‡æ·»åŠ ä¸€ä¸ªä¸­é—´å±‚æ¥è§£å†³ï¼Œä¸€ä¸ªä¸­é—´å±‚è§£å†³ä¸äº†å°±æ·»åŠ ä¸¤ä¸ª</li>
</ul>
]]></content>
      <categories>
        <category>Microservice</category>
      </categories>
  </entry>
  <entry>
    <title>Distributed ID Generator</title>
    <url>/2021/09/02/Distributed-ID-Generator/</url>
    <content><![CDATA[<blockquote>
<p>åˆ†å¸ƒå¼IDç”Ÿæˆå™¨</p>
</blockquote>
<span id="more"></span>

<h1 id="Distributed-ID-Generator"><a href="#Distributed-ID-Generator" class="headerlink" title="Distributed ID Generator"></a>Distributed ID Generator</h1><ul>
<li>UUID<figure class="highlight makefile"><table><tr><td class="code"><pre><code class="hljs makefile">package main<br><br>import (<br>  <span class="hljs-string">&quot;testing&quot;</span><br><br>  <span class="hljs-string">&quot;github.com/google/uuid&quot;</span><br>)<br><br>func BenchmarkUUID(t *testing.B) &#123;<br>  for i := 0; i &lt; t.N; i++ &#123;<br>    _ = uuid.New()<br>  &#125;<br>&#125;<br><br>~/Downloads/uuid_demo via ğŸ¹ v1.17 took 13s<br>âœ go test -bench=.<br><span class="hljs-section">goos: darwin</span><br><span class="hljs-section">goarch: amd64</span><br><span class="hljs-section">pkg: uuid_demo</span><br><span class="hljs-section">cpu: Intel(R) Core(TM) i5-5257U CPU @ 2.70GHz</span><br>BenchmarkUUID-4   	 1390710	       844.7 ns/op<br>PASS<br>ok  	uuid_demo	2.351s<br><br><span class="hljs-comment"># UUIDs are 128-bit hexadecimal numbers that are globally unique</span><br><br><span class="hljs-comment"># ä¼˜ç‚¹:</span><br>  1. ç”Ÿæˆè¶³å¤Ÿç®€å•ï¼Œæœ¬åœ°ç”Ÿæˆæ— ç½‘ç»œæ¶ˆè€—ï¼Œå…·æœ‰å”¯ä¸€æ€§<br><span class="hljs-comment"># ç¼ºç‚¹:</span><br>  1. æ— åºçš„å­—ç¬¦ä¸²ï¼Œä¸å…·å¤‡è¶‹åŠ¿è‡ªå¢ç‰¹æ€§<br>  2. æ²¡æœ‰å…·ä½“çš„ä¸šåŠ¡å«ä¹‰<br>  3. é•¿åº¦è¿‡é•¿16å­—èŠ‚128ä½,36ä½é•¿åº¦çš„å­—ç¬¦ä¸²,å­˜å‚¨ä»¥åŠæŸ¥è¯¢æ•°æ®åº“æ€§èƒ½æ¶ˆè€—è¾ƒå¤§,æ•°æ®åº“å»ºè®®ä¸»é”®å°½é‡è¶ŠçŸ­è¶Šå¥½ï¼Œä½œä¸ºæ•°æ®åº“ä¸»é”®UUIDçš„æ— åºæ€§ä¼šå¯¼è‡´æ•°æ®ä½ç½®é¢‘ç¹å˜åŠ¨ï¼Œä¸¥é‡å½±å“æ€§èƒ½<br></code></pre></td></tr></table></figure></li>
<li>åŸºäºæ•°æ®åº“è‡ªå¢ID<blockquote>
<p>åŸºäºæ•°æ®åº“çš„auto_incrementè‡ªå¢IDå®Œæˆå¯ä»¥å……å½“åˆ†å¸ƒå¼ID</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql"># åˆ›å»ºæ•°æ®è¡¨<br>mysql&gt; <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> SEQUENCE_ID (id <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> auto_increment, <span class="hljs-keyword">value</span> <span class="hljs-type">char</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-keyword">PRIMARY KEY</span> (id)) ENGINE=MyISAM;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected, <span class="hljs-number">1</span> <span class="hljs-built_in">warning</span> (<span class="hljs-number">0.08</span> sec)<br><br># MySQLä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æ’å…¥æ•°æ®<br><span class="hljs-keyword">delimiter</span> $$<span class="pgsql"></span><br><span class="pgsql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> bench_insert(count <span class="hljs-type">int</span> unsigned)</span><br><span class="pgsql"><span class="hljs-keyword">BEGIN</span></span><br><span class="pgsql">  <span class="hljs-keyword">declare</span> num <span class="hljs-type">int</span> unsigned <span class="hljs-keyword">default</span> <span class="hljs-number">1</span>;</span><br><span class="pgsql">  <span class="hljs-keyword">declare</span> c <span class="hljs-type">char</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">default</span> repeat(<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-number">10</span>);</span><br><span class="pgsql">  <span class="hljs-keyword">START</span> <span class="hljs-keyword">TRANSACTION</span>;</span><br><span class="pgsql">  <span class="hljs-keyword">while</span> num &lt;= count <span class="hljs-keyword">DO</span></span><br><span class="pgsql">    <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> SEQUENCE_ID(`<span class="hljs-keyword">value</span>`) <span class="hljs-keyword">values</span>(c);</span><br><span class="pgsql">    <span class="hljs-keyword">set</span> num=num+<span class="hljs-number">1</span>;</span><br><span class="pgsql">  <span class="hljs-keyword">end</span> <span class="hljs-keyword">while</span>;</span><br><span class="pgsql"><span class="hljs-keyword">COMMIT</span>;</span><br><span class="pgsql"><span class="hljs-keyword">END</span>$$</span> <span class="hljs-keyword">delimiter</span> ;<br><br><br><span class="hljs-keyword">CALL</span> bench_insert(<span class="hljs-number">10000</span>);<br><br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">PROCEDURE</span> bench_insert;<br><br># å½“éœ€è¦IDçš„æ—¶å€™ï¼Œå‘è¡¨ä¸­æ’å…¥è®°å½•è¿”å›ä¸»é”®ID.<br><br># ä¼˜ç‚¹:<br>  <span class="hljs-number">1.</span> å®ç°ç®€å•ã€IDå•è°ƒè‡ªå¢ã€æ•°å€¼ç±»å‹æŸ¥è¯¢é€Ÿåº¦å¿«<br><br>ç¼ºç‚¹:<br>  <span class="hljs-number">1.</span> DBå•ç‚¹å­˜åœ¨å®•æœºé£é™©ï¼Œæ— æ³•æ‰›ä½é«˜å¹¶å‘åœºæ™¯<br></code></pre></td></tr></table></figure></li>
<li>åŸºäºæ•°æ®åº“é›†ç¾¤æ¨¡å¼<blockquote>
<p>å¤šæ•°æ®åº“å®ä¾‹å•ç‹¬ç”Ÿäº§è‡ªå¢ID</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"># è®¾ç½®å¯å§‹å€¼å’Œè‡ªå¢å¸ƒé•¿<br>  DB1:<br>    <span class="hljs-keyword">set</span> @<span class="hljs-variable">@auto</span>_increment_offset <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">-- èµ·å§‹å€¼</span><br>    <span class="hljs-keyword">set</span> @<span class="hljs-variable">@auto</span>_increment_increment <span class="hljs-operator">=</span> <span class="hljs-number">2</span>; <span class="hljs-comment">-- æ­¥é•¿</span><br>  DB2:<br>    <span class="hljs-keyword">set</span> @<span class="hljs-variable">@auto</span>_increment_offset <span class="hljs-operator">=</span> <span class="hljs-number">2</span>; <span class="hljs-comment">-- èµ·å§‹å€¼</span><br>    <span class="hljs-keyword">set</span> @<span class="hljs-variable">@auto</span>_increment_increment <span class="hljs-operator">=</span> <span class="hljs-number">2</span>; <span class="hljs-comment">-- æ­¥é•¿</span><br><br># ä¼˜ç‚¹:<br>  è§£å†³DBå•ç‚¹é—®é¢˜<br><br># ç¼ºç‚¹:<br>  ä¸åˆ©äºåç»­æ‰©å®¹ï¼Œè€Œä¸”å®é™…ä¸Šå•ä¸ªæ•°æ®åº“è‡ªèº«å‹åŠ›è¿˜æ˜¯å¾ˆå¤§ï¼Œä¾æ—§æ— æ³•æ»¡è¶³é«˜å¹¶å‘åœºæ™¯<br></code></pre></td></tr></table></figure></li>
<li>åŸºäºæ•°æ®åº“çš„å·æ®µæ¨¡å¼<blockquote>
<p>å·æ®µæ¨¡å¼æ˜¯åˆ†å¸ƒå¼IDç”Ÿæˆå™¨ä¸»æµå®ç°æ–¹å¼ä¹‹ä¸€ï¼Œæ‰¹é‡è·å–è‡ªå¢IDï¼Œæ¯æ¬¡ä»æ•°æ®åº“å–å‡ºä¸€ä¸ªå·æ®µèŒƒå›´ï¼Œå…·ä½“ä¸šåŠ¡æœåŠ¡å°†æœ¬å·æ®µç”Ÿæˆçš„è‡ªå¢IDåŠ è½½å†…å­˜</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql">  mysql&gt; <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> id_generator (id <span class="hljs-type">int</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, max_id <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;å½“å‰æœ€å¤§id&#x27;</span>, step <span class="hljs-type">int</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;å·æ®µçš„å¸ƒé•¿&#x27;</span>, biz_type <span class="hljs-type">int</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;ä¸šåŠ¡ç±»å‹&#x27;</span>, <span class="hljs-keyword">version</span> <span class="hljs-type">int</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;ç‰ˆæœ¬å·&#x27;</span>, <span class="hljs-keyword">PRIMARY KEY</span>(`id`));<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected, <span class="hljs-number">5</span> warnings (<span class="hljs-number">0.11</span> sec)<br><br>  mysql&gt; describe id_generator;<br>  +<span class="hljs-comment">----------+--------+------+-----+---------+-------+</span><br>  | Field    | <span class="hljs-keyword">Type</span>   | <span class="hljs-keyword">Null</span> | Key | <span class="hljs-keyword">Default</span> | Extra |<br>  +<span class="hljs-comment">----------+--------+------+-----+---------+-------+</span><br>  | id       | <span class="hljs-type">int</span>    | <span class="hljs-keyword">NO</span>   | PRI | <span class="hljs-keyword">NULL</span>    |       |<br>  | max_id   | <span class="hljs-type">bigint</span> | <span class="hljs-keyword">NO</span>   |     | <span class="hljs-keyword">NULL</span>    |       |  <span class="hljs-comment">-- å½“å‰æœ€å¤§çš„å¯ç”¨id</span><br>  | step     | <span class="hljs-type">int</span>    | <span class="hljs-keyword">NO</span>   |     | <span class="hljs-keyword">NULL</span>    |       |  <span class="hljs-comment">-- ä»£è¡¨å·æ®µçš„é•¿åº¦</span><br>  | biz_type | <span class="hljs-type">int</span>    | <span class="hljs-keyword">NO</span>   |     | <span class="hljs-keyword">NULL</span>    |       |  <span class="hljs-comment">-- ä¸åŒä¸šåŠ¡ç±»å‹</span><br>  | <span class="hljs-keyword">version</span>  | <span class="hljs-type">int</span>    | <span class="hljs-keyword">NO</span>   |     | <span class="hljs-keyword">NULL</span>    |       |  <span class="hljs-comment">-- ä¹è§‚é”ï¼Œæ¯æ¬¡éƒ½æ›´æ–°versionï¼Œä¿è¯å¹¶å‘æ—¶æ•°æ®çš„æ­£ç¡®æ€§</span><br>  +<span class="hljs-comment">----------+--------+------+-----+---------+-------+</span><br>  <span class="hljs-number">5</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.04</span> sec)<br><br>  <span class="hljs-keyword">update</span> id_generator <span class="hljs-keyword">set</span> max_id = #&#123;max_id+step&#125;, version = <span class="hljs-keyword">version</span> + <span class="hljs-number">1</span> <span class="hljs-keyword">where</span> version = # &#123;<span class="hljs-keyword">version</span>&#125; <span class="hljs-keyword">and</span> biz_type = XXX<br></code></pre></td></tr></table></figure></li>
<li>åŸºäºRedisæ¨¡å¼<blockquote>
<p>åˆ©ç”¨redis Incr åŸå­æ€§è‡ªå¢</p>
</blockquote>
<figure class="highlight dns"><table><tr><td class="code"><pre><code class="hljs dns"><br>  <span class="hljs-number">172.30.1.23</span>:<span class="hljs-number">6002</span>&gt; set seq_id <span class="hljs-number">1</span><br>  OK<br>  <span class="hljs-number">172.30.1.23</span>:<span class="hljs-number">6002</span>&gt; incr seq_id<br>  (integer) <span class="hljs-number">2</span><br>  <span class="hljs-number">172.30.1.23</span>:<span class="hljs-number">6002</span>&gt; get seq_id<br>  &quot;<span class="hljs-number">2</span>&quot;<br>  <span class="hljs-number">172.30.1.23</span>:<span class="hljs-number">6002</span>&gt;<br><br># Benchmark<br>ubuntu in ~ at <span class="hljs-number">3</span>BPlus took <span class="hljs-number">4</span>s<br>âœ redis-benchmark -n <span class="hljs-number">1000000</span> -t set,get,incr -P <span class="hljs-number">16</span> -q -h <span class="hljs-number">127.0.0.1</span> -p <span class="hljs-number">6001</span> --cluster<br>Cluster has <span class="hljs-number">3</span> master nodes:<br><br>Master <span class="hljs-number">0</span>: a733c21d3b735b9d026eb4d462ef6b367d8ebb<span class="hljs-number">98 172.30.1</span>.<span class="hljs-number">23</span>:<span class="hljs-number">6002</span><br>Master <span class="hljs-number">1</span>: <span class="hljs-number">9</span>c35a4e211f6534861ed768dba592e<span class="hljs-number">85539b1377</span> <span class="hljs-number">172.30.1.23</span>:<span class="hljs-number">6003</span><br>Master <span class="hljs-number">2</span>: a901e497cb72819cf0765e9e4eb16c36399c437b <span class="hljs-number">172.30.1.23</span>:<span class="hljs-number">6001</span><br><br>SET: <span class="hljs-number">47001.32</span> requests per second, p<span class="hljs-number">50=15.199</span> msec<br>GET: <span class="hljs-number">101936.80</span> requests per second, p<span class="hljs-number">50=5.679</span> msec<br>INCR: <span class="hljs-number">46496.49</span> requests per second, p<span class="hljs-number">50=13.879</span> msec   -- å¹¶å‘<span class="hljs-number">5</span>ä¸‡/s<br></code></pre></td></tr></table></figure></li>
<li>twitter snowflake<blockquote>
<p>é›ªèŠ±ç®—æ³• (Snowflake) Twitterå†…éƒ¨åˆ†å¸ƒå¼é‡‡ç”¨çš„IDç”Ÿæˆç®—æ³•</p>
</blockquote>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section"># The default Twitter format shown below.</span><br><span class="hljs-section">+--------------------------------------------------------------------------+</span><br><span class="hljs-section">| 1 Bit Unused | 41 Bit Timestamp |  10 Bit NodeID  |   12 Bit Sequence ID |</span><br><span class="hljs-section">+--------------------------------------------------------------------------+</span><br><br>41 bits: store a timestamp with millisecond precision<br>10 bits: store a node id - a range from 0 through 1023<br>12 bits: store a sequence number - a range from 0 through 4095<br></code></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>Distributed Systems</category>
      </categories>
  </entry>
  <entry>
    <title>Kafka Tips &amp; Tracks</title>
    <url>/2021/09/02/Kafka-Tips-Tracks/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>Middleware</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Tips &amp; Tracks</title>
    <url>/2021/09/02/MySQL-Tips-Tracks/</url>
    <content><![CDATA[<h1 id="æ•°æ®åº“-ä¸‰å¤§èŒƒå¼"><a href="#æ•°æ®åº“-ä¸‰å¤§èŒƒå¼" class="headerlink" title="æ•°æ®åº“-ä¸‰å¤§èŒƒå¼"></a>æ•°æ®åº“-ä¸‰å¤§èŒƒå¼</h1><ul>
<li>åŸå­æ€§: å­—æ®µä¸å¯åˆ†</li>
<li>å”¯ä¸€æ€§: æœ‰ä¸»é”®(æ²¡æœ‰ä¸»é”®å°±æ²¡æœ‰å”¯ä¸€æ€§)ï¼Œéä¸»é”®å­—æ®µä¾èµ–ä¸»é”®</li>
<li>æ¶ˆé™¤å†—ä½™: æ¯åˆ—éƒ½ä¸ä¸»é”®æœ‰ç›´æ¥å…³ç³», éä¸»é”®å­—æ®µä¸èƒ½ç›¸äº’ä¾èµ–</li>
</ul>
<span id="more"></span>

<h2 id="MySQLäº‹åŠ¡æ¨¡å‹-ACID"><a href="#MySQLäº‹åŠ¡æ¨¡å‹-ACID" class="headerlink" title="MySQLäº‹åŠ¡æ¨¡å‹ ACID"></a>MySQLäº‹åŠ¡æ¨¡å‹ ACID</h2><blockquote>
<p>MySQLäº‹åŠ¡çš„å››ä¸ªç‰¹æ€§ä¸­ACDä¸‰ä¸ªç‰¹æ€§æ˜¯é€šè¿‡Redo Log(é‡åšæ—¥å¿—)å’ŒUndo Log(æ’¤é”€æ—¥å¿—)å®ç°,è€ŒIéš”ç¦»å‹é€šè¿‡Lockå®ç°</p>
</blockquote>
<ul>
<li><p>äº‹åŠ¡æ˜¯å¯ä»¥æäº¤æˆ–å›æ»šçš„åŸå­å·¥ä½œå•å…ƒ</p>
</li>
<li><p>ACIDæ¨¡å‹æ˜¯ä¸€ç»„æ•°æ®åº“è®¾è®¡åŸåˆ™</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">A:</span> atomicityåŸå­æ€§: äº‹åŠ¡ä¸­ä¸€ç³»åˆ—çš„æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨éƒ½æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨éƒ½ä¸æ‰§è¡Œ<br><span class="hljs-symbol">C:</span> consistencyä¸€è‡´æ€§(é€šè¿‡AIDä¿è¯): æ•°æ®åº“äº‹åŠ¡ä¸èƒ½ç ´åå…³ç³»æ•°æ®çš„å®Œæ•´æ€§ä»¥åŠä¸šåŠ¡é€»è¾‘ä¸Šçš„ä¸€è‡´æ€§<br><span class="hljs-symbol">I:</span> isolation éš”ç¦»æ€§(äº‹åŠ¡çš„éš”ç¦»çº§åˆ«): å¹¶å‘ç¯å¢ƒä¸‹ï¼Œä¸åŒäº‹åŠ¡åŒæ—¶æ“ä½œç›¸åŒçš„æ•°æ®ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰å„è‡ªçš„å®Œæˆæ•°æ®ç©ºé—´<br><span class="hljs-symbol">D:</span> durabilityæŒä¹…æ€§: åªè¦äº‹åŠ¡æˆåŠŸç»“æŸï¼Œå¯¹æ•°æ®åº“æ‰€åšçš„æ›´æ–°å°±æ°¸ä¹…ä¿å­˜ä¸‹æ¥ï¼Œå³ä½¿å‘ç”Ÿç³»ç»Ÿå´©æºƒï¼Œé‡æ–°å¯åŠ¨æ•°æ®åº“ï¼Œæ•°æ®åº“è¿˜èƒ½æ¢å¤åˆ°äº‹åŠ¡æˆåŠŸç»“æŸæ—¶çš„çŠ¶æ€<br></code></pre></td></tr></table></figure></li>
<li><p>InnoDB å­˜å‚¨å¼•æ“æ¶æ„<br><img src="/misc/images/InnoDB-architecture.jpeg" alt="InnoDB Architecture"></p>
</li>
<li><p>å¹¶å‘é—®é¢˜</p>
<ul>
<li>è„è¯»: Drity Read: è¯»å–åˆ°æœªæäº¤çš„æ•°æ®</li>
<li>ä¸å¯é‡å¤è¯»: Non-repeatable read: ä¸¤æ¬¡è¯»å–ç»“æœä¸åŒ</li>
<li>å¹»è¯» Phantom Read: selectæ“ä½œå¾—åˆ°çš„ç»“æœæ‰€è¡¨è¯çš„æ•°æ®çŠ¶æ€æ— æ³•æ”¯æ’‘åç»­çš„ä¸šåŠ¡æ“ä½œ</li>
</ul>
</li>
<li><p>InnoDB å››ç§éš”ç¦»çº§åˆ«</p>
<ul>
<li>READ UNCOMMITED è¯»æœªæäº¤ â€“&gt; è„è¯»</li>
<li>READ COMMITTED è¯»å·²æäº¤ â€“&gt;  ä¸å¯é‡å¤è¯»</li>
<li>REPEATABLE READ å¯é‡å¤è¯» â€“&gt; å¹»è¯»</li>
<li>SERIALIZABLE ä¸²è¡ŒåŒ–</li>
</ul>
</li>
</ul>
<h2 id="æ•°æ®åº“æ—¥å¿—"><a href="#æ•°æ®åº“æ—¥å¿—" class="headerlink" title="æ•°æ®åº“æ—¥å¿—"></a>æ•°æ®åº“æ—¥å¿—</h2><ul>
<li><p>WAL - Write Ahead Log</p>
<blockquote>
<p>å®é™…å†™æ•°æ®å‰ï¼Œå…ˆæŠŠä¿®æ”¹çš„æ•°æ®è®°åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿æ•…éšœæ—¶è¿›è¡Œä¿®å¤</p>
</blockquote>
</li>
<li><p>é‡åšæ—¥å¿— - redo log</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> è®°å½•ä¿®æ”¹åçš„æ•°æ®</span><br><span class="hljs-meta">&gt;</span><span class="bash"> ç”¨äºå¼‚å¸¸æ¢å¤</span><br><span class="hljs-meta">&gt;</span><span class="bash"> å¾ªç¯å†™æ–‡ä»¶</span><br><span class="hljs-meta">&gt;</span><span class="bash">&gt; write Pos: å†™å…¥ä½ç½®</span><br><span class="hljs-meta">&gt;</span><span class="bash">&gt; Check Point: åˆ·ç›˜ä½ç½®</span><br><span class="hljs-meta">&gt;</span><span class="bash">&gt; Check Point -&gt; Write Pos: å¾…è½ç›˜</span><br><span class="hljs-meta">&gt;</span><span class="bash">&gt; innodb_flush_log_at_trx_commit: åˆ·ç›˜æ—¶æœº</span><br><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; 0 commit æ¯ç§’å†™æ–‡ä»¶,å¹¶åˆ·ç›˜</span><br><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; 1 commit æ¯æ¬¡æäº¤æ—¶å†™æ–‡ä»¶ï¼Œ</span><br><span class="hljs-meta">#</span><span class="bash"> MySQL redo-log:</span><br>  1. ä½“ç§¯å°ï¼Œè®°å½•é¡µçš„ä¿®æ”¹ï¼Œæ¯”å†™å…¥é¡µä»£ä»·ä½<br>  2. æœ«å°¾è¿½åŠ ï¼Œéšæœºå†™å˜é¡ºåºå†™ï¼Œå‘ç”Ÿæ”¹å˜çš„é¡µä¸å›ºå®š<br></code></pre></td></tr></table></figure></li>
<li><p>å›æ»šæ—¥å¿— - Undo Log</p>
<blockquote>
<p>å›æ»šæ—¥å¿—è®°å½•çš„é›†åˆï¼ŒåŒ…å«å¦‚ä½•æ’¤é”€äº‹åŠ¡å¯¹èšé›†ç´¢å¼•è®°å½•çš„æœ€æ–°æ›´æ–°çš„ä¿¡æ¯</p>
</blockquote>
<ul>
<li><p>ä¿è¯äº‹åŠ¡åŸå­æ€§</p>
</li>
<li><p>å®ç°æ•°æ®å¤šç‰ˆæœ¬</p>
</li>
<li><p>delete undo log: ç”¨äºå›æ»šï¼Œæäº¤å³æ¸…ç†</p>
</li>
<li><p>update undo log:</p>
</li>
<li><p>undo logå¦‚ä½•æ¸…ç†:</p>
<ul>
<li>ä¾æ®ç³»ç»Ÿæ´»è·ƒçš„æœ€å°æ´»è·ƒäº‹åŠ¡ID Read view</li>
</ul>
</li>
<li><h2 id="ä¸ºä»€ä¹ˆInnoDB-count-è¿™ä¹ˆæ…¢"><a href="#ä¸ºä»€ä¹ˆInnoDB-count-è¿™ä¹ˆæ…¢" class="headerlink" title="ä¸ºä»€ä¹ˆInnoDB count(*) è¿™ä¹ˆæ…¢?"></a>ä¸ºä»€ä¹ˆInnoDB count(*) è¿™ä¹ˆæ…¢?</h2></li>
</ul>
</li>
</ul>
<h2 id="MySQlå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶-MVCC"><a href="#MySQlå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶-MVCC" class="headerlink" title="MySQlå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ - MVCC"></a>MySQlå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ - MVCC</h2><blockquote>
<p>ä½¿å¾—InnoDBçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹æ‰§è¡Œä¸€è‡´æ€§è¯»æ“ä½œæœ‰ä¿è¯, æŸ¥è¯¢ä¸€ä¸ªè¢«å¦ä¸€ä¸ªäº‹åŠ¡æ›´æ–°çš„è¡Œï¼Œå¯ä»¥çœ‹åˆ°è¢«æ›´æ–°ä¹‹å‰çš„å€¼<br>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œè§£å†³è¯»å†™å†²çªé—®é¢˜</p>
</blockquote>
<ul>
<li>InnoDB MVCCå®ç°<ul>
<li>å½“å‰è¯» â€“ Select for update</li>
<li>å¿«ç…§è¯» â€“ Select Current_TRX_ID</li>
<li>å¯è§æ€§åˆ¤æ–­<ul>
<li>åˆ›å»ºå¿«ç…§è¿™ä¸€åˆ»ï¼Œè¿˜æœªæäº¤çš„äº‹åŠ¡ï¼Œåœ¨æ­¤ç”Ÿå‘½å‘¨æœŸä¸­æ— æ³•è¯»å–</li>
<li>åˆ›å»ºå¿«ç…§ä¹‹ååˆ›å»ºçš„äº‹åŠ¡æ— æ³•è¯»å–</li>
</ul>
</li>
<li>Read View<ul>
<li>å¿«ç…§è¯» æ´»è·ƒäº‹åŠ¡åˆ—è¡¨</li>
<li>æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ä¸­æœ€å°äº‹åŠ¡ID</li>
<li>æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ä¸­æœ€å¤§äº‹åŠ¡ID<figure class="highlight apache"><table><tr><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">InnoDB</span>å‘æ•°æ®åº“ä¸­å­˜å‚¨çš„æ¯ä¸€è¡Œæ•°æ®æ·»åŠ ä¸‰ä¸ªå­—æ®µéšè—å­—æ®µ<br><span class="hljs-attribute">1</span>. DB_TRX_ID: <span class="hljs-number">6</span>å­—èŠ‚ è¡¨ç¤ºæ’å…¥æˆ–æ›´æ–°æœ€åä¸€ä¸ªäº‹åŠ¡çš„äº‹åŠ¡æ ‡è¯†ç¬¦ å…¨å±€é€’å¢<br><span class="hljs-attribute">2</span>. DB_ROLL_PTR: <span class="hljs-number">7</span>å­—èŠ‚ å›æ»šæŒ‡é’ˆ roll pointer, æŒ‡å‘å†™å…¥å›æ»šæ®µæ’¤é”€æ—¥å¿—Undo Log<br><span class="hljs-attribute">3</span>. DB_ROW_ID: <span class="hljs-number">6</span>å­—èŠ‚ éšç€æ–°è¡Œæ’å…¥è€Œå•è°ƒå¢åŠ çš„è¡ŒID<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>  <img src="/misc/images/mvcc.jpeg" alt="mvcc"></p>
<ul>
<li>InnoDB Locking<ul>
<li>Shared and Exclusive Locks - å…±äº«é”å’Œæ’ä»–é”<ul>
<li>A Shared Lock å…è®¸æŒæœ‰é”çš„äº‹åŠ¡è¯»å–è¯¥è¡Œ</li>
<li>An Exclusive Lock å…è®¸æŒæœ‰é”çš„äº‹åŠ¡æ›´æ–°å’Œåˆ é™¤è¯¥è¡Œ<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql">å‡è®¾äº‹åŠ¡T1å¯¹æ•°æ®è¡ŒræŒæœ‰å…±äº«é”(Shared <span class="hljs-keyword">Lock</span>),å¦ä¸€ä¸ªäº‹åŠ¡T2å¯¹åŒä¸€æ•°æ®è¡Œrçš„æ“ä½œåˆ†ä¸‹é¢ä¸¤ç§æƒ…å†µ:<br>  <span class="hljs-number">1.</span> T2å¯¹æ•°æ®è¡Œrä»…ä»…æ˜¯è¯»å–è¯·æ±‚æŒæœ‰(Shared <span class="hljs-keyword">Lock</span>)æˆåŠŸï¼Œç»“æœæ˜¯T1å’ŒT2å¯¹æ•°æ®è¡Œréƒ½æŒæœ‰å…±äº«é”<br>  <span class="hljs-number">2.</span> T2å¯¹æ•°æ®è¡Œäººéœ€è¦<span class="hljs-keyword">Update</span>è¯·æ±‚æŒæœ‰(<span class="hljs-keyword">Exclusive</span> <span class="hljs-keyword">Lock</span>)ä¼šå¤±è´¥<br><br>å‡è®¾äº‹åŠ¡T1å¯¹æ•°æ®è¡ŒræŒæœ‰æ’ä»–é”(<span class="hljs-keyword">exclusive</span> <span class="hljs-keyword">lock</span>),å¦ä¸€ä¸ªäº‹åŠ¡T2å¯¹åŒä¸€æ•°æ®è¡Œrçš„é”è¯·æ±‚(å…±äº«é”/æ’ä»–é”)éƒ½ä¼šå¤±è´¥,äº‹åŠ¡T2ä¸å¾—ä¸ç­‰å¾…äº‹åŠ¡T1é‡Šæ”¾é”<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="MySQL-å­˜å‚¨å¼•æ“"><a href="#MySQL-å­˜å‚¨å¼•æ“" class="headerlink" title="MySQL å­˜å‚¨å¼•æ“"></a>MySQL å­˜å‚¨å¼•æ“</h2><ul>
<li><p>Page</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><code class="hljs makefile">&gt; é¡µPage : 16KB, å­˜å‚¨IOçš„åŸºæœ¬å•å…ƒ<br>Page Header: é¡µå¤´, è®°å½•é¡µé¢çš„æ§åˆ¶ä¿¡æ¯ï¼Œå ç”¨56å­—èŠ‚ï¼ŒåŒ…æ‹¬é¡µçš„å·¦å³å…„å¼Ÿé¡µé¢æŒ‡é’ˆï¼Œé¡µé¢ç©ºé—´ä½¿ç”¨æƒ…å†µ<br><span class="hljs-section">è™šè®°å½•:</span><br>  æœ€å¤§è™šè®°å½•,æ¯”é¡µå†…æœ€å¤§ä¸»é”®å¤§<br>  æœ€å°è™šè®°å½•,æ¯”é¡µå†…æœ€å°ä¸»é”®å°<br><span class="hljs-section">è®°å½•å †: è¡Œè®°å½•å­˜å‚¨åŒº</span><br>  æœ‰æ•ˆè®°å½•<br>  å·²åˆ é™¤è®°å½•<br><span class="hljs-section">è‡ªç”±ç©ºé—´é“¾è¡¨: å·²åˆ é™¤è®°å½•ç»„æˆçš„é“¾è¡¨</span><br><span class="hljs-section">æœªåˆ†é…ç©ºé—´: é¡µå†…æœªä½¿ç”¨çš„å­˜å‚¨ç©ºé—´</span><br>Slot åŒº: è¿ç»­ç©ºé—´å¹³å‡åˆ†é…<br>Page Tailer: é¡µå°¾, å 8å­—èŠ‚ï¼Œå­˜å‚¨é¡µé¢çš„æ ¡éªŒä¿¡æ¯<br></code></pre></td></tr></table></figure></li>
<li><p>ç´¢å¼•B+æ ‘</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># é¡ºåºä¿è¯</span><br><span class="hljs-bullet">  -</span> ç‰©ç†æœ‰åº: æ•°ç»„ï¼ŒäºŒåˆ†æŸ¥æ‰¾, æ”¯æŒéšæœºè¯»,<br><span class="hljs-bullet">  -</span> é€»è¾‘æœ‰åº: é“¾è¡¨, æ”¯æŒéšæœºå†™,<br><span class="hljs-section"># æ’å…¥ç­–ç•¥</span><br><span class="hljs-bullet">  -</span> è‡ªç”±ç©ºé—´é“¾è¡¨<br><span class="hljs-bullet">  -</span> æœªä½¿ç”¨ç©ºé—´<br><span class="hljs-bullet">  -</span> æ”¶ç¼©æ•°æ®åº“,è§£å†³æ•°æ®åº“pageç¢ç‰‡<br><span class="hljs-section"># é¡µå†…æŸ¥è¯¢</span><br><span class="hljs-bullet">  -</span> éå†<br><span class="hljs-bullet">  -</span> äºŒåˆ†æŸ¥æ‰¾<br><span class="hljs-bullet">  -</span> skip list<br></code></pre></td></tr></table></figure></li>
<li><p>InnoDBå†…å­˜ç®¡ç†</p>
<figure class="highlight haml"><table><tr><td class="code"><pre><code class="hljs haml">-<span class="ruby"> é¢„åˆ†é…å†…å­˜ç©ºé—´:</span><br><span class="ruby"></span>  -<span class="ruby"> Buffer Pool(é¢„åˆ†é…å†…å­˜æ± )<span class="hljs-symbol">:</span>é¡µé¢åŠ è½½å•ä½Page</span><br><span class="ruby"></span>  -<span class="ruby"> <span class="hljs-symbol">Page:</span> Buffer Pool çš„æœ€å°å•ä½</span><br><span class="ruby"></span>  -<span class="ruby"> Free <span class="hljs-symbol">List:</span> ç©ºé—²Pageç»„æˆçš„é“¾è¡¨</span><br><span class="ruby"></span>  -<span class="ruby"> Flush <span class="hljs-symbol">List:</span> è„é¡µåˆ—è¡¨</span><br><span class="ruby"></span>  -<span class="ruby"> Page Hashè¡¨: ç»´æŠ¤å†…å­˜Pageå’Œæ–‡ä»¶Pageçš„æ˜ å°„å…³ç³»</span><br><span class="ruby"></span>  -<span class="ruby"> <span class="hljs-symbol">LRU:</span> å†…å­˜æ·˜æ±°ç®—æ³•- é‡Šæ”¾åˆ·ç›˜</span><br><span class="ruby"></span>      LRU_new: å­˜å‚¨çƒ­æ•°æ®<br>      LRU_old: å­˜å‚¨å†·æ•°æ®<br>      Midpoint:<br>-<span class="ruby"> æ•°æ®é¡µé¢åŠ è½½å•å…ƒ:</span><br><span class="ruby"></span>  -<span class="ruby"> ç£ç›˜æ•°æ®åˆ°å†…å­˜</span><br><span class="ruby"></span>-<span class="ruby"> æ•°æ®å†…å¤–å­˜äº¤æ¢:</span><br><span class="ruby"></span>-<span class="ruby"> å†…å­˜ç®¡ç†çš„æŠ€æœ¯ç‚¹:</span><br><span class="ruby"></span>  -<span class="ruby"> å†…å­˜æ± </span><br><span class="ruby"></span>  -<span class="ruby"> å†…å­˜é¡µé¢ç®¡ç†</span><br><span class="ruby"></span>    -<span class="ruby"> ç©ºé—²é¡µ</span><br><span class="ruby"></span>    -<span class="ruby"> æ•°æ®é¡µ</span><br><span class="ruby"></span>    -<span class="ruby"> è„é¡µ: æ•°æ®è¢«Update éœ€è¦åˆ·ç›˜</span><br><span class="ruby"></span>    -<span class="ruby"> é¡µé¢æ˜ å°„</span><br><span class="ruby"></span>    -<span class="ruby"> é¡µé¢æ•°æ®ç®¡ç†</span><br><span class="ruby"></span>  -<span class="ruby"> æ•°æ®æ·˜æ±°:</span><br><span class="ruby"></span>    -<span class="ruby"> <span class="hljs-symbol">LRU:</span> æœ€ç»å¸¸è¢«è®¿é—®çš„æ•°æ®æ”¾åœ¨è¡¨å¤´ï¼Œé»˜è®¤åˆ é™¤è¡¨å°¾</span><br><span class="ruby"></span>    -<span class="ruby"> <span class="hljs-symbol">LFU:</span> ä½¿ç”¨é¢‘ç‡æ·˜æ±°ç®—æ³•, Redis ä½¿ç”¨ä½¿ç”¨LFUæ·˜æ±°ç®—æ³•</span><br><span class="ruby"></span>    -<span class="ruby"> åŒ<span class="hljs-symbol">LRU:</span> çƒ­è¡¨LRUï¼Œå†·è¡¨LRU</span><br><span class="ruby"></span>    -<span class="ruby"> å…¨è¡¨æ‰«æå¯¹å†…å­˜çš„å½±å“?</span><br><span class="ruby"></span>      &gt; å¯¼è‡´çƒ­æ•°æ®è¢«æ›¿æ¢, ç¼“å†²åŒºè¢«æ±¡æŸ“ï¼Œå¯¼è‡´æ•°æ®åº“æ€§èƒ½ä¸‹é™<br>    -<span class="ruby"> é¿å…å…¨è¡¨æ‰«æå¯¹çƒ­æ•°æ®çš„å½±å“</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="MySQL-é”å®ç°åŸç†"><a href="#MySQL-é”å®ç°åŸç†" class="headerlink" title="MySQL é”å®ç°åŸç†"></a>MySQL é”å®ç°åŸç†</h2><ul>
<li><p>é”é¢—ç²’åº¦</p>
<ul>
<li>è¡Œçº§é”<ul>
<li>ä½œç”¨åœ¨ç´¢å¼•(èšç°‡ç´¢å¼•ã€äºŒçº§ç´¢å¼•)è¡Œ</li>
<li>æ˜¯å¦æ˜¯å”¯ä¸€ç´¢å¼•</li>
</ul>
</li>
<li>é—´éš™é”<ul>
<li>è§£å†³å¯é‡å¤è¯»æ¨¡å¼ä¸‹çš„å¹»è¯»é—®é¢˜</li>
<li>GAPé”ä¸æ˜¯åŠ è½½è®°å½•ä¸Š</li>
<li>GAPé”é”ä½çš„ä½ç½®æ˜¯ä¸¤æ¡è®°å½•ä¹‹é—´çš„GAP</li>
<li>ä¿è¯ä¸¤æ¬¡å½“å‰è¯»è¿”å›ä¸€è‡´çš„è®°å½•</li>
</ul>
</li>
<li>è¡¨çº§é”<ul>
<li>lock tables</li>
<li>å…ƒæ•°æ®é”(meta data lock, MDL)</li>
<li>å…¨è¡¨æ‰«æâ€è¡¨é”â€</li>
</ul>
</li>
</ul>
</li>
<li><p>ç±»å‹</p>
<ul>
<li>å…±äº«é”S<ul>
<li>è¯»é”ï¼Œå¯ä»¥åŒæ—¶è¢«å¤šä¸ªäº‹åŠ¡è·å–ï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡å¯¹è®°å½•çš„ä¿®æ”¹</li>
</ul>
</li>
<li>æ’ä»–é”X<ul>
<li>å†™é”</li>
</ul>
</li>
</ul>
</li>
<li><h2 id="æ‰€æœ‰å½“å‰è¯»åŠ æ’ä»–é”"><a href="#æ‰€æœ‰å½“å‰è¯»åŠ æ’ä»–é”" class="headerlink" title="æ‰€æœ‰å½“å‰è¯»åŠ æ’ä»–é”:"></a>æ‰€æœ‰å½“å‰è¯»åŠ æ’ä»–é”:</h2></li>
</ul>
<h2 id="æ•°æ®åº“ç´¢å¼•"><a href="#æ•°æ®åº“ç´¢å¼•" class="headerlink" title="æ•°æ®åº“ç´¢å¼•"></a>æ•°æ®åº“ç´¢å¼•</h2><ul>
<li><p>in, not in, exists, not exists</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><code class="hljs asciidoc">âœ mysql -h 127.0.0.1 -u chyi -P 13306 -p<br>Enter password:<br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection id is 223<br>Server version: 8.0.26-0ubuntu0.20.04.2 (Ubuntu)<br><br>Copyright (c) 2000, 2021, Oracle and/or its affiliates.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type <span class="hljs-emphasis">&#x27;help;&#x27;</span> or <span class="hljs-emphasis">&#x27;\h&#x27;</span> for help. Type <span class="hljs-emphasis">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>mysql&gt; use develop;<br>Reading table information for completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br>mysql&gt; DROP TABLE IF EXISTS <span class="hljs-code">`t1`</span>;<br>Query OK, 0 rows affected, 1 warning (0.03 sec)<br><br>mysql&gt; CREATE TABLE <span class="hljs-code">`t1`</span> (<span class="hljs-code">`id`</span> int(11) NOT NULL AUTO_INCREMENT, <span class="hljs-code">`name`</span> varchar(255) DEFAULT NULL, <span class="hljs-code">`addreee`</span> varchar(255) DEFAULT NULL, PRIMARY KEY(<span class="hljs-code">`id`</span>)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;<br>Query OK, 0 rows affected, 1 warning (0.06 sec)<br><br>mysql&gt; INSERT INTO <span class="hljs-string">`t1` VALUES (&#x27;</span>1001&#x27;, <span class="hljs-emphasis">&#x27;å¼ ä¸‰&#x27;</span>, <span class="hljs-emphasis">&#x27;åŒ—äº¬&#x27;</span>), (<span class="hljs-emphasis">&#x27;1002&#x27;</span>, <span class="hljs-emphasis">&#x27;æå››&#x27;</span>, <span class="hljs-emphasis">&#x27;å¤©æ´¥&#x27;</span>), (<span class="hljs-emphasis">&#x27;1003&#x27;</span>, <span class="hljs-emphasis">&#x27;ç‹äº”&#x27;</span>, <span class="hljs-emphasis">&#x27;åŒ—äº¬&#x27;</span>), (<span class="hljs-emphasis">&#x27;1004&#x27;</span>, <span class="hljs-emphasis">&#x27;èµµå…­&#x27;</span>, <span class="hljs-emphasis">&#x27;æ²³åŒ—&#x27;</span>), (<span class="hljs-emphasis">&#x27;1005&#x27;</span>, <span class="hljs-emphasis">&#x27;æ°å…‹&#x27;</span>, <span class="hljs-emphasis">&#x27;æ²³å—&#x27;</span>), (<span class="hljs-emphasis">&#x27;1006&#x27;</span>, <span class="hljs-emphasis">&#x27;æ±¤å§†&#x27;</span>, <span class="hljs-emphasis">&#x27;æ²³å—&#x27;</span>), (<span class="hljs-emphasis">&#x27;1007&#x27;</span>, <span class="hljs-emphasis">&#x27;è´å°”&#x27;</span>, <span class="hljs-emphasis">&#x27;ä¸Šæµ·&#x27;</span>), (<span class="hljs-emphasis">&#x27;1008&#x27;</span>, <span class="hljs-emphasis">&#x27;å­™çª&#x27;</span>, <span class="hljs-emphasis">&#x27;åŒ—äº¬&#x27;</span>);<br>Query OK, 8 rows affected (0.04 sec)<br>Records: 8  Duplicates: 0  Warnings: 0<br><br><span class="hljs-section">mysql&gt; select * from t1;</span><br><span class="hljs-section">+------+--------+---------+</span><br><span class="hljs-section">| id   | name   | addreee |</span><br><span class="hljs-section">+------+--------+---------+</span><br>| 1001 | å¼ ä¸‰   | åŒ—äº¬    |<br>| 1002 | æå››   | å¤©æ´¥    |<br>| 1003 | ç‹äº”   | åŒ—äº¬    |<br>| 1004 | èµµå…­   | æ²³åŒ—    |<br>| 1005 | æ°å…‹   | æ²³å—    |<br>| 1006 | æ±¤å§†   | æ²³å—    |<br>| 1007 | è´å°”   | ä¸Šæµ·    |<br><span class="hljs-section">| 1008 | å­™çª   | åŒ—äº¬    |</span><br><span class="hljs-section">+------+--------+---------+</span><br>8 rows in set (0.04 sec)<br><br>mysql&gt; DROP TABLE IF EXISTS <span class="hljs-code">`t2`</span>;<br>Query OK, 0 rows affected (0.05 sec)<br><br>mysql&gt; CREATE TABLE <span class="hljs-code">`t2`</span> (<span class="hljs-code">`id`</span> int(11) NOT NULL AUTO_INCREMENT, <span class="hljs-code">`name`</span> varchar(255), <span class="hljs-code">`address`</span> varchar(255), PRIMARY KEY(<span class="hljs-code">`id`</span>)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;<br>Query OK, 0 rows affected, 1 warning (0.06 sec)<br><br>mysql&gt; INSERT INTO <span class="hljs-string">`t2` VALUES (1001, &#x27;</span>å¼ ä¸‰<span class="hljs-emphasis">&#x27;, &#x27;</span>åŒ—äº¬<span class="hljs-emphasis">&#x27;);</span><br><span class="hljs-emphasis">Query OK, 1 row affected (0.04 sec)</span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis"></span>mysql&gt; INSERT INTO <span class="hljs-string">`t2` VALUES (1004, &#x27;</span>èµµå…­<span class="hljs-emphasis">&#x27;, &#x27;</span>æ²³åŒ—<span class="hljs-emphasis">&#x27;);</span><br><span class="hljs-emphasis">Query OK, 1 row affected (0.05 sec)</span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis"></span>mysql&gt; INSERT INTO <span class="hljs-string">`t2` VALUES (1005, &#x27;</span>æ°å…‹<span class="hljs-emphasis">&#x27;, &#x27;</span>æ²³å—<span class="hljs-emphasis">&#x27;);</span><br><span class="hljs-emphasis">Query OK, 1 row affected (0.04 sec)</span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis"></span>mysql&gt; INSERT INTO <span class="hljs-string">`t2` VALUES (1007, &#x27;</span>è´å°”<span class="hljs-emphasis">&#x27;, &#x27;</span>ä¸Šæµ·<span class="hljs-emphasis">&#x27;);</span><br><span class="hljs-emphasis">Query OK, 1 row affected (0.03 sec)</span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis"></span>mysql&gt; INSERT INTO <span class="hljs-string">`t2` VALUES (1008, &#x27;</span>å­™çª<span class="hljs-emphasis">&#x27;, &#x27;</span>åŒ—äº¬<span class="hljs-emphasis">&#x27;);</span><br><span class="hljs-emphasis">Query OK, 1 row affected (0.04 sec)</span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis"></span>mysql&gt; INSERT INTO <span class="hljs-string">`t2` VALUES (1009, &#x27;</span>æ›¹æ“<span class="hljs-emphasis">&#x27;, &#x27;</span>é­å›½<span class="hljs-emphasis">&#x27;);</span><br><span class="hljs-emphasis">Query OK, 1 row affected (0.04 sec)</span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis"></span>mysql&gt; INSERT INTO <span class="hljs-string">`t2` VALUES (1010, &#x27;</span>åˆ˜å¤‡<span class="hljs-emphasis">&#x27;, &#x27;</span>èœ€å›½<span class="hljs-emphasis">&#x27;);</span><br><span class="hljs-emphasis">Query OK, 1 row affected (0.04 sec)</span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis"></span>mysql&gt; INSERT INTO <span class="hljs-string">`t2` VALUES (1011, &#x27;</span>å­™æƒ<span class="hljs-emphasis">&#x27;, &#x27;</span>å´å›½<span class="hljs-emphasis">&#x27;);</span><br><span class="hljs-emphasis">Query OK, 1 row affected (0.04 sec)</span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis"></span>mysql&gt; INSERT INTO <span class="hljs-string">`t2` VALUES (1012, &#x27;</span>è¯¸è‘›äº®<span class="hljs-emphasis">&#x27;, &#x27;</span>èœ€å›½<span class="hljs-emphasis">&#x27;);</span><br><span class="hljs-emphasis">Query OK, 1 row affected (0.04 sec)</span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis"></span>mysql&gt; INSERT INTO <span class="hljs-string">`t2` VALUES (1013, &#x27;</span>å…¸éŸ¦<span class="hljs-emphasis">&#x27;, &#x27;</span>é­å›½<span class="hljs-emphasis">&#x27;);</span><br><span class="hljs-emphasis">Query OK, 1 row affected (0.04 sec)</span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis"></span><span class="hljs-section">mysql&gt; select * FROM t1 where name not in (select name from t2);</span><br><span class="hljs-section">+------+--------+---------+</span><br><span class="hljs-section">| id   | name   | addreee |</span><br><span class="hljs-section">+------+--------+---------+</span><br>| 1002 | æå››   | å¤©æ´¥    |<br>| 1003 | ç‹äº”   | åŒ—äº¬    |<br><span class="hljs-section">| 1006 | æ±¤å§†   | æ²³å—    |</span><br><span class="hljs-section">+------+--------+---------+</span><br>3 rows in set (0.04 sec)<br><br><span class="hljs-section">mysql&gt; select * from t1 where not exists (select name from t2 where t1.name = t2.name);</span><br><span class="hljs-section">+------+--------+---------+</span><br><span class="hljs-section">| id   | name   | addreee |</span><br><span class="hljs-section">+------+--------+---------+</span><br>| 1002 | æå››   | å¤©æ´¥    |<br>| 1003 | ç‹äº”   | åŒ—äº¬    |<br><span class="hljs-section">| 1006 | æ±¤å§†   | æ²³å—    |</span><br><span class="hljs-section">+------+--------+---------+</span><br>3 rows in set (0.04 sec)<br><br>mysql&gt; INSERT INTO <span class="hljs-string">`t2` VALUES (1014, NULL, &#x27;</span>é­å›½<span class="hljs-emphasis">&#x27;);</span><br><span class="hljs-emphasis">Query OK, 1 row affected (0.05 sec)</span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis"></span># not in éœ€è¦ä¿è¯è‡ªæŸ¥è¯¢çš„åŒ¹é…å­—æ®µæ˜¯éç©ºçš„<br>mysql&gt; select * FROM t1 where name not in (select name from t2);<br>Empty set (0.04 sec)<br><br># exists è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªbooleanå€¼ trueæˆ–è€…false,è€Œä¸å…³å¿ƒæŸä¸ªç»“æœé›†<br><span class="hljs-section">mysql&gt; select * from t1 where not exists (select name from t2 where t1.name = t2.name);</span><br><span class="hljs-section">+------+--------+---------+</span><br><span class="hljs-section">| id   | name   | addreee |</span><br><span class="hljs-section">+------+--------+---------+</span><br>| 1002 | æå››   | å¤©æ´¥    |<br>| 1003 | ç‹äº”   | åŒ—äº¬    |<br><span class="hljs-section">| 1006 | æ±¤å§†   | æ²³å—    |</span><br><span class="hljs-section">+------+--------+---------+</span><br>3 rows in set (0.04 sec)<br><br># è‡ªæŸ¥è¯¢ä¸­nameå¯ä»¥ä¿®æ”¹ä¸ºå…¶ä»–ä»»æ„çš„å­—æ®µ,æ‰§è¡Œæ•ˆç‡ä¸Š1&gt;column&gt;*<br><span class="hljs-section">mysql&gt; select * from t1 where not exists (select 1 from t2 where t1.name = t2.name);</span><br><span class="hljs-section">+------+--------+---------+</span><br><span class="hljs-section">| id   | name   | addreee |</span><br><span class="hljs-section">+------+--------+---------+</span><br>| 1002 | æå››   | å¤©æ´¥    |<br>| 1003 | ç‹äº”   | åŒ—äº¬    |<br><span class="hljs-section">| 1006 | æ±¤å§†   | æ²³å—    |</span><br><span class="hljs-section">+------+--------+---------+</span><br>3 rows in set (0.04 sec)<br><br># in, exists æ‰§è¡Œæµç¨‹<br># å¯¹äºinæŸ¥è¯¢æ¥è¯´ï¼Œä¼šå…ˆæ‰§è¡Œå­æŸ¥è¯¢ï¼Œç„¶åæŠŠæŸ¥è¯¢å¾—åˆ°çš„ç»“æœå’Œå¤–è¡¨t1åšç¬›å¡å°”ï¼Œé€šè¿‡æ¡ä»¶è¿›è¡Œç­›é€‰(nameæ˜¯å¦ç›¸ç­‰)<br><span class="hljs-section">mysql&gt; select * from t1 where name in (select name from t2);</span><br><span class="hljs-section">+------+--------+---------+</span><br><span class="hljs-section">| id   | name   | addreee |</span><br><span class="hljs-section">+------+--------+---------+</span><br>| 1001 | å¼ ä¸‰   | åŒ—äº¬    |<br>| 1004 | èµµå…­   | æ²³åŒ—    |<br>| 1005 | æ°å…‹   | æ²³å—    |<br>| 1007 | è´å°”   | ä¸Šæµ·    |<br><span class="hljs-section">| 1008 | å­™çª   | åŒ—äº¬    |</span><br><span class="hljs-section">+------+--------+---------+</span><br>5 rows in set (0.04 sec)<br><br># exists,å…ˆæŸ¥è¯¢ä¾¿åˆ©å¤–è¡¨t1,ç„¶åæ¯æ¬¡éå†æ—¶ï¼Œåœ¨æ£€æŸ¥å†…æ ‡æ˜¯å¦ç¬¦åˆåŒ¹é…æ¡ä»¶<br><span class="hljs-section">mysql&gt; select * from t1 where exists (select 1 from t2 where t1.name = t2.name);</span><br><span class="hljs-section">+------+--------+---------+</span><br><span class="hljs-section">| id   | name   | addreee |</span><br><span class="hljs-section">+------+--------+---------+</span><br>| 1001 | å¼ ä¸‰   | åŒ—äº¬    |<br>| 1004 | èµµå…­   | æ²³åŒ—    |<br>| 1005 | æ°å…‹   | æ²³å—    |<br>| 1007 | è´å°”   | ä¸Šæµ·    |<br><span class="hljs-section">| 1008 | å­™çª   | åŒ—äº¬    |</span><br><span class="hljs-section">+------+--------+---------+</span><br>5 rows in set (0.03 sec)<br><br># å½“ in å€¼å¤šäº†ä¹‹åï¼Œå°±ä¸èµ°ç´¢å¼•äº†; æ¨æµ‹MySQLå¯¹inæŸ¥è¯¢çš„æˆæœ¬ä¼˜åŒ–å™¨CBO<br><span class="hljs-section">mysql&gt; explain select * from t1 where id in (1001, 1002, 1003, 1004, 1005, 1006, 1007);</span><br><span class="hljs-section">+----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-------------+</span><br><span class="hljs-section">| id | select_type | table | partitions | type  | possible_keys | key     | key_len | ref  | rows | filtered | Extra       |</span><br><span class="hljs-section">+----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-------------+</span><br><span class="hljs-section">|  1 | SIMPLE      | t1    | NULL       | range | PRIMARY       | PRIMARY | 4       | NULL |    7 |   100.00 | Using where |</span><br><span class="hljs-section">+----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-------------+</span><br>1 row in set, 1 warning (0.03 sec)<br><br><br><span class="hljs-section">mysql&gt; explain select * from t1 where id in (1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009, 1010);</span><br><span class="hljs-section">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-section">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |</span><br><span class="hljs-section">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-section">|  1 | SIMPLE      | t1    | NULL       | ALL  | PRIMARY       | NULL | NULL    | NULL |    8 |   100.00 | Using where |</span><br><span class="hljs-section">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br>1 row in set, 1 warning (0.03 sec)<br><br># å¦‚æœæŸ¥è¯¢çš„ä¸¤ä¸ªè¡¨å¤§å°ç›¸å½“ï¼Œç”¨inå’Œexistå·®åˆ«ä¸å¤§ï¼Œå¦‚æœä¸¤ä¸ªè¡¨ä¸­ä¸€ä¸ªè¾ƒå°ä¸€ä¸ªè¾ƒå¤§ï¼Œåˆ™å­æŸ¥è¯¢è¡¨å¤§çš„ç”¨exists,å­æŸ¥è¯¢è¡¨å°çš„ç”¨in.<br><br><span class="hljs-section">mysql&gt; explain select * from t1 where id in (select id from t2);</span><br><span class="hljs-section">+----+-------------+-------+------------+--------+---------------+---------+---------+---------------+------+----------+-------------+</span><br><span class="hljs-section">| id | select_type | table | partitions | type   | possible_keys | key     | key_len | ref           | rows | filtered | Extra       |</span><br><span class="hljs-section">+----+-------------+-------+------------+--------+---------------+---------+---------+---------------+------+----------+-------------+</span><br>|  1 | SIMPLE      | t1    | NULL       | ALL    | PRIMARY       | NULL    | NULL    | NULL          |    8 |   100.00 | NULL        |<br><span class="hljs-section">|  1 | SIMPLE      | t2    | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | develop.t1.id |    1 |   100.00 | Using index |</span><br><span class="hljs-section">+----+-------------+-------+------------+--------+---------------+---------+---------+---------------+------+----------+-------------+</span><br>2 rows in set, 1 warning (0.05 sec)<br><br># æœ¬æ„æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯ï¼Œä½†æ˜¯å’Œexplainä½¿ç”¨ï¼Œä¼šæ˜¾ç¤ºä¼˜åŒ–åçš„sql<br><span class="hljs-section">mysql&gt; show warnings;</span><br><span class="hljs-section">+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="hljs-section">| Level | Code | Message                                                                                                                                                                                                           |</span><br><span class="hljs-section">+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="hljs-section">| Note  | 1003 | /* select#1 */ select `develop`.`t1`.`id` AS `id`,`develop`.`t1`.`name` AS `name`,`develop`.`t1`.`addreee` AS `addreee` from `develop`.`t2` join `develop`.`t1` where (`develop`.`t2`.`id` = `develop`.`t1`.`id`) |</span><br><span class="hljs-section">+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br>1 row in set (0.04 sec)<br><br># å¤–å±‚å¤§è¡¨å†…å­˜å°è¡¨ï¼Œç”¨in, å¤–å±‚å°è¡¨å†…å±‚å¤§è¡¨ï¼Œinå’Œexistsæ•ˆç‡å·®ä¸å¤š.<br></code></pre></td></tr></table></figure></li>
<li><p>join åµŒå¥—å¾ªç¯ Nested-Loop Join</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><code class="hljs oxygene"><span class="hljs-number">1</span>. ç®€å•åµŒå¥—å¾ªç¯è¿æ¥ Simple <span class="hljs-keyword">Nested</span>-<span class="hljs-keyword">Loop</span> <span class="hljs-keyword">Join</span><br>  inner <span class="hljs-keyword">join</span> - å†…è¿æ¥ åŒå±‚å¾ªç¯éå†ä¸¤å¼ è¡¨<br>  ä¸€èˆ¬sqlä¸­ä¼šä»¥å°è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œå¤–å±‚å¾ªç¯ï¼Œå†…å±‚å¾ªç¯ä½œä¸ºè¢«é©±åŠ¨è¡¨<br><span class="hljs-number">2</span>. ç´¢å¼•åµŒå¥—å¾ªç¯è¿æ¥<br>  å†…å­˜è¡¨åˆ—è¦æœ‰ç´¢å¼•<br><span class="hljs-number">3</span>. å¿«ç´¢å¼•åµŒå¥—è¿æ¥ <span class="hljs-keyword">Block</span> <span class="hljs-keyword">Nested</span> <span class="hljs-keyword">Loop</span> <span class="hljs-keyword">Join</span><br>  &gt; ç¼“å­˜å¤–å±‚è¡¨çš„æ•°æ®åˆ°<span class="hljs-keyword">join</span> bufferä¸­ï¼Œç„¶åbufferä¸­æ•°æ®æ‰¹é‡å’Œå†…å±‚è¡¨æ•°æ®è¿›è¡ŒåŒ¹é…ï¼Œä»è€Œå‡å°‘å†…å­˜å¾ªç¯çš„æ¬¡æ•°<br></code></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>Middleware</category>
      </categories>
  </entry>
  <entry>
    <title>Redis Tips &amp; Tracks</title>
    <url>/2021/09/02/Redis-Tips-Tracks/</url>
    <content><![CDATA[<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><blockquote>
<p>Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache, and message broker.</p>
</blockquote>
<span id="more"></span>

<h2 id="RedisçŸ¥è¯†çš„å…¨æ™¯å›¾"><a href="#RedisçŸ¥è¯†çš„å…¨æ™¯å›¾" class="headerlink" title="RedisçŸ¥è¯†çš„å…¨æ™¯å›¾"></a>RedisçŸ¥è¯†çš„å…¨æ™¯å›¾</h2><p><img src="/misc/images/redis-knowledge.jpg" alt="Redis çŸ¥è¯†å…¨æ™¯å›¾"></p>
<ul>
<li>åº”ç”¨çº¬åº¦:<ul>
<li>ç¼“å­˜åº”ç”¨<ul>
<li>å†…åµŒKeyè¿‡æœŸæœºåˆ¶å’Œæ·˜æ±°ç­–ç•¥</li>
</ul>
</li>
<li>é›†ç¾¤åº”ç”¨<ul>
<li>ä¸»ä»é›†ç¾¤ã€åˆ‡ç‰‡é›†ç¾¤</li>
</ul>
</li>
<li>æ•°æ®ç»“æ„åº”ç”¨<ul>
<li>String</li>
<li>Hash</li>
<li>List</li>
<li>Set</li>
<li>Sorted Set</li>
</ul>
</li>
</ul>
</li>
<li>ç³»ç»Ÿçº¬åº¦:<ul>
<li>å¤„ç†å±‚:<ul>
<li>çº¿ç¨‹æ¨¡å‹</li>
</ul>
</li>
<li>å†…å­˜å±‚:<ul>
<li>æ•°æ®ç»“æ„</li>
</ul>
</li>
<li>å­˜å‚¨å±‚:<ul>
<li>AOF</li>
<li>RDB</li>
</ul>
</li>
<li>ç½‘ç»œå±‚:<ul>
<li>epoolç½‘ç»œæ¡†æ¶</li>
</ul>
</li>
</ul>
</li>
<li>é«˜æ€§èƒ½ä¸»çº¿:<ul>
<li>çº¿ç¨‹æ¨¡å‹</li>
<li>æ•°æ®ç»“æ„<ul>
<li>é›†åˆç±»å‹é‡‡ç”¨æœ‰åºç´¢å¼•ï¼Œå¯ä»¥æ”¯æŒèŒƒå›´æ“ä½œ</li>
<li>è€ƒè™‘ä¸åŒæ•°æ®ç»“æ„çš„å†…å­˜æ•ˆç‡ã€è®¾è®¡äº†å‹ç¼©åˆ—è¡¨ã€æ•´æ•°æ•°ç»„è¿™äº›ç²¾ç®€çš„åº•å±‚æ•°æ®ç»“æ„ã€èŠ‚çœå†…å­˜å¼€é”€</li>
</ul>
</li>
<li>å†…å­˜åˆ†é…å™¨<ul>
<li>jemallocå’Œtcmallocæ¯”glibcæ•ˆç‡é«˜</li>
</ul>
</li>
<li>æŒä¹…åŒ–<ul>
<li>æ”¯æŒRDBã€AOFæŒä¹…åŒ–æ•°æ®ï¼Œæ”¯æŒä¸»ä»åº“é›†ç¾¤</li>
</ul>
</li>
<li>ç½‘ç»œæ¡†æ¶</li>
</ul>
</li>
<li>é«˜å¯ç”¨ä¸»çº¿:<ul>
<li>ä¸»ä»å¤åˆ¶</li>
<li>å“¨å…µæœºåˆ¶</li>
<li>åˆ‡ç‰‡é›†ç¾¤</li>
</ul>
</li>
<li>é«˜æ‰©å±•ä¸»çº¿:<ul>
<li>æ•°æ®åˆ†ç‰‡</li>
<li>è´Ÿè½½å‡è¡¡</li>
</ul>
</li>
</ul>
<h2 id="Redisé—®é¢˜ç”»åƒå›¾"><a href="#Redisé—®é¢˜ç”»åƒå›¾" class="headerlink" title="Redisé—®é¢˜ç”»åƒå›¾"></a>Redisé—®é¢˜ç”»åƒå›¾</h2><p><img src="/misc/images/redis-problems.jpeg" alt="Redisé—®é¢˜ç”»åƒ"></p>
<h2 id="Redis-åŸºç¡€"><a href="#Redis-åŸºç¡€" class="headerlink" title="Redis åŸºç¡€"></a>Redis åŸºç¡€</h2><ul>
<li><p>åŸºç¡€æ¶æ„</p>
<figure class="highlight haml"><table><tr><td class="code"><pre><code class="hljs haml"># æ•°æ®æ¨¡å‹: key-value<br>  &gt; Redisèƒ½å¤Ÿåœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­å¹¿æ³›çš„åº”ç”¨ï¼Œå°±æ˜¯å¾—ç›Šäºæ”¯æŒå¤šæ ·åŒ–ç±»å‹çš„value<br><br># æ“ä½œæ¥å£:<br>  -<span class="ruby"> <span class="hljs-symbol">PUT:</span></span><br><span class="ruby"></span>  -<span class="ruby"> <span class="hljs-symbol">GET:</span></span><br><span class="ruby"></span>  -<span class="ruby"> <span class="hljs-symbol">DELETE:</span></span><br><span class="ruby"></span>  -<span class="ruby"> <span class="hljs-symbol">SCAN:</span></span><br><span class="ruby"></span><br># è®¿é—®æ¡†æ¶:<br>  -<span class="ruby"> åŠ¨æ€åº“è®¿é—®</span><br><span class="ruby"></span>  -<span class="ruby"> ç½‘ç»œæ¡†æ¶è®¿é—®<span class="hljs-symbol">:</span>åŒ…æ‹¬Socket Serverå’Œåè®®è§£æ</span><br><span class="ruby"></span># æ“ä½œæ¨¡å—:<br>  -<span class="ruby"> Redis é”®-å€¼æ˜ å°„æ•°æ®ç±»å‹</span><br><span class="ruby"></span>    -<span class="ruby"> å“ˆå¸Œè¡¨: å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸ªå…ƒç´ netryç§°ä¸ºä¸€ä¸ªå“ˆå¸Œæ¡¶(æ¡¶ä¸­å…ƒç´ å­˜å‚¨çš„æ˜¯æŒ‡å‘keyå’Œvalueçš„æŒ‡é’ˆ).</span><br><span class="ruby"></span>      -<span class="ruby"> O(<span class="hljs-number">1</span>)æ—¶é—´å¤æ‚åº¦å¿«é€ŸæŸ¥æ‰¾é”®å€¼å¯¹</span><br><span class="ruby"></span>      -<span class="ruby"> å“ˆå¸Œè¡¨å†²çªé—®é¢˜</span><br><span class="ruby"></span>        -<span class="ruby"> Redisè§£å†³å“ˆå¸Œå†²çªä½¿ç”¨é“¾å¼å“ˆå¸Œ,æŒ‡å‘åŒä¸€ä¸ªå“ˆå¸Œæ¡¶ä¸­çš„å¤šä¸ªå…ƒç´ ç”¨é“¾è¡¨ä¿å­˜ï¼Œä¹‹é—´ä¾æ¬¡ç”¨æŒ‡é’ˆè¿æ¥</span><br><span class="ruby"></span>      -<span class="ruby"> Rehashæ“ä½œ:</span><br><span class="ruby"></span>        -<span class="ruby"> è£…è½½å› å­ load factor = æ‰€æœ‰entryä¸ªæ•°/å“ˆå¸Œè¡¨çš„å“ˆå¸Œæ¡¶ä¸ªæ•°</span><br><span class="ruby"></span>        -<span class="ruby"> rehashæ“ä½œå°±æ˜¯å¢åŠ ç°æœ‰å“ˆå¸Œæ¡¶æ•°é‡ï¼Œè®©å¢å¤šçš„entryå…ƒç´ èƒ½åœ¨æ›´å¤šçš„æ¡¶ä¹‹é—´åˆ†æ•£ä¿å­˜ï¼Œå‡å°‘å•ä¸ªæ¡¶ä¸­å…ƒç´ æ•°é‡,ä»è€Œå‡å°‘å•ä¸ªæ¡¶ä¸­å†²çª</span><br><span class="ruby"></span>        -<span class="ruby"> Redisé»˜è®¤é‡‡ç”¨ä¸¤ä¸ªå…¨å±€å“ˆå¸Œè¡¨,å“ˆå¸Œè¡¨<span class="hljs-number">1</span>ï¼Œå“ˆå¸Œè¡¨<span class="hljs-number">2</span>, Rehashè¿‡ç¨‹:</span><br><span class="ruby"></span>          -<span class="ruby"> hash2åˆ†é…æ›´å¤§ç©ºé—´ <span class="hljs-number">2</span> * hash1</span><br><span class="ruby"></span>          -<span class="ruby"> å°†hash1ä¸­æ•°æ®é‡æ–°æ˜ å°„å¹¶æ‹·è´åˆ°hash2</span><br><span class="ruby"></span>          -<span class="ruby"> é‡Šæ”¾hash1ç©ºé—´</span><br><span class="ruby"></span>        -<span class="ruby"> æ¸è¿›å¼<span class="hljs-symbol">rehash:</span></span><br><span class="ruby"></span>          -<span class="ruby"> å·§å¦™çš„æŠŠä¸€æ¬¡æ€§å¤§é‡æ‹·è´çš„å¼€é”€åˆ†æ‘Šåˆ°å¤šæ¬¡å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼Œé¿å…è€—æ—¶æ“ä½œï¼Œä¿è¯æ•°æ®çš„å¿«é€Ÿè®¿é—®</span><br><span class="ruby"></span><br>  -<span class="ruby"> Rediså€¼çš„æ•°æ®ç±»å‹:</span><br><span class="ruby"></span>    -<span class="ruby"> å­—ç¬¦ä¸²<span class="hljs-symbol">String:</span></span><br><span class="ruby"></span>      -<span class="ruby"> åº•å±‚æ•°æ®ç±»å‹:</span><br><span class="ruby"></span>        -<span class="ruby"> ç®€å•åŠ¨æ€å­—ç¬¦ä¸²</span><br><span class="ruby"></span>    -<span class="ruby"> åˆ—è¡¨List</span><br><span class="ruby"></span>      -<span class="ruby"> åº•å±‚æ•°æ®ç±»å‹:</span><br><span class="ruby"></span>        -<span class="ruby"> åŒå‘é“¾è¡¨</span><br><span class="ruby"></span>        -<span class="ruby"> å‹ç¼©åˆ—è¡¨</span><br><span class="ruby"></span>    -<span class="ruby"> é›†åˆSet</span><br><span class="ruby"></span>      -<span class="ruby"> åº•å±‚æ•°æ®ç±»å‹</span><br><span class="ruby"></span>        -<span class="ruby"> å‹ç¼©åˆ—è¡¨</span><br><span class="ruby"></span>        -<span class="ruby"> æ•´æ•°æ•°ç»„</span><br><span class="ruby"></span>    -<span class="ruby"> æœ‰åºé›†åˆSorted Set</span><br><span class="ruby"></span>      -<span class="ruby"> åº•å±‚æ•°æ®ç±»å‹</span><br><span class="ruby"></span>        -<span class="ruby"> å‹ç¼©åˆ—è¡¨</span><br><span class="ruby"></span>        -<span class="ruby"> è·³è¡¨</span><br><span class="ruby"></span>    -<span class="ruby"> å“ˆå¸ŒHash</span><br><span class="ruby"></span>      -<span class="ruby"> åº•å±‚æ•°æ®ç±»å‹</span><br><span class="ruby"></span>        -<span class="ruby"> å‹ç¼©åˆ—è¡¨</span><br><span class="ruby"></span>        -<span class="ruby"> å“ˆå¸Œè¡¨</span><br><span class="ruby"></span>  -<span class="ruby"> Redisåº•å±‚æ•°æ®ç»“æ„</span><br><span class="ruby"></span>    &gt; Redisä¹‹æ‰€ä»¥é‡‡ç”¨ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œæ˜¯åœ¨æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨æ•ˆç‡ä¹‹é—´è¿›è¡Œå¹³è¡¡<br>    -<span class="ruby"> ç®€å•åŠ¨æ€å­—ç¬¦ä¸²</span><br><span class="ruby"></span>    -<span class="ruby"> åŒå‘é“¾è¡¨</span><br><span class="ruby"></span>    -<span class="ruby"> å‹ç¼©åˆ—è¡¨<span class="hljs-symbol">:</span>ç±»ä¼¼æ•°ç»„</span><br><span class="ruby"></span>      -<span class="ruby"> è¡¨å¤´:</span><br><span class="ruby"></span>        -<span class="ruby"> <span class="hljs-symbol">zlbytes:</span> åˆ—è¡¨é•¿åº¦</span><br><span class="ruby"></span>        -<span class="ruby"> <span class="hljs-symbol">zltail:</span> åˆ—è¡¨å°¾çš„åç§»é‡</span><br><span class="ruby"></span>        -<span class="ruby"> <span class="hljs-symbol">zllen:</span> åˆ—è¡¨ä¸­entryä¸ªæ•°</span><br><span class="ruby"></span>      -<span class="ruby"> è¡¨å°¾:</span><br><span class="ruby"></span>        -<span class="ruby"> <span class="hljs-symbol">zlend:</span> è¡¨ç¤ºç»“æŸ</span><br><span class="ruby"></span>    -<span class="ruby"> å“ˆå¸Œè¡¨</span><br><span class="ruby"></span>    -<span class="ruby"> è·³è¡¨: è·³è¡¨åœ¨é“¾è¡¨çš„åŸºç¡€ä¸Šå¢åŠ å¤šçº§ç´¢å¼•ï¼Œé€šè¿‡ç´¢å¼•ä½ç½®çš„å‡ ä¸ªè·³è½¬ï¼Œå®ç°æ•°æ®çš„å¿«é€Ÿå®šä½</span><br><span class="ruby"></span>      -<span class="ruby"> æŸ¥æ‰¾å¤æ‚åº¦O(logN)</span><br><span class="ruby"></span>    -<span class="ruby"> æ•´æ•°æ•°ç»„</span><br><span class="ruby"></span><br># ç´¢å¼•æ¨¡å—:<br>  -<span class="ruby"> ç´¢å¼•çš„ä½œç”¨æ˜¯è®©é”®å€¼æ•°æ®åº“æ ¹æ®Keyæ‰¾åˆ°å“åº”valueçš„å­˜å‚¨ä½ç½®ï¼Œè¿›è€Œæ‰§è¡Œæ“ä½œ</span><br><span class="ruby"></span>  -<span class="ruby"> å“ˆå¸Œè¡¨: redis, mamcachedé‡‡ç”¨</span><br><span class="ruby"></span>    -<span class="ruby"> å†…å­˜çš„é«˜æ€§èƒ½éšæœºè®¿é—®å¯ä»¥å¾ˆå¥½ä¸å“ˆå¸Œè¡¨O(<span class="hljs-number">1</span>)æ“ä½œå¤æ‚åº¦ç›¸åŒ¹é…</span><br><span class="ruby"></span>  -<span class="ruby"> B+æ ‘</span><br><span class="ruby"></span>  -<span class="ruby"> å­—å…¸æ ‘</span><br><span class="ruby"></span>  -<span class="ruby"> skip <span class="hljs-symbol">list:</span> RocksDBé‡‡ç”¨</span><br><span class="ruby"></span># å­˜å‚¨æ¨¡å—:<br>  -<span class="ruby"> å†…å­˜åˆ†é…å™¨</span><br><span class="ruby"></span>    -<span class="ruby"> <span class="hljs-symbol">glibc:</span> malloc/free</span><br><span class="ruby"></span>  -<span class="ruby"> æŒä¹…åŒ–</span><br><span class="ruby"></span>    -<span class="ruby"> æ—¥å¿—AOF</span><br><span class="ruby"></span>    -<span class="ruby"> å¿«ç…§RDB</span><br><span class="ruby"></span># IOæ¨¡å‹è®¾è®¡<br>  &gt; Rediså•çº¿ç¨‹æ˜¯æŒ‡ç½‘ç»œIOå’Œé”®å€¼å¯¹è¯»å†™æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹å®Œæˆ. å…¶ä»–åŠŸèƒ½æŒä¹…åŒ–ã€å¼‚æ­¥åˆ é™¤ã€é›†ç¾¤æ•°æ®åŒæ­¥æ˜¯ç”±é¢å¤–çš„çº¿ç¨‹æ‰§è¡Œ.<br>  -<span class="ruby"> å¤šçº¿ç¨‹ç¼–ç¨‹æ¨¡å¼:</span><br><span class="ruby"></span>    -<span class="ruby"> é¢ä¸´å…±äº«èµ„æºçš„å¹¶å‘è®¿é—®æ§åˆ¶é—®é¢˜</span><br><span class="ruby"></span>    -<span class="ruby"> é‡‡ç”¨å¤šçº¿ç¨‹å¼€å‘ä¼šå¼•å…¥åŒæ­¥åŸè¯­æ¥ä¿æŠ¤å…±äº«èµ„æºçš„å¹¶å‘è®¿é—®</span><br><span class="ruby"></span>  -<span class="ruby"> å•çº¿ç¨‹ç¼–ç¨‹æ¨¡å¼:</span><br><span class="ruby"></span>    -<span class="ruby"> RedisåŸºæœ¬IOæ¨¡å‹ä¸­ï¼Œä¸»è¦æ˜¯ä¸»çº¿ç¨‹åœ¨æ‰§è¡Œæ“ä½œï¼Œä»»ä½•è€—æ—¶çš„æ“ä½œï¼Œbigkeyã€å…¨é‡è¿”å›ç­‰æ“ä½œï¼Œéƒ½æ˜¯æ½œåœ¨çš„æ€§èƒ½ç“¶é¢ˆ</span><br></code></pre></td></tr></table></figure></li>
<li><p>Sockerç½‘ç»œæ¨¡å‹</p>
<table>
<thead>
<tr>
<th align="left">è°ƒç”¨æ–¹æ³•</th>
<th align="left">è¿”å›å¥—æ¥å­—ç±»å‹</th>
<th align="left">éé˜»å¡æ¨¡å¼</th>
<th align="left">æ•ˆæœ</th>
</tr>
</thead>
<tbody><tr>
<td align="left">socket()</td>
<td align="left">ä¸»åŠ¨å¥—æ¥å­—</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">listen()</td>
<td align="left">ç›‘å¬å¥—æ¥å­—</td>
<td align="left">å¯è®¾ç½®</td>
<td align="left">accept()éé˜»å¡</td>
</tr>
<tr>
<td align="left">accept()</td>
<td align="left">å·²è¿æ¥å¥—æ¥å­—</td>
<td align="left">å¯è®¾ç½®</td>
<td align="left">send()/recv()éé˜»å¡</td>
</tr>
</tbody></table>
</li>
<li><p>Rediså¤šè·¯å¤ç”¨IOæ¨¡å‹<br><img src="/misc/images/redis-epoll.jpg" alt="åŸºäºå¤šè·¯å¤ç”¨çš„Redisé«˜æ€§èƒ½IOæ¨¡å‹"></p>
<blockquote>
<p>ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªIOæµ.è¯¥æœºåˆ¶å…è®¸å†…æ ¸ä¸­åŒæ—¶å­˜åœ¨å¤šä¸ªç›‘å¬å¥—æ¥å­—å’Œå·²è¿æ¥å¥—æ¥å­—.<br>select/epollæä¾›åŸºäºäº‹ä»¶çš„å›è°ƒæœºåˆ¶ï¼Œé’ˆå¯¹ä¸åŒäº‹ä»¶çš„å‘ç”Ÿï¼Œè°ƒç”¨å“åº”çš„å¤„ç†å‡½æ•°</p>
</blockquote>
</li>
<li><p>åº•å±‚æ•°æ®ç»“æ„æ—¶é—´å¤æ‚åº¦åˆ†ç±»</p>
<table>
<thead>
<tr>
<th align="left">åç§°</th>
<th align="left">æ—¶é—´å¤æ‚åº¦</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å“ˆå¸Œè¡¨</td>
<td align="left">O(1)</td>
</tr>
<tr>
<td align="left">è·³è¡¨</td>
<td align="left">O(logN)</td>
</tr>
<tr>
<td align="left">åŒå‘é“¾è¡¨</td>
<td align="left">O(N)</td>
</tr>
<tr>
<td align="left">å‹ç¼©åˆ—è¡¨</td>
<td align="left">O(N)</td>
</tr>
<tr>
<td align="left">æ•´æ•°æ•°ç»„</td>
<td align="left">O(N)</td>
</tr>
</tbody></table>
<figure class="highlight vala"><table><tr><td class="code"><pre><code class="hljs vala"><span class="hljs-meta"># å•å…ƒç´ æ“ä½œæ˜¯åŸºç¡€</span><br><span class="hljs-meta"># èŒƒå›´æ“ä½œéå¸¸è€—æ—¶</span><br>  - èŒƒå›´æ“ä½œæ˜¯æŒ‡é›†åˆç±»å‹ä¸­çš„éå†æ“ä½œ: O(N)<br>  - SCANæ“ä½œå®ç°æ¸è¿›å¼éå†ï¼Œåªè¿”å›æœ‰é™æ•°é‡çš„æ•°æ®.<br><span class="hljs-meta"># ç»Ÿè®¡æ“ä½œé€šå¸¸é«˜æ ¡</span><br>  å‹ç¼©åˆ—è¡¨å’ŒåŒå‘é“¾è¡¨éƒ½ä¼šè®°å½•è¡¨å¤´å’Œè¡¨å°¾çš„åç§»é‡<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><ul>
<li>é€šä¿¡åè®®<figure class="highlight routeros"><table><tr><td class="code"><pre><code class="hljs routeros">rediså®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å‘é€çš„å‘½ä»¤å’Œæ•°æ®ä¸€å¾‹ä»¥\r\n (CR LF)ç»“å°¾<br><br><span class="hljs-comment"># è¯·æ±‚åè®®:</span><br>  *&lt;å‚æ•°æ•°é‡&gt; CR LF<br>  $&lt;å‚æ•°çš„å­—èŠ‚æ•°é‡&gt; CR LF<br>  &lt;å‚æ•°çš„æ•°æ®&gt; CR LF<br><br>  ubuntu <span class="hljs-keyword">in</span> / î‚¢ at 3BPlus took 11s<br>  âœ tail appendonly.aof<br>  <span class="hljs-number">*3</span>        - è¡¨ç¤ºå½“å‰å‘½ä»¤æœ‰å•ä¸ªéƒ¨åˆ†<br>  <span class="hljs-variable">$3</span>        - å­—èŠ‚æ•°<br>  <span class="hljs-builtin-name">set</span><br>  <span class="hljs-variable">$4</span><br>  name<br>  <span class="hljs-variable">$10</span><br>  chyiyaqing<br><br><span class="hljs-comment"># å›å¤åè®®:</span><br>  &gt; åœ¨å›å¤åè®®ä¸­ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œç¡®å®šè¿™ä¸ªå›å¤æ˜¯ä»€ä¹ˆç±»å‹<br>  - çŠ¶æ€å›å¤ (status reply) ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ <span class="hljs-string">&quot;+&quot;</span><br>  - é”™è¯¯å›å¤ (<span class="hljs-builtin-name">error</span> reply) ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ <span class="hljs-string">&quot;-&quot;</span><br>  - æ•´æ•°å›å¤ (integer reply) ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ <span class="hljs-string">&quot;.&quot;</span><br>  - æ‰¹é‡å›å¤ (bulk reply) ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ <span class="hljs-string">&quot;$&quot;</span><br>  - å¤šæ¡æ‰¹é‡å›å¤ (multi bulk reply) ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ <span class="hljs-string">&quot;*&quot;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="æ€§èƒ½è°ƒä¼˜"><a href="#æ€§èƒ½è°ƒä¼˜" class="headerlink" title="æ€§èƒ½è°ƒä¼˜"></a>æ€§èƒ½è°ƒä¼˜</h2><h2 id="æ•°æ®æŒä¹…åŒ–"><a href="#æ•°æ®æŒä¹…åŒ–" class="headerlink" title="æ•°æ®æŒä¹…åŒ–"></a>æ•°æ®æŒä¹…åŒ–</h2><blockquote>
<p>Redis æŒä¹…åŒ–ä¸»è¦ä¸¤å¤§æœºåˆ¶: AOF (Append Only File) æ—¥å¿—å’ŒRDB å¿«ç…§</p>
</blockquote>
<ul>
<li><p>AOF - Append Only File</p>
<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">AOFæ—¥å¿—æ˜¯Redisæ‰§è¡Œå®Œå‘½ä»¤ï¼ŒæŠŠæ•°æ®å†™å…¥å†…å­˜ï¼Œç„¶åæ‰è®°å½•æ—¥å¿—,é¿å…å‡ºç°è®°å½•é”™è¯¯å‘½ä»¤çš„æƒ…å†µ,è®°å½•çš„æ˜¯Redisæ”¶åˆ°çš„æ¯ä¸€æ¡å‘½ä»¤, è¿™äº›å‘½ä»¤ä»¥æ–‡æœ¬å½¢å¼ä¿å­˜</span><br></code></pre></td></tr></table></figure>
<ul>
<li>AOF æ½œåœ¨çš„é£é™©<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">-</span> æ‰§è¡Œå®Œå‘½ä»¤è¿˜æ²¡æœ‰æ¥å¾—åŠè®°æ—¥å¿—å°±å®•æœºï¼Œè¿™ä¸ªå‘½ä»¤å’Œç›¸å…³çš„æ•°æ®æœ‰ä¸¢å¤±çš„é£é™©?<br><span class="hljs-bullet">-</span> AOFå†™æ—¥å¿—åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå¦‚æœç£ç›˜å†™å‹åŠ›è¿‡å¤§ï¼Œå°±ä¼šå¯¼è‡´å†™ç›˜å¾ˆæ…¢ï¼Œè¿›è€Œå¯¼è‡´åç»­çš„æ“ä½œæ— æ³•æ‰§è¡Œ<br><span class="hljs-section"># å†™å›ç£ç›˜ç­–ç•¥ appendfsync</span><br><span class="hljs-bullet">  1.</span> Always: åŒæ­¥å†™å›, æ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œç«‹é©¬åŒæ­¥å°†æ—¥å¿—å†™å›ç£ç›˜<br><span class="hljs-code">    &gt; è½ç›˜æ“ä½œå±äºæ…¢é€Ÿï¼Œå›å½±å“ä¸»çº¿ç¨‹æ€§èƒ½</span><br><span class="hljs-code">  2. Everysec: æ¯ç§’å†™å›,æ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ°AOFæ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œæ¯éš”ä¸€ç§’æŠŠç¼“å†²åŒºä¸­çš„å†…å®¹å†™å…¥ç£ç›˜</span><br><span class="hljs-code">    &gt; åœ¨é¿å…å½±å“ä¸»çº¿ç¨‹å’Œé¿å…æ•°æ®ä¸¢å¤±ä¸¤è€…ä¹‹é—´trade-offæ–¹å¼</span><br><span class="hljs-code">  3. No: æ“ä½œç³»ç»Ÿæ§åˆ¶å†™å›ï¼Œæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œåªæ˜¯å…ˆæŠŠæ—¥å¿—å†™åˆ°AOFæ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†ç¼“å†²åŒºå†…å®¹å†™å›ç£ç›˜</span><br><span class="hljs-code">    &gt; è½ç›˜æ—¶æœºäº¤ç»™æ“ä½œç³»ç»Ÿï¼Œåªè¦AOFè®°å½•æ²¡æœ‰å†™å›ç£ç›˜ï¼Œå®•æœºå¯¹åº”çš„æ•°æ®å°±ä¸¢å¤±</span><br></code></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th align="left">é…ç½®é¡¹</th>
<th align="left">å†™å›æ—¶æœº</th>
<th align="left">ä¼˜ç‚¹</th>
<th align="left">ç¼ºç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Always</td>
<td align="left">åŒæ­¥å†™å›</td>
<td align="left">å¯é æ€§é«˜ï¼Œæ•°æ®åŸºæœ¬ä¸ä¸¢å¤±</td>
<td align="left">æ¯ä¸ªå†™å‘½ä»¤éƒ½è¦è½ç›˜ï¼Œæ€§èƒ½å½±å“è¾ƒå¤§</td>
</tr>
<tr>
<td align="left">EverySec</td>
<td align="left">æ¯ç§’å†™å›</td>
<td align="left">æ€§èƒ½é€‚ä¸­</td>
<td align="left">å®•æœºæ—¶ä¸¢å¤±1ç§’å†…çš„æ•°æ®</td>
</tr>
<tr>
<td align="left">No</td>
<td align="left">æ“ä½œç³»ç»Ÿæ§åˆ¶å†™å›</td>
<td align="left">æ€§èƒ½å¥½</td>
<td align="left">å®•æœºä¸¢å¤±æ•°æ®è¾ƒå¤š</td>
</tr>
</tbody></table>
</li>
<li>AOFæ–‡ä»¶è¿‡å¤§çš„æ€§èƒ½é—®é¢˜<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> æ–‡ä»¶ç³»ç»Ÿæœ¬èº«å¯¹æ–‡ä»¶å¤§å°æœ‰é™åˆ¶ï¼Œæ— æ³•ä¿å­˜è¿‡å¤§çš„æ–‡ä»¶<br><span class="hljs-bullet">2.</span> æ–‡ä»¶è¿‡å¤§ï¼Œè¿½åŠ å‘½ä»¤è®°å½•æ•ˆç‡å˜ä½<br><span class="hljs-bullet">3.</span> å‘ç”Ÿå®•æœºï¼ŒAOFè®°å½•å‘½ä»¤è¦è¢«é‡æ–°æ‰§è¡Œï¼Œæ•…éšœæ¢å¤æ¯”è¾ƒç¼“æ…¢ï¼Œä¼šå½±å“Redisæ­£å¸¸ä½¿ç”¨<br></code></pre></td></tr></table></figure></li>
<li>AOFé‡å†™æœºåˆ¶:<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown">ç›´æ¥æ ¹æ®æ•°æ®åº“ä¸­æ•°æ®çš„æœ€æ–°çŠ¶æ€ï¼Œç”Ÿæˆè¿™äº›æ•°æ®çš„æ’å…¥å‘½ä»¤<br><span class="hljs-quote">&gt; é‡å†™æœºåˆ¶å¯ä»¥å°†æ—§æ—¥å¿—æ–‡ä»¶ä¸­çš„å¤šæ¡å‘½ä»¤ï¼Œåœ¨é‡å†™åçš„æ–°æ—¥å¿—ä¸­å˜æˆä¸€æ¡å‘½ä»¤</span><br><span class="hljs-quote">&gt; AOFé‡å†™è¿‡ç¨‹æ˜¯ç”±åå°å­è¿›ç¨‹bgrewriteaofå®Œæˆï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™</span><br><span class="hljs-bullet">-</span> &quot;ä¸€ä¸ªæ‹·è´ï¼Œä¸¤å¤„æ—¥å¿—&quot;<br><span class="hljs-bullet">  -</span> ä¸€ä¸ªæ‹·è´: æ¯æ¬¡æ‰§è¡Œé‡å†™æ—¶ï¼Œä¸»çº¿ç¨‹forkå‡ºåå°çš„bgrewriteaofå­è¿›ç¨‹ï¼Œæ­¤æ—¶ï¼Œforkä¼šæŠŠä¸»çº¿ç¨‹çš„å†…å­˜æ‹·è´ä¸€ä»½ç»™bgrewriteaofå­è¿›ç¨‹ï¼Œç„¶åbgrewriteaofå­è¿›ç¨‹åœ¨ä¸å½±å“ä¸»çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œé€ä¸€æŠŠæ‹·è´çš„æ•°æ®å†™æˆæ“ä½œï¼Œè®°å…¥é‡å†™æ—¥å¿—.<br><span class="hljs-bullet">  -</span> ä¸¤å¤„æ—¥å¿—: ä¸€ä¸ªæ˜¯æ­£åœ¨ä½¿ç”¨çš„AOFæ—¥å¿—ï¼ŒRedisä¼šæŠŠæ“ä½œå†™åˆ°å®ƒçš„ç¼“å†²åŒºï¼Œç¬¬äºŒå¤„æ—¥å¿—æ˜¯æ–°çš„AOFé‡å†™æ—¥å¿—ï¼Œç­‰åˆ°æ‹·è´æ•°æ®çš„æ‰€æœ‰æ“ä½œè®°å½•é‡å†™å®Œæˆåï¼Œé‡å†™æ—¥å¿—è®°å½•çš„æ“ä½œä¹Ÿä¼šå†™å…¥æ–°çš„AOFæ–‡ä»¶ï¼Œä¿è¯æ•°æ®åº“æœ€æ–°çŠ¶æ€çš„è®°å½•<br></code></pre></td></tr></table></figure>
<img src="/misc/images/bgrewriteaof.jpg" alt="AOFéé˜»å¡é‡å†™è¿‡ç¨‹"></li>
</ul>
</li>
<li><p>RDB(Redis DataBase) - å†…å­˜å¿«ç…§</p>
<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">å†…å­˜å¿«ç…§ï¼šæŒ‡å†…å­˜ä¸­çš„æ•°æ®åœ¨æŸä¸€ä¸ªæ—¶åˆ»çš„çŠ¶æ€è®°å½•</span><br></code></pre></td></tr></table></figure>
<ul>
<li>Redisä¸¤ç§å‘½ä»¤ç”ŸæˆRDBæ–‡ä»¶<ul>
<li>save: åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œä¼šå¯¼è‡´é˜»å¡</li>
<li>bgsave: åˆ›å»ºå­è¿›ç¨‹ï¼Œä¸“é—¨ç”¨äºå†™å…¥RDBæ–‡ä»¶ï¼Œé¿å…ä¸»çº¿ç¨‹é˜»å¡, é»˜è®¤é…ç½®<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-quote">&gt; bgsaveå­è¿›ç¨‹ç”±ä¸»çº¿ç¨‹forkç”Ÿæˆï¼Œå…±äº«ä¸»çº¿ç¨‹çš„æ‰€æœ‰å†…å­˜æ•°æ®ï¼Œbgsaveå­è¿›ç¨‹è¿è¡Œåï¼Œå¼€å§‹è¯»å–ä¸»çº¿ç¨‹çš„å†…å­˜æ•°æ®ï¼Œå¹¶æŠŠæ•°æ®å†™å…¥RDBæ–‡ä»¶</span><br><span class="hljs-bullet">  1.</span> é¢‘ç¹å°†å…¨é‡æ•°æ®å†™å…¥ç£ç›˜ï¼Œä¼šç»™ç£ç›˜å¸¦æ¥å¾ˆå¤§å‹åŠ›.<br><span class="hljs-bullet">  2.</span> bgsaveå­è¿›ç¨‹éœ€è¦forkæ“ä½œä»ä¸»çº¿ç¨‹åˆ›å»ºå‡ºæ¥, forkæ“ä½œä¼šé˜»å¡ä¸»çº¿ç¨‹<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li>COW - Copy-On-Write<br><img src="/misc/images/redis-cow.jpg" alt="å†™æ—¶å¤åˆ¶æœºåˆ¶"><figure class="highlight erlang"><table><tr><td class="code"><pre><code class="hljs erlang">å†™æ—¶å¤åˆ¶æŠ€æœ¯å…·ä½“æ¥è¯´ï¼Œä¸»çº¿ç¨‹åœ¨æœ‰å†™æ“ä½œæ—¶ï¼Œæ‰ä¼šæŠŠè¿™ä¸ªæ–°å†™æˆ–è€…ä¿®æ”¹çš„æ•°æ®å†™å…¥åˆ°æ–°çš„ç‰©ç†åœ°å€,å¹¶ä¿®æ”¹è‡ªå·±çš„é¡µè¡¨æ˜ å°„.<br>ä¿è¯å¿«ç…§çš„å®Œæ•´æ€§ï¼Œä¹Ÿå…è®¸ä¸»çº¿ç¨‹åŒæ—¶å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œé¿å…å¯¹æ­£å¸¸ä¸šåŠ¡çš„å½±å“<br></code></pre></td></tr></table></figure></li>
<li>Redis 4.0 æ··åˆAOF+RDB<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># å¢é‡å¿«ç…§:</span><br><span class="hljs-quote">&gt; åšä¸€æ¬¡å…¨é‡å¿«ç…§åï¼Œåç»­çš„å¿«ç…§æ”¯é˜Ÿä¿®æ”¹çš„æ•°æ®è¿›è¡Œå¿«ç…§è®°å½•ï¼Œå¯ä»¥é¿å…æ¯æ¬¡å…¨é‡å¿«ç…§çš„å¼€é”€</span><br><br><span class="hljs-section"># æ··åˆä½¿ç”¨AOFæ—¥å¿—å’Œå†…å­˜å¿«ç…§</span><br><span class="hljs-quote">&gt; å†…å­˜å¿«ç…§ä»¥ä¸€å®šçš„é¢‘ç‡æ‰§è¡Œï¼Œä¸¤æ¬¡å¿«ç…§ä¹‹é—´ï¼Œä½¿ç”¨AOFæ—¥å¿—è®°å½•è¿™æœŸé—´çš„æ‰€æœ‰å‘½ä»¤æ“ä½œ</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="æ•°æ®åŒæ­¥"><a href="#æ•°æ®åŒæ­¥" class="headerlink" title="æ•°æ®åŒæ­¥"></a>æ•°æ®åŒæ­¥</h2><ul>
<li>Redis ä¸»ä»åº“æ¨¡å¼<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-quote">&gt; ä¸»ä»åº“é‡‡ç”¨è¯»å†™åˆ†ç¦»æ–¹å¼</span><br><span class="hljs-bullet">  -</span> è¯»æ“ä½œ: ä¸»åº“ã€ä»åº“éƒ½å¯ä»¥æ¥æ”¶<br><span class="hljs-bullet">  -</span> å†™æ“ä½œ: é¦–å…ˆåˆ°ä¸»åº“æ‰§è¡Œï¼Œç„¶åï¼Œä¸»åº“å°†å†™æ“ä½œåŒæ­¥ç»™ä»åº“<br></code></pre></td></tr></table></figure>
<ul>
<li>ä¸»ä»åº“å¦‚ä½•è¿›è¡Œç¬¬ä¸€æ¬¡åŒæ­¥?<br><img src="/misc/images/master-slave-sync.jpg" alt="ä¸»ä»åº“ç¬¬ä¸€æ¬¡åŒæ­¥æµç¨‹"><figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># ä¸‰ä¸ªé˜¶æ®µ</span><br><span class="hljs-bullet">  1.</span> ç¬¬ä¸€é˜¶æ®µ: å»ºç«‹è¿æ¥ã€åå•†åŒæ­¥<br><span class="hljs-bullet">    -</span> psync ? -1<br><span class="hljs-bullet">    -</span> runID: Rediså®ä¾‹è‡ªåŠ¨ç”Ÿæˆçš„éšæœºID<br><span class="hljs-bullet">    -</span> offset: å¤åˆ¶çš„åç§»é‡<br><span class="hljs-bullet">    -</span> FULLRESYNC: è¡¨ç¤ºç¬¬ä¸€æ¬¡å¤åˆ¶é‡‡ç”¨å…¨é‡å¤åˆ¶ï¼Œä¸»åº“ä¼šæŠŠå½“å‰æ‰€æœ‰çš„æ•°æ®éƒ½å¤åˆ¶ç»™ä»åº“<br><span class="hljs-bullet">  2.</span> ç¬¬äºŒé˜¶æ®µ: ä¸»åº“åŒæ­¥æ•°æ®ç»™ä»åº“<br><span class="hljs-bullet">    -</span> ä¸»åº“å°†æ‰€æœ‰æ•°æ®åŒæ­¥ç»™ä»åº“,ä»åº“æ”¶åˆ°æ•°æ®åï¼Œåœ¨æœ¬åœ°å®Œæˆæ•°æ®åŠ è½½<br><span class="hljs-bullet">    -</span> replication buffer: ä¸»ä»åº“åœ¨è¿›è¡Œå…¨é‡å¤åˆ¶æ—¶ï¼Œä¸»åº“ä¸Šç”¨äºå’Œä»åº“è¿æ¥çš„å®¢æˆ·ç«¯buffer<br><span class="hljs-bullet">  3.</span> ç¬¬ä¸‰é˜¶æ®µ: ä¸»åº“å‘é€æ–°å†™å‘½ä»¤ç»™ä»åº“<br><span class="hljs-bullet">    -</span> ä¸»åº“æŠŠreplication buffer æ“ä½œå‘ç»™ä»åº“<br><span class="hljs-bullet">    -</span> ä¸»åº“ä¼šç»™æ¯ä¸ªä»åº“å»ºç«‹ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œæ‰€ä»¥replication bufferä¸æ˜¯å…±äº«çš„ï¼Œè€Œæ˜¯æ¯ä¸ªä»åº“éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„å®¢æˆ·ç«¯<br><br><span class="hljs-section"># ä¸»ä»åº“å¤åˆ¶é‡‡ç”¨RDB,ä¸é‡‡ç”¨AOF?</span><br><span class="hljs-bullet">  1.</span> RDB æ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ— è®ºè¦æŠŠRDBå†™å…¥ç£ç›˜è¿˜æ˜¯é€šè¿‡ç½‘ç»œä¼ è¾“RDBï¼ŒIOæ•ˆç‡æ¯”è®°å½•çš„çº¯æ–‡æœ¬AOFé«˜<br><span class="hljs-bullet">  2.</span> åœ¨ä»åº“è¿›è¡Œæ¢å¤æ—¶ï¼Œç”¨RDBçš„æ¢å¤æ•ˆç‡æ¯”AOFé«˜<br></code></pre></td></tr></table></figure></li>
<li>ä¸» - ä» - ä»<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">é€šè¿‡â€œä¸»-ä»-ä»â€æ¨¡å¼å°†ä¸»åº“ç”ŸæˆRDBå’Œä¼ è¾“RDBçš„å‹åŠ›ï¼Œä»¥çº§è”çš„æ–¹å¼åˆ†æ•£åˆ°ä»åº“ä¸­</span><br></code></pre></td></tr></table></figure></li>
<li>åŸºäºé•¿è¿æ¥çš„å‘½ä»¤ä¼ æ’­<figure class="highlight vala"><table><tr><td class="code"><pre><code class="hljs vala"><span class="hljs-meta"># repl_backlog_size:</span><br><span class="hljs-meta"># repl_backlog_buffer: ä¸ºäº†æ”¯æŒä»åº“å¢é‡å¤åˆ¶ï¼Œä¸»åº“ä¸Šç”¨äºæŒç»­ä¿æŒå†™æ“ä½œçš„ä¸€å—ä¸“ç”¨buffer, æ‰€æœ‰ä»åº“å…±äº«</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li>å“¨å…µæœºåˆ¶<br><img src="/misc/images/redis-sentinel.jpg" alt="å“¨å…µæœºåˆ¶ä»»åŠ¡"><figure class="highlight haml"><table><tr><td class="code"><pre><code class="hljs haml">  &gt; Redisä¸»ä»é›†ç¾¤ä¸­ï¼Œå“¨å…µæœºåˆ¶å®ç°ä¸»ä»åº“è‡ªåŠ¨åˆ‡æ¢, è§£å†³ä¸»ä»å¤åˆ¶æ¨¡å¼ä¸‹æ•…éšœè½¬ç§»<br>  # å“¨å…µé›†ç¾¤:<br>    &gt; é‡‡ç”¨å¤šå®ä¾‹ç»„æˆçš„é›†ç¾¤æ¨¡å¼è¿›è¡Œéƒ¨ç½², å¼•å…¥å¤šå“¨å…µåˆ¤æ–­é¿å…å•ä¸ªå“¨å…µè‡ªèº«ç½‘ç»œçŠ¶æ€ä¸å¥½ï¼Œè¯¯åˆ¤ä¸»åº“ä¸‹çº¿<br>    &gt; Nä¸ªå“¨å…µå®ä¾‹ï¼Œæœ€å¥½è¦æœ‰N/2+1å®ä¾‹åˆ¤æ–­ä¸»åº“ä¸º&quot;ä¸»è§‚ä¸‹çº¿&quot;, æœ€ç»ˆåˆ¤å®šä¸»åº“ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€<br><br>  # å“¨å…µè´Ÿè´£çš„ä»»åŠ¡:<br>    -<span class="ruby"> ç›‘æ§</span><br><span class="ruby"></span>      -<span class="ruby"> å‘¨æœŸæ€§å‘æ‰€æœ‰çš„ä¸»ä»åº“å‘é€PINGå‘½ä»¤</span><br><span class="ruby"></span>      -<span class="ruby"> å“¨å…µå¯¹ä¸»åº“ä¸‹çº¿åˆ¤æ–­:</span><br><span class="ruby"></span>        -<span class="ruby"> ä¸»è§‚ä¸‹çº¿: å“¨å…µè¿›ç¨‹ä½¿ç”¨PINGå‘½ä»¤æ£€æµ‹è‡ªå·±å’Œä¸»ã€ä»åº“çš„ç½‘ç»œè¿æ¥æƒ…å†µï¼Œåˆ¤æ–­å®ä¾‹çš„çŠ¶æ€</span><br><span class="ruby"></span>          -<span class="ruby"> è¯¯åˆ¤: å‘ç”Ÿåœ¨é›†ç¾¤ç½‘ç»œå‹åŠ›è¾ƒå¤§ã€ç½‘ç»œæ‹¥èµ›ï¼Œæˆ–è€…ä¸»åº“æœ¬èº«å‹åŠ›è¾ƒå¤§</span><br><span class="ruby"></span>        -<span class="ruby"> å®¢è§‚ä¸‹çº¿:</span><br><span class="ruby"></span>    -<span class="ruby"> é€‰ä¸»</span><br><span class="ruby"></span>      -<span class="ruby"> ä¸»åº“æŒ‚äº†ä¹‹åï¼Œå“¨å…µéœ€è¦ä»å¾ˆå¤šä»åº“ä¸­é€‰æ‹©ä¸€ä¸ªä»åº“å®ä¾‹</span><br><span class="ruby"></span>      -<span class="ruby"> <span class="hljs-string">&quot;ç­›é€‰&quot;</span> + <span class="hljs-string">&quot;æ‰“åˆ†&quot;</span>:</span><br><span class="ruby"></span>        -<span class="ruby"> <span class="hljs-string">&quot;ç­›é€‰&quot;</span>: æ£€æŸ¥ä»åº“çš„å½“å‰åœ¨çº¿çŠ¶æ€ï¼Œåˆ¤æ–­ç½‘ç»œè¿æ¥çŠ¶æ€</span><br><span class="ruby"></span>        -<span class="ruby"> <span class="hljs-string">&quot;æ‰“åˆ†&quot;</span>: ä»åº“ä¼˜å…ˆçº§ã€ä»åº“å¤åˆ¶è¿›åº¦ä»¥åŠä»åº“IDå·</span><br><span class="ruby"></span>          -<span class="ruby"> replica-priority <span class="hljs-number">100</span></span><br><span class="ruby"></span>    -<span class="ruby"> é€šçŸ¥</span><br><span class="ruby"></span>      -<span class="ruby"> å“¨å…µä¼šæŠŠæ–°ä¸»åº“çš„è¿æ¥ä¿¡æ¯å‘ç»™å…¶ä»–ä»åº“ï¼Œè®©ä»–ä»¬æ‰§è¡Œreplicaofå‘½ä»¤ï¼Œå’Œæ–°ä¸»åº“å»ºç«‹è¿æ¥ï¼Œå¹¶è¿›è¡Œæ•°æ®å¤åˆ¶,åŒæ—¶å“¨å…µæŠŠæ–°ä¸»åº“çš„è¿æ¥ä¿¡æ¯é€šçŸ¥ç»™å®¢æˆ·ç«¯ï¼Œè¯·æ±‚æ“ä½œå‘åˆ°æ–°ä¸»åº“ä¸Š.</span><br><span class="ruby"></span><br># åŸºäºpub/sub æœºåˆ¶çš„å“¨å…µé›†ç¾¤<br>  &gt; å“¨å…µåªè¦å’Œä¸»åº“å»ºç«‹è¿æ¥ï¼Œå°±å¯ä»¥åœ¨ä¸»åº“ä¸Šå‘å¸ƒæ¶ˆæ¯ï¼Œæ¯”å¦‚å‘å¸ƒè‡ªå·±çš„è¿æ¥ä¿¡æ¯(IPå’Œç«¯å£),ä»ä¸»åº“ä¸Šè®¢é˜…æ¶ˆæ¯ï¼Œè·å–å…¶ä»–å“¨å…µå‘å¸ƒçš„è¿æ¥ä¿¡æ¯<br><br>  -<span class="ruby"> å“¨å…µè·å–ä»åº“çš„IP+ç«¯å£</span><br><span class="ruby"></span>    -<span class="ruby"> å“¨å…µå‘ä¸»åº“å‘é€INFOå‘½ä»¤,æŸ¥çœ‹ä»åº“åˆ—è¡¨,è¿›è€Œä¸ä»åº“å»ºç«‹è¿æ¥</span><br><span class="ruby"></span>  -<span class="ruby"> pub/subå®¢æˆ·ç«¯äº‹ä»¶é€šçŸ¥</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Redisåˆ‡ç‰‡é›†ç¾¤"><a href="#Redisåˆ‡ç‰‡é›†ç¾¤" class="headerlink" title="Redisåˆ‡ç‰‡é›†ç¾¤"></a>Redisåˆ‡ç‰‡é›†ç¾¤</h2>  <figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">åˆ‡ç‰‡é›†ç¾¤(åˆ†ç‰‡é›†ç¾¤)å¯ä»¥ä¿å­˜å¤§é‡æ•°æ®ï¼Œå¯¹Redisä¸»çº¿ç¨‹é˜»å¡å½±å“è¾ƒå°</span><br></code></pre></td></tr></table></figure>
<ul>
<li>çºµå‘æ‰©å±•(scale up):</li>
<li>æ¨ªå‘æ‰©å±•(scale out):<ul>
<li>Redis Cluster:<figure class="highlight vala"><table><tr><td class="code"><pre><code class="hljs vala">&gt; Redis Cluster é‡‡ç”¨å“ˆå¸Œæ§½(Hash Slot)å¤„ç†æ•°æ®å’Œå®ä¾‹ä¹‹é—´çš„æ˜ å°„å…³ç³». <span class="hljs-number">2</span>^<span class="hljs-number">14</span><br><br><span class="hljs-meta"># keyæ˜ å°„å“ˆå¸Œslot</span><br>  <span class="hljs-number">1.</span> æ ¹æ®é”®å€¼keyï¼ŒæŒ‰ç…§CRC16ç®—æ³•è®¡ç®—<span class="hljs-number">16</span>-bitå€¼ï¼Œç„¶åå¯¹<span class="hljs-number">16384</span>å–æ¨¡,æ¯ä¸ªæ‘¸æ•°ä»£è¡¨å“åº”ç¼–å·çš„å“ˆå¸Œæ§½ã€‚<br><br><span class="hljs-meta"># é‡å®šå‘æœºåˆ¶</span><br>  &gt; å®¢æˆ·ç«¯ç»™ä¸€ä¸ªå®ä¾‹å‘é€æ•°æ®è¯»å†™æ“ä½œæ—¶ï¼Œè¿™ä¸ªå®ä¾‹ä¸Šå¹¶æ²¡æœ‰ç›¸åº”çš„æ•°æ®ï¼Œå®¢æˆ·ç«¯è¦å†ç»™ä¸€ä¸ªæ–°å®ä¾‹å‘é€æ“ä½œå‘½ä»¤<br>  <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6001</span>&gt; <span class="hljs-keyword">get</span> name<br>  -&gt; Redirected to slot [<span class="hljs-number">5798</span>] located at <span class="hljs-number">172.30</span><span class="hljs-number">.1</span><span class="hljs-number">.23</span>:<span class="hljs-number">6002</span><br>  <span class="hljs-string">&quot;chyiyaqing&quot;</span><br>  <span class="hljs-number">172.30</span><span class="hljs-number">.1</span><span class="hljs-number">.23</span>:<span class="hljs-number">6002</span>&gt;<br><br><span class="hljs-meta"># ASK:</span><br>  ASKå‘½ä»¤å¹¶ä¸ä¼šæ›´æ–°å®¢æˆ·ç«¯ç¼“å­˜çš„å“ˆå¸Œæ§½åˆ†é…ä¿¡æ¯<br><span class="hljs-meta"># MOVED:</span><br>  æ›´æ”¹æœ¬åœ°ç¼“å­˜ï¼Œè®©åç»­æ‰€æœ‰å‘½ä»¤éƒ½å‘å¾€æ–°å®ä¾‹<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="Redis-åº”ç”¨åœºæ™¯-æ¶ˆæ¯é˜Ÿåˆ—"><a href="#Redis-åº”ç”¨åœºæ™¯-æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="Redis åº”ç”¨åœºæ™¯ - æ¶ˆæ¯é˜Ÿåˆ—"></a>Redis åº”ç”¨åœºæ™¯ - æ¶ˆæ¯é˜Ÿåˆ—</h2>  <figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># æ¶ˆæ¯é˜Ÿåˆ—éœ€è¦æ»¡è¶³çš„åŠŸèƒ½:</span><br><br><span class="hljs-bullet">  1.</span> æ”¯æŒé˜»å¡ç­‰å¾…æ‹‰å–æ¶ˆæ¯<br><span class="hljs-bullet">  2.</span> æ”¯æŒå‘å¸ƒ/è®¢é˜…æ¨¡å¼<br><span class="hljs-bullet">  3.</span> æ¶ˆè´¹å¤±è´¥ï¼Œå¯é‡æ–°æ¶ˆè´¹ï¼Œæ¶ˆæ¯ä¸ä¸¢å¤±<br><span class="hljs-bullet">  4.</span> å®ä¾‹å®•æœºï¼Œæ¶ˆæ¯ä¸ä¸¢å¤±ã€æ•°æ®å¯æŒä¹…åŒ–<br><span class="hljs-bullet">  5.</span> æ¶ˆæ¯å¯å †ç§¯<br></code></pre></td></tr></table></figure>

<ul>
<li><p>List - é˜Ÿåˆ—:</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><code class="hljs accesslog">ubuntu in ~ at 3BPlus<br>âœ redis-cli -c -p <span class="hljs-number">6001</span><br><span class="hljs-number">127.0.0.1:6001</span>&gt; ping<br>PONG<br><span class="hljs-number">127.0.0.1:6001</span>&gt; LPUSH queue msg1    # å¢åŠ æ¶ˆæ¯<br>-&gt; Redirected to slot <span class="hljs-string">[13011]</span> located at <span class="hljs-number">172</span>.<span class="hljs-number">30</span>.<span class="hljs-number">1</span>.<span class="hljs-number">23</span>:<span class="hljs-number">6003</span><br>(integer) <span class="hljs-number">1</span><br><span class="hljs-number">172.30.1.23:6003</span>&gt; LPUSH queue msg2<br>(integer) <span class="hljs-number">2</span><br><span class="hljs-number">172.30.1.23:6003</span>&gt; RPOP queue        # æ‹‰å–æ¶ˆæ¯<br><span class="hljs-string">&quot;msg1&quot;</span><br><span class="hljs-number">172.30.1.23:6003</span>&gt; RPOP queue<br><span class="hljs-string">&quot;msg2&quot;</span><br><span class="hljs-number">127.0.0.1:6001</span>&gt; RPOP queue          # é˜Ÿåˆ—ä¸ºç©ºï¼ŒRPOPè¿”å›NULL<br>-&gt; Redirected to slot <span class="hljs-string">[13011]</span> located at <span class="hljs-number">172</span>.<span class="hljs-number">30</span>.<span class="hljs-number">1</span>.<span class="hljs-number">23</span>:<span class="hljs-number">6003</span><br>(nil)<br><span class="hljs-number">127.0.0.1:6001</span>&gt; BRPOP queue <span class="hljs-number">5</span>       # BRPOPé˜»å¡å¼æ‹‰å–æ¶ˆæ¯ï¼Œæ”¯æŒä¼ å…¥è¶…æ—¶æ—¶é—´<br>-&gt; Redirected to slot <span class="hljs-string">[13011]</span> located at <span class="hljs-number">172</span>.<span class="hljs-number">30</span>.<span class="hljs-number">1</span>.<span class="hljs-number">23</span>:<span class="hljs-number">6003</span><br>(nil)<br>(<span class="hljs-number">5</span>.00s)<br><span class="hljs-number">172.30.1.23:6003</span>&gt; BRPOP queue <span class="hljs-number">0</span>     # ä¸è®¾ç½®è¶…æ—¶ï¼Œç›´åˆ°æœ‰æ–°æ¶ˆæ¯æ‰è¿”å›<br>^C<br><span class="hljs-number">172.30.1.23:6003</span>&gt; exit<br><br>æ³¨æ„: å¦‚æœè®¾ç½®è¶…æ—¶æ—¶é—´å¤ªé•¿ï¼Œè¿æ¥å¤ªä¹…æ²¡æœ‰æ´»è·ƒï¼Œæœ‰å¯èƒ½ä¼šè¢«Redis serveråˆ¤å®šä¸ºæ— æ•ˆè¿æ¥ï¼Œä¹‹åRedis Serverä¼šå¼ºåˆ¶æŠŠè¿™ä¸ªå®¢æˆ·ç«¯è¸¢ä¸‹çº¿ï¼Œå®¢æˆ·ç«¯è¦æœ‰é‡è¿æœºåˆ¶<br><br><span class="hljs-number">1</span>. ä¸æ”¯æŒé‡å¤æ¶ˆè´¹ï¼šæ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯åï¼Œè¯¥æ¶ˆæ¯å°±ä»Listä¸­åˆ é™¤ï¼Œæ— æ³•è¢«å…¶ä»–æ¶ˆè´¹è€…åœ¨æ­¤æ¶ˆè´¹ï¼Œå³ä¸æ”¯æŒå¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹åŒä¸€æ‰¹æ•°æ®<br><span class="hljs-number">2</span>. æ¶ˆæ¯ä¸¢å¤±ï¼Œæ¶ˆè´¹è€…æ‹‰å–åˆ°æ¶ˆæ¯åï¼Œå¦‚æœå‘ç”Ÿå¼‚å¸¸å®•æœºï¼Œè¿™æ¡æ¶ˆæ¯å°±ä¸¢å¤±<br><br># å•æœºæµ‹è¯„<br>ubuntu in ~ at 3BPlus took 37s<br>âœ redis-benchmark -n <span class="hljs-number">1000000</span> -t lpush,rpop -P <span class="hljs-number">16</span> -q -h <span class="hljs-number">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span> -p <span class="hljs-number">6001</span> --cluster<br>Cluster has <span class="hljs-number">3</span> master nodes:<br><br>Master <span class="hljs-number">0</span>: a733c21d3b735b9d026eb4d462ef6b367d8ebb98 <span class="hljs-number">172</span>.<span class="hljs-number">30</span>.<span class="hljs-number">1</span>.<span class="hljs-number">23</span>:<span class="hljs-number">6002</span><br>Master <span class="hljs-number">1</span>: 9c35a4e211f6534861ed768dba592e85539b1377 <span class="hljs-number">172</span>.<span class="hljs-number">30</span>.<span class="hljs-number">1</span>.<span class="hljs-number">23</span>:<span class="hljs-number">6003</span><br>Master <span class="hljs-number">2</span>: a901e497cb72819cf0765e9e4eb16c36399c437b <span class="hljs-number">172</span>.<span class="hljs-number">30</span>.<span class="hljs-number">1</span>.<span class="hljs-number">23</span>:<span class="hljs-number">6001</span><br><br>LPUSH: <span class="hljs-number">41529</span>.<span class="hljs-number">96</span> requests per second, p50=<span class="hljs-number">17</span>.<span class="hljs-number">199</span> msec<br>RPOP: <span class="hljs-number">46539</span>.<span class="hljs-number">77</span> requests per second, p50=<span class="hljs-number">15</span>.<span class="hljs-number">463</span> msec<br></code></pre></td></tr></table></figure></li>
<li><p>Pub/Sub - å‘å¸ƒè®¢é˜…æ¨¡å‹</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># æ¶ˆè´¹è€…1</span><br>ubuntu <span class="hljs-keyword">in</span> ~ <span class="hljs-keyword">at</span> <span class="hljs-number">3</span>BPlus<br>âœ redis-cli -c -p <span class="hljs-number">6001</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6001</span>&gt; SUBSCRIBE queue<br>Reading messages... (press Ctrl-C <span class="hljs-keyword">to</span> quit)<br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;subscribe&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;queue&quot;</span><br><span class="hljs-number">3</span>) (<span class="hljs-built_in">integer</span>) <span class="hljs-number">1</span><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;message&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;queue&quot;</span><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;msg1&quot;</span><br><br><span class="hljs-comment"># æ¶ˆè´¹è€…2</span><br>ubuntu <span class="hljs-keyword">in</span> ~ <span class="hljs-keyword">at</span> <span class="hljs-number">3</span>BPlus<br>âœ redis-cli -c -p <span class="hljs-number">6001</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6001</span>&gt; SUBSCRIBE queue<br>Reading messages... (press Ctrl-C <span class="hljs-keyword">to</span> quit)<br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;subscribe&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;queue&quot;</span><br><span class="hljs-number">3</span>) (<span class="hljs-built_in">integer</span>) <span class="hljs-number">1</span><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;message&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;queue&quot;</span><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;msg1&quot;</span><br><br><span class="hljs-comment"># ç”Ÿäº§è€…</span><br>ubuntu <span class="hljs-keyword">in</span> ~ <span class="hljs-keyword">at</span> <span class="hljs-number">3</span>BPlus<br>âœ redis-cli -c -p <span class="hljs-number">6001</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6001</span>&gt; PUBLISH queue msg1<br>(<span class="hljs-built_in">integer</span>) <span class="hljs-number">2</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6001</span>&gt; PUBLISH queue msg2<br>(<span class="hljs-built_in">integer</span>) <span class="hljs-number">2</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6001</span>&gt; <span class="hljs-keyword">exit</span><br><br><span class="hljs-comment"># Pub/Sub æ”¯æŒé˜»å¡å¼æ‹‰å–æ¶ˆæ¯ï¼Œæ»¡è¶³å¤šç»„æ¶ˆè´¹è€…ï¼ŒåŒ¹é…è®¢é˜…æ¨¡å¼,å…è®¸æ¶ˆè´¹è€…è®¢é˜…å¤šä¸ªé˜Ÿåˆ—</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6001</span>&gt; PUBLISH queue.p1 msg1       <span class="hljs-comment">-- ç”Ÿäº§è€…</span><br>(<span class="hljs-built_in">integer</span>) <span class="hljs-number">1</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6001</span>&gt; PUBLISH queue.p2 msg2<br>(<span class="hljs-built_in">integer</span>) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6001</span>&gt; PSUBSCRIBE queue.*          <span class="hljs-comment">-- æ¶ˆè´¹è€… åŒ¹é…è®¢é˜…</span><br>Reading messages... (press Ctrl-C <span class="hljs-keyword">to</span> quit)<br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;psubscribe&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;queue.*&quot;</span><br><span class="hljs-number">3</span>) (<span class="hljs-built_in">integer</span>) <span class="hljs-number">1</span><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;pmessage&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;queue.*&quot;</span><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;queue.p1&quot;</span><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;msg1&quot;</span><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;pmessage&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;queue.*&quot;</span><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;queue.p2&quot;</span><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;msg2&quot;</span><br><br><span class="hljs-comment"># Pub/Sub å®ç°åŸç†</span><br>&gt; æ²¡æœ‰åŸºäºä»»ä½•æ•°æ®ç±»å‹ï¼Œæ²¡æœ‰åšä»»ä½•æ•°æ®å­˜å‚¨ï¼Œåªæ˜¯å•çº¯åœ°ä¸ºç”Ÿäº§è€…ã€æ¶ˆè´¹è€…å»ºç«‹æ•°æ®è½¬å‘é€šé“ï¼ŒæŠŠç¬¦åˆè§„åˆ™çš„æ•°æ®ï¼Œä»ä¸€ç«¯è½¬å‘åˆ°å¦ä¸€ç«¯<br>&gt; **åœ¨ä½¿ç”¨Pub/Subæ—¶ï¼Œæ¶ˆè´¹è€…å¿…é¡»å…ˆè®¢é˜…é˜Ÿåˆ—ï¼Œç”Ÿäº§è€…æ‰èƒ½å‘å¸ƒæ¶ˆæ¯ï¼Œå¦åˆ™æ¶ˆæ¯ä¼šä¸¢å¤±**<br>&gt; Listå±äºâ€œæ‹‰å–æ¨¡å¼â€, Pub/Subå±äºâ€œæ¨æ¨¡å¼â€<br><br><span class="hljs-comment"># æ³¨æ„ä½¿ç”¨Pub/Subä¼šä¸¢æ•°æ®</span><br><span class="hljs-number">1.</span> æ¶ˆè´¹è€…ä¸‹çº¿,é‡æ–°ä¸Šçº¿ï¼Œåªèƒ½æ¥æ”¶æ–°çš„æ¶ˆæ¯ï¼Œåœ¨ä¸‹çº¿æœŸé—´ç”Ÿäº§è€…å‘å¸ƒçš„æ¶ˆæ¯ï¼Œå› ä¸ºæ‰¾ä¸åˆ°æ¶ˆè´¹è€…ï¼Œä¼šè¢«ä¸¢å¼ƒæ‰.<br><span class="hljs-number">2.</span> Rediså®•æœº, Pub/Subç›¸å…³æ“ä½œï¼Œä¸ä¼šå†™å…¥RDBå’ŒAOFä¸­ï¼Œå½“Rediså®•æœºé‡å¯ï¼ŒPub/Subçš„æ•°æ®ä¼šå…¨éƒ¨ä¸¢å¤±<br><span class="hljs-number">3.</span> æ¶ˆè´¹å †ç§¯, æ¯ä¸ªæ¶ˆè´¹è€…è®¢é˜…ä¸€ä¸ªé˜Ÿåˆ—ï¼ŒRediséƒ½ä¼šåœ¨Serverç»™æ¶ˆè´¹è€…åˆ†é…ä¸€ä¸ªã€ç¼“å†²åŒºã€‘,è¿™ä¸ªç¼“å†²åŒºå…¶å®å°±æ˜¯ä¸€å—å†…å­˜ï¼Œå½“ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯æ—¶ï¼ŒRediså…ˆæŠŠæ¶ˆæ¯å†™åˆ°å¯¹åº”æ¶ˆè´¹è€…çš„ç¼“å†²åŒº,ä¹‹åæ¶ˆè´¹è€…ä¸æ–­ä»ç¼“å†²åŒºè¯»å–ã€å¤„ç†æ¶ˆæ¯, ç¼“å†²åŒºä¸Šçº¿,ä¼šè¢«å¼ºåˆ¶ä¸‹çº¿.<br></code></pre></td></tr></table></figure></li>
<li><p>Stream</p>
<figure class="highlight pf"><table><tr><td class="code"><pre><code class="hljs pf"><span class="hljs-comment"># Stream é€šè¿‡XADD å’Œ XREADå®Œæˆç®€å•çš„ç”Ÿäº§ã€æ¶ˆè´¹æ¨¡å‹</span><br>  XADD: å‘å¸ƒæ¶ˆæ¯<br>  XREAD: è¯»å–æ¶ˆæ¯<br><br><span class="hljs-comment"># ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯</span><br><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">6001</span>&gt; XADD <span class="hljs-keyword">queue</span> * name <span class="hljs-number">2021</span>      <span class="hljs-comment"># * è¡¨ç¤ºè‡ªåŠ¨ç”Ÿæˆå”¯ä¸€æ¶ˆæ¯ID</span><br>-&gt; Redirected <span class="hljs-keyword">to</span> slot [<span class="hljs-number">13011</span>] located at <span class="hljs-number">172.30</span>.<span class="hljs-number">1.23</span>:<span class="hljs-number">6003</span><br><span class="hljs-string">&quot;1630886765690-0&quot;</span>                           <span class="hljs-comment">#æ¶ˆæ¯IDæ ¼å¼: æ—¶é—´æˆ³-è‡ªå¢åºå·</span><br><span class="hljs-number">172.30</span>.<span class="hljs-number">1.23</span>:<span class="hljs-number">6003</span>&gt; XADD <span class="hljs-keyword">queue</span> * name <span class="hljs-number">09</span>-<span class="hljs-number">06</span><br><span class="hljs-string">&quot;1630886777470-0&quot;</span><br><span class="hljs-number">172.30</span>.<span class="hljs-number">1.23</span>:<span class="hljs-number">6003</span>&gt;<br><br><span class="hljs-comment"># æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯</span><br><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">6001</span>&gt; XREAD COUNT <span class="hljs-number">5</span> STREAMS <span class="hljs-keyword">queue</span> <span class="hljs-number">0</span>-<span class="hljs-number">0</span>   <span class="hljs-comment"># ä»å¼€å¤´è¯»å–5æ¡æ¶ˆæ¯ï¼Œ0-0è¡¨ç¤ºä»å¼€å¤´è¯»å–</span><br>-&gt; Redirected <span class="hljs-keyword">to</span> slot [<span class="hljs-number">13011</span>] located at <span class="hljs-number">172.30</span>.<span class="hljs-number">1.23</span>:<span class="hljs-number">6003</span><br><span class="hljs-number">1</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;queue&quot;</span><br>   <span class="hljs-number">2</span>) <span class="hljs-number">1</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;1630886765690-0&quot;</span><br>         <span class="hljs-number">2</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;name&quot;</span><br>            <span class="hljs-number">2</span>) <span class="hljs-string">&quot;2021&quot;</span><br>      <span class="hljs-number">2</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;1630886777470-0&quot;</span><br>         <span class="hljs-number">2</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;name&quot;</span><br>            <span class="hljs-number">2</span>) <span class="hljs-string">&quot;09-06&quot;</span><br><span class="hljs-number">172.30</span>.<span class="hljs-number">1.23</span>:<span class="hljs-number">6003</span>&gt; XREAD COUNT <span class="hljs-number">5</span> STREAMS <span class="hljs-keyword">queue</span> <span class="hljs-number">1630886777470</span>-<span class="hljs-number">0</span>  <span class="hljs-comment"># ç»§ç»­æ‹‰å–æ¶ˆæ¯,ä¼ å…¥ä¸Šä¸€æ¡æ¶ˆæ¯çš„ID</span><br><span class="hljs-number">172.30</span>.<span class="hljs-number">1.23</span>:<span class="hljs-number">6003</span>&gt; XREAD COUNT <span class="hljs-number">5</span> BLOCK <span class="hljs-number">0</span> STREAMS <span class="hljs-keyword">queue</span> <span class="hljs-number">1630886777470</span>-<span class="hljs-number">0</span>  <span class="hljs-comment"># BLOCK é˜»å¡å¼æ‹‰å–æ¶ˆæ¯</span><br><br><span class="hljs-comment"># Stream æ”¯æŒå‘å¸ƒ/è®¢é˜…æ¨¡å¼</span><br>  - XGROUP: åˆ›å»ºæ¶ˆè´¹è€…ç»„<br>  - XREADGROUP: åœ¨æŒ‡å®šæ¶ˆè´¹ç»„ä¸‹ï¼Œå¼€å¯æ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯<br><br>  <span class="hljs-number">172.30</span>.<span class="hljs-number">1.23</span>:<span class="hljs-number">6003</span>&gt; XGROUP CREATE <span class="hljs-keyword">queue</span> group1 <span class="hljs-number">0</span>-<span class="hljs-number">0</span>  <span class="hljs-comment"># åˆ›å»ºæ¶ˆè´¹è€…ç»„1ï¼Œ 0-0è¡¨ç¤ºä»å¤´æ‹‰å–æ¶ˆè´¹</span><br>  OK<br>  <span class="hljs-number">172.30</span>.<span class="hljs-number">1.23</span>:<span class="hljs-number">6003</span>&gt; XGROUP CREATE <span class="hljs-keyword">queue</span> group2 <span class="hljs-number">0</span>-<span class="hljs-number">0</span>  <span class="hljs-comment"># åˆ›å»ºæ¶ˆè´¹è€…ç»„2ï¼Œ0-0</span><br>  OK<br><br>  <span class="hljs-number">172.30</span>.<span class="hljs-number">1.23</span>:<span class="hljs-number">6003</span>&gt; XREADGROUP GROUP group1 consumer COUNT <span class="hljs-number">5</span> STREAMS <span class="hljs-keyword">queue</span> &gt;  <span class="hljs-comment"># group1 çš„consumerå¼€å§‹æ¶ˆè´¹ï¼Œ&gt;è¡¨ç¤ºæ‹‰å–æœ€æ–°æ•°æ®</span><br><span class="hljs-number">1</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;queue&quot;</span><br>   <span class="hljs-number">2</span>) <span class="hljs-number">1</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;1630886765690-0&quot;</span><br>         <span class="hljs-number">2</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;name&quot;</span><br>            <span class="hljs-number">2</span>) <span class="hljs-string">&quot;2021&quot;</span><br>      <span class="hljs-number">2</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;1630886777470-0&quot;</span><br>         <span class="hljs-number">2</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;name&quot;</span><br>            <span class="hljs-number">2</span>) <span class="hljs-string">&quot;09-06&quot;</span><br>      <span class="hljs-number">3</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;1630887243865-0&quot;</span><br>         <span class="hljs-number">2</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;name&quot;</span><br>            <span class="hljs-number">2</span>) <span class="hljs-string">&quot;08-14&quot;</span><br>  <span class="hljs-number">172.30</span>.<span class="hljs-number">1.23</span>:<span class="hljs-number">6003</span>&gt; XREADGROUP GROUP group2 consumer COUNT <span class="hljs-number">5</span> STREAMS <span class="hljs-keyword">queue</span> &gt;<br><span class="hljs-number">1</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;queue&quot;</span><br>   <span class="hljs-number">2</span>) <span class="hljs-number">1</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;1630886765690-0&quot;</span><br>         <span class="hljs-number">2</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;name&quot;</span><br>            <span class="hljs-number">2</span>) <span class="hljs-string">&quot;2021&quot;</span><br>      <span class="hljs-number">2</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;1630886777470-0&quot;</span><br>         <span class="hljs-number">2</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;name&quot;</span><br>            <span class="hljs-number">2</span>) <span class="hljs-string">&quot;09-06&quot;</span><br>      <span class="hljs-number">3</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;1630887243865-0&quot;</span><br>         <span class="hljs-number">2</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;name&quot;</span><br>            <span class="hljs-number">2</span>) <span class="hljs-string">&quot;08-14&quot;</span><br>  <span class="hljs-number">172.30</span>.<span class="hljs-number">1.23</span>:<span class="hljs-number">6003</span>&gt; XACK <span class="hljs-keyword">queue</span> group1 <span class="hljs-number">1630887243865</span>-<span class="hljs-number">0</span>  <span class="hljs-comment"># XACK å‘½ä»¤å‘ŠçŸ¥Redisæ¶ˆè´¹è€…å¤„ç†å®Œ</span><br>  (integer) <span class="hljs-number">1</span><br><br><span class="hljs-comment"># Stream æ•°æ®ä¼šå†™å…¥RDBå’ŒAOFåšæŒä¹…åŒ–A</span><br><span class="hljs-comment"># æ¶ˆæ¯å †ç§¯ï¼ŒStreamä¼šåªä¿ç•™å›ºå®šé•¿åº¦çš„æ–°æ¶ˆæ¯,å½“é˜Ÿåˆ—é•¿åº¦è¶…è¿‡ä¸Šé™ï¼Œå°±æ¶ˆæ¯ä¼šè¢«åˆ é™¤ï¼Œåªä¿ç•™å›ºå®šé•¿åº¦çš„æ–°æ¶ˆæ¯</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Redisé¢è¯•"><a href="#Redisé¢è¯•" class="headerlink" title="Redisé¢è¯•"></a>Redisé¢è¯•</h2><ul>
<li>å‡»ç©¿ã€ç©¿é€ã€é›ªå´©?<ul>
<li>å‡»ç©¿<figure class="highlight gauss"><table><tr><td class="code"><pre><code class="hljs gauss"><span class="hljs-meta"># å‡»ç©¿å‘ç”Ÿçš„åŸå› ?</span><br>  - <span class="hljs-built_in">Key</span>è¿‡æœŸ<br>    &gt; <span class="hljs-built_in">Key</span>æœ‰è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœæŸä¸€ä¸ªæ—¶åˆ»<span class="hljs-built_in">Key</span>å¤±æ•ˆï¼Œé‚£ä¹ˆä¹‹åçš„æŸ¥è¯¢è¯·æ±‚å°†å…¨éƒ¨å‹å€’æ•°æ®åº“ä¸Šï¼Œå¯¼è‡´æ•°æ®åº“å´©æºƒ.<br>  - <span class="hljs-built_in">Key</span>è¢«é¡µé¢ç½®æ¢æ·˜æ±°<br>    &gt; å†…å­˜æœ‰é™ï¼Œè¦æ—¶åˆ»ç¼“å­˜æ–°çš„æ•°æ®ï¼Œæ·˜æ±°æ—§çš„æ•°æ®<br><br><span class="hljs-meta"># åº”å¯¹å‡»ç©¿çš„å¤„ç†æ€è·¯?</span><br>  &gt; ç”±äº<span class="hljs-built_in">Key</span>è¿‡æœŸåœ¨æ‰€éš¾å…ï¼Œå¤§æµé‡æ¥åˆ°Redisæ—¶ï¼Œæ ¹æ®Redisçš„å•çº¿ç¨‹ç‰¹æ€§ï¼Œå¯ä»¥è®¤ä¸ºä»»åŠ¡æ˜¯åœ¨é˜Ÿåˆ—é‡Œä¸€æ¬¡æ‰§è¡Œï¼Œå½“è¯·æ±‚åˆ°è¾¾rediså‘ç°<span class="hljs-built_in">key</span>è¿‡æœŸï¼Œè¿›è¡Œä¸€ä¸ªæ“ä½œ: è®¾ç½®é”<br>    <span class="hljs-number">1.</span>è¯·æ±‚åˆ°è¾¾Redisï¼Œå‘ç°Redis <span class="hljs-built_in">Key</span>è¿‡æœŸï¼ŒæŸ¥çœ‹æœ‰æ²¡æœ‰é”ï¼Œæ²¡æœ‰é”çš„è¯å›åˆ°é˜Ÿåˆ—åé¢æ’é˜Ÿ<br>    <span class="hljs-number">2.</span>è®¾ç½®é”ï¼Œæ³¨æ„ï¼Œè¿™å„¿åº”è¯¥æ˜¯<span class="hljs-built_in">setnx</span>(),è€Œä¸æ˜¯<span class="hljs-built_in">set</span>(),å› ä¸ºå¯èƒ½æœ‰å…¶ä»–å¿åŸå·²ç»è®¾ç½®é”äº†<br>    <span class="hljs-number">3.</span>è·å–é”ï¼Œæ‹¿åˆ°å°±å»æ•°æ®åº“å–æ•°æ®ï¼Œè¯·æ±‚è¿”å›åé‡Šæ”¾é”<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<ul>
<li><p>ç©¿é€</p>
<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">ç©¿é€ä¸»è¦åŸå› æ˜¯å¾ˆå¤šè¯·æ±‚éƒ½åœ¨è®¿é—®æ•°æ®åº“ä¸å­˜åœ¨çš„æ•°æ®ï¼Œåº”å¯¹è¿™ç§è¯·æ±‚çš„å¤„ç†åŠæ³•å¯¹è®¿é—®è¯·æ±‚åŠ ä¸€å±‚è¿‡æ»¤å™¨(å¸ƒéš†è¿‡æ»¤å™¨ã€å¢å¼ºç‰ˆå¸ƒéš†è¿‡æ»¤å™¨ã€å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨)</span><br></code></pre></td></tr></table></figure></li>
<li><p>é›ªå´©</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><code class="hljs gauss">&gt; é›ªå´©å’Œå‡»ç©¿ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å‡»ç©¿æ˜¯ä¸€ä¸ªçƒ­ç‚¹<span class="hljs-built_in">Key</span>æŸæ—¶åˆ»å¤±æ•ˆï¼Œè€Œé›ªå´©æ˜¯å¤§é‡çš„çƒ­ç‚¹<span class="hljs-built_in">Key</span>åœ¨ä¸€ç¬é—´å¤±æ•ˆ<br><br><span class="hljs-meta"># å¤„ç†æ€è·¯?</span><br>  <span class="hljs-number">1.</span> æŸ¥çœ‹<span class="hljs-built_in">Key</span>è¿‡æœŸæ˜¯ä¸æ˜¯æ—¶ç‚¹æ€§æœ‰å…³ï¼Œæ—¶ç‚¹æ€§æ— å…³çš„è¯ï¼Œå¯ä»¥éšæœºè¿‡æœŸæ—¶é—´è§£å†³<br>  <span class="hljs-number">2.</span> å¦‚æœæ˜¯æ—¶ç‚¹æ€§æœ‰å…³ï¼Œåˆ©ç”¨å¼ºä¾èµ–å‡»ç©¿æ–¹æ¡ˆï¼Œå•é£ç­–ç•¥(å…ˆè¿‡å»çš„çº¿ç¨‹æ›´æ–°ä¸€ä¸‹æ‰€æœ‰<span class="hljs-built_in">Key</span>,åœ¨åå°æ›´æ–°çƒ­ç‚¹<span class="hljs-built_in">Key</span>çš„åŒæ—¶ï¼Œä¸šåŠ¡å±‚å°†è¿›æ¥çš„è¯·æ±‚å»¶æ—¶ä¸€ä¸‹)<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3>]]></content>
      <categories>
        <category>Middleware</category>
      </categories>
  </entry>
  <entry>
    <title>echo-go-web-framework</title>
    <url>/2021/09/02/echo-go-web-framework/</url>
    <content><![CDATA[<h1 id="Echo"><a href="#Echo" class="headerlink" title="Echo"></a>Echo</h1><blockquote>
<p>é«˜æ€§èƒ½ã€å¯æ‰©å±•ã€ç²¾ç®€çš„Go Webæ¡†æ¶</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown">âœ go run main.go<br><br>   <span class="hljs-strong">____</span>    <span class="hljs-strong">__</span><br><span class="hljs-strong">  / __</span>/<span class="hljs-strong">__<span class="hljs-emphasis">_/ /  <span class="hljs-strong">__<span class="hljs-emphasis">_</span></span></span></span><br><span class="hljs-emphasis"><span class="hljs-strong"><span class="hljs-emphasis"><span class="hljs-strong"> / _</span>// __</span>/ _</span> \/ <span class="hljs-emphasis">_ \</span></span><br><span class="hljs-emphasis"><span class="hljs-strong">/<span class="hljs-strong">__<span class="hljs-emphasis">_/\<span class="hljs-strong">__/<span class="hljs-emphasis">_//_</span>/\__</span>_</span>/ v4.5.0</span></span></span><br><span class="hljs-strong"><span class="hljs-emphasis"><span class="hljs-strong">High performance, minimalist Go web framework</span></span></span><br><span class="hljs-strong"><span class="hljs-emphasis"><span class="hljs-strong">https://echo.labstack.com</span></span></span><br><span class="hljs-strong"><span class="hljs-emphasis"><span class="hljs-strong">__</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">__O/__</span><span class="hljs-strong">____</span>_</span></span><br><span class="hljs-strong">                                    O\</span><br><span class="hljs-strong">â‡¨ http server started on [::]:8080</span><br></code></pre></td></tr></table></figure>

<span id="more"></span>

<h2 id="åŠŸèƒ½æ¦‚è¿°"><a href="#åŠŸèƒ½æ¦‚è¿°" class="headerlink" title="åŠŸèƒ½æ¦‚è¿°"></a>åŠŸèƒ½æ¦‚è¿°</h2><ul>
<li>Optimized HTTP router which smartly prioritize routes</li>
<li>Build robust and scalable RESTful APIs</li>
<li>Group APIs</li>
<li>Extensible middleware framework</li>
<li>Define middleware at root, group or route level</li>
<li>Data binding for JSON, XML and form payload</li>
<li>Handy functions to send variety of HTTP response</li>
<li>Centralized HTTP error handling</li>
<li>Template rendering with any template engine</li>
<li>Define your format for the logger</li>
<li>Highly customizable</li>
<li>Automatic TLS via Letâ€™s Encrypt</li>
<li>HTTP/2 support</li>
</ul>
]]></content>
      <categories>
        <category>Web Framework</category>
      </categories>
  </entry>
  <entry>
    <title>Dev-Ops Tips &amp; Tracks</title>
    <url>/2021/09/03/Dev-Ops-Tips-Tracks/</url>
    <content><![CDATA[<h1 id="DevOps-BOOTCAMP"><a href="#DevOps-BOOTCAMP" class="headerlink" title="DevOps BOOTCAMP"></a>DevOps BOOTCAMP</h1><span id="more"></span>

<h2 id="DevOps"><a href="#DevOps" class="headerlink" title="DevOps"></a>DevOps</h2><ul>
<li>Pipeline<figure class="highlight xl"><table><tr><td class="code"><pre><code class="hljs xl">C<span class="hljs-function"><span class="hljs-title">ollaborate</span> -&gt;</span> B<span class="hljs-function"><span class="hljs-title">uild</span> -&gt;</span> T<span class="hljs-function"><span class="hljs-title">est</span> -&gt;</span> D<span class="hljs-function"><span class="hljs-title">eploy</span> -&gt;</span> R<span class="hljs-function"><span class="hljs-title">un</span> -&gt;</span> C<span class="hljs-function"><span class="hljs-title">onfigure</span> -&gt;</span> Monitor<br></code></pre></td></tr></table></figure></li>
<li>Tradition: Development vs Operations<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># Development</span><br><span class="hljs-bullet">  -</span> programming languages<br><span class="hljs-bullet">  -</span> test frameworks<br><span class="hljs-bullet">  -</span> databases<br><span class="hljs-bullet">  -</span> version control<br><br><span class="hljs-section"># Operations</span><br><span class="hljs-bullet">  -</span> OS, mostly Linux<br><span class="hljs-bullet">  -</span> command-line<br><span class="hljs-bullet">  -</span> scripting<br><span class="hljs-bullet">  -</span> monitoring tools<br></code></pre></td></tr></table></figure></li>
<li>DevOps culture<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">1.</span> DevOps was just a way <span class="hljs-keyword">of</span> working <span class="hljs-keyword">between</span> DEV<span class="hljs-string">&#x27;s and OP&#x27;</span>s<br><span class="hljs-number">2.</span> Common <span class="hljs-keyword">language</span> <span class="hljs-keyword">to</span> communicate<br></code></pre></td></tr></table></figure></li>
<li>Waterfall vs. Agile<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># Waterfall: ç€‘å¸ƒå¼€å‘</span><br>  &gt; ineffective process<br>  &gt; over time new requirements may arise<br>  &gt; many places of failure and miscommunication<br><span class="hljs-bullet">  -</span> Requirements:<br><span class="hljs-bullet">    -</span> plan everything beforehend<br><span class="hljs-bullet">  -</span> Development:<br><span class="hljs-bullet">    -</span> developers code complete app<br><span class="hljs-bullet">  -</span> Testing:<br><span class="hljs-bullet">    -</span> testing after everything has developed<br><span class="hljs-bullet">  -</span> Operations:<br><span class="hljs-bullet">    -</span> huge preparation<br><br><span class="hljs-section"># Agile: æ•æ·å¼€å‘</span><br>  &gt; speed of development, testing and development cycles<br>  &gt; each feature gets tested, deployed<br>  &gt; immediate feedback<br>  &gt; fast development and deployment process<br><span class="hljs-bullet">  -</span> Continuous Integration:<br><span class="hljs-bullet">  -</span> Continuous Delivery:<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Operating-Systems"><a href="#Operating-Systems" class="headerlink" title="Operating Systems"></a>Operating Systems</h2><ul>
<li>OS &amp; Linux<figure class="highlight haml"><table><tr><td class="code"><pre><code class="hljs haml"># Intro Operating Systems<br>  -<span class="ruby"> Hardware of <span class="hljs-symbol">Computer:</span></span><br><span class="ruby"></span>    &gt; CPU + Memory + Storage + I/O devices<br>  -<span class="ruby"> Operating <span class="hljs-symbol">System:</span></span><br><span class="ruby"></span>    -<span class="ruby"> Translator</span><br><span class="ruby"></span>    -<span class="ruby"> Manages Resources</span><br><span class="ruby"></span>      -<span class="ruby"> CPU <span class="hljs-symbol">Management:</span></span><br><span class="ruby"></span>      -<span class="ruby"> Memory Management (RAM = Rapid Access Memory)</span><br><span class="ruby"></span>        -<span class="ruby"> Memory Swape (Swap-out/Swap-<span class="hljs-keyword">in</span>)</span><br><span class="ruby"></span>      -<span class="ruby"> Storage <span class="hljs-symbol">Management:</span></span><br><span class="ruby"></span>        -<span class="ruby"> Manage File <span class="hljs-symbol">System:</span></span><br><span class="ruby"></span>          -<span class="ruby"> stored <span class="hljs-keyword">in</span> a structured way</span><br><span class="ruby"></span>          -<span class="ruby"> <span class="hljs-keyword">in</span> Unix <span class="hljs-symbol">systems:</span> tree file system</span><br><span class="ruby"></span>          -<span class="ruby"> <span class="hljs-keyword">in</span> Windows <span class="hljs-symbol">OS:</span> multiple root folders (Called drives, uses backslashes <span class="hljs-keyword">for</span> paths)</span><br><span class="ruby"></span>      -<span class="ruby"> Management I/O Devices</span><br><span class="ruby"></span>      -<span class="ruby"> Security &amp; Networking</span><br><span class="ruby"></span>        -<span class="ruby"> <span class="hljs-symbol">Security:</span></span><br><span class="ruby"></span>          -<span class="ruby"> managing users <span class="hljs-keyword">and</span> permissions</span><br><span class="ruby"></span>        -<span class="ruby"> <span class="hljs-symbol">Networking:</span></span><br><span class="ruby"></span>    -<span class="ruby"> Isolates(éš”ç¦») content of application</span><br><span class="ruby"></span>  -<span class="ruby"> Operating system <span class="hljs-symbol">Components:</span></span><br><span class="ruby"></span>    -<span class="ruby"> <span class="hljs-symbol">kernel:</span></span><br><span class="ruby"></span>      -<span class="ruby"> kernel is a program</span><br><span class="ruby"></span>      -<span class="ruby"> Consists of device drivers, dispatcher, scheduler, File System etc.</span><br><span class="ruby"></span>  -<span class="ruby"> <span class="hljs-symbol">POSIX:</span> Portable Operating System Interface</span><br><span class="ruby"></span>  -<span class="ruby"> Linux <span class="hljs-keyword">and</span> MacOS both POSIX compliant</span><br></code></pre></td></tr></table></figure></li>
<li>Windows &amp; Linux CLI</li>
</ul>
<table>
<thead>
<tr>
<th align="left">Windows</th>
<th align="left">Linux</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">dir</td>
<td align="left">ls -l</td>
<td align="left">Directory Listing</td>
</tr>
<tr>
<td align="left">ren</td>
<td align="left">mv</td>
<td align="left">rename a files</td>
</tr>
<tr>
<td align="left">copy</td>
<td align="left">cp</td>
<td align="left">Copying a file</td>
</tr>
<tr>
<td align="left">move</td>
<td align="left">mv</td>
<td align="left">Moving a file</td>
</tr>
<tr>
<td align="left">cls</td>
<td align="left">clear</td>
<td align="left">Clear Screen</td>
</tr>
<tr>
<td align="left">del</td>
<td align="left">rm</td>
<td align="left">Delete file</td>
</tr>
<tr>
<td align="left">chdir</td>
<td align="left">pwd</td>
<td align="left">returns your current directory location</td>
</tr>
<tr>
<td align="left">time</td>
<td align="left">date</td>
<td align="left">displays the time</td>
</tr>
<tr>
<td align="left">cd</td>
<td align="left">cd</td>
<td align="left">Change the current directory</td>
</tr>
<tr>
<td align="left">md</td>
<td align="left">mkdir</td>
<td align="left">To create a new directory/folder</td>
</tr>
<tr>
<td align="left">echo</td>
<td align="left">echo</td>
<td align="left">To print something on the screen</td>
</tr>
</tbody></table>
<ul>
<li><p>Virtualizationè™šæ‹ŸåŒ–</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># VirtualBox:</span><br>  &gt; VirtualBox takes<span class="hljs-built_in"> hardware </span>resources <span class="hljs-keyword">from</span> Host OS.<br>  &gt; Creates virtual CPU, virtual RAM, virtual storage <span class="hljs-keyword">for</span> each virtual machine.<br>  &gt;<span class="hljs-built_in"> Hardware </span>resources are shared<br><br><span class="hljs-comment"># Bare Metal(for server): Hardware -&gt; Hypervisor -&gt; Guest OS</span><br>  - wmware ESXi<br>  - Microsoft Hyper-v<br><br>  - Efficient usage of<span class="hljs-built_in"> hardware </span>resources<br>    - use all the resources of performant big<span class="hljs-built_in"> server</span><br><span class="hljs-built_in"></span>    -<span class="hljs-built_in"> Users </span>can choose any resources combinations<br>  - Abstraction of the Operating<span class="hljs-built_in"> System </span><span class="hljs-keyword">from</span> the<span class="hljs-built_in"> hardware</span><br><span class="hljs-built_in"></span>    - Secure very easily<br>    - Portable<br>    - <span class="hljs-keyword">Not</span> dependent on physical<span class="hljs-built_in"> server</span><br><span class="hljs-built_in"></span><span class="hljs-comment"># Sharing things is not good for isolation</span><br></code></pre></td></tr></table></figure></li>
<li><p>Linux File System</p>
<figure class="highlight tcl"><table><tr><td class="code"><pre><code class="hljs tcl">&gt; Everything in Linux is a File<br><span class="hljs-comment"># Linux File System</span><br>  - hierarchical tree structure<br>  - <span class="hljs-number">1</span> root folder<br>  - multiple users on computer<br>  - each user has its own space<br>  - each user can have own configurations<br>  - programs installed system wide, are avaiable <span class="hljs-keyword">for</span> all users<br><br>  âœ tree / -L <span class="hljs-number">1</span><br>  /<br>  â”œâ”€â”€ bin -&gt; usr/bin      -- executables <span class="hljs-keyword">for</span> most essential user commands<br>  â”œâ”€â”€ boot                -- contains files required <span class="hljs-keyword">for</span> booting (Read Only Folders)<br>  â”œâ”€â”€ core<br>  â”œâ”€â”€ dev                 -- location of device files, like webcam, keyboard, hard drive etc.<br>  â”œâ”€â”€ etc                 -- place where configuration <span class="hljs-keyword">for</span> system-wide applications is stored<br>  â”œâ”€â”€ home<br>  â”œâ”€â”€ k8s_data<br>  â”œâ”€â”€ lib -&gt; usr/lib      -- Essential shared libraries that executables from /bin or /sbin use<br>  â”œâ”€â”€ lost+found<br>  â”œâ”€â”€ media               -- contains subdirectories, where removable media devices inserted into the computer are mounted.<br>  â”œâ”€â”€ mnt                 -- historically, sys admins mounted temporary <span class="hljs-keyword">file</span> systems there<br>  â”œâ”€â”€ opt                 -- third-party program you install<br>  â”œâ”€â”€ <span class="hljs-keyword">proc</span><br>  â”œâ”€â”€<span class="hljs-title"> root</span><br>  â”œâ”€â”€<span class="hljs-title"> run</span><br>  â”œâ”€â”€<span class="hljs-title"> sbin</span> -&gt;<span class="hljs-title"> usr/sbin</span>    --<span class="hljs-title"> system</span> binaries:<span class="hljs-title"> essential</span> system<span class="hljs-title"> binaries</span> programs<span class="hljs-title"> that</span> admin<span class="hljs-title"> would</span> use (need<span class="hljs-title"> superuser</span> privilige)<br>  â”œâ”€â”€<span class="hljs-title"> snap</span><br>  â”œâ”€â”€<span class="hljs-title"> srv</span><br>  â”œâ”€â”€<span class="hljs-title"> sys</span><br>  â”œâ”€â”€<span class="hljs-title"> tmp</span>                 --<span class="hljs-title"> temporary</span> resources<span class="hljs-title"> required</span> for<span class="hljs-title"> some</span> process,<span class="hljs-title"> kept</span> here<span class="hljs-title"> temporarily</span><br>  â”œâ”€â”€<span class="hljs-title"> usr</span>                 --<span class="hljs-title"> this</span> was<span class="hljs-title"> used</span> for<span class="hljs-title"> user</span> home<span class="hljs-title"> directories</span><br>    â”œâ”€â”€<span class="hljs-title"> bin</span><br>    â”œâ”€â”€<span class="hljs-title"> config</span><br>    â”œâ”€â”€<span class="hljs-title"> games</span><br>    â”œâ”€â”€<span class="hljs-title"> include</span><br>    â”œâ”€â”€<span class="hljs-title"> lib</span><br>    â”œâ”€â”€<span class="hljs-title"> libexec</span><br>    â”œâ”€â”€<span class="hljs-title"> local</span>             --<span class="hljs-title"> Programs</span> that<span class="hljs-title"> you</span> install<span class="hljs-title"> on</span> the<span class="hljs-title"> computer;</span> will<span class="hljs-title"> be</span> avaiable<span class="hljs-title"> for</span> all<span class="hljs-title"> users</span> on<span class="hljs-title"> the</span> computer<br>    â”œâ”€â”€<span class="hljs-title"> sbin</span><br>    â”œâ”€â”€<span class="hljs-title"> share</span><br>    â””â”€â”€<span class="hljs-title"> src</span><br>  â””â”€â”€<span class="hljs-title"> var</span>                 --<span class="hljs-title"> contains</span> files<span class="hljs-title"> to</span> which<span class="hljs-title"> the</span> system<span class="hljs-title"> writes</span> data<br>    â”œâ”€â”€<span class="hljs-title"> backups</span><br>    â”œâ”€â”€<span class="hljs-title"> cache</span>             --<span class="hljs-title"> contains</span> cached<span class="hljs-title"> data</span> from<span class="hljs-title"> application</span> programs<br>    â”œâ”€â”€<span class="hljs-title"> crash</span><br>    â”œâ”€â”€<span class="hljs-title"> lib</span><br>    â”œâ”€â”€<span class="hljs-title"> local</span><br>    â”œâ”€â”€<span class="hljs-title"> lock</span> -&gt; /run/lock<br>    â”œâ”€â”€<span class="hljs-title"> log</span>               --<span class="hljs-title"> contains</span> log<span class="hljs-title"> files</span><br>    â”œâ”€â”€<span class="hljs-title"> mail</span><br>    â”œâ”€â”€<span class="hljs-title"> opt</span><br>    â”œâ”€â”€<span class="hljs-title"> run</span> -&gt; /run<br>    â”œâ”€â”€<span class="hljs-title"> snap</span><br>    â”œâ”€â”€<span class="hljs-title"> spool</span><br>    â”œâ”€â”€<span class="hljs-title"> tmp</span><br>    â””â”€â”€<span class="hljs-title"> www</span><br>  21<span class="hljs-title"> directories,</span> 1<span class="hljs-title"> file</span><br><br>  - /usr/local<span class="hljs-title"> vs.</span> /opt<br>    - /usr/local:<br>      -<span class="hljs-title"> programs,</span> which<span class="hljs-title"> split</span> its<span class="hljs-title"> components</span><br>    - /opt:<br>      -<span class="hljs-title"> programs,</span> which<span class="hljs-title"> NOT</span> split<span class="hljs-title"> its</span> components<br><br>#<span class="hljs-title"> Hidden</span> Files<br>  -<span class="hljs-title"> ls</span> primarily<span class="hljs-title"> used</span> to<span class="hljs-title"> help</span> prevent<span class="hljs-title"> important</span> data<span class="hljs-title"> from</span> being<span class="hljs-title"> accientally</span> deleted<br>  -<span class="hljs-title"> Automatically</span> generated<span class="hljs-title"> by</span> programs<span class="hljs-title"> or</span> operating<span class="hljs-title"> system</span><br>  -<span class="hljs-title"> File</span> name<span class="hljs-title"> starts</span> with<span class="hljs-title"> a</span> dot<br>  -<span class="hljs-title"> In</span> UNIX<span class="hljs-title"> also</span> called &quot;dotfiles&quot;<br><br>#<span class="hljs-title"> Windows</span> File<span class="hljs-title"> System</span><br>  -<span class="hljs-title"> multiple</span> root<span class="hljs-title"> folders</span><br>  -<span class="hljs-title"> A,B:</span> Removable<span class="hljs-title"> Disks</span><br>  -<span class="hljs-title"> C:</span> Local<span class="hljs-title"> Disk</span> -<span class="hljs-title"> Internal</span> hard<span class="hljs-title"> drive</span><br></code></pre></td></tr></table></figure></li>
<li><p>Basic Linux Command</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-comment"># GUI vs. CLI</span><br>  - GUI = A graphical user interface<br>  - CLI = Command Line Interface<br><br>ubuntu <span class="hljs-keyword">in</span> ~ <span class="hljs-keyword">at</span> k8s-node1 via ğŸ¹ v1<span class="hljs-number">.16</span><span class="hljs-number">.5</span> via ğŸ <span class="hljs-number">3.8</span><span class="hljs-number">.6</span><br>âœ<br>  - ubuntu: user name<br>  - k8s-node1: computer name<br>  - ~: home <span class="hljs-built_in">directory</span><br>  - $: represents regular user<br>  - <span class="hljs-comment">#: sign for root user</span><br><br><span class="hljs-comment"># Folder Operations</span><br>  - pwd: Show current <span class="hljs-built_in">directory</span><br>  - ls: List <span class="hljs-built_in">folders</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">files</span><br>    - ls -<span class="hljs-keyword">a</span> = Show all (including hidden)<br>  - cd: Change <span class="hljs-built_in">directory</span> <span class="hljs-built_in">to</span> [dir]<br>  - mkdir: Make <span class="hljs-built_in">directory</span> [dirname]<br><br><span class="hljs-comment"># File Operations</span><br>  - touch [filename]: Create [filename]<br>  - rm [filename]: Delete [filename]<br>    - rm -r [dirname]: Delete <span class="hljs-keyword">a</span> non-<span class="hljs-literal">empty</span> <span class="hljs-built_in">directory</span> <span class="hljs-keyword">and</span> all <span class="hljs-keyword">the</span> <span class="hljs-built_in">files</span> <span class="hljs-keyword">within</span> <span class="hljs-keyword">it</span>.<br>    - rm -d [dirname] <span class="hljs-keyword">or</span> rmdir [dirname]: Delete <span class="hljs-keyword">an</span> <span class="hljs-literal">empty</span> <span class="hljs-built_in">directory</span><br>  - mv [filename] [new_filename] = Rename <span class="hljs-keyword">the</span> <span class="hljs-built_in">file</span> <span class="hljs-built_in">to</span> <span class="hljs-keyword">a</span> <span class="hljs-built_in">new</span> filename<br>  - cp -r [dirname] [new_dirname] = Copy dirname <span class="hljs-built_in">to</span> new_dirname<br><br><span class="hljs-comment"># Display OS Information</span><br>  - uname -<span class="hljs-keyword">a</span>: Show <span class="hljs-keyword">system</span> <span class="hljs-keyword">and</span> kernel<br>  Linux k8s-node1 <span class="hljs-number">5.4</span><span class="hljs-number">.0</span><span class="hljs-number">-1043</span>-raspi <span class="hljs-comment">#47-Ubuntu SMP PREEMPT Mon Aug 23 09:41:31 UTC 2021 aarch64 aarch64 aarch64 GNU/Linux</span><br><br>  âœ cat /etc/os-release<br>  NAME=<span class="hljs-string">&quot;Ubuntu&quot;</span><br>  VERSION=<span class="hljs-string">&quot;20.04.3 LTS (Focal Fossa)&quot;</span><br>  ID=ubuntu<br>  ID_LIKE=debian<br>  PRETTY_NAME=<span class="hljs-string">&quot;Ubuntu 20.04.3 LTS&quot;</span><br>  VERSION_ID=<span class="hljs-string">&quot;20.04&quot;</span><br>  HOME_URL=<span class="hljs-string">&quot;https://www.ubuntu.com/&quot;</span><br>  SUPPORT_URL=<span class="hljs-string">&quot;https://help.ubuntu.com/&quot;</span><br>  BUG_REPORT_URL=<span class="hljs-string">&quot;https://bugs.launchpad.net/ubuntu/&quot;</span><br>  PRIVACY_POLICY_URL=<span class="hljs-string">&quot;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy&quot;</span><br>  VERSION_CODENAME=focal<br>  UBUNTU_CODENAME=focal<br><br>  - lscpu:<br>  - lsmem:<br>  - sudo: Allows regular users <span class="hljs-built_in">to</span> run programs <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> security privileges <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> superusere <span class="hljs-keyword">or</span> root<br>  - su - chyi: <span class="hljs-keyword">switch</span> user<br><br><span class="hljs-comment"># Some More Useful Commands</span><br>  - <span class="hljs-built_in">clear</span>: Clears <span class="hljs-keyword">the</span> terminal<br>  - history: Gives <span class="hljs-keyword">a</span> list <span class="hljs-keyword">of</span> all past commands typed <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> current terminal session<br>  - Ctrl + r: Search history<br>  - Ctrl + c: Stop current <span class="hljs-keyword">command</span><br>  - cat [filename]: Display <span class="hljs-keyword">the</span> <span class="hljs-built_in">file</span> content<br></code></pre></td></tr></table></figure></li>
<li><p>Package Manager</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><code class="hljs ada">  <span class="hljs-number">1</span>. central plcae to install, upgrade,configure, remove software<br><br># APT - Advanced <span class="hljs-keyword">Package</span> <span class="hljs-title">Tool</span><br>  &gt; Dependencies are shared<br>  &gt; Only <span class="hljs-keyword">for</span> specific Linux distributions (<span class="hljs-keyword">package</span> <span class="hljs-title">type .deb)</span><br>  &gt; Manual Updates<br>  - apt search &lt;package_name&gt; = Search <span class="hljs-keyword">for</span> a given <span class="hljs-keyword">package</span><br>  <span class="hljs-title">- apt install &lt;package_name&gt; = Install a given <span class="hljs-keyword">package</span></span><br>  - apt remove &lt;package_name&gt; = Remove installed <span class="hljs-keyword">package</span><br>  <span class="hljs-title">- apt update = Updates the packages index</span><br><br># Repositories:<br>  &gt; storage location, containing thousands <span class="hljs-keyword">of</span> programs<br><br># Snap <span class="hljs-keyword">Package</span> <span class="hljs-title">Manager:</span><br>  &gt; A snap <span class="hljs-keyword">is</span> a bundle <span class="hljs-keyword">of</span> an app <span class="hljs-keyword">and</span> its dependencies<br>  &gt; Supports universal Linux packages (<span class="hljs-keyword">package</span> <span class="hljs-title">type .snap)</span><br>  &gt; Automatic Updates<br>  - Self-contained - dependencies contained <span class="hljs-keyword">in</span> the <span class="hljs-keyword">package</span><br><br><span class="hljs-title"># Add Repository to official l</span>ist <span class="hljs-keyword">of</span> repos (add-apt-repository)<br># PPA = Personal <span class="hljs-keyword">Package</span> <span class="hljs-title">Archive</span><br>  - PPAs are provided by the community<br><br># Debian Based:   <span class="hljs-comment">-- APT/APT-GET</span><br>  - Ubuntu<br>  - Debian<br>  - Mint<br># Red Had Based:  <span class="hljs-comment">-- Yum</span><br>  - RHEL<br>  - CentOS<br>  - Fedora<br></code></pre></td></tr></table></figure></li>
<li><p>Vim Editor</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><code class="hljs n1ql"># Vim Mode:<br>  - Command Mode:<br>    - Navigate, Search, <span class="hljs-keyword">Delete</span>, Undo etc.<br>    - Whatever you <span class="hljs-built_in">type</span> <span class="hljs-keyword">is</span> interpreted <span class="hljs-keyword">as</span> a command<br>  - <span class="hljs-keyword">Insert</span> Mode:<br>#<br>- Press i <span class="hljs-keyword">key</span> = Switch <span class="hljs-keyword">to</span> <span class="hljs-keyword">insert</span> Mode<br>- Press esc <span class="hljs-keyword">key</span> = Switch <span class="hljs-keyword">to</span> Command Mode<br>- <span class="hljs-built_in">Type</span> dd = <span class="hljs-keyword">Delete</span> entire line<br>- <span class="hljs-built_in">Type</span> d10 = <span class="hljs-keyword">Delete</span> next <span class="hljs-number">10</span> lines<br>- <span class="hljs-built_in">Type</span> u = Undo<br>- <span class="hljs-built_in">Type</span> $ = Jump <span class="hljs-keyword">to</span> <span class="hljs-keyword">end</span> of the line<br>- <span class="hljs-built_in">Type</span> <span class="hljs-number">0</span> = Jump <span class="hljs-keyword">to</span> <span class="hljs-keyword">start</span> of the line<br>- <span class="hljs-built_in">Type</span> /pattern = Search <span class="hljs-keyword">for</span> pattern<br>- <span class="hljs-built_in">Type</span> :%s/old/new = <span class="hljs-built_in">Replace</span> old <span class="hljs-keyword">with</span> new throughout the file<br></code></pre></td></tr></table></figure></li>
<li><p>Users &amp; Permissions</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><code class="hljs crmsh"><span class="hljs-comment"># User Accounts:</span><br>  - Superuser Account:<br>  - <span class="hljs-keyword">User</span> <span class="hljs-title">Account</span>:<br>  - Service Account:<br>    - Don&#x27;t run services with root user!<br><br>  - adduser <span class="hljs-tag">&lt;username&gt;</span> = Create a new <span class="hljs-keyword">user</span><br><br><span class="hljs-title"># Groups</span> &amp; Ownership<br>  - <span class="hljs-keyword">User</span> <span class="hljs-title">Level</span>:<br>  - <span class="hljs-keyword">Group</span> <span class="hljs-title">Level</span>:<br><br><span class="hljs-comment"># Access Control Files:</span><br>  - /etc/passwd:<br>    - Stores <span class="hljs-keyword">user</span> <span class="hljs-title">account</span> <span class="hljs-literal">inf</span>ormation<br>    - Everyone can <span class="hljs-keyword">read</span> it, but only root <span class="hljs-keyword">user</span> <span class="hljs-title">can</span> change the file<br><br>    âœ cat /etc/passwd | grep pi<br>    pi:x:<span class="hljs-number">1000</span>:<span class="hljs-number">1000</span>:,,,:/home/pi:/usr/bin/zsh<br>    USERNAME:PASSWORD:UID:GID:GECOS:HOMEDIR:SHELL<br>      - PASSWORD(x) means, that encrypted password is stored <span class="hljs-keyword">in</span> /etc/shadow file<br>      - <span class="hljs-keyword">User</span> <span class="hljs-title">ID</span>(UID): Each <span class="hljs-keyword">user</span> <span class="hljs-title">has</span> a unique ID. UID <span class="hljs-number">0</span> is reserved for root<br>  - /etc/shadow<br>  - /etc/<span class="hljs-keyword">group</span><br><br><span class="hljs-title"># File</span> Permissions<br><br><span class="hljs-comment"># Linux Commands for Managing Users and their permissions</span><br>  - passwd <span class="hljs-tag">&lt;username&gt;</span> = Change password of a <span class="hljs-keyword">user</span><br>  <span class="hljs-title">- su</span> - <span class="hljs-tag">&lt;username&gt;</span> = Login as username (su = switch user)<br>  - su - = Login as root<br>  - groupadd <span class="hljs-tag">&lt;groupname&gt;</span> = Create new <span class="hljs-keyword">group</span><br>  <span class="hljs-title">- usermod</span> [OPTIONS] <span class="hljs-tag">&lt;username&gt;</span> = Modify a <span class="hljs-keyword">user</span> <span class="hljs-title">account</span><br>  - useradd [OPTIONS] <span class="hljs-tag">&lt;username&gt;</span> = Create a new <span class="hljs-keyword">user</span><br>  <span class="hljs-title">- groups</span><br><br><span class="hljs-comment"># Different User &amp; Group Commands</span><br>  - adduser/addgroup/deluser/delgroup:<br>    - More <span class="hljs-keyword">User</span> <span class="hljs-title">Friendly</span><br>  - useradd/groupadd/userdel/groupdel:<br>    - Low-level utilties<br></code></pre></td></tr></table></figure></li>
<li><p>Shell Scripting</p>
</li>
<li><p>Environmemt Variables</p>
</li>
<li><p>Networking</p>
</li>
<li><p>SSH - Secure Shell</p>
</li>
</ul>
<h2 id="Version-Control"><a href="#Version-Control" class="headerlink" title="Version Control"></a>Version Control</h2><ul>
<li>GUI Git<ul>
<li>github</li>
<li>gitlab<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> Git global setup</span><br><span class="hljs-meta">  $</span><span class="bash"> git config --global user.name <span class="hljs-string">&quot;&quot;</span></span><br><span class="hljs-meta">  $</span><span class="bash"> git config --global user.email <span class="hljs-string">&quot;&quot;</span></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> Create a new repository</span><br><span class="hljs-meta">  $</span><span class="bash"> git <span class="hljs-built_in">clone</span> git@gitlab.com:</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> Push an existing folder</span><br><span class="hljs-meta">  $</span><span class="bash"> <span class="hljs-built_in">cd</span> existing_folder</span><br><span class="hljs-meta">  $</span><span class="bash"> git init</span><br><span class="hljs-meta">  $</span><span class="bash"> git remote add origin https://gitlab.com/chyiyaqing/my-project.git</span><br><span class="hljs-meta">  $</span><span class="bash"> git branch -M main</span><br><span class="hljs-meta">  $</span><span class="bash"> git push -uf origin main</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> ä½¿ç”¨SSH Key</span><br>  - GitHub/GitLab can authenticate us when pushing/pulling from repository<br>  - without providing username and password each time.<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li>Git<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># Git Stages</span><br><span class="hljs-bullet">  -</span> Working Directory (git add -&gt; Staging Area)<br><span class="hljs-bullet">  -</span> Staging Area (git commit -&gt; Local Repository)<br><span class="hljs-bullet">  -</span> Local Repository<br><br><span class="hljs-section"># Git Command Tools</span><br><span class="hljs-bullet">  -</span> git status : status of local git repo<br><span class="hljs-bullet">  -</span> git add:<br><span class="hljs-bullet">  -</span> git commit:<br><span class="hljs-bullet">  -</span> git log: history of local repository changes<br><span class="hljs-bullet">  -</span> git init:<br><span class="hljs-bullet">  -</span> git pull:<br><span class="hljs-bullet">  -</span> git checkout <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">branch</span> <span class="hljs-attr">name</span>&gt;</span></span> = switch branches<br><span class="hljs-bullet">  -</span> git checkout -b <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">branch</span> <span class="hljs-attr">name</span>&gt;</span></span> = creating and switching to new branch<br><span class="hljs-section"># Branch</span><br><span class="hljs-bullet">  -</span> Master branch = main branch is created by default, when initializing a git repo<br><span class="hljs-bullet">    -</span> best practice: 1 branch per bugfix or feature<br><span class="hljs-bullet">    -</span> big feature branches long open, increase the chanceee of merge conflicts<br><span class="hljs-bullet">    -</span> only master branch for continuous integration/delivery<br><span class="hljs-bullet">    -</span> pipeline is triggered whenever feature/bugfix code is merged into master<br><span class="hljs-bullet">    -</span> must be stable and ready for production<br><span class="hljs-bullet">  -</span> Develop Branch<br><span class="hljs-bullet">    -</span> dev branch: intermediary master<br><span class="hljs-bullet">  -</span> Avoiding Merge Commits (rebase)<br><span class="hljs-bullet">    -</span> git pull(git fetch + git merge) vs. git pull --rebase (no merge commit, much cleaner project history)<br><span class="hljs-bullet">  -</span> Resolving Merge Conflicts<br><span class="hljs-bullet">  -</span> Don&#x27;t track certain files (.gitignore file)<br><span class="hljs-bullet">    -</span> .gitignore: to exclude certain folders or files from git to be tracked<br><span class="hljs-bullet">    -</span> git rm -r --cached : Stop tracking a file<br><span class="hljs-bullet">  -</span> Save work-in-progress changes (stash)<br><span class="hljs-bullet">    -</span> git stash (save un-committed (work-in-progress) changes, unfinished changes, which don&#x27;t want to commit yet)<br><span class="hljs-bullet">    -</span> git stash pop (get the changes back)<br><span class="hljs-bullet">  -</span> Going back in history<br><span class="hljs-bullet">    -</span> git checkout <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">commit</span> <span class="hljs-attr">hash</span>&gt;</span></span> (go back to a specific project version)<br><span class="hljs-bullet">    -</span> Each commit: (unique commit hash, commit message, author + date)<br><span class="hljs-bullet">  -</span> Undoing and changing commits<br><span class="hljs-bullet">    -</span> git reset --hard <span class="xml">&lt;HEAD~1&gt;</span> (removed old commit)<br><span class="hljs-bullet">    -</span> git reset --soft (keep the changes in your working directory)<br><span class="hljs-bullet">    -</span> git revert <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">commit</span> <span class="hljs-attr">hash</span>&gt;</span></span> (creates a new commit to revert the old commits changesj)<br><span class="hljs-bullet">    -</span> git commit --amend (changing the last commit)<br><span class="hljs-bullet">  -</span> Merging Branches<br><br><span class="hljs-section"># Merge Requests:</span><br><span class="hljs-bullet">  -</span> Best practice: Other developer reviews code changes before merging<br><span class="hljs-section"># Git åè¯è§£é‡Š</span><br><span class="hljs-bullet">  -</span> origin = your remote git project/repo<br><br><span class="hljs-section"># Git for DevOps</span><br><span class="hljs-bullet">  -</span> Infrastructure as Code<br><span class="hljs-bullet">    -</span> Many Kubernetes Configuration Files (Yaml) (Deployment to Kubernetes)<br><span class="hljs-bullet">    -</span> Terraform and Ansible Configuration Files<br><span class="hljs-bullet">    -</span> Bash and Python Python Scripts<br><span class="hljs-bullet">    -</span> tracked - history of changes<br><span class="hljs-bullet">    -</span> securely stored in one place<br><span class="hljs-bullet">  -</span> CI/CD Pipeline and Build Automation<br><span class="hljs-bullet">    -</span> checkout code, test and build application, etc.<br><span class="hljs-bullet">    -</span> need integration for the build automation tool with application git repository<br></code></pre></td></tr></table></figure></li>
<li>Databases<figure class="highlight haml"><table><tr><td class="code"><pre><code class="hljs haml">&gt; Database are used to persist data!<br>-<span class="ruby"> DB endpoint &amp; credentials should <span class="hljs-keyword">not</span> be hardcode</span><br><span class="ruby"></span><br># DevOps Engineer<br>  -<span class="ruby"> how to configure DB</span><br><span class="ruby"></span>  -<span class="ruby"> hot to setup DB</span><br><span class="ruby"></span>  -<span class="ruby"> how to manage DB</span><br><span class="ruby"></span><br># Database Types<br>  -<span class="ruby"> Key-Value Database</span><br><span class="ruby"></span>    -<span class="ruby"> Redis</span><br><span class="ruby"></span>    -<span class="ruby"> Memcached</span><br><span class="ruby"></span>    -<span class="ruby"> etcd from Kubernetes</span><br><span class="ruby"></span>    # Best for:<br>      -<span class="ruby"> Caching</span><br><span class="ruby"></span>      -<span class="ruby"> Message Queue</span><br><span class="ruby"></span>  -<span class="ruby"> Wide Column Database (schema-less, scalable, no joins)</span><br><span class="ruby"></span>    -<span class="ruby"> Cassandra</span><br><span class="ruby"></span>    -<span class="ruby"> HBase</span><br><span class="ruby"></span>    # Best for:<br>      -<span class="ruby"> TIME-Series</span><br><span class="ruby"></span>      -<span class="ruby"> Iot-Records</span><br><span class="ruby"></span>      -<span class="ruby"> Historical-records</span><br><span class="ruby"></span>  -<span class="ruby"> Document Databases (schema-less)</span><br><span class="ruby"></span>    -<span class="ruby"> MongoDB</span><br><span class="ruby"></span>    -<span class="ruby"> DynamoDB</span><br><span class="ruby"></span>    -<span class="ruby"> CouchDB</span><br><span class="ruby"></span>    # Best for:<br>      -<span class="ruby"> Mobile Apps</span><br><span class="ruby"></span>      -<span class="ruby"> Game Apps</span><br><span class="ruby"></span>      -<span class="ruby"> Cms</span><br><span class="ruby"></span>      -<span class="ruby"> Most Apps</span><br><span class="ruby"></span>  -<span class="ruby"> Relational Databases (schema, structured query language )</span><br><span class="ruby"></span>    -<span class="ruby"> MySQL</span><br><span class="ruby"></span>    -<span class="ruby"> Postgresql</span><br><span class="ruby"></span>    # Best for:<br>      -<span class="ruby"> ACID (Atomicity, Consistency, Isolation, Durability)</span><br><span class="ruby"></span>  -<span class="ruby"> Graph Database (Nodes <span class="hljs-keyword">and</span> Edges)</span><br><span class="ruby"></span>    -<span class="ruby"> Neo4j</span><br><span class="ruby"></span>    -<span class="ruby"> Dgraph</span><br><span class="ruby"></span>    # Best for:<br>      -<span class="ruby"> Graphs</span><br><span class="ruby"></span>      -<span class="ruby"> Patterns</span><br><span class="ruby"></span>  -<span class="ruby"> Search Database</span><br><span class="ruby"></span>    -<span class="ruby"> ElasticSearch</span><br><span class="ruby"></span>    -<span class="ruby"> Solr</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Build-Tools-amp-Package-Manager"><a href="#Build-Tools-amp-Package-Manager" class="headerlink" title="Build Tools &amp; Package Manager"></a>Build Tools &amp; Package Manager</h2><ul>
<li>artifact<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># Building the code:</span><br><span class="hljs-bullet">  -</span> compiling<br><span class="hljs-bullet">  -</span> Compress<br><br><span class="hljs-section"># Aritfact repositoy</span><br>  &gt; Keep artifact in storage<br>  &gt; to deploy it multiple times, have backup etc.<br><span class="hljs-bullet">  -</span> Nexus<br><span class="hljs-bullet">  -</span> JFrog<br><br><span class="hljs-section"># What kind of file is the artifact?</span><br><span class="hljs-bullet">  -</span> Java artifact (JAR or WAR file includes whole code plus dependencies)<br><br><span class="hljs-section"># Install Java and Build Tools</span><br><span class="hljs-bullet">  -</span> Install Java<br><span class="hljs-bullet">  -</span> Install Maven (mvn package)<br><span class="hljs-bullet">  -</span> Install Gradle (./gradlew build)<br><span class="hljs-bullet">  -</span> Install Node + npm<br><br><span class="hljs-section"># Build Aritifact</span><br><span class="hljs-bullet">  -</span> 1. Using a Build Tool (Install dependencies; Compile and compress your code)<br><span class="hljs-code">    Java: (JAR or WAR file)</span><br><span class="hljs-code">      - Maven (Using XML)</span><br><span class="hljs-code">        - mvn install</span><br><span class="hljs-code">        - mvn package (target/xxx-.jar)</span><br><span class="hljs-code">      - Gradle (Using Groovy)</span><br><span class="hljs-code">        - ./gradlew build (build/libs/xxx.jar)</span><br><span class="hljs-code">        - Note: Gradle-Java Version Compatibility (Change Java version less than 16)</span><br><span class="hljs-code"></span><br><span class="hljs-section"># Managing Dependencies</span><br>  &gt; Dependencies file = managing the dependencies for a project<br><span class="hljs-bullet">  -</span> maven (pom.xml)<br><span class="hljs-bullet">  -</span> gradle (build.gradle)<br><br><span class="hljs-bullet">  -</span> Local Dependency Repository(~/.m2/repository)<br><br><span class="hljs-section"># Run the application</span><br><span class="hljs-bullet">  -</span> JAR (java -jar <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">name</span> <span class="hljs-attr">of</span> <span class="hljs-attr">jar</span> <span class="hljs-attr">file</span>&gt;</span></span>)<br><br><span class="hljs-section"># Build JS Applications</span><br><span class="hljs-bullet">  -</span> no special artifact type (ZIP/TAR file)<br><span class="hljs-bullet">  -</span> npm and yarn<br><span class="hljs-bullet">  -</span> package.json file for dependencies<br><span class="hljs-bullet">  -</span> package managers and NOT build tools<br><span class="hljs-bullet">  -</span> install dependencies, but not used for transpiling JS code<br><span class="hljs-bullet">  -</span> Command Lint Tool - npm<br><span class="hljs-bullet">    -</span> npm install = install dependencies<br><span class="hljs-bullet">    -</span> npm start - start the application<br><span class="hljs-bullet">    -</span> npm stop - stop the application<br><span class="hljs-bullet">    -</span> npm test - run the tests<br><span class="hljs-bullet">    -</span> npm publish - publish the artifact<br><span class="hljs-bullet">    -</span> [ ] npm pack - package<br><span class="hljs-bullet">  -</span> zip/tar file include?<br><span class="hljs-bullet">    -</span> application code, but not the dependencies<br><span class="hljs-bullet">    -</span> must install the dependencies first<br><span class="hljs-bullet">    -</span> unpack zip/tar<br><span class="hljs-bullet">    -</span> run the APP (copy artifact &amp; package.json file)<br><br><span class="hljs-section"># Build Tool - Webpack</span><br>  &gt; transpiles(è½¬è¯‘)|minifies(ç¼©å°)|bundles(æ†ç»‘)|compresses(å‹ç¼©) the code<br><br><span class="hljs-section"># What are Build Tools for other programming language?</span><br><span class="hljs-bullet">  -</span> Python (pip)<br><br><span class="hljs-section"># Pattern in all these tools</span><br><span class="hljs-bullet">  -</span> dependecyfile<br><span class="hljs-bullet">    -</span> maven (pom.xml)<br><span class="hljs-bullet">    -</span> gradle (build.gradle)<br><span class="hljs-bullet">    -</span> npm (package.json)<br><span class="hljs-bullet">  -</span> repository for dependencies<br><span class="hljs-bullet">  -</span> command line tool<br><span class="hljs-bullet">  -</span> package managers<br><br><span class="hljs-section"># Build Tools for DevOps Engineers</span><br><span class="hljs-bullet">  -</span> Build Docker Image =&gt; Push to Repo =&gt; Run on Server<br><span class="hljs-bullet">  -</span> Install Dependencies =&gt; run tests =&gt; build/bundle app =&gt; push to repo<br><br>SDK = Software Development Kit<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Cloud-amp-Infrastructure-as-a-Service"><a href="#Cloud-amp-Infrastructure-as-a-Service" class="headerlink" title="Cloud &amp; Infrastructure as a Service"></a>Cloud &amp; Infrastructure as a Service</h2>  <figure class="highlight mipsasm"><table><tr><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-comment"># What is Infrastructure as a Service?</span><br>  - <span class="hljs-keyword">Buys </span>own server<br>    &gt; manage own server <span class="hljs-keyword">and </span>infrastructure<br>    &gt; if something <span class="hljs-keyword">breaks, </span>need to fix it<br>  - Delegate Infrastructure Management<br>    &gt; <span class="hljs-keyword">Move </span>your physical infrastructure to <span class="hljs-keyword">cloud</span><br><span class="hljs-keyword"></span>    &gt; <span class="hljs-keyword">Just </span>rent (ç§Ÿèµ) the servers<br><br><span class="hljs-comment"># Infrastructure as a Service Providers?</span><br>  - Google <span class="hljs-keyword">Cloud</span><br><span class="hljs-keyword"></span>  - aws<br>  - <span class="hljs-keyword">DigitalOcean</span><br><span class="hljs-keyword"></span>  - Microsoft Azure<br><br>&gt; Inbound = Incoming Requests<br>&gt; Outbound = outgoing requests from server<br></code></pre></td></tr></table></figure>
<ul>
<li>Create a Linux User (Not use Root)<figure class="highlight crmsh"><table><tr><td class="code"><pre><code class="hljs crmsh"><span class="hljs-comment"># Security Best practice</span><br>  - Create separate <span class="hljs-keyword">User</span> <span class="hljs-title">for</span> every application<br>  - Give it only the permission it needs to run that App<br>  - Don&#x27;t work with the Root <span class="hljs-keyword">user</span><br><br>  <span class="hljs-title">&gt; create</span> username<br>  $ adduser <span class="hljs-tag">&lt;username&gt;</span><br><br>  &gt; Add <span class="hljs-keyword">user</span> <span class="hljs-title">to</span> <span class="hljs-string">&quot;sudo&quot;</span> <span class="hljs-keyword">group</span><br>  <span class="hljs-title">$</span> usermod -aG sudo <span class="hljs-tag">&lt;username&gt;</span><br><br>  &gt; switch to username<br>  $ su - <span class="hljs-tag">&lt;username&gt;</span><br><br>  $ = standard Linux <span class="hljs-keyword">User</span><br>  <span class="hljs-title"># = Root</span> User<br></code></pre></td></tr></table></figure></li>
<li>Nexus: Artifact Repository<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql">&gt; Nexus <span class="hljs-keyword">is</span> one <span class="hljs-keyword">of</span> the most popular<br>&gt; upload <span class="hljs-keyword">and</span> store different built artifacts<br>&gt; retrieve(download) artifacts later<br>&gt; central <span class="hljs-keyword">storage</span><br>&gt; host own repositories<br>&gt; Proxy Repository<br>&gt; metadata tagging (labelling <span class="hljs-keyword">and</span> tagging artifacts)<br>&gt; cleanup policies<br>&gt; <span class="hljs-keyword">search</span> functionality<br>&gt; <span class="hljs-keyword">user</span> token support <span class="hljs-keyword">for</span> <span class="hljs-keyword">system</span> <span class="hljs-keyword">user</span> authentication<br><br># What <span class="hljs-keyword">is</span> an Artifact Repository?<br>  - Artifacts = Apps built <span class="hljs-keyword">into</span> a **single file**<br>  - Different Artifact formats (JAR, WAR, ZIP, TAR)<br>  - Artifact repository = <span class="hljs-keyword">storage</span> <span class="hljs-keyword">of</span> those artifacts<br><br># What <span class="hljs-keyword">is</span> an Artifact Repository Manager?<br>  - Repository Formats?<br>    - APT<br>    - Composer<br>    - Conan<br>    - CPAN<br>    - Docker<br>    - ELPA<br>    - Git LFS<br>    - Go<br>    - Helm<br>    - Maven<br>    - npm<br>    - NuGet<br>    - P2<br>    - PyPI<br>    - R<br>    - Raw<br>    - RubyGems<br>    - Yum<br><br>Jenkins <span class="hljs-comment">--&gt; push --&gt; Nexus &lt;-- pull &lt;-- Server</span><br><br># Nexus Install<br>  &gt; Download Nexus tar file<br>  $ wget https://download.sonatype.com/nexus/<span class="hljs-number">3</span>/latest-unix.tar.gz<br><br>  &gt; Untar file<br>  $ tar -xvf latest-unix.tar.gz<br><br>  chyi <span class="hljs-keyword">in</span> ~/Downloads at k8s-master<br>  âœ ll<br>  total <span class="hljs-number">196</span>M<br>  -rw-r<span class="hljs-comment">--r--  1 chyi users 196M Oct 12 19:58 latest-unix.tar.gz</span><br>  drwxr-xr-x <span class="hljs-number">10</span> chyi users <span class="hljs-number">4.0</span>K Oct <span class="hljs-number">17</span> <span class="hljs-number">15</span>:<span class="hljs-number">08</span> nexus<span class="hljs-number">-3.35</span><span class="hljs-number">.0</span><span class="hljs-number">-02</span>      <span class="hljs-comment">-- Nexus folder: (contains runtime and application of Nexus)</span><br>  drwxr-xr-x  <span class="hljs-number">3</span> chyi users <span class="hljs-number">4.0</span>K Oct <span class="hljs-number">17</span> <span class="hljs-number">15</span>:<span class="hljs-number">08</span> sonatype-<span class="hljs-keyword">work</span>        <span class="hljs-comment">-- Sonatype-work: contains own config for Nexus and data</span><br>    - subdirectories depending <span class="hljs-keyword">on</span> your Nexus <span class="hljs-keyword">configuration</span><br>    - IP address that accessed Nexus<br>    - Logs <span class="hljs-keyword">of</span> Nexus App<br>    - Your uploaded files <span class="hljs-keyword">and</span> metadata<br><br># Staring Nexus<br>  - Services should <span class="hljs-keyword">not</span> run <span class="hljs-keyword">with</span> Root <span class="hljs-keyword">User</span> Permissions<br>  - Best practice: <span class="hljs-keyword">Create</span> own <span class="hljs-keyword">User</span> <span class="hljs-keyword">for</span> Service (e.g. Nexus - <span class="hljs-keyword">Only</span> the permission <span class="hljs-keyword">for</span> that specific Service)<br><br>  &gt; <span class="hljs-keyword">Create</span> <span class="hljs-keyword">User</span><br>  $ adduser nexus<br><br>  &gt; change folder <span class="hljs-keyword">owner</span><br>  &gt; Nexus <span class="hljs-keyword">User</span> <span class="hljs-keyword">execute</span> nexus executable<br>  &gt; Nexus <span class="hljs-keyword">read</span>/<span class="hljs-keyword">write</span> sonatype-<span class="hljs-keyword">work</span> folder<br>  $ chown -R nexus:nexus nexus<span class="hljs-number">-3</span><br>  $ chown -R nexus:nexus sonatype-<span class="hljs-keyword">work</span><br><br>  &gt; change run <span class="hljs-keyword">user</span><br>  $ sudo vim nexus<span class="hljs-number">-3</span>/bin/nexus.rc<br>    run_as_user=&quot;nexus&quot;<br><br>  &gt; <span class="hljs-keyword">start</span> nexus<br>  nexus@chyiyaqing-PowerEdge-R720:/opt$ ./nexus<span class="hljs-number">-3.35</span><span class="hljs-number">.0</span><span class="hljs-number">-02</span>/bin/nexus <span class="hljs-keyword">start</span><br>  Starting nexus<br><br>  &gt; <span class="hljs-keyword">check</span> nexus status<br>  nexus@chyiyaqing-PowerEdge-R720:/opt$ netstat -lnpt | grep <span class="hljs-number">8081</span><br>  (<span class="hljs-keyword">Not</span> <span class="hljs-keyword">all</span> processes could be identified, non-<span class="hljs-keyword">owned</span> process <span class="hljs-keyword">info</span><br>   will <span class="hljs-keyword">not</span> be shown, you would have <span class="hljs-keyword">to</span> be root <span class="hljs-keyword">to</span> see it <span class="hljs-keyword">all</span>.)<br>  tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">8081</span>            <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:*               <span class="hljs-keyword">LISTEN</span>      <span class="hljs-number">2732557</span>/java<br><br>  &gt; <span class="hljs-keyword">Access</span> Nexus <span class="hljs-keyword">from</span> Browser<br>  $ curl http://localhost:<span class="hljs-number">8081</span><br><br>  &gt; <span class="hljs-keyword">Create</span> <span class="hljs-built_in">new</span> Repository<br>  &gt; Hosted Repository<br>  &gt; <span class="hljs-keyword">Group</span> Repository<br><br># Publish artifact <span class="hljs-keyword">to</span> Nexus Repository<br>  &gt; Upload Jar File <span class="hljs-keyword">to</span> existing hosted repository <span class="hljs-keyword">on</span> Nexus<br>  &gt; Maven/Gradle command <span class="hljs-keyword">for</span> pushing <span class="hljs-keyword">to</span> remote repository<br>  &gt; Configure <span class="hljs-keyword">both</span> tools <span class="hljs-keyword">to</span> <span class="hljs-keyword">connect</span> <span class="hljs-keyword">to</span> Nexus (Nexus Repo URL + Credentials)<br>  &gt; Nexus <span class="hljs-keyword">User</span> <span class="hljs-keyword">with</span> permission <span class="hljs-keyword">to</span> upload<br><br>  - <span class="hljs-keyword">Create</span> Nexus <span class="hljs-keyword">User</span><br>  - Gradle Project Configure <span class="hljs-keyword">with</span> Nexus<br><br># Upload Jar File <span class="hljs-keyword">to</span> Nexus<br>  - Upload Jar File <span class="hljs-keyword">to</span> existing hosted repository <span class="hljs-keyword">on</span> Nexus<br>  - Maven/Gradle command <span class="hljs-keyword">for</span> pushing <span class="hljs-keyword">to</span> remote repository<br>  - Configure <span class="hljs-keyword">both</span> tools <span class="hljs-keyword">to</span> <span class="hljs-keyword">connect</span> <span class="hljs-keyword">to</span> Nexus(Nexus Repo URL + Credentials)<br>  - Nexus <span class="hljs-keyword">User</span> <span class="hljs-keyword">with</span> permission <span class="hljs-keyword">to</span> upload<br><br># Nexus API<br>  - Query Nexus Repository <span class="hljs-keyword">for</span> different information<br>    - Use a tool <span class="hljs-keyword">like</span> **curl** <span class="hljs-keyword">or</span> **wget** <span class="hljs-keyword">to</span> <span class="hljs-keyword">execute</span> http request<br>    # List <span class="hljs-keyword">all</span> repositories<br>    $ curl -u <span class="hljs-keyword">user</span>:pwd -X <span class="hljs-keyword">GET</span> <span class="hljs-string">&#x27;http://IP:HOST/service/rest/v1/repositories&#x27;</span><br>      [ &#123;<br>        &quot;name&quot; : &quot;nuget-group&quot;,<br>        &quot;format&quot; : &quot;nuget&quot;,<br>        &quot;type&quot; : &quot;group&quot;,<br>        &quot;url&quot; : &quot;http://172.30.1.12:8081/repository/nuget-group&quot;,<br>        &quot;attributes&quot; : &#123; &#125;<br>      &#125;, &#123;<br>        &quot;name&quot; : &quot;maven-snapshots&quot;,<br>        &quot;format&quot; : &quot;maven2&quot;,<br>        &quot;type&quot; : &quot;hosted&quot;,<br>        &quot;url&quot; : &quot;http://172.30.1.12:8081/repository/maven-snapshots&quot;,<br>        &quot;attributes&quot; : &#123; &#125;<br>      &#125;, &#123;<br>        &quot;name&quot; : &quot;maven-central&quot;,<br>        &quot;format&quot; : &quot;maven2&quot;,<br>        &quot;type&quot; : &quot;proxy&quot;,<br>        &quot;url&quot; : &quot;http://172.30.1.12:8081/repository/maven-central&quot;,<br>        &quot;attributes&quot; : &#123;<br>          &quot;proxy&quot; : &#123;<br>            &quot;remoteUrl&quot; : &quot;https://repo1.maven.org/maven2/&quot;<br>          &#125;<br>        &#125;<br>      &#125;, &#123;<br>        &quot;name&quot; : &quot;nuget.org-proxy&quot;,<br>        &quot;format&quot; : &quot;nuget&quot;,<br>        &quot;type&quot; : &quot;proxy&quot;,<br>        &quot;url&quot; : &quot;http://172.30.1.12:8081/repository/nuget.org-proxy&quot;,<br>        &quot;attributes&quot; : &#123;<br>          &quot;proxy&quot; : &#123;<br>            &quot;remoteUrl&quot; : &quot;https://api.nuget.org/v3/index.json&quot;<br>          &#125;<br>        &#125;<br>      &#125;, &#123;<br>        &quot;name&quot; : &quot;maven-releases&quot;,<br>        &quot;format&quot; : &quot;maven2&quot;,<br>        &quot;type&quot; : &quot;hosted&quot;,<br>        &quot;url&quot; : &quot;http://172.30.1.12:8081/repository/maven-releases&quot;,<br>        &quot;attributes&quot; : &#123; &#125;<br>      &#125;, &#123;<br>        &quot;name&quot; : &quot;nuget-hosted&quot;,<br>        &quot;format&quot; : &quot;nuget&quot;,<br>        &quot;type&quot; : &quot;hosted&quot;,<br>        &quot;url&quot; : &quot;http://172.30.1.12:8081/repository/nuget-hosted&quot;,<br>        &quot;attributes&quot; : &#123; &#125;<br>      &#125;, &#123;<br>        &quot;name&quot; : &quot;maven-public&quot;,<br>        &quot;format&quot; : &quot;maven2&quot;,<br>        &quot;type&quot; : &quot;group&quot;,<br>        &quot;url&quot; : &quot;http://172.30.1.12:8081/repository/maven-public&quot;,<br>        &quot;attributes&quot; : &#123; &#125;<br>      &#125; ]%<br><br>    # List components<br>    âœ curl -u <span class="hljs-keyword">admin</span>:xx -X <span class="hljs-keyword">GET</span> <span class="hljs-string">&#x27;http://172.30.1.12:8081/service/rest/v1/components?repository=maven-snapshots&#x27;</span><br><br># Blob Stores<br>  - Nexus <span class="hljs-keyword">Storage</span> <span class="hljs-keyword">to</span> store <span class="hljs-keyword">all</span> the uploaded files<br>  - <span class="hljs-keyword">Storage</span> <span class="hljs-keyword">of</span> binary files<br>  - <span class="hljs-keyword">Local</span> <span class="hljs-keyword">Storage</span> <span class="hljs-keyword">or</span> Cloud <span class="hljs-keyword">Storage</span><br>  - <span class="hljs-keyword">Type</span> field = <span class="hljs-keyword">Storage</span> Backend<br>    - File: file <span class="hljs-keyword">system</span>-based <span class="hljs-keyword">storage</span><br>    - s3: cloud-based <span class="hljs-keyword">storage</span><br></code></pre></td></tr></table></figure>
<ul>
<li>Blob Stores: Configure local and cloud blob storage<br><img src="/misc/images/nexus-blob-stores.png" alt="Nexus Blob Stores"><figure class="highlight applescript"><table><tr><td class="code"><pre><code class="hljs applescript">&gt; Blob store can&#x27;t be modified<br>&gt; Blob store used <span class="hljs-keyword">by</span> a repository can&#x27;t be deleted!<br><span class="hljs-comment"># Type:</span><br><span class="hljs-comment"># State: state of the blob store</span><br>  - started: indicates <span class="hljs-keyword">it</span>&#x27;s <span class="hljs-built_in">running</span> <span class="hljs-keyword">as</span> expected<br>  - failed: indicates a configuration issue<br><span class="hljs-comment"># Blob Count: number of blobs currently stored</span><br><span class="hljs-comment"># Total Size:</span><br><span class="hljs-comment"># Available space:</span><br></code></pre></td></tr></table></figure></li>
<li>Component vs Asset<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># Component:</span><br><span class="hljs-bullet">  -</span> abstract<br><span class="hljs-bullet">  -</span> what we are uploading<br><span class="hljs-section"># Asset:</span><br><span class="hljs-bullet">  -</span> actual physical packages/files<br><span class="hljs-bullet">  -</span> 1 component = 1 or more assets<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li>Jenkins: Build Automation</li>
<li>LDAP</li>
</ul>
<h2 id="Infrastructure-Privisioning"><a href="#Infrastructure-Privisioning" class="headerlink" title="Infrastructure Privisioning"></a>Infrastructure Privisioning</h2><ul>
<li>Containers with Docker<ul>
<li>What is a Container?<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-quote">&gt; A way to package application with all the necessary dependencies and configuration</span><br><span class="hljs-quote">&gt; Portable artifact, easily shared and moved around</span><br><br><span class="hljs-section"># Container Technologies</span><br><span class="hljs-bullet">  -</span> Docker<br><span class="hljs-bullet">  -</span> Containerd<br><span class="hljs-bullet">  -</span> CRI-O<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li>Container Vs Image<figure class="highlight applescript"><table><tr><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># Docker Image:</span><br>  &gt; <span class="hljs-keyword">the</span> actual package<br>  - artifact, <span class="hljs-keyword">that</span> can be moved <span class="hljs-keyword">around</span><br><br><span class="hljs-comment"># Docker Container</span><br>  &gt; actually start <span class="hljs-keyword">the</span> <span class="hljs-built_in">application</span><br>  &gt; container environment <span class="hljs-keyword">is</span> created<br>  &gt; <span class="hljs-keyword">is</span> a <span class="hljs-built_in">running</span> environment <span class="hljs-keyword">for</span> Image<br>  - virtual File system<br>  - environment configs<br>  - <span class="hljs-built_in">application</span> images<br></code></pre></td></tr></table></figure></li>
<li>Docker vs Virtual Machine<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-quote">&gt; Operating System have 2 Layers:</span><br><span class="hljs-bullet">  -</span> OS Kernel<br><span class="hljs-bullet">  -</span> Application [Docker]<br></code></pre></td></tr></table></figure></li>
<li>Docker Architecture &amp; Components<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># Docker Engine:</span><br><span class="hljs-bullet">  -</span> Server:<br><span class="hljs-bullet">    -</span> Container Runtime:<br><span class="hljs-bullet">      -</span> pull images<br><span class="hljs-bullet">      -</span> managing images &amp; containers<br><span class="hljs-bullet">    -</span> Volumes:<br><span class="hljs-bullet">      -</span> persisting data<br><span class="hljs-bullet">    -</span> Network:<br><span class="hljs-bullet">      -</span> configuring network for container communication<br><span class="hljs-bullet">    -</span> build images:<br><span class="hljs-bullet">      -</span> build own Docker images<br><span class="hljs-bullet">  -</span> API:<br><span class="hljs-bullet">    -</span> interacting with Docker Server<br><span class="hljs-bullet">  -</span> CLI:<br><span class="hljs-bullet">    -</span> Command Line Interface: client to execute docker commands<br></code></pre></td></tr></table></figure></li>
<li>Main Docker commands<figure class="highlight powershell"><table><tr><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># Images</span><br><br><span class="hljs-comment"># Container</span><br><br><span class="hljs-comment"># Container Port vs. Host Port</span><br><br><span class="hljs-comment"># Debugging Docker Containers</span><br><br><span class="hljs-variable">$</span> docker exec<br>  - docker exec <span class="hljs-literal">-it</span> container_id /bin/bash<br><span class="hljs-variable">$</span> docker pull<br><span class="hljs-variable">$</span> docker run<br>  <span class="hljs-literal">-d</span> : daemon<br>  docker run <span class="hljs-literal">-d</span> <span class="hljs-literal">-p6000</span>:<span class="hljs-number">6379</span> -<span class="hljs-literal">-name</span> redis redis:latest<br><span class="hljs-variable">$</span> docker exec <span class="hljs-literal">-it</span><br><span class="hljs-variable">$</span> docker logs<br><span class="hljs-variable">$</span> docker images<br><span class="hljs-variable">$</span> docker <span class="hljs-built_in">ps</span> = list running containers<br>  <span class="hljs-literal">-a</span> : lists running and stopped container<br><span class="hljs-variable">$</span> docker run = starts new container with a command<br><span class="hljs-variable">$</span> docker <span class="hljs-built_in">start</span> = starts the container<br><span class="hljs-variable">$</span> docker stop = stops the container<br><span class="hljs-variable">$</span> docker network <span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure></li>
<li>Demo Overview<br><img src="/misc/images/docker-demo.png" alt="Demo Workflow with Docker"><ul>
<li>Develop with Docker<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># Demo project</span><br><span class="hljs-bullet">  -</span> JS and Nodejs application<br><span class="hljs-bullet">    -</span> localhost:3000/my-app<br><span class="hljs-bullet">  -</span> MongoDB Docker Container<br><span class="hljs-bullet">    -</span> localhost:3001/db/my-db<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li>Run multiple containers - Docker Compose</li>
<li>Build Docker Image - Dockerfile<figure class="highlight routeros"><table><tr><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># What is a Dockerfile?</span><br>  - Blueprint <span class="hljs-keyword">for</span> building images<br><br><span class="hljs-comment"># FROM : Start by basing it on another image</span><br>  <span class="hljs-keyword">FROM</span> node<br><br><span class="hljs-comment"># ENV var: Optionally define environment variables</span><br>  ENV <span class="hljs-attribute">MONGO_DB_USERNAME</span>=admin \<br>      <span class="hljs-attribute">MONGO_DB_PWD</span>=password<br><br><span class="hljs-comment"># RUN : execute any linux command</span><br>  <span class="hljs-builtin-name">RUN</span> mkdir -p /home/app<br><br><span class="hljs-comment"># COPY : execute on the HOST machine</span><br>  COPY . /home/app<br><br><span class="hljs-comment"># CMD : entrypoint command</span><br>  CMD [<span class="hljs-string">&quot;node&quot;</span>, <span class="hljs-string">&quot;server.js&quot;</span>]<br><br>$ docker build -t my-app:version-1 .<br>$ docker <span class="hljs-builtin-name">run</span> my-app:version-1<br></code></pre></td></tr></table></figure></li>
<li>Push to private Docker Repository<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># Docker private repository</span><br>  - Harbar:<br><br><span class="hljs-comment"># build &amp; tag an images</span><br>  docker tag chyiyaqing<span class="hljs-regexp">/alpine_sl harbor.chyidl.com/</span>chyiyaqing/alpine_sl<br><br><span class="hljs-comment"># docker login</span><br>  âœ docker login -u admin -p macintosh harbor.chyidl.com<br>  WARNING! Using --password via the CLI is insecure. Use --password-stdin.<br>  WARNING! Your password will be stored unencrypted <span class="hljs-keyword">in</span> <span class="hljs-regexp">/home/</span>chyiyaqing<span class="hljs-regexp">/.docker/</span>config.json.<br>  Configure a credential helper to remove this warning. See<br>  https:<span class="hljs-regexp">//</span>docs.docker.com<span class="hljs-regexp">/engine/</span>reference<span class="hljs-regexp">/commandline/</span>login/<span class="hljs-comment">#credentials-store</span><br><br>  Login Succeeded<br><br><span class="hljs-comment"># docker push</span><br>  âœ docker push harbor.chyidl.com<span class="hljs-regexp">/chyiyaqing/</span>alpine_sl<br>  Using default tag: latest<br>  The push refers to repository [harbor.chyidl.com<span class="hljs-regexp">/chyiyaqing/</span>alpine_sl]<br>  <span class="hljs-number">102</span>b73ff0977: Pushed<br>  e2eb06d8af82: Pushed<br>  latest: digest: sha256:<span class="hljs-number">500</span>e9b9536a4fec460c487867d3cd7084da934ba37151aa122f4be438cc06d57 size: <span class="hljs-number">739</span><br></code></pre></td></tr></table></figure></li>
<li>Persist data in Docker - Volumes<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># When do we need Docker Volumes?</span><br>  &gt; For data persistence<br><br><span class="hljs-comment"># What is Docker Volumes</span><br><br><span class="hljs-comment"># 3 Volumes Types</span><br>  - Host Volumes (you decide where on the host file system the reference is made)<br>    - -v <span class="hljs-regexp">/home/m</span>ount<span class="hljs-regexp">/data:/</span>var<span class="hljs-regexp">/lib/my</span>sql/data<br><br>  - Anonymous Volumes (automatically created by Docker)<br>    - -v <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/mysql/</span>data<br><br>  - Named Volumes<br>    - -v name:<span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/mysql/</span>data<br><br><span class="hljs-comment"># Docker Volume Locations</span><br>  - Windows: C:\ProgramData\docker\volumes<br>  - Linux: <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/docker/</span>volumes<br>  - MacOS: <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/docker/</span>volumes<br><br><span class="hljs-comment"># Docker for Mac</span><br>  &gt; creates a Linux virtual machine and stores all the Docker data here<br></code></pre></td></tr></table></figure></li>
<li>Push/Pull Nexus Repository<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># Docker login to Nexus Docker Repo</span><br>  chyiyaqing <span class="hljs-keyword">in</span> ~ at chyiyaqing-PowerEdge-R720<br>  âœ docker login <span class="hljs-number">172.30</span>.<span class="hljs-number">1.12</span>:<span class="hljs-number">8083</span><br>  Username: chyi<br>  Password:<br>  WARNING! Your password will be stored unencrypted <span class="hljs-keyword">in</span> <span class="hljs-regexp">/home/</span>chyiyaqing<span class="hljs-regexp">/.docker/</span>config.json.<br>  Configure a credential helper to remove this warning. See<br>  https:<span class="hljs-regexp">//</span>docs.docker.com<span class="hljs-regexp">/engine/</span>reference<span class="hljs-regexp">/commandline/</span>login/<span class="hljs-comment">#credentials-store</span><br><br>  Login Succeeded<br><br><span class="hljs-comment"># Push Images to Nexus Repo</span><br>  âœ docker tag ubuntu:latest <span class="hljs-number">172.30</span>.<span class="hljs-number">1.12</span>:<span class="hljs-number">8083</span>/ubuntu:latest<br><br>  chyiyaqing <span class="hljs-keyword">in</span> ~ at chyiyaqing-PowerEdge-R720<br>  âœ docker push <span class="hljs-number">172.30</span>.<span class="hljs-number">1.12</span>:<span class="hljs-number">8083</span>/ubuntu:latest<br>  The push refers to repository [<span class="hljs-number">172.30</span>.<span class="hljs-number">1.12</span>:<span class="hljs-number">8083</span>/ubuntu]<br>  <span class="hljs-number">9</span>f54eef41275: Pushed<br>  latest: digest: sha256:<span class="hljs-number">7</span>cc0576c7c0ec2384de5cbf245f41567e922aab1b075f3e8ad565f508032df17 size: <span class="hljs-number">529</span><br><br><span class="hljs-comment"># Fetch Docker Image from Nexus</span><br>  chyiyaqing <span class="hljs-keyword">in</span> ~ at chyiyaqing-PowerEdge-R720 took <span class="hljs-number">7</span>s<br>  âœ curl -u chyi:macintosh -X GET <span class="hljs-string">&#x27;http://172.30.1.12:8081/service/rest/v1/components?repository=docker-hosted&#x27;</span><br>  &#123;<br>    <span class="hljs-string">&quot;items&quot;</span> : [ &#123;<br>      <span class="hljs-string">&quot;id&quot;</span> : <span class="hljs-string">&quot;ZG9ja2VyLWhvc3RlZDo3MWIyYzQyZWUyMjFkZTJlNzZlYTY4YjNmMGY1MTQ4Mw&quot;</span>,<br>      <span class="hljs-string">&quot;repository&quot;</span> : <span class="hljs-string">&quot;docker-hosted&quot;</span>,<br>      <span class="hljs-string">&quot;format&quot;</span> : <span class="hljs-string">&quot;docker&quot;</span>,<br>      <span class="hljs-string">&quot;group&quot;</span> : null,<br>      <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;ubuntu&quot;</span>,<br>      <span class="hljs-string">&quot;version&quot;</span> : <span class="hljs-string">&quot;latest&quot;</span>,<br>      <span class="hljs-string">&quot;assets&quot;</span> : [ &#123;<br>        <span class="hljs-string">&quot;downloadUrl&quot;</span> : <span class="hljs-string">&quot;http://172.30.1.12:8081/repository/docker-hosted/v2/ubuntu/manifests/latest&quot;</span>,<br>        <span class="hljs-string">&quot;path&quot;</span> : <span class="hljs-string">&quot;v2/ubuntu/manifests/latest&quot;</span>,<br>        <span class="hljs-string">&quot;id&quot;</span> : <span class="hljs-string">&quot;ZG9ja2VyLWhvc3RlZDoyNjlmOTEwOWZiZmIyMzlmNTc1OTU2MGQ1NmZjZTQ5Nw&quot;</span>,<br>        <span class="hljs-string">&quot;repository&quot;</span> : <span class="hljs-string">&quot;docker-hosted&quot;</span>,<br>        <span class="hljs-string">&quot;format&quot;</span> : <span class="hljs-string">&quot;docker&quot;</span>,<br>        <span class="hljs-string">&quot;checksum&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;sha1&quot;</span> : <span class="hljs-string">&quot;064d46bcae0d9c485376fbeabeed1f3e4f1c8679&quot;</span>,<br>          <span class="hljs-string">&quot;sha256&quot;</span> : <span class="hljs-string">&quot;7cc0576c7c0ec2384de5cbf245f41567e922aab1b075f3e8ad565f508032df17&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;contentType&quot;</span> : <span class="hljs-string">&quot;application/vnd.docker.distribution.manifest.v2+json&quot;</span>,<br>        <span class="hljs-string">&quot;lastModified&quot;</span> : <span class="hljs-string">&quot;2021-11-13T06:33:59.622+00:00&quot;</span>,<br>        <span class="hljs-string">&quot;blobCreated&quot;</span> : <span class="hljs-string">&quot;2021-11-13T06:33:59.622+00:00&quot;</span>,<br>        <span class="hljs-string">&quot;lastDownloaded&quot;</span> : null<br>      &#125; ]<br>    &#125; ],<br>    <span class="hljs-string">&quot;continuationToken&quot;</span> : null<br>  &#125;%<br></code></pre></td></tr></table></figure></li>
<li>Run Nexus as Docker Container<figure class="highlight xl"><table><tr><td class="code"><pre><code class="hljs xl"># Persistent Data<br>  $ docker volume create --<span class="hljs-keyword">name</span> nexus-<span class="hljs-keyword">data</span><br>  $ docker run -d -p <span class="hljs-number">8081</span>:<span class="hljs-number">8081</span> --<span class="hljs-keyword">name</span> nexus -v nexu-<span class="hljs-keyword">data</span>:/nexus-<span class="hljs-keyword">data</span> sonatype/nexus3<br>    -d = detached, run <span class="hljs-built_in">in</span> <span class="hljs-built_in">background</span><br>    -p <span class="hljs-number">8081</span>:<span class="hljs-number">8081</span> = make accessible <span class="hljs-built_in">at</span> <span class="hljs-number">8081</span><br>    --<span class="hljs-keyword">name</span> = container <span class="hljs-keyword">name</span><br>    -v = volume(named volume here)<br><br>  chyi <span class="hljs-built_in">in</span> ~ <span class="hljs-built_in">at</span> k8s-master<br>  âœ netstat -lnpt | grep <span class="hljs-number">8081</span><br>  (Not all processes could be identified, non-owned process info<br>   will <span class="hljs-built_in">not</span> be shown, you would have to be root to see it all.)<br>  tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">8081</span>            <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:*               LISTEN      -<br><br>  chyi <span class="hljs-built_in">in</span> ~ <span class="hljs-built_in">at</span> k8s-master<br>  âœ docker ps<br>  CONTAINER ID   IMAGE             COMMAND                  CREATED          STATUS          PORTS                    NAMES<br>  <span class="hljs-number">8630</span><span class="hljs-function"><span class="hljs-title">fd5d8faa</span>   sonatype/nexus3   &quot;sh -c $&#123;SONATYPE_DIâ€¦&quot;   26 seconds ago   Up 23 seconds   0.0.0.0:8081-&gt;</span><span class="hljs-number">8081</span>/tcp   nexus<br><br>chyi <span class="hljs-built_in">in</span> ~ <span class="hljs-built_in">at</span> k8s-master<br>âœ docker volume ls<br>DRIVER    VOLUME NAME<br>local     nexus-<span class="hljs-keyword">data</span><br><br>chyi <span class="hljs-built_in">in</span> ~ <span class="hljs-built_in">at</span> k8s-master<br>âœ docker inspect nexus-<span class="hljs-keyword">data</span><br>[<br>    &#123;<br>        <span class="hljs-string">&quot;CreatedAt&quot;</span>: <span class="hljs-string">&quot;2021-11-13T15:09:41+08:00&quot;</span>,<br>        <span class="hljs-string">&quot;Driver&quot;</span>: <span class="hljs-string">&quot;local&quot;</span>,<br>        <span class="hljs-string">&quot;Labels&quot;</span>: &#123;&#125;,<br>        <span class="hljs-string">&quot;Mountpoint&quot;</span>: <span class="hljs-string">&quot;/mnt/INNERDISK/docker/volumes/nexus-data/_data&quot;</span>,<br>        <span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;nexus-data&quot;</span>,<br>        <span class="hljs-string">&quot;Options&quot;</span>: &#123;&#125;,<br>        <span class="hljs-string">&quot;Scope&quot;</span>: <span class="hljs-string">&quot;local&quot;</span><br>    &#125;<br>]<br><br>chyi <span class="hljs-built_in">in</span> ~ <span class="hljs-built_in">at</span> k8s-master<br>âœ ls /mnt/INNERDISK/docker/volumes/nexus-<span class="hljs-keyword">data</span>/_<span class="hljs-keyword">data</span><br>blobs  db             etc                instances  karaf.pid  lock  orient  restore-from-backup<br>cache  elasticsearch  generated-bundles  javaprefs  keystores  <span class="hljs-built_in">log</span>   port    tmp<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Build-Automation-amp-CI-CD-with-Jenkins"><a href="#Build-Automation-amp-CI-CD-with-Jenkins" class="headerlink" title="Build Automation &amp; CI/CD with Jenkins"></a>Build Automation &amp; CI/CD with Jenkins</h2><ul>
<li><p>Introduction to Build Automation</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><code class="hljs n1ql"># What is <span class="hljs-keyword">Build</span> Automation?<br>  Test Code -&gt; <span class="hljs-keyword">Build</span> Application -&gt; Push <span class="hljs-keyword">to</span> Repository -&gt; Deploy <span class="hljs-keyword">to</span> Server<br><br># What <span class="hljs-keyword">is</span> Jenkins?<br><br># What can you <span class="hljs-keyword">do</span> <span class="hljs-keyword">with</span> Jenkins?<br>  Run tests<br>  <span class="hljs-keyword">Build</span> artifacts<br>  Publish artifacts<br>  Deploy artifacts<br>  Send notifactions<br><br># Integration <span class="hljs-keyword">with</span> other technologies<br>  Docker<br>  Repositories<br>  <span class="hljs-keyword">Build</span> Tools<br>  Deployment Servers<br><br># What <span class="hljs-keyword">do</span> you need <span class="hljs-keyword">to</span> configure?<br>  Run test -- <span class="hljs-keyword">Build</span> Tools need <span class="hljs-keyword">to</span> be available<br>  <span class="hljs-keyword">Build</span> Application -- <span class="hljs-keyword">Build</span> Tools <span class="hljs-keyword">or</span> Docker available<br>  Publish Docker Image -- Store Credentials <span class="hljs-keyword">in</span> Jenkins<br></code></pre></td></tr></table></figure></li>
<li><p>Deploy Jenkins on DigitalOcean server</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><code class="hljs gradle"># Install Jenkins directly on OS<br># Run Jenkins as Docker container<br>  $ docker run -p <span class="hljs-number">8080</span>:<span class="hljs-number">8080</span> -p <span class="hljs-number">50000</span>:<span class="hljs-number">50000</span> -d -v jenkins_home:<span class="hljs-regexp">/var/</span>jenkins_home jenkins/jenkins:lts<br><br>  chyiyaqing in ~ at chyiyaqing-PowerEdge-R720 took <span class="hljs-number">15</span>s<br>  âœ docker ps | <span class="hljs-keyword">grep</span> jenkins<br>  e01cdfdb64f1   jenkins<span class="hljs-regexp">/jenkins:lts                                             &quot;/</span>sbin<span class="hljs-regexp">/tini -- /u</span>sr<span class="hljs-regexp">/â€¦&quot;   14 seconds ago       Up 12 seconds                      0.0.0.0:8080-&gt;8080/</span>tcp, :::<span class="hljs-number">8080</span>-&gt;<span class="hljs-number">8080</span><span class="hljs-regexp">/tcp, 0.0.0.0:50000-&gt;50000/</span>tcp, :::<span class="hljs-number">50000</span>-&gt;<span class="hljs-number">50000</span>/tcp                                    brave_mcnulty<br><br>  chyiyaqing in ~ at chyiyaqing-PowerEdge-R720<br>  âœ docker volume <span class="hljs-keyword">inspect</span> jenkins_home<br>  [<br>      &#123;<br>          <span class="hljs-string">&quot;CreatedAt&quot;</span>: <span class="hljs-string">&quot;2021-11-14T02:04:28+08:00&quot;</span>,<br>          <span class="hljs-string">&quot;Driver&quot;</span>: <span class="hljs-string">&quot;local&quot;</span>,<br>          <span class="hljs-string">&quot;Labels&quot;</span>: <span class="hljs-keyword">null</span>,<br>          <span class="hljs-string">&quot;Mountpoint&quot;</span>: <span class="hljs-string">&quot;/var/lib/docker/volumes/jenkins_home/_data&quot;</span>,<br>          <span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;jenkins_home&quot;</span>,<br>          <span class="hljs-string">&quot;Options&quot;</span>: <span class="hljs-keyword">null</span>,<br>          <span class="hljs-string">&quot;Scope&quot;</span>: <span class="hljs-string">&quot;local&quot;</span><br>      &#125;<br>  ]<br></code></pre></td></tr></table></figure></li>
<li><p>Roles of Jenkins</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-comment"># Jenkins Administrator (Operations or DevOps teams)</span><br>  - administers <span class="hljs-keyword">and </span>manages <span class="hljs-keyword">Jenkins</span><br><span class="hljs-keyword"></span>  - sets up <span class="hljs-keyword">Jenkins </span>cluster<br>  - <span class="hljs-keyword">installs </span>plugins<br>  - <span class="hljs-keyword">backup </span><span class="hljs-keyword">Jenkins </span>data<br><br><span class="hljs-comment"># Jenkins User (Developer or DevOps teams)</span><br>  - creating the actual <span class="hljs-keyword">jobs </span>to run workflows<br></code></pre></td></tr></table></figure></li>
<li><p>Install and use Build Tools in Jenkins</p>
<figure class="highlight less"><table><tr><td class="code"><pre><code class="hljs less"># <span class="hljs-selector-tag">Create</span> <span class="hljs-selector-tag">Job</span> <span class="hljs-selector-tag">to</span> <span class="hljs-selector-tag">automate</span> <span class="hljs-selector-tag">your</span> <span class="hljs-selector-tag">apps</span> <span class="hljs-selector-tag">workflow</span><br>  <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">Java</span> <span class="hljs-selector-tag">App</span> (Maven)<br>    <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">Java</span> <span class="hljs-selector-tag">App</span> <span class="hljs-selector-tag">with</span> <span class="hljs-selector-tag">Maven</span> <span class="hljs-selector-tag">Build</span> <span class="hljs-selector-tag">Tool</span><br>    <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">Run</span> <span class="hljs-selector-tag">Tests</span><br>    <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">Build</span> <span class="hljs-selector-tag">Jar</span> <span class="hljs-selector-tag">File</span><br>  <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">JavaScript</span> <span class="hljs-selector-tag">App</span> (npm)<br>    <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">Node</span> <span class="hljs-selector-tag">App</span><br>    <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">Run</span> <span class="hljs-selector-tag">Tests</span><br>    <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">Package</span> <span class="hljs-selector-tag">and</span> <span class="hljs-selector-tag">push</span> <span class="hljs-selector-tag">to</span> <span class="hljs-selector-tag">Repo</span><br><br># <span class="hljs-selector-tag">2</span> <span class="hljs-selector-tag">ways</span> <span class="hljs-selector-tag">to</span> <span class="hljs-selector-tag">install</span> <span class="hljs-selector-tag">and</span> <span class="hljs-selector-tag">configure</span> <span class="hljs-selector-tag">those</span> <span class="hljs-selector-tag">tools</span><br>  <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">Jenkins</span> <span class="hljs-selector-tag">Plugins</span><br>    <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">just</span> <span class="hljs-selector-tag">install</span> <span class="hljs-selector-tag">plugin</span> (via UI) <span class="hljs-selector-tag">for</span> <span class="hljs-selector-tag">your</span> <span class="hljs-selector-tag">tool</span><br><br>  <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">Install</span> <span class="hljs-selector-tag">Tools</span> <span class="hljs-selector-tag">directly</span> <span class="hljs-selector-tag">on</span> <span class="hljs-selector-tag">Server</span><br>    <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">enter</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">remote</span> <span class="hljs-selector-tag">server</span> <span class="hljs-selector-tag">and</span> <span class="hljs-selector-tag">install</span><br>    <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">inside</span> <span class="hljs-selector-tag">the</span> <span class="hljs-selector-tag">Docker</span> <span class="hljs-selector-tag">container</span>, <span class="hljs-keyword">when</span> Jenkins runs as container<br><br># Install npm <span class="hljs-keyword">and</span> Node in Jenkins container<br>  chyiyaqing in ~ at chyiyaqing-PowerEdge-R720 took <span class="hljs-number">19s</span><br>  âœ docker exec -u <span class="hljs-number">0</span> -it e01cdfdb64f1 bash (root user)<br>  root<span class="hljs-variable">@e01cdfdb64f1</span>:/# cat /etc/issue<br>  Debian GNU/Linux <span class="hljs-number">11</span> \n \l<br><br>  root<span class="hljs-variable">@e01cdfdb64f1</span>:/# sed -i <span class="hljs-string">&#x27;s/deb.debian.org/mirrors.ustc.edu.cn/g&#x27;</span> /etc/apt/sources.list (æ›¿æ¢å›½å†…æº)<br>  root<span class="hljs-variable">@e01cdfdb64f1</span>:/# curl -sL <span class="hljs-attribute">https</span>:<span class="hljs-comment">//deb.nodesource.com/setup_16.x -o nodesource_setup.sh</span><br>  root<span class="hljs-variable">@e01cdfdb64f1</span>:/# ls<br>  bin  boot  dev	etc  home  lib	lib64  media  mnt  nodesource_setup.sh	opt  proc  root  run  sbin  srv  sys  tmp  usr	var<br>  root<span class="hljs-variable">@e01cdfdb64f1</span>:/# bash nodesource_setup.sh<br><br>  ## Installing the NodeSource Node.js <span class="hljs-number">16</span>.x repo...<br></code></pre></td></tr></table></figure></li>
<li><p>Create Freestyle Job</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">-</span> Plugins<br><span class="hljs-bullet">-</span> Credentials<br><span class="hljs-bullet">-</span> Configure Git Repository<br><br><span class="hljs-bullet">-</span> Plugin Configuration<br><span class="hljs-bullet">  1.</span> Install directly on Server: more flexible<br><span class="hljs-bullet">  2.</span> Plugin: limited to provided input fields<br></code></pre></td></tr></table></figure></li>
<li><p>Docker in Jenkins</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><code class="hljs gams">chyiyaqing in ~/chyi at chyiyaqing-PowerEdge-R720<br>âœ docker run -p <span class="hljs-number">8080</span>:<span class="hljs-number">8080</span> -p <span class="hljs-number">50000</span>:<span class="hljs-number">50000</span> -d \<br>âœ -v jenkins_home:/var/jenkins_home \<br>âœ -v /var/run/docker.sock:/var/run/docker.sock \<br>âœ -v <span class="hljs-symbol">$</span>(which docker):/usr/bin/docker jenkins/jenkins:lts<br><span class="hljs-number">9</span>b9acf0e8c13519d3bc5a96b8e7b2d251374e7112a796d2b9cc55e8ee53361a1<br><br>jenkins@<span class="hljs-number">9</span>b9acf0e8c13:/<span class="hljs-symbol">$</span> docker pull redis<br><span class="hljs-keyword">Using</span> default tag: latest<br>Got permission denied <span class="hljs-keyword">while</span> trying to connect to the Docker daemon socket at unix:<span class="hljs-comment">///var/run/docker.sock: Post &quot;http://%2Fvar%2Frun%2Fdocker.sock/v1.24/images/create?fromImage=redis&amp;tag=latest&quot;: dial unix /var/run/docker.sock: connect: permission denied</span><br>jenkins@<span class="hljs-number">9</span>b9acf0e8c13:/<span class="hljs-symbol">$</span><br><br># Build Docker Image<br><br># Push Image to DockerHub<br>  - Create DockerHub account<br>  - Configure that credentials in Jenkins<br><br># Push Docker Image to Nexus Repository<br><br># Freestyle to Pipeline Job<br>  - Freestyle Job with multiple Steps<br>    - Build Java App -&gt; Run Tests -&gt; Build Image -&gt; Push to private Repo<br><br># Pipeline Job<br>  - Pipeline script<br>    - Script is written in Groovy<br>    - Programming Language similar to Java<br><br>  - Required Fields of Jenkinsfile<br>    # pipeline must be top-level<br>    pipeline &#123;<br>        <span class="hljs-comment">// agent where to execute</span><br>        agent any<br><br>        <span class="hljs-comment">// Access Build Tools for your projects</span><br>        tools &#123;<br>          <span class="hljs-comment">// Only 3 Build tools available: gradle, maven and JDK!</span><br>        &#125;<br>        environment &#123;<br>          NEW_VERSION = <span class="hljs-string">&quot;1.0&quot;</span><br>          SERVER_CREDENTIALS = credential(<span class="hljs-string">&#x27;server-credentials&#x27;</span>)<br>        &#125;<br>        <span class="hljs-keyword">parameters</span> &#123;<br>          string(name: <span class="hljs-string">&#x27;VERSION&#x27;</span>, defaultValue: <span class="hljs-string">&#x27;&#x27;</span>, description: <span class="hljs-string">&#x27;version to deploy on prod&#x27;</span>)<br>          choice(name: <span class="hljs-string">&#x27;VERSION&#x27;</span>, choices: [<span class="hljs-string">&#x27;1.1.0&#x27;</span>, <span class="hljs-string">&#x27;1.2.0&#x27;</span>], description: <span class="hljs-string">&#x27;&#x27;</span>)<br>        &#125;<br><br>        <span class="hljs-comment">// stages - where the work happens</span><br>        stages <span class="hljs-comment">&#123;</span><br>            stage(<span class="hljs-string">&quot;build&quot;</span>) &#123;<br>              when <span class="hljs-comment">&#123;</span><br>                expression <span class="hljs-comment">&#123;</span><br>                  expression <span class="hljs-comment">&#123;</span><br>                    BRANCH_NAME <span class="hljs-comment">==</span> <span class="hljs-comment">&quot;dev&quot;</span> || <span class="hljs-comment">CODE_CHANGES == true</span><br>                  &#125;<br>                &#125;<br>              &#125;<br>                steps <span class="hljs-comment">&#123;</span><br>                  echo <span class="hljs-comment">&#x27;building the application...&#x27;</span><br>                  echo <span class="hljs-comment">&quot;building version $&#123;NEW_VERSION&#125;&quot;</span><br>                &#125;<br>            &#125;<br><br>            stage(<span class="hljs-string">&quot;test&quot;</span>) &#123;<br>              when <span class="hljs-comment">&#123;</span><br>                expression <span class="hljs-comment">&#123;</span><br>                  expression <span class="hljs-comment">&#123;</span><br>                    BRANCH_NAME <span class="hljs-comment">==</span> <span class="hljs-comment">&quot;dev&quot;</span> || <span class="hljs-comment">BRANCH_NAME ==</span> <span class="hljs-comment">&quot;master&quot;</span><br>                  &#125;<br>                &#125;<br>              &#125;<br>              steps <span class="hljs-comment">&#123;</span><br>                  echo <span class="hljs-comment">&#x27;building the application...&#x27;</span><br>              &#125;<br>            &#125;<br><br>            stage(<span class="hljs-string">&quot;deploy&quot;</span>) &#123;<br>                steps <span class="hljs-comment">&#123;</span><br>                  echo <span class="hljs-comment">&#x27;building the application...&#x27;</span><br>                  echo <span class="hljs-comment">&quot;deploying with $(SERVER_CREDENTIALS)&quot;</span><br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">// Execute some logic AFTER all stages executed</span><br>        post <span class="hljs-comment">&#123;</span><br><br>          <span class="hljs-comment">// Conditions</span><br>          always <span class="hljs-comment">&#123;</span><br><br>          &#125;<br><br>          success <span class="hljs-comment">&#123;</span><br><br>          &#125;<br><br>          failure <span class="hljs-comment">&#123;</span><br><br>          &#125;<br>        &#125;<br>    &#125;<br><br># Jenkins <span class="hljs-comment">Variables</span><br>  $ http:<span class="hljs-comment">//172.30.1.12:8080/env-vars.html/</span><br></code></pre></td></tr></table></figure></li>
<li><p>Build scripted Pipeline</p>
</li>
<li><p>Henkinsfile in detail</p>
</li>
<li><p>Configure automated versioning</p>
</li>
<li><p>Jenkins Shared Library</p>
</li>
</ul>
<h2 id="Programming"><a href="#Programming" class="headerlink" title="Programming"></a>Programming</h2><h2 id="Containers"><a href="#Containers" class="headerlink" title="Containers"></a>Containers</h2><h2 id="Container-Orchestration"><a href="#Container-Orchestration" class="headerlink" title="Container Orchestration"></a>Container Orchestration</h2><h2 id="Configuration-Management"><a href="#Configuration-Management" class="headerlink" title="Configuration Management"></a>Configuration Management</h2><h2 id="Monitoring"><a href="#Monitoring" class="headerlink" title="Monitoring"></a>Monitoring</h2><h2 id="Command-Line-Commands"><a href="#Command-Line-Commands" class="headerlink" title="Command Line Commands"></a>Command Line Commands</h2><ul>
<li><p>scp = secure copy</p>
<blockquote>
<p>scp <file locally> <destination></p>
</blockquote>
</li>
<li><p>netstat</p>
<blockquote>
<p>netstat -lpnt</p>
</blockquote>
</li>
</ul>
<h2 id="ä¸“ä¸šåè¯"><a href="#ä¸“ä¸šåè¯" class="headerlink" title="ä¸“ä¸šåè¯"></a>ä¸“ä¸šåè¯</h2><ul>
<li>LTS = Long Term Support</li>
</ul>
<h2 id="Wrap-Up-æ€»ç»“"><a href="#Wrap-Up-æ€»ç»“" class="headerlink" title="Wrap Up: æ€»ç»“"></a>Wrap Up: æ€»ç»“</h2><ul>
<li>Pipeline<br><img src="/misc/images/devops-pipeline.png" alt="Pipeline å¼€å‘æµç¨‹"></li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://www.atlassian.com/git/tutorials/atlassian-git-cheatsheet">git cheatsheet</a></li>
</ul>
]]></content>
      <categories>
        <category>DevOps</category>
      </categories>
  </entry>
  <entry>
    <title>Distribute Scraping for Gophers</title>
    <url>/2021/09/03/Distribute-Scraping-for-Gophers/</url>
    <content><![CDATA[<h1 id="åˆ†å¸ƒå¼çˆ¬è™«"><a href="#åˆ†å¸ƒå¼çˆ¬è™«" class="headerlink" title="åˆ†å¸ƒå¼çˆ¬è™«"></a>åˆ†å¸ƒå¼çˆ¬è™«</h1><blockquote>
<p>åˆ†å¸ƒå¼çˆ¬è™«æ˜¯ä¸€å¥—ä»»åŠ¡åˆ†å‘å’Œæ‰§è¡Œç³»ç»Ÿï¼Œå¸¸è§çš„ä»»åŠ¡åˆ†å‘ï¼Œå› ä¸ºä¸Šä¸‹æ¸¸å­˜åœ¨é€Ÿåº¦ä¸åŒ¹é…é—®é¢˜ï¼Œéœ€è¦å€ŸåŠ©æ¶ˆæ¯é˜Ÿåˆ—</p>
</blockquote>
<span id="more"></span>

<h2 id="åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—"><a href="#åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—"></a>åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—</h2><ul>
<li>nats<blockquote>
<p>natsæ˜¯Goå®ç°çš„é«˜æ€§èƒ½åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé€‚ç”¨äºé«˜å¹¶å‘ååé‡çš„æ¶ˆæ¯åˆ†å‘åœºæ™¯.</p>
</blockquote>
</li>
</ul>
]]></content>
      <categories>
        <category>Distributed Systems</category>
      </categories>
  </entry>
  <entry>
    <title>Elasticsearch Tips &amp; Tracks</title>
    <url>/2021/09/03/Elasticsearch-Tips-Tracks/</url>
    <content><![CDATA[<h1 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h1><blockquote>
<p>Elasticsearchæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æœç´¢ä¸åˆ†æå¼•æ“ï¼Œæä¾›è¿‘å®æ—¶æœç´¢å’ŒèšåˆåŠŸèƒ½<br>Elastic Stackä¸»è¦åº”ç”¨äºï¼šæœç´¢ã€æ—¥å¿—ç®¡ç†ã€å®‰å…¨åˆ†æã€æŒ‡æ ‡åˆ†æã€ä¸šåŠ¡åˆ†æã€åº”ç”¨æ€§èƒ½ç›‘æ§ç­‰å¤šä¸ªé¢†åŸŸ<br>â€œSearch is something that any application should have.â€</p>
</blockquote>
<span id="more"></span>

<h2 id="Elastic-Stack-ç”Ÿæ€åœˆ"><a href="#Elastic-Stack-ç”Ÿæ€åœˆ" class="headerlink" title="Elastic Stack ç”Ÿæ€åœˆ"></a>Elastic Stack ç”Ÿæ€åœˆ</h2><ul>
<li><p>è§£å†³æ–¹æ¡ˆ:</p>
<ul>
<li>æœç´¢</li>
<li>æ—¥å¿—åˆ†æ</li>
<li>æŒ‡æ ‡åˆ†æ</li>
<li>å®‰å…¨åˆ†æ</li>
</ul>
</li>
<li><p>å¯è§†åŒ–:</p>
<ul>
<li>Kibana: å¯è§†åŒ–åˆ†æ</li>
</ul>
</li>
<li><p>å­˜å‚¨/è®¡ç®—:</p>
<ul>
<li>Elasticsearch: æ ¸å¿ƒå¼•æ“,æä¾›æ•°æ®å­˜å‚¨ã€æœç´¢å’Œèšåˆçš„èƒ½åŠ›</li>
</ul>
</li>
<li><p>æ•°æ®æŠ“å–:</p>
<ul>
<li>Logstash<blockquote>
<p>å¼€æºçš„æœåŠ¡å™¨ç«¯æ•°æ®å¤„ç†ç®¡é“ï¼Œæ”¯æŒä»ä¸åŒæ¥æºé‡‡é›†æ•°æ®ï¼Œè½¬æ¢æ•°æ®ï¼Œå¹¶å°†æ•°æ®å‘é€åˆ°ä¸åŒçš„å­˜å‚¨åº“ä¸­</p>
</blockquote>
</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># ç‰¹æ€§:</span><br><span class="hljs-bullet">  1.</span> å®æ—¶è§£æå’Œè½¬æ¢æ•°æ®<br><span class="hljs-code">    &gt; ä»IPåœ°å€ç ´è¯‘åœ°ç†ä½ç½®</span><br><span class="hljs-code">    &gt; ä»PIIæ•°æ®åŒ¿ååŒ–ï¼Œæ’é™¤æ•æ„Ÿå­—æ®µ</span><br><span class="hljs-code">  2. å¯æ‰©å±•</span><br><span class="hljs-code">  3. å¯é æ€§å®‰å…¨æ€§</span><br><span class="hljs-code">    &gt; Logstash é€šè¿‡æŒä¹…åŒ–é˜Ÿåˆ—ä¿è¯è‡³å°‘å°†è¿è¡Œä¸­çš„äº‹ä»¶é€è¾¾ä¸€æ¬¡</span><br><span class="hljs-code">    &gt; æ•°æ®ä¼ è¾“åŠ å¯†</span><br><span class="hljs-code">  4. åŠ å¯†</span><br></code></pre></td></tr></table></figure>

<ul>
<li>Beats<blockquote>
<p>è½»é‡çº§åˆ«æ•°æ®é‡‡é›†å™¨</p>
</blockquote>
</li>
</ul>
</li>
<li><p>X-Pack: å•†ä¸šåŒ–å¥—ä»¶</p>
</li>
</ul>
<blockquote>
<p>Elasticsearchä¸æ•°æ®åº“çš„é›†æˆ</p>
</blockquote>
<p><img src="/misc/images/Elastichsearch.png" alt="Elastichsearch"></p>
<blockquote>
<p>æŒ‡æ ‡åˆ†æ/æ—¥å¿—åˆ†æ</p>
</blockquote>
<ul>
<li>Data Collection(beats) -&gt; Buffering(redis,Kafkak) -&gt; Data Aggregation &amp; Processing(logstash) -&gt; Indexing &amp; storage(elasticsearch) -&gt; Analysis &amp; visualization(Kbana)</li>
</ul>
<h2 id="Elasticsearch-1"><a href="#Elasticsearch-1" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h2><ul>
<li><p>Elasticsearch ç›®å½•ç»“æ„</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><code class="hljs ada">ubuntu <span class="hljs-keyword">in</span> ~/elasticsearch-<span class="hljs-number">7.14</span>.<span class="hljs-number">1</span> <span class="hljs-keyword">at</span> k8s-node1 took <span class="hljs-number">45</span>s<br>âœ tree -L <span class="hljs-number">1</span><br>.<br>â”œâ”€â”€ bin                 <span class="hljs-comment">-- è„šæœ¬æ–‡ä»¶ï¼ŒåŒ…æ‹¬å¯åŠ¨elasticsearch,å®‰è£…æ’ä»¶ï¼Œè¿è¡Œç»Ÿè®¡æ•°æ®</span><br>â”œâ”€â”€ config              <span class="hljs-comment">-- elasticsearch.yml é›†ç¾¤é…ç½®æ–‡ä»¶ï¼Œuser, role based ç›¸å…³é…ç½®</span><br>â”œâ”€â”€ jdk                 <span class="hljs-comment">-- Java è¿è¡Œç¯å¢ƒ</span><br>â”œâ”€â”€ lib                 <span class="hljs-comment">-- Java ç±»åº“</span><br>â”œâ”€â”€ LICENSE.txt<br>â”œâ”€â”€ logs                <span class="hljs-comment">-- path.log æ—¥å¿—æ–‡ä»¶</span><br>â”œâ”€â”€ modules             <span class="hljs-comment">-- åŒ…å«æ‰€æœ‰ESæ¨¡å—</span><br>â”œâ”€â”€ NOTICE.txt<br>â”œâ”€â”€ plugins             <span class="hljs-comment">-- åŒ…å«æ‰€æœ‰å·²å®‰è£…æ’ä»¶</span><br>â””â”€â”€ README.asciidoc<br></code></pre></td></tr></table></figure></li>
<li><p>JVM é…ç½®</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><code class="hljs gcode"><span class="hljs-attr"># ä¿®æ”¹JVM - config/jvm.options</span><br><span class="hljs-attr">  -Xmså’ŒXms æœ€å°æœ€å¤§å†…å­˜è®¾ç½®æˆä¸€æ ·</span><br><span class="hljs-attr">  -Xmxä¸è¶…è¿‡æœºå™¨å†…å­˜çš„50</span><span class="hljs-meta">%</span><br></code></pre></td></tr></table></figure></li>
<li><p>Run</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><code class="hljs 1c">$ bin/elasticsearch<br><span class="hljs-symbol">~ took 11m 31s</span><br><span class="hljs-symbol">âœ curl http</span>:<span class="hljs-comment">//localhost:9200</span><br>&#123;<br>  <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;a714f28827d5&quot;</span>,<br>  <span class="hljs-string">&quot;cluster_name&quot;</span> : <span class="hljs-string">&quot;docker-cluster&quot;</span>,<br>  <span class="hljs-string">&quot;cluster_uuid&quot;</span> : <span class="hljs-string">&quot;96jmRuNUQxqFsGeWJjIo6g&quot;</span>,<br>  <span class="hljs-string">&quot;version&quot;</span> : &#123;<br>    <span class="hljs-string">&quot;number&quot;</span> : <span class="hljs-string">&quot;7.14.1&quot;</span>,<br>    <span class="hljs-string">&quot;build_flavor&quot;</span> : <span class="hljs-string">&quot;default&quot;</span>,<br>    <span class="hljs-string">&quot;build_type&quot;</span> : <span class="hljs-string">&quot;docker&quot;</span>,<br>    <span class="hljs-string">&quot;build_hash&quot;</span> : <span class="hljs-string">&quot;66b55ebfa59c92c15db3f69a335d500018b3331e&quot;</span>,<br>    <span class="hljs-string">&quot;build_date&quot;</span> : <span class="hljs-string">&quot;2021-08-26T09:01:05.390870785Z&quot;</span>,<br>    <span class="hljs-string">&quot;build_snapshot&quot;</span> : false,<br>    <span class="hljs-string">&quot;lucene_version&quot;</span> : <span class="hljs-string">&quot;8.9.0&quot;</span>,<br>    <span class="hljs-string">&quot;minimum_wire_compatibility_version&quot;</span> : <span class="hljs-string">&quot;6.8.0&quot;</span>,<br>    <span class="hljs-string">&quot;minimum_index_compatibility_version&quot;</span> : <span class="hljs-string">&quot;6.0.0-beta1&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;tagline&quot;</span> : <span class="hljs-string">&quot;You Know, for Search&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>Plugin æœºåˆ¶å¯¹ç³»ç»Ÿæ‰©å±•</p>
<blockquote>
<p>Discovery Plugin<br>Analysis Plugin<br>Security Plugin<br>Management Plugin<br>Ingest Plugin<br>Mapper Plugin<br>Backup Plugin</p>
</blockquote>
<figure class="highlight clean"><table><tr><td class="code"><pre><code class="hljs clean">ubuntu <span class="hljs-keyword">in</span> ~ at k8s-node1 via ğŸ <span class="hljs-number">3.8</span><span class="hljs-number">.6</span><br>âœ elasticsearch-plugin install analysis-icu  # åˆ†è¯æ’ä»¶<br>-&gt; Installing analysis-icu<br>-&gt; Downloading analysis-icu <span class="hljs-keyword">from</span> elastic<br>[=================================================] <span class="hljs-number">100</span>%<br>-&gt; Installed analysis-icu<br>-&gt; Please restart Elasticsearch to activate any plugins installed<br><br>ubuntu <span class="hljs-keyword">in</span> ~ at k8s-node1 via ğŸ <span class="hljs-number">3.8</span><span class="hljs-number">.6</span> took <span class="hljs-number">23</span>s<br>âœ elasticsearch-plugin list<br>analysis-icu<br><br>ubuntu <span class="hljs-keyword">in</span> ~ at k8s-node1 via ğŸ <span class="hljs-number">3.8</span><span class="hljs-number">.6</span><br>âœ curl http:<span class="hljs-comment">//localhost:9200/_cat/plugins</span><br>k8s-node1 analysis-icu <span class="hljs-number">7.14</span><span class="hljs-number">.1</span><br></code></pre></td></tr></table></figure></li>
<li><p>å¤šé›†ç¾¤<br><a href="/misc/code/elasticsearch/docker-compose.yml">docker-compose.yml</a></p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><code class="hljs accesslog">âœ curl -X GET <span class="hljs-string">&quot;localhost:9200/_cat/nodes?v=true&amp;pretty&quot;</span><br>ip         heap.percent ram.percent cpu load_1m load_5m load_15m node.role   master name<br><span class="hljs-number">172.24.0.2</span>           <span class="hljs-number">41</span>          <span class="hljs-number">97</span>  <span class="hljs-number">85</span>    <span class="hljs-number">4</span>.<span class="hljs-number">28</span>    <span class="hljs-number">1</span>.<span class="hljs-number">24</span>     <span class="hljs-number">0</span>.<span class="hljs-number">43</span> cdfhilmrstw -      es01<br><span class="hljs-number">172.24.0.3</span>           <span class="hljs-number">56</span>          <span class="hljs-number">97</span>  <span class="hljs-number">85</span>    <span class="hljs-number">4</span>.<span class="hljs-number">28</span>    <span class="hljs-number">1</span>.<span class="hljs-number">24</span>     <span class="hljs-number">0</span>.<span class="hljs-number">43</span> cdfhilmrstw -      es03<br><span class="hljs-number">172.24.0.4</span>           <span class="hljs-number">27</span>          <span class="hljs-number">97</span>  <span class="hljs-number">85</span>    <span class="hljs-number">4</span>.<span class="hljs-number">28</span>    <span class="hljs-number">1</span>.<span class="hljs-number">24</span>     <span class="hljs-number">0</span>.<span class="hljs-number">43</span> cdfhilmrstw *      es02<br></code></pre></td></tr></table></figure></li>
<li><p>Kibana:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> <span class="hljs-built_in">curl</span> http://localhost:<span class="hljs-number">5601</span><br><br><span class="hljs-comment"># Kibana Plugins æ’ä»¶</span><br><span class="hljs-variable">$</span> kibana<span class="hljs-literal">-plugin</span> install<br><span class="hljs-variable">$</span> kibana<span class="hljs-literal">-plugin</span> list<br><span class="hljs-variable">$</span> kibana remove<br></code></pre></td></tr></table></figure></li>
<li><p>Logstash:</p>
<figure class="highlight"><table><tr><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Elasticsearch-åŸºæœ¬æ¦‚å¿µ"><a href="#Elasticsearch-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="Elasticsearch åŸºæœ¬æ¦‚å¿µ"></a>Elasticsearch åŸºæœ¬æ¦‚å¿µ</h2><ul>
<li><p>æ–‡æ¡£ Document</p>
<blockquote>
<p>Elasticsearch æ˜¯é¢å‘æ–‡æ¡£çš„ï¼Œæ–‡æ¡£æ˜¯æ‰€æœ‰å¯æœç´¢æ•°æ®çš„æœ€å°å•ä½<br>æ–‡æ¡£ä¼šè¢«åºåˆ—åŒ–æˆJSONæ ¼å¼ï¼Œä¿å­˜åœ¨Elasticsearchä¸­<br>æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰ä¸€ä¸ªUnique ID</p>
</blockquote>
<figure class="highlight elm"><table><tr><td class="code"><pre><code class="hljs elm"># æ–‡æ¡£å…ƒæ•°æ®<span class="hljs-type">Metadata</span> - æ ‡æ³¨æ–‡æ¡£çš„ç›¸å…³ä¿¡æ¯<br>  _index - æ–‡æ¡£æ‰€å±çš„ç´¢å¼•å<br>  _<span class="hljs-keyword">type</span>  - æ–‡æ¡£æ‰€å±ç±»å‹å<br>  _id    - æ–‡æ¡£å”¯ä¸€<span class="hljs-type">ID</span><br>  _source - æ–‡æ¡£åŸå§‹<span class="hljs-type">JSON</span>æ•°æ®<br>  _version - æ–‡æ¡£çš„ç‰ˆæœ¬ä¿¡æ¯ <span class="hljs-comment">-- è§£å†³å¹¶å‘è¯»å†™å†²çª</span><br>  _score  - ç›¸å…³æ€§æ‰“åˆ†<br></code></pre></td></tr></table></figure></li>
<li><p>ç´¢å¼• Index</p>
<blockquote>
<p>å°†æ–‡æ¡£å†™å…¥Elasticsearchçš„è¿‡ç¨‹å«ç´¢å¼•indexing</p>
</blockquote>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">Mapping:</span> å®šä¹‰åŒ…å«çš„æ–‡æ¡£çš„å­—æ®µåå’Œå­—æ®µç±»å‹<br><span class="hljs-symbol">Setting:</span> å®šä¹‰ä¸åŒæ•°æ®åˆ†å¸ƒ<br><span class="hljs-symbol">Shard:</span> ç´¢å¼•ä¸­çš„æ•°æ®åˆ†æ•£åœ¨Shardsä¸Š<br></code></pre></td></tr></table></figure></li>
<li><p>èŠ‚ç‚¹ Node</p>
<blockquote>
<p>èŠ‚ç‚¹æ˜¯Elasticsearch å®ä¾‹</p>
</blockquote>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><code class="hljs crmsh">-E node.<span class="hljs-attr">name=</span>node1<br>æ¯ä¸ªèŠ‚ç‚¹å¯åŠ¨åï¼Œä¼šåˆ†é…ä¸€ä¸ªUIDï¼Œä¿å­˜åœ¨dataç›®å½•ä¸‹<br><br><span class="hljs-comment"># Master-eligible nodes å’Œ Master Node</span><br>  <span class="hljs-number">1</span>. èŠ‚ç‚¹å¯åŠ¨é»˜è®¤æ˜¯ä¸€ä¸ª<span class="hljs-literal">Master</span>-eligibleèŠ‚ç‚¹, -E node.<span class="hljs-literal">master</span>:<span class="hljs-literal">false</span> ç¦æ­¢<br>  <span class="hljs-number">2</span>. <span class="hljs-literal">Master</span>-eligibleèŠ‚ç‚¹å¯ä»¥å‚åŠ é€‰ä¸»æµç¨‹ï¼Œç§°ä¸º<span class="hljs-literal">Master</span>èŠ‚ç‚¹<br>  <span class="hljs-number">3</span>. æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¿å­˜é›†ç¾¤çŠ¶æ€ï¼Œåªæœ‰<span class="hljs-literal">master</span>èŠ‚ç‚¹æ‰èƒ½ä¿®æ”¹é›†ç¾¤çŠ¶æ€<br><br><span class="hljs-comment"># é›†ç¾¤çŠ¶æ€ Cluster State</span><br>  <span class="hljs-number">1</span>. æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯<br>  <span class="hljs-number">2</span>. æ‰€æœ‰çš„ç´¢å¼•å’Œç›¸å…³Mapping ä¸ Settingä¿¡æ¯<br>  <span class="hljs-number">3</span>. åˆ†ç‰‡çš„è·¯ç”±ä¿¡æ¯<br><br><span class="hljs-comment"># Data Node &amp; Coordinating Node</span><br>  <span class="hljs-number">1</span>. Data <span class="hljs-keyword">Node</span><span class="hljs-title">: å¯ä»¥ä¿å­˜æ•°æ®çš„èŠ‚ç‚¹ï¼Œä¿å­˜åˆ†ç‰‡æ•°æ®</span><br><span class="hljs-title">  2</span>. Coordinating <span class="hljs-keyword">Node</span><span class="hljs-title">: è´Ÿè´£æ¥å—Client</span>è¯·æ±‚ï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°åˆé€‚çš„èŠ‚ç‚¹ï¼Œæœ€ç»ˆæŠŠç»“æœæ±‡é›†åˆ°ä¸€èµ·<br><br><span class="hljs-comment"># Hot &amp; Warm Node</span><br><span class="hljs-comment"># Machine Learning Node</span><br><span class="hljs-comment"># Tribe Node</span><br></code></pre></td></tr></table></figure></li>
<li><p>åˆ†ç‰‡ Primary Shard &amp; Replica Shard</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section">#ä¸»åˆ†ç‰‡: è§£å†³æ•°æ®æ°´å¹³æ‰©å±•çš„é—®é¢˜</span><br><span class="hljs-bullet">  1.</span> ä¸€ä¸ªåˆ†ç‰‡æ˜¯ä¸€ä¸ªè¿è¡Œçš„Luceneçš„å®ä¾‹<br><span class="hljs-bullet">  2.</span> ä¸»åˆ†ç‰‡åœ¨ç´¢å¼•åˆ›å»ºæ—¶æŒ‡å®šï¼Œåç»­ä¸å…è®¸ä¿®æ”¹,ä½¿ç”¨ Reindexä¿®æ”¹<br><br><span class="hljs-section">#å‰¯æœ¬: è§£å†³æ•°æ®é«˜å¯ç”¨çš„é—®é¢˜</span><br><span class="hljs-bullet">  1.</span> å‰¯æœ¬åˆ†ç‰‡æ•°ï¼Œå¯ä»¥åŠ¨æ€è°ƒæ•´<br><span class="hljs-bullet">  2.</span> å¢åŠ å‰¯æœ¬æ•°ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜æœåŠ¡çš„å¯ç”¨æ€§ (è¯»å–çš„åå)<br><br><span class="hljs-section">#åˆ†ç‰‡è®¾å®š-å®¹é‡è§„åˆ’</span><br><span class="hljs-bullet">  1.</span> åˆ†ç‰‡æ•°è®¾ç½®è¿‡å°:<br><span class="hljs-code">    a. åç»­æ— æ³•å¢åŠ èŠ‚ç‚¹å®ç°æ°´å¹³æ‰©å±•</span><br><span class="hljs-code">    b. å•ä¸ªåˆ†ç‰‡çš„æ•°æ®é‡è¿‡å¤§ï¼Œå¯¼è‡´æ•°æ®é‡æ–°åˆ†é…è€—æ—¶</span><br><span class="hljs-code">  2. åˆ†ç‰‡è®¾ç½®è¿‡å¤§:</span><br><span class="hljs-code">    a. å½±å“æœç´¢ç»“æœçš„ç›¸å…³æ€§æ‰“åˆ†ï¼Œå½±å“ç»Ÿè®¡ç»“æœå‡†ç¡®æ€§</span><br><span class="hljs-code"></span><br><span class="hljs-section"># æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</span><br>  Green: ä¸»åˆ†ç‰‡å’Œå‰¯ç‰‡æ­£å¸¸<br>  Yellow: ä¸»åˆ†ç‰‡æ­£å¸¸ï¼Œå‰¯ç‰‡ä¸æ­£å¸¸<br>  Red: ä¸»åˆ†ç‰‡æœªèƒ½åˆ†é…<br></code></pre></td></tr></table></figure></li>
<li><p>Elasticsearch vs å…³ç³»å‹æ•°æ®åº“ æŠ½è±¡ä¸ç±»æ¯”</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">RDBMS</th>
<th align="left">Elasticsearch</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Table</td>
<td align="left">Index</td>
</tr>
<tr>
<td align="left">Row</td>
<td align="left">Document</td>
</tr>
<tr>
<td align="left">Column</td>
<td align="left">Field</td>
</tr>
<tr>
<td align="left">Schema</td>
<td align="left">Mapping</td>
</tr>
<tr>
<td align="left">SQL</td>
<td align="left">DSL</td>
</tr>
</tbody></table>
<ul>
<li><p>æ–‡æ¡£Document CRUD</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>create document. è‡ªåŠ¨ç”Ÿæˆ_id<br>POST users/_doc<br>&#123;<br>  <span class="hljs-string">&quot;user&quot;</span>: <span class="hljs-string">&quot;Mike&quot;</span>,<br>  <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;trying out Kibana&quot;</span><br>&#125;<br><br><span class="hljs-regexp">//</span>create document. æŒ‡å®šId, å¦‚æœIDå·²ç»å­˜åœ¨ï¼ŒæŠ¥é”™<br>PUT users<span class="hljs-regexp">/_doc/</span><span class="hljs-number">1</span>?op_type=create<br>&#123;<br>  <span class="hljs-string">&quot;user&quot;</span>: <span class="hljs-string">&quot;Jack&quot;</span>,<br>  <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;trying out Elasticsearch&quot;</span><br>&#125;<br><br><span class="hljs-regexp">//</span>create document. æŒ‡å®šId, å¦‚æœIDå·²ç»å­˜åœ¨ï¼ŒæŠ¥é”™<br>PUT users<span class="hljs-regexp">/_create/</span><span class="hljs-number">1</span><br>&#123;<br>  <span class="hljs-string">&quot;user&quot;</span>: <span class="hljs-string">&quot;Jack&quot;</span>,<br>  <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;trying out Elasticsearch&quot;</span><br>&#125;<br><br><span class="hljs-regexp">//</span> Get the document by ID<br>GET users<span class="hljs-regexp">/_doc/</span><span class="hljs-number">1</span><br><br><span class="hljs-regexp">//</span> Index<br>PUT users<span class="hljs-regexp">/_doc/</span><span class="hljs-number">1</span><br>&#123;<br>  <span class="hljs-string">&quot;user&quot;</span>: <span class="hljs-string">&quot;Mike&quot;</span><br>&#125;<br><br><span class="hljs-regexp">//</span>Update åœ¨åŸæ–‡æ¡£ä¸Šå¢åŠ å­—æ®µ<br>POST users<span class="hljs-regexp">/_update/</span><span class="hljs-number">1</span>/<br>&#123;<br>  <span class="hljs-string">&quot;doc&quot;</span>:&#123;<br>    <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;trying out Elasticsearch 3&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><ul>
<li>Bulk API<figure class="highlight n1ql"><table><tr><td class="code"><pre><code class="hljs n1ql">1. æ”¯æŒåœ¨ä¸€æ¬¡APIè°ƒç”¨ä¸­ï¼Œå¯¹ä¸åŒçš„ç´¢å¼•è¿›è¡Œæ“ä½œ<br>2. æ”¯æŒå››ç§ç±»å‹æ“ä½œ:<br>  <span class="hljs-keyword">Index</span><br>  <span class="hljs-keyword">Create</span><br>  <span class="hljs-keyword">Update</span><br>  <span class="hljs-keyword">Delete</span><br><span class="hljs-number">3.</span> æ“ä½œå•æ¡æ“ä½œå¤±è´¥ï¼Œä¸ä¼šå½±å“å…¶ä»–æ“ä½œ<br><span class="hljs-number">4.</span> è¿”å›ç»“æœåŒ…æ‹¬æ¯ä¸€æ¡æ“ä½œçš„æ‰§è¡Œç»“æœ<br><br>//Bulkæ“ä½œ<br>POST _bulk<br>&#123;<span class="hljs-string">&quot;index&quot;</span>: &#123;<span class="hljs-string">&quot;_index&quot;</span>: <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;_id&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>&#125;&#125;<br>&#123;<span class="hljs-string">&quot;field1&quot;</span>: <span class="hljs-string">&quot;value1&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;delete&quot;</span>: &#123;<span class="hljs-string">&quot;_index&quot;</span>: <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;_id&quot;</span>: <span class="hljs-string">&quot;2&quot;</span>&#125;&#125;<br>&#123;<span class="hljs-string">&quot;create&quot;</span>: &#123;<span class="hljs-string">&quot;_index&quot;</span>: <span class="hljs-string">&quot;test2&quot;</span>, <span class="hljs-string">&quot;_id&quot;</span>: <span class="hljs-string">&quot;3&quot;</span>&#125;&#125;<br>&#123;<span class="hljs-string">&quot;field1&quot;</span>: <span class="hljs-string">&quot;value3&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;update&quot;</span>: &#123;<span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;_index&quot;</span>: <span class="hljs-string">&quot;test&quot;</span>&#125;&#125;<br>&#123;<span class="hljs-string">&quot;doc&quot;</span>: &#123;<span class="hljs-string">&quot;field2&quot;</span>: <span class="hljs-string">&quot;value2&quot;</span>&#125;&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>mget</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//mg</span>et -- æ‰¹é‡è¯»å–<br><span class="hljs-regexp">//</span>å¯ä»¥å‡å°‘ç½‘ç»œè¿æ¥ï¼Œæé«˜æ€§èƒ½<br>GET _mget<br>&#123;<br>  <span class="hljs-string">&quot;docs&quot;</span>: [<br>    &#123;<span class="hljs-string">&quot;_index&quot;</span>: <span class="hljs-string">&quot;users&quot;</span>, <span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-number">1</span>&#125;,<br>    &#123;<span class="hljs-string">&quot;_index&quot;</span>: <span class="hljs-string">&quot;comment&quot;</span>, <span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-number">1</span>&#125;<br>    ]<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Elasticsearch-åŸç†"><a href="#Elasticsearch-åŸç†" class="headerlink" title="Elasticsearch åŸç†"></a>Elasticsearch åŸç†</h2><ul>
<li>å›¾ä¹¦å’Œæœç´¢å¼•æ“ç±»æ¯”</li>
</ul>
<table>
<thead>
<tr>
<th align="left">Type</th>
<th align="left">æ­£æ’ç´¢å¼•</th>
<th align="left">å€’æ’ç´¢å¼•</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å›¾ä¹¦</td>
<td align="left">ç›®å½•é¡µ</td>
<td align="left">ç´¢å¼•é¡µ</td>
</tr>
<tr>
<td align="left">æœç´¢å¼•æ“</td>
<td align="left">æ–‡æ¡£ID-&gt;æ–‡æ¡£å†…å®¹å’Œå•è¯çš„å…³è”</td>
<td align="left">å•è¯åˆ°æ–‡æ¡£IDçš„å…³ç³»</td>
</tr>
</tbody></table>
<ul>
<li><p>Elasticsearch å€’æ’ç´¢å¼•</p>
<blockquote>
<p>Elasticsearchçš„JSONæ–‡æ¡£ä¸­æ¯ä¸ªå­—æ®µï¼Œéƒ½æœ‰è‡ªå·±çš„å€’æ’ç´¢å¼•</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># å•è¯è¯å…¸(Term Dictionary)</span><br><span class="hljs-quote">&gt; è®°å½•æ‰€æœ‰æ–‡æ¡£çš„å•è¯ï¼Œè®°å½•å•è¯åˆ°å€’æ’åˆ—è¡¨çš„å…³è”å…³ç³»</span><br><span class="hljs-quote">&gt; é€šè¿‡B+æ ‘æˆ–å“ˆå¸Œé“¾è¡¨å®ç°ï¼Œæ»¡è¶³é«˜æ€§èƒ½çš„æ’å…¥ä¸æŸ¥è¯¢</span><br><br><span class="hljs-section"># å€’æ’åˆ—è¡¨(Posting List)</span><br><span class="hljs-quote">&gt; è®°å½•å•è¯å¯¹åº”çš„æ–‡æ¡£ç»“åˆ</span><br><span class="hljs-bullet">  -</span> å€’æ’ç´¢å¼•é¡¹(Posting)<br><span class="hljs-bullet">    -</span> æ–‡æ¡£ID<br><span class="hljs-bullet">    -</span> è¯é¢‘TF - å•è¯åœ¨æ–‡æ¡£å‡ºç°çš„æ¬¡æ•°<br><span class="hljs-bullet">    -</span> ä½ç½®Position - å•è¯åœ¨æ–‡æ¡£ä¸­åˆ†è¯çš„ä½ç½®ï¼Œç”¨äºè¯­å¥æœç´¢ phrase query<br><span class="hljs-bullet">    -</span> åç§»Offset - è®°å½•å•è¯çš„å¼€å§‹ç»“æŸä½ç½®ï¼Œå®ç°é«˜é‡æ˜¾ç¤º<br></code></pre></td></tr></table></figure></li>
<li><p>Elasticsearch åˆ†è¯å™¨</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># Analysis</span><br>  - Analysis: æ–‡æœ¬åˆ†ææ˜¯æŠŠå…¨æ–‡æœ¬è½¬æ¢ä¸€ç³»åˆ—å•è¯ term/tokençš„è¿‡ç¨‹<br>  - Analysisæ˜¯é€šè¿‡Analyzerå®ç°<br><br><span class="hljs-comment"># Analyzer:</span><br>  - Character Filters: é’ˆå¯¹åŸå§‹æ–‡æœ¬å¤„ç†<br>    - HTML strip - å»é™¤htmlæ ‡ç­¾<br>    - Mapping - å­—ç¬¦ä¸²æ›¿æ¢<br>    - Pattern repalce - æ­£åˆ™åŒ¹é…æ›¿æ¢<br><br>  - Tokenizer: å°†åŸå§‹çš„æ–‡æœ¬æŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼Œåˆ‡åˆ†ä¸ºè¯ term or token<br>    - whitespace<br>    - standard<br>    - uax_url_email<br>    - pattern<br>    - keyward<br>    - path hierarchy<br><br>  - Token Filter: å°†åˆ‡åˆ†çš„å•è¯è¿›è¡ŒåŠ å·¥ï¼Œå°å†™ï¼Œåˆ é™¤stopwords,å¢åŠ åŒä¹‰è¯<br>    - Lowercase<br>    - stop<br><br><span class="hljs-comment"># Elasticsearchå†…ç½®åˆ†è¯å™¨</span><br><span class="hljs-regexp">//</span>é»˜è®¤åˆ†è¯å™¨ standard<br><span class="hljs-regexp">//</span> æŒ‰è¯åˆ‡åˆ†ï¼Œå°å†™å¤„ç†<br>GET _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;standard&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span><br>&#125;<br><br><span class="hljs-regexp">//</span>Simple Analyzer<br><span class="hljs-regexp">//</span> æŒ‰ç…§éå­—æ¯åˆ‡åˆ†ï¼Œéå­—æ¯è¢«å»é™¤<br><span class="hljs-regexp">//</span> å°å†™å¤„ç†<br>GET _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;simple&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span><br>&#125;<br><br><span class="hljs-regexp">//</span> Whitespace Analyzer<br><span class="hljs-regexp">//</span> æŒ‰ç…§ç©ºæ ¼åˆ‡åˆ†<br>GET _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;whitespace&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span><br>&#125;<br><br><span class="hljs-regexp">//</span> Stop Analyzer<br><span class="hljs-regexp">//</span> stop filter: å»é™¤the, a, is ä¿®é¥°æ€§è¯<br>GET _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;stop&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span><br>&#125;<br><br><span class="hljs-regexp">//</span>Keyward Analyzer<br><span class="hljs-regexp">//</span>ä¸åˆ†è¯ï¼Œç›´æ¥å°†è¾“å…¥å½“è¾“å‡º<br>GET _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span><br>&#125;<br><br><span class="hljs-regexp">//</span>æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œåˆ†è¯<br><span class="hljs-regexp">//</span>é»˜è®¤éå­—ç¬¦çš„ç¬¦å·è¿›è¡Œåˆ†éš”<br>GET _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;pattern&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span><br>&#125;<br><br><span class="hljs-regexp">//</span>english<br>GET _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;english&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span><br>&#125;<br><br><span class="hljs-regexp">//</span> analysis_icu<br><span class="hljs-regexp">//</span> elasticsearch-plugin install analysis_icu<br>POST _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;icu_analyzer&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>:<span class="hljs-string">&quot;ä»–è¯´çš„ç¡®å®åœ¨ç†&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>Search API</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># URI Search - é€šè¿‡URI queryå®ç°æœç´¢</span><br>  q: æŒ‡å®šæŸ¥è¯¢è¯­å¥, ä½¿ç”¨Query String Syntax<br>  df: é»˜è®¤å­—æ®µ, ä¸æŒ‡å®šä¼šå¯¹æ‰€æœ‰å­—æ®µè¿›è¡ŒæŸ¥è¯¢<br>  Sort: æ’åº/from å’Œ size ç”¨äºåˆ†é¡µ<br>  Profile: æŸ¥çœ‹æŸ¥è¯¢æ˜¯å¦‚ä½•è¢«æ‰§è¡Œ<br><br>  <span class="hljs-number">1</span>. æŒ‡å®šå­—æ®µ vs. æ³›æŸ¥è¯¢<br>  <span class="hljs-regexp">//</span>å¸¦profile æ™®é€šæŸ¥è¯¢<br>  GET <span class="hljs-regexp">/movies/</span>_search?q=<span class="hljs-number">2012</span>&amp;df=title<br>  &#123;<br>    <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-string">&quot;true&quot;</span><br>  &#125;<br><br>  <span class="hljs-regexp">//</span>å¸¦profile æ³›æŸ¥è¯¢<br>  GET <span class="hljs-regexp">/movies/</span>_search?q=<span class="hljs-number">2012</span><br>  &#123;<br>    <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-string">&quot;true&quot;</span><br>  &#125;<br><br>  <span class="hljs-regexp">//</span>å¸¦profile æŒ‡å®šå­—æ®µ<br>  GET <span class="hljs-regexp">/movies/</span>_search?q=title:<span class="hljs-number">2012</span><br>  &#123;<br>    <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-string">&quot;true&quot;</span><br>  &#125;<br><br>  <span class="hljs-number">2</span>. Term vs. Phrase<br>    <span class="hljs-comment"># Term: Beautiful Mind ç­‰æ•ˆäº Beautiful OR Mind</span><br>    <span class="hljs-comment"># Phrase: &quot;Beautifuk Mind&quot; ç­‰æ•ˆäº Beautiful And Mind, å‰åé¡ºåºä¿æŒä¸€è‡´</span><br>  <span class="hljs-regexp">//</span>ä½¿ç”¨å¼•å· æŸ¥è¯¢<br>  GET <span class="hljs-regexp">/movies/</span>_search?q=title:<span class="hljs-string">&quot;Beautiful Mind&quot;</span><br>  &#123;<br>    <span class="hljs-string">&quot;profile&quot;</span>:<span class="hljs-string">&quot;true&quot;</span><br>  &#125;<br><br>  <span class="hljs-regexp">//</span>ä½¿ç”¨å¼•å· Mind æ³› æŸ¥è¯¢<br>  GET <span class="hljs-regexp">/movies/</span>_search?q=title:Beautiful Mind<br>  &#123;<br>    <span class="hljs-string">&quot;profile&quot;</span>:<span class="hljs-string">&quot;true&quot;</span><br>  &#125;<br><br>  <span class="hljs-regexp">//</span>ä½¿ç”¨å¼•å· Bool æ³› æŸ¥è¯¢<br>  GET <span class="hljs-regexp">/movies/</span>_search?q=title:(Beautiful Mind)<br>  &#123;<br>    <span class="hljs-string">&quot;profile&quot;</span>:<span class="hljs-string">&quot;true&quot;</span><br>  &#125;<br><br>  <span class="hljs-number">3</span>. å¸ƒå°”æ“ä½œ<br>    AND <span class="hljs-regexp">/ OR /</span> NOT æˆ–è€… &amp;&amp; <span class="hljs-regexp">/ || /</span> !<br>    title:(matrix NOT reloaded)<br><br>  <span class="hljs-number">4</span>. åˆ†ç»„<br>    + è¡¨ç¤º must<br>    - è¡¨ç¤º must_not<br>    title:(+matrix -reloaded)<br><br>  <span class="hljs-number">5</span>. èŒƒå›´æŸ¥è¯¢<br>    []é—­åŒºé—´ &#123;&#125;å¼€åŒºé—´<br><br>  <span class="hljs-number">6</span>. ç®—æ•°ç¬¦å·<br>    year:&gt;<span class="hljs-number">2010</span><br><br>  <span class="hljs-number">7</span>. é€šé…ç¬¦æŸ¥è¯¢(é€šé…ç¬¦æŸ¥è¯¢æ•ˆç‡ä½ï¼Œå ç”¨å†…å­˜å¤§ï¼Œä¸å»ºè®®ä½¿ç”¨)<br>    ? ä»£è¡¨<span class="hljs-number">1</span>ä¸ªå­—ç¬¦<br>    * ä»£è¡¨<span class="hljs-number">0</span>æˆ–å¤šä¸ªå­—ç¬¦<br><br>  <span class="hljs-number">8</span>. æ­£åˆ™è¡¨è¾¾å¼<br>    title:[bt]oy<br><br>  <span class="hljs-number">9</span>. æ¨¡ç³ŠåŒ¹é…ä¸è¿‘ä¼¼æŸ¥è¯¢<br>    title:befutifl~<span class="hljs-number">1</span><br><br><span class="hljs-comment"># Request Body Search</span><br>  <span class="hljs-number">1</span>. åˆ†é¡µ:<br>    from, size<br><br>  <span class="hljs-number">2</span>. sort:<br><br>  <span class="hljs-number">3</span>. _source filtering: å¦‚æœ_sourceæ²¡æœ‰å­˜å‚¨ï¼Œå°±åªè¿”å›åŒ¹é…çš„æ–‡æ¡£çš„å…ƒæ•°æ®<br><br>  <span class="hljs-number">4</span>. è„šæœ¬å­—æ®µ:<br><br>  <span class="hljs-number">5</span>. æŸ¥è¯¢è¡¨è¾¾å¼ - Match<br><br>  <span class="hljs-number">6</span>. Match<br><br><span class="hljs-comment"># Page Rankç®—æ³•</span><br>  <span class="hljs-number">1</span>. è¡¡é‡ç›¸å…³æ€§ Information Retrieval<br>    a. Precision (æŸ¥å‡†ç‡) - å°½å¯èƒ½è¿”å›è¾ƒå°‘çš„æ— å…³æ–‡æ¡£<br>    b. Recall(æŸ¥å…¨ç‡)     - å°½é‡è¿”å›è¾ƒå¤šçš„ç›¸å…³æ–‡æ¡£<br>    c. Ranking            - æ˜¯å¦èƒ½å¤ŸæŒ‰ç…§ç›¸å…³åº¦è¿›è¡Œæ’åº<br></code></pre></td></tr></table></figure></li>
<li><p>Mapping</p>
<blockquote>
<p>ç±»ä¼¼æ•°æ®åº“ä¸­çš„scehmaå®šä¹‰</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">1.</span> å®šä¹‰ç´¢å¼•ä¸­çš„å­—æ®µåç§°<br><span class="hljs-number">2.</span> å®šä¹‰å­—æ®µçš„æ•°æ®ç±»å‹<br><span class="hljs-keyword">Mapping</span> æŠŠ<span class="hljs-type">JSON</span>æ–‡æ¡£æ˜ å°„æˆLuceneæ‰€éœ€è¦çš„æ‰å¹³æ ¼å¼<br>ä¸€ä¸ª<span class="hljs-keyword">Mapping</span>å±äºä¸€ä¸ªç´¢å¼•çš„<span class="hljs-keyword">type</span><br><br># å››ç§ä¸åŒçº§åˆ«çš„<span class="hljs-keyword">Index</span> <span class="hljs-keyword">Options</span> - æ§åˆ¶å€’æ’ç´¢å¼•è®°å½•çš„å†…å®¹<br>  docs - è®°å½•doc id<br>  freqs - è®°å½• doc id å’Œ term frequencies<br>  positions - è®°å½• doc id/term frequencies/term position<br>  offsets - è®°å½• doc id/term frequencies/term position/<span class="hljs-type">character</span> offsets<br></code></pre></td></tr></table></figure></li>
<li><p>æ•°æ®ç±»å‹<br>JSON -&gt; Elasticsearchç±»å‹</p>
<table>
<thead>
<tr>
<th align="left">JSONç±»å‹</th>
<th align="left">Elasticsearch ç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å­—ç¬¦ä¸²</td>
<td align="left">åŒ¹é…æ—¥æœŸæ ¼å¼ -&gt; Date</td>
</tr>
<tr>
<td align="left">å¸ƒå°”å€¼</td>
<td align="left">boolean</td>
</tr>
<tr>
<td align="left">æµ®ç‚¹æ•°</td>
<td align="left">float</td>
</tr>
<tr>
<td align="left">æ•´æ•°</td>
<td align="left">long</td>
</tr>
<tr>
<td align="left">å¯¹è±¡</td>
<td align="left">Object</td>
</tr>
<tr>
<td align="left">æ•°ç»„</td>
<td align="left">ç”±ç¬¬ä¸€ä¸ªéç©ºæ•°å€¼çš„ç±»å‹æ‰€å†³å®š</td>
</tr>
<tr>
<td align="left">ç©ºå€¼</td>
<td align="left">å¿½ç•¥</td>
</tr>
</tbody></table>
</li>
</ul>
  <figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># ç®€å•ç±»å‹:</span><br><span class="hljs-bullet">  1.</span> Text/Keyword<br><span class="hljs-bullet">  2.</span> Date<br><span class="hljs-bullet">  3.</span> Integer / Floating<br><span class="hljs-bullet">  4.</span> Boolean<br><span class="hljs-bullet">  5.</span> IPv4 &amp; IPv6<br><br><span class="hljs-section"># å¤æ‚ç±»å‹ - å¯¹è±¡å’ŒåµŒå¥—å¯¹è±¡</span><br>  å¯¹è±¡ç±»å‹/åµŒå¥—ç±»å‹<br><br><span class="hljs-section"># ç‰¹æ®Šç±»å‹</span><br>  geo<span class="hljs-emphasis">_point &amp; geo_</span>shape / percolator<br></code></pre></td></tr></table></figure>

<h2 id="Elasticsearch-èšåˆ-Aggregation"><a href="#Elasticsearch-èšåˆ-Aggregation" class="headerlink" title="Elasticsearch èšåˆ (Aggregation)"></a>Elasticsearch èšåˆ (Aggregation)</h2><blockquote>
<p>Elasticsearch é™¤äº†æœç´¢ä»¥å¤–è¿˜æä¾›é’ˆå¯¹ESæ•°æ®è¿›è¡Œç»Ÿè®¡åˆ†æ</p>
</blockquote>
<ul>
<li>é›†åˆåˆ†ç±»<figure class="highlight q"><table><tr><td class="code"><pre><code class="hljs q"><span class="hljs-number">1.</span> Bucket Aggregation: æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æ–‡æ¡£é›†åˆ<br>  <span class="hljs-built_in">group</span> <span class="hljs-keyword">by</span><br><br><span class="hljs-number">2.</span> Metric Aggregation: æ•°å­¦è¿ç®—ï¼Œå¯¹æ–‡æ¡£å­—æ®µç»Ÿè®¡åˆ†æ<br>  <span class="hljs-built_in">min</span>/<span class="hljs-built_in">max</span>/<span class="hljs-built_in">sum</span>/<span class="hljs-built_in">avg</span>/cardinality<br><br><span class="hljs-number">3.</span> Pipeline Aggregation: å¯¹èšåˆç»“æœè¿›è¡ŒäºŒæ¬¡èšåˆ<br><span class="hljs-number">4.</span> Matrix Aggregation: æ”¯æŒå¤šä¸ªå­—æ®µçš„æ“ä½œå¹¶æä¾›ç»“æœçŸ©é˜µ<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Elasticsearch-åˆ†å¸ƒå¼ç»“æ„"><a href="#Elasticsearch-åˆ†å¸ƒå¼ç»“æ„" class="headerlink" title="Elasticsearch åˆ†å¸ƒå¼ç»“æ„"></a>Elasticsearch åˆ†å¸ƒå¼ç»“æ„</h2><ul>
<li><p>é«˜å¯ç”¨</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> æœåŠ¡å¯ç”¨æ€§ - å…è®¸æœ‰èŠ‚ç‚¹åœæ­¢æœåŠ¡<br><span class="hljs-bullet">2.</span> æ•°æ®å¯ç”¨æ€§ - éƒ¨åˆ†èŠ‚ç‚¹ä¸¢å¤±ï¼Œä¸ä¼šä¸¢å¤±æ•°æ®<br></code></pre></td></tr></table></figure></li>
<li><p>å¯æ‰©å±•æ€§</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> è¯·æ±‚é‡æå‡/æ•°æ®ä¸æ–­å¢åŠ (å°†æ•°æ®åˆ†å¸ƒåˆ°æ‰€æœ‰èŠ‚ç‚¹ä¸Š)<br></code></pre></td></tr></table></figure></li>
<li><p>Elasticsearchåˆ†å¸ƒå¼æ¶æ„</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">1.</span> ä¸åŒçš„é›†ç¾¤é€šè¿‡ä¸åŒçš„åå­—åŒºåˆ†ï¼Œ-E <span class="hljs-keyword">cluster</span>.name=geektime<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="ELK-å¤§æ•°æ®åˆ†æ"><a href="#ELK-å¤§æ•°æ®åˆ†æ" class="headerlink" title="ELK å¤§æ•°æ®åˆ†æ"></a>ELK å¤§æ•°æ®åˆ†æ</h2>]]></content>
      <categories>
        <category>Middleware</category>
      </categories>
  </entry>
  <entry>
    <title>golang pkg Tips &amp; Tracks</title>
    <url>/2021/09/03/golang-pkg-Tips-Tracks/</url>
    <content><![CDATA[<h2 id="Golang"><a href="#Golang" class="headerlink" title="Golang"></a>Golang</h2><ul>
<li>Goals<blockquote>
<p>The efficientcy of a statically-typed compiled language with the ease of programming of a dynamic language.<br>Safety: type-safe and memory-safe<br>Good support for concurrency and communication.<br>Efficient, latency-free garbage collection.<br>High-speed compilation.</p>
</blockquote>
</li>
</ul>
<span id="more"></span>

<ul>
<li><p>Design principles</p>
<blockquote>
<p>Keep concept orthogonal(æ­£äº¤).<br>Keep the grammar regular and simple.<br>Reduce typing. Let the language work things out.<br>Reduce typing. Keep the type system clear.</p>
</blockquote>
</li>
<li><p>The Big Picture</p>
<blockquote>
<p>Fundamentals:</p>
</blockquote>
<ul>
<li>Clean, concise syntax.</li>
<li>Lightweight type system.</li>
<li>No implicit conversions: keep things explicit.</li>
<li>Untyped unsized constants:</li>
<li>Strict separation of interface and implementation.<blockquote>
<p>Run-time:</p>
</blockquote>
</li>
<li>Garbage collection.</li>
<li>Strings, maps, communication channels</li>
<li>Concurrency.<blockquote>
<p>Package model:<br>Explicit dependencies to enable faster builds.</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h2 id="Go-Identifiers"><a href="#Go-Identifiers" class="headerlink" title="Go Identifiers"></a>Go Identifiers</h2><h2 id="Go-é¡¹ç›®ç»„ç»‡"><a href="#Go-é¡¹ç›®ç»„ç»‡" class="headerlink" title="Go é¡¹ç›®ç»„ç»‡"></a>Go é¡¹ç›®ç»„ç»‡</h2><ul>
<li><p>Goåº”ç”¨</p>
<blockquote>
<p>ç¼–å†™é«˜è´¨é‡çš„Goåº”ç”¨</p>
</blockquote>
<ul>
<li>ä»£ç ç»“æ„<ol>
<li>ç›®å½•ç»“æ„</li>
<li>æŒ‰åŠŸèƒ½æ‹†åˆ†æ¨¡å—</li>
</ol>
<ul>
<li>å±‚æ¬¡æ‹†åˆ† - MVC</li>
<li>åŠŸèƒ½æ‹†åˆ† - å®ç°é«˜å†…èšä½è€¦åˆçš„è®¾è®¡å“²å­¦</li>
</ul>
</li>
<li>ä»£ç è§„èŒƒ - UBer_Go_Guid</li>
<li>ä»£ç è´¨é‡</li>
<li>ç¼–ç¨‹å“²å­¦<ul>
<li>é¢å‘æ¥å£ç¼–ç¨‹<ol>
<li>ä»£ç æ‰©å±•æ€§æ›´å¼º</li>
<li>è§£è€¦ä¸Šä¸‹æ¸¸çš„å®ç°</li>
<li>æé«˜ä»£ç çš„å¯æµ‹æ€§</li>
</ol>
</li>
<li>é¢å‘â€œå¯¹è±¡â€ç¼–ç¨‹<ol>
<li>ç±»ã€æŠ½è±¡ã€å°è£…é€šè¿‡ç»“æ„ä½“æ¥å®ç°</li>
<li>å®ä¾‹é€šè¿‡ç»“æ„ä½“å˜é‡æ¥å®ç°</li>
<li>ç»§æ‰¿é€šè¿‡ç»„åˆæ¥å®ç°,ä¸€ä¸ªç»“æ„ä½“åµŒåˆ°å¦ä¸€ä¸ªç»“æ„ä½“ï¼Œç§°ä½œç»„åˆ</li>
<li>å¤šæ€é€šè¿‡ç»“æ„æ¥å®ç°<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-comment">// åŸºç±»: Bird</span><br><span class="hljs-keyword">type</span> Bird <span class="hljs-keyword">struct</span> &#123;<br>  Type <span class="hljs-keyword">string</span><br>&#125;<br><br><span class="hljs-comment">// é¸Ÿæ¥çš„ç±»åˆ«</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(bird *Bird)</span> <span class="hljs-title">Class</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;<br>  <span class="hljs-keyword">return</span> bird.Type<br>&#125;<br><br><span class="hljs-comment">// å®šä¹‰é¸Ÿç±»</span><br><span class="hljs-keyword">type</span> Birds <span class="hljs-keyword">interface</span> &#123;<br>  Name() <span class="hljs-keyword">string</span><br>  Class() <span class="hljs-keyword">string</span><br>&#125;<br><br><span class="hljs-comment">// é¸Ÿç±»: é‡‘ä¸é›€</span><br><span class="hljs-keyword">type</span> Canary <span class="hljs-keyword">struct</span> &#123;<br>  Bird<br>  name <span class="hljs-keyword">string</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Canary)</span> <span class="hljs-title">Name</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;<br>  <span class="hljs-keyword">return</span> c.name<br>&#125;<br><br><span class="hljs-comment">// é¸Ÿç±»: ä¹Œé¸¦</span><br><span class="hljs-keyword">type</span> Crow <span class="hljs-keyword">struct</span> &#123;<br>  Bird<br>  name <span class="hljs-keyword">string</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Crow)</span> <span class="hljs-title">Name</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;<br>  <span class="hljs-keyword">return</span> c.name<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewCrow</span><span class="hljs-params">(name <span class="hljs-keyword">string</span>)</span> *<span class="hljs-title">Crow</span></span> &#123;<br>  <span class="hljs-keyword">return</span> &amp;Crow&#123;<br>    Bird: Bird&#123;<br>      Type: <span class="hljs-string">&quot;Crow&quot;</span>,<br>    &#125;,<br>    name: name,<br>  &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewCanary</span><span class="hljs-params">(name <span class="hljs-keyword">string</span>)</span> *<span class="hljs-title">Canary</span></span> &#123;<br>  <span class="hljs-keyword">return</span> &amp;Canary&#123;<br>    Bird: Bird&#123;<br>      Type: <span class="hljs-string">&quot;Canary&quot;</span>,<br>    &#125;,<br>    name: name,<br>  &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BirdInfo</span><span class="hljs-params">(birds Birds)</span></span> &#123;<br>  fmt.Printf(<span class="hljs-string">&quot;I&#x27;m %s, I belong to %s bird class!\n&quot;</span>, birds.Name(), birds.Class())<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  canary := NewCanary(<span class="hljs-string">&quot;CanaryA&quot;</span>)<br>  crow := NewCrow(<span class="hljs-string">&quot;CrowA&quot;</span>)<br>  BirdInfo(canary)<br>  BirdInfo(crow)<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
</li>
<li>è½¯ä»¶è®¾è®¡æ–¹æ³•<ul>
<li>è®¾è®¡æ¨¡å¼ Design Pattern<blockquote>
<p>é’ˆå¯¹ç‰¹å®šåœºæ™¯æ€»ç»“å‡ºæ¥çš„æœ€ä½³å®ç°æ–¹å¼ï¼Œç‰¹ç‚¹æ˜¯è§£å†³åœºæ™¯æ¯”è¾ƒå…·ä½“ï¼Œå®æ–½èµ·æ¥æ¯”è¾ƒç®€å•</p>
</blockquote>
<ul>
<li>åˆ›å»ºå‹æ¨¡å¼ Creational Patterns<blockquote>
<p>æä¾›ä¸€ç§åœ¨åˆ›å»ºå¯¹è±¡çš„åŒæ—¶éšè—åˆ›å»ºé€»è¾‘çš„æ–¹å¼ï¼Œä¸ä½¿ç”¨newè¿ç®—ç¬¦ç›´æ¥å®ä¾‹åŒ–å¯¹è±¡</p>
</blockquote>
<ul>
<li>å•ä¾‹æ¨¡å¼ Singleton Pattern<blockquote>
<p>å•ä¾‹æ¨¡å¼ä½¿å…¨å±€åªæœ‰ä¸€ä¸ªå®ä¾‹,å¹¶ä¸”è´Ÿè´£åˆ›å»ºè‡ªå·±çš„å¯¹è±¡ï¼Œæ¯”è¾ƒé€‚åˆå…¨å±€å…±äº«ä¸€ä¸ªå®ä¾‹ï¼Œä¸”åªéœ€è¦è¢«åˆå§‹åŒ–ä¸€æ¬¡çš„åœºæ™¯. [æ•°æ®åº“å®ä¾‹ã€å…¨å±€é…ç½®ã€å…¨å±€ä»»åŠ¡æ± ]</p>
</blockquote>
<ul>
<li>é¥¿æ±‰æ¨¡å¼: å…¨å±€å®ä¾‹åœ¨åŒ…è¢«åŠ è½½æ—¶åˆ›å»º<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> singleton<br><br><span class="hljs-keyword">type</span> singleton <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><span class="hljs-keyword">var</span> ins *singleton<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> &#123;<br>  <span class="hljs-comment">//å¯¼å…¥æ—¶ åˆå§‹åŒ–é™æ€å®ä¾‹</span><br>  ins = &amp;singleton&#123;&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetInsOr</span><span class="hljs-params">()</span> *<span class="hljs-title">singleton</span></span> &#123;<br>  <span class="hljs-comment">// è¿”å›åˆ›å»ºå¥½çš„åˆå§‹åŒ–å®ä¾‹</span><br>  <span class="hljs-keyword">return</span> ins<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
<li>æ‡’æ±‰æ¨¡å¼: å…¨å±€å®ä¾‹åœ¨åŒ…è¢«ä½¿ç”¨æ—¶åˆ›å»º<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> singleton<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;sync&quot;</span><br><span class="hljs-keyword">type</span> singleton <span class="hljs-keyword">struct</span> &#123;<br>	Name <span class="hljs-keyword">string</span><br>&#125;<br><br><span class="hljs-keyword">var</span> ins *singleton<br><span class="hljs-keyword">var</span> once sync.Once<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetInsOr</span><span class="hljs-params">()</span> *<span class="hljs-title">singleton2</span></span> &#123;<br>  <span class="hljs-comment">// Do is intended for initialization that must be run exactly once</span><br>	once.Do(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>		ins2 = &amp;singleton&#123;<span class="hljs-string">&quot;Chyi&quot;</span>&#125;<br>	&#125;)<br>	<span class="hljs-keyword">return</span> ins<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li>ç®€å•å·¥å‚æ¨¡å¼<blockquote>
<p>ä¼ å…¥å‚æ•°å¹¶è¿”å›ä¸€ä¸ªç»“æ„ä½“çš„å®ä¾‹</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> factory<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;<br>	Name <span class="hljs-keyword">string</span><br>	Age  <span class="hljs-keyword">int</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p Person)</span> <span class="hljs-title">Greet</span><span class="hljs-params">()</span></span> &#123;<br>	fmt.Printf(<span class="hljs-string">&quot;Hi! My name is %s&quot;</span>, p.Name)<br>&#125;<br><br><span class="hljs-comment">// ç®€å•å·¥å‚æ¨¡å¼ç¡®ä¿æˆ‘ä»¬åˆ›å»ºçš„å®ä¾‹å…·æœ‰éœ€è¦çš„å‚æ•°ï¼Œè¿›è€Œä¿è¯å®ä¾‹æŒ‰ç…§é¢„æœŸæ‰§è¡Œ</span><br><span class="hljs-comment">// è¿”å›éæŒ‡é’ˆçš„å®ä¾‹ï¼Œå¯ä»¥ç¡®ä¿å®ä¾‹å±æ€§é¿å…å±æ€§è¢«æ„å¤–/ä»»æ„ä¿®æ”¹</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewPerson</span><span class="hljs-params">(name <span class="hljs-keyword">string</span>, age <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">Person</span></span> &#123;<br>	<span class="hljs-keyword">return</span> Person&#123;<br>		Name: name,<br>		Age:  age,<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
<li>æŠ½è±¡å·¥å‚æ¨¡å¼<blockquote>
<p>ä¸ç®€å•å·¥å‚æ¨¡å¼åŒºåˆ«æ˜¯è¿”å›çš„æ˜¯æ¥å£è€Œä¸æ˜¯ç»“æ„ä½“, åœ¨ä¸å…¬å¼€å†…éƒ¨å®ç°çš„æƒ…å†µä¸‹ï¼Œè®©è°ƒç”¨è€…ä½¿ç”¨</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> abstract_factory<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">interface</span> &#123;<br>	Greet()<br>&#125;<br><br><span class="hljs-keyword">type</span> person <span class="hljs-keyword">struct</span> &#123;<br>	name <span class="hljs-keyword">string</span><br>	age  <span class="hljs-keyword">int</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p person)</span> <span class="hljs-title">Greet</span><span class="hljs-params">()</span></span> &#123;<br>	fmt.Printf(<span class="hljs-string">&quot;Hi!, my name is %s&quot;</span>, p.name)<br>&#125;<br><br><span class="hljs-comment">// Here, NewPerson returns an interface, and not the person struct iteself</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewPerson</span><span class="hljs-params">(name <span class="hljs-keyword">string</span>, age <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">Person</span></span> &#123;<br>	<span class="hljs-keyword">return</span> person&#123;<br>		name: name,<br>		age:  age,<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
<li>å·¥å‚æ–¹æ³•æ¨¡å¼<blockquote>
<p>ä¾èµ–å·¥å‚æ¥å£ï¼Œé€šè¿‡å®ç°å·¥å‚æ¥å£æ¥åˆ›å»ºå¤šç§å·¥å‚ï¼Œå°†å¯¹è±¡åˆ›å»ºä»ä¸€ä¸ªå¯¹è±¡è´Ÿè´£æ‰€æœ‰é›†ä½“ç±»çš„å®ä¾‹åŒ–ï¼Œç¼–ç¨‹ç”±ä¸€ç¾¤å­ç±»è´Ÿè´£å¯¹å…·ä½“ç±»çš„å®ä¾‹åŒ–,ä»è€Œå°†è¿‡ç¨‹è§£è€¦</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> method_factory<br><br><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;<br>	name <span class="hljs-keyword">string</span><br>	age  <span class="hljs-keyword">int</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewPersonFactory</span><span class="hljs-params">(age <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">func</span><span class="hljs-params">(name <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">Person</span></span> &#123;<br>	<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(name <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">Person</span></span> &#123;<br>		<span class="hljs-keyword">return</span> Person&#123;<br>			name: name,<br>			age:  age,<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li>å»ºé€ è€…æ¨¡å¼</li>
<li>åŸå‹æ¨¡å¼</li>
</ul>
</li>
<li>ç»“æ„å‹æ¨¡å¼ Structural Patterns<ul>
<li>è®¿é—®è€…æ¨¡å¼</li>
<li>æ¨¡ç‰ˆæ¨¡å¼ Template Pattern<blockquote>
<p>å°†ä¸€ä¸ªç±»ä¸­èƒ½å¤Ÿå…¬å…±ä½¿ç”¨çš„æ–¹æ³•æ”¾ç½®åœ¨æŠ½è±¡ç±»ä¸­å®ç°ï¼Œå°†ä¸èƒ½å…¬å…±ä½¿ç”¨çš„æ–¹æ³•ä½œä¸ºæŠ½è±¡æ–¹æ³•ï¼Œå¼ºåˆ¶å­ç±»å®ç°ï¼Œè¿™æ ·å°±åšåˆ°ä¸€ä¸ªç±»ä½œä¸ºæ¨¡ç‰ˆï¼Œè®©å¼€å‘è€…å¡«å……éœ€è¦å¡«å……çš„åœ°æ–¹</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> template<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-keyword">type</span> Cooker <span class="hljs-keyword">interface</span> &#123;<br>	fire()<br>	cooke()<br>	outfire()<br>&#125;<br><br><span class="hljs-comment">// ç±»ä¼¼ä¸€ä¸ªæŠ½è±¡ç±»</span><br><span class="hljs-keyword">type</span> CookMenu <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(CookMenu)</span> <span class="hljs-title">fire</span><span class="hljs-params">()</span></span> &#123;<br>	fmt.Println(<span class="hljs-string">&quot;å¼€ç«&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">// åšèœ äº¤ç»™å…·ä½“çš„å­ç±»å®ç°</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(CookMenu)</span> <span class="hljs-title">cooke</span><span class="hljs-params">()</span></span> &#123;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(CookMenu)</span> <span class="hljs-title">outfire</span><span class="hljs-params">()</span></span> &#123;<br>	fmt.Println(<span class="hljs-string">&quot;å…³ç«&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">// å°è£…å…·ä½“æ­¥éª¤</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">doCook</span><span class="hljs-params">(cook Cooker)</span></span> &#123;<br>	cook.fire()<br>	cook.cooke()<br>	cook.outfire()<br>&#125;<br><br><span class="hljs-keyword">type</span> XiHongShi <span class="hljs-keyword">struct</span> &#123;<br>	CookMenu<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(*XiHongShi)</span> <span class="hljs-title">cooke</span><span class="hljs-params">()</span></span> &#123;<br>	fmt.Println(<span class="hljs-string">&quot;åšè¥¿çº¢æŸ¿&quot;</span>)<br>&#125;<br><br><span class="hljs-keyword">type</span> ChaoJiDan <span class="hljs-keyword">struct</span> &#123;<br>	CookMenu<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(ChaoJiDan)</span> <span class="hljs-title">cooke</span><span class="hljs-params">()</span></span> &#123;<br>	fmt.Println(<span class="hljs-string">&quot;åšç‚’é¸¡è›‹&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestTemplate</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br> <span class="hljs-comment">// åšè¥¿çº¢æŸ¿</span><br> xihongshi := &amp;XiHongShi&#123;&#125;<br>  doCook(xihongshi)<br><br>  <span class="hljs-comment">// åšç‚’é¸¡è›‹</span><br>  chaojidan := &amp;ChaoJiDan&#123;&#125;<br>  doCook(chaojidan)<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li>ç­–ç•¥æ¨¡å¼ Strategy Pattern<blockquote>
<p>é‡‡ç”¨ä¸åŒç­–ç•¥çš„åœºæ™¯</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> strategy<br><br><span class="hljs-comment">// ç­–ç•¥æ¨¡å¼</span><br><br><span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªç­–ç•¥ç±»</span><br><span class="hljs-keyword">type</span> IStrategy <span class="hljs-keyword">interface</span> &#123;<br>	do(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>) <span class="hljs-keyword">int</span><br>&#125;<br><br><span class="hljs-comment">// ç­–ç•¥å®ç°: åŠ </span><br><span class="hljs-keyword">type</span> add <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(*add)</span> <span class="hljs-title">do</span><span class="hljs-params">(a, b <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">int</span></span> &#123;<br>	<span class="hljs-keyword">return</span> a + b<br>&#125;<br><br><span class="hljs-comment">// ç­–ç•¥å®ç°: å‡</span><br><span class="hljs-keyword">type</span> reduce <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(*reduce)</span> <span class="hljs-title">do</span><span class="hljs-params">(a, b <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">int</span></span> &#123;<br>	<span class="hljs-keyword">return</span> a - b<br>&#125;<br><br><span class="hljs-comment">// å…·ä½“ç­–ç•¥çš„æ‰§è¡Œè€…</span><br><span class="hljs-keyword">type</span> Operator <span class="hljs-keyword">struct</span> &#123;<br>	strategy IStrategy<br>&#125;<br><br><span class="hljs-comment">// è®¾ç½®ç­–ç•¥</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(operator *Operator)</span> <span class="hljs-title">setStrategy</span><span class="hljs-params">(strategy IStrategy)</span></span> &#123;<br>	operator.strategy = strategy<br>&#125;<br><br><span class="hljs-comment">// è°ƒç”¨ç­–ç•¥ä¸­çš„æ–¹æ³•</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(operator *Operator)</span> <span class="hljs-title">calculate</span><span class="hljs-params">(a, b <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">int</span></span> &#123;<br>	<span class="hljs-keyword">return</span> operator.strategy.do(a, b)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestStrategy</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br>	operator := Operator&#123;&#125;<br><br>	operator.setStrategy(&amp;add&#123;&#125;)<br>	result := operator.calculate(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br>	fmt.Println(<span class="hljs-string">&quot;add:&quot;</span>, result)<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li>çŠ¶æ€æ¨¡å¼</li>
<li>è§‚å¯Ÿè€…æ¨¡å¼</li>
<li>å¤‡å¿˜å½•æ¨¡å¼</li>
<li>ä¸­ä»‹è€…æ¨¡å¼</li>
<li>è¿­ä»£å™¨æ¨¡å¼</li>
<li>è§£é‡Šå™¨æ¨¡å¼</li>
<li>å‘½ä»¤æ¨¡å¼</li>
<li>è´£ä»»é“¾æ¨¡å¼</li>
</ul>
</li>
<li>è¡Œä¸ºå‹æ¨¡å¼ Behavioral Patterns<blockquote>
<p>å…³æ³¨å¯¹è±¡ä¹‹é—´çš„é€šä¿¡</p>
</blockquote>
<ul>
<li>é€‚é…å™¨æ¨¡å¼</li>
<li>æ¡¥æ¥æ¨¡å¼</li>
<li>ç»„åˆæ¨¡å¼</li>
<li>è£…é¥°æ¨¡å¼</li>
<li>å¤–è§‚æ¨¡å¼</li>
<li>äº«å…ƒæ¨¡å¼</li>
<li>ä»£ç†æ¨¡å¼ Proxy Pattern<blockquote>
<p>å¯ä»¥ä¸ºå¦ä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªæ›¿èº«æˆ–è€…å ä½ç¬¦ï¼Œä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®</p>
</blockquote>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><code class="hljs reasonml">package proxy<br><br>import <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-keyword">type</span> Seller interface &#123;<br>	sell(name <span class="hljs-built_in">string</span>)<br>&#125;<br><br><span class="hljs-comment">// ç«è½¦ç«™</span><br><span class="hljs-keyword">type</span> Station <span class="hljs-keyword">struct</span> &#123;<br>	stock <span class="hljs-built_in">int</span> <span class="hljs-comment">// åº“å­˜</span><br>&#125;<br><br>func (station *Station) sell(name <span class="hljs-built_in">string</span>) &#123;<br>	<span class="hljs-keyword">if</span> station.stock &gt; <span class="hljs-number">0</span> &#123;<br>		station.stock--<br>		fmt.<span class="hljs-constructor">Printf(<span class="hljs-string">&quot;ä»£ç†ç‚¹ä¸­: %sä¹°äº†ä¸€å¼ ç¥¨ï¼Œå‰©ä½™: %d \n&quot;</span>, <span class="hljs-params">name</span>, <span class="hljs-params">station</span>.<span class="hljs-params">stock</span>)</span><br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		fmt.<span class="hljs-constructor">Println(<span class="hljs-string">&quot;ç¥¨å·²å”®ç©º&quot;</span>)</span><br>	&#125;<br>&#125;<br><br><span class="hljs-comment">// ç«è½¦ä»£ç†ç‚¹</span><br><br><span class="hljs-keyword">type</span> StationProxy <span class="hljs-keyword">struct</span> &#123;<br>	station *Station <span class="hljs-comment">// æŒæœ‰ç«è½¦ç«™å¯¹è±¡</span><br>&#125;<br><br>func (proxy *StationProxy) sell(name <span class="hljs-built_in">string</span>) &#123;<br>	<span class="hljs-keyword">if</span> proxy.station.stock &gt; <span class="hljs-number">0</span> &#123;<br>		proxy.station.stock--<br>		fmt.<span class="hljs-constructor">Printf(<span class="hljs-string">&quot;ä»£ç†ç‚¹ä¸­: %sä¹°äº†ä¸€å¼ ç¥¨,å‰©ä½™: %d \n&quot;</span>, <span class="hljs-params">name</span>, <span class="hljs-params">proxy</span>.<span class="hljs-params">station</span>.<span class="hljs-params">stock</span>)</span><br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		fmt.<span class="hljs-constructor">Println(<span class="hljs-string">&quot;ç¥¨å·²å”®ç©º&quot;</span>)</span><br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
<li>é€‰é¡¹æ¨¡å¼ Options Pattern<blockquote>
<p>ç»“æ„ä½“å‚æ•°å¾ˆå¤šï¼ŒæœŸæœ›åˆ›å»ºä¸€ä¸ªæºå¸¦é»˜è®¤å€¼çš„ç»“æ„ä½“å˜é‡ï¼Œå¹¶é€‰æ‹©æ€§ä¿®æ”¹å…¶ä¸­ä¸€äº›å‚æ•°çš„å€¼</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> options<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;time&quot;</span><br><br><span class="hljs-keyword">type</span> Connection <span class="hljs-keyword">struct</span> &#123;<br>	addr    <span class="hljs-keyword">string</span><br>	cache   <span class="hljs-keyword">bool</span><br>	timeout time.Duration<br>&#125;<br><br><span class="hljs-keyword">const</span> (<br>	defaultTimeout = <span class="hljs-number">10</span><br>	defaultCaching = <span class="hljs-literal">false</span><br>)<br><br><span class="hljs-keyword">type</span> options <span class="hljs-keyword">struct</span> &#123;<br>	timeout time.Duration<br>	caching <span class="hljs-keyword">bool</span><br>&#125;<br><br><span class="hljs-comment">// Option override behavior of Connect</span><br><span class="hljs-keyword">type</span> Option <span class="hljs-keyword">interface</span> &#123;<br>	apply(*options)<br>&#125;<br><br><span class="hljs-keyword">type</span> optionFunc <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(*options)</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f optionFunc)</span> <span class="hljs-title">apply</span><span class="hljs-params">(o *options)</span></span> &#123;<br>	f(o)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithTimeout</span><span class="hljs-params">(t time.Duration)</span> <span class="hljs-title">Option</span></span> &#123;<br>	<span class="hljs-keyword">return</span> optionFunc(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(o *options)</span></span> &#123;<br>		o.timeout = t<br>	&#125;)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithCaching</span><span class="hljs-params">(cache <span class="hljs-keyword">bool</span>)</span> <span class="hljs-title">Option</span></span> &#123;<br>	<span class="hljs-keyword">return</span> optionFunc(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(o *options)</span></span> &#123;<br>		o.caching = cache<br>	&#125;)<br>&#125;<br><br><span class="hljs-comment">// NewConnect create a connection.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewConnect</span><span class="hljs-params">(addr <span class="hljs-keyword">string</span>, opts ...Option)</span> <span class="hljs-params">(*Connection, error)</span></span> &#123;<br>	options := options&#123;<br>		timeout: defaultTimeout,<br>		caching: defaultCaching,<br>	&#125;<br><br>	<span class="hljs-keyword">for</span> _, o := <span class="hljs-keyword">range</span> opts &#123;<br>		o.apply(&amp;options)<br>	&#125;<br><br>	<span class="hljs-keyword">return</span> &amp;Connection&#123;<br>		addr:    addr,<br>		cache:   options.caching,<br>		timeout: options.timeout,<br>	&#125;, <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestOptions</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br> connect, err := NewConnect(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, WithCaching(<span class="hljs-literal">true</span>), WithTimeout(<span class="hljs-number">5</span>))<br> <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>  log.Fatal(err)<br> &#125;<br> fmt.Println(connect)<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li>SOLIDåŸåˆ™<blockquote>
<p>ä¾§é‡è®¾è®¡åŸåˆ™,è®¾è®¡ä»£ç æŒ‡å¯¼æ–¹é’ˆ</p>
</blockquote>
<ul>
<li>SRP: å•ä¸€åŠŸèƒ½åŸåˆ™, ä¸€ä¸ªç±»æˆ–è€…æ¨¡å—åªè´Ÿè´£å®Œæˆä¸€ä¸ªæŒ‡è´£</li>
<li>OCP: å¼€é—­åŸåˆ™,è½¯ä»¶å®ä½“åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­</li>
<li>LSP: é‡Œæ°æ›¿æ¢åŸåˆ™, å¦‚æœSæ˜¯Tçš„å­ç±»å‹ï¼Œåˆ™ç±»å‹Tçš„å¯¹è±¡å¯ä»¥æ›¿æ¢ä¸ºç±»å‹Sçš„å¯¹è±¡ï¼Œè€Œä¸ä¼šç ´åç¨‹åº</li>
<li>DIP: ä¾èµ–å€’ç½®åŸåˆ™ï¼Œä¾èµ–äºæŠ½è±¡è€Œä¸æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œå…¶æœ¬è´¨æ˜¯è¦é¢å‘æ¥å£ç¼–ç¨‹ï¼Œä¸è¦é¢å‘å®ç°ç¼–ç¨‹</li>
<li>ISP: æ¥å£åˆ†ç¦»åŸåˆ™ï¼Œå®¢æˆ·ç«¯ç¨‹åºä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ–¹æ³•</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>é¡¹ç›®ç®¡ç†</p>
</li>
<li><p>é¡¹ç›®æ–‡æ¡£</p>
</li>
</ul>
<h2 id="Go-å·¥å…·é›†"><a href="#Go-å·¥å…·é›†" class="headerlink" title="Go å·¥å…·é›†"></a>Go å·¥å…·é›†</h2><table>
<thead>
<tr>
<th align="left">å·¥å…·å</th>
<th align="left">åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td align="left">golines</td>
<td align="left">æ ¼å¼åŒ–é•¿è¡Œ</td>
</tr>
<tr>
<td align="left">goimports</td>
<td align="left">å¯¼å…¥åŒ…ç®¡ç†ï¼Œè‡ªåŠ¨å¢åˆ ä¾èµ–åŒ…ï¼ŒæŒ‰ç…§å­—æ¯æ’åº</td>
</tr>
<tr>
<td align="left">mockgen</td>
<td align="left">æ¥å£Mockå·¥å…·</td>
</tr>
<tr>
<td align="left">gotests</td>
<td align="left">æ ¹æ®Goä»£ç è‡ªåŠ¨ç”Ÿæˆå•å…ƒæµ‹è¯•æ¨¡ç‰ˆ</td>
</tr>
<tr>
<td align="left">go-junit-report</td>
<td align="left">go testè¾“å‡ºè½¬æ¢ä¸ºjunit xml</td>
</tr>
<tr>
<td align="left">richgo</td>
<td align="left">ç”¨æ–‡æœ¬è£…é¥°ä¸°å¯Œgo testçš„è¾“å‡º</td>
</tr>
<tr>
<td align="left">golangci-lint</td>
<td align="left">é™æ€ä»£ç æ£€æŸ¥å·¥å…·</td>
</tr>
<tr>
<td align="left">rts</td>
<td align="left">response to struct æ ¹æ®æœåŠ¡å™¨çš„å“åº”ç”ŸæˆGoç»“æ„ä½“</td>
</tr>
<tr>
<td align="left">protoc-go-inject-tag</td>
<td align="left">é€šè¿‡protocå·¥å…·ç”Ÿæˆpb.goæ–‡ä»¶ä¸­æ³¨å…¥è‡ªå®šä¹‰æ ‡ç­¾</td>
</tr>
<tr>
<td align="left">db2struct</td>
<td align="left">å°†æ•°æ®åº“è¡¨ä¸€é”®è½¬æ¢ä¸ºgo struct,æ”¯æŒè‡ªå®šä¹‰Tagå’Œå¤šç§å‘½åæ ¼å¼é…ç½®</td>
</tr>
<tr>
<td align="left">gsemver</td>
<td align="left">æ ¹æ®git commitè§„èŒƒè‡ªåŠ¨ç”Ÿæˆè¯­ä¹‰åŒ–ç‰ˆæœ¬</td>
</tr>
<tr>
<td align="left">git-chglog</td>
<td align="left">æ ¹æ®git commit è‡ªåŠ¨ç”ŸæˆCHANGELOG</td>
</tr>
<tr>
<td align="left">github-release</td>
<td align="left">å‘½ä»¤è¡Œå·¥å…·ï¼Œåˆ›å»ºã€ä¿®æ”¹github release</td>
</tr>
<tr>
<td align="left">go-mod-outdated</td>
<td align="left">æ£€æŸ¥ä¾èµ–åŒ…æ˜¯å¦æœ‰æ›´æ–°</td>
</tr>
<tr>
<td align="left">depth</td>
<td align="left">é€šè¿‡åˆ†æå¯¼å…¥çš„åº“ï¼Œå°†æŸä¸ªåŒ…çš„ä¾èµ–å…³ç³»ç”¨æ ‘çŠ¶ç»“æ„æ˜¾ç¤ºå‡ºæ¥</td>
</tr>
<tr>
<td align="left">go-callvis</td>
<td align="left">å¯è§†åŒ–æ˜¾ç¤ºGoè°ƒç”¨å…³ç³»</td>
</tr>
<tr>
<td align="left">cfssl</td>
<td align="left">CouldFlareçš„PKIçš„TLSå·¥å…·é›†</td>
</tr>
<tr>
<td align="left">addllicense</td>
<td align="left">é€šè¿‡æ‰«ææŒ‡å®šæ–‡ä»¶çš„æ–‡ä»¶ï¼Œç¡®ä¿æºç æ–‡ä»¶æœ‰ç‰ˆæƒå¤´</td>
</tr>
<tr>
<td align="left">gothanks</td>
<td align="left">è‡ªåŠ¨åœ¨githubä¸ŠStaré¡¹ç›®çš„ä¾èµ–åŒ…æ‰€åœ¨çš„github repository</td>
</tr>
<tr>
<td align="left">swagger</td>
<td align="left">è‡ªåŠ¨ç”ŸæˆGo Swaggeræ–‡æ¡£</td>
</tr>
</tbody></table>
<h2 id="Go-Guide"><a href="#Go-Guide" class="headerlink" title="Go Guide"></a>Go Guide</h2><h2 id="Golang-Frequently-Asked-Questions-FAQ"><a href="#Golang-Frequently-Asked-Questions-FAQ" class="headerlink" title="Golang Frequently Asked Questions (FAQ)"></a>Golang Frequently Asked Questions (FAQ)</h2><ul>
<li><p>Map access is unsafe only when updates are occurring.</p>
</li>
<li><p>How can I gurantee my type satisfies an interface?</p>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-keyword">type</span> I <span class="hljs-keyword">interface</span> &#123;<br>    Say(<span class="hljs-keyword">string</span>)<br>&#125;<br><br><span class="hljs-keyword">type</span> T <span class="hljs-keyword">struct</span> &#123;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *T)</span> <span class="hljs-title">Say</span><span class="hljs-params">(s <span class="hljs-keyword">string</span>)</span></span> &#123;<br>    fmt.Println(s)<br>&#125;<br><br><span class="hljs-comment">// ç”¨äºè§¦å‘ç¼–è¯‘æœŸçš„æ¥å£çš„åˆç†æ€§æ£€æŸ¥æœºåˆ¶</span><br><span class="hljs-comment">// å¦‚æœTæ²¡æœ‰å®ç°Iï¼Œä¼šåœ¨ç¼–è¯‘æœŸæŠ¥é”™</span><br><span class="hljs-comment">// èµ‹å€¼å³è¾¹æ˜¯æ–­è¨€ç±»å‹çš„é›¶å€¼ï¼Œå¯¹äºæŒ‡é’ˆç±»å‹ã€åˆ‡ç‰‡ã€mapæ˜¯nilï¼Œå¯¹äºç»“æ„ä½“ç±»å‹æ˜¯ç©ºç»“æ„</span><br><span class="hljs-comment">// Ask the compiler to check that the type T implements the interface I by</span><br><span class="hljs-keyword">var</span> _ I = (*T)(<span class="hljs-literal">nil</span>) <span class="hljs-comment">// Verify that *T implements I.</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    t := T&#123;&#125;<br>    t.Say(<span class="hljs-string">&quot;Say Hello&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>Should I define methods on values or pointers?</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql">func (s *MyStruct) pointerMethod() &#123;&#125;   // <span class="hljs-keyword">method</span> <span class="hljs-keyword">on</span> pointer<br>func (s MyStruct) valueMethod() &#123;&#125;      // <span class="hljs-keyword">method</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">value</span><br><br>&gt; <span class="hljs-keyword">When</span> defining a <span class="hljs-keyword">method</span> <span class="hljs-keyword">on</span> a <span class="hljs-keyword">type</span>, the receiver behaves exactly <span class="hljs-keyword">as</span> <span class="hljs-keyword">if</span> it were an argument <span class="hljs-keyword">to</span> the <span class="hljs-keyword">method</span>. Whether <span class="hljs-keyword">to</span> define the receiver <span class="hljs-keyword">as</span> a <span class="hljs-keyword">value</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">as</span> a pointer <span class="hljs-keyword">is</span> the same question, <span class="hljs-keyword">then</span>, <span class="hljs-keyword">as</span> whether a <span class="hljs-keyword">function</span> argument should be a <span class="hljs-keyword">value</span> <span class="hljs-keyword">or</span> poiner.<br><br><span class="hljs-number">1.</span> First, <span class="hljs-keyword">and</span> most important, does the <span class="hljs-keyword">method</span> need <span class="hljs-keyword">to</span> modify the receiver?<br><span class="hljs-number">2.</span> Second <span class="hljs-keyword">is</span> the consideration <span class="hljs-keyword">of</span> efficiency. <span class="hljs-keyword">If</span> the receiver <span class="hljs-keyword">is</span> <span class="hljs-keyword">large</span>, a big struct <span class="hljs-keyword">for</span> instance, it will be much cheaper <span class="hljs-keyword">to</span> use a pointer receiver.<br></code></pre></td></tr></table></figure></li>
<li><p>What operations are atomic? What about mutexes?</p>
<blockquote>
<p>Do not communicate by sharing memory. Instead, share memory by communicating.</p>
</blockquote>
</li>
<li><p>How can I control the number of CPUs?</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><code class="hljs smali">The runtime can allocate more threads than the value of GOMAXPROCS to service multiple outstanding I/O requests. GOMAXPROCS only affects how many goroutines can actually<span class="hljs-built_in"> execute </span>at once; arbitrarily more may be blocked in<span class="hljs-keyword"> system</span> calls.<br></code></pre></td></tr></table></figure></li>
<li><p>Who do I write a unit test?</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><code class="hljs reasonml"><span class="hljs-number">1.</span> Create a <span class="hljs-keyword">new</span> file ending <span class="hljs-keyword">in</span> <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">_test</span>.</span></span>go <span class="hljs-keyword">in</span> the same directory <span class="hljs-keyword">as</span> your package sources. Inside that file, import <span class="hljs-string">&quot;testing&quot;</span> <span class="hljs-keyword">and</span> write functions <span class="hljs-keyword">of</span> the form<br><br>func <span class="hljs-constructor">TestFoo(<span class="hljs-params">t</span> <span class="hljs-operator">*</span><span class="hljs-params">testing</span>.T)</span> &#123;<br>  â€¦<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>What compiler technology is used to build the compilers?</p>
<blockquote>
<p>The default compiler, gc, was originally written in C, but since the Go 1.5 release the compiler has been a Go program.</p>
</blockquote>
</li>
<li><p>Why do garbage collection? Wonâ€™t it be too expensive?</p>
<figure class="highlight mercury"><table><tr><td class="code"><pre><code class="hljs mercury">The current <span class="hljs-keyword">implementation</span> <span class="hljs-keyword">is</span> a mark-and-sweep collector.<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="User-Goè¯­è¨€ç¼–ç è§„èŒƒ"><a href="#User-Goè¯­è¨€ç¼–ç è§„èŒƒ" class="headerlink" title="User Goè¯­è¨€ç¼–ç è§„èŒƒ"></a>User Goè¯­è¨€ç¼–ç è§„èŒƒ</h2><ul>
<li><p>æŒ‡å¯¼åŸåˆ™:</p>
<ul>
<li><p>æŒ‡å‘interfaceçš„æŒ‡é’ˆ</p>
<ol>
<li>ä½¿ç”¨æŒ‡é’ˆä¼ é€’æ‰èƒ½é€šè¿‡æ¥å£æ–¹æ³•ä¿®æ”¹åŸºç¡€æ•°æ®</li>
</ol>
</li>
<li><p>Interface åˆç†æ€§éªŒè¯</p>
<ol>
<li>var _ http.Handler = (*Handler)(nil)  // è§¦å‘ç¼–è¯‘æœŸçš„æ¥å£åˆç†æ€§æ£€æŸ¥æœºåˆ¶ï¼Œå¦‚æœHandleræ²¡æœ‰å®ç°Http.Handler ä¼šæŠ¥é”™</li>
<li>èµ‹å€¼å³è¾¹æ˜¯æ–­è¨€ç±»å‹çš„é›¶å€¼ï¼ŒæŒ‡é’ˆç±»å‹ã€åˆ‡ç‰‡å’Œæ˜ å°„éƒ½æ˜¯nil,å¯¹äºç»“æ„ç±»å‹æ˜¯ç©ºç»“æ„</li>
</ol>
</li>
<li><p>æ¥æ”¶å™¨receiverä¸æ¥å£</p>
<ol>
<li>ä½¿ç”¨å€¼æ¥æ”¶å™¨çš„æ–¹æ³•å³å¯ä»¥é€šè¿‡å€¼è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŒ‡é’ˆè°ƒç”¨</li>
<li>å¸¦æŒ‡é’ˆæ¥æ”¶å™¨çš„æ–¹æ³•åªèƒ½é€šè¿‡æŒ‡é’ˆè°ƒç”¨<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> ä¸€ä¸ªç±»å‹å¯ä»¥æœ‰å€¼æ¥æ”¶å™¨æ–¹æ³•é›†å’ŒæŒ‡é’ˆæ¥æ”¶å™¨æ–¹æ³•é›†<br>  ä¸€ä¸ªå€¼æ¥æ”¶å™¨æ–¹æ³•é›†æ˜¯æŒ‡é’ˆæ¥æ”¶å™¨æ–¹æ³•é›†çš„å­é›†<br><span class="hljs-bullet">2.</span> å€¼å¯¹è±¡åªå¯ä»¥ä½¿ç”¨å€¼æ¥æ”¶å™¨æ–¹æ³•é›†,æŒ‡é’ˆå¯¹è±¡å¯ä»¥ä½¿ç”¨å€¼æ¥æ”¶å™¨æ–¹æ³•é›†+æŒ‡é’ˆæ¥æ”¶å™¨æ–¹æ³•é›†<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>é›¶å€¼ Mutex</p>
<blockquote>
<p>é›¶å€¼sync.Mutex, sync.RWMutxæ˜¯æœ‰æ•ˆçš„ï¼ŒæŒ‡å‘Mutexçš„æŒ‡é’ˆåŸºæœ¬æ˜¯ä¸å¿…è¦çš„</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> ä½¿ç”¨ç»“æ„ä½“æŒ‡é’ˆï¼Œmutexåº”è¯¥ä½œä¸ºç»“æ„ä½“çš„éæŒ‡é’ˆå­—æ®µï¼Œå³ä½¿è¯¥ç»“æ„ä½“ä¸è¢«å¯¼å‡ºï¼Œä¸è¦å°†mutexåµŒå…¥åˆ°ç»“æ„ä½“ä¸­<br></code></pre></td></tr></table></figure></li>
<li><p>è¾¹ç•Œå¤„æ‹·è´Sliceså’ŒMaps</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-number">1.</span> æ¥æ”¶Slices å’Œ Maps: å½“<span class="hljs-built_in">map</span>æˆ–<span class="hljs-built_in">slice</span>ä½œä¸ºå‡½æ•°å‚æ•°ä¼ å…¥æ—¶ï¼Œç”¨æˆ·å¯ä»¥å¯¹å…¶è¿›è¡Œä¿®æ”¹<br><span class="hljs-number">2.</span> æ³¨æ„ç”¨æˆ·å¯¹æŠ¥æ¼å†…éƒ¨çŠ¶æ€çš„<span class="hljs-built_in">map</span>æˆ–<span class="hljs-built_in">slice</span>çš„ä¿®æ”¹<br></code></pre></td></tr></table></figure></li>
<li><p>ä½¿ç”¨deferé‡Šæ”¾èµ„æº</p>
</li>
<li><p>Channelçš„sizeè¦ä¹ˆæ˜¯1ï¼Œè¦ä¹ˆæ˜¯æ— ç¼“å†²çš„</p>
</li>
<li><p>æšä¸¾ä»1å¼€å§‹:</p>
</li>
<li><p>ä½¿ç”¨timeå¤„ç†æ—¶é—´</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><code class="hljs coq"><span class="hljs-number">1.</span> <span class="hljs-built_in">time</span>.<span class="hljs-keyword">Time</span>è¡¨ç¤ºç¬æ—¶æ—¶é—´<br><span class="hljs-number">2.</span> <span class="hljs-built_in">time</span>.Durationè¡¨ç¤ºæ—¶é—´æ®µ<br><span class="hljs-number">3.</span> <span class="hljs-keyword">Time</span>.<span class="hljs-keyword">Add</span>: æŸä¸ªæ—¶åˆ»æ¯”å‰ä¸€ä¸ªæ—¶åˆ»æ™š<br><span class="hljs-number">4.</span> <span class="hljs-keyword">Time</span>.AddDate: ä¸‹ä¸€ä¸ªæ—¥å†æ—¥<br></code></pre></td></tr></table></figure></li>
<li><p>é”™è¯¯ç±»å‹</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> errors.New: å¯¹äºç®€å•é™æ€å­—ç¬¦ä¸²çš„é”™è¯¯<br><span class="hljs-bullet">2.</span> fmt.Errorf: å¯¹äºæ ¼å¼åŒ–çš„é”™è¯¯å­—ç¬¦ä¸²<br><span class="hljs-bullet">3.</span> å®ç°Error()æ–¹æ³•çš„è‡ªå®šä¹‰ç±»å‹<br><span class="hljs-bullet">4.</span> errors.Wrap: Wrapped errors<br></code></pre></td></tr></table></figure></li>
<li><p>é”™è¯¯åŒ…è£… Error Wrapping</p>
</li>
<li><p>å¤„ç†ç±»å‹æ–­è¨€å¤±è´¥</p>
</li>
<li><p>è¿½åŠ æ—¶ä¼˜å…ˆæ‰§è¡Œåˆ‡ç‰‡å®¹é‡</p>
</li>
</ul>
</li>
<li><p>æ€§èƒ½</p>
<ul>
<li>å°†åŸè¯­è½¬æ¢ä¸ºå­—ç¬¦ä¸²æˆ–ä»å­—ç¬¦ä¸²è½¬æ¢æ—¶ï¼Œstrconvé€Ÿåº¦æ¯”fmtå¿«</li>
<li>æŒ‡å®šå®¹å™¨å®¹é‡,ä»¥ä¾¿ä¸ºå®¹å™¨é¢„å…ˆåˆ†é…å†…å­˜ï¼Œå°†åœ¨æ·»åŠ å…ƒç´ æ—¶æœ€å°åŒ–åç»­åˆ†é… â€“ å®¹é‡æç¤º</li>
<li>æŒ‡å®šåˆ‡ç‰‡å®¹é‡,ç¼–è¯‘å™¨ä¸ºå…¶æä¾›make()çš„sliceçš„å®¹é‡åˆ†é…è¶³å¤Ÿçš„å†…å­˜</li>
</ul>
</li>
<li><p>è§„èŒƒ</p>
<ul>
<li><p>åŒ…å</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> å…¨éƒ¨å°å†™ï¼Œæ²¡æœ‰å¤§å†™æˆ–ä¸‹åˆ’çº¿<br><span class="hljs-bullet">2.</span> ä¸ä½¿ç”¨å¤æ•°<br><span class="hljs-bullet">3.</span> ä¸è¦ç”¨ common, util, shared, lib<br></code></pre></td></tr></table></figure></li>
<li><p>å¯¼å…¥åˆ«å</p>
<blockquote>
<p>é™¤éå¯¼å…¥ä¹‹é—´æœ‰ç›´æ¥å†²çªï¼Œå¦åˆ™é¿å…å¯¼å…¥åˆ«å</p>
</blockquote>
</li>
<li><p>å‡å°‘åµŒå¥—</p>
<blockquote>
<p>ä»£ç é€šè¿‡å°½å¯èƒ½å…ˆå¤„ç†é”™è¯¯æƒ…å†µ/ç‰¹æ®Šæƒ…å†µä»Šæ—©è¿”å›æˆ–ç»§ç»­å¾ªç¯å‡å°‘åµŒå¥—ï¼Œå‡å°‘åµŒå¥—å¤šä¸ªçº§åˆ«çš„ä»£ç çš„ä»£ç </p>
</blockquote>
</li>
<li><p>é¡¶å±‚å˜é‡å£°æ˜</p>
</li>
</ul>
</li>
</ul>
<h2 id="Golang-Tips-amp-Tracks"><a href="#Golang-Tips-amp-Tracks" class="headerlink" title="Golang Tips &amp; Tracks"></a>Golang Tips &amp; Tracks</h2><ul>
<li><strong>è´Ÿè½½å‡è¡¡ç®—æ³•å¯¹æ¯”</strong><blockquote>
<p>è´Ÿè½½å‡è¡¡æœ€é‡è¦çš„å°±æ˜¯å‡è¡¡</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>  <span class="hljs-string">&quot;fmt&quot;</span><br>  <span class="hljs-string">&quot;math/rand&quot;</span><br>  <span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> &#123;<br>  rand.Seed(time.Now().UnixNano())<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">normal_shuffle</span><span class="hljs-params">(slice []<span class="hljs-keyword">int</span>)</span></span> &#123;<br>  <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">len</span>(slice); i++ &#123;<br>    a := rand.Intn(<span class="hljs-built_in">len</span>(slice))<br>    b := rand.Intn(<span class="hljs-built_in">len</span>(slice))<br>    slice[a], slice[b] = slice[b], slice[a]<br>  &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">shuffle</span><span class="hljs-params">(indexes []<span class="hljs-keyword">int</span>)</span></span> &#123;<br>  <span class="hljs-keyword">for</span> i := <span class="hljs-built_in">len</span>(indexes); i &gt; <span class="hljs-number">0</span>; i-- &#123;<br>    lastIdx := i - <span class="hljs-number">1</span><br>    idx := rand.Intn(i)<br>    indexes[lastIdx], indexes[idx] = indexes[idx], indexes[lastIdx]<br>  &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  <span class="hljs-keyword">var</span> cnt1 = <span class="hljs-keyword">map</span>[<span class="hljs-keyword">int</span>]<span class="hljs-keyword">int</span>&#123;&#125;<br>  <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++ &#123;<br>    <span class="hljs-keyword">var</span> sl = []<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>&#125;<br>    normal_shuffle(sl)<br>    cnt1[sl[<span class="hljs-number">0</span>]]++<br>  &#125;<br><br>  <span class="hljs-keyword">var</span> cnt2 = <span class="hljs-keyword">map</span>[<span class="hljs-keyword">int</span>]<span class="hljs-keyword">int</span>&#123;&#125;<br>  <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++ &#123;<br>    <span class="hljs-keyword">var</span> sl = []<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>&#125;<br>    shuffle(sl)<br>    cnt2[sl[<span class="hljs-number">0</span>]]++<br>  &#125;<br><br>  fmt.Println(<span class="hljs-string">&quot;normal shuffle: &quot;</span>, cnt1)<br>  fmt.Println(<span class="hljs-string">&quot;fisher yates  : &quot;</span>, cnt2)<br>&#125;<br><br>chyi/<span class="hljs-keyword">go</span>-awesome-prj/shuffle via ğŸ¹ v1<span class="hljs-number">.17</span> took <span class="hljs-number">38</span>s<br>âœ <span class="hljs-keyword">go</span> run main.<span class="hljs-keyword">go</span><br>normal shuffle:  <span class="hljs-keyword">map</span>[<span class="hljs-number">0</span>:<span class="hljs-number">224558</span> <span class="hljs-number">1</span>:<span class="hljs-number">128887</span> <span class="hljs-number">2</span>:<span class="hljs-number">129201</span> <span class="hljs-number">3</span>:<span class="hljs-number">129493</span> <span class="hljs-number">4</span>:<span class="hljs-number">129487</span> <span class="hljs-number">5</span>:<span class="hljs-number">129202</span> <span class="hljs-number">6</span>:<span class="hljs-number">129172</span>]<br>fisher yates  :  <span class="hljs-keyword">map</span>[<span class="hljs-number">0</span>:<span class="hljs-number">142974</span> <span class="hljs-number">1</span>:<span class="hljs-number">143116</span> <span class="hljs-number">2</span>:<span class="hljs-number">142768</span> <span class="hljs-number">3</span>:<span class="hljs-number">142660</span> <span class="hljs-number">4</span>:<span class="hljs-number">142930</span> <span class="hljs-number">5</span>:<span class="hljs-number">142505</span> <span class="hljs-number">6</span>:<span class="hljs-number">143047</span>]<br></code></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>Programming Language</category>
      </categories>
  </entry>
  <entry>
    <title>CS - Basic Introduction</title>
    <url>/2021/09/06/CS-Time/</url>
    <content><![CDATA[<blockquote>
<p>è®¡ç®—æœºé€šè¯†ä»‹ç»</p>
</blockquote>
<span id="more"></span>

<h2 id="Time-æ—¶é—´"><a href="#Time-æ—¶é—´" class="headerlink" title="Time æ—¶é—´"></a>Time æ—¶é—´</h2><ul>
<li><p>Universal Time: ä¸–ç•Œæ—¶</p>
<blockquote>
<p>ä¾é è§‚æµ‹å¤©æ–‡ç°è±¡æ¥æµ‹é‡æ—¶é—´ï¼ŒåŸºäºåœ°çƒè‡ªè½¬è§„å¾‹</p>
</blockquote>
</li>
<li><p>International Atomic Time: å›½é™…åŸå­æ—¶</p>
<blockquote>
<p>ä»¥å¾®è§‚æ—¶é—´é“¯åŸå­çš„éœ‡è¡é¢‘ç‡ä¸ºåŸºå‡†ï¼Œåˆ¶é€ åŸå­é’Ÿ</p>
</blockquote>
</li>
<li><p>Coordinated Universal Time: åè°ƒä¸–ç•Œæ—¶</p>
<blockquote>
<p>æ ¹æ®ä¸–é—´æ—¶å’ŒåŸå­æ—¶ï¼Œæœ€ç»ˆç¡®ç«‹æ–°çš„æ—¶é—´æ ‡å‡†ï¼Œå®šä¹‰æˆä¸ºå…¨çƒçš„æ—¶é—´æ ‡å‡†</p>
</blockquote>
</li>
<li><p>NTP Network Time Protocol åŒæ­¥æ—¶é—´</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-number">1</span>. NTPå¦‚ä½•åŒæ­¥æ—¶é—´<br>  &gt; å‡è®¾ç½‘ç»œæ¥å›è·¯å¾„å¯¹ç§°ï¼Œå¹¶ä¸”å»¶è¿Ÿç›¸åŒ<br>  ç½‘ç»œå»¶æ—¶ = (t4 - t1) - (t3 - t2)<br>  æ—¶é—´å·® = t2 - t1 - ç½‘ç»œå»¶è¿Ÿ<span class="hljs-regexp">/2 = ((t2-t1) + (t3-t4))/</span><span class="hljs-number">2</span><br><span class="hljs-number">2</span>. åŒæ­¥æ—¶é—´æ—¶ï¼Œå¯¹æ­£åœ¨è¿è¡Œçš„ç¨‹åºæœ‰æ²¡æœ‰å½±å“<br>  <span class="hljs-comment"># å¢™ä¸Šæ—¶é’Ÿ: ä¸–ç•Œåè°ƒæ—¶UTCï¼Œæ ¡å‡†æ—¶é—´åï¼Œå¯èƒ½å‘ç”Ÿå›æ‹¨</span><br>  <span class="hljs-comment"># å•è°ƒæ—¶é’Ÿ: è®¡ç®—æœºè‡ªå¯åŠ¨ä»¥åçš„çº³ç§’æ•°ï¼Œä¸ä¼šå›æ‹¨</span><br><br>NTPæ ¡å‡†æ—¶é—´æä¾›<span class="hljs-number">2</span>ä¸­æ–¹å¼:<br>  <span class="hljs-number">1</span>. ntpdate: ä¸€åˆ‡å·²æœåŠ¡å™¨ç«¯æ—¶é—´ä¸ºå‡†ï¼Œå¼ºåˆ¶ä¿®æ”¹æœ¬æœºæ—¶é—´<br>  <span class="hljs-number">2</span>. ntpd: æŠŠæ—¶é—´å·®å‡æ‘Šåˆ°æ¯æ¬¡å°çš„è°ƒæ•´ä¸Š -- é¿å…å‘ç”Ÿå€’æµ<br></code></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>Computer Science</category>
      </categories>
  </entry>
  <entry>
    <title>Middleware Tips &amp; Tracks</title>
    <url>/2021/09/06/Middleware-Tips-Tracks/</url>
    <content><![CDATA[<h2 id="æŠ€æœ¯é€‰å‹"><a href="#æŠ€æœ¯é€‰å‹" class="headerlink" title="æŠ€æœ¯é€‰å‹"></a>æŠ€æœ¯é€‰å‹</h2><blockquote>
<p>é¢å¯¹æŠ€æœ¯é€‰å‹æ—¶ï¼Œå°±æ˜¯ä¸€ä¸ªå…³äºå¦‚ä½•å–èˆçš„é—®é¢˜ï¼Œä¸è¦ä¸ç»è¿‡æ€è€ƒå°±è§‰å¾—é‚£ä¸ªæ–¹æ¡ˆå¥½ï¼Œé‚£ä¸ªæ–¹æ¡ˆä¸å¥½ã€‚éœ€è¦æ ¹æ®å…·ä½“åœºæ™¯åˆ†æ<br>æŠ€æœ¯é€‰å‹ä¸åªæ˜¯æŠ€æœ¯é—®é¢˜ï¼Œè¿˜ä¸å›¢é˜Ÿã€ç®¡ç†ã€ç»„ç»‡ç»“æ„æœ‰å…³</p>
</blockquote>
<ul>
<li>ä¸šåŠ¡åŠŸèƒ½è§’åº¦</li>
<li>æŠ€æœ¯èµ„æºè§’åº¦<blockquote>
<p>æ‰€å¤„çš„ç¯å¢ƒã€æŠ€æœ¯èµ„æºèƒ½å¦åŒ¹é…è¿™äº›æŠ€æœ¯æ–¹æ¡ˆ</p>
</blockquote>
</li>
</ul>
<span id="more"></span>

<h2 id="æ¶ˆæ¯ä¸­é—´ä»¶"><a href="#æ¶ˆæ¯ä¸­é—´ä»¶" class="headerlink" title="æ¶ˆæ¯ä¸­é—´ä»¶"></a>æ¶ˆæ¯ä¸­é—´ä»¶</h2><figure class="highlight haml"><table><tr><td class="code"><pre><code class="hljs haml"># ä¸“ä¸šæ¶ˆæ¯ä¸­é—´ä»¶éœ€è¦æ»¡è¶³:<br>  1. æ¶ˆæ¯ä¸ä¸¢å¤±<br>    a. ç”Ÿäº§è€…ä¼šä¸ä¼šä¸¢æ¶ˆæ¯?<br>      -<span class="ruby"> æ¶ˆæ¯æ²¡å‘é€å‡ºå»: ç½‘ç»œæ•…éšœæˆ–è€…å…¶ä»–åŸå› å¯¼è‡´å‘å¸ƒå¤±è´¥ï¼Œä¸­é—´ä»¶ç›´æ¥è¿”å›å¤±è´¥</span><br><span class="ruby"></span>      -<span class="ruby"> ä¸ç¡®å®šæ˜¯å¦å‘é€æˆåŠŸ: ç½‘ç»œé—®é¢˜å¯¼è‡´å‘å¸ƒè¶…æ—¶ï¼Œå¯èƒ½æ•°æ®å·²å‘é€æˆåŠŸï¼Œä½†æ˜¯è¯»å–å“åº”ç»“æœè¶…æ—¶</span><br><span class="ruby"></span><br>      ç”Ÿäº§è€…è®¾ç½®æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œè¶…è¿‡ä¸Šé™ä¾æ—§å¤±è´¥ï¼Œéœ€è¦è®°å½•æ—¥å¿—æŠ¥è­¦å¤„ç†, ç”Ÿäº§è€…ä¼šä¸ä¼šä¸¢æ¶ˆæ¯ï¼Œå–å†³äºç”Ÿäº§è€…å¯¹äºå¼‚å¸¸æƒ…å†µçš„å¤„ç†æ˜¯å¦åˆç†, ä¿è¯æ¶ˆæ¯ä¸ä¸¢ï¼Œå®å¯é‡å‘ï¼Œä¹Ÿä¸èƒ½ä¸¢å¼ƒ<br>    b. æ¶ˆè´¹è€…ä¼šä¸ä¼šä¸¢æ¶ˆæ¯?<br>      -<span class="ruby"> æ¶ˆè´¹è€…åœ¨å¤„ç†å®Œæ¶ˆæ¯åï¼Œå¿…é¡»å‘ŠçŸ¥é˜Ÿåˆ—ä¸­é—´ä»¶ï¼Œé˜Ÿåˆ—ä¸­é—´ä»¶æ‰ä¼šæŠŠæ ‡è®°å·²å¤„ç†ï¼Œå¦åˆ™ä»æ—§æŠŠè¿™äº›æ•°æ®å‘ç»™æ¶ˆè´¹è€…</span><br><span class="ruby"></span>    c. é˜Ÿåˆ—ä¸­é—´ä»¶ä¼šä¸ä¼šä¸¢æ¶ˆæ¯?<br>      -<span class="ruby"> ç”Ÿäº§è€…åœ¨å‘å¸ƒæ¶ˆæ¯æ—¶ï¼Œé˜Ÿåˆ—ä¸­é—´ä»¶é€šå¸¸ä¼šå†™å¤šä¸ªèŠ‚ç‚¹ï¼Œä»¥æ­¤ä¿è¯æ¶ˆæ¯çš„å®Œæ•´æ€§ï¼Œå³ä¾¿å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹æŒ‚ï¼Œä¹Ÿèƒ½ä¿è¯é›†ç¾¤æ•°æ®ä¸ä¸¢å¤±</span><br><span class="ruby"></span>  2. æ¶ˆæ¯å¯å †ç§¯<br></code></pre></td></tr></table></figure>
<ul>
<li>Redis ä½œä¸ºæ¶ˆæ¯ä¸­é—´ä»¶<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> Redisæœ¬èº«å¯èƒ½ä¼šä¸¢æ•°æ®<br><span class="hljs-bullet">2.</span> é¢å¯¹æ¶ˆæ¯ç§¯å‹ï¼ŒRediså†…å­˜èµ„æºç´§å¼ <br></code></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>Middleware</category>
      </categories>
  </entry>
  <entry>
    <title>Protocol Buffer Intro</title>
    <url>/2021/09/07/Protocol-Buffer-Intro/</url>
    <content><![CDATA[<h1 id="Protocol-Buffers"><a href="#Protocol-Buffers" class="headerlink" title="Protocol Buffers"></a>Protocol Buffers</h1><blockquote>
<p>Google å¼€å‘çš„ä¸€å¥—å¯¹æ•°æ®ç»“æ„è¿›è¡Œåºåˆ—åŒ–çš„æ–¹æ³•ï¼Œå¯ç”¨ä½œæ•°æ®é€šä¿¡åè®®ã€æ•°æ®å­˜å‚¨æ ¼å¼ã€‚</p>
</blockquote>
<ul>
<li>ä¸»è¦ç‰¹å¾<ul>
<li>æ›´å¿«çš„æ•°æ®ä¼ è¾“é€Ÿåº¦ï¼šprotobufä¼ è¾“å°†æ•°æ®åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶æ•°æ®ï¼ŒJSONæ–‡æœ¬ä¼ è¾“æ ¼å¼ èŠ‚çœå¤§é‡IOæ“ä½œï¼Œæé«˜æ•°æ®ä¼ è¾“é€Ÿåº¦</li>
<li>è·¨å¹³å°å¤šè¯­è¨€ï¼šprotobufç¼–è¯‘å·¥å…·protocåŸºäºprotobufå®šä¹‰æ–‡ä»¶ï¼Œç¼–è¯‘å‡ºä¸åŒè¯­è¨€çš„å®¢æˆ·ç«¯æˆ–è€…æœåŠ¡ç«¯</li>
<li>è‰¯å¥½çš„æ‰©å±•æ€§å’Œå…¼å®¹æ€§:</li>
<li>åŸºäºIDLæ–‡ä»¶å®šä¹‰æœåŠ¡ï¼Œé€šè¿‡proto3å·¥å…·ç”ŸæˆæŒ‡å®šè¯­è¨€çš„æ•°æ®ç»“æ„,æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ¥å£</li>
</ul>
</li>
</ul>
<span id="more"></span>


]]></content>
      <categories>
        <category>Microservice</category>
      </categories>
  </entry>
  <entry>
    <title>API Design</title>
    <url>/2021/09/07/RESTful-API-Design/</url>
    <content><![CDATA[<blockquote>
<p>ç›®å‰ä¸šç•Œå¸¸ç”¨çš„APIé£æ ¼</p>
</blockquote>
<ul>
<li>RESTful</li>
<li>RPC</li>
<li>GraphQL</li>
</ul>
<span id="more"></span>

<h2 id="RESTful-API"><a href="#RESTful-API" class="headerlink" title="RESTful API"></a>RESTful API</h2><blockquote>
<p>Representational State Transfer - è¡¨ç°å±‚çŠ¶æ€è½¬ç§»<br>RESTæ˜¯ä¸€ç§è½¯ä»¶æ¶æ„é£æ ¼ï¼Œæ˜¯ä¸€ç»„æ¶æ„çº¦æŸæ¡ä»¶å’ŒåŸåˆ™<br>RESTè§„èŒƒæŠŠæ‰€æœ‰å†…å®¹éƒ½è§†ä¸ºèµ„æº<br>RESTæ˜¯ä¸€ç§è§„èŒƒï¼Œè€ŒRESTful APIåˆ™æ˜¯æ»¡è¶³è¿™ç§è§„èŒƒçš„APIæ¥å£</p>
</blockquote>
<ul>
<li><p>HTTPåŠ¨è¯ä¸RESTé£æ ¼CRUDå¯¹åº”å…³ç³»</p>
<table>
<thead>
<tr>
<th align="left">HTTPæ–¹æ³•</th>
<th align="left">è¡Œä¸º</th>
<th align="left">URI</th>
<th align="left">ç¤ºä¾‹è¯´æ˜</th>
<th align="left">æ˜¯å¦å®‰å…¨</th>
<th align="left">æ˜¯å¦å¹‚ç­‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">GET</td>
<td align="left">è·å–èµ„æºåˆ—è¡¨</td>
<td align="left">/users</td>
<td align="left">è·å–ç”¨æˆ·åˆ—è¡¨</td>
<td align="left">æ˜¯</td>
<td align="left">æ˜¯</td>
</tr>
<tr>
<td align="left">GET</td>
<td align="left">è·å–ä¸€ä¸ªå…·ä½“èµ„æº</td>
<td align="left">/users/admin</td>
<td align="left">è·å–adminç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯</td>
<td align="left">æ˜¯</td>
<td align="left">æ˜¯</td>
</tr>
<tr>
<td align="left">POST</td>
<td align="left">åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„æº</td>
<td align="left">/users</td>
<td align="left">åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·</td>
<td align="left">å¦</td>
<td align="left">å¦</td>
</tr>
<tr>
<td align="left">PUT</td>
<td align="left">ä»¥æ•´ä½“çš„æ–¹å¼æ›´æ–°ä¸€ä¸ªèµ„æº</td>
<td align="left">/users/admin</td>
<td align="left">æ›´æ–°userä¸ºadminçš„ç”¨æˆ·</td>
<td align="left">å¦</td>
<td align="left">æ˜¯</td>
</tr>
<tr>
<td align="left">DELETE</td>
<td align="left">åˆ é™¤æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ªèµ„æº</td>
<td align="left">/users/admin</td>
<td align="left">åˆ é™¤userä¸ºadminçš„ç”¨æˆ·</td>
<td align="left">å¦</td>
<td align="left">æ˜¯</td>
</tr>
</tbody></table>
<figure class="highlight basic"><table><tr><td class="code"><pre><code class="hljs basic"><span class="hljs-number">1</span>. <span class="hljs-keyword">GET</span>,<span class="hljs-keyword">PUT</span>,POSTæ“ä½œçš„èµ„æºå±æ€§ä¸€è‡´<br><span class="hljs-number">2</span>. èµ„æºè¿›è¡ŒçŠ¶æ€/å±æ€§å˜æ›´ï¼Œè¦ç”¨<span class="hljs-keyword">PUT</span>æ–¹æ³•ï¼ŒPOSTæ–¹æ³•ç”¨æ¥åˆ›å»ºæˆ–è€…æ‰¹é‡åˆ é™¤<br></code></pre></td></tr></table></figure>

<ul>
<li><p>æ ¸å¿ƒç‰¹ç‚¹</p>
<ol>
<li>ä»¥èµ„æºresourceä¸ºä¸­å¿ƒ, æ‰€æœ‰çš„ä¸œè¥¿éƒ½æŠ½è±¡ç§°èµ„æºï¼Œæ‰€æœ‰çš„è¡Œä¸ºéƒ½åº”è¯¥æ˜¯åœ¨èµ„æºä¸Šçš„CRUDæ“ä½œ</li>
<li>èµ„æºæ˜¯æœ‰çŠ¶æ€çš„ï¼Œä½¿ç”¨JSON/XMLç­‰åœ¨HTTP Bodyé‡Œè¡¨å¾èµ„æºçš„çŠ¶æ€</li>
<li>å®¢æˆ·ç«¯é€šè¿‡å››ä¸ªHTTPåŠ¨è¯ï¼Œå¯¹æœåŠ¡å™¨èµ„æºè¿›è¡Œæ“ä½œ, å®ç°â€œè¡¨ç°å±‚çŠ¶æ€è½¬åŒ–â€</li>
<li>æ— çŠ¶æ€, å¯¹äºæœåŠ¡ç«¯çš„å¼¹æ€§æ‰©å®¹æ˜¯å¾ˆé‡è¦çš„</li>
</ol>
</li>
<li><p>RESTful API è®¾è®¡åŸåˆ™</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-comment"># URIè®¾è®¡</span><br>  1. èµ„æºåä½¿ç”¨åè¯è€Œä¸æ˜¯åŠ¨è¯,å¹¶ä¸”ç”¨åè¯å¤æ•°è¡¨ç¤º<br>  2. URIç»“å°¾ä¸åŒ…å«/<br>  3. URIä¸­ä¸èƒ½å‡ºç°ä¸‹åˆ’çº¿,å¿…é¡»ä½¿ç”¨ä¸­æ ä»£æ›¿<br>  4. URIè·¯å¾„shyingå°å†™ï¼Œä¸ä½¿ç”¨å¤§å†™<br>  5. é¿å…å±‚çº§è¿‡æ·±çš„URIï¼Œè¶…è¿‡2å±‚çš„èµ„æºåµŒå¥—ä¼šå¾ˆä¹±,å»ºè®®å…¶ä»–èµ„æºè½¬æ¢ä¸º?å‚æ•°<br><br><span class="hljs-comment"># å®‰å…¨æ€§: ä¸ä¼šæ”¹å˜èµ„æºçŠ¶æ€</span><br><span class="hljs-comment"># å¹‚ç­‰æ€§: æ‰§è¡Œ1æ¬¡å’Œæ‰§è¡ŒNæ¬¡ï¼Œå¯¹èµ„æºçŠ¶æ€æ”¹å˜çš„æ•ˆæœæ˜¯ç­‰ä»·çš„</span><br><br><span class="hljs-comment"># APIç‰ˆæœ¬ç®¡ç†</span><br>  1. URLä¸­ <span class="hljs-string">/v1/users</span><br>  2. HTTP Headerä¸­, Accept: <span class="hljs-keyword">version</span>=1.0<br>  3. Formå‚æ•°ä¸­, <span class="hljs-string">/users</span>?<span class="hljs-keyword">version</span>=v1<br><br><span class="hljs-comment"># APIå‘½å:</span><br>  1. é©¼å³°å‘½åæ³• serverAddress<br>  2. è›‡å½¢å‘½åæ³• server_address<br>  3. è„ŠæŸ±å‘½åæ³• server-address -- GitHub API ä½¿ç”¨çš„è„ŠæŸ±å‘½å<br><br><span class="hljs-comment"># ç»Ÿä¸€åˆ†é¡µ/è¿‡æ»¤/æ’åº/æœç´¢åŠŸèƒ½</span><br>  1. åˆ†é¡µ: <span class="hljs-string">/users</span>?offset=0&amp;limit20<br>  2. è¿‡æ»¤: <span class="hljs-string">/users</span>?fields=email,username,address<br>  3. æ’åº: <span class="hljs-string">/users</span>?sort=age,desc<br>  4. æœç´¢:<br><br><span class="hljs-comment"># åŸŸå</span><br>  1. https:<span class="hljs-string">//chyidl.com/api</span> : è¿™ç§æ–¹å¼é€‚åˆAPIä¸ä¼šæœ‰è¿›ä¸€æ­¥æ‰©å±•çš„æƒ…å†µ<br>  2. https:<span class="hljs-string">//storage.api.chyidl.com</span> : chyidl.comåŸŸåä¸‹ä¼šæ–°å¢å¦ä¸€ä¸ªç³»ç»ŸAPI<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="RPC-API"><a href="#RPC-API" class="headerlink" title="RPC API"></a>RPC API</h2><blockquote>
<p>RPC (Remote Procedure Call) è¿œç¨‹è¿‡ç¨‹è°ƒç”¨</p>
</blockquote>
<ul>
<li><p>RPCè°ƒç”¨æµç¨‹</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><code class="hljs arduino"><span class="hljs-number">1.</span> <span class="hljs-built_in">Client</span> é€šè¿‡æœ¬åœ°è°ƒç”¨<span class="hljs-built_in">Client</span> Stub --<br><span class="hljs-number">2.</span> <span class="hljs-built_in">Client</span> Stubå°†å‚æ•°æ‰“åŒ…ç§°ä¸€ä¸ªæ¶ˆæ¯ï¼Œç„¶åå‘é€è¿™ä¸ªæ¶ˆæ¯<br><span class="hljs-number">3.</span> <span class="hljs-built_in">Client</span>æ‰€åœ¨çš„OSå°†æ¶ˆæ¯å‘é€ç»™<span class="hljs-built_in">Server</span><br><span class="hljs-number">4.</span> <span class="hljs-built_in">Server</span>ç«¯æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå°†æ¶ˆæ¯ä¼ é€’ç»™<span class="hljs-built_in">Server</span> Stub<br><span class="hljs-number">5.</span> <span class="hljs-built_in">Server</span> Stubå°†æ¶ˆæ¯è§£åŒ…ï¼Œå¾—åˆ°å‚æ•°<br><span class="hljs-number">6.</span> <span class="hljs-built_in">Server</span> Stubè°ƒç”¨æœåŠ¡ç«¯çš„å­ç¨‹åºï¼Œå¤„ç†å®Œåï¼Œæœ€ç»ˆç»“æœæŒ‰ç…§ç›¸åçš„æ­¥éª¤è¿”å›ç»™<span class="hljs-built_in">Client</span><br><br>Stub: è´Ÿè´£è°ƒç”¨å‚æ•°å’Œè¿”å›å€¼çš„æµåŒ–serializationã€å‚æ•°çš„æ‰“åŒ…å’Œè§£åŒ…ã€ä»¥åŠç½‘ç»œå±‚çš„é€šä¿¡.<br><br>google gRPC<br>Facebook Thrift<br></code></pre></td></tr></table></figure></li>
<li><p>RESTful VS gRPC</p>
<table>
<thead>
<tr>
<th align="left">å¯¹æ¯”é¡¹</th>
<th align="left">RESTful</th>
<th align="left">gRPC</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ä¼˜ç‚¹</td>
<td align="left">1. RESTæ›´è§„èŒƒã€æ›´æ ‡å‡†ã€æ›´é€šç”¨ æ— è®ºé‚£ç§è¯­è¨€éƒ½æ”¯æŒHTTPåè®®ï¼Œå¯ä»¥å¯¹æ¥å¤–éƒ¨å¾ˆå¤šç³»ç»Ÿ</td>
<td align="left">1. å±è”½ç½‘ç»œç»†èŠ‚ï¼Œè°ƒç”¨è¿œç¨‹æ¥å£åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ï¼Œè°ƒç”¨ç®€å•ã€æ–¹ä¾¿</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">2. RESTfulæ¥å£é‡‡ç”¨JSONä½œä¸ºæ•°æ®é€šä¿¡æ ¼å¼ï¼ŒJSONæ ¼å¼å¯è¯»æ€§å¼º</td>
<td align="left">2. gRPCé‡‡ç”¨Protocol Bufferä½œä¸ºæ•°æ®ä¼ è¾“æ ¼å¼ï¼Œæ•ˆç‡é«˜</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">3. å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ¾è€¦åˆ</td>
<td align="left">3.gRPCåŸºäºHTTP/2åè®®æ ‡å‡†ï¼Œæ€§èƒ½æ›´é«˜</td>
</tr>
<tr>
<td align="left">ç¼ºç‚¹</td>
<td align="left">1.æ‰©å±•æ€§å·®ï¼Œéšç€éœ€æ±‚å˜åŒ–</td>
<td align="left">1.Protobufæ•°æ®æ ¼å¼å¯è¯»æ€§å·®</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">2.æ€§èƒ½ç›¸å¯¹äºgRPCåä½</td>
<td align="left">2.gRPCä¸æ”¯æŒæµè§ˆå™¨è°ƒç”¨,è°ƒè¯•ä¸æ–¹ä¾¿</td>
</tr>
<tr>
<td align="left">ä½¿ç”¨åœºæ™¯</td>
<td align="left">1. æ¥å£å¯¹å¤–ï¼Œéœ€è¦æ¥å£è§„èŒƒæ˜“æ‡‚</td>
<td align="left">1.æ¶ˆæ¯å¯†é›†å‹ã€å¯¹ç³»ç»Ÿæ€§èƒ½å’Œå»¶æ—¶è¦æ±‚æ¯”è¾ƒé«˜</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">2.ç³»ç»Ÿèƒ½è¦æ±‚ä¸é«˜</td>
<td align="left">2.åå‘å†…éƒ¨çš„API</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">3.æä¾›APIå¤©ç”Ÿå›´ç»•èµ„æºã€å¯¹è±¡ã€ç®¡ç†å±•å¼€</td>
<td align="left">3.æä¾›APIå¾ˆéš¾è¿›è¡Œèµ„æºã€å¯¹è±¡æŠ½è±¡</td>
</tr>
</tbody></table>
</li>
</ul>
]]></content>
      <categories>
        <category>Microservice</category>
      </categories>
  </entry>
  <entry>
    <title>gRPC Intro</title>
    <url>/2021/09/07/gRPC-Intro/</url>
    <content><![CDATA[<h1 id="gRPC"><a href="#gRPC" class="headerlink" title="gRPC"></a>gRPC</h1><blockquote>
<p>Googleå¼€å‘å…±æ€§èƒ½ã€å¼€æºã€è·¨ç¼–ç¨‹è¯­è¨€çš„é€šç”¨RPCæ¡†æ¶ï¼ŒåŸºäºHTTP2.0åè®®å¼€å‘ï¼Œé»˜è®¤é‡‡ç”¨Protocol Buffersæ•°æ®åºåˆ—åŒ–åè®®</p>
</blockquote>
]]></content>
      <categories>
        <category>Microservice</category>
      </categories>
  </entry>
  <entry>
    <title>Gin Crash Course</title>
    <url>/2021/09/08/Gin-Crash-Course/</url>
    <content><![CDATA[<h1 id="Gin-Web-Framework"><a href="#Gin-Web-Framework" class="headerlink" title="Gin Web Framework"></a>Gin Web Framework</h1><blockquote>
<p>Ginæ˜¯Goè¯­è¨€ç¼–å†™çš„Webæ¡†æ¶ï¼ŒåŠŸèƒ½å®Œå–„ï¼Œä½¿ç”¨ç®€å•ï¼Œæ€§èƒ½é«˜ï¼ŒGinæ ¸å¿ƒçš„è·¯ç”±åŠŸèƒ½æ˜¯é€šè¿‡HttpRouterå®ç°ï¼Œå…·æœ‰å¾ˆé«˜çš„è·¯ç”±æ€§èƒ½.</p>
</blockquote>
<span id="more"></span>

<h2 id="WebæœåŠ¡æ ¸å¿ƒåŠŸèƒ½"><a href="#WebæœåŠ¡æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="WebæœåŠ¡æ ¸å¿ƒåŠŸèƒ½"></a>WebæœåŠ¡æ ¸å¿ƒåŠŸèƒ½</h2><ul>
<li><p>åŸºç¡€åŠŸèƒ½</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><code class="hljs vala"><span class="hljs-meta"># é€šä¿¡åè®®: HTTP/HTTPS/gRPC</span><br><span class="hljs-meta"># é€šä¿¡æ ¼å¼: JSON/Protobuf</span><br><span class="hljs-meta"># è·¯ç”±åŒ¹é…</span><br>  &gt; HTTPæ–¹æ³•ï¼Œè¯·æ±‚è·¯å¾„åŒ¹é…åˆ°å¤„ç†è¿™ä¸ªè¯·æ±‚çš„å‡½æ•°,æœ€ç»ˆç”±æ”¹å‡½æ•°å¤„ç†è¿™æ¬¡è¯·æ±‚ï¼Œå¹¶è¿”å›ç»“æœ<br><span class="hljs-meta"># è·¯ç”±åˆ†ç»„</span><br><span class="hljs-meta"># ä¸€è¿›ç¨‹å¤šæœåŠ¡</span><br><span class="hljs-meta"># ä¸šåŠ¡å¤„ç†</span><br>  <span class="hljs-number">1.</span> å‚æ•°è§£æ<br>  <span class="hljs-number">2.</span> å‚æ•°æ ¡éªŒ<br>  <span class="hljs-number">3.</span> é€»è¾‘å¤„ç†<br>  <span class="hljs-number">4.</span> è¿”å›ç»“æœ<br></code></pre></td></tr></table></figure></li>
<li><p>é«˜çº§åŠŸèƒ½</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-comment"># ä¸­é—´ä»¶</span><br>  &gt; Ginæ”¯æŒä¸­é—´ä»¶ï¼ŒHTTPè¯·æ±‚åœ¨è½¬å‘åˆ°å®é™…çš„å¤„ç†å‡½æ•°ä¹‹å‰ï¼Œä¼šè¢«ä¸€ç³»åˆ—åŠ è½½çš„ä¸­é—´ä»¶è¿›è¡Œå¤„ç†<br>  gin.Engine.<span class="hljs-keyword">Use</span>() æ–¹æ³•åŠ è½½ä¸­é—´ä»¶<br></code></pre></td></tr></table></figure>
<p>gin.Logger(): Loggerä¸­é—´ä»¶å°†æ—¥å¿—å†™åˆ°gin.DefaultWriter, gin.DefaultWriteré»˜è®¤ä¸ºos.Stdout<br>gin.Recovery(): Recoveryä¸­é—´ä»¶å¯ä»¥ä»ä»»ä½•panicæ¢å¤ï¼Œå¹¶å†™å…¥500çŠ¶æ€<br>gin.CustomRecovery(handle gin.RecoverFunc):<br>gin.BasicAuth(): HTTP è¯·æ±‚åŸºæœ¬è®¤è¯</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><code class="hljs gherkin"><br>|<span class="hljs-string">ä¸­é—´ä»¶   </span>|<span class="hljs-string"> åŠŸèƒ½                  </span>|<br>|<span class="hljs-string">:--------</span>|<span class="hljs-string">:----------------------</span>|<br>|<span class="hljs-string"> gin-jwt </span>|<span class="hljs-string"> JWTä¸­é—´ä»¶ï¼Œå®ç°JWTè®¤è¯</span>|<br>|<span class="hljs-string"> gin-swagger</span>|<span class="hljs-string"> è‡ªåŠ¨ç”ŸæˆSwagger 2.0æ ¼å¼çš„RESTful APIæ–‡æ¡£</span>|<br>|<span class="hljs-string"> cors</span>|<span class="hljs-string"> å®ç°HTTPè¯·æ±‚è·¨åŸŸ</span>|<br>|<span class="hljs-string">sessions</span>|<span class="hljs-string">ä¼šè¯ç®¡ç†ä¸­é—´ä»¶</span>|<br>|<span class="hljs-string">authz</span>|<span class="hljs-string"> åŸºäºcasbinæˆæƒä¸­é—´ä»¶</span>|<br>|<span class="hljs-string">pprof</span>|<span class="hljs-string"> gin pprof ä¸­é—´ä»¶</span>|<br>|<span class="hljs-string">go-gin-prometheus</span>|<span class="hljs-string">Prometheus metrics exporter</span>|<br>|<span class="hljs-string">gzip</span>|<span class="hljs-string"> æ”¯æŒHTTPè¯·æ±‚å’Œå“åº”çš„gzipå‹ç¼©</span>|<br>|<span class="hljs-string">gin-limit</span>|<span class="hljs-string">HTTPè¯·æ±‚å¹¶å‘æ§åˆ¶ä¸­é—´ä»¶</span>|<br>|<span class="hljs-string">requestid</span>|<span class="hljs-string">ç»™æ¯ä¸ªRequestç”Ÿæˆuuid,å¹¶æ·»åŠ åœ¨è¿”å›çš„X-Request-ID Headerä¸­</span>|<br><br>  <span class="hljs-comment"># è®¤è¯</span><br></code></pre></td></tr></table></figure>
<p>è®¤è¯: Authentication: ç”¨æ¥éªŒè¯æŸä¸ªç”¨æˆ·æ˜¯å¦å…·æœ‰è®¿é—®ç³»ç»Ÿçš„æƒé™ â€“ è¯æ˜ä½ æ˜¯è°<br>æˆæƒ: Authorization: ç”¨æ¥éªŒè¯æŸä¸ªç”¨æˆ·æ˜¯å¦å…·æœ‰è®¿é—®æŸä¸ªèµ„æºçš„æƒé™ â€“ å†³å®šä½ èƒ½åšä»€ä¹ˆ</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> Basic: åŸºç¡€è®¤è¯<br></code></pre></td></tr></table></figure>
<p>   ç”¨æˆ·å:å¯†ç : base64ç¼–ç åï¼Œæ”¾åˆ°HTTP Authorization Header<br>  github.com/chyidl/noone via ğŸ¹ v1.17<br>  âœ basic=<code>echo -n &#39;admin:Admin@2021&#39;|base64</code></p>
<p>  github.com/chyidl/noone via ğŸ¹ v1.17<br>  âœ echo $basic<br>  YWRtaW46QWRtaW5AMjAyMQ==</p>
<p>  github.com/chyidl/noone via ğŸ¹ v1.17<br>  âœ echo $basic | base64 â€“decode<br>  admin:Admin@2021%</p>
<p>Basicè®¤è¯ç®€å•,ä½†æ˜¯ä¸å®‰å…¨, ä½¿ç”¨Basicè®¤è¯+SSLé…åˆä½¿ç”¨ç¡®ä¿æ•´ä¸ªè®¤è¯è¿‡ç¨‹å®‰å…¨</p>
<blockquote>
<p>ä¸è¦å†è¯·æ±‚å‚æ•°ä¸­ä½¿ç”¨æ˜æ–‡å¯†ç ï¼Œä¸è¦åœ¨ä»»ä½•å­˜å‚¨ä¸­ä¿å­˜æ˜æ–‡å¯†ç </p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">2.</span> Digest<br><span class="hljs-bullet">3.</span> OAuth<br><span class="hljs-bullet">4.</span> Bearer<br><span class="hljs-quote">&gt; Bearerè®¤è¯ç§°ä¸ºä»¤ç‰Œè®¤è¯ã€‚æ˜¯ä¸€ç§HTTPèº«ä»½éªŒè¯æ–¹å¼. Bearerè®¤è¯çš„æ ¸å¿ƒæ˜¯bearer token.</span><br></code></pre></td></tr></table></figure>
<p>bearer token: æ˜¯ä¸€ä¸ªåŠ å¯†å­—ç¬¦ä¸²ï¼Œç”±æœåŠ¡ç«¯æ ¹æ®å¯†é’¥ç”Ÿæˆ, å®¢æˆ·ç«¯åœ¨è¯·æ±‚æœåŠ¡ç«¯æ—¶ï¼Œå¿…é¡»åœ¨è¯·æ±‚å¤´åŒ…å«Authorization: Bearer <token>. æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚å¤´ï¼Œè§£æå‡º<token>.æ ¡éªŒ<token>åˆæ³•æ€§ï¼ŒBearerè®¤è¯é…åˆHTTPSä½¿ç”¨ï¼Œä¿è¯è®¤è¯å®‰å…¨æ€§</p>
<p>JSON Web Token: JWT<br>JWTæ˜¯Bearer Tokenä¸€ä¸ªå…·ä½“å®ç°ï¼Œç”±JSONæ•°æ®æ ¼å¼ç»„æˆ, é€šè¿‡HASHæ•£åˆ—ç®—æ³•ç”Ÿæˆå­—ç¬¦ä¸².</p>
<h1 id="JWT-è®¤è¯æµç¨‹"><a href="#JWT-è®¤è¯æµç¨‹" class="headerlink" title="JWT è®¤è¯æµç¨‹:"></a>JWT è®¤è¯æµç¨‹:</h1><blockquote>
<p>ä¸è¦å­˜æ”¾æ•æ„Ÿä¿¡æ¯åˆ°Tokenä¸­<br>Payload expå€¼ä¸è¦è®¾ç½®å¤ªå¤§ï¼Œä¸€èˆ¬å¼€å‘ç‰ˆæœ¬2å°æ—¶ï¼Œä¸Šçº¿ç‰ˆæœ¬7å¤©</p>
</blockquote>
<ol>
<li>å®¢æˆ·ç«¯ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç è¯·æ±‚ç™»é™†</li>
<li>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åï¼Œä¼šéªŒè¯ç”¨æˆ·åå’Œå¯†ç ï¼Œå¦‚æœç”¨æˆ·åå’Œå¯†ç éªŒè¯æˆåŠŸï¼ŒæœåŠ¡ç«¯ç­¾å‘Tokenè¿”å›ç»™å®¢æˆ·ç«¯</li>
<li>å®¢æˆ·ç«¯æ”¶åˆ°è¯·æ±‚åå°†Tokenç¼“å­˜èµ·æ¥ Cookieä¸­æˆ–è€…LocalStorage,ä¹‹åæ¯æ¬¡è¯·æ±‚éƒ½ä¼šæºå¸¦è¯¥Token</li>
<li>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åï¼ŒéªŒè¯è¯·æ±‚ä¸­çš„Token,éªŒè¯é€šè¿‡åˆ™è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œå¤„ç†å®Œè¿”å›å¤„ç†ç»“æœ</li>
</ol>
<h1 id="JWTæ ¼å¼"><a href="#JWTæ ¼å¼" class="headerlink" title="JWTæ ¼å¼:"></a>JWTæ ¼å¼:</h1><p>  1.Header</p>
<div class="code-wrapper"><pre><code class="hljs">- ç±»å‹å£°æ˜ JWT
- å£°æ˜åŠ å¯†ç®—æ³• HMAC SHA256
- å¯†é’¥ID å¯é€‰
  &#123;
    &quot;typ&quot;: &quot;JWT&quot;,
    &quot;alg&quot;: &quot;HS256&quot;
    &quot;kid&quot;: &quot;youknowwhoami&quot;
  &#125;
  Headerè¿›è¡Œbase64ç¼–ç 
  github.com/chyidl/noone via ğŸ¹ v1.17
  âœ echo -n &#39;&#123;&quot;typ&quot;:&quot;JWT&quot;,&quot;alg&quot;:&quot;HS256&quot;,&quot;kid&quot;:&quot;youknowwhoami&quot;&#125;&#39;|base64
  eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiIsImtpZCI6InlvdWtub3d3aG9hbWkifQ==
</code></pre></div>
<p>  2.Payload</p>
<div class="code-wrapper"><pre><code class="hljs">- JWTæ ‡å‡†ä¸­æ³¨å†Œçš„å£°æ˜
<figure class="highlight stylus"><table><tr><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">iss</span><span class="hljs-params">(Issuer)</span></span>: JWT Tokençš„ç­¾å‘è€…<br><span class="hljs-function"><span class="hljs-title">sub</span><span class="hljs-params">(Subject)</span></span>: ä¸»é¢˜<br><span class="hljs-function"><span class="hljs-title">exp</span><span class="hljs-params">(Expiration Time)</span></span>: JWT Tokenè¿‡æœŸæ—¶é—´<br><span class="hljs-function"><span class="hljs-title">aud</span><span class="hljs-params">(Audience)</span></span>: æ¥å—JWT Tokençš„ä¸€æ–¹<br><span class="hljs-function"><span class="hljs-title">iat</span><span class="hljs-params">(Issued At)</span></span>: JWT Tokenç­¾å‘æ—¶é—´<br><span class="hljs-function"><span class="hljs-title">nbf</span><span class="hljs-params">(Not Before)</span></span>: JWT Tokenç”Ÿæ•ˆæ—¶é—´<br><span class="hljs-function"><span class="hljs-title">jti</span><span class="hljs-params">(JWT ID)</span></span>: JWT Token ID,ä»¤ç‰Œçš„å”¯ä¸€æ ‡è¯†ç¬¦<br></code></pre></td></tr></table></figure>
- å…¬å…±çš„å£°æ˜
  &gt; æ·»åŠ ç”¨æˆ·ç›¸å…³ä¿¡æ¯æˆ–è€…å…¶ä»–ä¸šåŠ¡éœ€è¦ä¿¡æ¯
- ç§æœ‰çš„å£°æ˜
  &gt; å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å…±åŒå®šä¹‰çš„å£°æ˜ï¼Œbase64æ˜¯å¯¹ç§°åŠ å¯†ï¼Œä¸å»ºè®®å­˜æ”¾æ•æ„Ÿä¿¡æ¯
</code></pre>
<p>  3.Signature ç­¾å</p>
<div class="code-wrapper"><pre><code class="hljs">- header(base64åçš„)
- payload(base64å)
- secretKey: å¯†é’¥ï¼Œä¿å­˜åœ¨æœåŠ¡å™¨ä¸­ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶ä¿å­˜
- Salt(åŠ å¯†ç›)
<figure class="highlight gauss"><table><tr><td class="code"><pre><code class="hljs gauss">æœåŠ¡ç«¯æ”¶åˆ°<span class="hljs-built_in">Token</span>åä¼šè§£æå‡ºheader.payload ç„¶åç”¨ç›¸åŒçš„åŠ å¯†ç®—æ³•å’Œå¯†é’¥å¯¹header.payloadåœ¨è¿›è¡Œä¸€æ¬¡åŠ å¯†ï¼Œå¹¶å¯¹åŠ å¯†åçš„<span class="hljs-built_in">Token</span>å’Œæ”¶åˆ°çš„<span class="hljs-built_in">Token</span>æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒåˆ™éªŒè¯é€šè¿‡ï¼Œä¸ç›¸åŒè¿”å›HTTP <span class="hljs-number">401</span> Unauthrozied<br></code></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<h1 id="RequestID"><a href="#RequestID" class="headerlink" title="RequestID"></a>RequestID</h1><div class="code-wrapper"><pre><code class="hljs">&gt; å®šäºå’Œè·Ÿè¸ªRequestID
</code></pre></div>
<h1 id="è·¨åŸŸ"><a href="#è·¨åŸŸ" class="headerlink" title="è·¨åŸŸ"></a>è·¨åŸŸ</h1><div class="code-wrapper"><pre><code class="hljs">&gt; å½“å‰è½¯ä»¶æ¶æ„ä¸­é‡‡ç”¨å‰åç«¯åˆ†ç¦»ï¼Œå‰ç«¯è®¿é—®åœ°å€å’Œåç«¯æ–¹æ³•åœ°å€ä¸åŒï¼ŒWebæœåŠ¡éœ€è¦å¤„ç†æµè§ˆå™¨è·¨åŸŸè¯·æ±‚
</code></pre></div>
<h1 id="ä¼˜é›…å…³åœ"><a href="#ä¼˜é›…å…³åœ" class="headerlink" title="ä¼˜é›…å…³åœ"></a>ä¼˜é›…å…³åœ</h1>  <figure class="highlight stata"><table><tr><td class="code"><pre><code class="hljs stata">```<br><span class="hljs-comment">// main.go</span><br>package main<br><br>import (<br>	<span class="hljs-string">&quot;fmt&quot;</span><br>	<span class="hljs-string">&quot;log&quot;</span><br>	<span class="hljs-string">&quot;net/http&quot;</span><br>	<span class="hljs-string">&quot;os&quot;</span><br>	<span class="hljs-string">&quot;sync&quot;</span><br>	<span class="hljs-string">&quot;time&quot;</span><br><br>	<span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>	<span class="hljs-string">&quot;golang.org/x/sync/errgroup&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> Product struct &#123;<br>	Username    string    `json:<span class="hljs-string">&quot;username&quot;</span> binding:<span class="hljs-string">&quot;required&quot;</span>`<br>	Name        string    `json:<span class="hljs-string">&quot;name&quot;</span> binding:<span class="hljs-string">&quot;required&quot;</span>`<br>	Category    string    `json:<span class="hljs-string">&quot;category&quot;</span> binding:<span class="hljs-string">&quot;required&quot;</span>`<br>	Price       int       `json:<span class="hljs-string">&quot;price&quot;</span> binding:<span class="hljs-string">&quot;gte=0&quot;</span>`<br>	Description string    `json:<span class="hljs-string">&quot;description&quot;</span>`<br>	CreatedAt   time.Time `json:<span class="hljs-string">&quot;createdAt&quot;</span>`<br>&#125;<br><br><span class="hljs-keyword">type</span> productHandler struct &#123;<br>	sync.RWMutex<br>	products map[string]Product<br>&#125;<br><br>func newProductHandler() *productHandler &#123;<br>	<span class="hljs-keyword">return</span> &amp;productHandler&#123;<br>		products: make(map[string]Product),<br>	&#125;<br>&#125;<br><br>func (<span class="hljs-keyword">u</span> *productHandler) Create(c *gin.Context) &#123;<br>	<span class="hljs-keyword">u</span>.Lock()<br>	defer <span class="hljs-keyword">u</span>.Unlock()<br><br>	<span class="hljs-comment">// 1. å‚æ•°è§£æ</span><br>	<span class="hljs-keyword">var</span> product Product<br>  <span class="hljs-comment">// å°†Bodyä¸­JSONæ ¼å¼æ•°æ®è§£æåˆ°æŒ‡å®šçš„Structä¸­</span><br>	<span class="hljs-keyword">if</span> <span class="hljs-keyword">err</span> := c.ShouldBindJSON(&amp;product); <span class="hljs-keyword">err</span> != nil &#123;<br>    <span class="hljs-comment">// è¿”å›JSONæ ¼å¼æ•°æ®</span><br>		c.JSON(http.StatusBadRequest, gin.<span class="hljs-keyword">H</span>&#123;<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-keyword">err</span>.<span class="hljs-keyword">Error</span>()&#125;)<br>		<span class="hljs-keyword">return</span><br>	&#125;<br><br>	<span class="hljs-comment">// 2. å‚æ•°æ ¡éªŒ</span><br>	<span class="hljs-keyword">if</span> _, ok := <span class="hljs-keyword">u</span>.products[product.Name]; ok &#123;<br>		c.JSON(http.StatusBadRequest, gin.<span class="hljs-keyword">H</span>&#123;<span class="hljs-string">&quot;error&quot;</span>: fmt.Sprintf(<span class="hljs-string">&quot;product %s already exist&quot;</span>, product.Name)&#125;)<br>		<span class="hljs-keyword">return</span><br>	&#125;<br>	product.CreatedAt = time.Now()<br><br>	<span class="hljs-comment">// 3. é€»è¾‘å¤„ç†</span><br>	<span class="hljs-keyword">u</span>.products[product.Name] = product<br>	<span class="hljs-keyword">log</span>.Printf(<span class="hljs-string">&quot;Register product %s success&quot;</span>, product.Name)<br><br>	<span class="hljs-comment">// 4. è¿”å›ç»“æœ</span><br>	c.JSON(http.StatusOK, product)<br>&#125;<br><br>func (<span class="hljs-keyword">u</span> *productHandler) <span class="hljs-built_in">Get</span>(c *gin.Context) &#123;<br>	<span class="hljs-keyword">u</span>.Lock()<br>	defer <span class="hljs-keyword">u</span>.Unlock()<br><br>	product, ok := <span class="hljs-keyword">u</span>.products[c.Param(<span class="hljs-string">&quot;name&quot;</span>)]<br>	<span class="hljs-keyword">if</span> !ok &#123;<br><br>		c.JSON(http.StatusNotFound, gin.<span class="hljs-keyword">H</span>&#123;<span class="hljs-string">&quot;error&quot;</span>: fmt.Errorf(<span class="hljs-string">&quot;can not found product %s&quot;</span>, c.Param(<span class="hljs-string">&quot;name&quot;</span>))&#125;)<br>		<span class="hljs-keyword">return</span><br>	&#125;<br><br>	c.JSON(http.StatusOK, product)<br>&#125;<br><br>func router() http.Handler &#123;<br>	router := gin.Default()<br>	productHandler := newProductHandler()<br>	<span class="hljs-comment">// è·¯ç”±åˆ†ç»„/ä¸­é—´ä»¶/è®¤è¯</span><br>	v1 := router.<span class="hljs-built_in">Group</span>(<span class="hljs-string">&quot;/v1&quot;</span>)<br>	productv1 := v1.<span class="hljs-built_in">Group</span>(<span class="hljs-string">&quot;/products&quot;</span>)<br>	productv1.<span class="hljs-keyword">POST</span>(<span class="hljs-string">&quot;&quot;</span>, productHandler.Create)<br>  <span class="hljs-comment">// Ginæ”¯æŒä¸¤ç§è·¯ç”±åŒ¹é…è§„åˆ™</span><br>  <span class="hljs-comment">//  /products/:name ç²¾ç¡®åŒ¹é…</span><br>  <span class="hljs-comment">//  /products/*name æ¨¡ç³ŠåŒ¹é…</span><br>	productv1.<span class="hljs-built_in">GET</span>(<span class="hljs-string">&quot;:name&quot;</span>, productHandler.Get)<br>	<span class="hljs-keyword">return</span> router<br>&#125;<br><br>func main() &#123;<br>	<span class="hljs-keyword">var</span> eg errgroup.Group<br><br>	<span class="hljs-comment">// ä¸€è¿›ç¨‹å¤šç«¯å£</span><br>  <span class="hljs-comment">// Ginæ˜¯åŸºäºnet/httpåŒ…å°è£…çš„webæ¡†æ¶</span><br>	insecureServer := &amp;http.Server&#123;<br>		Addr:         <span class="hljs-string">&quot;:8080&quot;</span>,<br>		Handler:      router(),<br>		ReadTimeout:  5 * time.Second,<br>		WriteTimeout: 10 * time.Second,<br>	&#125;<br><br>	secureServer := &amp;http.Server&#123;<br>		Addr:         <span class="hljs-string">&quot;:8443&quot;</span>,<br>		Handler:      router(),<br>		ReadTimeout:  5 * time.Second,<br>		WriteTimeout: 10 * time.Second,<br>	&#125;<br><br>	eg.Go(func() <span class="hljs-keyword">error</span> &#123;<br>		<span class="hljs-keyword">err</span> := insecureServer.ListenAndServe()<br>		<span class="hljs-keyword">if</span> <span class="hljs-keyword">err</span> != nil &amp;&amp; <span class="hljs-keyword">err</span> != http.ErrServerClosed &#123;<br>			<span class="hljs-keyword">log</span>.Fatal(<span class="hljs-keyword">err</span>)<br>		&#125;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">err</span><br>	&#125;)<br><br>	eg.Go(func() <span class="hljs-keyword">error</span> &#123;<br>		path, <span class="hljs-keyword">err</span> := os.Getwd()<br>		<span class="hljs-keyword">if</span> <span class="hljs-keyword">err</span> != nil &#123;<br>			<span class="hljs-keyword">log</span>.Println(<span class="hljs-keyword">err</span>)<br>		&#125;<br>		<span class="hljs-keyword">log</span>.Println(path)<br>		<span class="hljs-keyword">err</span> = secureServer.ListenAndServeTLS(<span class="hljs-string">&quot;./server.pem&quot;</span>, <span class="hljs-string">&quot;./server.key&quot;</span>)<br>		<span class="hljs-keyword">if</span> <span class="hljs-keyword">err</span> != nil &amp;&amp; <span class="hljs-keyword">err</span> != http.ErrServerClosed &#123;<br>			<span class="hljs-keyword">log</span>.Fatal(<span class="hljs-keyword">err</span>)<br>		&#125;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">err</span><br>	&#125;)<br><br>	<span class="hljs-keyword">if</span> <span class="hljs-keyword">err</span> := eg.Wait(); <span class="hljs-keyword">err</span> != nil &#123;<br>		<span class="hljs-keyword">log</span>.Fatal(<span class="hljs-keyword">err</span>)<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h2 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h2><ul>
<li>æ”¯æŒHTTPæ–¹æ³•: GET/POST/PUT/PATCH/DELETE/OPTIONS</li>
<li>æ”¯æŒä¸åŒä½ç½®çš„HTTPå‚æ•°:<ul>
<li>è·¯å¾„å‚æ•° path tag uri /user/:name nameå°±æ˜¯è·¯å¾„å‚æ•°<figure class="highlight makefile"><table><tr><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">è·¯å¾„å‚æ•°: ShouldBindUri, BindUri</span><br></code></pre></td></tr></table></figure></li>
<li>æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•° query tag form /welcome?firstname=xx firstnameå°±æ˜¯æŸ¥è¯¢å‚æ•°<figure class="highlight makefile"><table><tr><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°: ShouldBindQuery, BindQuery</span><br></code></pre></td></tr></table></figure></li>
<li>è¡¨å•å‚æ•° form tag form curl -X POST -F â€˜username=colinsâ€™ <a href="http://mydomain.com/login">http://mydomain.com/login</a>, usernameå°±æ˜¯è¡¨å•å‚æ•°<figure class="highlight makefile"><table><tr><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">è¡¨å•å‚æ•°: ShouldBind</span><br></code></pre></td></tr></table></figure></li>
<li>HTTPå¤´å‚æ•° header tag header curl -X POST -H â€˜Content-Type:application/jsonâ€™ <a href="http://mydomain.com/login">http://mydomain.com/login</a> Content-Typeå°±æ˜¯HTTPå¤´å‚æ•°<figure class="highlight ldif"><table><tr><td class="code"><pre><code class="hljs ldif"><span class="hljs-attribute">HTTPå¤´å‚æ•°</span>: ShouldBindHeader, BindHeader<br></code></pre></td></tr></table></figure></li>
<li>æ¶ˆæ¯ä½“å‚æ•° body tag json/xml curl -X POST -H â€˜Content-Type:application/jsonâ€™ -d â€˜{â€œusernameâ€:â€colinsâ€}â€™ <a href="http://mydomain.com/login">http://mydomain.com/login</a>, usernameå°±æ˜¯æ¶ˆæ¯ä½“å‚æ•°<figure class="highlight makefile"><table><tr><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">æ¶ˆæ¯ä½“å‚æ•°: ShouldBindJSON, BindJSON</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li>æ”¯æŒHTTPè·¯ç”±å’Œè·¯ç”±åˆ†ç»„</li>
<li>æ”¯æŒè‡ªå®šä¹‰Log</li>
<li>æ”¯æŒbindingå’Œvalidation,</li>
<li>æ”¯æŒé‡å®šå‘</li>
<li>æ”¯æŒbasic auth middleware</li>
<li>æ”¯æŒè‡ªå®šä¹‰HTTPé…ç½®</li>
<li>æ”¯æŒä¼˜é›…å…³é—­</li>
<li>æ”¯æŒHTTP2</li>
<li>æ”¯æŒè®¾ç½®è·å–cookie</li>
</ul>
<h2 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h2><ul>
<li><p>ping-pong</p>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;net/http&quot;</span><br><br>	<span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	r := gin.Default()<br>	r.GET(<span class="hljs-string">&quot;/ping&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>		c.JSON(http.StatusOK, gin.H&#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;pong&quot;</span>&#125;)<br>	&#125;)<br><br>	r.Run()<br>&#125;<br></code></pre></td></tr></table></figure>
<ul>
<li>å¯åŠ¨ &amp; è¿è¡Œ<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql">âœ go run main.go<br>[GIN-<span class="hljs-keyword">debug</span>] [<span class="hljs-built_in">WARNING</span>] Creating an Engine instance <span class="hljs-keyword">with</span> the Logger <span class="hljs-keyword">and</span> Recovery middleware already attached.<br><br>[GIN-<span class="hljs-keyword">debug</span>] [<span class="hljs-built_in">WARNING</span>] Running <span class="hljs-keyword">in</span> &quot;debug&quot; mode. Switch <span class="hljs-keyword">to</span> &quot;release&quot; mode <span class="hljs-keyword">in</span> production.<br> - <span class="hljs-keyword">using</span> env:	export GIN_MODE=<span class="hljs-keyword">release</span><br> - <span class="hljs-keyword">using</span> code:	gin.SetMode(gin.ReleaseMode)<br><br>[GIN-<span class="hljs-keyword">debug</span>] <span class="hljs-keyword">GET</span>    /ping                     <span class="hljs-comment">--&gt; main.main.func1 (3 handlers)</span><br>[GIN-<span class="hljs-keyword">debug</span>] Environment variable PORT <span class="hljs-keyword">is</span> undefined. <span class="hljs-keyword">Using</span> port :<span class="hljs-number">8080</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">default</span><br>[GIN-<span class="hljs-keyword">debug</span>] Listening <span class="hljs-keyword">and</span> serving HTTP <span class="hljs-keyword">on</span> :<span class="hljs-number">8080</span><br><br># è°ƒç”¨<br>âœ curl -X <span class="hljs-keyword">GET</span> http://localhost:<span class="hljs-number">8080</span>/ping<br>&#123;&quot;message&quot;:&quot;pong&quot;&#125;%<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>æºç åˆ†æ</p>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"># gin.Default<br><br><span class="hljs-comment">// Default returns an Engine instance with the Logger and Recovery middleware already attached.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Default</span><span class="hljs-params">()</span> *<span class="hljs-title">Engine</span></span> &#123;<br>	debugPrintWARNINGDefault()  <span class="hljs-comment">// æ£€æŸ¥Goç‰ˆæœ¬æ˜¯å¦è¾¾åˆ°Ginæœ€ä½è¦æ±‚</span><br>	engine := New()<br>	engine.Use(Logger(), Recovery()) <span class="hljs-comment">// å¼•å…¥ä¸­é—´ä»¶</span><br>	<span class="hljs-keyword">return</span> engine<br>&#125;<br><br># gin.New<br><span class="hljs-comment">// New returns a new blank Engine instance without any middleware attached.</span><br><span class="hljs-comment">// By default the configuration is:</span><br><span class="hljs-comment">// - RedirectTrailingSlash:  true</span><br><span class="hljs-comment">// - RedirectFixedPath:      false</span><br><span class="hljs-comment">// - HandleMethodNotAllowed: false</span><br><span class="hljs-comment">// - ForwardedByClientIP:    true</span><br><span class="hljs-comment">// - UseRawPath:             false</span><br><span class="hljs-comment">// - UnescapePathValues:     true</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">New</span><span class="hljs-params">()</span> *<span class="hljs-title">Engine</span></span> &#123;<br>	debugPrintWARNINGNew()<br>	engine := &amp;Engine&#123; <span class="hljs-comment">// åˆå§‹åŒ–</span><br>		RouterGroup: RouterGroup&#123; <span class="hljs-comment">// è·¯ç”±ç»„</span><br>			Handlers: <span class="hljs-literal">nil</span>,<br>			basePath: <span class="hljs-string">&quot;/&quot;</span>,<br>			root:     <span class="hljs-literal">true</span>,<br>		&#125;,<br>		FuncMap:                template.FuncMap&#123;&#125;,<br>		RedirectTrailingSlash:  <span class="hljs-literal">true</span>,<br>		RedirectFixedPath:      <span class="hljs-literal">false</span>,<br>		HandleMethodNotAllowed: <span class="hljs-literal">false</span>,<br>		ForwardedByClientIP:    <span class="hljs-literal">true</span>,<br>		RemoteIPHeaders:        []<span class="hljs-keyword">string</span>&#123;<span class="hljs-string">&quot;X-Forwarded-For&quot;</span>, <span class="hljs-string">&quot;X-Real-IP&quot;</span>&#125;,<br>		TrustedProxies:         []<span class="hljs-keyword">string</span>&#123;<span class="hljs-string">&quot;0.0.0.0/0&quot;</span>&#125;,<br>		AppEngine:              defaultAppEngine,<br>		UseRawPath:             <span class="hljs-literal">false</span>,<br>		RemoveExtraSlash:       <span class="hljs-literal">false</span>,<br>		UnescapePathValues:     <span class="hljs-literal">true</span>,<br>		MaxMultipartMemory:     defaultMultipartMemory, <span class="hljs-comment">// const defaultMultipartMemory = 32 &lt;&lt; 20 // 32 MB</span><br>		trees:                  <span class="hljs-built_in">make</span>(methodTrees, <span class="hljs-number">0</span>, <span class="hljs-number">9</span>),<br>		delims:                 render.Delims&#123;Left: <span class="hljs-string">&quot;&#123;&#123;&quot;</span>, Right: <span class="hljs-string">&quot;&#125;&#125;&quot;</span>&#125;, <span class="hljs-comment">// HTML æ¨¡ç‰ˆå·¦å³å®šç•Œç¬¦</span><br>		secureJSONPrefix:       <span class="hljs-string">&quot;while(1);&quot;</span>,<br>	&#125;<br>	engine.RouterGroup.engine = engine<br>	engine.pool.New = <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span> <span class="hljs-title">interface</span></span>&#123;&#125; &#123;<br>		<span class="hljs-keyword">return</span> engine.allocateContext()<br>	&#125;<br>	<span class="hljs-keyword">return</span> engine<br>&#125;<br><br># r.GET()<br><br>  <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(group *RouterGroup)</span> <span class="hljs-title">handle</span><span class="hljs-params">(httpMethod, relativePath <span class="hljs-keyword">string</span>, handlers HandlersChain)</span> <span class="hljs-title">IRoutes</span></span> &#123;<br>    absolutePath := group.calculateAbsolutePath(relativePath) <span class="hljs-comment">// è®¡ç®—è·¯ç”±çš„ç»å¯¹è·¯å¾„</span><br>    handlers = group.combineHandlers(handlers)<br>    group.engine.addRoute(httpMethod, absolutePath, handlers) <span class="hljs-comment">// è¿½åŠ åˆ°æ ‘</span><br>    <span class="hljs-keyword">return</span> group.returnObj()<br>  &#125;<br><br># r.Run()<br><br><span class="hljs-comment">// Run attaches the router to a http.Server and starts listening and serving HTTP requests.</span><br><span class="hljs-comment">// It is a shortcut for http.ListenAndServe(addr, router)</span><br><span class="hljs-comment">// Note: this method will block the calling goroutine indefinitely unless an error happens.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(engine *Engine)</span> <span class="hljs-title">Run</span><span class="hljs-params">(addr ...<span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(err error)</span></span> &#123;<br>	<span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; debugPrintError(err) &#125;()<br><br>	trustedCIDRs, err := engine.prepareTrustedCIDRs()<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-keyword">return</span> err<br>	&#125;<br>	engine.trustedCIDRs = trustedCIDRs<br>	address := resolveAddress(addr)<br>	debugPrint(<span class="hljs-string">&quot;Listening and serving HTTP on %s\n&quot;</span>, address)<br>	err = http.ListenAndServe(address, engine)<br>	<span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-comment">// ä¸Šä¸‹æ–‡æ± åŒ–é˜²æ­¢é¢‘ç¹ç”Ÿæˆä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œæé«˜æ€§èƒ½</span><br><span class="hljs-comment">// ServeHTTP conforms to the http.Handler interface.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(engine *Engine)</span> <span class="hljs-title">ServeHTTP</span><span class="hljs-params">(w http.ResponseWriter, req *http.Request)</span></span> &#123;<br>	c := engine.pool.Get().(*Context) <span class="hljs-comment">// sync.Pool å¯¹è±¡æ± ä¸­è·å–ä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡</span><br>	c.writermem.reset(w)<br>	c.Request = req<br>	c.reset()<br><br>	engine.handleHTTPRequest(c)<br><br>	engine.pool.Put(c) <span class="hljs-comment">// è¿”å›å¯¹è±¡æ± </span><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>Web Framework</category>
      </categories>
  </entry>
  <entry>
    <title>Makefile Intro</title>
    <url>/2021/09/08/Makefile-Intro/</url>
    <content><![CDATA[<h1 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h1><blockquote>
<p>Makefile å…³ç³»åˆ°æ•´ä¸ªå·¥ç¨‹çš„ç¼–è¯‘è§„åˆ™(å…ˆåé¡ºåº)<br>make: ä¸€ä¸ªè§£é‡Šmakefileä¸­æŒ‡ä»¤çš„å‘½ä»¤å·¥å…·</p>
</blockquote>
<span id="more"></span>

<h2 id="è¯¾å‰å°çŸ¥è¯†"><a href="#è¯¾å‰å°çŸ¥è¯†" class="headerlink" title="è¯¾å‰å°çŸ¥è¯†"></a>è¯¾å‰å°çŸ¥è¯†</h2><ul>
<li>ç¼–è¯‘(compile)ã€é“¾æ¥(link)ã€åº“æ–‡ä»¶(Library File)<ul>
<li> ç¼–è¯‘: å°†æºæ–‡ä»¶ç¼–è¯‘æˆä¸­é—´ä»£ç æ–‡ä»¶(windows .objæ–‡ä»¶, Unixä¸‹çš„.oæ–‡ä»¶)</li>
<li>ç¼–è¯‘å™¨å€¼æ£€æµ‹ç¨‹åºè¯­æ³•å’Œå‡½æ•°ã€å˜é‡æ˜¯å¦è¢«å£°æ˜.</li>
<li> é“¾æ¥: å°†å¤§é‡çš„Object Fileåˆæˆæ‰§è¡Œæ–‡ä»¶</li>
<li>é“¾æ¥å™¨ä¼šåœ¨æ‰€æœ‰çš„Object Fileä¸­å¯»æ‰¾å‡½æ•°çš„å®ç°</li>
<li> åº“æ–‡ä»¶: å°†ç¼–è¯‘çš„ä¸­é—´æ–‡ä»¶æ‰“åŒ…(windows .libæ–‡ä»¶, Unix .a Archive File)</li>
</ul>
</li>
</ul>
<h2 id="Makefile-1"><a href="#Makefile-1" class="headerlink" title="Makefile"></a>Makefile</h2><ul>
<li>è§„åˆ™<blockquote>
<p>prerequistiesä¸­å¦‚æœæœ‰ä¸€ä¸ªä»¥ä¸Šçš„æ–‡ä»¶æ¯”targetæ–‡ä»¶è¦æ–°çš„è¯ï¼Œcommandæ‰€å®šä¹‰çš„å‘½ä»¤å°±ä¼šè¢«æ‰§è¡Œ</p>
</blockquote>
</li>
</ul>
  <figure class="highlight jboss-cli"><table><tr><td class="code"><pre><code class="hljs jboss-cli">target <span class="hljs-string">...</span> : prerequisities <span class="hljs-string">...</span><br>  <span class="hljs-keyword">command</span><br>  <span class="hljs-string">...</span><br>  <span class="hljs-string">...</span><br></code></pre></td></tr></table></figure>
<div class="code-wrapper"><pre><code class="hljs">- target:
  - object file ç›®æ ‡æ–‡ä»¶:
  - execute file å¯æ‰§è¡Œæ–‡ä»¶:
  - label æ ‡ç­¾:
- prerequisites:
  - ä¾èµ–çš„æ–‡ä»¶
- command:
  - æ‰§è¡Œçš„å‘½ä»¤
</code></pre></div>
<ul>
<li>makeå¦‚ä½•å·¥ä½œ<figure class="highlight vim"><table><tr><td class="code"><pre><code class="hljs vim"># makefile<br><span class="hljs-keyword">edit</span> : main.<span class="hljs-keyword">o</span> kbd.<span class="hljs-keyword">o</span> <span class="hljs-keyword">command</span>.<span class="hljs-keyword">o</span> <span class="hljs-keyword">display</span>.<span class="hljs-keyword">o</span> \<br>&gt; <span class="hljs-keyword">make</span> ä¼šä¸€å±‚å±‚æ‰¾æ–‡ä»¶çš„ä¾èµ–å…³ç³»ï¼ŒçŸ¥é“æœ€ç»ˆç¼–è¯‘åˆç¬¬ä¸€ä¸ªç›®æ ‡æ–‡ä»¶, <span class="hljs-keyword">make</span>åªå…³æ³¨æ–‡ä»¶çš„ä¾èµ–æ€§.<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li>[è·Ÿæˆ‘ä¸€èµ·å†™Makefile (PDFé‡åˆ¶ç‰ˆ)] (<a href="https://seisman.github.io/how-to-write-makefile/Makefile.pdf">https://seisman.github.io/how-to-write-makefile/Makefile.pdf</a>)</li>
</ul>
]]></content>
      <categories>
        <category>Computer Science</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Index Intro</title>
    <url>/2021/09/08/MySQL-Index-Intro/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>Middleware</category>
      </categories>
  </entry>
  <entry>
    <title>æ•°æ®ç»“æ„-Radix-Tree</title>
    <url>/2021/09/08/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-Radix-Tree/</url>
    <content><![CDATA[<h1 id="Radix-Tree-åŸºæ•°æ ‘"><a href="#Radix-Tree-åŸºæ•°æ ‘" class="headerlink" title="Radix Tree - åŸºæ•°æ ‘"></a>Radix Tree - åŸºæ•°æ ‘</h1><blockquote>
<p>radix treeç”¨äºè¡¨ç¤ºä¸€ç§ç©ºé—´ä¼˜åŒ–çš„tree. å‡å¦‚æ ‘ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å”¯ä¸€å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹å°†ä¼šä¸çˆ¶èŠ‚ç‚¹è¿›è¡Œåˆå¹¶ radix treeçš„è¾¹æ²¿edgeså¯ä»¥æ˜¯ä¸€ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ <br>å…ƒç´ ä¸ªæ•°ä¸æ˜¯å¤ªå¤šï¼Œä½†æ˜¯å…ƒç´ ä¹‹é—´é€šå¸¸æœ‰å¾ˆé•¿çš„ç›¸åŒå‰ç¼€æ—¶å¾ˆé€‚åˆé‡‡ç”¨radix treeå­˜å‚¨<br>Golangçš„webæ¡†æ¶ginä½¿ç”¨radix treeä½œä¸ºè·¯ç”±æŸ¥æ‰¾çš„ç®—æ³•.</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql"># gin/gin.go<br><br>// <span class="hljs-keyword">method</span> -&gt; HTTP <span class="hljs-keyword">Method</span> &#123;<span class="hljs-keyword">GET</span>,PUT,POST,<span class="hljs-keyword">DELETE</span>&#125;<br>func (engine *Engine) addRoute(<span class="hljs-keyword">method</span>, <span class="hljs-type">path</span> string, handlers HandlersChain) &#123;<br>	assert1(<span class="hljs-type">path</span>[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;/&#x27;</span>, &quot;path must begin with &#x27;/&#x27;&quot;)<br>	assert1(<span class="hljs-keyword">method</span> != &quot;&quot;, &quot;HTTP method can not be empty&quot;)<br>	assert1(len(handlers) &gt; <span class="hljs-number">0</span>, &quot;there must be at least one handler&quot;)<br><br>	debugPrintRoute(<span class="hljs-keyword">method</span>, <span class="hljs-type">path</span>, handlers)<br><br>  // æ¯ä¸€ä¸ª<span class="hljs-keyword">method</span>å¯¹åº”ä¸€é¢—radix tree<br>	root := engine.trees.<span class="hljs-keyword">get</span>(<span class="hljs-keyword">method</span>)<br>	<span class="hljs-keyword">if</span> root == nil &#123;<br>    // å¦‚æœè·å–ä¸åˆ°<span class="hljs-keyword">method</span>å¯¹åº”çš„æ ‘ï¼Œå°±åˆ›å»º<br>		root = <span class="hljs-built_in">new</span>(node)<br>		root.fullPath = &quot;/&quot;<br>		engine.trees = append(engine.trees, methodTree&#123;<span class="hljs-keyword">method</span>: <span class="hljs-keyword">method</span>, root: root&#125;)<br>	&#125;<br>	root.addRoute(<span class="hljs-type">path</span>, handlers)<br><br>	// <span class="hljs-keyword">Update</span> maxParams<br>	<span class="hljs-keyword">if</span> paramsCount := countParams(<span class="hljs-type">path</span>); paramsCount &gt; engine.maxParams &#123;<br>		engine.maxParams = paramsCount<br>	&#125;<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Computer Science</category>
      </categories>
  </entry>
  <entry>
    <title>é™æ€ä»£ç æ£€æŸ¥ golangci-lint</title>
    <url>/2021/09/08/%E9%9D%99%E6%80%81%E4%BB%A3%E7%A0%81%E6%A3%80%E6%9F%A5-golangci-lint/</url>
    <content><![CDATA[<h1 id="é™æ€ä»£ç æ£€æŸ¥"><a href="#é™æ€ä»£ç æ£€æŸ¥" class="headerlink" title="é™æ€ä»£ç æ£€æŸ¥"></a>é™æ€ä»£ç æ£€æŸ¥</h1><span id="more"></span>

<h2 id="golangci-lint"><a href="#golangci-lint" class="headerlink" title="golangci-lint"></a>golangci-lint</h2><blockquote>
<p>golangci-lint is a fast Go linters runner. It runs linters in parallel, uses caching, supports yaml config, has integrations with all major IDE and has dozens of linters included.</p>
</blockquote>
]]></content>
      <categories>
        <category>Programming Language</category>
      </categories>
  </entry>
  <entry>
    <title>Error Code Design Intro</title>
    <url>/2021/09/09/Error-Code-Design-Intro/</url>
    <content><![CDATA[<h1 id="é”™è¯¯ç è®¾è®¡"><a href="#é”™è¯¯ç è®¾è®¡" class="headerlink" title="é”™è¯¯ç è®¾è®¡"></a>é”™è¯¯ç è®¾è®¡</h1><ul>
<li>é”™è¯¯ç å®ç°æ–¹å¼<figure class="highlight css"><table><tr><td class="code"><pre><code class="hljs css"><span class="hljs-number">1</span>. æ— è®ºè¯·æ±‚æˆåŠŸæˆ–å¤±è´¥ï¼Œå§‹ç»ˆè¿”å›<span class="hljs-number">200</span> http status <span class="hljs-selector-tag">code</span><br> &gt; æ¯æ¬¡è¯·æ±‚ï¼Œéƒ½éœ€è¦è§£æHTTP <span class="hljs-selector-tag">Body</span>,ä»ä¸­è§£æå‡ºé”™è¯¯ç å’Œé”™è¯¯ä¿¡æ¯.<br><span class="hljs-number">2</span>. è¿”å›åˆé€‚çš„HTTP <span class="hljs-selector-tag">Code</span>. å¹¶åœ¨<span class="hljs-selector-tag">Body</span>ä¸­è¿”å›é”™è¯¯ä¿¡æ¯å’Œè‡ªå®šä¹‰ä¸šåŠ¡<span class="hljs-selector-tag">Code</span><br><span class="hljs-number">3</span>. è¿”å›åˆé€‚çš„HTTP <span class="hljs-selector-tag">Code</span>, å¹¶åœ¨<span class="hljs-selector-tag">Body</span>ä¸­è¯¦å°½çš„é”™è¯¯ä¿¡æ¯<br></code></pre></td></tr></table></figure></li>
<li>ä¸šåŠ¡Codeç è®¾è®¡<figure class="highlight"><table><tr><td class="code"><pre><code class="hljs">  <br></code></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>Microservice</category>
      </categories>
  </entry>
  <entry>
    <title>SwaggerAPI intro</title>
    <url>/2021/09/09/SwaggerAPI-intro/</url>
    <content><![CDATA[<h1 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h1><blockquote>
<p>Swaggeræ˜¯ä¸€å¥—å›´ç»•OpenAPIè§„èŒƒæ„å»ºçš„å¼€æºå·¥å…·,å¯ä»¥è®¾è®¡Â·æ„å»ºÂ·ç¼–å†™Â·ä½¿ç”¨RESTAPI</p>
</blockquote>
<ul>
<li>Swaggerç¼–è¾‘å™¨:</li>
<li>Swagger UI: å°†OpenAPIè§„èŒƒå‘ˆç°ä¸ºäº¤äº’å¼APIæ–‡æ¡£ï¼Œå¹¶å¯ä»¥åœ¨æµè§ˆå™¨ä¸­å°è¯•APIè°ƒç”¨</li>
<li>Swagger Codegen: æ ¹æ®OpenAPIè§„èŒƒï¼Œç”ŸæˆæœåŠ¡å™¨å­˜æ ¹å’Œå®¢æˆ·ç«¯ä»£ç åº“</li>
</ul>
<span id="more"></span>

<h2 id="Swaggerå’ŒOpenAPIåŒºåˆ«"><a href="#Swaggerå’ŒOpenAPIåŒºåˆ«" class="headerlink" title="Swaggerå’ŒOpenAPIåŒºåˆ«"></a>Swaggerå’ŒOpenAPIåŒºåˆ«</h2><ul>
<li>OpenAPI<figure class="highlight mipsasm"><table><tr><td class="code"><pre><code class="hljs mipsasm">OpenAPIæ˜¯ä¸€ä¸ªAPIè§„èŒƒï¼Œå‰èº«æ˜¯<span class="hljs-keyword">Swaggerè§„èŒƒ. </span><span class="hljs-keyword">Swaggeræ˜¯å®ç°è§„èŒƒçš„å·¥å…·</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="go-swaggerç”ŸæˆSwagger-API-æ–‡æ¡£"><a href="#go-swaggerç”ŸæˆSwagger-API-æ–‡æ¡£" class="headerlink" title="go-swaggerç”ŸæˆSwagger API æ–‡æ¡£"></a>go-swaggerç”ŸæˆSwagger API æ–‡æ¡£</h2><ul>
<li><p>go-swaggerç‰¹å¾</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> æ ¹æ®Swaggerå®šä¹‰æ–‡ä»¶ç”ŸæˆæœåŠ¡ç«¯ä»£ç <br><span class="hljs-bullet">2.</span> æ ¹æ®Swaggerå®šä¹‰æ–‡ä»¶ç”Ÿæˆå®¢æˆ·ç«¯ä»£ç <br><span class="hljs-bullet">3.</span> æ ¡éªŒSwaggerå®šä¹‰æ–‡ä»¶æ˜¯å¦æ­£ç¡®<br><span class="hljs-bullet">4.</span> å¯åŠ¨ä¸€ä¸ªHTTPæœåŠ¡å™¨ï¼Œä½¿æˆ‘ä»¬å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®APIæ–‡æ¡£<br><span class="hljs-bullet">5.</span> æ ¹æ®Swaggeræ–‡æ¡£å®šä¹‰çš„å‚æ•°ç”ŸæˆGo Modelç»“æ„ä½“å®šä¹‰<br></code></pre></td></tr></table></figure></li>
<li><p>Swaggerå·¥å…·</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk">github.com<span class="hljs-regexp">/chyidl/</span>noone via ğŸ¹ v1.<span class="hljs-number">17</span><br>âœ go get -u github.com<span class="hljs-regexp">/go-swagger/g</span>o-swagger<span class="hljs-regexp">/cmd/</span>swagger<br><br>github.com<span class="hljs-regexp">/chyidl/</span>noone via ğŸ¹ v1.<span class="hljs-number">17</span> took <span class="hljs-number">25</span>s<br>âœ swagger version<br>version: v0.<span class="hljs-number">27.0</span><br>commit: (unknown, mod sum: <span class="hljs-string">&quot;h1:K7+nkBuf4oS1jTBrdvWqYFpqD69V5CN8HamZzCDDhAI=&quot;</span>)<br><br>github.com<span class="hljs-regexp">/chyidl/g</span>o-swagger-demo via ğŸ¹ v1.<span class="hljs-number">17</span><br>âœ swagger generate spec -o swagger.yaml<br>  -o: æŒ‡å®šè¾“å‡ºæ–‡ä»¶å<br><br>github.com<span class="hljs-regexp">/chyidl/g</span>o-swagger-demo via ğŸ¹ v1.<span class="hljs-number">17</span><br>âœ ls<br>api          docs         go.mod       main.go      swagger.yaml<br>github.com<span class="hljs-regexp">/chyidl/g</span>o-swagger-demo via ğŸ¹ v1.<span class="hljs-number">17</span><br>âœ swagger serve --no-open -F=swagger --port <span class="hljs-number">36666</span> swagger.yaml<br><span class="hljs-number">2021</span><span class="hljs-regexp">/09/</span><span class="hljs-number">09</span> <span class="hljs-number">12</span>:<span class="hljs-number">58</span>:<span class="hljs-number">09</span> serving docs at http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">36666</span>/docs<br>  --no-open: ç¦æ­¢è°ƒç”¨æµè§ˆå™¨æ‰“å¼€<br>  -F: æŒ‡å®šæ–‡æ¡£é£æ ¼<br>  --port: æŒ‡å®šå¯åŠ¨çš„HTTPæœåŠ¡ç›‘å¬<br><br>github.com<span class="hljs-regexp">/chyidl/g</span>o-swagger-demo via ğŸ¹ v1.<span class="hljs-number">17</span><br>âœ swagger generate spec -i .<span class="hljs-regexp">/swagger.yaml -o ./</span>swagger.json<br><br><span class="hljs-regexp">//</span> swagger:route POST /users user createUserRequest<br><span class="hljs-regexp">//</span> Create a user <span class="hljs-keyword">in</span> memory.<br><span class="hljs-regexp">//</span> responses:<br><span class="hljs-regexp">//</span>   <span class="hljs-number">200</span>: createUserResponse<br><span class="hljs-regexp">//</span>   default: errResponse<br><br><span class="hljs-regexp">//</span> swagger:route GET <span class="hljs-regexp">/users/</span>&#123;name&#125; user getUserRequest<br><span class="hljs-regexp">//</span> Get a user from memory.<br><span class="hljs-regexp">//</span> responses:<br><span class="hljs-regexp">//</span>   <span class="hljs-number">200</span>: getUserResponse<br><span class="hljs-regexp">//</span>   default: errResponse<br></code></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>Computer Science</category>
      </categories>
  </entry>
  <entry>
    <title>gorm intro</title>
    <url>/2021/09/09/gorm-intro/</url>
    <content><![CDATA[<h1 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h1>]]></content>
      <categories>
        <category>Programming Language</category>
      </categories>
  </entry>
  <entry>
    <title>Go Concurrency Patterns</title>
    <url>/2021/09/10/Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="Golang"><a href="#Golang" class="headerlink" title="Golang"></a>Golang</h1><ul>
<li><p>Simplicity: ç®€å•</p>
<blockquote>
<p>Simplicity is prerequisite for reliability. ç®€å•æ˜¯å¯é çš„å…ˆè§‰æ¡ä»¶</p>
</blockquote>
</li>
<li><p>Readablity: å¯è¯»æ€§</p>
<blockquote>
<p>Readability is essential for maintainablity. å¯è¯»æ€§å¯¹äºå¯ç»´æŠ¤æ€§è‡³å…³é‡è¦<br>Programs must be written for people to read, and only incidentally for machine to execute. ç¨‹åºå¿…é¡»æ˜¯ä¸ºäººä»¬é˜…è¯»è€Œç¼–å†™çš„ï¼Œè€Œå¶ç„¶ä¸ºåŠå…¶æ‰§è¡Œè€Œç¼–å†™</p>
</blockquote>
</li>
<li><p>Productivity: ç”Ÿäº§åŠ›</p>
<blockquote>
<p>Design is the art of arranging code to work today, and be changeable forever.</p>
</blockquote>
</li>
</ul>
<span id="more"></span>

<h2 id="A-First-Look-Go-Programming-Language"><a href="#A-First-Look-Go-Programming-Language" class="headerlink" title="A First Look - Go Programming Language"></a>A First Look - Go Programming Language</h2><ul>
<li><p>Hello World</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk">package main                    <span class="hljs-regexp">//</span> å£°æ˜æœ¬æ–‡ä»¶çš„åŒ…å<br><br><span class="hljs-regexp">//</span> <span class="hljs-number">1</span>. åœ¨importä¸­å¯ä»¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ .<span class="hljs-regexp">/ ../</span> å¼•å…¥package<br><span class="hljs-regexp">//</span> <span class="hljs-number">2</span>. å¦‚æœæ²¡æœ‰ç›¸å¯¹è·¯å¾„ Goä¼šä»<span class="hljs-variable">$GOPATH</span><span class="hljs-regexp">/src/</span>ç›®å½•å¯»æ‰¾<br>import <span class="hljs-string">&quot;fmt&quot;</span>                    <span class="hljs-regexp">//</span> importè¯­è¨€çš„fmtåº“ - ç”¨äºè¾“å‡º<br><br><span class="hljs-keyword">func</span> main() &#123;<br>	fmt.Println(<span class="hljs-string">&quot;hello world&quot;</span>)<br><br>  <span class="hljs-regexp">//</span> fmt è¾“å‡ºæ ¼å¼<br>  fmt.Printf(<span class="hljs-string">&quot;%t\n&quot;</span>, <span class="hljs-number">1</span> == <span class="hljs-number">2</span>)<br> fmt.Printf(<span class="hljs-string">&quot;äºŒè¿›åˆ¶: %b\n&quot;</span>, <span class="hljs-number">255</span>)<br> fmt.Printf(<span class="hljs-string">&quot;å…«è¿›åˆ¶: %o\n&quot;</span>, <span class="hljs-number">255</span>)<br> fmt.Printf(<span class="hljs-string">&quot;åå…­è¿›åˆ¶: %x\n&quot;</span>, <span class="hljs-number">255</span>)<br> fmt.Printf(<span class="hljs-string">&quot;æµ®ç‚¹æ•°: %f\n&quot;</span>, math.Pi)<br> fmt.Printf(<span class="hljs-string">&quot;å­—ç¬¦ä¸²: %s\n&quot;</span>, <span class="hljs-string">&quot;hello world&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>var &amp; const</p>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// å£°æ˜åˆå§‹åŒ–ä¸€ä¸ªå˜é‡</span><br><span class="hljs-keyword">var</span> x <span class="hljs-keyword">int</span> = <span class="hljs-number">100</span><br><span class="hljs-keyword">var</span> str <span class="hljs-keyword">string</span> = <span class="hljs-string">&quot;hello world&quot;</span><br><span class="hljs-comment">// å£°æ˜åˆå§‹åŒ–å¤šä¸ªå˜é‡</span><br><span class="hljs-keyword">var</span> i, j, k <span class="hljs-keyword">int</span> = <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span><br><span class="hljs-comment">// ä¸æŒ‡æ˜ç±»å‹ï¼Œé€šè¿‡åˆå§‹åŒ–å€¼æ¨å¯¼</span><br><span class="hljs-keyword">var</span> b = <span class="hljs-literal">true</span> <span class="hljs-comment">// bool ç±»å‹</span><br>x := <span class="hljs-number">100</span><br><br><span class="hljs-comment">// å¸¸é‡</span><br><span class="hljs-keyword">const</span> p <span class="hljs-keyword">string</span> = <span class="hljs-string">&quot;hello world&quot;</span><br><span class="hljs-keyword">const</span> pi <span class="hljs-keyword">float32</span> = <span class="hljs-number">3.1415926</span><br></code></pre></td></tr></table></figure></li>
<li><p>Array &amp; Slice</p>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><br><span class="hljs-comment">// Slices in the runtime are represented by three components:</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// type slice struct &#123;</span><br><span class="hljs-comment">// 	ptr unsafe.Pointer          // æŒ‡å‘å­˜æ”¾æ•°æ®çš„æ•°ç»„æŒ‡é’ˆ</span><br><span class="hljs-comment">// 	len int                     // é•¿åº¦æœ‰å¤šå¤§</span><br><span class="hljs-comment">// 	cap int                     // å®¹é‡æœ‰å¤šå¤§</span><br><span class="hljs-comment">// &#125;</span><br><br># ä½¿ç”¨åå°„reflect.DeepEqual() è¿›è¡Œæ·±åº¦æ¯”è¾ƒ<br><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;fmt&quot;</span><br>	<span class="hljs-string">&quot;reflect&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> data <span class="hljs-keyword">struct</span> &#123;<br>	<span class="hljs-built_in">len</span> <span class="hljs-keyword">int</span><br>	p   *<span class="hljs-keyword">int</span><br>&#125;<br><br><span class="hljs-comment">// æ¯”è¾ƒä¸¤ä¸ªç»“æ„ä½“ä¸­æ•°æ®æ˜¯å¦ç›¸åŒ</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	v1 := data&#123;&#125;<br>	v2 := data&#123;&#125;<br>	fmt.Println(<span class="hljs-string">&quot;v1 == v2:&quot;</span>, reflect.DeepEqual(v1, v2))<br>	<span class="hljs-comment">// prints: v1 == v2: true</span><br><br>	m1 := <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">string</span>&#123;<span class="hljs-string">&quot;one&quot;</span>: <span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;two&quot;</span>: <span class="hljs-string">&quot;b&quot;</span>&#125;<br>	m2 := <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">string</span>&#123;<span class="hljs-string">&quot;two&quot;</span>: <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;one&quot;</span>: <span class="hljs-string">&quot;a&quot;</span>&#125;<br>	fmt.Println(<span class="hljs-string">&quot;m1 == m2:&quot;</span>, reflect.DeepEqual(m1, m2))<br>	<span class="hljs-comment">// prints: m1 == m2: true</span><br><br>	s1 := []<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;<br>	s2 := []<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;<br>	fmt.Println(<span class="hljs-string">&quot;s1 == s2:&quot;</span>, reflect.DeepEqual(s1, s2))<br>	<span class="hljs-comment">// prints: s1 == s2: true</span><br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Go-Model-CSP"><a href="#Go-Model-CSP" class="headerlink" title="Go Model: CSP"></a>Go Model: CSP</h2><ul>
<li>CSP:<blockquote>
<p>Communicating Sequential Processes</p>
</blockquote>
</li>
</ul>
<h2 id="å¹¶å‘-Concurrency-amp-amp-å¹¶è¡Œ-Parallelism"><a href="#å¹¶å‘-Concurrency-amp-amp-å¹¶è¡Œ-Parallelism" class="headerlink" title="å¹¶å‘(Concurrency) &amp;&amp; å¹¶è¡Œ(Parallelism)"></a>å¹¶å‘(Concurrency) &amp;&amp; å¹¶è¡Œ(Parallelism)</h2><ul>
<li><p>å¹¶å‘(Concurrency):</p>
<blockquote>
<p>Programming as the composition of independently executing processes.<br>Concurrency is about dealing with lots of things at once.<br>Concurreny is about structure</p>
</blockquote>
</li>
<li><p>å¹¶è¡Œ(Parallelism)</p>
<blockquote>
<p>programming as the simultaneous execution of computations.<br>Parallelism is about doing lots of things at once.<br>Parallelism is about execution</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>A well-written concurrent program might run efficiently in parallel on a multiprocessor.</p>
</blockquote>
<h2 id="è¿›ç¨‹-amp-çº¿ç¨‹"><a href="#è¿›ç¨‹-amp-çº¿ç¨‹" class="headerlink" title="è¿›ç¨‹ &amp; çº¿ç¨‹"></a>è¿›ç¨‹ &amp; çº¿ç¨‹</h2><blockquote>
<p>è¿›ç¨‹ Process: ä¸€èˆ¬æ˜¯èµ„æºåˆ†é…å•å…ƒï¼Œä¸€ä¸ªè¿›ç¨‹æ‹¥æœ‰å †ã€æ ˆã€è™šå­˜ç©ºé—´(é¡µè¡¨)ã€æ–‡ä»¶æè¿°ç¬¦<br>çº¿ç¨‹ Thread: CPUè¿›è¡Œè°ƒåº¦å’Œæ‰§è¡Œçš„å®ä½“<br>ä¸»è¿›ç¨‹/ä¸»çº¿ç¨‹: å¦‚æœä¸€ä¸ªè¿›ç¨‹å¯åŠ¨åï¼Œæ²¡æœ‰åœ¨åˆ›å»ºé¢å¤–çš„çº¿ç¨‹ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿›ç¨‹ä¸€èˆ¬ç§°ä¸ºä¸»è¿›ç¨‹æˆ–ä¸»çº¿ç¨‹ã€‚</p>
</blockquote>
<h2 id="Goroutine"><a href="#Goroutine" class="headerlink" title="Goroutine"></a>Goroutine</h2><blockquote>
<p>Concurrent execution<br>A goroutine is a function running independently in the same address space as other goroutines<br>has its own call stack, which grows and shrinks as required.</p>
</blockquote>
<ul>
<li>goroutine ç”Ÿå‘½å‘¨æœŸç®¡ç†<ul>
<li>å°½é‡é¿å…åœ¨è¯·æ±‚ä¸­ç›´æ¥å¯åŠ¨goroutineå¤„ç†é—®é¢˜ï¼Œé€šè¿‡å¯åŠ¨workerè¿›è¡Œæ¶ˆè´¹ï¼Œé¿å…ç”±äºè¯·æ±‚é‡å¤§ï¼Œåˆ›å»ºå¤§é‡çš„goroutineå¯¼è‡´OOM<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;context&quot;</span><br>	<span class="hljs-string">&quot;fmt&quot;</span><br>	<span class="hljs-string">&quot;log&quot;</span><br>	<span class="hljs-string">&quot;net/http&quot;</span><br>	_ <span class="hljs-string">&quot;net/http/pprof&quot;</span><br>	<span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span></span> &#123;<br>	<span class="hljs-comment">// åˆå§‹åŒ–æ“ä½œ</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	setup()<br><br>	<span class="hljs-comment">// ç›‘å¬æœåŠ¡é€€å‡º</span><br>	done := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> error, <span class="hljs-number">2</span>)<br>	<span class="hljs-comment">// æ§åˆ¶æœåŠ¡é€€å‡º</span><br>	stop := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;, <span class="hljs-number">0</span>)<br><br>	<span class="hljs-comment">// for debug</span><br>	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>		done &lt;- pprof(stop)<br>	&#125;()<br><br>	<span class="hljs-comment">// ä¸»ç¨‹åº</span><br>	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>		done &lt;- app(stop)<br>	&#125;()<br><br>	<span class="hljs-keyword">var</span> stoped <span class="hljs-keyword">bool</span><br><br>	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">cap</span>(done); i++ &#123;<br>		<span class="hljs-keyword">if</span> err := &lt;-done; err != <span class="hljs-literal">nil</span> &#123;<br>			log.Printf(<span class="hljs-string">&quot;server exit err: %+v&quot;</span>, err)<br>		&#125;<br><br>		<span class="hljs-keyword">if</span> !stoped &#123;<br>			stoped = <span class="hljs-literal">true</span><br>			<span class="hljs-built_in">close</span>(stop)<br>		&#125;<br>	&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">app</span><span class="hljs-params">(stop &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;)</span> <span class="hljs-title">error</span></span> &#123;<br>	mux := http.NewServeMux()<br>	mux.HandleFunc(<span class="hljs-string">&quot;/ping&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br>		w.Write([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;pong&quot;</span>))<br>	&#125;)<br><br>	<span class="hljs-keyword">return</span> server(mux, <span class="hljs-string">&quot;:8080&quot;</span>, stop)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">pprof</span><span class="hljs-params">(stop &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;)</span> <span class="hljs-title">error</span></span> &#123;<br>	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>		server(http.DefaultServeMux, <span class="hljs-string">&quot;:8081&quot;</span>, stop)<br>	&#125;()<br><br>	time.Sleep(<span class="hljs-number">5</span> * time.Second)<br>	<span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;mock pprof exit&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">// å¯åŠ¨æœåŠ¡</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">server</span><span class="hljs-params">(handler http.Handler, addr <span class="hljs-keyword">string</span>, stop &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;)</span> <span class="hljs-title">error</span></span> &#123;<br>	s := http.Server&#123;<br>		Handler: handler,<br>		Addr:    addr,<br>	&#125;<br><br>	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>		&lt;-stop<br>		log.Printf(<span class="hljs-string">&quot;server will exiting, addr: %s&quot;</span>, addr)<br>		s.Shutdown(context.Background())<br>	&#125;()<br><br>	<span class="hljs-keyword">return</span> s.ListenAndServe()<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="Channels"><a href="#Channels" class="headerlink" title="Channels"></a>Channels</h2><blockquote>
<p>Synchronization and messaging<br>Channels are typed values that allow goroutines to synchronize and exchange information<br>Channels are first-class values<br>A channel in Go provides a connection between two goroutines, allowing them to communicate</p>
</blockquote>
<ul>
<li><p>æ— ç¼“å†²é€šé“ no-buffer channel</p>
<blockquote>
<p>å‘é€è€…sender å’Œ æ¥æ”¶è€… receiver å¿…é¡»åŒæ—¶å‡†å¤‡å¥½æ‰èƒ½è¿›è¡Œä¸‹å»</p>
</blockquote>
</li>
<li><p>ç¼“å†²é€šé“ buffer channel</p>
<blockquote>
<p>ç¼“å†²é€šé“è§£å†³åŒæ­¥ç­‰å¾…é—®é¢˜</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// Declaring and initializing</span><br>c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)<br><br><span class="hljs-comment">// Sending on a channel.</span><br>c &lt;- <span class="hljs-number">1</span><br><br><span class="hljs-comment">// Receiving from a channel</span><br><span class="hljs-comment">// The &quot;arrow&quot; indicates the direction of data flow.</span><br>value = &lt;-c<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Select"><a href="#Select" class="headerlink" title="Select"></a>Select</h2><blockquote>
<p>Multi-way concurrent control<br>The select statement is like a switch, but the decision is based on ability to communicate rather than equal values</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// Fan-in using select</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fanIn</span><span class="hljs-params">(input1, input2 &lt;- <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)</span> &lt;- <span class="hljs-title">chan</span> <span class="hljs-title">string</span></span> &#123;<br>  c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<br>  <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">for</span> &#123;<br>      <span class="hljs-keyword">select</span> &#123;<br>        <span class="hljs-keyword">case</span> s := &lt;-input1: c &lt;- s<br>        <span class="hljs-keyword">case</span> s := &lt;-input2: c &lt;- s<br>      &#125;<br>    &#125;<br>  &#125;()<br>  <span class="hljs-keyword">return</span> c<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h2 id="Closures"><a href="#Closures" class="headerlink" title="Closures"></a>Closures</h2><h3 id="Demo-Project"><a href="#Demo-Project" class="headerlink" title="Demo Project"></a>Demo Project</h3><blockquote>
<p>Always use the right tool for the job</p>
</blockquote>
<ul>
<li>Google Search: A fake framework<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> google_search_test<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;fmt&quot;</span><br>	<span class="hljs-string">&quot;math/rand&quot;</span><br>	<span class="hljs-string">&quot;testing&quot;</span><br>	<span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> Result <span class="hljs-keyword">string</span><br><br><span class="hljs-keyword">var</span> (<br>	Web    = fakeSearch(<span class="hljs-string">&quot;web&quot;</span>)<br>	Web1   = fakeSearch(<span class="hljs-string">&quot;web1&quot;</span>)<br>	Web2   = fakeSearch(<span class="hljs-string">&quot;web2&quot;</span>)<br>	Image  = fakeSearch(<span class="hljs-string">&quot;image&quot;</span>)<br>	Image1 = fakeSearch(<span class="hljs-string">&quot;Image1&quot;</span>)<br>	Image2 = fakeSearch(<span class="hljs-string">&quot;Image2&quot;</span>)<br>	Video  = fakeSearch(<span class="hljs-string">&quot;video&quot;</span>)<br>	Video1 = fakeSearch(<span class="hljs-string">&quot;Video1&quot;</span>)<br>	Video2 = fakeSearch(<span class="hljs-string">&quot;Video2&quot;</span>)<br>)<br><br><span class="hljs-keyword">type</span> Search <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(query <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">Result</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fakeSearch</span><span class="hljs-params">(kind <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">Search</span></span> &#123;<br>	<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(query <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">Result</span></span> &#123;<br>		time.Sleep(time.Duration(rand.Intn(<span class="hljs-number">100</span>)) * time.Millisecond)<br>		<span class="hljs-keyword">return</span> Result(fmt.Sprintf(<span class="hljs-string">&quot;%s result for %q\n&quot;</span>, kind, query))<br>	&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Google</span><span class="hljs-params">(query <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(results []Result)</span></span> &#123;<br>	results = <span class="hljs-built_in">append</span>(results, Web(query))<br>	results = <span class="hljs-built_in">append</span>(results, Image(query))<br>	results = <span class="hljs-built_in">append</span>(results, Video(query))<br>	<span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GoogleV2</span><span class="hljs-params">(query <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(results []Result)</span></span> &#123;<br>	<span class="hljs-comment">// Run the Web, Image, and Video searches concurrently</span><br>	c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> Result)<br>	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; c &lt;- Web(query) &#125;()<br>	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; c &lt;- Image(query) &#125;()<br>	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; c &lt;- Video(query) &#125;()<br><br>	<span class="hljs-comment">// wait for all results</span><br>	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ &#123;<br>		result := &lt;-c<br>		results = <span class="hljs-built_in">append</span>(results, result)<br>	&#125;<br>	<span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GoogleV21</span><span class="hljs-params">(query <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(results []Result)</span></span> &#123;<br>	<span class="hljs-comment">// Don;t wait for slow servers. No locks. No condition variables.</span><br>	c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> Result)<br>	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; c &lt;- Web(query) &#125;()<br>	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; c &lt;- Image(query) &#125;()<br>	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; c &lt;- Video(query) &#125;()<br><br>	timeout := time.After(<span class="hljs-number">80</span> * time.Millisecond)<br>	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ &#123;<br>		<span class="hljs-keyword">select</span> &#123;<br>		<span class="hljs-keyword">case</span> result := &lt;-c:<br>			results = <span class="hljs-built_in">append</span>(results, result)<br>		<span class="hljs-keyword">case</span> &lt;-timeout:<br>			fmt.Println(<span class="hljs-string">&quot;timed out&quot;</span>)<br>			<span class="hljs-keyword">return</span><br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GoogleV3</span><span class="hljs-params">(query <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(results []Result)</span></span> &#123;<br>	c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> Result)<br>	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; c &lt;- First(query, Web1, Web2) &#125;()<br>	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; c &lt;- First(query, Image1, Image2) &#125;()<br>	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; c &lt;- First(query, Video1, Video2) &#125;()<br>	timeout := time.After(<span class="hljs-number">80</span> * time.Millisecond)<br>	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ &#123;<br>		<span class="hljs-keyword">select</span> &#123;<br>		<span class="hljs-keyword">case</span> result := &lt;-c:<br>			results = <span class="hljs-built_in">append</span>(results, result)<br>		<span class="hljs-keyword">case</span> &lt;-timeout:<br>			fmt.Println(<span class="hljs-string">&quot;timed out&quot;</span>)<br>			<span class="hljs-keyword">return</span><br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">First</span><span class="hljs-params">(query <span class="hljs-keyword">string</span>, replicas ...Search)</span> <span class="hljs-title">Result</span></span> &#123;<br>	c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> Result)<br>	searchReplica := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(i <span class="hljs-keyword">int</span>)</span></span> &#123; c &lt;- replicas[i](query) &#125;<br>	<span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> replicas &#123;<br>		<span class="hljs-keyword">go</span> searchReplica(i)<br>	&#125;<br>	<span class="hljs-keyword">return</span> &lt;-c<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestGoogle</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br>	rand.Seed(time.Now().UnixNano())<br>	start := time.Now()<br>	results := Google(<span class="hljs-string">&quot;golang&quot;</span>)<br>	elapsed := time.Since(start)<br>	fmt.Println(results)<br>	fmt.Println(elapsed)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestGoogleV2</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br>	rand.Seed(time.Now().UnixNano())<br>	start := time.Now()<br>	results := GoogleV2(<span class="hljs-string">&quot;golang&quot;</span>)<br>	elapsed := time.Since(start)<br>	fmt.Println(results)<br>	fmt.Println(elapsed)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestGoogleV21</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br>	rand.Seed(time.Now().UnixNano())<br>	start := time.Now()<br>	results := GoogleV21(<span class="hljs-string">&quot;golang&quot;</span>)<br>	elapsed := time.Since(start)<br>	fmt.Println(results)<br>	fmt.Println(elapsed)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestGoogleV3</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br>	rand.Seed(time.Now().UnixNano())<br>	start := time.Now()<br>	results := GoogleV3(<span class="hljs-string">&quot;golang&quot;</span>)<br>	elapsed := time.Since(start)<br>	fmt.Println(results)<br>	fmt.Println(elapsed)<br>&#125;<br><br><br><span class="hljs-comment">// âœ go test -v google_search_test.go</span><br><span class="hljs-comment">// === RUN   TestGoogle</span><br><span class="hljs-comment">// [web result for &quot;golang&quot;</span><br><span class="hljs-comment">//  image result for &quot;golang&quot;</span><br><span class="hljs-comment">//  video result for &quot;golang&quot;</span><br><span class="hljs-comment">// ]</span><br><span class="hljs-comment">// 31.882269ms</span><br><span class="hljs-comment">// --- PASS: TestGoogle (0.03s)</span><br><span class="hljs-comment">// === RUN   TestGoogleV2</span><br><span class="hljs-comment">// [web result for &quot;golang&quot;</span><br><span class="hljs-comment">//  image result for &quot;golang&quot;</span><br><span class="hljs-comment">//  video result for &quot;golang&quot;</span><br><span class="hljs-comment">// ]</span><br><span class="hljs-comment">// 49.036197ms</span><br><span class="hljs-comment">// --- PASS: TestGoogleV2 (0.05s)</span><br><span class="hljs-comment">// === RUN   TestGoogleV21</span><br><span class="hljs-comment">// [web result for &quot;golang&quot;</span><br><span class="hljs-comment">//  video result for &quot;golang&quot;</span><br><span class="hljs-comment">//  image result for &quot;golang&quot;</span><br><span class="hljs-comment">// ]</span><br><span class="hljs-comment">// 53.507162ms</span><br><span class="hljs-comment">// --- PASS: TestGoogleV21 (0.05s)</span><br><span class="hljs-comment">// === RUN   TestGoogleV3</span><br><span class="hljs-comment">// [Video2 result for &quot;golang&quot;</span><br><span class="hljs-comment">//  web1 result for &quot;golang&quot;</span><br><span class="hljs-comment">//  Image1 result for &quot;golang&quot;</span><br><span class="hljs-comment">// ]</span><br><span class="hljs-comment">// 41.612001ms</span><br><span class="hljs-comment">// --- PASS: TestGoogleV3 (0.04s)</span><br><span class="hljs-comment">// PASS</span><br><span class="hljs-comment">// ok  	command-line-arguments	0.301s</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Best-Practice-Writing-Go-Code-æœ€ä½³å®è·µ"><a href="#Best-Practice-Writing-Go-Code-æœ€ä½³å®è·µ" class="headerlink" title="Best Practice Writing Go Code: æœ€ä½³å®è·µ"></a>Best Practice Writing Go Code: æœ€ä½³å®è·µ</h2><ul>
<li>software programming è½¯ä»¶ç¼–ç¨‹</li>
<li>software engineering è½¯ä»¶å·¥ç¨‹</li>
</ul>
<h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ul>
<li><a href="https://dave.cheney.net/practical-go/presentations/qcon-china.html">Practical Go: Real world advice for writing maintainable Go Programs</a></li>
</ul>
]]></content>
      <categories>
        <category>Programming Language</category>
      </categories>
  </entry>
  <entry>
    <title>Ansible Intro</title>
    <url>/2021/09/11/Ansible-Intro/</url>
    <content><![CDATA[<h1 id="Ansible"><a href="#Ansible" class="headerlink" title="Ansible"></a>Ansible</h1><blockquote>
<p>Tool to automate IT tasks.</p>
</blockquote>
<ul>
<li>SIMPLE<ul>
<li>Human readable automation</li>
<li>No special coding skills needed</li>
<li>Tasks executed in order</li>
</ul>
</li>
<li>POWERFUL<ul>
<li>App deployment</li>
<li>Configuration management</li>
<li>Workflow orchestration</li>
</ul>
</li>
<li>AGENTLESS<ul>
<li>Agentless architecture</li>
<li>Use OpenSSH &amp; WinRM</li>
</ul>
</li>
</ul>
<h2 id="What-Can-I-Use-Ansible-To-Do"><a href="#What-Can-I-Use-Ansible-To-Do" class="headerlink" title="What Can I Use Ansible To Do?"></a>What Can I Use Ansible To Do?</h2><ul>
<li>Config Management</li>
<li>App deployment</li>
<li>Provisioning</li>
<li>Continuous delivery</li>
<li>Security &amp; Compliance</li>
<li>orchestration</li>
</ul>
<h2 id="Ansible-Architecture"><a href="#Ansible-Architecture" class="headerlink" title="Ansible Architecture"></a>Ansible Architecture</h2><p><img src="/misc/images/ansible-architecture.png" alt="ansible architecture"></p>
<ul>
<li>MODULES:</li>
</ul>
<h2 id="Quick-Start-Ansible"><a href="#Quick-Start-Ansible" class="headerlink" title="Quick Start Ansible"></a>Quick Start Ansible</h2><ul>
<li>Installing an Ansible<figure class="highlight dsconfig"><table><tr><td class="code"><pre><code class="hljs dsconfig">$ <span class="hljs-string">curl</span> <span class="hljs-string">https</span>://<span class="hljs-string">bootstrap</span>.<span class="hljs-string">pypa</span>.<span class="hljs-string">io</span>/<span class="hljs-built_in">get-pip.py</span> -<span class="hljs-string">o</span> <span class="hljs-built_in">get-pip.py</span><br>$ <span class="hljs-string">python</span> <span class="hljs-built_in">get-pip.py</span> <span class="hljs-built_in">--user</span><br>$ <span class="hljs-string">python</span> -<span class="hljs-string">m</span> <span class="hljs-string">pip</span> <span class="hljs-string">install</span> <span class="hljs-built_in">--user</span> <span class="hljs-string">ansible</span><br><br>âœ <span class="hljs-string">ansible</span> <span class="hljs-built_in">--version</span><br><span class="hljs-string">ansible</span> [<span class="hljs-string">core</span> <span class="hljs-string">2</span>.<span class="hljs-string">11</span>.<span class="hljs-string">4</span>]<br>  <span class="hljs-string">config</span> <span class="hljs-string">file</span> = <span class="hljs-string">None</span><br>  <span class="hljs-string">configured</span> <span class="hljs-string">module</span> <span class="hljs-string">search</span> <span class="hljs-string">path</span> = [<span class="hljs-string">&#x27;/Users/chyiyaqing/.ansible/plugins/modules&#x27;</span>, <span class="hljs-string">&#x27;/usr/share/ansible/plugins/modules&#x27;</span>]<br>  <span class="hljs-string">ansible</span> <span class="hljs-string">python</span> <span class="hljs-string">module</span> <span class="hljs-string">location</span> = /<span class="hljs-string">usr</span>/<span class="hljs-string">local</span>/<span class="hljs-string">lib</span>/<span class="hljs-string">python3</span>.<span class="hljs-string">9</span>/<span class="hljs-string">site-packages</span>/<span class="hljs-string">ansible</span><br>  <span class="hljs-string">ansible</span> <span class="hljs-string">collection</span> <span class="hljs-string">location</span> = /<span class="hljs-string">Users</span>/<span class="hljs-string">chyiyaqing</span>/.<span class="hljs-string">ansible</span>/<span class="hljs-string">collections</span>:/<span class="hljs-string">usr</span>/<span class="hljs-string">share</span>/<span class="hljs-string">ansible</span>/<span class="hljs-string">collections</span><br>  <span class="hljs-string">executable</span> <span class="hljs-string">location</span> = /<span class="hljs-string">usr</span>/<span class="hljs-string">local</span>/<span class="hljs-string">bin</span>/<span class="hljs-string">ansible</span><br>  <span class="hljs-string">python</span> <span class="hljs-string">version</span> = <span class="hljs-string">3</span>.<span class="hljs-string">9</span>.<span class="hljs-string">6</span> (<span class="hljs-string">default</span>, <span class="hljs-string">Jun</span> <span class="hljs-string">29</span> <span class="hljs-string">2021</span>, <span class="hljs-string">05:25:</span><span class="hljs-string">02</span>) [<span class="hljs-string">Clang</span> <span class="hljs-string">12</span>.<span class="hljs-string">0</span>.<span class="hljs-string">5</span> (<span class="hljs-string">clang-1205</span>.<span class="hljs-string">0</span>.<span class="hljs-string">22</span>.<span class="hljs-string">9</span>)]<br>  <span class="hljs-string">jinja</span> <span class="hljs-string">version</span> = <span class="hljs-string">2</span>.<span class="hljs-string">10</span>.<span class="hljs-string">1</span><br>  <span class="hljs-string">libyaml</span> = <span class="hljs-string">True</span><br></code></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>DevOps</category>
      </categories>
  </entry>
  <entry>
    <title>Go CLI Intro</title>
    <url>/2021/09/11/Go-CLI-Intro/</url>
    <content><![CDATA[<h2 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h2><blockquote>
<p>å‘½ä»¤è¡Œflagè§£æ</p>
</blockquote>
<ul>
<li><p>flag é•¿çŸ­é€‰é¡¹</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">func</span> main() &#123;<br>	var name string<br><br>  <span class="hljs-regexp">//</span> -flag: ä»…æ”¯æŒå¸ƒå°”ç±»å‹<br>  <span class="hljs-regexp">//</span> -flag x: ä»…æ”¯æŒéå¸ƒå°”ç±»å‹<br>  <span class="hljs-regexp">//</span> -flag=x: å‡æ”¯æŒ<br>  <span class="hljs-regexp">//</span> é•¿çŸ­é€‰é¡¹ åˆ†å¼€ä¸¤æ¬¡è°ƒç”¨<br>	flag.StringVar(&amp;name, <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;Golang flag tour&quot;</span>, <span class="hljs-string">&quot;help&quot;</span>)<br>	flag.StringVar(&amp;name, <span class="hljs-string">&quot;n&quot;</span>, <span class="hljs-string">&quot;Golang flag tour&quot;</span>, <span class="hljs-string">&quot;help&quot;</span>)<br>	flag.Parse()<br><br>	log.Printf(<span class="hljs-string">&quot;name: %s&quot;</span>, name)<br>&#125;<br><br><span class="hljs-regexp">//</span> âœ go run flag/demo.go -name=<span class="hljs-string">&#x27;hello world&#x27;</span> -n <span class="hljs-string">&#x27;hello world&#x27;</span><br><span class="hljs-regexp">//</span> <span class="hljs-number">2021</span><span class="hljs-regexp">/09/</span><span class="hljs-number">11</span> <span class="hljs-number">18</span>:<span class="hljs-number">26</span>:<span class="hljs-number">39</span> name: hello world<br></code></pre></td></tr></table></figure></li>
<li><p>flag å­å‘½ä»¤</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">func</span> main() &#123;<br>	var name string<br><br>	flag.Parse()<br>	args := flag.Args()<br>	<span class="hljs-keyword">if</span> len(args) &lt;= <span class="hljs-number">0</span> &#123;<br>		return<br>	&#125;<br><br>	switch args[<span class="hljs-number">0</span>] &#123;<br>	case <span class="hljs-string">&quot;go&quot;</span>:<br>		goCmd := flag.NewFlagSet(<span class="hljs-string">&quot;go&quot;</span>, flag.ExitOnError)<br>		goCmd.StringVar(&amp;name, <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;Golang language&quot;</span>, <span class="hljs-string">&quot;help&quot;</span>)<br>		_ = goCmd.Parse(args[<span class="hljs-number">1</span>:])<br>	case <span class="hljs-string">&quot;py&quot;</span>:<br>		pyCmd := flag.NewFlagSet(<span class="hljs-string">&quot;py&quot;</span>, flag.ExitOnError)<br>		pyCmd.StringVar(&amp;name, <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;Python language&quot;</span>, <span class="hljs-string">&quot;help&quot;</span>)<br>		_ = pyCmd.Parse(args[<span class="hljs-number">1</span>:])<br>	&#125;<br><br>	log.Printf(<span class="hljs-string">&quot;name: %s&quot;</span>, name)<br>&#125;<br><br><span class="hljs-regexp">//</span> âœ go run flag/flag_sub_cli.go go -name=golang<br><span class="hljs-regexp">//</span> <span class="hljs-number">2021</span><span class="hljs-regexp">/09/</span><span class="hljs-number">11</span> <span class="hljs-number">18</span>:<span class="hljs-number">39</span>:<span class="hljs-number">47</span> name: golang<br><span class="hljs-regexp">//</span><br><span class="hljs-regexp">//</span> âœ go run flag/flag_sub_cli.go go -n=python<br><span class="hljs-regexp">//</span> flag provided but not defined: -n<br><span class="hljs-regexp">//</span> Usage of go:<br><span class="hljs-regexp">//</span>   -name string<br><span class="hljs-regexp">//</span>     	help (default <span class="hljs-string">&quot;Golang language&quot;</span>)<br><span class="hljs-regexp">//</span> <span class="hljs-keyword">exit</span> status <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure></li>
<li><p>flag æºç åˆ†æ</p>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"># flag.Parse<br><br><span class="hljs-comment">// CommandLine is the default set of command-line flags, parsed from os.Args.</span><br><span class="hljs-comment">// The top-level functions such as BoolVar, Arg, and so on are wrappers for the</span><br><span class="hljs-comment">// methods of CommandLine.</span><br><span class="hljs-keyword">var</span> CommandLine = NewFlagSet(os.Args[<span class="hljs-number">0</span>], ExitOnError)<br><br><span class="hljs-comment">// Parse parses the command-line flags from os.Args[1:]. Must be called</span><br><span class="hljs-comment">// after all flags are defined and before flags are accessed by the program.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Parse</span><span class="hljs-params">()</span></span> &#123;<br>	<span class="hljs-comment">// Ignore errors; CommandLine is set for ExitOnError.</span><br>	CommandLine.Parse(os.Args[<span class="hljs-number">1</span>:])<br>&#125;<br><br># FlagSet.Parse<br>&gt; parseå¼‚å¸¸åˆ†æµå¤„ç†<br><span class="hljs-comment">// Parse parses flag definitions from the argument list, which should not</span><br><span class="hljs-comment">// include the command name. Must be called after all flags in the FlagSet</span><br><span class="hljs-comment">// are defined and before flags are accessed by the program.</span><br><span class="hljs-comment">// The return value will be ErrHelp if -help or -h were set but not defined.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f *FlagSet)</span> <span class="hljs-title">Parse</span><span class="hljs-params">(arguments []<span class="hljs-keyword">string</span>)</span> <span class="hljs-title">error</span></span> &#123;<br>	f.parsed = <span class="hljs-literal">true</span><br>	f.args = arguments<br>	<span class="hljs-keyword">for</span> &#123;<br>		seen, err := f.parseOne()<br>		<span class="hljs-keyword">if</span> seen &#123;<br>			<span class="hljs-keyword">continue</span><br>		&#125;<br>		<span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> &#123;<br>			<span class="hljs-keyword">break</span><br>		&#125;<br>		<span class="hljs-keyword">switch</span> f.errorHandling &#123;<br>		<span class="hljs-keyword">case</span> ContinueOnError:<br>			<span class="hljs-keyword">return</span> err<br>		<span class="hljs-keyword">case</span> ExitOnError:<br>			<span class="hljs-keyword">if</span> err == ErrHelp &#123;<br>				os.Exit(<span class="hljs-number">0</span>)<br>			&#125;<br>			os.Exit(<span class="hljs-number">2</span>)<br>		<span class="hljs-keyword">case</span> PanicOnError:<br>			<span class="hljs-built_in">panic</span>(err)<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><br># FlagSet.parseOne<br><span class="hljs-comment">// parseOne parses one flag. It reports whether a flag was seen.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f *FlagSet)</span> <span class="hljs-title">parseOne</span><span class="hljs-params">()</span> <span class="hljs-params">(<span class="hljs-keyword">bool</span>, error)</span></span> &#123;<br>	<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(f.args) == <span class="hljs-number">0</span> &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>, <span class="hljs-literal">nil</span><br>	&#125;<br>	s := f.args[<span class="hljs-number">0</span>]<br>	<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(s) &lt; <span class="hljs-number">2</span> || s[<span class="hljs-number">0</span>] != <span class="hljs-string">&#x27;-&#x27;</span> &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>, <span class="hljs-literal">nil</span><br>	&#125;<br>	numMinuses := <span class="hljs-number">1</span><br>	<span class="hljs-keyword">if</span> s[<span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;-&#x27;</span> &#123;<br>		numMinuses++<br>		<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(s) == <span class="hljs-number">2</span> &#123; <span class="hljs-comment">// &quot;--&quot; terminates the flags</span><br>			f.args = f.args[<span class="hljs-number">1</span>:]<br>			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>, <span class="hljs-literal">nil</span><br>		&#125;<br>	&#125;<br>	name := s[numMinuses:]<br>	<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(name) == <span class="hljs-number">0</span> || name[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;-&#x27;</span> || name[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;=&#x27;</span> &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>, f.failf(<span class="hljs-string">&quot;bad flag syntax: %s&quot;</span>, s)<br>	&#125;<br><br>	<span class="hljs-comment">// it&#x27;s a flag. does it have an argument?</span><br>	f.args = f.args[<span class="hljs-number">1</span>:]<br>	hasValue := <span class="hljs-literal">false</span><br>	value := <span class="hljs-string">&quot;&quot;</span><br>	<span class="hljs-keyword">for</span> i := <span class="hljs-number">1</span>; i &lt; <span class="hljs-built_in">len</span>(name); i++ &#123; <span class="hljs-comment">// equals cannot be first</span><br>		<span class="hljs-keyword">if</span> name[i] == <span class="hljs-string">&#x27;=&#x27;</span> &#123;<br>			value = name[i+<span class="hljs-number">1</span>:]<br>			hasValue = <span class="hljs-literal">true</span><br>			name = name[<span class="hljs-number">0</span>:i]<br>			<span class="hljs-keyword">break</span><br>		&#125;<br>	&#125;<br>	m := f.formal<br>	flag, alreadythere := m[name] <span class="hljs-comment">// BUG</span><br>	<span class="hljs-keyword">if</span> !alreadythere &#123;<br>		<span class="hljs-keyword">if</span> name == <span class="hljs-string">&quot;help&quot;</span> || name == <span class="hljs-string">&quot;h&quot;</span> &#123; <span class="hljs-comment">// special case for nice help message.</span><br>			f.usage()<br>			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>, ErrHelp<br>		&#125;<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>, f.failf(<span class="hljs-string">&quot;flag provided but not defined: -%s&quot;</span>, name)<br>	&#125;<br><br>	<span class="hljs-keyword">if</span> fv, ok := flag.Value.(boolFlag); ok &amp;&amp; fv.IsBoolFlag() &#123; <span class="hljs-comment">// special case: doesn&#x27;t need an arg</span><br>		<span class="hljs-keyword">if</span> hasValue &#123;<br>			<span class="hljs-keyword">if</span> err := fv.Set(value); err != <span class="hljs-literal">nil</span> &#123;<br>				<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>, f.failf(<span class="hljs-string">&quot;invalid boolean value %q for -%s: %v&quot;</span>, value, name, err)<br>			&#125;<br>		&#125; <span class="hljs-keyword">else</span> &#123;<br>			<span class="hljs-keyword">if</span> err := fv.Set(<span class="hljs-string">&quot;true&quot;</span>); err != <span class="hljs-literal">nil</span> &#123;<br>				<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>, f.failf(<span class="hljs-string">&quot;invalid boolean flag %s: %v&quot;</span>, name, err)<br>			&#125;<br>		&#125;<br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		<span class="hljs-comment">// It must have a value, which might be the next argument.</span><br>		<span class="hljs-keyword">if</span> !hasValue &amp;&amp; <span class="hljs-built_in">len</span>(f.args) &gt; <span class="hljs-number">0</span> &#123;<br>			<span class="hljs-comment">// value is the next arg</span><br>			hasValue = <span class="hljs-literal">true</span><br>			value, f.args = f.args[<span class="hljs-number">0</span>], f.args[<span class="hljs-number">1</span>:]<br>		&#125;<br>		<span class="hljs-keyword">if</span> !hasValue &#123;<br>			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>, f.failf(<span class="hljs-string">&quot;flag needs an argument: -%s&quot;</span>, name)<br>		&#125;<br>		<span class="hljs-keyword">if</span> err := flag.Value.Set(value); err != <span class="hljs-literal">nil</span> &#123;<br>			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>, f.failf(<span class="hljs-string">&quot;invalid value %q for flag -%s: %v&quot;</span>, value, name, err)<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">if</span> f.actual == <span class="hljs-literal">nil</span> &#123;<br>		f.actual = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]*Flag)<br>	&#125;<br>	f.actual[name] = flag<br>	<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>, <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Cobra"><a href="#Cobra" class="headerlink" title="Cobra"></a>Cobra</h2>]]></content>
      <categories>
        <category>Programming Language</category>
      </categories>
  </entry>
  <entry>
    <title>Go Constants</title>
    <url>/2021/09/12/Go-Constants/</url>
    <content><![CDATA[<h1 id="Constants-å¸¸é‡"><a href="#Constants-å¸¸é‡" class="headerlink" title="Constants å¸¸é‡"></a>Constants å¸¸é‡</h1><blockquote>
<p>Goæ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œä¸å…è®¸åŒæ­¥ç±»å‹çš„æ•°å€¼ç±»å‹è¿›è¡Œè®¡ç®—. ä¸å…è®¸float64 + int ç”šè‡³ int32 + int. å¦‚æœä½ å¸Œæœ›ä¸åŒç±»å‹è¿›è¡Œè®¡ç®—éœ€è¦æ˜¾å¼è½¬æ¢ååœ¨è¿›è¡Œ int(float64) + int.</p>
</blockquote>
<span id="more"></span>

<h2 id="å­—ç¬¦ä¸²å¸¸é‡"><a href="#å­—ç¬¦ä¸²å¸¸é‡" class="headerlink" title="å­—ç¬¦ä¸²å¸¸é‡"></a>å­—ç¬¦ä¸²å¸¸é‡</h2><blockquote>
<p>å­—ç¬¦ä¸²å¸¸é‡ä½¿ç”¨åŒå¼•å·(Goå¯ä»¥ä½¿ç”¨<code>raw string</code>)<br>  <figure class="highlight vala"><table><tr><td class="code"><pre><code class="hljs vala"><span class="hljs-meta"># hello æ˜¯ä¸€ä¸ªæ— ç±»å‹çš„å­—ç¬¦ä¸²å¸¸é‡, èµ‹å€¼ç»™æœ‰ç±»å‹çš„å˜é‡ä¸ä¼šå¼•èµ·ç±»å‹é”™è¯¯.</span><br><span class="hljs-keyword">const</span> hello = <span class="hljs-string">&quot;Hello, ä¸–ç•Œ&quot;</span><br><br><span class="hljs-meta"># helloæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡</span><br><span class="hljs-keyword">const</span> typedHello <span class="hljs-keyword">string</span> = <span class="hljs-string">&quot;Hello, ä¸–ç•Œ&quot;</span><br></code></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="é»˜è®¤ç±»å‹"><a href="#é»˜è®¤ç±»å‹" class="headerlink" title="é»˜è®¤ç±»å‹"></a>é»˜è®¤ç±»å‹</h2>  <figure class="highlight hsp"><table><tr><td class="code"><pre><code class="hljs hsp"><span class="hljs-meta"># str := <span class="hljs-meta-string">&quot;Hello, ä¸–ç•Œ&quot;</span></span><br>å¯èƒ½ä¼šæœ‰ç–‘æƒ‘ï¼Œå¦‚æœå¸¸é‡æ˜¯æ²¡æœ‰ç±»å‹çš„ï¼Œ<span class="hljs-keyword">str</span>å˜é‡å¦‚ä½•è·å–åˆ°ç±»å‹? ç­”æ¡ˆå°±æ˜¯æ— ç±»å‹çš„å¸¸é‡æœ‰ä¸€ä¸ªé»˜è®¤ç±»å‹ï¼Œå¦‚æœå˜é‡<span class="hljs-keyword">str</span>æ²¡æœ‰å£°æ˜ç±»å‹ä¼šä½¿ç”¨å³è¾¹è¡¨è¾¾å¼ä¸­çš„é»˜è®¤ç±»å‹.<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Programming Language</category>
      </categories>
  </entry>
  <entry>
    <title>Go PProf Intro</title>
    <url>/2021/09/13/Go-PProf-Intro/</url>
    <content><![CDATA[<h1 id="Go-Profling-å‰–æ"><a href="#Go-Profling-å‰–æ" class="headerlink" title="Go Profling - å‰–æ"></a>Go Profling - å‰–æ</h1><blockquote>
<p>Using â€œpprofâ€ to profiling your program<br>Goè¯­è¨€å¯è§†åŒ–æ€§èƒ½åˆ†æå·¥å…·,PProfä»¥profile.protoè¯»å–åˆ†ææ ·æœ¬é›†åˆï¼Œå¹¶ç”ŸæˆæŠ¥å‘Šå¯è§†åŒ–å¸®åŠ©åˆ†ææ•°æ®(æ”¯æŒæ–‡æœ¬å’Œå›¾å½¢æŠ¥å‘Š)</p>
</blockquote>
<ul>
<li><p>ä½¿ç”¨åœºæ™¯</p>
<ul>
<li>runtime/pprof: é‡‡é›†ç¨‹åºæŒ‡å®šåŒºå—çš„è¿è¡Œæ•°æ®åˆ†æ</li>
<li>net/http/pprof: åŸºäºHTTP Serverè¿è¡Œ,é‡‡é›†è¿è¡Œæ—¶æ•°æ®åˆ†æ</li>
<li>go test: é€šè¿‡è¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼ŒæŒ‡å®šæ‰€éœ€æ ‡è¯†è¿›è¡Œé‡‡æ ·</li>
</ul>
</li>
<li><p>å®‰è£…å¯è§†åŒ–å·¥å…·graphvizæŸ¥çœ‹profile</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><code class="hljs vala"><span class="hljs-meta"># Mac: $ brew install graphviz</span><br><span class="hljs-meta"># Linux: $ sudo apt install graphviz</span><br></code></pre></td></tr></table></figure></li>
<li><p>æ”¯æŒæ¨¡å¼</p>
<ul>
<li>æŠ¥å‘Šç”Ÿæˆ Report generation</li>
<li>äº¤äº’ç»ˆç«¯ä½¿ç”¨ Interactive terminal use</li>
<li>Webé¡µé¢ Web interface</li>
</ul>
</li>
<li><p>å¯ä»¥åšé‚£äº›</p>
<ul>
<li>CPU Profiling: CPUåˆ†æ<ul>
<li>æŒ‰ç…§ä¸€å®šé¢‘ç‡é‡‡é›†ç›‘å¬åº”ç”¨ç¨‹åºCPUä½¿ç”¨æƒ…å†µï¼Œç¡®å®šåº”ç”¨ç¨‹åºçš„ä¸»åŠ¨æ¶ˆè€—CPUå‘¨æœŸæ—¶èŠ±è´¹æ—¶é—´çš„ä½ç½®</li>
</ul>
</li>
<li>Memory Profiling: å†…å­˜åˆ†æ<ul>
<li>ç¨‹åºè¿›è¡Œå †åˆ†é…æ—¶è®°å½•å †æ ˆè·Ÿè¸ªï¼Œç›‘è§†å½“å‰å’Œå†å²å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œæ£€æŸ¥å†…å­˜æ³„æ¼</li>
</ul>
</li>
<li>Block Profiling: é˜»å¡åˆ†æ<ul>
<li>è®°å½•Goroutineé˜»å¡ç­‰å¾…åŒæ­¥çš„ä½ç½®ï¼Œé»˜è®¤ä¸å¼€å¯ï¼Œéœ€è¦è°ƒç”¨runtime.SetBlockProfileRate è®¾ç½®</li>
</ul>
</li>
<li>Mutex Profiling: äº’æ–¥é”åˆ†æ<ul>
<li>æŠ¥å‘Šäº’æ–¥é”çš„ç«äº‰æƒ…å†µ, é»˜è®¤ä¸å¼€å¯, runtime.SetMutexProfileFraction è®¾ç½®</li>
</ul>
</li>
<li>Goroutine Profiling: Goroutineåˆ†æ<ul>
<li>å¯¹å½“å‰åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œçš„Goroutineè¿›è¡Œå †æ ˆè·Ÿè¸ªå’Œåˆ†æ</li>
</ul>
</li>
</ul>
</li>
</ul>
<span id="more"></span>

<h2 id="How-to-Use"><a href="#How-to-Use" class="headerlink" title="How to Use"></a>How to Use</h2><ul>
<li>runtime/pprof<figure class="highlight applescript"><table><tr><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># pprof useful command:</span><br>  <span class="hljs-built_in">text</span>: show <span class="hljs-keyword">the</span> cpu report <span class="hljs-keyword">in</span> <span class="hljs-built_in">text</span> form<br>  web: visualize graph <span class="hljs-keyword">through</span> web browser<br>  top &lt;n&gt;: <span class="hljs-built_in">list</span> <span class="hljs-keyword">the</span> n highest entries <span class="hljs-keyword">in</span> <span class="hljs-built_in">text</span> form<br>  <span class="hljs-built_in">list</span> &lt;function <span class="hljs-built_in">name</span>&gt;: reveal <span class="hljs-keyword">the</span> <span class="hljs-built_in">running</span> <span class="hljs-built_in">time</span> <span class="hljs-keyword">of</span> function<br>  traces<br></code></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk">package main<br><br>import (<br>	<span class="hljs-string">&quot;log&quot;</span><br>	<span class="hljs-string">&quot;net/http&quot;</span><br>	_ <span class="hljs-string">&quot;net/http/pprof&quot;</span><br>	<span class="hljs-string">&quot;time&quot;</span><br>)<br><br>var datas []string<br><br><span class="hljs-keyword">func</span> main() &#123;<br>	go <span class="hljs-keyword">func</span>() &#123;<br>		<span class="hljs-keyword">for</span> &#123;<br>			log.Printf(<span class="hljs-string">&quot;len: %d&quot;</span>, Add(<span class="hljs-string">&quot;go-programming-tour-book&quot;</span>))<br>			time.Sleep(time.Millisecond * <span class="hljs-number">10</span>)<br>		&#125;<br>	&#125;()<br><br>	_ = http.ListenAndServe(<span class="hljs-string">&quot;:8080&quot;</span>, nil)<br>&#125;<br><br><span class="hljs-keyword">func</span> Add(str string) int &#123;<br>	data := []byte(str)<br>	datas = append(datas, string(data))<br>	return len(datas)<br>&#125;<br><br><span class="hljs-regexp">//</span> è®¿é—® http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8080</span><span class="hljs-regexp">/debug/</span>pprof<br><span class="hljs-regexp">//</span> <span class="hljs-regexp">/debug/</span>pprof/<br><span class="hljs-regexp">//</span><br><span class="hljs-regexp">//</span> Types of profiles available:<br><span class="hljs-regexp">//</span> Count	Profile<br><span class="hljs-regexp">//</span> <span class="hljs-number">3</span>	allocs                -- æŸ¥çœ‹è¿‡å»å†…å­˜åˆ†é…æ ·æœ¬<br><span class="hljs-regexp">//</span> <span class="hljs-number">0</span>	block                 -- æŸ¥çœ‹é˜»å¡<br><span class="hljs-regexp">//</span> <span class="hljs-number">0</span>	cmdline               -- å‘½ä»¤è¡Œè°ƒç”¨è·¯å¾„<br><span class="hljs-regexp">//</span> <span class="hljs-number">5</span>	goroutine             -- goroutineå †æ ˆè·Ÿè¸ª<br><span class="hljs-regexp">//</span> <span class="hljs-number">3</span>	heap                  -- å †ä¸Šå†…å­˜åˆ†é…<br><span class="hljs-regexp">//</span> <span class="hljs-number">0</span>	mutex                 -- äº’æ–¥é”ç«äº‰æŒæœ‰è€…å †æ ˆè·Ÿè¸ª<br><span class="hljs-regexp">//</span> <span class="hljs-number">0</span>	profile               -- é»˜è®¤<span class="hljs-number">30</span>ç§’CPU Profiling<br><span class="hljs-regexp">//</span> <span class="hljs-number">7</span>	threadcreate          --<br><span class="hljs-regexp">//</span> <span class="hljs-number">0</span>	trace<br><span class="hljs-regexp">//</span> full goroutine stack dump<br></code></pre></td></tr></table></figure>

<ul>
<li><p>CPU Profiling</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><code class="hljs vim">âœ <span class="hljs-keyword">go</span> tool pprof http://localhos<span class="hljs-variable">t:8080</span>/<span class="hljs-keyword">debug</span>/pprof/<span class="hljs-keyword">profile</span>\?seconds\=<span class="hljs-number">5</span><br>Fetching <span class="hljs-keyword">profile</span> over HTTP from http://localhos<span class="hljs-variable">t:8080</span>/<span class="hljs-keyword">debug</span>/pprof/<span class="hljs-keyword">profile</span>?seconds=<span class="hljs-number">5</span><br>Saved <span class="hljs-keyword">profile</span> in /Users/chyiyaqing/pprof/pprof.samples.cpu.<span class="hljs-number">001</span>.pb.gz<br>Type: cpu<br>Time: Sep <span class="hljs-number">13</span>, <span class="hljs-number">2021</span> at <span class="hljs-number">5</span>:<span class="hljs-number">22</span>pm (CST)<br>Duration: <span class="hljs-number">5</span>s, Total samples = <span class="hljs-number">20</span>ms (  <span class="hljs-number">0.4</span>%)<br>Entering interactive <span class="hljs-keyword">mode</span> (<span class="hljs-built_in">type</span> <span class="hljs-string">&quot;help&quot;</span> <span class="hljs-keyword">for</span> commands, <span class="hljs-string">&quot;o&quot;</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">options</span>)<br>(pprof) top10<br>Showing nodes accounting <span class="hljs-keyword">for</span> <span class="hljs-number">20</span>ms, <span class="hljs-number">100</span>% of <span class="hljs-number">20</span>ms total<br>Showing top <span class="hljs-number">10</span> nodes out of <span class="hljs-number">11</span><br>      flat  flat%   sum%        cum   cum%<br>      <span class="hljs-number">10</span>ms <span class="hljs-number">50.00</span>% <span class="hljs-number">50.00</span>%       <span class="hljs-number">10</span>ms <span class="hljs-number">50.00</span>%  <span class="hljs-keyword">runtime</span>.kevent<br>      <span class="hljs-number">10</span>ms <span class="hljs-number">50.00</span>%   <span class="hljs-number">100</span>%       <span class="hljs-number">10</span>ms <span class="hljs-number">50.00</span>%  <span class="hljs-keyword">runtime</span>.pthread_cond_wait<br>         <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%       <span class="hljs-number">20</span>ms   <span class="hljs-number">100</span>%  <span class="hljs-keyword">runtime</span>.findrunnable<br>         <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%       <span class="hljs-number">10</span>ms <span class="hljs-number">50.00</span>%  <span class="hljs-keyword">runtime</span>.mPark<br>         <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%       <span class="hljs-number">20</span>ms   <span class="hljs-number">100</span>%  <span class="hljs-keyword">runtime</span>.mcall<br>         <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%       <span class="hljs-number">10</span>ms <span class="hljs-number">50.00</span>%  <span class="hljs-keyword">runtime</span>.netpoll<br>         <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%       <span class="hljs-number">10</span>ms <span class="hljs-number">50.00</span>%  <span class="hljs-keyword">runtime</span>.notesleep<br>         <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%       <span class="hljs-number">20</span>ms   <span class="hljs-number">100</span>%  <span class="hljs-keyword">runtime</span>.park_m<br>         <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%       <span class="hljs-number">20</span>ms   <span class="hljs-number">100</span>%  <span class="hljs-keyword">runtime</span>.schedule<br>         <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%       <span class="hljs-number">10</span>ms <span class="hljs-number">50.00</span>%  <span class="hljs-keyword">runtime</span>.semasleep<br><br>fla<span class="hljs-variable">t:</span> å‡½æ•°è‡ªèº«è¿è¡Œè€—æ—¶<br>flat%: å‡½æ•°è‡ªèº«åœ¨CPUè¿è¡Œè€—æ—¶æ€»æ¯”ä¾‹<br>sum%: å‡½æ•°è‡ªèº«ç´¯è®¡ä½¿ç”¨CPUæ¯”ä¾‹<br>cum%: å‡½æ•°è‡ªèº«åŠå…¶è°ƒç”¨å‡½æ•°è¿è¡Œæ€»è€—æ—¶<br>cum%: å‡½æ•°è‡ªèº«åŠå…¶è°ƒç”¨å‡½æ•°çš„è¿è¡Œè€—æ—¶æ€»æ¯”ä¾‹<br>Name: å‡½æ•°å<br></code></pre></td></tr></table></figure></li>
<li><p>Heap Profiling</p>
<ul>
<li>inuse_space: åˆ†æå¸¸é©»å†…å­˜å ç”¨<figure class="highlight gradle"><table><tr><td class="code"><pre><code class="hljs gradle">âœ go tool pprof -inuse_space http:<span class="hljs-comment">//localhost:8080/debug/pprof/heap</span><br>Fetching profile over HTTP <span class="hljs-keyword">from</span> http:<span class="hljs-comment">//localhost:8080/debug/pprof/heap</span><br>Saved profile in <span class="hljs-regexp">/Users/</span>chyiyaqing<span class="hljs-regexp">/pprof/</span>pprof.alloc_objects.alloc_space.inuse_objects.inuse_space.<span class="hljs-number">002</span>.pb.gz<br>Type: inuse_space<br>Time: Sep <span class="hljs-number">13</span>, <span class="hljs-number">2021</span> at <span class="hljs-number">5</span>:<span class="hljs-number">30</span>pm (CST)<br>Entering interactive mode (type <span class="hljs-string">&quot;help&quot;</span> <span class="hljs-keyword">for</span> commands, <span class="hljs-string">&quot;o&quot;</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">options</span>)<br>(pprof) top<br>Showing nodes accounting <span class="hljs-keyword">for</span> <span class="hljs-number">6951.53</span>kB, <span class="hljs-number">100</span>% of <span class="hljs-number">6951.53</span>kB total<br>Showing top <span class="hljs-number">10</span> nodes out of <span class="hljs-number">18</span><br>      flat  flat%   sum%        cum   cum%<br> <span class="hljs-number">4898.20</span>kB <span class="hljs-number">70.46</span>% <span class="hljs-number">70.46</span>%  <span class="hljs-number">4898.20</span>kB <span class="hljs-number">70.46</span>%  main.Add (inline)<br> <span class="hljs-number">1025.12</span>kB <span class="hljs-number">14.75</span>% <span class="hljs-number">85.21</span>%  <span class="hljs-number">1025.12</span>kB <span class="hljs-number">14.75</span>%  <span class="hljs-keyword">runtime</span>.allocm<br>  <span class="hljs-number">516.01</span>kB  <span class="hljs-number">7.42</span>% <span class="hljs-number">92.63</span>%   <span class="hljs-number">516.01</span>kB  <span class="hljs-number">7.42</span>%  unicode.init<br>  <span class="hljs-number">512.20</span>kB  <span class="hljs-number">7.37</span>%   <span class="hljs-number">100</span>%   <span class="hljs-number">512.20</span>kB  <span class="hljs-number">7.37</span>%  <span class="hljs-keyword">runtime</span>.malg<br>         <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%  <span class="hljs-number">4898.20</span>kB <span class="hljs-number">70.46</span>%  main.main.func1<br>         <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%   <span class="hljs-number">516.01</span>kB  <span class="hljs-number">7.42</span>%  <span class="hljs-keyword">runtime</span>.doInit<br>         <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%   <span class="hljs-number">516.01</span>kB  <span class="hljs-number">7.42</span>%  <span class="hljs-keyword">runtime</span>.main<br>         <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%  <span class="hljs-number">1025.12</span>kB <span class="hljs-number">14.75</span>%  <span class="hljs-keyword">runtime</span>.mstart<br>         <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%  <span class="hljs-number">1025.12</span>kB <span class="hljs-number">14.75</span>%  <span class="hljs-keyword">runtime</span>.mstart0<br>         <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%  <span class="hljs-number">1025.12</span>kB <span class="hljs-number">14.75</span>%  <span class="hljs-keyword">runtime</span>.mstart1<br>(pprof) traces<br>Type: alloc_objects<br>Time: Sep <span class="hljs-number">13</span>, <span class="hljs-number">2021</span> at <span class="hljs-number">5</span>:<span class="hljs-number">57</span>pm (CST)<br>-----------+-------------------------------------------------------<br>     bytes:  <span class="hljs-number">256</span>kB<br>         <span class="hljs-number">2</span>   compress/flate.(*compressor).init<br>             compress/flate.<span class="hljs-keyword">NewWriter</span><br>             compress/gzip.(*Writer).<span class="hljs-keyword">Write</span><br>             <span class="hljs-keyword">runtime</span>/pprof.(*profileBuilder).build<br>             <span class="hljs-keyword">runtime</span>/pprof.printCountProfile<br>             <span class="hljs-keyword">runtime</span>/pprof.writeRuntimeProfile<br>             <span class="hljs-keyword">runtime</span>/pprof.writeGoroutine<br>             <span class="hljs-keyword">runtime</span>/pprof.(*Profile).WriteTo<br>             net<span class="hljs-regexp">/http/</span>pprof.handler.ServeHTTP<br>             net<span class="hljs-regexp">/http/</span>pprof.Index<br>             net/http.HandlerFunc.ServeHTTP<br>             net/http.(*ServeMux).ServeHTTP<br>             net/http.serverHandler.ServeHTTP<br>             net/http.(*conn).serve<br>-----------+-------------------------------------------------------<br></code></pre></td></tr></table></figure></li>
<li>alloc_space: åˆ†æåˆ†é…å†…å­˜ç©ºé—´å¤§å°</li>
<li>alloc_objects:</li>
<li>inuse_objects:</li>
</ul>
</li>
</ul>
<ul>
<li><p>Goroutine Profiling</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><code class="hljs stylus">âœ go tool pprof http:<span class="hljs-comment">//localhost:8080/debug/pprof/goroutine</span><br>Fetching profile over HTTP from http:<span class="hljs-comment">//localhost:8080/debug/pprof/goroutine</span><br>Saved profile <span class="hljs-keyword">in</span> /Users/chyiyaqing/pprof/pprof<span class="hljs-selector-class">.goroutine</span>.<span class="hljs-number">001</span><span class="hljs-selector-class">.pb</span><span class="hljs-selector-class">.gz</span><br>Type: goroutine<br>Time: Sep <span class="hljs-number">13</span>, <span class="hljs-number">2021</span> at <span class="hljs-number">5</span>:<span class="hljs-number">54</span>pm (CST)<br>Entering interactive mode (type <span class="hljs-string">&quot;help&quot;</span> <span class="hljs-keyword">for</span> commands, <span class="hljs-string">&quot;o&quot;</span> <span class="hljs-keyword">for</span> options)<br>(pprof) traces  <span class="hljs-comment">// æ‰“å°è°ƒç”¨æ ˆ</span><br>Type: goroutine<br>Time: Sep <span class="hljs-number">13</span>, <span class="hljs-number">2021</span> at <span class="hljs-number">5</span>:<span class="hljs-number">54</span>pm (CST)<br>-----------+-------------------------------------------------------<br>         <span class="hljs-number">1</span>   runtime<span class="hljs-selector-class">.gopark</span><br>             runtime<span class="hljs-selector-class">.netpollblock</span><br>             internal/poll<span class="hljs-selector-class">.runtime_pollWait</span><br>             internal/poll.(*pollDesc)<span class="hljs-selector-class">.wait</span><br>             internal/poll.(*pollDesc)<span class="hljs-selector-class">.waitRead</span> (inline)<br>             internal/poll.(*FD)<span class="hljs-selector-class">.Read</span><br>             net.(*netFD)<span class="hljs-selector-class">.Read</span><br>             net.(*conn)<span class="hljs-selector-class">.Read</span><br>             net/http.(*connReader)<span class="hljs-selector-class">.backgroundRead</span><br>-----------+-------------------------------------------------------<br>         <span class="hljs-number">1</span>   runtime<span class="hljs-selector-class">.gopark</span><br>             runtime<span class="hljs-selector-class">.netpollblock</span><br>             internal/poll<span class="hljs-selector-class">.runtime_pollWait</span><br>             internal/poll.(*pollDesc)<span class="hljs-selector-class">.wait</span><br>             internal/poll.(*pollDesc)<span class="hljs-selector-class">.waitRead</span> (inline)<br>             internal/poll.(*FD)<span class="hljs-selector-class">.Accept</span><br>             net.(*netFD)<span class="hljs-selector-class">.accept</span><br>             net.(*TCPListener)<span class="hljs-selector-class">.accept</span><br>             net.(*TCPListener)<span class="hljs-selector-class">.Accept</span><br>             net/http.(*Server)<span class="hljs-selector-class">.Serve</span><br>             net/http.(*Server)<span class="hljs-selector-class">.ListenAndServe</span><br>             net/http<span class="hljs-selector-class">.ListenAndServe</span> (inline)<br>             <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.main</span><br>             runtime<span class="hljs-selector-class">.main</span><br>-----------+-------------------------------------------------------<br>         <span class="hljs-number">1</span>   runtime<span class="hljs-selector-class">.gopark</span><br>             <span class="hljs-selector-tag">time</span><span class="hljs-selector-class">.Sleep</span><br>             <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.main</span><span class="hljs-selector-class">.func1</span><br>-----------+-------------------------------------------------------<br>         <span class="hljs-number">1</span>   runtime/pprof<span class="hljs-selector-class">.runtime_goroutineProfileWithLabels</span><br>             runtime/pprof<span class="hljs-selector-class">.writeRuntimeProfile</span><br>             runtime/pprof<span class="hljs-selector-class">.writeGoroutine</span><br>             runtime/pprof.(*Profile)<span class="hljs-selector-class">.WriteTo</span><br>             net/http/pprof<span class="hljs-selector-class">.handler</span><span class="hljs-selector-class">.ServeHTTP</span><br>             net/http/pprof<span class="hljs-selector-class">.Index</span><br>             net/http<span class="hljs-selector-class">.HandlerFunc</span><span class="hljs-selector-class">.ServeHTTP</span><br>             net/http.(*ServeMux)<span class="hljs-selector-class">.ServeHTTP</span><br>             net/http<span class="hljs-selector-class">.serverHandler</span><span class="hljs-selector-class">.ServeHTTP</span><br>             net/http.(*conn)<span class="hljs-selector-class">.serve</span><br>-----------+-------------------------------------------------------<br></code></pre></td></tr></table></figure></li>
<li><p>Mutex Profiling</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk">âœ go tool pprof http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8080</span><span class="hljs-regexp">/debug/</span>pprof/mutex<br>Fetching profile over HTTP from http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8080</span><span class="hljs-regexp">/debug/</span>pprof/mutex<br>Saved profile <span class="hljs-keyword">in</span> <span class="hljs-regexp">/Users/</span>chyiyaqing<span class="hljs-regexp">/pprof/</span>pprof.contentions.delay.<span class="hljs-number">003</span>.pb.gz<br>Type: delay<br>Time: Sep <span class="hljs-number">13</span>, <span class="hljs-number">2021</span> at <span class="hljs-number">6</span>:<span class="hljs-number">05</span>pm (CST)<br>Entering interactive mode (type <span class="hljs-string">&quot;help&quot;</span> <span class="hljs-keyword">for</span> commands, <span class="hljs-string">&quot;o&quot;</span> <span class="hljs-keyword">for</span> options)<br>(pprof) top<br>Showing nodes accounting <span class="hljs-keyword">for</span> <span class="hljs-number">941.98</span>us, <span class="hljs-number">100</span>% of <span class="hljs-number">941.98</span>us total<br>      flat  flat%   sum%        cum   cum%<br>  <span class="hljs-number">941.98</span>us   <span class="hljs-number">100</span>%   <span class="hljs-number">100</span>%   <span class="hljs-number">941.98</span>us   <span class="hljs-number">100</span>%  sync.(*Mutex).Unlock<br>         <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%   <span class="hljs-number">941.98</span>us   <span class="hljs-number">100</span>%  main.main.func1<br>(pprof) list main<br>Total: <span class="hljs-number">941.98</span>us<br>ROUTINE ======================== main.main.func1 <span class="hljs-keyword">in</span> <span class="hljs-regexp">/Users/</span>chyiyaqing<span class="hljs-regexp">/Downloads/</span>pprof<span class="hljs-regexp">/pprof/m</span>ain2.go<br>         <span class="hljs-number">0</span>   <span class="hljs-number">941.98</span>us (flat, cum)   <span class="hljs-number">100</span>% of Total<br>         .          .     <span class="hljs-number">18</span>:	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">999</span>; i++ &#123;<br>         .          .     <span class="hljs-number">19</span>:		go <span class="hljs-keyword">func</span>(i int) &#123;<br>         .          .     <span class="hljs-number">20</span>:			m.Lock()<br>         .          .     <span class="hljs-number">21</span>:			defer m.Unlock()<br>         .          .     <span class="hljs-number">22</span>:			datas[i] = struct&#123;&#125;&#123;&#125;<br>         .   <span class="hljs-number">941.98</span>us     <span class="hljs-number">23</span>:		&#125;(i)<br>         .          .     <span class="hljs-number">24</span>:	&#125;<br>         .          .     <span class="hljs-number">25</span>:<br>         .          .     <span class="hljs-number">26</span>:	_ = http.ListenAndServe(<span class="hljs-string">&quot;:8080&quot;</span>, nil)<br>         .          .     <span class="hljs-number">27</span>:&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>Block Profiling</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk">âœ go tool pprof http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8080</span><span class="hljs-regexp">/debug/</span>pprof/block<br>Fetching profile over HTTP from http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8080</span><span class="hljs-regexp">/debug/</span>pprof/block<br>Saved profile <span class="hljs-keyword">in</span> <span class="hljs-regexp">/Users/</span>chyiyaqing<span class="hljs-regexp">/pprof/</span>pprof.contentions.delay.<span class="hljs-number">005</span>.pb.gz<br>Type: delay<br>Time: Sep <span class="hljs-number">13</span>, <span class="hljs-number">2021</span> at <span class="hljs-number">6</span>:<span class="hljs-number">17</span>pm (CST)<br>Entering interactive mode (type <span class="hljs-string">&quot;help&quot;</span> <span class="hljs-keyword">for</span> commands, <span class="hljs-string">&quot;o&quot;</span> <span class="hljs-keyword">for</span> options)<br>(pprof) top<br>Showing nodes accounting <span class="hljs-keyword">for</span> <span class="hljs-number">92.66</span>ms, <span class="hljs-number">100</span>% of <span class="hljs-number">92.67</span>ms total<br>Dropped <span class="hljs-number">4</span> nodes (cum &lt;= <span class="hljs-number">0.46</span>ms)<br>      flat  flat%   sum%        cum   cum%<br>   <span class="hljs-number">92.66</span>ms   <span class="hljs-number">100</span>%   <span class="hljs-number">100</span>%    <span class="hljs-number">92.66</span>ms   <span class="hljs-number">100</span>%  sync.(*Mutex).Lock (inline)<br>         <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%    <span class="hljs-number">92.66</span>ms   <span class="hljs-number">100</span>%  main.main.func1<br>(pprof) list<br>command list requires an argument<br>(pprof) list main<br>Total: <span class="hljs-number">92.67</span>ms<br>ROUTINE ======================== main.main.func1 <span class="hljs-keyword">in</span> <span class="hljs-regexp">/Users/</span>chyiyaqing<span class="hljs-regexp">/Downloads/</span>pprof<span class="hljs-regexp">/pprof/m</span>ain2.go<br>         <span class="hljs-number">0</span>    <span class="hljs-number">92.66</span>ms (flat, cum)   <span class="hljs-number">100</span>% of Total<br>         .          .     <span class="hljs-number">17</span>:<span class="hljs-keyword">func</span> main() &#123;<br>         .          .     <span class="hljs-number">18</span>:	var m sync.Mutex<br>         .          .     <span class="hljs-number">19</span>:	var datas = make(map[int]struct&#123;&#125;)<br>         .          .     <span class="hljs-number">20</span>:	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">999</span>; i++ &#123;<br>         .          .     <span class="hljs-number">21</span>:		go <span class="hljs-keyword">func</span>(i int) &#123;<br>         .    <span class="hljs-number">92.66</span>ms     <span class="hljs-number">22</span>:			m.Lock()<br>         .          .     <span class="hljs-number">23</span>:			defer m.Unlock()<br>         .          .     <span class="hljs-number">24</span>:			datas[i] = struct&#123;&#125;&#123;&#125;<br>         .          .     <span class="hljs-number">25</span>:		&#125;(i)<br>         .          .     <span class="hljs-number">26</span>:	&#125;<br>         .          .     <span class="hljs-number">27</span>:<br></code></pre></td></tr></table></figure></li>
<li><p>æŸ¥çœ‹å¯è§†åŒ–ç•Œé¢</p>
<figure class="highlight pf"><table><tr><td class="code"><pre><code class="hljs pf">âœ wget http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8080</span>/<span class="hljs-keyword">debug</span>/pprof/<span class="hljs-keyword">profile</span><br>--<span class="hljs-number">2021</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">18</span>:<span class="hljs-number">25</span>:<span class="hljs-number">42</span>--  http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8080</span>/<span class="hljs-keyword">debug</span>/pprof/<span class="hljs-keyword">profile</span><br>Connecting <span class="hljs-keyword">to</span> <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8080</span>... connected.<br>HTTP request sent, awaiting response... <span class="hljs-number">200</span> OK<br>Length: <span class="hljs-number">1290</span> (<span class="hljs-number">1.3</span>K) [application/octet-stream]<br>Saving <span class="hljs-keyword">to</span>: â€˜<span class="hljs-keyword">profile</span>â€™<br><br><span class="hljs-keyword">profile</span>                            <span class="hljs-number">100</span>%[================================================================&gt;]   <span class="hljs-number">1.26</span>K  --.-KB/s    <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>s<br><br><span class="hljs-number">2021</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span> <span class="hljs-number">18</span>:<span class="hljs-number">26</span>:<span class="hljs-number">12</span> (<span class="hljs-number">205</span> MB/s) - â€˜<span class="hljs-keyword">profile</span>â€™ saved [<span class="hljs-number">1290</span>/<span class="hljs-number">1290</span>]<br><br><span class="hljs-comment"># æ–¹æ³•ä¸€</span><br>âœ go tool pprof -http=:<span class="hljs-number">6001</span> <span class="hljs-keyword">profile</span><br>Serving web UI <span class="hljs-keyword">on</span> http://localhost:<span class="hljs-number">6001</span><br>  <span class="hljs-comment"># Top</span><br>  <span class="hljs-comment"># Graph: å‡½æ•°è°ƒç”¨æµç¨‹</span><br>  <span class="hljs-comment"># Peek: ä¸Šä¸‹æ–‡ä¿¡æ¯</span><br>  <span class="hljs-comment"># Source: æºä»£ç çš„è¿½è¸ªå’Œåˆ†æ</span><br>  <span class="hljs-comment"># Flame Graph:</span><br><br><span class="hljs-comment"># æ–¹æ³•äºŒ</span><br>âœ go tool pprof <span class="hljs-keyword">profile</span><br>Type: cpu<br>Time: Sep <span class="hljs-number">13</span>, <span class="hljs-number">2021</span> at <span class="hljs-number">6</span>:<span class="hljs-number">25</span>pm (CST)<br>Duration: <span class="hljs-number">30</span>s, Total samples = <span class="hljs-number">240</span>ms (  <span class="hljs-number">0.8</span>%)<br>Entering interactive mode (type <span class="hljs-string">&quot;help&quot;</span> <span class="hljs-keyword">for</span> commands, <span class="hljs-string">&quot;o&quot;</span> <span class="hljs-keyword">for</span> options)<br>(pprof) web<br></code></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>Programming Language</category>
      </categories>
  </entry>
  <entry>
    <title>Huawei LiteOS Intro</title>
    <url>/2021/09/14/Huawei-LiteOS-Intro/</url>
    <content><![CDATA[<h1 id="Huawei-LiteOS"><a href="#Huawei-LiteOS" class="headerlink" title="Huawei LiteOS"></a>Huawei LiteOS</h1><blockquote>
<p>é¢å‘IOTé¢†åŸŸï¼Œæ„å»ºè½»é‡çº§ç‰©è”ç½‘æ“ä½œç³»ç»Ÿ, ç›®å‰æ”¯æŒARM64,ARM Contex-A, ARM Cortex-M0, Cortex-M3, Cortex-M4, Cortex-M7</p>
</blockquote>
<ul>
<li>ä¼˜åŠ¿:<ul>
<li>é«˜å®æ—¶æ€§,é«˜ç¨³å®šæ€§</li>
<li>è¶…å°å†…æ ¸ï¼ŒåŸºç¡€å†…æ ¸ä½“ç§¯å¯ä»¥è£å‰ªè‡³ä¸åˆ°10K</li>
<li>ä½åŠŸè€—</li>
<li>æ”¯æŒåŠŸèƒ½é™æ€è£å‰ª</li>
</ul>
</li>
</ul>
<span id="more"></span>

<h2 id="æ¶æ„æ¡†å›¾"><a href="#æ¶æ„æ¡†å›¾" class="headerlink" title="æ¶æ„æ¡†å›¾"></a>æ¶æ„æ¡†å›¾</h2><p><img src="/misc/images/huawei-liteos-architecture.png" alt="Artecture"></p>
<ul>
<li>åŸºç¡€å†…æ ¸:<ul>
<li>æå°å†…æ ¸<ul>
<li>ä»»åŠ¡ç®¡ç†</li>
<li>å†…å­˜ç®¡ç†</li>
<li>ä¸­æ–­ç®¡ç†</li>
<li>å¼‚å¸¸ç®¡ç†</li>
<li>ç³»ç»Ÿæ—¶é’Ÿ</li>
</ul>
</li>
<li>å¯è£å‰ªå…¶ä»–æ¨¡å—<ul>
<li>ä¿¡å·é‡</li>
<li>äº’æ–¥é”</li>
<li>é˜Ÿåˆ—ç®¡ç†</li>
<li>äº‹ä»¶ç®¡ç†</li>
<li>è½¯ä»¶å®šæ—¶å™¨</li>
</ul>
</li>
</ul>
</li>
<li>å†…æ ¸å¢å¼º<ul>
<li>C++ æ”¯æŒ</li>
<li>è°ƒæµ‹ç»„ä»¶</li>
<li>shellå‘½ä»¤</li>
<li>Traceäº‹ä»¶è·Ÿè¸ª</li>
<li>CPUå ç”¨ç‡</li>
<li>LMS</li>
</ul>
</li>
<li>æ–‡ä»¶ç³»ç»Ÿ<ul>
<li>vfs</li>
<li>ramfs</li>
<li>fatfs</li>
</ul>
</li>
<li>ç³»ç»Ÿåº“æ¥å£<ul>
<li>libc</li>
<li>libm</li>
<li>posix</li>
<li>cmsis</li>
</ul>
</li>
<li>ç½‘ç»œåè®®æ ˆ<ul>
<li>CoAP</li>
<li>LwM2M</li>
<li>MQTT</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>OS</category>
      </categories>
  </entry>
  <entry>
    <title>Blockchain Intro</title>
    <url>/2021/09/17/Blockchain-Intro/</url>
    <content><![CDATA[<h1 id="Blockchain"><a href="#Blockchain" class="headerlink" title="Blockchain"></a>Blockchain</h1><blockquote>
<p>åŒºå—é“¾æŠ€æœ¯èŒèŠ½äºæ¯”ç‰¹å¸ï¼Œè¯ç”Ÿåœ¨ä»¥å¤ªåŠ, åŒºå—é“¾æ˜¯ä»·å€¼çš„è½½ä½“ï¼Œæ˜¯ä¸€ç§æ–°å‹çš„ç¤¾ä¼šç”Ÿäº§å…³ç³»ã€‚åŸºäºåŒºå—é“¾æŠ€æœ¯ï¼Œæ‰“é€šç°å®ä¸–ç•Œä¸ç½‘ç»œä¸–ç•Œçš„å±éšœï¼Œå°†ç‰©è´¨è™šæ‹ŸåŒ–ï¼Œå°†ä»·å€¼å®ä½“åŒ–.</p>
</blockquote>
<span id="more"></span>

<ul>
<li>æ•°å­—è´§å¸<ul>
<li>BTC:<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript"><span class="hljs-number">2008</span>å¹´,é‡‘èå±æœºèƒŒæ™¯ä¸‹ï¼Œä¸­æœ¬èªçœ‹åˆ°ç°ä»£é‡‘èä½“ç³»çš„ä¸è¶³ï¼Œåˆ›å»ºåŸºäºå¯†ç å­¦è€Œéä¿¡ä»»å…³ç³»çš„æ•°å­—è´§å¸ç³»ç»Ÿ -- æ¯”ç‰¹å¸</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">åœ¨æ¯”ç‰¹å¸ä¸­ï¼ŒçŸ¿å·¥é€šè¿‡è®¡ç®—æ»¡è¶³æ¡ä»¶çš„åŒºå—è·å¾—æŒ–çŸ¿å¥–åŠ±ï¼Œä¸”å¤§æ¦‚æ¯å››å¹´å‡åŠï¼Œæ¯”ç‰¹å¸çš„è´§å¸ä¾›åº”éšç€æ—¶é—´é€æ¸å‡å°‘ï¼Œæ˜¯ä¸€ç§é€šç¼©å‹æ•°å­—è´§å¸.</span><br></code></pre></td></tr></table></figure></li>
<li>Etherenum:<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">Vç¥åœ¨æ¯”ç‰¹å¸çš„åŸºç¡€ä¸Šï¼Œå°†æ™ºèƒ½åˆçº¦äºåŒºå—é“¾ç»“åˆ,åˆ›ç«‹å»ä¸­å¿ƒåŒ–åº”ç”¨å¹³å° -- ä»¥å¤ªåŠ</span><br></code></pre></td></tr></table></figure>
<ul>
<li>ç¡¬åˆ†å‰åˆ†è£‚:<ul>
<li>ETH:</li>
<li>ETC:</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>è½¯åˆ†å‰: å¯å…¼å®¹çš„ç¨‹åºç‰ˆæœ¬æ›´æ–°</li>
<li>ç¡¬åˆ†å‰: ä¸å¯å…¼å®¹çš„ç¨‹åºç‰ˆæœ¬æ›´æ–°</li>
<li>å…¬é“¾åœˆ: ä¸“æ³¨äºæœ‰å¸çš„å…±æœ‰å¼€æ”¾åŒºå—é“¾ç½‘ç»œ<figure class="highlight haml"><table><tr><td class="code"><pre><code class="hljs haml"># åº”ç”¨å±‚é¢:<br>  -<span class="ruby"> å»ä¸­å¿ƒåŒ–é‡‘è: Decentralised Finance</span><br><span class="ruby"></span>    -<span class="ruby"> é‡‘è: é€šè¿‡é‡æ–°åˆ†é…èµ„äº§æ¥è·å¾—èµ„äº§å¢å€¼çš„ä¸€ç§æ¸ é“ï¼Œæœ¬è´¨åœ¨äºä¿¡ç”¨ã€é£é™©å’Œæ æ†ï¼Œé‡‘èæˆç«‹çš„å‰æå°±æ˜¯æ§åˆ¶ä¸ç¡®å®šæ€§é£é™©ã€‚</span><br><span class="ruby"></span>  -<span class="ruby"> å»ä¸­å¿ƒåŒ–å­˜å‚¨:</span><br><span class="ruby"></span>    &gt; ä¸€ç§åˆ©ç”¨åˆ†å¸ƒå¼å­˜å‚¨æŠ€æœ¯ï¼Œå°†æ–‡ä»¶åˆ†å—å­˜å‚¨åœ¨ä¸åŒå­˜å‚¨èŠ‚ç‚¹çš„åº”ç”¨å‹åˆ›æ–°. ç›¸è¾ƒäºä¸­å¿ƒåŒ–å­˜å‚¨ï¼Œæ‹¥æœ‰æ›´é«˜çº§åˆ«çš„éšç§ä¿æŠ¤ï¼Œå­˜å‚¨æˆæœ¬æ›´ä½ï¼Œä¸”å…·å¤‡æ›´å†—ä½™çš„æ•°æ®å¤‡ä»½å‰¯æœ¬ï¼Œèƒ½æœ‰æ•ˆé¿å…å•ç‚¹æ•…éšœ<br>    -<span class="ruby"> é¢ä¸´çš„é—®é¢˜:</span><br><span class="ruby"></span>      -<span class="ruby"> <span class="hljs-number">1</span>. å¸ä»·æ³¢åŠ¨å¯¼è‡´æˆæœ¬ä¸ç¡®å®šæ€§</span><br><span class="ruby"></span>      -<span class="ruby"> <span class="hljs-number">2</span>. å—åˆ¶äºç½‘ç»œç¯å¢ƒä»¥åŠç¡¬ç›˜æœ¬èº«ï¼Œæ•´ä¸ªå»ä¸­å¿ƒåŒ–ç½‘ç»œå­˜å‚¨æ€§èƒ½ä¸é«˜ï¼Œè¿œä¸å¦‚ä¸­å¿ƒåŒ–å­˜å‚¨ï¼Œåªé€‚ç”¨å†·æ•°æ®ä»¥åŠä¸ªäººæ•°æ®å­˜å‚¨.</span><br><span class="ruby"></span># æŠ€æœ¯åˆ›æ–°å±‚é¢:<br>  &gt; è·¨é“¾: ä¸åŒåŒºå—é“¾ç½‘ç»œæ˜¯ç‹¬ç«‹ï¼Œæ˜¯ä¸€ä¸ªä¸ªæ•°æ®å­¤å²›ï¼Œè·¨é“¾æŠ€æœ¯æ˜¯åœ¨è¿™äº›å²›ä¹‹é—´æ„å»ºäº’é€šçš„æ¡¥æ¢,æä¾›ä¸åŒé“¾ä¹‹é—´æ•°æ®äº’é€šçš„å¯èƒ½æ€§.<br></code></pre></td></tr></table></figure></li>
<li>è”ç›Ÿé“¾åœˆ: ä¸“æ³¨äºåŒºå—é“¾æŠ€æœ¯åœ¨ä¼ä¸šé¢†åŸŸçš„ç ”ç©¶<figure class="highlight vala"><table><tr><td class="code"><pre><code class="hljs vala"><span class="hljs-meta"># æ•°æ®å­˜è¯:</span><br>  &gt; åŒºå—é“¾æŠ€æœ¯å…·æœ‰æ—¶é—´è¿ç»­ï¼Œä¸å¯ç¯¡æ”¹ï¼Œå¯å›æº¯ç­‰ç‰¹æ€§ï¼Œéå¸¸é€‚åˆç•™å­˜è¯æ®çš„æ•°æ®å­˜å‚¨ã€‚å¤§å¤šæ•°åº”ç”¨åœ¨åŒºå—é“¾ä¸Šå­˜å‚¨åªæ˜¯æ•°æ®è¯æ˜ï¼Œè€ŒéåŸå§‹æ•°æ®ã€‚<br><br><span class="hljs-meta"># æ•°æ®äº¤æ¢:</span><br>  &gt; é€šè¿‡åŒºå—é“¾æŠ€æœ¯è§£å†³å¤šæ–¹æ•°æ®äº¤äº’éœ€æ±‚ï¼Œå„æ–¹éƒ¨ç½²åŒºå—é“¾èŠ‚ç‚¹ï¼Œåªéœ€ä¸è‡ªèº«èŠ‚ç‚¹äº¤äº’ï¼ŒåŒºå—é“¾æœºåˆ¶è‡ªåŠ¨å°†æ•°æ®åŒæ­¥è‡³å…¶ä»–å‚ä¸æ–¹ï¼Œä»»ä¸€èŠ‚ç‚¹æ•°æ®æ›´æ–°ï¼ŒåŒºå—é“¾é€šçŸ¥æœºåˆ¶è‡ªåŠ¨é€šçŸ¥å„æ”¾<br><br><span class="hljs-meta"># ä»·å€¼è½¬ç§»:</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="BTC-æ¯”ç‰¹å¸ç™½çš®ä¹¦-â€“-é˜…è¯»"><a href="#BTC-æ¯”ç‰¹å¸ç™½çš®ä¹¦-â€“-é˜…è¯»" class="headerlink" title="BTC æ¯”ç‰¹å¸ç™½çš®ä¹¦ â€“ é˜…è¯»"></a>BTC æ¯”ç‰¹å¸ç™½çš®ä¹¦ â€“ é˜…è¯»</h2><blockquote>
<p>ä¸€ç§P2Pç”µå­è´§å¸ç³»ç»Ÿï¼ŒåŸºäºå¯†ç å­¦åŸç†è€Œä¸æ˜¯ä¿¡ä»»çš„ç”µå­æ”¯ä»˜ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿå…è®¸ä»»ä½•æœ‰äº¤æ˜“æ„æ„¿çš„åŒæ–¹èƒ½ç›´æ¥äº¤æ˜“è€Œä¸éœ€è¦ä¸€ä¸ªå¯ä¿¡ä»»ç¬¬ä¸‰æ–¹ã€‚åªè¦è¯šå®èŠ‚ç‚¹é›†ä½“æ§åˆ¶çš„CPUç®—åŠ›å¤§äºæ¯ä¸€ä¸ªåˆä½œæ”»å‡»èŠ‚ç‚¹ç¾¤çš„CPUç®—åŠ›ï¼Œè¿™ä¸ªç³»ç»Ÿå°±æ˜¯å®‰å…¨çš„ã€‚</p>
</blockquote>
<p><a href="https://bitcoin.org/zh_CN/bitcoin-paper">BTCç™½çš®ä¹¦</a></p>
<ul>
<li>äº¤æ˜“</li>
<li>äº‹ä»¶æˆ³æœåŠ¡å™¨</li>
<li>å·¥ä½œé‡è¯æ˜</li>
<li>ç½‘ç»œ</li>
<li>æ¿€åŠ±</li>
<li>å›æ”¶ç£ç›˜ç©ºé—´</li>
<li>åˆå¹¶å’Œåˆ†å‰²äº¤æ˜“é¢</li>
<li>éšç§</li>
<li>è®¡ç®—</li>
</ul>
<h2 id="æŠ€æœ¯åŸç†"><a href="#æŠ€æœ¯åŸç†" class="headerlink" title="æŠ€æœ¯åŸç†"></a>æŠ€æœ¯åŸç†</h2><ul>
<li><p>åŒºå—é“¾ç‰¹å¾:</p>
<ul>
<li>å»ä¸­å¿ƒåŒ–<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">åŒºå—é“¾å­˜åœ¨çš„åˆè¡·å°±æ˜¯å»é™¤ä¸­å¿ƒåŒ–çš„ç¬¬ä¸‰æ–¹æœºæ„ï¼Œæ•´ä¸ªç½‘ç»œçš„æ•°æ®ä»¥åŠçŠ¶æ€æ˜¯ç”±ç½‘ç»œä¸­æ‰€æœ‰çš„èŠ‚ç‚¹å…±åŒç»´æŠ¤ï¼Œä»»ä¸€èŠ‚ç‚¹ç¦»çº¿ä¸ä¼šå½±å“ç³»ç»Ÿçš„è¿ä½œ.</span><br><br><span class="hljs-meta">&gt;</span> <span class="javascript">èŠ‚ç‚¹äº’ä¸ºå½¼æ­¤çš„æ•°æ®ç”Ÿäº§è€…åŠæ¶ˆè´¹è€…</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">ç°é˜¶æ®µåŒºå—é“¾å»ä¸­å¿ƒåŒ–æœ¬è´¨æ˜¯ç›¸å¯¹å»ä¸­å¿ƒåŒ–(å¤šä¸­å¿ƒåŒ–)</span><br></code></pre></td></tr></table></figure></li>
<li>å¯è¿½æº¯æ€§<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">åŒºå—é“¾è¢«è®¤ä¸ºæ˜¯æ—¶åºæ•°æ®åº“,å¯¹èŠ‚ç‚¹æ•°æ®åº“å­˜å‚¨å“åº”çš„æ•°æ®ä»¥åŠæ—¥å¿—ï¼Œä¸”æ¯ä»½æ•°æ®æ˜¯æŒ‰ç…§é¡ºåºå‰åå…³è”åœ¨ä¸€èµ·ï¼Œæ–°çš„æ•°æ®ä¸€å®šä»æŸä¸€ç»„ä¹‹å‰å·²å­˜åœ¨çš„æ•°æ®æ´¾ç”Ÿè€Œæ¥</span><br></code></pre></td></tr></table></figure></li>
<li>ä¸å¯ç¯¡æ”¹<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># å¯†ç å­¦</span><br><span class="hljs-bullet">  -</span> å“ˆå¸Œç®—æ³•: ä»»æ„æ•°æ®è½¬æ¢ä¸ºå›ºå®šé•¿åº¦çš„æ•°æ®æŒ‡çº¹, å½¢æˆä¸€æ¡ç”±æ•°æ®æŒ‡çº¹ä¸²è”çš„ä¿¡æ¯é“¾æ¡<br><span class="hljs-section"># å…±è¯†ç®—æ³•</span><br><span class="hljs-bullet">  -</span> å¤§å¤šæ•°å…±è¯†ç®—æ³•éµå¾ªå°‘æ•°æœä»å¤šæ•°çš„åŸåˆ™<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>å­˜å‚¨:<br><img src="/misc/images/blockchain_store.jpg" alt="åŒºå—é“¾å­˜å‚¨"></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># å­˜å‚¨å†—ä½™</span><br><span class="hljs-bullet">  -</span> æ¯”ç‰¹å¸ç½‘ç»œç´¯è®¡è¶…è¿‡350Gçš„å†å²æ•°æ®, ä»¥å¤ªåŠä½†èŠ‚ç‚¹è¶…è¿‡8700Gçš„å†å²æ•°æ®<br><span class="hljs-bullet">  -</span> æ•°æ®å½’æ¡£: çš„æœ¬è´¨æ˜¯åœ¨ä¿æŒä¸å¯ç¯¡æ”¹çš„å‰æä¸‹ç‰ºç‰²éƒ¨åˆ†å¯è¿½æº¯æ€§<br><span class="hljs-bullet">  -</span> èŠ‚ç‚¹è§’è‰²:<br><span class="hljs-bullet">    -</span> Bitcoin Core å…¨èŠ‚ç‚¹: è·¯ç”±ã€é“¾å­˜å‚¨ã€æŒ–çŸ¿ã€é’±åŒ…<br><span class="hljs-bullet">    -</span> æ™®é€šå…¨èŠ‚ç‚¹: è·¯ç”±ã€é“¾å­˜å‚¨<br><span class="hljs-bullet">    -</span> SPVé’±åŒ…èŠ‚ç‚¹: è·¯ç”±ã€é’±åŒ…<br><span class="hljs-bullet">    -</span> æŒ–çŸ¿èŠ‚ç‚¹: è·¯ç”±ã€é“¾å­˜å‚¨ã€æŒ–çŸ¿<br><br><span class="hljs-section"># Transaction: äº¤æ˜“</span><br>  &gt; äº¤æ˜“æ˜¯åŒºå—é“¾ç½‘ç»œä¸­æ•°æ®çš„æœ€å°ç»„æˆéƒ¨åˆ†, äº¤æ˜“æäº¤ååªèƒ½æœ‰ä¸¤ç§çŠ¶æ€(æˆåŠŸ/å¤±è´¥)<br>  &gt; åŒºå—é“¾ä¸­æ‰€æœ‰çš„äº¤æ˜“åŸºæœ¬éƒ½æ˜¯ä»åŒºå—é“¾å¤–éƒ¨å‘èµ·ï¼ŒåŒºå—é“¾ç½‘ç»œåªæ¥æ”¶äº¤æ˜“è€Œä¸ç”Ÿäº§äº¤æ˜“, ä¸”ä¸å¯¹äº¤æ˜“åšä»»ä½•æ”¹åŠ¨ã€‚<br><span class="hljs-bullet">  -</span> äº¤æ˜“å±æ€§:<br><span class="hljs-bullet">    -</span> From: äº¤æ˜“çš„å‘èµ·æ–¹<br><span class="hljs-bullet">    -</span> To: äº¤æ˜“çš„æ¥æ”¶æ–¹<br><span class="hljs-bullet">    -</span> æ™ºèƒ½åˆçº¦: æ‰§è¡Œæ™ºèƒ½åˆçº¦çš„åç§°<br><span class="hljs-bullet">    -</span> æ–¹æ³•åç§°<br><span class="hljs-bullet">    -</span> å‚æ•°åˆ—è¡¨<br><span class="hljs-bullet">    -</span> ç­¾å: ç§é’¥å¯¹äº¤æ˜“è¿›è¡Œç­¾å<br><span class="hljs-bullet">    -</span> æ—¶é—´æˆ³: äº¤æ˜“åœ¨å®¢æˆ·ç«¯æ„å»ºçš„æ—¶é—´<br><span class="hljs-section"># åŒºå—</span><br>  &gt; åŒºå—é“¾æ˜¯æ—¶é—´æ®µçš„æ•°æ®å‰åå…³è”ä¾æ¬¡ä¸²è”æ•´åˆæˆçš„ä¿¡æ¯é“¾æ¡ï¼Œè€Œæ¯ä¸€ä¸ªæ—¶é—´æ®µçš„æ•°æ®ç§°ä¸ºåŒºå—Block<br>  &gt; åŒºå—æ˜¯æŒ‡å°†èŠ‚ç‚¹ä¸€æ®µæ—¶é—´å†…æ”¶åˆ°çš„æ‰€æœ‰(æœ‰æ•ˆ)äº¤æ˜“æ‰“åŒ…è€Œå½¢æˆçš„ä¸€ç§æ•°æ®ç»“æ„.<br><span class="hljs-bullet">  -</span> åŒºå—ç»“æ„:<br><span class="hljs-bullet">    -</span> åŒºå—å¤´:<br><span class="hljs-bullet">      -</span> å‰ç½®åŒºå—å“ˆå¸Œ: åŒºå—é—´çš„å…³è”<br><span class="hljs-bullet">      -</span> äº¤æ˜“æ ¹å“ˆå¸Œ: åŒºå—ä¸äº¤æ˜“çš„å…³è”<br><span class="hljs-bullet">      -</span> åŒºå—é«˜åº¦: å½“å‰åŒºå—åœ¨åŒºå—é“¾ä¸­çš„ä½ç½®<br><span class="hljs-bullet">      -</span> æ—¶é—´æˆ³: åŒºå—æ‰“åŒ…çš„æ—¶é—´<br><span class="hljs-bullet">    -</span> åŒºå—ä½“: ä¿å­˜äº¤æ˜“å¹¶æŒ‰ç…§äº¤æ˜“æ—¶é—´æ’åº<br><span class="hljs-bullet">  -</span> åŒºå—é—´å…³è”:<br><span class="hljs-bullet">    -</span> æ¯ä¸ªåŒºå—éƒ½ä¼šåŒ…å«å‰ç½®åŒºå—å“ˆå¸Œä½œä¸ºé€»è¾‘å…³è”ä¸¤ä¸ªåŒºå—çš„é”šç‚¹<br><br><span class="hljs-section"># è«å…‹å°”æ ‘:</span><br>  &gt; æ ‘çŠ¶ç»“æ„ï¼Œè‡³å°‘ä¸‰å±‚ï¼Œåˆ†åˆ«æ˜¯å¶å­ç»“ç‚¹, ä¸­é—´èŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹<br><span class="hljs-bullet">  -</span> æ„å»ºé€»è¾‘:<br><span class="hljs-code">    &gt; ç›¸é‚»å¶å­ç»“ç‚¹è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œå¾—åˆ°å“ˆå¸Œå€¼ä½œä¸ºä¸¤ä¸ªå¶å­èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œè¿™æ ·ç”±å“ˆå¸Œå€¼æ„æˆçš„è«å…‹å°”æ ‘</span><br><span class="hljs-code"></span><br><span class="hljs-section"># StateçŠ¶æ€</span><br><span class="hljs-bullet">  -</span> æœ‰é™çŠ¶æ€æœº:<br><span class="hljs-code">    &gt; åœ¨ä¸€ä¸ªå°é—­çš„ç³»ç»Ÿä¸­ï¼Œå¦‚æœçŠ¶æ€èµ·å§‹æ¡ä»¶ä¸€è‡´ï¼ŒçŠ¶æ€æ”¹å˜æ¡ä»¶é¡ºåºä¸€è‡´ï¼Œæœ€ç»ˆä¸€å®šä¼šå¾—åˆ°ä¸€è‡´çš„ç»“æœ</span><br><span class="hljs-code">    &gt; åŒºå—é“¾ä¹Ÿæ˜¯ä¸€ç§æœ‰é™çŠ¶æ€æœº</span><br><span class="hljs-code"></span><br><span class="hljs-bullet">  -</span> çŠ¶æ€æ¨¡å‹:<br><span class="hljs-bullet">    -</span> UTXO(Unspent Trasaction Outputs - æœªèŠ±è´¹çš„äº¤æ˜“è¾“å‡º)æ¨¡å‹:<br><span class="hljs-bullet">      -</span> æœªèŠ±è´¹çš„äº¤æ˜“è¾“å…¥å‘ŠçŸ¥è´§å¸æ˜¯ä»å“ªé‡Œæ¥ï¼ŒæœªèŠ±è´¹çš„äº¤æ˜“è¾“å‡ºå‘ŠçŸ¥è´§å¸å¾€å“ªé‡Œå»<br><span class="hljs-bullet">    -</span> è´¦æˆ·æ¨¡å‹: å®ç°è´¦æˆ·é—´ä½™é¢çš„åŠ¨æ€å¹³è¡¡<br><span class="hljs-bullet">    -</span> é€šç”¨æ¨¡å‹: æ²¡æœ‰å†…ç½®çŠ¶æ€å±æ€§ï¼Œå¯å­˜å‚¨ä»»æ„è‡ªå®šä¹‰æ•°æ®<br></code></pre></td></tr></table></figure></li>
<li><p>å¯†ç å­¦ç®—æ³•</p>
<figure class="highlight haml"><table><tr><td class="code"><pre><code class="hljs haml"># å“ˆå¸Œç®—æ³•<br>  &gt; å“ˆå¸Œç®—æ³•ç§°ä¸ºæ•£åˆ—å‡½æ•°ï¼Œå¯ä»¥å°†ä»»æ„é•¿åº¦çš„æ•°æ®è½¬æ¢æˆçŸ­çš„ã€å›ºå®šé•¿åº¦çš„æ•°æ®æŒ‡çº¹<br>  -<span class="ruby"> å¸¸ç”¨çš„å“ˆå¸Œç®—æ³•:</span><br><span class="ruby"></span>    &gt; å“ˆå¸Œç®—æ³•ç›¸å½“äºæ˜¯å¯¹ä¿¡æ¯æå–æ‘˜è¦,æ˜¯æ•°æ®çš„æŒ‡çº¹.ç”¨äºæ•°æ®å®Œæ•´æ€§æ ¡éªŒ<br>    -<span class="ruby"> <span class="hljs-symbol">MD5:</span> <span class="hljs-number">32</span> byte</span><br><span class="ruby"></span>    -<span class="ruby"> SHA-<span class="hljs-number">256</span>:</span><br><span class="ruby"></span>  -<span class="ruby"> å“ˆå¸Œç®—æ³•æ ‡å‡†</span><br><span class="ruby"></span>    -<span class="ruby"> æ­£å‘å¿«é€Ÿ:</span><br><span class="ruby"></span>    -<span class="ruby"> é€†å‘å›°éš¾:</span><br><span class="ruby"></span>    -<span class="ruby"> è¾“å…¥æ•æ„Ÿ:</span><br><span class="ruby"></span>    -<span class="ruby"> é¿å…ç¢°æ’:</span><br><span class="ruby"></span><br># éå¯¹ç§°åŠ å¯†ç®—æ³•:<br>  &gt; éå¯¹ç§°åˆ†ä¸ºå…¬é’¥å’Œç§é’¥, å…¬é’¥åŠ å¯† -&gt; ç§é’¥è§£å¯†; ç§é’¥åŠ å¯† -&gt; å…¬é’¥è§£å¯†<br>  &gt; åŒºå—é“¾ä¸­ä½¿ç”¨çš„éå¯¹ç§°åŠ å¯†ç®—æ³•å¹¶ä¸æ˜¯ç›´æ¥ç”¨äºæ•°æ®åŠ å¯†ï¼Œè€Œæ˜¯ä¸»è¦ç”¨ä½œäº¤æ˜“ç­¾å, æ•°å­—ç­¾åé›†æˆäº†å“ˆå¸Œç®—æ³•ä¸éå¯¹ç§°åŠ å¯†ç®—æ³•çš„åŒé‡ç‰¹å¾ï¼Œåœ¨ä¿è¯äº¤æ˜“å®Œæ•´æ€§çš„åŒæ—¶ï¼Œè¯æ˜äº¤æ˜“å‘èµ·äººçš„èº«ä»½.<br>  -<span class="ruby"> <span class="hljs-symbol">RSA:</span></span><br><span class="ruby"></span>  -<span class="ruby"> <span class="hljs-symbol">ECC:</span></span><br><span class="ruby"></span># å¯¹ç§°åŠ å¯†ç®—æ³•:<br>  &gt; å¯¹ç§°è¡¨ç¤ºåŠ å¯†å’Œè§£å¯†éƒ½ä½¿ç”¨åŒä¸€å¥—å¯†é’¥<br># æ•°å­—ç­¾å:<br>  &gt; åŒºå—é“¾ä¸­ä¸ç›´æ¥ä½¿ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œè€Œæ˜¯ä½¿ç”¨æ•°å­—ç­¾å<br></code></pre></td></tr></table></figure></li>
<li><p>ç½‘ç»œæ¨¡å‹</p>
<ul>
<li>å®¢æˆ·ç«¯/æœåŠ¡ç«¯æ¨¡å‹<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">å®¢æˆ·ç«¯/æœåŠ¡ç«¯æ¨¡å‹ï¼šå±äºä¸­å¿ƒåŒ–çš„ç½‘ç»œæ¶æ„ï¼ŒæœåŠ¡èƒ½åŠ›å–å†³äºä¸­å¿ƒçš„æœåŠ¡å™¨</span><br></code></pre></td></tr></table></figure></li>
<li>ç‚¹å¯¹ç‚¹ç½‘ç»œæ¨¡å‹<figure class="highlight"><table><tr><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure></li>
<li>ç½‘ç»œæ‹“æ‰‘ç»“æ„<ul>
<li>ä¸­å¿ƒç´¢å¼•èŠ‚ç‚¹<figure class="highlight"><table><tr><td class="code"><pre><code class="hljs">ä¸­å¿ƒç´¢å¼•èŠ‚ç‚¹ä¿å­˜æ‰€æœ‰èŠ‚ç‚¹çš„æ¥å…¥ä¿¡æ¯ï¼Œæ–°èŠ‚ç‚¹çš„åŠ å…¥å°†è‡ªèº«ä¿¡æ¯ä¼ å…¥ä¸­å¿ƒèŠ‚ç‚¹ï¼Œä»è€Œæ¢å–å·²åœ¨ç½‘ç»œä¸­å…¶ä»–èŠ‚ç‚¹çš„è¿æ¥ä¿¡æ¯, æœ‰å¯èƒ½å­˜åœ¨å•ç‚¹æ•…éšœçš„å¯èƒ½æ€§ï¼Œä¸€æ—¦ä¸­å¿ƒç´¢å¼•èŠ‚ç‚¹å®•æœºï¼Œæ–°èŠ‚ç‚¹å°†æ— æ³•åŠ å…¥ç½‘ç»œ<br></code></pre></td></tr></table></figure></li>
<li>æ— ä¸ºè€Œæ²»<figure class="highlight"><table><tr><td class="code"><pre><code class="hljs">æ–°èŠ‚ç‚¹é€‰æ‹©è¿æ¥ä¸€ä¸ªå·²å­˜åœ¨ç½‘ç»œä¸­çš„èŠ‚ç‚¹ï¼Œè¢«è¿æ¥çš„èŠ‚ç‚¹å¯ä»¥å‘ŠçŸ¥æ–°èŠ‚ç‚¹è¿æ¥çš„å…¶ä»–èŠ‚ç‚¹ä¿¡æ¯ï¼Œè¿™æ ·æ–°èŠ‚ç‚¹å¯ä»¥éšæœºé€‰æ‹©è¿æ¥å…¶ä»–èŠ‚ç‚¹<br></code></pre></td></tr></table></figure></li>
<li>æ•´ä½“åˆ†æ•£å±€éƒ¨é›†ä¸­çš„æ··åˆç»“æ„<figure class="highlight"><table><tr><td class="code"><pre><code class="hljs">æ•´ä¸ªç½‘ç»œç”±å¤šä¸ªç§å­èŠ‚ç‚¹å½¢æˆä¸»å¹²ç½‘ç»œï¼Œå…¶ä»–æ™®é€šèŠ‚ç‚¹åˆ™è¿æ¥åˆ°æŸä¸ªå­èŠ‚ç‚¹ï¼Œå°±å½¢æˆæ•´ä½“åˆ†æ•£å±€éƒ¨é›†ä¸­çš„æ··åˆç»“æ„<br></code></pre></td></tr></table></figure></li>
<li>æœ‰åºç»“æ„åŒ–ç½‘ç»œ<figure class="highlight"><table><tr><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li>åŒºå—é“¾ç½‘ç»œæ‹“æ‰‘:<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> BTC</span><br><span class="hljs-meta">  &gt;</span><span class="bash"> é‡‡ç”¨æ··åˆå‹çš„ç½‘ç»œæ‹“æ‰‘ç»“æ„ï¼Œä¸€ä¸ªæ–°èŠ‚ç‚¹çš„åŠ å…¥éœ€è¦ç»™èŠ‚ç‚¹æŒ‡å®šå‡ ä¸ªå·²åœ¨BTCç½‘ç»œä¸­çš„ç›¸é‚»èŠ‚ç‚¹(æ™®é€šèŠ‚ç‚¹æˆ–ç§å­èŠ‚ç‚¹)ä¿¡æ¯, å½“å»ºç«‹èŠ‚ç‚¹é—´è¿æ¥ä»¥åï¼Œæ–°èŠ‚ç‚¹å°†è‡ªèº«ä¿¡æ¯å‘é€ç»™ç›¸é‚»èŠ‚ç‚¹ï¼Œç›¸é‚»èŠ‚ç‚¹å†å°†æ–°èŠ‚ç‚¹çš„ä¿¡æ¯ä¾æ¬¡è½¬å‘ç»™å„è‡ªç›¸é‚»èŠ‚ç‚¹ï¼Œä»è€Œé€‰æ‹©æ€§è¿æ¥æ›´å¤šèŠ‚ç‚¹ï¼Œå¢å¼ºèŠ‚ç‚¹è‡ªèº«ä¸æ•´ä½“ç½‘ç»œè¿æ¥çš„ç¨³å®šæ€§</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> ETC</span><br><span class="hljs-meta">  &gt;</span><span class="bash"> ä»¥å¤ªåŠé‡‡ç”¨ç»“æ„åŒ–ç½‘ç»œæ‹“æ‰‘ï¼ŒåŸºäºåˆ†å¸ƒå¼å“ˆå¸Œè¡¨Kademliaç®—æ³•ã€‚</span><br><span class="hljs-meta">  &gt;</span><span class="bash"> èŠ‚ç‚¹é—´çš„è·ç¦»æ˜¯é€»è¾‘è·ç¦»ï¼Œè€Œéç‰©ç†è·ç¦».</span><br></code></pre></td></tr></table></figure></li>
<li>äº¤æ˜“æ‰©æ•£<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-quote">&gt; Gossip å…«å¦åè®®:</span><br><span class="hljs-bullet">-</span> ETC: ä»¥å¤ªåŠç½‘ç»œçš„èŠ‚ç‚¹åªä¸è‡ªå·±æœ€è¿‘è·ç¦»çš„ç›¸é‚»èŠ‚ç‚¹è¿æ¥ï¼Œäº¤æ˜“çš„æ‰©æ•£ä¸å­˜åœ¨å›è·¯çš„å¯èƒ½æ€§ï¼Œæ‰©æ•£æ›´åƒæ˜¯ä¸€ç§æŒç»­å‘å¤–å¹¿æ’­ã€‚äº¤æ˜“ä¼šé€æ¸è¿œç¦»æœ€åˆçš„èŠ‚ç‚¹ï¼Œäº¤æ˜“æ‰©æ•£æ•ˆç‡è¾ƒé«˜<br><span class="hljs-bullet">-</span> BTC: ç½‘ç»œæ‹“æ‰‘æ˜¯éšæœºçš„ï¼Œäº¤æ˜“æ‰©æ•£æ˜¯æ‰©æ•£åˆ°è¿æ¥èŠ‚ç‚¹ï¼Œæ‰©æ•£å‰æ— æ³•æŒ‡å¯¼å¯¹æ–¹æ˜¯å¦å·²ç»æ¥æ”¶åˆ°ç›¸åŒçš„äº¤æ˜“ï¼Œç½‘ç»œæ‰©æ•£çš„æ•ˆç‡è¾ƒä½<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>å…±è¯†ç®—æ³•</p>
<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">å…±è¯†ç®—æ³•çš„åŸºç¡€æ˜¯å°‘æ•°æœä»å¤šæ•°</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">åŒºå—é“¾å¼•å…¥å…±è¯†ç®—æ³•ä¿è¯èŠ‚ç‚¹é—´çŠ¶æ€çš„ä¸€è‡´</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">åŒºå—é“¾ä¸­å¯¹çŠ¶æ€çš„å…±è¯†å®è´¨å°±æ˜¯å¯¹åŒºå—çš„å…±è¯†, åªè¦åŒºå—ä¸€è‡´çŠ¶æ€å°±ä¸€å®šä¸€è‡´</span><br># æ‹œå åº­å°†å†›é—®é¢˜:<br></code></pre></td></tr></table></figure>
<ul>
<li>æ¿€åŠ±å…±è¯†:<ul>
<li>PoW - å·¥ä½œé‡è¯æ˜ç®—æ³•<figure class="highlight erlang-repl"><table><tr><td class="code"><pre><code class="hljs erlang-repl">åˆ©ç”¨å“ˆå¸Œç®—æ³•è®¡ç®—åŒºå—å“ˆå¸Œï¼Œä½¿å¾—åŒºå—å“ˆå¸Œä»¥Nä¸ª<span class="hljs-number">0</span>å¼€å¤´,<br>æ¯”ç‰¹å¸ç½‘ç»œå…è®¸æœ‰å¤šæ¡åŒºå—é“¾å­˜åœ¨ï¼Œä½†åªè®¤åŒèŠ‚ç‚¹èƒ½æ¥æ”¶åˆ°çš„æœ€é•¿çš„é‚£æ¡åŒºå—é“¾æ˜¯å…¨ç½‘ç½‘ç»œå…±è¯†çš„é“¾<br>å¯¹æ¯”ç‰¹å¸ç½‘ç»œçš„ç¯¡æ”¹ï¼Œå®è´¨æ˜¯å¯¹è®¡ç®—èµ„æº(ç®—åŠ›)çš„äº‰å¤ºï¼Œè°æ‹¥æœ‰æ›´å¤šçš„è®¡ç®—èµ„æºï¼Œç¡çš„è¯è¯­æƒå°±å¤§ï¼Œå°±æ˜¯é€šå¸¸å¬åˆ°çš„<span class="hljs-number">51</span><span class="hljs-comment">%æ”»å‡»</span><br></code></pre></td></tr></table></figure></li>
<li>PoS - æƒç›Šè¯æ˜ç®—æ³•</li>
<li>DPos - å§”æ‰˜æƒç›Šè¯æ˜ç®—æ³•</li>
</ul>
</li>
<li>BPFT - æ‹œå åº­å®¹é”™ç®—æ³•<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">åªè¦å…±è¯†ç½‘ç»œä¸­ä½œæ¶èŠ‚ç‚¹çš„æ•°é‡æœªè¶…è¿‡æ€»èŠ‚ç‚¹æ•°çš„<span class="hljs-number">1</span>/<span class="hljs-number">3</span>ï¼Œå…±è¯†ä¾æ—§å¯ä»¥è¾¾æˆ</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">BFTç±»çš„å…±è¯†ç®—æ³•ä¸»è¦ç”¨åœ¨è”ç›Ÿé“¾ä¸­ï¼Œå› ä¸ºè”ç›Ÿé“¾ä¸»è¦å‚ä¸å¯¹è±¡æ˜¯ä¼ä¸šï¼Œæœ‰å‡†å…¥æœºåˆ¶çš„å­˜åœ¨ï¼Œä¸€æ¡é“¾çš„å‚ä¸æ–¹ä¸ä¼šå¾ˆå¤šä¹Ÿå¾ˆå°‘å­˜åœ¨åŠ¨æ€å¢åˆ èŠ‚ç‚¹çš„æƒ…å½¢</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="æ™ºèƒ½åˆçº¦"><a href="#æ™ºèƒ½åˆçº¦" class="headerlink" title="æ™ºèƒ½åˆçº¦"></a>æ™ºèƒ½åˆçº¦</h2><div class="code-wrapper"><pre><code class="hljs"><figure class="highlight"><table><tr><td class="code"><pre><code class="hljs">ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„åˆåŒåè®®çš„çº¦æŸåŠ›æ¥è‡ªäºæƒå¨æœºæ„èƒŒä¹¦<br>æ™ºèƒ½åˆçº¦å®è´¨æ˜¯ä¸€æ®µè®¡ç®—æœºç¨‹åºä»£ç <br>æ™ºèƒ½åˆçº¦çš„æ ‡å‡†åŒ–æ˜¯ä»·å€¼ç½‘ç»œè½åœ°çš„å‰æ<br></code></pre></td></tr></table></figure>
- NTF - éåŒè´¨åŒ–ä»£å¸
<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">NTF - ä¸€ç§æ‰‹æ®µå°†è™šæ‹Ÿä¸ç°å®çš„ä»·å€¼é”šå®š.</span><br></code></pre></td></tr></table></figure>
- å…ƒå®‡å®™
<figure class="highlight"><table><tr><td class="code"><pre><code class="hljs">å…ƒå®‡å®™ä»£è¡¨çš„æ˜¯ä¸€ä¸ªæ²‰æµ¸å¼çš„è™šæ‹Ÿä¸–ç•Œï¼Œç©å®¶èƒ½åœ¨å…¶ä¸­è¿›è¡Œæ–‡åŒ–ã€ç¤¾äº¤ã€å¨±ä¹ç­‰æ´»åŠ¨<br>å…ƒå®‡å®™æ˜¯ç”±åŒºå—é“¾ã€æ¸¸æˆã€ç½‘ç»œå’Œæ˜¾ç¤ºå››å¤§æŠ€æœ¯èåˆè€Œæˆçš„è™šæ‹Ÿä¸–ç•Œ<br></code></pre></td></tr></table></figure>
</code></pre>
<h2 id="é‡å­è®¡ç®—"><a href="#é‡å­è®¡ç®—" class="headerlink" title="é‡å­è®¡ç®—"></a>é‡å­è®¡ç®—</h2><ul>
<li>ç»å…¸è®¡ç®—æœºä¸é‡å­è®¡ç®—æœºå­˜å‚¨æ•°æ®åŒºåˆ«<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">ç»å…¸è®¡ç®—æœºå­˜å‚¨å…·ä½“çš„å€¼</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">é‡å­è®¡ç®—å­˜å‚¨å€¼çš„æ¦‚ç‡</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="åŒºå—é“¾"><a href="#åŒºå—é“¾" class="headerlink" title="åŒºå—é“¾+"></a>åŒºå—é“¾+</h2><ul>
<li>å¯ä¿¡ä¸Šé“¾<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown">1.ç¡®ä¿åŒºå—é“¾ä¸Šé“¾æ•°æ®çš„çœŸå®æ€§?<br><span class="hljs-bullet">  -</span> æƒå¨æœºæ„çš„ä¿¡æ¯å‘å¸ƒ<br><span class="hljs-bullet">  -</span> æ‘†è„±æ•°æ®çš„è®¤ä¸ºå¹²é¢„<br></code></pre></td></tr></table></figure></li>
<li>é¢„è¨€æœº<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">å°†å¤–ç•ŒçœŸå®çš„ä¿¡æ¯è¾“å…¥åˆ°åŒºå—é“¾ç½‘ç»œä¸­ï¼Œå®ç°é“¾å¤–ä¸é“¾å†…çš„æ•°æ®äº’é€š.</span><br></code></pre></td></tr></table></figure></li>
<li>5G ç‰©è”ç½‘<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">5G ä¾æ‰˜å…¨æ–°çš„ç½‘ç»œæ¶æ„ï¼Œå…·å¤‡é«˜é€Ÿç‡ã€ä½å»¶è¿Ÿã€é«˜å¯é æ€§ã€å¤§å¸¦å®½ç­‰ä¼˜åŠ¿ï¼Œå¯ä»¥æ»¡è¶³äººä¸äººä¹‹é—´çš„é€šä¿¡éœ€æ±‚ï¼Œè§£å†³ç‰©ä¸ç‰©çš„é€šä¿¡è¿æ¥é—®é¢˜.</span><br></code></pre></td></tr></table></figure></li>
<li>æ•°å­—äººæ°‘å¸<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-quote">&gt; æ•°å­—äººæ°‘å¸æ˜¯ä¸­å›½äººæ°‘é“¶è¡Œå‘è¡Œçš„æ³•å®šè´§å¸çš„æ•°å­—åŒ–ï¼Œæ˜¯ç”±å›½å®¶ä¿¡ç”¨åœ¨èƒŒåä½œæ”¯æ’‘ï¼Œå…¶å‘è¡Œæƒå±äºå›½å®¶.</span><br><span class="hljs-quote">&gt; æ•°å­—äººæ°‘å¸çš„å®šä½æ˜¯ç°é‡‘ç±»æ”¯ä»˜å‡­è¯ï¼Œæ„å‘³ç€æ•°å­—äººæ°‘å¸å’Œçº¸å¸ã€ç¡¬å¸çš„å®šä½æ˜¯ä¸€è‡´çš„</span><br><br><span class="hljs-bullet">-</span> ä¸è®¡åˆ©æ¯<br><span class="hljs-bullet">-</span> æ— æ‰‹ç»­è´¹<br><span class="hljs-bullet">-</span> å¯æ§åŒ¿å: å°é¢åŒ¿åã€å¤§é¢ä¾æ³•å¯æº¯<br><br><span class="hljs-bullet">-</span> æ•°å­—äººæ°‘å¸çš„å‘è¡Œæ˜¯ä¸æ¯”ä½¿ç”¨åŒºå—é“¾æŠ€æœ¯çš„<br></code></pre></td></tr></table></figure></li>
<li>æ•°å­—ç¤¾ä¼š<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">-</span> äº‘è®¡ç®—:<br><span class="hljs-bullet">  -</span> äº‘è®¡ç®—åˆ©ç”¨è™šæ‹ŸåŒ–æŠ€æœ¯å°†ç‰©ç†æœåŠ¡å™¨ã€å­˜å‚¨å’Œç½‘ç»œç­‰ç¡¬ä»¶ä»¥æœåŠ¡çš„å½¢å¼æä¾›ç»™ç”¨æˆ·ä½¿ç”¨<br><span class="hljs-bullet">-</span> åŒºå—é“¾:<br><span class="hljs-bullet">  -</span> åŒºå—é“¾ä¸äº‘è®¡ç®—çš„ç»“åˆå‚¬ç”Ÿå‡ºåŒºå—é“¾å³æœåŠ¡å¹³å°<br><span class="hljs-bullet">  -</span> Baas, Blockchain as a Service<br><span class="hljs-bullet">  -</span> Paas, Platform as a service<br><span class="hljs-bullet">-</span> å¤§æ•°æ®:<br><span class="hljs-bullet">  -</span> Volume: æ•°æ®é‡å¤§ï¼Œé€šè¿‡å¤§æ•°æ®çš„æ•°æ®é‡æ˜¯ä»¥TBï¼ŒPBæ¥è®¡ç®—<br><span class="hljs-bullet">  -</span> Volocity: é«˜é€Ÿ, å¤§æ•°æ®éœ€è¦ç”¨è¾ƒé«˜çš„é€Ÿåº¦æ¥æ”¶ç”šè‡³æ˜¯å¤„ç†æ•°æ®<br><span class="hljs-bullet">  -</span> Variety: å¤šæ ·æ€§, å¤§æ•°æ®çš„æ•°æ®æºå¾ˆå¤šï¼Œä¸”å¤§å¤šæ•°å±äºéç»“æ„åŒ–çš„æ•°æ®<br><span class="hljs-bullet">  -</span> Value: ä»·å€¼, å¤§æ•°æ®æ‰€é¢å¯¹çš„æ•°æ®æ˜¯æµ·é‡çš„ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®éƒ½æœ‰ä»·å€¼ï¼Œéœ€è¦é€šè¿‡æ•°æ®æ¸…æ´—ã€è¿‡æ»¤å‡ºæœ‰ä»·å€¼çš„æ•°æ®<br><span class="hljs-bullet">  -</span> Veracity: çœŸå®, éœ€è¦ä¿è¯æ•°æ®çš„çœŸå®æ€§ã€å‡†ç¡®æ€§ï¼Œæ‰èƒ½æé«˜æ•°æ®è´¨é‡<br><span class="hljs-bullet">-</span> äººå·¥æ™ºèƒ½:<br><span class="hljs-bullet">  -</span> è¯­éŸ³è¯†åˆ«<br><span class="hljs-bullet">  -</span> å›¾åƒè¯†åˆ«<br><span class="hljs-bullet">  -</span> è‡ªç„¶è¯­è¨€å¤„ç†<br></code></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>Blockchain</category>
      </categories>
  </entry>
  <entry>
    <title>Raspberry Pico Intro</title>
    <url>/2021/09/17/Raspberry-Pico-Intro/</url>
    <content><![CDATA[<h1 id="Raspberry-Pi-Pico"><a href="#Raspberry-Pi-Pico" class="headerlink" title="Raspberry Pi Pico"></a>Raspberry Pi Pico</h1><blockquote>
<p>a microcontroller development board,</p>
</blockquote>
<ul>
<li><p>RP2040</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-quote">&gt; new microcontroller chip designed by Raspberry Pi in the UK.</span><br><span class="hljs-bullet">  -</span> dual-core Arm Cortex-M0+<br><span class="hljs-bullet">  -</span> 264KB RAM<br><span class="hljs-bullet">  -</span> 16MB off-chip Flash<br></code></pre></td></tr></table></figure></li>
<li><p>Micro USB Port</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><code class="hljs routeros">- provide power make Pico <span class="hljs-builtin-name">run</span><br>- USB<span class="hljs-built_in"> port </span>talk <span class="hljs-keyword">to</span> pico<br></code></pre></td></tr></table></figure></li>
<li><p>BOOTSEL</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><code class="hljs mipsasm">- <span class="hljs-keyword">BOOTSEL </span>is <span class="hljs-keyword">short </span>for <span class="hljs-keyword">boot </span>selection.<br></code></pre></td></tr></table></figure></li>
</ul>
<span id="more"></span>

<h2 id="Raspberry-Picoâ€™s-pins"><a href="#Raspberry-Picoâ€™s-pins" class="headerlink" title="Raspberry Picoâ€™s pins"></a>Raspberry Picoâ€™s pins</h2><p><img src="/misc/images/pico-pins.png" alt="The Raspberry Pi Pico&#39;s pins"></p>
<ul>
<li><p>Raspberry Pi Pico pins functions</p>
<table>
<thead>
<tr>
<th align="left">â€¦</th>
<th align="left">â€¦</th>
<th align="left">â€¦</th>
</tr>
</thead>
<tbody><tr>
<td align="left">3V3</td>
<td align="left">3.3 volts power</td>
<td align="left">Pico 3.3V ä» VSYS è·å–</td>
</tr>
<tr>
<td align="left">VSYS</td>
<td align="left">~2-5 volts power</td>
<td align="left">è¿æ¥Picoå†…éƒ¨ç”µæº</td>
</tr>
<tr>
<td align="left">VBUS</td>
<td align="left">5 volts power</td>
<td align="left">5V power taken from Picoâ€™s micro USB port</td>
</tr>
<tr>
<td align="left">GND</td>
<td align="left">0 volts ground</td>
<td align="left">åœ°</td>
</tr>
<tr>
<td align="left">GPxx</td>
<td align="left">General-purpose input/output pin</td>
<td align="left">é€šç”¨GPIOå£</td>
</tr>
<tr>
<td align="left">GPxx_ADCx</td>
<td align="left">GPIO/ADC input</td>
<td align="left">æ™®é€šGPIOå£æˆ–ADCè¾“å…¥å£</td>
</tr>
<tr>
<td align="left">ADC_VREF</td>
<td align="left">Analogue-to-digital coverter (ADC) voltage reference</td>
<td align="left">æ¨¡æ‹Ÿæ•°å­—è½¬æ¢å‚è€ƒç”µå‹è¾“å…¥</td>
</tr>
<tr>
<td align="left">AGND</td>
<td align="left">Anaglogue-to-digital coverter (ADC) 0 volts ground</td>
<td align="left">ADCè¾“å…¥ç”µå‹å‚è€ƒ0volts</td>
</tr>
<tr>
<td align="left">RUN</td>
<td align="left">Enable/disable Pico</td>
<td align="left">å¯åŠ¨/å…³é—­Pico</td>
</tr>
</tbody></table>
</li>
<li><p>MicroPython - Hello, LED!</p>
<figure class="highlight vhdl"><table><tr><td class="code"><pre><code class="hljs vhdl">import machine<br>import utime<br><br># <span class="hljs-keyword">on</span>-board LED <span class="hljs-keyword">is</span> connected <span class="hljs-keyword">to</span> one <span class="hljs-keyword">of</span> RP2040<span class="hljs-symbol">&#x27;s</span> general-purpose input/output pins. GP25.<br>led_onboard = machine.Pin(<span class="hljs-number">25</span>, machine.Pin.<span class="hljs-keyword">OUT</span>)<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    led_onboard.toggle()<br>    utime.sleep(<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="MicroPython-on-Raspberry-Pi-Pico"><a href="#MicroPython-on-Raspberry-Pi-Pico" class="headerlink" title="MicroPython on Raspberry Pi Pico"></a>MicroPython on Raspberry Pi Pico</h2><ul>
<li><p>Installing MicroPython</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><code class="hljs livecodeserver">&gt; MicroPython is <span class="hljs-keyword">a</span> full implementation <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> Python <span class="hljs-number">3</span> Programming language that runs directly <span class="hljs-keyword">on</span> <span class="hljs-title">embedded</span> <span class="hljs-title">hardware</span> <span class="hljs-title">like</span> <span class="hljs-title">Raspberry</span> <span class="hljs-title">Pi</span> <span class="hljs-title">Pico</span>.<br><span class="hljs-comment"># Hold BOOTSEL button down 3 seconds then let go</span><br>  /Volumes/RPI-RP2<br>  âœ tree<br>  .<br>  â”œâ”€â”€ INDEX.HTM<br>  â””â”€â”€ INFO_UF2.TXT  <span class="hljs-comment">-- hold information about your Pico</span><br><br>  <span class="hljs-number">0</span> <span class="hljs-built_in">directories</span>, <span class="hljs-number">2</span> <span class="hljs-built_in">files</span><br><br><span class="hljs-comment"># Darg-and-Drop MicroPython</span><br>  - Drag <span class="hljs-keyword">and</span> drop <span class="hljs-keyword">the</span> MicroPython UF2 onto <span class="hljs-keyword">the</span> RPI-RP2 volume, auto flash <span class="hljs-keyword">the</span> firmware onto its internal storage.<br></code></pre></td></tr></table></figure></li>
<li><p>Programming with MicroPython</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">&gt; MicroPython <span class="hljs-keyword">is</span> a Python-compatible programming language developed specifically <span class="hljs-keyword">for</span> microcontrollers.<br><br><span class="hljs-comment"># Thonny - IDE</span><br>MicroPython v1<span class="hljs-number">.17</span> on <span class="hljs-number">2021</span>-09-02; Raspberry Pi Pico <span class="hljs-keyword">with</span> RP2040<br><span class="hljs-type">Type</span> <span class="hljs-string">&quot;help()&quot;</span> <span class="hljs-keyword">for</span> more information.<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello, World!&quot;</span>)<br>Hello, World!<br>&gt;&gt;&gt;<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Rust-on-Raspberry-Pi-Pico"><a href="#Rust-on-Raspberry-Pi-Pico" class="headerlink" title="Rust on Raspberry Pi Pico"></a>Rust on Raspberry Pi Pico</h2><h2 id="Getting-Started-with-FreeRTOS-on-the-Raspberry-Pi-Pico"><a href="#Getting-Started-with-FreeRTOS-on-the-Raspberry-Pi-Pico" class="headerlink" title="Getting Started with FreeRTOS on the Raspberry Pi Pico"></a>Getting Started with FreeRTOS on the Raspberry Pi Pico</h2><blockquote>
<p>RTOS - Real Time Operating System</p>
<blockquote>
<p>Allows multiple tasks to execute â€œat the same timeâ€<br>Schedules based on task priority<br>â€œTask Priorityâ€ allows the programmer to define what needs to happen first</p>
</blockquote>
</blockquote>
]]></content>
      <categories>
        <category>Hardware</category>
      </categories>
  </entry>
  <entry>
    <title>Dell PowerEdge R720 Intro</title>
    <url>/2021/09/18/Dell-PowerEdge-R720-Intro/</url>
    <content><![CDATA[<h1 id="Dell-EMC-PowerEdge-R720"><a href="#Dell-EMC-PowerEdge-R720" class="headerlink" title="Dell EMC PowerEdge R720"></a>Dell EMC PowerEdge R720</h1><span id="more"></span>

<h2 id="Dell-iDRAC"><a href="#Dell-iDRAC" class="headerlink" title="Dell iDRAC"></a>Dell iDRAC</h2><figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">iDRAC (Integrated Dell Remote Access Controller) è¿œç¨‹æ§åˆ¶å¡, iDRACç›¸å½“äºé™„åŠ åœ¨æœåŠ¡å™¨ä¸Šè®¡ç®—æœºï¼Œå¯ä»¥å®ç°ä¸€å¯¹ä¸€çš„æœåŠ¡å™¨è¿œç¨‹ç®¡ç†ä¸ç›‘æ§ï¼Œé€šè¿‡ä¸æœåŠ¡å™¨ä¸»æ¿ä¸Šçš„ç®¡ç†èŠ¯ç‰‡BMCè¿›è¡Œé€šä¿¡,ç›‘æ§å’Œç®¡ç†æœåŠ¡å™¨çš„ç¡¬ä»¶çŠ¶æ€ä¿¡æ¯ï¼Œæ‹¥æœ‰è‡ªå·±çš„ç³»ç»Ÿå’ŒIPåœ°å€ï¼Œä¸æœåŠ¡å™¨ä¸Šçš„OSæ— å…³,æ˜¯ç®¡ç†å‘˜è¿›è¡Œè¿œç¨‹è®¿é—®å’Œç®¡ç†çš„åˆ©å™¨.</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">iDRACç™»é™†ç•Œé¢é»˜è®¤çš„ç”¨æˆ·åæ˜¯rootå¯†ç calvin</span><br></code></pre></td></tr></table></figure>

<h2 id="vSphere-ESXi-vCenter-åŒºåˆ«"><a href="#vSphere-ESXi-vCenter-åŒºåˆ«" class="headerlink" title="vSphere,ESXi,vCenter åŒºåˆ«"></a>vSphere,ESXi,vCenter åŒºåˆ«</h2><ul>
<li>VMware Inc. è½¯ä»¶å…¬å¸æä¾›åŒ…æ‹¬äº‘äº§å“ï¼Œæ•°æ®ä¸­å¿ƒäº§å“å’Œæ¡Œé¢äº§å“</li>
<li>vSphere<figure class="highlight axapta"><table><tr><td class="code"><pre><code class="hljs axapta">æ•°æ®ä¸­å¿ƒäº§å“ä¸‹çš„ä¸€å¥—è½¯ä»¶, åŒ…æ‹¬vCenter, EXSiå’ŒvSphere <span class="hljs-keyword">client</span>, vSphereä¸æ˜¯ä¸€ä¸ªå¯ä»¥å®‰è£…ä½¿ç”¨çš„è½¯ä»¶ï¼Œåªæ˜¯ä¸€ä¸ªåŒ…å«å…¶ä»–ç»„ä»¶çš„é›†åˆ.<br></code></pre></td></tr></table></figure></li>
<li>vSphere client<figure class="highlight axapta"><table><tr><td class="code"><pre><code class="hljs axapta">vSphere <span class="hljs-keyword">client</span>å…è®¸ç®¡ç†å‘˜è®¿é—®ESXiæœåŠ¡å¹¶ç®¡ç†è™šæ‹Ÿæœºã€‚vSphere <span class="hljs-keyword">client</span>æ˜¯å®‰è£…åœ¨å®¢æˆ·ç«¯ä¸Šé¢ï¼ŒvSphere <span class="hljs-keyword">client</span>ç”¨æ¥è¿æ¥ESXiæœåŠ¡å™¨å’Œç®¡ç†ä»»åŠ¡, ç”¨æ¥è®¿é—®ESXiæœåŠ¡å®‰è£…å’Œç®¡ç†ä¸Šé¢çš„è™šæ‹Ÿæœº<br>vSphere <span class="hljs-keyword">client</span>å¯ä»¥åœ¨å°ç¯å¢ƒä¸­ç›´æ¥ç®¡ç†ESXiæœåŠ¡ï¼Œå¯ä»¥åœ¨å¤§è§„æ¨¡çš„ç¯å¢ƒä¸­ï¼Œé€šè¿‡vCenteræœåŠ¡é—´æ¥ç®¡ç†ESXiæœåŠ¡<br></code></pre></td></tr></table></figure></li>
<li>EXSi<figure class="highlight erlang"><table><tr><td class="code"><pre><code class="hljs erlang">ESXiæ˜¯è™šæ‹ŸåŒ–æœåŠ¡ï¼Œæ‰€æœ‰çš„è™šæ‹Ÿæœºéƒ½è¿è¡Œåœ¨ESXiæœåŠ¡ä¸Šé¢,ä¸ºäº†å®‰è£…ï¼Œç®¡ç†å’Œè®¿é—®è™šæ‹Ÿæœºï¼Œéœ€è¦vSphere clientæˆ–vCenter.<br>ESXiå®‰è£…åœ¨ç‰©ç†æœºä¸Šé¢çš„æœåŠ¡.<br></code></pre></td></tr></table></figure></li>
<li>vCenter server<figure class="highlight axapta"><table><tr><td class="code"><pre><code class="hljs axapta">VMware vCenter <span class="hljs-keyword">server</span>æ˜¯ä¸€ä¸ªä¼ä¸šçº§åˆ«çš„äº§å“, ä¸­å¿ƒåŒ–çš„ç®¡ç†åº”ç”¨ï¼Œå¯ä»¥é€šè¿‡ç®¡ç†æ‰€æœ‰çš„è™šæ‹Ÿæœºå’ŒESXiç‰©ç†æœº<br>vCenteræœåŠ¡ç”¨åœ¨æœ‰å¾ˆå¤šEXSiæœåŠ¡å’Œè®¸å¤šè™šæ‹Ÿæœºçš„å¤§è§„æ¨¡ç¯å¢ƒä¸­<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Install-Ubuntu-20-04-on-R720"><a href="#Install-Ubuntu-20-04-on-R720" class="headerlink" title="Install Ubuntu 20.04 on R720"></a>Install Ubuntu 20.04 on R720</h2><ul>
<li>Show Hardware and Network Infomation<figure class="highlight tcl"><table><tr><td class="code"><pre><code class="hljs tcl">chyiyaqing in ~ at chyiyaqing-PowerEdge-R720<br>âœ wget -qO- bench.sh | bash<br><br>grep: /<span class="hljs-keyword">proc</span>/1/environ:<span class="hljs-title"> Permission</span> denied<br>----------------------------------------------------------------------<span class="hljs-title"></span><br><span class="hljs-title"> CPU</span> Model             :<span class="hljs-title"> Intel(R)</span> Xeon(R)<span class="hljs-title"> CPU</span> E5-2650<span class="hljs-title"> v2</span> @ 2.60GHz<span class="hljs-title"></span><br><span class="hljs-title"> CPU</span> Cores             : 32<span class="hljs-title"></span><br><span class="hljs-title"> CPU</span> Frequency         : 1204.573<span class="hljs-title"> MHz</span><br><span class="hljs-title"> CPU</span> Cache             : 20480<span class="hljs-title"> KB</span><br><span class="hljs-title"> Total</span> Disk            : 1127.3<span class="hljs-title"> GB</span> (9.2<span class="hljs-title"> GB</span> Used)<span class="hljs-title"></span><br><span class="hljs-title"> Total</span> Mem             : 32106<span class="hljs-title"> MB</span> (1015<span class="hljs-title"> MB</span> Used)<span class="hljs-title"></span><br><span class="hljs-title"> Total</span> Swap            : 2047<span class="hljs-title"> MB</span> (0<span class="hljs-title"> MB</span> Used)<span class="hljs-title"></span><br><span class="hljs-title"> System</span> uptime         : 0<span class="hljs-title"> days,</span> 0<span class="hljs-title"> hour</span> 22<span class="hljs-title"> min</span><br><span class="hljs-title"> Load</span> average          : 0.07, 0.09, 0.17<span class="hljs-title"></span><br><span class="hljs-title"> OS</span>                    :<span class="hljs-title"> Ubuntu</span> 20.04.3<span class="hljs-title"> LTS</span><br><span class="hljs-title"> Arch</span>                  :<span class="hljs-title"> x86_64</span> (64<span class="hljs-title"> Bit)</span><br><span class="hljs-title"> Kernel</span>                : 5.11.0-36-generic<span class="hljs-title"></span><br><span class="hljs-title"> TCP</span> CC                :<span class="hljs-title"> cubic</span><br><span class="hljs-title"> Virtualization</span>        :<span class="hljs-title"> Dedicated</span><br>----------------------------------------------------------------------<span class="hljs-title"></span><br><span class="hljs-title"> I/O</span> Speed(1st<span class="hljs-title"> run)</span>    : 323<span class="hljs-title"> MB/s</span><br><span class="hljs-title"> I/O</span> Speed(2nd<span class="hljs-title"> run)</span>    : 267<span class="hljs-title"> MB/s</span><br><span class="hljs-title"> I/O</span> Speed(3rd<span class="hljs-title"> run)</span>    : 275<span class="hljs-title"> MB/s</span><br><span class="hljs-title"> Average</span> I/O<span class="hljs-title"> speed</span>     : 288.3<span class="hljs-title"> MB/s</span><br>----------------------------------------------------------------------<span class="hljs-title"></span><br><span class="hljs-title"> Node</span> Name<span class="hljs-title">        Upload</span> Speed<span class="hljs-title">      Download</span> Speed<span class="hljs-title">      Latency</span><br><span class="hljs-title"> Shanghai</span> <span class="hljs-title">  CT</span>    49.45<span class="hljs-title"> Mbps</span>        256.81<span class="hljs-title"> Mbps</span>         9.34<span class="hljs-title"> ms</span><br><span class="hljs-title"> Shanghai</span> <span class="hljs-title">  CU</span>    50.03<span class="hljs-title"> Mbps</span>        263.91<span class="hljs-title"> Mbps</span>         17.96<span class="hljs-title"> ms</span><br><span class="hljs-title"> Guangzhou</span> <span class="hljs-title"> CT</span>    55.97<span class="hljs-title"> Mbps</span>        264.49<span class="hljs-title"> Mbps</span>         35.69<span class="hljs-title"> ms</span><br><span class="hljs-title"> Guangzhou</span> <span class="hljs-title"> CU</span>    50.19<span class="hljs-title"> Mbps</span>        257.02<span class="hljs-title"> Mbps</span>         31.51<span class="hljs-title"> ms</span><br>----------------------------------------------------------------------<br></code></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>Hardware</category>
      </categories>
  </entry>
  <entry>
    <title>Rust language Intro</title>
    <url>/2021/09/18/Rust-language-Intro/</url>
    <content><![CDATA[<h1 id="Rust"><a href="#Rust" class="headerlink" title="Rust"></a>Rust</h1><blockquote>
<p>ä¸€é—¨éå¸¸é‡è§†å¼€å‘è€…ç”¨æˆ·ä½“éªŒçš„è¯­è¨€<br>å¦‚æœä½ æƒ³ä»å…¶ä»–è¯­è¨€è¿ç§»åˆ°Rust,å¿…é¡»ç»è¿‡ä¸€æ®µæ—¶æœŸçš„æ€ç»´è½¬æ¢(Paradigm Shift)<br>  <figure class="highlight gcode"><table><tr><td class="code"><pre><code class="hljs gcode">å‘½ä»¤å¼<span class="hljs-comment">(imperative)</span>ç¼–ç¨‹è¯­è¨€è½¬æ¢ä¸ºå‡½æ•°å¼<span class="hljs-comment">(function)</span>ç¼–ç¨‹è¯­è¨€<br>å˜é‡çš„å¯å˜æ€§<span class="hljs-comment">(mutable)</span>è¿ç§»åˆ°ä¸å¯å˜æ€§<span class="hljs-comment">(immutable)</span><br>å¼±ç±»å‹è¯­è¨€è¿ç§»åˆ°å¼ºç±»å‹è¯­è¨€<br>ä»æ‰‹å·¥æˆ–è€…è‡ªåŠ¨å†…å­˜ç®¡ç†åˆ°é€šè¿‡ç”Ÿå‘½å‘¨æœŸæ¥ç®¡ç†å†…å­˜<br></code></pre></td></tr></table></figure><br>Rustæœ€å¤§çš„æ€ç»´è½¬æ¢å°±æ˜¯å˜é‡çš„æ‰€æœ‰æƒå’Œå£°æ˜å‘¨æœŸ</p>
</blockquote>
<span id="more"></span>

<h2 id="1-å‰ç½®çŸ¥è¯†ç¯‡"><a href="#1-å‰ç½®çŸ¥è¯†ç¯‡" class="headerlink" title="1. å‰ç½®çŸ¥è¯†ç¯‡"></a>1. å‰ç½®çŸ¥è¯†ç¯‡</h2><ul>
<li>å†…å­˜<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"># æ ˆ<br><span class="hljs-meta">&gt;</span> <span class="javascript">æ ˆè‡ªä¸Šè€Œä¸‹å¢é•¿</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">æ ˆæ˜¯ç¨‹åºè¿è¡Œçš„åŸºç¡€ï¼Œæ¯å½“ä¸€ä¸ªå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œä¸€å—è¿ç»­çš„å†…å­˜å°±ä¼šè¢«æ ˆé¡¶åˆ†é…å‡ºæ¥ï¼Œè¿™å—å†…å­˜è¢«ç§°ä¸ºå¸§(frame)</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">åœ¨ç¼–è¯‘æ—¶ï¼Œä¸€åˆ‡æ— æ³•ç¡®å®šå¤§å°æˆ–è€…å¤§å°å¯ä»¥æ”¹å˜çš„æ•°æ®,éƒ½æ— æ³•æ”¾åœ¨æ ˆä¸Šï¼Œåªèƒ½æ”¾åœ¨å †ä¸Š</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">å­˜æ”¾æ ˆä¸Šçš„å€¼ï¼Œå®ƒçš„å¤§å°åœ¨ç¼–è¯‘æœŸå°±éœ€è¦ç¡®å®š</span><br><br># å †<br><span class="hljs-meta">&gt;</span> <span class="javascript">å †è‡ªä¸‹è€Œä¸Šå¢é•¿</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">å †ä¸Šåˆ†é…å†…å­˜æ—¶ï¼Œä¸€èˆ¬éƒ½ä¼šé¢„ç•™ä¸€äº›ç©ºé—´</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">åŠ¨æ€åˆ†é…å¤§å°çš„å†…å­˜éœ€è¦è¢«åˆ†é…åˆ°å †ä¸Šï¼ŒåŠ¨æ€å£°æ˜å‘¨æœŸçš„å†…å­˜ä¹Ÿéœ€è¦åˆ†é…åˆ°å †ä¸Š.</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">å †ä¸Šåˆ†é…å‡ºæ¥çš„æ¯ä¸€å—å†…å­˜éœ€è¦æ˜¾å¼åœ°é‡Šæ”¾ï¼Œè¿™å°±ä½¿å †å±±å†…å­˜æœ‰æ›´åŠ çµæ´»çš„å£°æ˜å‘¨æœŸï¼Œå¯ä»¥åœ¨ä¸åŒçš„è°ƒç”¨æ ˆä¹‹é—´å…±äº«æ•°æ®</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">å †å¯ä»¥å­˜æ”¾å¤§å°æœªçŸ¥æˆ–è€…åŠ¨æ€ä¼¸ç¼©çš„æ•°æ®ç±»å‹</span><br><br>æ ˆä¸Šå­˜æ”¾çš„æ•°æ®æ—¶é™æ€çš„ï¼Œé™æ€å¤§å°ï¼Œé™æ€ç”Ÿå‘½å‘¨æœŸï¼Œå †ä¸Šå­˜æ”¾çš„æ•°æ®æ—¶åŠ¨æ€çš„ï¼ŒåŠ¨æ€å¤§å°ï¼ŒåŠ¨æ€ç”Ÿå‘½å‘¨æœŸ<br><br># GC vs ARC<br>  1. GCåœ¨å†…å­˜åˆ†é…å’Œé‡Šæ”¾ä¸Šæ— éœ€é¢å¤–æ“ä½œï¼Œè€ŒARCæ·»åŠ äº†å¤§é‡çš„é¢å¤–ä»£ç å¤„ç†å¼•ç”¨è®¡æ•°ï¼Œæ‰€ä»¥GCæ•ˆç‡æ›´é«˜ï¼Œååé‡(throughput)æ›´å¤§<br>  2. GCé‡Šæ”¾å†…å­˜çš„æ—¶æœºä¸ç¡®å®šï¼Œé‡Šæ”¾æ—¶å¼•å‘çš„STW(Stop The World)ä¼šå¯¼è‡´ä»£ç æ‰§è¡Œçš„å»¶è¿Ÿlatency.ä¸€èˆ¬æºå¸¦GCçš„ç¼–ç¨‹è¯­è¨€ä¸é€‚åˆåšåµŒå…¥å¼ç³»ç»Ÿæˆ–è€…å®æ—¶ç³»ç»Ÿ<br></code></pre></td></tr></table></figure></li>
<li>æ•°æ®<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-quote">&gt; ç¨‹åºæ“ä½œçš„å¯¹è±¡</span><br><br><span class="hljs-section"># å€¼å’Œç±»å‹</span><br><span class="hljs-quote">&gt; ç¼–ç¨‹è¯­è¨€çš„ç±»å‹å¯ä»¥åˆ†ä¸ºåŸç”Ÿç±»å‹å’Œç»„åˆç±»å‹</span><br><span class="hljs-bullet">  -</span> åŸç”Ÿç±»å‹(primitive type) : æ‰€æœ‰åŸç”Ÿç±»å‹çš„å¤§å°éƒ½æ˜¯å›ºå®šçš„ï¼Œå› æ­¤ä»–ä»¬å¯ä»¥è¢«åˆ†é…åˆ°æ ˆä¸Š<br><span class="hljs-bullet">    -</span> å­—ç¬¦<br><span class="hljs-bullet">    -</span> æ•´æ•°<br><span class="hljs-bullet">    -</span> æµ®ç‚¹æ•°<br><span class="hljs-bullet">    -</span> å¸ƒå°”å€¼<br><span class="hljs-bullet">    -</span> æ•°ç»„array<br><span class="hljs-bullet">    -</span> å…ƒç»„tuple<br><span class="hljs-bullet">    -</span> æŒ‡é’ˆ<br><span class="hljs-bullet">      -</span> èƒ–æŒ‡é’ˆ(fat poiner): æ¯”æ­£å¸¸æŒ‡é’ˆæºå¸¦æ›´å¤šä¿¡æ¯çš„æŒ‡é’ˆ<br><span class="hljs-bullet">  -</span> ç»„åˆç±»å‹(composite type) : ç”±ä¸€ç»„åŸç”Ÿç±»å‹å’Œå…¶å®ƒç±»å‹ç»„åˆè€Œæˆçš„ç±»å‹<br><span class="hljs-bullet">    -</span> ç»“æ„ä½“(structure type): å¤šä¸ªç±»å‹ç»„åˆåœ¨ä¸€èµ·å…±åŒè¡¨è¾¾ä¸€ä¸ªå€¼çš„å¤æ‚æ•°æ®ç»“æ„<br><span class="hljs-bullet">    -</span> æ ‡ç­¾è”åˆ(tagged union): ä¸ç›¸äº¤å¹¶é›†<br></code></pre></td></tr></table></figure></li>
<li>æŒ‡é’ˆå’Œå¼•ç”¨<figure class="highlight"><table><tr><td class="code"><pre><code class="hljs">æŒ‡é’ˆå’Œåº”ç”¨éƒ½æŒ‡å‘å†…å­˜åœ°å€ï¼Œåªä¸è¿‡äºŒè€…åœ¨è§£å¼•ç”¨æ—¶çš„è¡Œä¸ºä¸ä¸€æ ·<br>å¼•ç”¨åªèƒ½è§£å¼•ç”¨åˆ°åŸæ¥çš„æ•°æ®ç±»å‹<br></code></pre></td></tr></table></figure></li>
<li>å‡½æ•°<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">å‡½æ•°æ—¶ä»£ç ä¸­é‡å¤è¡Œä¸ºçš„æŠ½è±¡</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">æ–¹æ³•æ—¶å¯¹è±¡å†…éƒ¨å®šä¹‰çš„å‡½æ•°</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">å‡½æ•°æ˜¯ç¼–ç¨‹è¯­è¨€çš„åŸºæœ¬è¦ç´ ,æ˜¯å¯¹å®ŒæˆæŸä¸ªåŠŸèƒ½çš„ä¸€ç»„ç›¸å…³è¯­å¥å’Œè¡¨è¾¾å¼çš„å°è£…</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">å‡½æ•°å¾€å¾€æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œæ„å‘³ç€å‡½æ•°å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œæˆ–è€…ä½œä¸ºè¿”å›å€¼è¿”å›ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºç¬¦åˆç±»å‹ä¸­çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†</span><br></code></pre></td></tr></table></figure></li>
<li>é—­åŒ…<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">é—­åŒ…æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œä¼šæ•è·å‡½æ•°ä½“å†…ä½¿ç”¨åˆ°çš„ä¸Šä¸‹æ–‡ä¸­çš„è‡ªç”±å˜é‡,ä½œä¸ºé—­åŒ…æˆå‘˜çš„ä¸€éƒ¨åˆ†</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">é—­åŒ…æ˜¯å°†å‡½æ•°å’Œå…¶ç¯å¢ƒä¸€èµ·å­˜å‚¨çš„ä¸€ç§æ•°æ®ç»“æ„</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">é—­åŒ…å¼•ç”¨çš„ä¸Šä¸‹æ–‡ä¸­çš„è‡ªç”±å˜é‡ä¼šè¢«æ•è·åˆ°é—­åŒ…çš„ç»“æ„ä¸­ï¼Œæˆä¸ºé—­åŒ…ç±»å‹çš„ä¸€éƒ¨åˆ†</span><br></code></pre></td></tr></table></figure></li>
<li>æ¥å£&amp;&amp;è™šè¡¨<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># æ¥å£</span><br><span class="hljs-quote">&gt; ä½œä¸ºä¸€ä¸ªæŠ½è±¡å±‚,æ¥å£å°†ä½¿ç”¨æ–¹å’Œå®ç°æ–¹éš”ç¦»å¼€æ¥ï¼Œä½¿ä¸¤è€…ä¸ç›´æ¥æœ‰ä¾èµ–å…³ç³»ï¼Œå¤§å¤§æé«˜äº†å¤ç”¨æ€§å’Œæ‰©å±•æ€§</span><br><br><span class="hljs-section"># è™šè¡¨ virtual table</span><br><span class="hljs-quote">&gt; è™šè¡¨æ˜¯æŒ‡å‘ä¸€å¼ æ¶µç›–æ¥å£æ‰€æ”¯æŒæ–¹æ³•çš„åˆ—è¡¨</span><br></code></pre></td></tr></table></figure></li>
<li>å¹¶å‘(concurreny)ä¸å¹¶è¡Œ(parallel)<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># å¹¶å‘</span><br><span class="hljs-quote">&gt; å¹¶å‘æ˜¯åŒæ—¶ä¸å¤šä»¶äº‹æƒ…æ‰“äº¤é“çš„èƒ½åŠ›ï¼Œæ¯”å¦‚ç³»ç»Ÿå¯ä»¥åœ¨ä»»åŠ¡1åšåˆ°ä¸€å®šç¨‹åº¦åï¼Œä¿å­˜è¯¥ä»»åŠ¡çš„ä¸Šä¸‹æ–‡ï¼ŒæŒ‚èµ·å¹¶åˆ‡æ¢åˆ°ä»»åŠ¡2ï¼Œç„¶åè¿‡æ®µæ—¶é—´åœ¨åˆ‡æ¢å›ä»»åŠ¡1</span><br><br><span class="hljs-section"># å¹¶è¡Œ</span><br><span class="hljs-quote">&gt; å¹¶è¡Œæ˜¯åŒæ—¶å¤„ç†å¤šä»¶äº‹æƒ…çš„æ‰‹æ®µï¼Œä»»åŠ¡1å’Œä»»åŠ¡2å¯ä»¥åœ¨åŒä¸€ä¸ªæ—¶é—´ç‰‡ä¸‹å·¥ä½œ,æ— éœ€ä¸Šä¸‹æ–‡åˆ‡æ¢</span><br><br>æ‹¥æœ‰é«˜å¹¶å‘å¤„ç†èƒ½åŠ›çš„ç¼–ç¨‹è¯­è¨€ä¼šåœ¨ç”¨æˆ·ç¨‹åºä¸­åµŒå…¥ä¸€ä¸ªM:Nçš„è°ƒåº¦å™¨ï¼ŒæŠŠMä¸ªå¹¶è¡Œä»»åŠ¡ï¼Œåˆç†åœ°åˆ†é…åœ¨Nä¸ªCPU coreä¸Šå¹¶è¡Œè¿è¡Œ,è®©ç¨‹åºçš„ååé‡è¾¾åˆ°æœ€å¤§<br></code></pre></td></tr></table></figure></li>
<li>åŒæ­¥å’Œå¼‚æ­¥<figure class="highlight coffeescript"><table><tr><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-comment"># åŒæ­¥</span><br>&gt; æŒ‡ä¸€ä¸ªä»»åŠ¡å¼€å§‹æ‰§è¡Œåï¼Œåç»­çš„æ“ä½œå›é˜»å¡ï¼Œç›´åˆ°è¿™ä¸ªä»»åŠ¡ç»“æŸ<br>&gt; åŒæ­¥æ‰§è¡Œä¿è¯äº†ä»£ç çš„å› æœå…³ç³»(causality),æ˜¯ç¨‹åºæ­£ç¡®æ€§çš„ä¿è¯<br><br><span class="hljs-comment"># å¼‚æ­¥</span><br>&gt; æŒ‡ä¸€ä¸ªä»»åŠ¡å¼€å§‹æ‰§è¡Œåï¼Œä¸å®ƒæ²¡æœ‰å› æœå…³ç³»çš„å…¶ä»–ä»»åŠ¡å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œä¸å¿…ç­‰å¾…å‰ä¸€ä¸ªä»»åŠ¡ç»“æŸ<br>  - <span class="hljs-built_in">Promise</span>(future/delay/deferred): å¯¹è±¡ç”¨æ¥æè¿°æœªæ¥æŸä¸ªæ—¶åˆ»æ‰èƒ½è·å¾—çš„ç»“æœçš„å€¼<br>    - åˆå§‹çŠ¶æ€: <span class="hljs-built_in">Promise</span>è¿˜æœªè¿è¡Œ<br>    - ç­‰å¾…pendingçŠ¶æ€: <span class="hljs-built_in">Promise</span>å·²ç»è¿è¡Œï¼Œä½†è¿˜æ²¡æœ‰ç»“æŸ<br>    - ç»“æŸçŠ¶æ€: promiseæˆåŠŸè§£æå‡ºä¸€ä¸ªå€¼ï¼Œæˆ–è€…æ‰§è¡Œå¤±è´¥<br>  - <span class="hljs-keyword">async</span>/<span class="hljs-keyword">await</span><br>    &gt; <span class="hljs-keyword">async</span>/<span class="hljs-keyword">await</span>æ˜¯ä¸€ä¸ªè¯­æ³•ç³–(syntactic sugar)ä½¿ç”¨çŠ¶æ€æœºå°†promiseåŒ…è£…èµ·æ¥ï¼Œè®©å¼‚æ­¥è°ƒç”¨çš„ä½¿ç”¨æ„Ÿè§‰å’ŒåŒæ­¥è°ƒç”¨éå¸¸ç±»å‹<br>    - <span class="hljs-keyword">async</span>å®šä¹‰ä¸€ä¸ªå¯ä»¥å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡<br>    - <span class="hljs-keyword">await</span>è§¦å‘å¹¶å‘æ‰§è¡Œ<br></code></pre></td></tr></table></figure></li>
<li>ç¼–ç¨‹æ³›å¼<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># æ³›å‹ç¼–ç¨‹</span><br><span class="hljs-bullet">  -</span> æ•°æ®ç»“æ„çš„æ³›å‹<br><span class="hljs-bullet">  -</span> ä»£ç çš„æ³›å‹åŒ–<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="2-åŸºç¡€çŸ¥è¯†ç¯‡"><a href="#2-åŸºç¡€çŸ¥è¯†ç¯‡" class="headerlink" title="2. åŸºç¡€çŸ¥è¯†ç¯‡"></a>2. åŸºç¡€çŸ¥è¯†ç¯‡</h2><ul>
<li>ç¬¬ä¸€ä¸ªç¨‹åº<figure class="highlight stylus"><table><tr><td class="code"><pre><code class="hljs stylus">âœ tree scrape_url<br>scrape_url<br>â”œâ”€â”€ Cargo<span class="hljs-selector-class">.lock</span><br>â”œâ”€â”€ Cargo<span class="hljs-selector-class">.toml</span>      -- Rusté¡¹ç›®çš„é…ç½®ç®¡ç†æ–‡ä»¶<br>â”œâ”€â”€ <span class="hljs-attribute">src</span><br>â”‚Â Â  â””â”€â”€ <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.rs</span><br>â””â”€â”€ target<br>    â”œâ”€â”€ CACHEDIR<span class="hljs-selector-class">.TAG</span><br>    â””â”€â”€ debug<br>        â”œâ”€â”€ build<br>        â”œâ”€â”€ deps<br>        â”‚Â Â  â”œâ”€â”€ libscrape_url-f8d1878e1d7fc033<span class="hljs-selector-class">.rmeta</span><br>        â”‚Â Â  â””â”€â”€ scrape_url-f8d1878e1d7fc033<span class="hljs-selector-class">.d</span><br>        â”œâ”€â”€ examples<br>        â””â”€â”€ incremental<br>            â””â”€â”€ scrape_url-<span class="hljs-number">2</span>n1xt1o9t0ikb<br>                â”œâ”€â”€ s-g4eprmaq6h-ez2nl7-<span class="hljs-number">1</span>g41whu33uaqz<br>                â”‚Â Â  â”œâ”€â”€ dep-graph<span class="hljs-selector-class">.bin</span><br>                â”‚Â Â  â”œâ”€â”€ query-cache<span class="hljs-selector-class">.bin</span><br>                â”‚Â Â  â””â”€â”€ work-products<span class="hljs-selector-class">.bin</span><br>                â””â”€â”€ s-g4eprmaq6h-ez2nl7<span class="hljs-selector-class">.lock</span><br><br><span class="hljs-number">9</span> directories, <span class="hljs-number">10</span> files<br><br>scrape_url on î‚  <span class="hljs-selector-tag">main</span> <span class="hljs-selector-attr">[?]</span> is ğŸ“¦ v0.<span class="hljs-number">1.0</span> via ğŸ¦€ v1.<span class="hljs-number">52.0</span> took <span class="hljs-number">8s</span><br>âœ cargo run<br>   Compiling scrape_url v0.<span class="hljs-number">1.0</span> (/Users/chyiyaqing/chyi/github.com/begin-rust/scrape_url)<br>    Finished dev <span class="hljs-selector-attr">[unoptimized + debuginfo]</span> target(s) <span class="hljs-keyword">in</span> <span class="hljs-number">3.13s</span><br>     Running `target/debug/scrape_url`<br>Fetching url: https:<span class="hljs-comment">//www.rust-lang.org/</span><br>Converting <span class="hljs-selector-tag">html</span> to markdown...<br>Converted markdown has been saved <span class="hljs-keyword">in</span> rust<span class="hljs-selector-class">.md</span>.<br><br>&gt; Rustä½¿ç”¨cargoå·¥å…·ç®¡ç†é¡¹ç›®<br>&gt; Rustæ•´ä½“è¯­æ³•åå‘C/C++é£æ ¼<br>&gt; Rustæ”¯æŒé¢å‘æ¥å£ç¼–ç¨‹å’Œæ³›å‹ç¼–ç¨‹<br>&gt; Rustæœ‰éå¸¸ä¸°å¯Œçš„æ•°æ®ç±»å‹å’Œå¼ºå¤§çš„æ ‡å‡†åº“<br>&gt; Rustæœ‰éå¸¸ä¸°å¯Œçš„æ§åˆ¶æµç¨‹<br>&gt; Rusté»˜è®¤å˜é‡ä¸å¯å˜ï¼Œå¯ä»¥æ·»åŠ mutå…³é”®å­—è®©å˜é‡å…·å¤‡å¯å˜æ€§<br>&gt; Rusté¡¹ç›®çš„ç»„ç»‡å¯ä»¥ç”¨modæ¥ç»„ç»‡ä»£ç <br>&gt; Rustä¸€ä¸ªé¡¹ç›®è¢«ç§°ä¸ºcrate (cargo new &lt;name&gt; -- lib åˆ›å»ºä¸€ä¸ªåº“)<br></code></pre></td></tr></table></figure></li>
<li>Rustå˜é‡çš„æ‰€æœ‰æƒå’Œç”Ÿå‘½å‘¨æœŸ</li>
<li>Rustå†…å­˜ç®¡ç†æ–¹å¼</li>
<li>Cçš„æ‰‹å·¥ç®¡ç†</li>
<li>Javaçš„GC</li>
<li>Swiftçš„ARC</li>
<li>Rustè¯­è¨€ç‰¹æ€§<ul>
<li>å‡½æ•°å¼ç¼–ç¨‹ç‰¹æ€§</li>
<li>ç±»å‹ç³»ç»Ÿ</li>
<li>èŒƒæ€§ç¼–ç¨‹</li>
<li>é”™è¯¯å¤„ç†</li>
</ul>
</li>
</ul>
<h2 id="3-è¿›é˜¶ç¯‡"><a href="#3-è¿›é˜¶ç¯‡" class="headerlink" title="3. è¿›é˜¶ç¯‡"></a>3. è¿›é˜¶ç¯‡</h2><p>  *</p>
<h2 id="4-å¹¶å‘ç¯‡"><a href="#4-å¹¶å‘ç¯‡" class="headerlink" title="4. å¹¶å‘ç¯‡"></a>4. å¹¶å‘ç¯‡</h2><ul>
<li>æ— ç•å¹¶å‘(Fearless Concurrency)</li>
</ul>
<h2 id="5-å®æˆ˜ç¯‡"><a href="#5-å®æˆ˜ç¯‡" class="headerlink" title="5. å®æˆ˜ç¯‡"></a>5. å®æˆ˜ç¯‡</h2><ul>
<li>HTTPie<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="åè¯è§£é‡Š"><a href="#åè¯è§£é‡Š" class="headerlink" title="åè¯è§£é‡Š"></a>åè¯è§£é‡Š</h2><blockquote>
<p>å­¦ä¹ è¿‡ç¨‹å°±åƒã€Šä¸­åº¸ã€‹é‡Œè°ˆæ²»å­¦çš„æ–¹æ³•ï¼šåšå­¦ä¹‹ã€å®¡é—®ä¹‹ã€æ…æ€ä¹‹ã€æ˜è¾¨ä¹‹ã€ç¬ƒ(du)è¡Œä¹‹<br>ç®—æ³•+æ•°æ®ç»“æ„=ç¨‹åº, Pascalä¹‹çˆ¶,å›¾çµå¥–å¾—ä¸»Niklaus Wirth</p>
</blockquote>
<ul>
<li>Paradigm Shift : æ€ç»´è½¬æ¢</li>
<li>Stack Overflow: æ ˆæº¢å‡º</li>
<li>heap out of bounds: å †è¶Šç•Œ</li>
<li>use after free : å †ä¸Šçš„å†…å­˜è¢«é‡Šæ”¾ï¼Œä½†æ ˆä¸ŠæŒ‡å‘å †ä¸Šå†…å­˜çš„å“åº”æŒ‡é’ˆæ²¡æœ‰è¢«æ¸…ç©º</li>
<li>Tracing GC : è¿½è¸ªå¼åƒåœ¾å›æ”¶(é€šè¿‡å®šæœŸæ ‡è®°markæ‰¾å‡ºä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡ï¼Œç„¶åå°†å…¶æ¸…ç†sweepæ‰ï¼Œæ¥è‡ªåŠ¨ç®¡ç†å†…å­˜)</li>
<li>Automatic Reference Counting: è‡ªåŠ¨å¼•ç”¨è®¡æ•° (ç¼–è¯‘æ—¶ï¼Œä¸ºæ¯ä¸ªå‡½æ•°æ’å…¥retain/releaseè¯­å¥æ¥è‡ªåŠ¨ç»´æŠ¤å †ä¸Šå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼Œå½“å¼•ç”¨è®¡æ•°ä¸ºé›¶çš„æ—¶å€™ï¼Œreleaseè¯­å¥å°±é‡Šæ”¾å¯¹è±¡)</li>
<li>throughput: ååé‡</li>
<li>syntactic sugar: è¯­æ³•ç³–</li>
<li>Principle of Least Privilege: æœ€å°æƒé™åŸåˆ™</li>
<li>derive macro : æ´¾ç”Ÿå®</li>
</ul>
<h2 id="é˜…è¯»èµ„æ–™"><a href="#é˜…è¯»èµ„æ–™" class="headerlink" title="é˜…è¯»èµ„æ–™"></a>é˜…è¯»èµ„æ–™</h2><ul>
<li><a href="https://github.com/chyidl/begin-rust.git">begin-rust</a></li>
<li><a href="https://doc.rust-lang.org/book/">The Rust Programming Language</a></li>
</ul>
]]></content>
      <categories>
        <category>Programming Language</category>
      </categories>
  </entry>
  <entry>
    <title>Kubernetes Intro</title>
    <url>/2021/09/19/Kubernetes-Intro/</url>
    <content><![CDATA[<h1 id="Kubernetes"><a href="#Kubernetes" class="headerlink" title="Kubernetes"></a>Kubernetes</h1><span id="more"></span>

<h2 id="å®¹å™¨åŸºç¡€"><a href="#å®¹å™¨åŸºç¡€" class="headerlink" title="å®¹å™¨åŸºç¡€"></a>å®¹å™¨åŸºç¡€</h2><blockquote>
<p>å®¹å™¨æŠ€æœ¯çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå°±æ˜¯é€šè¿‡çº¦æŸå’Œä¿®æ”¹è¿›ç¨‹çš„åŠ¨æ€è¡¨ç°ï¼Œä»è€Œä¸ºå…¶åˆ›å»ºå‡ºä¸€ä¸ªâ€œè¾¹ç•Œâ€<br>å®¹å™¨ï¼Œå…¶å®æ˜¯ä¸€ç§ç‰¹æ®Šçš„å•è¿›ç¨‹æ¨¡å‹è€Œå·²<br>åŒä¸€å°æœºå™¨ä¸Šçš„æ‰€æœ‰å®¹å™¨ï¼Œéƒ½å…±äº«å®¿ä¸»æœºæ“ä½œç³»ç»Ÿçš„å†…æ ¸</p>
</blockquote>
  <figure class="highlight perl"><table><tr><td class="code"><pre><code class="hljs perl"><span class="hljs-comment"># CgroupsæŠ€æœ¯ç”¨æ¥é™åˆ¶</span><br><span class="hljs-comment"># NamespaceæŠ€æœ¯åˆ™æ˜¯ç”¨éš”ç¦»</span><br>  - Mount Namespace è·Ÿå…¶ä»–Namespaceä½¿ç”¨ç•¥æœ‰ä¸åŒï¼Œå®ƒå¯¹å®¹å™¨è¿›ç¨‹è§†å›¾çš„æ”¹å˜ä¸€å®šæ˜¯ä¼´éšç€æŒ‚è½½æ“ä½œmountæ‰èƒ½ç”Ÿæ•ˆ<br>  - <span class="hljs-keyword">chroot</span> (change root file <span class="hljs-keyword">system</span>): æ”¹å˜è¿›ç¨‹çš„æ ¹ç›®å½•åˆ°æŒ‡å®šä½ç½®<br><span class="hljs-comment"># rootfs æ ¹æ–‡ä»¶ç³»ç»Ÿ (ä¸åŒ…æ‹¬ç³»ç»Ÿå†…æ ¸)</span><br>  &gt; ç”±äºrootfsé‡Œæ‰“åŒ…çš„ä¸åªæ˜¯åº”ç”¨ï¼Œè€Œæ˜¯æ•´ä¸ªæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶å’Œç›®å½• (å¯¹äºä¸€ä¸ªåº”ç”¨æ¥è¯´ï¼Œæ“ä½œç³»ç»Ÿæœ¬èº«æ‰æ˜¯å®ƒåœ†å½¢æ‰€éœ€è¦çš„æœ€å®Œæ•´çš„<span class="hljs-string">&quot;ä¾èµ–åº“&quot;</span>)<br>  - pivot_root<br>  - <span class="hljs-keyword">chroot</span><br></code></pre></td></tr></table></figure>
<ul>
<li><p>Cgroups</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># Linux Cgroupsæ˜¯Linuxå†…æ ¸ä¸­ç”¨æ¥ä¸ºè¿›ç¨‹è®¾ç½®èµ„æºé™åˆ¶çš„ä¸€ä¸ªé‡è¦åŠŸèƒ½</span><br><span class="hljs-comment"># Linux Cgroupså…¨ç§° Linux Control Group,ä¸»è¦ä½œç”¨å°±æ˜¯é™åˆ¶è¿›ç¨‹ç»„èƒ½å¤Ÿä½¿ç”¨çš„èµ„æºä¸Šé™ï¼ŒCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œå¸¦å®½</span><br><br>âœ mount -t cgroup<br>cgroup on <span class="hljs-regexp">/sys/</span>fs<span class="hljs-regexp">/cgroup/</span>systemd type cgroup (rw,nosuid,nodev,noexec,relatime,xattr,name=systemd)<br>cgroup on <span class="hljs-regexp">/sys/</span>fs<span class="hljs-regexp">/cgroup/</span>perf_event type cgroup (rw,nosuid,nodev,noexec,relatime,perf_event)<br>cgroup on <span class="hljs-regexp">/sys/</span>fs<span class="hljs-regexp">/cgroup/</span>cpu,cpuacct type cgroup (rw,nosuid,nodev,noexec,relatime,cpu,cpuacct)<br>cgroup on <span class="hljs-regexp">/sys/</span>fs<span class="hljs-regexp">/cgroup/</span>devices type cgroup (rw,nosuid,nodev,noexec,relatime,devices)<br>cgroup on <span class="hljs-regexp">/sys/</span>fs<span class="hljs-regexp">/cgroup/</span>net_cls,net_prio type cgroup (rw,nosuid,nodev,noexec,relatime,net_cls,net_prio)<br>cgroup on <span class="hljs-regexp">/sys/</span>fs<span class="hljs-regexp">/cgroup/</span>rdma type cgroup (rw,nosuid,nodev,noexec,relatime,rdma)<br>cgroup on <span class="hljs-regexp">/sys/</span>fs<span class="hljs-regexp">/cgroup/</span>blkio type cgroup (rw,nosuid,nodev,noexec,relatime,blkio)                        -- ä¸ºå—è®¾å¤‡è®¾ç½®I/Oé™åˆ¶ï¼Œä¸€èˆ¬ç”¨äºç£ç›˜ç­‰è®¾å¤‡<br>cgroup on <span class="hljs-regexp">/sys/</span>fs<span class="hljs-regexp">/cgroup/m</span>emory type cgroup (rw,nosuid,nodev,noexec,relatime,memory)                      -- ä¸ºè¿›ç¨‹è®¾ç½®å†…å­˜ä½¿ç”¨é™åˆ¶<br>cgroup on <span class="hljs-regexp">/sys/</span>fs<span class="hljs-regexp">/cgroup/</span>hugetlb type cgroup (rw,nosuid,nodev,noexec,relatime,hugetlb)<br>cgroup on <span class="hljs-regexp">/sys/</span>fs<span class="hljs-regexp">/cgroup/</span>cpuset type cgroup (rw,nosuid,nodev,noexec,relatime,cpuset)                      -- ä¸ºè¿›ç¨‹åˆ†é…å•ç‹¬çš„CPUæ ¸å’Œå¯¹åº”çš„å†…å­˜èŠ‚ç‚¹<br>cgroup on <span class="hljs-regexp">/sys/</span>fs<span class="hljs-regexp">/cgroup/</span>freezer type cgroup (rw,nosuid,nodev,noexec,relatime,freezer)<br>cgroup on <span class="hljs-regexp">/sys/</span>fs<span class="hljs-regexp">/cgroup/</span>pids type cgroup (rw,nosuid,nodev,noexec,relatime,pids)<br><br>âœ ls  <span class="hljs-regexp">/sys/</span>fs<span class="hljs-regexp">/cgroup/</span>cpu<br>cgroup.clone_children  cpuacct.usage             cpuacct.usage_percpu_user  cpu.cfs_quota_us  init.scope         system.slice<br>cgroup.procs           cpuacct.usage_all         cpuacct.usage_sys          cpu.shares        kubepods.slice     tasks<br>cgroup.sane_behavior   cpuacct.usage_percpu      cpuacct.usage_user         cpu.stat          notify_on_release  user.slice<br>cpuacct.stat           cpuacct.usage_percpu_sys  cpu.cfs_period_us          docker            release_agent<br></code></pre></td></tr></table></figure></li>
<li><p>Docker vs Hypervisor</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> ç”¨æˆ·è¿è¡Œåœ¨å®¹å™¨é‡Œçš„åº”ç”¨è¿›ç¨‹æ ¹å®¿ä¸»ä¸»æœºä¸Šçš„å…¶ä»–è¿›ç¨‹ä¸€æ ·ï¼Œéƒ½ç”±å®¿ä¸»ä¸»æœºæ“ä½œç³»ç»ŸåŒä¸€ç®¡ç†ï¼Œåªä¸è¿‡è¿™äº›è¢«éš”ç¦»çš„è¿›ç¨‹æ‹¥æœ‰é¢å¤–è®¾ç½®è¿‡çš„Namesapceå‚æ•°, è€ŒDockeré¡¹ç›®åœ¨è¿™é‡Œæ‰®æ¼”çš„è§’è‰²æ›´å¤šçš„æ˜¯æ—è·¯å¼çš„è¾…åŠ©å’Œç®¡ç†å·¥ä½œ<br><span class="hljs-bullet">2.</span> Hypervisorè™šæ‹ŸåŒ–ä½œä¸ºåº”ç”¨æ²™ç›’ï¼Œå¿…é¡»ç”±Hypervisorè´Ÿè´£åˆ›å»ºè™šæ‹Ÿæœºï¼Œè¿™ä¸ªè™šæ‹ŸæœºçœŸå®å­˜åœ¨ï¼Œå¹¶ä¸”è¿è¡Œå®Œæ•´çš„GuestOSæ‰èƒ½æ‰§è¡Œç”¨æˆ·çš„åº”ç”¨è¿›ç¨‹.<br></code></pre></td></tr></table></figure></li>
<li><p>å®¹å™¨åŒ–</p>
<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"> &gt; Dockerdå®é™…ä¸Šæ˜¯åœ¨åˆ›å»ºå®¹å™¨è¿›ç¨‹æ—¶ï¼ŒæŒ‡å®šè¿›ç¨‹æ‰€éœ€è¦å¯åŠ¨çš„ä¸€ç»„Namespaceå‚æ•°ï¼Œè¿™æ ·ï¼Œå®¹å™¨åªèƒ½â€œçœ‹â€åˆ°å½“å‰Namespaceæ‰€é™å®šçš„èµ„æºã€æ–‡ä»¶ã€è®¾å¤‡ã€çŠ¶æ€ã€æˆ–é…ç½®ï¼Œè€Œå¯¹äºå®¿ä¸»æœºä»¥åŠå…¶ä»–ä¸ç›¸å…³çš„ç¨‹åºï¼Œå°±å®Œå…¨çœ‹ä¸åˆ°<br><span class="hljs-meta">&gt;</span> <span class="javascript"><span class="hljs-string">&quot;æ•æ·&quot;</span>å’Œ<span class="hljs-string">&quot;é«˜æ€§èƒ½&quot;</span>æ˜¯å®¹å™¨ç›¸è¾ƒäºè™šæ‹Ÿæœºæœ€å¤§çš„ä¼˜åŠ¿ï¼Œä¹Ÿæ˜¯å®ƒèƒ½å¤Ÿåœ¨PaaSè¿™ç§æ›´ç»†ç²’åº¦çš„èµ„æºç®¡ç†å¹³å°ä¸Šå¤§è¡Œå…¶é“çš„é‡è¦åŸå› .</span><br><br>- å®¹å™¨å’Œåº”ç”¨çš„åŒç”Ÿå‘½å‘¨æœŸ<br></code></pre></td></tr></table></figure></li>
<li><p>Dockeré•œåƒ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> Dockeré•œåƒçš„è®¾è®¡ä¸­å¼•å…¥å±‚layer,ç”¨æˆ·åˆ¶ä½œé•œåƒçš„æ¯ä¸€æ­¥æ“ä½œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªå±‚ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå¢é‡rootfs</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> Union File System è”åˆæ–‡ä»¶ç³»ç»Ÿ</span><br><span class="hljs-meta">  &gt;</span><span class="bash"> å°†å¤šä¸ªä¸åŒä½ç½®çš„ç›®å½•è”åˆæŒ‚åœ¨(Union mount)åˆ°åŒä¸€ä¸ªç›®å½•ä¸‹</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> overlay2</span><br><span class="hljs-meta">  &gt;</span><span class="bash"> overlay2, <span class="hljs-built_in">which</span> has potential performance advantages over the aufs storage driver.</span><br></code></pre></td></tr></table></figure></li>
<li><p>å®¹å™¨</p>
<blockquote>
<p>æ˜¯ç”±Linux Namespaceã€Linux Cgroupså’Œrootfsç¬¬ä¸‰ç§æŠ€æœ¯æ„å»ºå‡ºæ¥çš„è¿›ç¨‹éš”ç¦»ç¯å¢ƒ</p>
</blockquote>
</li>
<li><p>Linuxå®¹å™¨</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><code class="hljs vala"><span class="hljs-meta"># å®¹å™¨é•œåƒ - é™æ€è§†å›¾</span><br>  &gt; ä¸€ç»„è”åˆrootfs<br><br><span class="hljs-meta"># å®¹å™¨è¿è¡Œæ—¶ - åŠ¨æ€è§†å›¾</span><br>  &gt; ä¸€ç»„Namespace + Cgroups æ„æˆçš„éš”ç¦»ç¯å¢ƒ<br><br><span class="hljs-meta"># å®¹å™¨ç¼–æ’å·¥å…·:</span><br>  - Docker: Compose+Swarm<br>  - Google+ReadHat: Kubernetes<br></code></pre></td></tr></table></figure></li>
<li><p>Kuberneteså…¨å±€æ¶æ„<br><img src="/misc/images/kubernetes-global-articture.png" alt="Kubernetes å…¨å±€æ¶æ„"></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">-</span> Master(æ§åˆ¶èŠ‚ç‚¹):<br>  &gt; å¦‚ä½•ç¼–æ’ã€ç®¡ç†ã€è°ƒåº¦ç”¨æˆ·æäº¤çš„ä½œä¸š<br><span class="hljs-bullet">  -</span> kube-controller-manager: Controller Manager<br><span class="hljs-bullet">  -</span> kube-apiserver: API Server (æ•´ä¸ªé›†ç¾¤çš„æŒä¹…åŒ–æ•°æ®ç”±kube-apiserverå¤„ç†åä¿å­˜åœ¨Etcdä¸­)<br><span class="hljs-bullet">  -</span> kube-scheduler: Scheduler<br><br><span class="hljs-bullet">-</span> Node(è®¡ç®—èŠ‚ç‚¹):<br><span class="hljs-bullet">  -</span> kubelet: kubeletä¸»è¦è´£ä»»åŒå®¹å™¨è¿è¡Œæ—¶(docker)äº¤äº’<br><span class="hljs-bullet">  -</span> CNI : kubelet + Networking - ç½‘ç»œæ’ä»¶ä¸ºå®¹å™¨é…ç½®ç½‘ç»œ<br><span class="hljs-bullet">  -</span> CRI : kubectl + Container Runtime Interface (æ¥å£å®šä¹‰å®¹å™¨è¿è¡Œæ—¶çš„å„é¡¹æ ¸å¿ƒæ“ä½œ)<br><span class="hljs-bullet">  -</span> CSI : kubectl + Volume Plugin - å­˜å‚¨æ’ä»¶ä¸ºå®¹å™¨æŒä¹…åŒ–å­˜å‚¨<br><span class="hljs-bullet">  -</span> OCI : Container Runtime Interface (å®¹å™¨è¿è¡Œæ—¶è§„èŒƒåŒåº•å±‚Linuxæ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’, å³å°†CRIè¯·æ±‚ç¿»è¯‘æˆLinuxç³»ç»Ÿæ“ä½œè°ƒç”¨ Namespace + Cgroups)<br><span class="hljs-bullet">  -</span> grpc: kubelet + Device Plugin (Kubernetesé¡¹ç›®ç®¡ç†å®¿ä¸»ä¸»æœºç‰©ç†è®¾å¤‡çš„ä¸»è¦ç»„ä»¶)<br><br><span class="hljs-quote">&gt; Kubernetesé¡¹ç›®å…³å¿ƒè§£å†³çš„é—®é¢˜æ˜¯&quot;è¿è¡Œåœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸­çš„å„ç§ä»»åŠ¡ä¹‹é—´ï¼Œå®é™…ä¸Šå­˜åœ¨ç€å„ç§å„æ ·çš„å…³ç³»ï¼Œè¿™äº›å…³ç³»çš„å¤„ç†ï¼Œæ‰æ˜¯ä½œä¸šç¼–æ’å’Œç®¡ç†ç³»ç»Ÿæœ€å›°éš¾çš„åœ°æ–¹&quot;</span><br></code></pre></td></tr></table></figure></li>
<li><p>Kubernetes æ ¸å¿ƒåŠŸèƒ½<br><img src="/misc/images/kubernetes-pod-road-map.png" alt="Kubernetes æ ¸å¿ƒåŠŸèƒ½"></p>
<figure class="highlight vala"><table><tr><td class="code"><pre><code class="hljs vala">&gt; Kubernetesé¡¹ç›®çš„æœ¬è´¨æ˜¯ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªå…·æœ‰æ™®éæ„ä¹‰çš„å®¹å™¨ç¼–æ’å·¥å…·<br><br><span class="hljs-meta"># Pod:</span><br>  &gt; Podé‡Œçš„å®¹å™¨å…±äº«åŒä¸€ä¸ªNetwork Namespace,åŒä¸€ç»„æ•°æ®å·ï¼Œä»è€Œè¾¾åˆ°é«˜æ•ˆäº¤æ¢ä¿¡æ¯çš„ç›®çš„<br>  &gt; Podå°±æ˜¯Kubenetesä¸–ç•Œé‡Œçš„<span class="hljs-string">&quot;åº”ç”¨&quot;</span>,è€Œä¸€ä¸ªåº”ç”¨ï¼Œå¯ä»¥ç”±å¤šä¸ªå®¹å™¨ç»„æˆ<br><br><span class="hljs-meta"># Service:</span><br>  &gt; ServiceæœåŠ¡ä½œä¸ºPodä»£ç†å…¥å£(Portal)ä»è€Œä»£æ›¿Podå¯¹å¤–æš´éœ²ä¸€ä¸ªå›ºå®šçš„ç½‘ç»œåœ°å€<br><br><span class="hljs-meta"># Deployment:</span><br>  &gt; Podå¤šå®ä¾‹ç®¡ç†å™¨<br><br><span class="hljs-meta"># Secret:</span><br>  &gt; Secretå¯¹è±¡æ˜¯ä¿å­˜åœ¨Etcdé‡Œçš„é”®å€¼å¯¹æ•°æ®<br><br><span class="hljs-meta"># Job:</span><br>  &gt; æè¿°ä¸€æ¬¡æ€§è¿è¡ŒPod<br><br><span class="hljs-meta"># CronJob:</span><br>  &gt; æè¿°å®šæ—¶ä»»åŠ¡<br><br><span class="hljs-meta"># DaemonSet:</span><br>  &gt; æè¿°æ¯ä¸ªå®¿ä¸»æœºä¸Šå¿…é¡»ä¸”åªèƒ½è¿è¡Œä¸€ä¸ªå‰¯æœ¬çš„å®ˆæŠ¤è¿›ç¨‹æœåŠ¡<br><br><br><span class="hljs-meta"># ç¼–æ’å¯¹è±¡ - æè¿°ç®¡ç†çš„åº”ç”¨</span><br>  - Pod<br>  - Job<br>  - CronJob<br><br><span class="hljs-meta"># æœåŠ¡å¯¹è±¡ - è´Ÿè´£å¹³å°çº§åŠŸèƒ½</span><br>  - Service<br>  - Secret<br>  - Horizontal Pod Autoscaler(è‡ªåŠ¨æ°´å¹³æ‰©å±•å™¨)<br><br><span class="hljs-meta"># å£°æ˜å¼API</span><br>  &gt; è¿™ç§APIå¯¹åº”çš„<span class="hljs-string">&quot;ç¼–æ’å¯¹è±¡&quot;</span>å’Œ<span class="hljs-string">&quot;æœåŠ¡å¯¹è±¡&quot;</span>éƒ½æ˜¯Kubernetesé¡¹ç›®ä¸­çš„APIå¯¹è±¡(API <span class="hljs-built_in">Object</span>)<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Kubernetes-æ¦‚å¿µ"><a href="#Kubernetes-æ¦‚å¿µ" class="headerlink" title="Kubernetes æ¦‚å¿µ"></a>Kubernetes æ¦‚å¿µ</h2><ul>
<li>æ¦‚è¿°<ul>
<li>Kubernetesæ˜¯ä»€ä¹ˆ<br><img src="/misc/images/container_evolution.svg" alt="å®¹å™¨æ¼”è¿›è¿‡ç¨‹"><figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-quote">&gt; Kubernetes æ˜¯ä¸€ä¸ªå¯ç§»æ¤çš„ï¼Œå¯æ‰©å±•çš„å¼€æºå¹³å°ï¼Œç”¨äºç®¡ç†å®¹å™¨åŒ–çš„å·¥ä½œè´Ÿè½½å’ŒæœåŠ¡ï¼Œå¯ä¿ƒè¿›å£°æ˜å¼é…ç½®å’Œè‡ªåŠ¨åŒ–.</span><br><span class="hljs-quote">&gt; Kubernetesæºäºå¸Œè…Šè¯­,æ„ä¸º&quot;èˆµæ‰‹&quot;æˆ–&quot;é£è¡Œå‘˜&quot;</span><br><span class="hljs-quote">&gt; Kuberneteså»ºç«‹åœ¨Googleåœ¨å¤§è§„æ¨¡è¿è¡Œç”Ÿäº§å·¥ä½œè´Ÿè½½æ–¹é¢æ‹¥æœ‰åå‡ å¹´çš„ç»éªŒçš„åŸºç¡€ä¸Šï¼Œç»“åˆç¤¾åŒºä¸­æœ€å¥½çš„æƒ³æ³•å’Œå®è·µ.</span><br><br><span class="hljs-section"># ä¼ ç»Ÿéƒ¨ç½²æ—¶ä»£:</span><br><span class="hljs-bullet">  -</span> èµ„æºåˆ†é…é—®é¢˜<br><br><span class="hljs-section"># è™šæ‹ŸåŒ–éƒ¨ç½²æ—¶ä»£:</span><br><span class="hljs-bullet">  -</span> è™šæ‹ŸåŒ–æŠ€æœ¯å…è®¸åœ¨å•ä¸ªç‰©ç†æœåŠ¡å™¨çš„CPUä¸Šè¿è¡Œå¤šä¸ªè™šæ‹ŸæœºVM,è™šæ‹ŸåŒ–å…è®¸åº”ç”¨ç¨‹åºåœ¨VMä¹‹é—´éš”ç¦»,å¹¶æä¾›ä¸€å®šæˆéƒ½çš„å®‰å…¨ï¼Œå› ä¸ºä¸€ä¸ªåº”ç”¨ç¨‹åºçš„ä¿¡æ¯ä¸èƒ½è¢«å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºéšæ„è®¿é—®<br><span class="hljs-bullet">  -</span> è™šæ‹ŸåŒ–æŠ€æœ¯èƒ½å¤Ÿæ›´å¥½çš„åˆ©ç”¨ç‰©ç†æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼Œå› ä¸ºå¯è½»æ¾åœ°æ·»åŠ æˆ–æ›´æ–°åº”ç”¨ç¨‹åºè€Œå¯ä»¥å®ç°æ›´å¥½çš„å¯ä¼¸ç¼©æ€§ï¼Œé™ä½ç¡¬ä»¶æˆæœ¬<br><span class="hljs-bullet">  -</span> æ¯ä¸€ä¸ªVMæ˜¯ä¸€å°å®Œæ•´çš„è®¡ç®—æœºï¼Œåœ¨è™šæ‹ŸåŒ–ç¡¬ä»¶ä¹‹ä¸Šè¿è¡Œæ‰€æœ‰ç»„ä»¶ï¼ŒåŒ…æ‹¬å…¶è‡ªå·±çš„æ“ä½œç³»ç»Ÿ<br><br><span class="hljs-section"># å®¹å™¨éƒ¨ç½²æ—¶ä»£:</span><br><span class="hljs-bullet">  -</span> å®¹å™¨ç±»ä¼¼äºVMï¼Œä½†æ˜¯å…·æœ‰è¢«æ”¾å®½çš„éš”ç¦»å±æ€§ï¼Œå¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¹‹é—´å…±äº«æ“ä½œç³»ç»ŸOS<br><span class="hljs-bullet">  -</span> å®¹å™¨ä¸VMå…·æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€CPUã€å†…å­˜ã€è¿›ç¨‹ç©ºé—´<br><span class="hljs-bullet">  -</span> å®¹å™¨çš„å¥½å¤„:<br><span class="hljs-bullet">    -</span> æ•æ·åº”ç”¨ç¨‹åºçš„åˆ›å»ºå’Œéƒ¨ç½²: ä¸ä½¿ç”¨VMé•œåƒç›¸æ¯”ï¼Œæé«˜å®¹å™¨é•œåƒåˆ›å»ºçš„ä¾¿æ·æ€§å’Œæ•ˆç‡<br><span class="hljs-bullet">    -</span> æŒç»­å¼€å‘ã€é›†æˆå’Œéƒ¨ç½²: é€šè¿‡å¿«é€Ÿç®€å•çš„å›æ»š(ç”±äºé•œåƒä¸å¯å˜æ€§)ï¼Œæ”¯æŒå¯é ä¸”é¢‘ç¹çš„å®¹å™¨é•œåƒæ„å»ºå’Œéƒ¨ç½²<br><span class="hljs-bullet">    -</span> å¼€å‘ä¸è¿ç»´çš„åˆ†ç¦»: åœ¨æ„å»º/å‘å¸ƒæ—¶è€Œä¸æ˜¯åœ¨éƒ¨ç½²æ—¶åˆ›å»ºåº”ç”¨ç¨‹åºå®¹å™¨é•œåƒ,ä»è€Œå°†åº”ç”¨ç¨‹åºäºåŸºç¡€æ¶æ„åˆ†ç¦»<br><span class="hljs-bullet">    -</span> å¯è§‚å¯Ÿæ€§: æ˜¾ç¤ºæ“ä½œç³»ç»Ÿçº§åˆ«çš„ä¿¡æ¯å’ŒæŒ‡æ ‡ï¼Œæ˜¾ç¤ºåº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶æ€å’Œå…¶ä»–æŒ‡æ ‡ä¿¡å·<br><span class="hljs-bullet">    -</span> è·¨å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§çš„ç¯å¢ƒä¸€è‡´æ€§: åœ¨ä¾¿æºè®¡ç®—æœºä¸Šä¸äº‘ä¸­ç›¸åŒåœ°è¿è¡Œ<br><span class="hljs-bullet">    -</span> è·¨äº‘å’Œæ“ä½œç³»ç»Ÿå‘å‹ç‰ˆæœ¬çš„å¯ç§»æ¤æ€§: å¯åœ¨Ubuntu,RHEL,CoreOS,æœ¬åœ°<br><span class="hljs-bullet">    -</span> ä»¥åº”ç”¨ç¨‹åºä¸ºä¸­å¿ƒçš„ç®¡ç†: æé«˜æŠ½è±¡çº§åˆ«ï¼Œä»åœ¨è™šæ‹Ÿç¡¬ä»¶ä¸Šè¿è¡ŒOSåˆ°ä½¿ç”¨é€»è¾‘èµ„æºåœ¨OSä¸Šè¿è¡Œåº”ç”¨ç¨‹åº<br><span class="hljs-bullet">    -</span> æ¾æ•£è€¦åˆã€åˆ†å¸ƒå¼ã€å¼¹æ€§ã€è§£æ”¾çš„å¾®æœåŠ¡: åº”ç”¨ç¨‹åºè¢«åˆ†è§£æˆè¾ƒå°çš„ç‹¬ç«‹éƒ¨åˆ†ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€éƒ¨ç½²å’Œç®¡ç†-è€Œä¸æ˜¯åœ¨ä¸€å°å¤§å‹å•æœºä¸Šæ•´ä½“è¿è¡Œ<br><span class="hljs-bullet">    -</span> èµ„æºéš”ç¦»: å¯é¢„æµ‹çš„åº”ç”¨ç¨‹åºæ€§èƒ½<br><span class="hljs-bullet">    -</span> èµ„æºåˆ©ç”¨: é«˜æ•ˆç‡å’Œé«˜å¯†åº¦<br><br><span class="hljs-section"># Kubernetes æä¾›åŠŸèƒ½:</span><br><span class="hljs-bullet">  -</span> æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡<br><span class="hljs-bullet">  -</span> å­˜å‚¨ç¼–æ’<br><span class="hljs-bullet">  -</span> è‡ªåŠ¨éƒ¨ç½²å’Œå›æ»š:<br><span class="hljs-bullet">  -</span> è‡ªåŠ¨å®Œæˆè£…ç®±è®¡ç®—:<br><span class="hljs-code">    &gt; Kubernetes å…è®¸æŒ‡å®šæ¯ä¸ªå®¹å™¨æ‰€éœ€CPUå’Œå†…å­˜RAM å½“å®¹å™¨æŒ‡å®šèµ„æºè¯·æ±‚æ—¶ï¼ŒKuberneteså¯ä»¥åšå‡ºæ›´å¥½çš„å†³ç­–æ¥ç®¡ç†å®¹å™¨èµ„æº</span><br><span class="hljs-code">  - è‡ªæˆ‘ä¿®å¤</span><br><span class="hljs-code">  - å¯†é’¥ä¸é…ç½®ç®¡ç†:</span><br><span class="hljs-code">    &gt; Kuberneteså­˜å‚¨å’Œç®¡ç†æ•æ„Ÿä¿¡æ¯</span><br><span class="hljs-code"></span><br><span class="hljs-section"># Kubernetes ä¸æä¾›:</span><br><span class="hljs-bullet">  -</span> ä¸é™åˆ¶æ”¯æŒçš„åº”ç”¨ç¨‹åºç±»å‹: Kubernetesæ”¯æŒåŠå…¶å¤šç§å¤šæ ·çš„å·¥ä½œè´Ÿè½½ï¼ŒåŒ…æ‹¬æ— çŠ¶æ€ã€æœ‰çŠ¶æ€å’Œæ•°æ®å¤„ç†å·¥ä½œè´Ÿè½½ã€‚å¦‚æœåº”ç”¨ç¨‹åºå¯ä»¥åœ¨å®¹å™¨ä¸­è¿è¡Œï¼Œé‚£ä¹ˆä»–åº”è¯¥å¯ä»¥åœ¨Kubernetesä¸Šå¾ˆå¥½çš„è¿è¡Œ.<br><span class="hljs-bullet">  -</span> ä¸éƒ¨ç½²æºä»£ç ï¼Œä¹Ÿä¸æ„å»ºåº”ç”¨: æŒç»­é›†æˆCIã€äº¤ä»˜å’Œéƒ¨ç½²CI/CDå·¥ä½œæµ<br><span class="hljs-bullet">  -</span> ä¸æä¾›åº”ç”¨ç¨‹åºçº§åˆ«çš„æœåŠ¡ä½œä¸ºå†…ç½®æœåŠ¡<br><span class="hljs-bullet">  -</span> ä¸æä¾›æ—¥å¿—è®°å½•ã€ç›‘æ§æˆ–æŠ¥è­¦è§£å†³æ–¹æ¡ˆ: æä¾›ä¸€äº›é›†æˆä½œä¸ºæ¦‚å¿µè¯æ˜å¹¶æä¾›æ”¶é›†å’Œåˆ°å¤„æŒ‡æ ‡çš„æœºåˆ¶<br><span class="hljs-bullet">  -</span> ä¸æä¾›ä¸é‡‡ç”¨ä»»ä½•å…¨é¢çš„æœºå™¨é…ç½®ã€ç»´æŠ¤ã€ç®¡ç†æˆ–è‡ªæˆ‘ä¿®å¤ç³»ç»Ÿ<br><br><span class="hljs-quote">&gt; Kubernetes ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç¼–æ’ç³»ç»Ÿï¼Œå®é™…ä¸Šæ¶ˆé™¤äº†ç¼–æ’çš„éœ€è¦ï¼Œç¼–æ’çš„æŠ€æœ¯å®šä¹‰æ˜¯æ‰§è¡Œå·²å®šä¹‰çš„å·¥ä½œæµç¨‹ï¼Œé¦–å…ˆæ‰§è¡ŒAï¼Œç„¶åæ‰§è¡ŒBï¼Œåœ¨æ‰§è¡ŒCï¼ŒKubernetesåŒ…å«ä¸€ç»„ç‹¬ç«‹çš„ï¼Œå¯ç»„åˆçš„æ§åˆ¶è¿‡ç¨‹ï¼Œè¿™äº›è¿‡ç¨‹è”ç³»åœ°å°†å½“å‰çŠ¶æ€é©±åŠ¨åˆ°æ‰€æä¾›çŠ¶æ€ï¼Œå¦‚ä½•ä»Aåˆ°Cçš„æ–¹å¼æ— å…³ç´§è¦ï¼Œä¹Ÿä¸éœ€è¦å‡ ç§æ§åˆ¶ï¼Œä½¿å¾—ç³»ç»Ÿæ›´æ˜“äºä½¿ç”¨ä¸”åŠŸèƒ½æ›´å¼ºå¤§ã€ç³»ç»Ÿæ›´å¥å£®ã€æ›´ä¸ºå¼¹æ€§å’Œæ‰©å±•æ€§.</span><br></code></pre></td></tr></table></figure></li>
<li>Kubernetes ç»„ä»¶<br><img src="/misc/images/components-of-kubernetes.svg" alt="Kuberneteså…³è”ç»„ä»¶"><figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># Control Plane Compoenents æ§åˆ¶å¹³é¢ç»„ä»¶</span><br>  &gt; æ§åˆ¶å¹³é¢ç»„ä»¶å¯¹é›†ç¾¤åšå‡ºå…¨å±€å†³ç­–(è°ƒåº¦),ä»¥åŠæ£€æµ‹å’Œå“åº”é›†ç¾¤äº‹ä»¶<br>  &gt; æ§åˆ¶å¹³é¢ç»„ä»¶å¯ä»¥åœ¨é›†ç¾¤ä¸­çš„ä»»ä½•èŠ‚ç‚¹ä¸Šè¿è¡Œ<br><br><span class="hljs-bullet">  -</span> kube-apiserver:<br><span class="hljs-code">    &gt; è¯¥ç»„ä»¶å…¬å¼€Kubernetes API, APIæœåŠ¡å™¨æ˜¯Kubernetesæ§åˆ¶é¢çš„å‰ç«¯</span><br><span class="hljs-code">    &gt; è¿è¡Œkube-apiserverå¤šä¸ªå®ä¾‹å¹¶åœ¨è¿™äº›å®ä¾‹ä¹‹é—´å¹³è¡¡æµé‡</span><br><span class="hljs-code"></span><br><span class="hljs-bullet">  -</span> etcd:<br><span class="hljs-code">    &gt; etcd æ˜¯å…¼é¡¾ä¸€è‡´æ€§å’Œé«˜å¯ç”¨æ€§çš„é”®å€¼æ•°æ®åº“,ä½œä¸ºä¿å­˜Kubernetesæ‰€æœ‰é›†ç¾¤æ•°æ®çš„åå°æ•°æ®åº“</span><br></code></pre></td></tr></table></figure></li>
<li>PVã€PVCã€StorageClass<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># Kubernetes å®¹å™¨æŒä¹…åŒ–å­˜å‚¨</span><br><span class="hljs-bullet">  -</span> PV: æŒä¹…åŒ–å­˜å‚¨çš„å®ç°<br><span class="hljs-code">    &gt; æŒä¹…åŒ–å­˜å‚¨æ•°æ®å·,å®šä¹‰çš„æ˜¯ä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨åœ¨å®¿ä¸»ä¸»æœºä¸Šçš„ç›®å½•</span><br><span class="hljs-code"></span><br><span class="hljs-bullet">  -</span> PVC: æŒä¹…åŒ–å­˜å‚¨çš„æ¥å£<br><span class="hljs-code">    &gt; æè¿°çš„æŒä¹…åŒ–å­˜å‚¨çš„å±æ€§ (Volumeå­˜å‚¨å¤§å°,å¯è¯»å†™æƒé™)</span><br><span class="hljs-code">    &gt; PVCå¿…é¡»å’ŒæŸä¸ªç¬¦åˆæ¡ä»¶çš„PVè¿›è¡Œç»‘å®š</span><br><span class="hljs-code">      - 1. PV å’Œ PVC çš„specå­—æ®µ, PVçš„å­˜å‚¨(storage)å¤§å°,å¿…é¡»æ»¡è¶³PVCçš„è¦æ±‚</span><br><span class="hljs-code">      - 2. PV å’Œ PVC çš„storageClassNameå­—æ®µå¿…é¡»ä¸€æ ·</span><br><span class="hljs-code"></span><br><span class="hljs-bullet">  -</span> Volume Controller: æŒä¹…åŒ–å­˜å‚¨æ§åˆ¶å™¨<br><span class="hljs-bullet">    -</span> PersistentVolumeController:<br><span class="hljs-code">      &gt; ä¸æ–­æŸ¥çœ‹å½“å‰æ¯ä¸€ä¸ªPVCæ˜¯å¦å·²ç»å¤„äºBoundçŠ¶æ€,å¦‚æœä¸æ˜¯ï¼Œå°±ä¼šéå†æ‰€æœ‰çš„ã€å¯ç”¨çš„PV,å°è¯•å°†å…¶PVCè¿›è¡Œç»‘å®š</span><br><span class="hljs-code"></span><br><span class="hljs-section"># æŒä¹…åŒ–Volume</span><br><span class="hljs-bullet">  -</span> è¿œç¨‹æ–‡ä»¶å­˜å‚¨<br><span class="hljs-bullet">    -</span> NFS<br><span class="hljs-bullet">    -</span> GlusterFS<br><span class="hljs-bullet">  -</span> è¿œç¨‹å¿«å­˜å‚¨<br><span class="hljs-bullet">    -</span> å…¬æœ‰äº‘æä¾›çš„è¿œç¨‹ç£ç›˜<br><br><span class="hljs-section"># å‡†å¤‡&quot;æŒä¹…åŒ–&quot;å®¿ä¸»æœºç›®å½•</span><br><span class="hljs-bullet">  -</span> ç¬¬ä¸€é˜¶æ®µ (Attch) -- nodeName<br><span class="hljs-code">    &gt; é»˜è®¤æƒ…å†µä¸‹ï¼Œkubelet ä¸º Volumeåˆ›å»ºçš„ç›®å½•æ˜¯ /var/lib/kubelet/pods/&lt;Podçš„ID&gt;/volumes/kubernetes.io-&lt;Volumeç±»å‹&gt;/&lt;Volumeåå­—&gt;</span><br><span class="hljs-code">    &gt; AttachDetachController (è¿è¡Œåœ¨MasterèŠ‚ç‚¹ä¸Š)</span><br><span class="hljs-code"></span><br><span class="hljs-bullet">  -</span> ç¬¬äºŒé˜¶æ®µ (Mount) -- dir<br><span class="hljs-code">    &gt; æ ¼å¼åŒ–ç£ç›˜è®¾å¤‡,ç„¶åå°†å…¶æŒ‚åœ¨åˆ°å®¿ä¸»æœºæŒ‡å®šçš„æŒ‚è½½ç‚¹ä¸Š</span><br><span class="hljs-code">    &gt; VolumeManagerReconciler (è¿è¡Œåœ¨NodeèŠ‚ç‚¹ä¸Š,æ˜¯ä¸€ä¸ªç‹¬ç«‹äºkubeletä¸»å¾ªç¯çš„goroutine)</span><br><span class="hljs-code"></span><br><span class="hljs-section"># StorageClass:</span><br>  &gt; Kubernetes æä¾›ä¸€å¥—å¯ä»¥è‡ªåŠ¨åˆ›å»ºPVçš„æœºåˆ¶ï¼ŒDynamic Provisioning<br>  &gt; æ‰‹åŠ¨åˆ›å»ºPVçš„æ–¹å¼å«åš Staic Provisioning<br>  &gt; StorageClassçš„ä½œç”¨å°±æ˜¯åˆ›å»ºPVçš„æ¨¡æ¿<br><span class="hljs-bullet">  -</span> 1. PVçš„å±æ€§ (å­˜å‚¨ç±»å‹ã€Volumeå¤§å°)<br><span class="hljs-bullet">  -</span> 2. åˆ›å»ºPVéœ€è¦ç”¨åˆ°çš„å­˜å‚¨æ’ä»¶(Ceph, NFS)<br>  &gt; Kubernetesæ ¹æ®ç”¨æˆ·æäº¤çš„PVCï¼Œæ‰¾åˆ°å¯¹åº”çš„StorageClass,ç„¶åè°ƒç”¨è¯¥StorageClasså£°æ˜çš„å­˜å‚¨æ’ä»¶ï¼Œåˆ›å»ºå‡ºéœ€è¦çš„PV<br></code></pre></td></tr></table></figure>
<img src="/misc/images/kubernetes-storageclass.png" alt="StorageClass æµç¨‹"><ul>
<li><a href="https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner">æ­å»ºStorageClass + NFS</a><figure class="highlight routeros"><table><tr><td class="code"><pre><code class="hljs routeros">1. åˆ›å»ºä¸€ä¸ªå¯ç”¨çš„NFS<span class="hljs-built_in"> Server</span><br><span class="hljs-built_in"></span>  IP: 172.30.1.14<br>  <span class="hljs-builtin-name">Export</span> PATH: /export/K8sData/<br><br>  $ sudo apt-<span class="hljs-builtin-name">get</span> install nfs-common cifs-utils<br><br>2. åˆ›å»ºService Account. ç®¡æ§NFS Provisioneråœ¨K8sé›†ç¾¤ä¸­è¿è¡Œçš„æƒé™<br><br>3. åˆ›å»ºStorageClass.è´Ÿè´£å»ºç«‹PVCå¹¶è°ƒç”¨NFS provisionerè¿›è¡Œé¢„å®šçš„å·¥ä½œï¼Œå¹¶è®©PVä¸PVCå»ºç«‹ç®¡ç†<br>4. åˆ›å»ºNFS Provisioner,åœ¨NFSå…±äº«ç›®å½•ä¸‹åˆ›å»ºæŒ‚è½½ç‚¹(volume),å»ºç«‹PVå¹¶å°†PVä¸NFSçš„æŒ‚åœ¨ç‚¹å»ºç«‹å…³è”<br><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="éƒ¨ç½²Kubernetes"><a href="#éƒ¨ç½²Kubernetes" class="headerlink" title="éƒ¨ç½²Kubernetes"></a>éƒ¨ç½²Kubernetes</h2><ul>
<li><p>kubeadm</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># åˆ›å»ºä¸€ä¸ªMasterèŠ‚ç‚¹</span><br>$ kubeadm init<br><br><span class="hljs-section"># å°†ä¸€ä¸ªNodeèŠ‚ç‚¹åŠ å…¥å½“å‰é›†ç¾¤</span><br>$ kubeadm join <span class="xml">&lt;MasterèŠ‚ç‚¹çš„IPå’Œç«¯å£&gt;</span><br><br><span class="hljs-section"># kubeadm å·¥ä½œåŸç†</span><br><span class="hljs-bullet">  -</span> kubelet æ˜¯Kubernetesé¡¹ç›®ç”¨æ¥æ“ä½œDockerç­‰å®¹å™¨è¿è¡Œæ—¶çš„æ ¸å¿ƒç»„ä»¶,é™¤äº†è·Ÿå®¹å™¨è¿è¡Œæ—¶äº¤äº’å¤–ï¼Œkubeletåœ¨é…ç½®å®¹å™¨ç½‘ç»œã€ç®¡ç†å®¹å™¨æ•°æ®å·æ—¶ï¼Œéƒ½éœ€è¦ç›´æ¥æ“ä½œå®¿ä¸»æœº.<br>  &gt; Kubeadmé€‰æ‹©ä¸€ç§å¦¥åæ–¹æ¡ˆï¼ŒæŠŠkubeletç›´æ¥è¿è¡Œåœ¨å®¿ä¸»æœºä¸Šï¼Œç„¶åä½¿ç”¨å®¹å™¨éƒ¨ç½²å…¶ä»–çš„Kubernetesç»„ä»¶.<br><br><span class="hljs-section"># kubeadm initå·¥ä½œæµç¨‹</span><br><span class="hljs-bullet">  -</span> 1. Preflight Checks æ£€æŸ¥å·¥ä½œ, ç¡®å®šæœºå™¨å¯ä»¥ç”¨æ¥éƒ¨ç½²Kubernetes<br><span class="hljs-bullet">    -</span> Linux Kernalå¿…é¡»&gt;= 3.10<br><span class="hljs-bullet">    -</span> Linux Cgroups æ¨¡å—æ˜¯å¦å¯ç”¨<br><span class="hljs-bullet">    -</span> æœºå™¨çš„hostnameæ˜¯å¦æ ‡å‡†<br><span class="hljs-bullet">    -</span> å®‰è£…çš„kubeadmå’Œkubeletç‰ˆæœ¬æ˜¯å¦åŒ¹é…<br><span class="hljs-bullet">    -</span> æœºå™¨ä¸Šæ˜¯ä¸æ˜¯å·²ç»å®‰è£…KubernetesäºŒè¿›åˆ¶æ–‡ä»¶<br><span class="hljs-bullet">    -</span> Kuberneteså·¥ä½œç«¯å£10250/10251/10252ç«¯å£æ˜¯å¦å ç”¨<br><span class="hljs-bullet">    -</span> ip, mount LinuxæŒ‡ä»¤æ˜¯å¦å­˜åœ¨<br><span class="hljs-bullet">    -</span> dockeræ˜¯å¦å®‰è£…<br><span class="hljs-bullet">  -</span> 2. ç”Ÿæˆ kuberneteså¯¹å¤–æä¾›æœåŠ¡æ‰€éœ€è¦çš„å„ç§è¯ä¹¦å’Œç›®å½•<br><span class="hljs-bullet">    -</span> Kuberneteså¯¹å¤–æä¾›æœåŠ¡æ—¶ï¼Œé™¤éä¸“é—¨å¼€å¯&quot;ä¸å®‰å…¨æ¨¡å¼&quot;,å¦åˆ™éƒ½è¦é€šè¿‡HTTPSæ‰èƒ½è®¿é—®kube-apiserver,éœ€è¦kubernetesé›†ç¾¤é…ç½®è¯ä¹¦æ–‡ä»¶<br><span class="hljs-bullet">    -</span> /etc/kubernetes/pki (kubeadmä¸ºkubernetesé¡¹ç›®ç”Ÿæˆçš„è¯ä¹¦æ–‡ä»¶)<br><span class="hljs-bullet">  -</span> 3. kubeadmä¸ºå…¶ä»–ç»„ä»¶ç”Ÿæˆè®¿é—®kube-apiserveræ‰€éœ€çš„é…ç½®æ–‡ä»¶<br><span class="hljs-bullet">    -</span> /etc/kubernetes/xxx.cnf<br><span class="hljs-bullet">  -</span> 4. kubeadmä¸ºMasterç»„ä»¶ç”ŸæˆPodé…ç½®æ–‡ä»¶<br><span class="hljs-bullet">    -</span> kube-apiserver<br><span class="hljs-bullet">    -</span> kube-controller-manager<br><span class="hljs-bullet">    -</span> kube-scheduler<br><span class="hljs-bullet">    -</span> ETCD<br><span class="hljs-code">    &gt; åœ¨Kubernetesä¸­ï¼Œç‰¹æ®Šçš„å®¹å™¨å¯åŠ¨æ–¹æ³•&quot;Static Pod&quot;,å…è®¸æŠŠè¦éƒ¨ç½²çš„Podçš„YAMLæ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªæŒ‡å®šçš„ç›®å½•é‡Œï¼Œå½“kubeletå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ£€æŸ¥æ¬¡ç›®å½•ï¼ŒåŠ è½½æ‰€æœ‰çš„PodYAMLæ–‡ä»¶</span><br><span class="hljs-code">  - 5. kubeadmæ£€æŸ¥localhost:6443/healthz ç­‰å¾…Masterç»„ä»¶å®Œå…¨è¿è¡Œèµ·æ¥</span><br><span class="hljs-code">  - 6. kubeadmä¸ºé›†ç¾¤ç”Ÿæˆä¸€ä¸ªbootstrap token.</span><br><span class="hljs-code">    - å‰©ä½™çš„NodeèŠ‚ç‚¹å¯ä»¥é€šè¿‡æ­¤tokenåŠ å…¥åˆ°é›†ç¾¤ä¸­</span><br><span class="hljs-code">  - 7. å®‰è£…æ’ä»¶kube-proxyå’ŒDNS</span><br><span class="hljs-code">    - kube-proxy: é›†ç¾¤çš„æœåŠ¡å‘ç°</span><br><span class="hljs-code">    - DNS:</span><br><span class="hljs-code"></span><br><span class="hljs-section"># kubeadm joinå·¥ä½œæµç¨‹</span><br><span class="hljs-bullet">  -</span> bootstrap token<br><span class="hljs-code">    &gt; kubeadmè‡³å°‘éœ€è¦å‘èµ·ä¸€æ¬¡&quot;ä¸å®‰å…¨æ¨¡å¼&quot;çš„è®¿é—®kube-apiserver,ä»è€Œæ‹¿åˆ°ä¿å­˜åœ¨ConfigMapä¸­çš„cluster-info(ä¿å­˜äº†APIServerçš„æˆæƒä¿¡æ¯),è€Œbootstrap tokenæ‰®æ¼”çš„å°±æ˜¯è¿™ä¸ªè¿‡ç¨‹ä¸­çš„å®‰å…¨éªŒè¯è§’è‰²</span><br><span class="hljs-code"></span><br><span class="hljs-section"># kubeadméƒ¨ç½²å‚æ•°é…ç½®æ–‡ä»¶(kubeadm.yaml)</span><br>  $ kubeadm init --config kubeadm.yaml<br></code></pre></td></tr></table></figure></li>
<li><p>installing kubeadm, kubelet and kubectl</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql">- kubeadm: the command <span class="hljs-keyword">to</span> bootstrap the <span class="hljs-keyword">cluster</span><br>- kubelet: the component that runs <span class="hljs-keyword">on</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">of</span> the machines <span class="hljs-keyword">in</span> your <span class="hljs-keyword">cluster</span> <span class="hljs-keyword">and</span> does things <span class="hljs-keyword">like</span> starting pods <span class="hljs-keyword">and</span> containers.<br>- kubectl: the command <span class="hljs-type">line</span> util <span class="hljs-keyword">to</span> talk <span class="hljs-keyword">to</span> your <span class="hljs-keyword">cluster</span><br></code></pre></td></tr></table></figure></li>
<li><p>container runtimes</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><code class="hljs vim"># common container <span class="hljs-keyword">runtime</span><span class="hljs-variable">s:</span><br>  - containerd<br>  - CRI-O<br>  - Docker<br><br># Cgroup(Control groups) driver<span class="hljs-variable">s:</span><br>  &gt; used <span class="hljs-keyword">to</span> constrain(é™åˆ¶) resources that are allocated <span class="hljs-keyword">to</span> processes.<br>  &gt; Changing the settings such that your container <span class="hljs-keyword">runtime</span> <span class="hljs-built_in">and</span> kubelet use systemd <span class="hljs-keyword">as</span> the cgroup stabilized the <span class="hljs-built_in">system</span>.<br><br># Cgroup V2<br>  &gt; <span class="hljs-keyword">is</span> the <span class="hljs-keyword">next</span> <span class="hljs-keyword">version</span> of cgroup Linux API.<br>  - cleaner <span class="hljs-built_in">and</span> easier <span class="hljs-keyword">to</span> use API<br>  - safe sub-tree delegation <span class="hljs-keyword">to</span> containers<br>  - newer features like Pressure Stall Information<br><br># Migrating <span class="hljs-keyword">to</span> the systemd driver in kubeadm managed clusters<br>  - Docker:<br>    sudo <span class="hljs-built_in">mkdir</span> /etc/docker<br>    <span class="hljs-keyword">cat</span> &lt;&lt;EOF | sudo tee /etc/docker/daemon.json<br>    &#123;<br>      <span class="hljs-string">&quot;exec-opts&quot;</span>: [<span class="hljs-string">&quot;native.cgroupdriver=systemd&quot;</span>],<br>      <span class="hljs-string">&quot;log-driver&quot;</span>: <span class="hljs-string">&quot;json-file&quot;</span>,<br>      <span class="hljs-string">&quot;log-opts&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;max-size&quot;</span>: <span class="hljs-string">&quot;100m&quot;</span><br>      &#125;,<br>      <span class="hljs-string">&quot;storage-driver&quot;</span>: <span class="hljs-string">&quot;overlay2&quot;</span><br>    &#125;<br>    EOF<br><br>  - Restart Docker <span class="hljs-built_in">and</span> enable <span class="hljs-keyword">on</span> boo<span class="hljs-variable">t:</span><br>    sudo systemctl enable docker<br>    sudo systemctl daemon-reload<br>    sudo systemctl restart docker<br></code></pre></td></tr></table></figure></li>
<li><p>kubeadméƒ¨ç½²</p>
<blockquote>
<p>kubeadmç›®å‰æ¬ ç¼ºéƒ¨ç½²é«˜å¯ç”¨Kubernetesé›†ç¾¤,ETCDã€Masterç»„ä»¶éƒ½åº”è¯¥æ˜¯å¤šèŠ‚ç‚¹é›†ç¾¤</p>
</blockquote>
</li>
</ul>
  <figure class="highlight stata"><table><tr><td class="code"><pre><code class="hljs stata"> # åˆ›å»ºä¸€ä¸ªMasterèŠ‚ç‚¹ (--image-repositoryæŒ‡å®šå®¹å™¨é•œåƒåœ°å€ä½¿ç”¨é˜¿é‡Œäº‘)<br> âœ sudo kubeadm init [--image-repository=&#x27;registry.cn-hangzhou.aliyuncs.com/google_containers&#x27;]<br> [init] Using Kubernetes <span class="hljs-keyword">version</span>: v1.22.2<br> [preflight] Running pre-flight checks<br> [preflight] Pulling images required <span class="hljs-keyword">for</span> setting up a Kubernetes <span class="hljs-keyword">cluster</span><br> [preflight] This might take a minute or <span class="hljs-keyword">two</span>, depending <span class="hljs-keyword">on</span> the speed of your internet connection<br> [preflight] You can also perform this action <span class="hljs-keyword">in</span> beforehand using &#x27;kubeadm config images pull&#x27;<br> [certs] Using certificateDir folder <span class="hljs-string">&quot;/etc/kubernetes/pki&quot;</span><br> [certs] Generating <span class="hljs-string">&quot;ca&quot;</span> certificate and key<br> [certs] Generating <span class="hljs-string">&quot;apiserver&quot;</span> certificate and key<br> [certs] apiserver serving cert is signed <span class="hljs-keyword">for</span> DNS names [chyiyaqing-poweredge-r720 kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.<span class="hljs-keyword">cluster</span>.<span class="hljs-keyword">local</span>] and IPs [10.96.0.1 192.168.50.57]<br> [certs] Generating <span class="hljs-string">&quot;apiserver-kubelet-client&quot;</span> certificate and key<br> [certs] Generating <span class="hljs-string">&quot;front-proxy-ca&quot;</span> certificate and key<br> [certs] Generating <span class="hljs-string">&quot;front-proxy-client&quot;</span> certificate and key<br> [certs] Generating <span class="hljs-string">&quot;etcd/ca&quot;</span> certificate and key<br> [certs] Generating <span class="hljs-string">&quot;etcd/server&quot;</span> certificate and key<br> [certs] etcd/server serving cert is signed <span class="hljs-keyword">for</span> DNS names [chyiyaqing-poweredge-r720 localhost] and IPs [192.168.50.57 127.0.0.1 ::1]<br> [certs] Generating <span class="hljs-string">&quot;etcd/peer&quot;</span> certificate and key<br> [certs] etcd/peer serving cert is signed <span class="hljs-keyword">for</span> DNS names [chyiyaqing-poweredge-r720 localhost] and IPs [192.168.50.57 127.0.0.1 ::1]<br> [certs] Generating <span class="hljs-string">&quot;etcd/healthcheck-client&quot;</span> certificate and key<br> [certs] Generating <span class="hljs-string">&quot;apiserver-etcd-client&quot;</span> certificate and key<br> [certs] Generating <span class="hljs-string">&quot;sa&quot;</span> key and public key<br> [kubeconfig] Using kubeconfig folder <span class="hljs-string">&quot;/etc/kubernetes&quot;</span><br> [kubeconfig] Writing <span class="hljs-string">&quot;admin.conf&quot;</span> kubeconfig <span class="hljs-keyword">file</span><br> [kubeconfig] Writing <span class="hljs-string">&quot;kubelet.conf&quot;</span> kubeconfig <span class="hljs-keyword">file</span><br> [kubeconfig] Writing <span class="hljs-string">&quot;controller-manager.conf&quot;</span> kubeconfig <span class="hljs-keyword">file</span><br> [kubeconfig] Writing <span class="hljs-string">&quot;scheduler.conf&quot;</span> kubeconfig <span class="hljs-keyword">file</span><br> [kubelet-start] Writing kubelet environment <span class="hljs-keyword">file</span> with flags to <span class="hljs-keyword">file</span> <span class="hljs-string">&quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span><br> [kubelet-start] Writing kubelet configuration to <span class="hljs-keyword">file</span> <span class="hljs-string">&quot;/var/lib/kubelet/config.yaml&quot;</span><br> [kubelet-start] Starting the kubelet<br> [control-plane] Using manifest folder <span class="hljs-string">&quot;/etc/kubernetes/manifests&quot;</span><br> [control-plane] Creating static Pod manifest <span class="hljs-keyword">for</span> <span class="hljs-string">&quot;kube-apiserver&quot;</span><br> [control-plane] Creating static Pod manifest <span class="hljs-keyword">for</span> <span class="hljs-string">&quot;kube-controller-manager&quot;</span><br> [control-plane] Creating static Pod manifest <span class="hljs-keyword">for</span> <span class="hljs-string">&quot;kube-scheduler&quot;</span><br> [etcd] Creating static Pod manifest <span class="hljs-keyword">for</span> <span class="hljs-keyword">local</span> etcd <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;/etc/kubernetes/manifests&quot;</span><br> [wait-control-plane] Waiting <span class="hljs-keyword">for</span> the kubelet to <span class="hljs-keyword">boot</span> up the control plane <span class="hljs-keyword">as</span> static Pods from directory <span class="hljs-string">&quot;/etc/kubernetes/manifests&quot;</span>. This can take up to 4m0s<br> [apiclient] All control plane components are healthy after 9.004478 seconds<br> [upload-config] Storing the configuration used <span class="hljs-keyword">in</span> ConfigMap <span class="hljs-string">&quot;kubeadm-config&quot;</span> <span class="hljs-keyword">in</span> the <span class="hljs-string">&quot;kube-system&quot;</span> Namespace<br> [kubelet] Creating a ConfigMap <span class="hljs-string">&quot;kubelet-config-1.22&quot;</span> <span class="hljs-keyword">in</span> namespace kube-system with the configuration <span class="hljs-keyword">for</span> the kubelets <span class="hljs-keyword">in</span> the <span class="hljs-keyword">cluster</span><br> [upload-certs] Skipping phase. Please see --upload-certs<br> [<span class="hljs-keyword">mark</span>-control-plane] Marking the node chyiyaqing-poweredge-r720 <span class="hljs-keyword">as</span> control-plane <span class="hljs-keyword">by</span> adding the labels: [node-role.kubernetes.io/master(deprecated) node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]<br> [<span class="hljs-keyword">mark</span>-control-plane] Marking the node chyiyaqing-poweredge-r720 <span class="hljs-keyword">as</span> control-plane <span class="hljs-keyword">by</span> adding the taints [node-role.kubernetes.io/master:NoSchedule]<br> [<span class="hljs-keyword">bootstrap</span>-<span class="hljs-keyword">token</span>] Using <span class="hljs-keyword">token</span>: z7bgdd.d4lm4cueg5vo9krh<br> [<span class="hljs-keyword">bootstrap</span>-<span class="hljs-keyword">token</span>] Configuring <span class="hljs-keyword">bootstrap</span> tokens, <span class="hljs-keyword">cluster</span>-info ConfigMap, RBAC Roles<br> [<span class="hljs-keyword">bootstrap</span>-<span class="hljs-keyword">token</span>] configured RBAC rules to allow Node <span class="hljs-keyword">Bootstrap</span> tokens to get nodes<br> [<span class="hljs-keyword">bootstrap</span>-<span class="hljs-keyword">token</span>] configured RBAC rules to allow Node <span class="hljs-keyword">Bootstrap</span> tokens to <span class="hljs-keyword">post</span> CSRs <span class="hljs-keyword">in</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">for</span> nodes to get long term certificate credentials<br> [<span class="hljs-keyword">bootstrap</span>-<span class="hljs-keyword">token</span>] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node <span class="hljs-keyword">Bootstrap</span> <span class="hljs-keyword">Token</span><br> [<span class="hljs-keyword">bootstrap</span>-<span class="hljs-keyword">token</span>] configured RBAC rules to allow certificate rotation <span class="hljs-keyword">for</span> all node client certificates <span class="hljs-keyword">in</span> the <span class="hljs-keyword">cluster</span><br> [<span class="hljs-keyword">bootstrap</span>-<span class="hljs-keyword">token</span>] Creating the <span class="hljs-string">&quot;cluster-info&quot;</span> ConfigMap <span class="hljs-keyword">in</span> the <span class="hljs-string">&quot;kube-public&quot;</span> namespace<br> [kubelet-finalize] Updating <span class="hljs-string">&quot;/etc/kubernetes/kubelet.conf&quot;</span> to point to a rotatable kubelet client certificate and key<br> [addons] Applied essential addon: CoreDNS<br> [addons] Applied essential addon: kube-proxy<br><br> Your Kubernetes control-plane has initialized successfully!<br><br> To start using your <span class="hljs-keyword">cluster</span>, you need to <span class="hljs-keyword">run</span> the following <span class="hljs-keyword">as</span> a regular user:<br><br>   <span class="hljs-keyword">mkdir</span> -p <span class="hljs-variable">$HOME</span>/.kube<br>   sudo cp -i /etc/kubernetes/admin.<span class="hljs-keyword">conf</span> <span class="hljs-variable">$HOME</span>/.kube/config<br>   sudo chown $(id -<span class="hljs-keyword">u</span>):$(id -<span class="hljs-keyword">g</span>) <span class="hljs-variable">$HOME</span>/.kube/config<br><br> Alternatively, <span class="hljs-keyword">if</span> you are the root user, you can <span class="hljs-keyword">run</span>:<br><br>   export KUBECONFIG=/etc/kubernetes/admin.<span class="hljs-keyword">conf</span><br><br> You should now deploy a pod network to the <span class="hljs-keyword">cluster</span>.<br> <span class="hljs-keyword">Run</span> <span class="hljs-string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with <span class="hljs-keyword">one</span> of the options listed at:<br>   https:<span class="hljs-comment">//kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><br> Then you can join any number of worker nodes <span class="hljs-keyword">by</span> running the following <span class="hljs-keyword">on</span> each <span class="hljs-keyword">as</span> root:<br><br> kubeadm join 192.168.50.57:6443 --<span class="hljs-keyword">token</span> z7bgdd.d4lm4cueg5vo9krh \<br>--discovery-<span class="hljs-keyword">token</span>-<span class="hljs-keyword">ca</span>-cert-hash sha256:f56091fb52dddc01e552ad110b3479015f4bcdaba5fadec6d76eadab1b3ee48b<br><br> # å°†ä¸€ä¸ªNodeèŠ‚ç‚¹åŠ å…¥å½“å‰é›†ç¾¤<br> $ kubeadm join &lt;MasterèŠ‚ç‚¹çš„IPå’Œç«¯å£&gt;<br><br> # è·å–kubeadmä¸´æ—¶ç”Ÿæˆçš„<span class="hljs-keyword">token</span><br> âœ kubeadm <span class="hljs-keyword">token</span> <span class="hljs-keyword">list</span><br> <span class="hljs-keyword">TOKEN</span>                     TTL         EXPIRES                USAGES                   DESCRIPTION                                                EXTRA GROUPS<br> z1ktsy.k2dzz0m17d42nsem   23h         2021-10-15T05:26:51Z   authentication,signing   The default <span class="hljs-keyword">bootstrap</span> <span class="hljs-keyword">token</span> generated <span class="hljs-keyword">by</span> &#x27;kubeadm init&#x27;.   system:bootstrappers:kubeadm:default-node-<span class="hljs-keyword">token</span><br><br> # æŸ¥çœ‹nodes<br> âœ kubectl get nodes<br> NAME                        STATUS   ROLES                  AGE     <span class="hljs-keyword">VERSION</span><br> chyiyaqing-poweredge-r720   Ready    control-plane,master   4m49s   v1.22.2<br><br> # æŸ¥çœ‹Podè¿è¡Œæƒ…å†µ<br> âœ kubectl get pod -A<br> NAMESPACE     NAME                                                READY   STATUS              RESTARTS   AGE<br> kube-system   coredns-7d89d9b6b8-cch8p                            0/1     ContainerCreating   0          5m10s<br> kube-system   coredns-7d89d9b6b8-vkzw7                            0/1     ContainerCreating   0          5m10s<br> kube-system   etcd-chyiyaqing-poweredge-r720                      1/1     Running             0          5m15s<br> kube-system   kube-apiserver-chyiyaqing-poweredge-r720            1/1     Running             0          5m15s<br> kube-system   kube-controller-manager-chyiyaqing-poweredge-r720   1/1     Running             0          5m17s<br> kube-system   kube-proxy-smnf2                                    1/1     Running             0          5m10s<br> kube-system   kube-scheduler-chyiyaqing-poweredge-r720            1/1     Running             0          5m14s<br><br> # kubectl <span class="hljs-keyword">describe</span> æŸ¥çœ‹èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯ã€çŠ¶æ€å’Œäº‹ä»¶Event<br> âœ kubectl <span class="hljs-keyword">describe</span> pod coredns-7d89d9b6b8-cch8p -<span class="hljs-keyword">n</span> kube-system<br> Name:                 coredns-7d89d9b6b8-cch8p<br> Namespace:            kube-system<br> Priority:             2000000000<br> Priority <span class="hljs-keyword">Class</span> Name:  system-<span class="hljs-keyword">cluster</span>-critical<br> Node:                 chyiyaqing-poweredge-r720/192.168.50.57<br> Start Time:           Thu, 14 Oct 2021 13:27:02 +0800<br> Labels:               k8s-<span class="hljs-keyword">app</span>=kube-dns<br>                       pod-template-hash=7d89d9b6b8<br> Annotations:          &lt;none&gt;<br> Status:               Pending<br> IP:<br> IPs:                  &lt;none&gt;<br> Controlled <span class="hljs-keyword">By</span>:        ReplicaSet/coredns-7d89d9b6b8<br> Containers:<br>   coredns:<br>     Container ID:<br>     Image:         registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:v1.8.4<br>     Image ID:<br>     Ports:         53/UDP, 53/TCP, 9153/TCP<br>     Host Ports:    0/UDP, 0/TCP, 0/TCP<br>     <span class="hljs-keyword">Args</span>:<br>       -<span class="hljs-keyword">conf</span><br>       /etc/coredns/Corefile<br>     State:          Waiting<br>       Reason:       ContainerCreating<br>     Ready:          False<br>     Restart <span class="hljs-keyword">Count</span>:  0<br>     Limits:<br>       <span class="hljs-keyword">memory</span>:  170Mi<br>     Requests:<br>       cpu:        100m<br>       <span class="hljs-keyword">memory</span>:     70Mi<br>     Liveness:     http-get http:<span class="hljs-comment">//:8080/health delay=60s timeout=5s period=10s #success=1 #failure=5</span><br>     Readiness:    http-get http:<span class="hljs-comment">//:8181/ready delay=0s timeout=1s period=10s #success=1 #failure=3</span><br>     Environment:  &lt;none&gt;<br>     Mounts:<br>       /etc/coredns from config-volume (ro)<br>       /<span class="hljs-keyword">var</span>/<span class="hljs-keyword">run</span>/secrets/kubernetes.io/serviceaccount from kube-api-access-qdx6w (ro)<br> Conditions:<br>   <span class="hljs-keyword">Type</span>              Status<br>   Initialized       True<br>   Ready             False<br>   ContainersReady   False<br>   PodScheduled      True<br> Volumes:<br>   config-volume:<br>     <span class="hljs-keyword">Type</span>:      ConfigMap (a volume populated <span class="hljs-keyword">by</span> a ConfigMap)<br>     Name:      coredns<br>     Optional:  false<br>   kube-api-access-qdx6w:<br>     <span class="hljs-keyword">Type</span>:                    Projected (a volume that contains injected data from multiple sources)<br>     TokenExpirationSeconds:  3607<br>     ConfigMapName:           kube-root-<span class="hljs-keyword">ca</span>.crt<br>     ConfigMapOptional:       &lt;nil&gt;<br>     DownwardAPI:             true<br> QoS <span class="hljs-keyword">Class</span>:                   Burstable<br> Node-Selectors:              kubernetes.io/os=linux<br> Tolerations:                 CriticalAddonsOnly op=Exists<br>                              node-role.kubernetes.io/control-plane:NoSchedule<br>                              node-role.kubernetes.io/master:NoSchedule<br>                              node.kubernetes.io/not-ready:NoExecute op=Exists <span class="hljs-keyword">for</span> 300s<br>                              node.kubernetes.io/unreachable:NoExecute op=Exists <span class="hljs-keyword">for</span> 300s<br> Events:<br>   <span class="hljs-keyword">Type</span>     Reason                  Age                  From               Message<br>   ----     ------                  ----                 ----               -------<br>   Warning  FailedScheduling        6m12s                default-scheduler  0/1 nodes are available: 1 node(s) had taint &#123;node.kubernetes.io/not-ready: &#125;, that the pod didn&#x27;t tolerate.<br>   Normal   Scheduled               6m7s                 default-scheduler  Successfully assigned kube-system/coredns-7d89d9b6b8-cch8p to chyiyaqing-poweredge-r720<br>   Warning  FailedCreatePodSandBox  6m6s                 kubelet            Failed to create pod sandbox: rpc <span class="hljs-keyword">error</span>: code = Unknown <span class="hljs-keyword">desc</span> = [failed to <span class="hljs-keyword">set</span> up sandbox container <span class="hljs-string">&quot;d165e9f1f627d4a9c1f0eac4492ae7d1db6a7a1fe2a92dd435380cac57b35011&quot;</span> network <span class="hljs-keyword">for</span> pod <span class="hljs-string">&quot;coredns-7d89d9b6b8-cch8p&quot;</span>: networkPlugin cni failed to <span class="hljs-keyword">set</span> up pod <span class="hljs-string">&quot;coredns-7d89d9b6b8-cch8p_kube-system&quot;</span> network: unable to allocate IP address: <span class="hljs-keyword">Post</span> <span class="hljs-string">&quot;http://127.0.0.1:6784/ip/d165e9f1f627d4a9c1f0eac4492ae7d1db6a7a1fe2a92dd435380cac57b35011&quot;</span>: dial tcp 127.0.0.1:6784: connect: connection refused, failed to clean up sandbox container <span class="hljs-string">&quot;d165e9f1f627d4a9c1f0eac4492ae7d1db6a7a1fe2a92dd435380cac57b35011&quot;</span> network <span class="hljs-keyword">for</span> pod <span class="hljs-string">&quot;coredns-7d89d9b6b8-cch8p&quot;</span>: networkPlugin cni failed to teardown pod <span class="hljs-string">&quot;coredns-7d89d9b6b8-cch8p_kube-system&quot;</span> network: Delete <span class="hljs-string">&quot;http://127.0.0.1:6784/ip/d165e9f1f627d4a9c1f0eac4492ae7d1db6a7a1fe2a92dd435380cac57b35011&quot;</span>: dial tcp 127.0.0.1:6784: connect: connection refused]<br>   Normal   SandboxChanged          63s (x25 over 6m5s)  kubelet            Pod sandbox changed, it will be killed and re-created.<br><br> # é€šè¿‡Taint/Toleration è°ƒæ•´Masteræ‰§è¡ŒPodçš„ç­–ç•¥ (ç”±äºæœ¬åœ°æ­å»ºç¯å¢ƒkubeamdåªæœ‰ä¸€ä¸ªMasterèŠ‚ç‚¹)<br> &gt; é»˜è®¤æƒ…å†µä¸‹MasterèŠ‚ç‚¹æ˜¯ä¸å…è®¸è¿è¡Œç”¨æˆ·Podçš„, Kubernetesä¾èµ–Taint/Tolerationæœºåˆ¶<br>   - ä¸ºèŠ‚ç‚¹æ‰“ä¸Šæ±¡ç‚¹(Taint)<br>     &gt; $ kubectl taint nodes &lt;node-1&gt; foo=bar:NoSchedule<br>   - åˆ é™¤Taint<br>     âœ kubectl taint nodes --all node-role.kubernetes.io/master-<br>     node/chyiyaqing-poweredge-r720 untainted<br> # å®‰è£…ç½‘ç»œæ’ä»¶<br>     âœ kubectl apply -f <span class="hljs-string">&quot;https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d &#x27;\n&#x27;)&quot;</span><br><br>     serviceaccount/weave-<span class="hljs-keyword">net</span> created<br>     clusterrole.rbac.authorization.k8s.io/weave-<span class="hljs-keyword">net</span> created<br>     clusterrolebinding.rbac.authorization.k8s.io/weave-<span class="hljs-keyword">net</span> created<br>     role.rbac.authorization.k8s.io/weave-<span class="hljs-keyword">net</span> created<br>     rolebinding.rbac.authorization.k8s.io/weave-<span class="hljs-keyword">net</span> created<br>     daemonset.apps/weave-<span class="hljs-keyword">net</span> created<br></code></pre></td></tr></table></figure>
<ul>
<li><p>kubernetes CNI (Container Network Interface)<br><img src="/misc/images/kubernetes-cni-architecture.png" alt="CNI plugin architecture"></p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><code class="hljs applescript">&gt; Kubernetes supports CNI plugins <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> communication <span class="hljs-keyword">between</span> pods.<br>&gt; kubeadm <span class="hljs-keyword">does</span> <span class="hljs-keyword">not</span> support kubenet. you should use a CNI plugin<br><br><span class="hljs-comment"># Kubernetes impose(æ–½åŠ ) following rules for network communication:</span><br>  - All containers can communicate <span class="hljs-keyword">with</span> all other containers <span class="hljs-keyword">without</span> NAT<br>  - All nodes can communicate <span class="hljs-keyword">with</span> all container (<span class="hljs-keyword">and</span> vice-versa) <span class="hljs-keyword">without</span> NAT<br>  - The IP <span class="hljs-keyword">that</span> a container sees itself <span class="hljs-keyword">as</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">the</span> same IP <span class="hljs-keyword">that</span> others see <span class="hljs-keyword">it</span> <span class="hljs-keyword">as</span>.<br><br>CNI plugins generally use kube-proxy <span class="hljs-keyword">or</span> directory iptables <span class="hljs-keyword">for</span> routing. However, Cilium <span class="hljs-keyword">is</span> based <span class="hljs-keyword">on</span> BPF <span class="hljs-keyword">and</span> XDP <span class="hljs-keyword">to</span> provide a faster <span class="hljs-keyword">and</span> more scalable option.<br><br><span class="hljs-comment"># Plugins:</span><br>  - Flannel:<br>    - provides VXLAN tunneling solution éš§é“è§£å†³æ–¹æ¡ˆ<br>    - configuration <span class="hljs-keyword">and</span> management are very simple<br>    - <span class="hljs-keyword">does</span> <span class="hljs-keyword">not</span> support Network Policies<br>  - Calico:<br>    - default choice <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> most <span class="hljs-keyword">of</span> kubernetes platform (kubespary, docker enterprise)<br>    - uses BGP <span class="hljs-keyword">and</span> Bird, a daemon called Felix configures routes <span class="hljs-keyword">on</span> Bird<br>    - supports IP-IP encapsulation <span class="hljs-keyword">if</span> BGP cannot be used.<br>    - supports Network Policies<br>    - uses iptables <span class="hljs-keyword">for</span> routing <span class="hljs-keyword">but</span> <span class="hljs-keyword">it</span> can be configured <span class="hljs-keyword">to</span> use kube-proxy&#x27;s IPVS mode.<br>  - Weave:<br>    - Provides VXLAN tunneling solution<br>    - all <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> nodes are connected <span class="hljs-keyword">as</span> mesh which allows <span class="hljs-keyword">it</span> <span class="hljs-keyword">to</span> <span class="hljs-built_in">run</span> <span class="hljs-keyword">on</span> paritially connected networks.<br>    - stores configuration files <span class="hljs-keyword">on</span> pods <span class="hljs-keyword">instead of</span> kubernetes CRDs <span class="hljs-keyword">or</span> etcd<br>    - has an encryption library<br>    - supports Network Policies<br>  - Cilium<br>    - Linux kernel must be <span class="hljs-keyword">at</span> least <span class="hljs-number">4.9</span><br>  - kube-router:<br>    -<br></code></pre></td></tr></table></figure>
<ul>
<li>Terminology<ul>
<li>kube-proxy<ul>
<li>Kube-proxy tree mods: ä¸‰ä¸ªæ¨¡ç»„<ul>
<li>userspace:<br><img src="/misc/images/kube-proxy-userspace-mode.png" alt="kube-proxy Userspace mode"><figure class="highlight applescript"><table><tr><td class="code"><pre><code class="hljs applescript">&gt; It adds rules <span class="hljs-keyword">to</span> iptables so <span class="hljs-keyword">that</span> all communication redirects <span class="hljs-keyword">through</span> proxy server. It <span class="hljs-keyword">is</span> no longer used <span class="hljs-keyword">since</span> <span class="hljs-keyword">it</span> <span class="hljs-keyword">is</span> much slower compared <span class="hljs-keyword">to</span> <span class="hljs-keyword">the</span> other modes.<br></code></pre></td></tr></table></figure></li>
<li>Iptables:<br><img src="/misc/images/kube-proxy-iptables-mode.png" alt="kube-proxy iptables mode"><figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql">&gt; This mode adds rules <span class="hljs-keyword">to</span> iptables so that iptables redirects straight <span class="hljs-keyword">to</span> pods <span class="hljs-keyword">without</span> <span class="hljs-keyword">using</span> a proxy <span class="hljs-keyword">server</span>. It <span class="hljs-keyword">is</span> the <span class="hljs-keyword">default</span> mode <span class="hljs-keyword">of</span> kube-proxy.<br></code></pre></td></tr></table></figure></li>
<li>IPVS:<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql">IPVS (IP Virtual <span class="hljs-keyword">Server</span>) <span class="hljs-keyword">is</span> layer<span class="hljs-number">-4</span> <span class="hljs-keyword">load</span> balancer inside the Linux kernel. It <span class="hljs-keyword">is</span> built <span class="hljs-keyword">on</span> top <span class="hljs-keyword">of</span> netfilter <span class="hljs-keyword">like</span> iptables. It utilizes hash <span class="hljs-keyword">table</span> <span class="hljs-keyword">instead</span> <span class="hljs-keyword">of</span> chain <span class="hljs-keyword">as</span> <span class="hljs-keyword">in</span> iptables.<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li>Network policy<figure class="highlight applescript"><table><tr><td class="code"><pre><code class="hljs applescript">Kubernetes specification <span class="hljs-keyword">that</span> can be used <span class="hljs-keyword">to</span> control traffic <span class="hljs-keyword">between</span> pods.<br></code></pre></td></tr></table></figure></li>
<li>Overlay Networks<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><code class="hljs livecodeserver">An overlay network abstracts <span class="hljs-keyword">a</span> physical (underlay) network <span class="hljs-built_in">to</span> <span class="hljs-built_in">create</span> virtual network. It provides simpler interface <span class="hljs-keyword">by</span> hiding complexities <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> underlay.<br></code></pre></td></tr></table></figure></li>
<li>VXLAN<br><img src="/misc/images/vxlan-architecture.png" alt="VXLAN architecture"><figure class="highlight applescript"><table><tr><td class="code"><pre><code class="hljs applescript">VXLAN <span class="hljs-keyword">is</span> a network tunneling(éš§é“) protocol <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> Linux Kernel. Network tunneling means hiding protocol (VXLAN) within another protocol (TCP/IP).VXLAN tuneels layer <span class="hljs-number">2</span> frames inside <span class="hljs-keyword">of</span> Layer <span class="hljs-number">4</span> UDP datagrams.<br><br><span class="hljs-comment"># Linux network structure in VXLAN:</span><br>  - veth: Virtual ethernet pair, <span class="hljs-keyword">it</span> connects network namespaces<br>  - bridge: It <span class="hljs-keyword">is</span> used <span class="hljs-keyword">to</span> connect ethernet pairs <span class="hljs-keyword">in</span> Linux<br>  - vtep: VXLAN tunnel endpoint, <span class="hljs-keyword">it</span>&#x27;s entry/<span class="hljs-keyword">exit</span> point <span class="hljs-keyword">for</span> VXLAN tunnels<br></code></pre></td></tr></table></figure></li>
<li>BGP(Border gateway protocol) - è¾¹ç•Œç½‘å…³åè®®</li>
<li>BPF(Berkeley Packet Filter) - ä¼¯å…‹åˆ©æ•°æ®åŒ…è¿‡æ»¤å™¨</li>
<li>XDP (eXpress Data Path)<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql">XDP <span class="hljs-keyword">is</span> a data <span class="hljs-type">path</span> recently added <span class="hljs-keyword">to</span> Linux kernel. It relies <span class="hljs-keyword">on</span> eBPF <span class="hljs-keyword">to</span> <span class="hljs-keyword">perform</span> fast packet processing.<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p>kuberneteså®‰è£…Metrics Server</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk">&gt; Metrics Serveræ˜¯é›†ç¾¤ä¸­èµ„æºä½¿ç”¨æƒ…å†µçš„èšåˆå™¨, Metrics Serverä»kubeletsæ”¶é›†èµ„æºæŒ‡æ ‡ï¼Œå¹¶é€šè¿‡Metrics APIå°†ä»–ä»¬æš´éœ²åœ¨Kubernetes apiserverä¸­,ä»¥ä¾›Horizontal Pod Autoscalerå’ŒVertical Pod Autoscalerä½¿ç”¨.<br>&gt; Metrics Serverä¸é€‚ç”¨ä¸éè‡ªåŠ¨ç¼©æ”¾ç›®çš„ï¼Œä¸è¦ä½¿ç”¨ä»–å°†æŒ‡æ ‡è½¬å‘åˆ°ç›‘æ§è§£å†³æ–¹æ¡ˆï¼Œæˆ–ä½œä¸ºç›‘æ§è§£å†³æ–¹æ¡ˆæŒ‡æ ‡çš„æ¥æº,è¿™ç§æƒ…å†µå¯ä»¥ä½¿ç”¨kuberlet<span class="hljs-regexp">/metrics/</span>resource ç«¯ç‚¹æ”¶é›†æŒ‡æ ‡<br><br><span class="hljs-comment"># Installation</span><br>- kubectl apply -f https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/kubernetes-sigs/m</span>etrics-server<span class="hljs-regexp">/releases/</span>latest<span class="hljs-regexp">/download/</span>components.yaml<br><br><span class="hljs-comment"># Fix: (cannot validate certificate, doesn&#x27;t contain any IP SANs)</span><br>  - $ kubectl edit deployment metrics-server -n kube-system<br>    &gt; modifying the metrics-server deployment template, and adding the argument - --kubelet-insecure-tls to the container args<br></code></pre></td></tr></table></figure></li>
<li><p>Kubernetesé›†ç¾¤å®‰è£…Dashboard</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># Dashboard(Webç•Œé¢) å¯è§†åŒ–æ’ä»¶</span><br>  âœ wget kubectl apply -f https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/kubernetes/</span>dashboard<span class="hljs-regexp">/v2.2.0/</span>aio<span class="hljs-regexp">/deploy/</span>recommended.yaml<br>  namespace/kubernetes-dashboard created<br>  serviceaccount/kubernetes-dashboard created<br>  service/kubernetes-dashboard created<br>  secret/kubernetes-dashboard-certs created<br>  secret/kubernetes-dashboard-csrf created<br>  secret/kubernetes-dashboard-key-holder created<br>  configmap/kubernetes-dashboard-settings created<br>  role.rbac.authorization.k8s.io/kubernetes-dashboard created<br>  clusterrole.rbac.authorization.k8s.io/kubernetes-dashboard created<br>  rolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created<br>  clusterrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created<br>  deployment.apps/kubernetes-dashboard created<br>  service/dashboard-metrics-scraper created<br>  Warning: spec.template.metadata.annotations[seccomp.security.alpha.kubernetes.io/pod]: deprecated since v1.<span class="hljs-number">19</span>; use the <span class="hljs-string">&quot;seccompProfile&quot;</span> field instead<br>  deployment.apps/dashboard-metrics-scraper created<br><br><span class="hljs-comment"># æŸ¥çœ‹Dashboardå¯¹åº”çš„PodçŠ¶æ€</span><br>âœ kubectl get pods -n kubernetes-dashboard<br>NAME                                         READY   STATUS    RESTARTS   AGE<br>dashboard-metrics-scraper-<span class="hljs-number">856586</span>f554-w4vvw   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">5</span>m19s<br>kubernetes-dashboard-<span class="hljs-number">78</span>c79f97b4-l8nmb        <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">5</span>m19s<br><br><span class="hljs-comment"># å‘½ä»¤è¡Œä»£ç† kubectl è®¿é—®DashBoard</span><br>$ kubectl proxy --address=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span> --port=<span class="hljs-number">8001</span> --accept-hosts=<span class="hljs-string">&#x27;.*&#x27;</span><br><br><span class="hljs-comment"># ä»é›†ç¾¤å¤–éƒ¨è®¿é—®Dashboard éœ€è¦ä½¿ç”¨Ingress</span><br></code></pre></td></tr></table></figure></li>
<li><p>Kuberneteséƒ¨ç½²å­˜å‚¨æ’ä»¶</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql">&gt; å®¹å™¨æŒä¹…åŒ–å­˜å‚¨,ç”¨æ¥ä¿å­˜å®¹å™¨å­˜å‚¨çŠ¶æ€,å­˜å‚¨æ’ä»¶ä¼šåœ¨å®¹å™¨ä¸­æŒ‚åœ¨ä¸€ä¸ªåŸºäºç½‘ç»œæˆ–è€…å…¶ä»–æœºåˆ¶çš„è¿œç¨‹æ•°æ®å·. ä½¿å¾—åœ¨å®¹å™¨é‡Œåˆ›å»ºçš„æ–‡ä»¶ï¼Œå®é™…ä¸Šä¿å­˜åœ¨è¿œç¨‹å­˜å‚¨æœåŠ¡å™¨ä¸Š,<br><br># Kubernetes å­˜å‚¨æ’ä»¶ - Rook<br>  &gt; Rooké¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºCephçš„Kuberneteså­˜å‚¨æ’ä»¶ï¼Œä¸åŒäºCephçš„ç®€å•å°è£…ï¼ŒRookåŠ å…¥äº†å¯¹å¹³æ‰©å±•ã€è¿ç§»ã€ç¾éš¾å¤‡ä»½ã€ç›‘æ§ç­‰å¤§é‡çš„ä¼ä¸šçº§åŠŸèƒ½.<br>  - éƒ¨ç½²åŸºäºRookæŒä¹…åŒ–å­˜å‚¨é›†ç¾¤ä»¥å®¹å™¨æ–¹å¼è¿è¡Œ<br>    $ git clone <span class="hljs-comment">--single-branch --branch release-1.7 https://github.com/rook/rook.git</span><br>    cd rook/<span class="hljs-keyword">cluster</span>/examples/kubernetes/ceph<br>    kubectl <span class="hljs-keyword">create</span> -f crds.yaml -f common.yaml -f <span class="hljs-keyword">operator</span>.yaml<br>    kubectl <span class="hljs-keyword">create</span> -f <span class="hljs-keyword">cluster</span>.yaml<br><br>  - æŸ¥çœ‹Rookéƒ¨ç½²çš„Namespace<br>    âœ k <span class="hljs-keyword">get</span> pods -n rook-ceph<br>    <span class="hljs-type">NAME</span>                                           READY   STATUS    RESTARTS   AGE<br>    csi-cephfsplugin<span class="hljs-number">-7</span>l9xb                         <span class="hljs-number">3</span>/<span class="hljs-number">3</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">15</span>m<br>    csi-cephfsplugin-provisioner<span class="hljs-number">-689686</span>b44-qpt5q   <span class="hljs-number">6</span>/<span class="hljs-number">6</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">15</span>m<br>    csi-rbdplugin-provisioner<span class="hljs-number">-5775</span>fb866b<span class="hljs-number">-25224</span>     <span class="hljs-number">6</span>/<span class="hljs-number">6</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">15</span>m<br>    csi-rbdplugin-vvq94                            <span class="hljs-number">3</span>/<span class="hljs-number">3</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">15</span>m<br>    rook-ceph-<span class="hljs-keyword">operator</span><span class="hljs-number">-7</span>bdb744878-zz2fm            <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">24</span>m<br><br>  &gt; Kubernetesé¡¹ç›®åˆ›å»ºçš„æ‰€æœ‰Podå°±èƒ½å¤Ÿé€šè¿‡Persistent Volume (PV) å’Œ Persistent Volume Claim (PVC) çš„æ–¹å¼ï¼Œåœ¨å®¹å™¨é‡ŒæŒ‚è½½ç”±Cephæä¾›çš„æ•°æ®å·<br><br>  - <span class="hljs-keyword">Storage</span><br>    - Block: <span class="hljs-keyword">Create</span> block <span class="hljs-keyword">storage</span> <span class="hljs-keyword">to</span> be consumed <span class="hljs-keyword">by</span> a pod (RWO)<br>      &gt; <span class="hljs-keyword">Before</span> Rook can provision <span class="hljs-keyword">storage</span>, a **StorageClass** <span class="hljs-keyword">and</span> **CephBlockPool** need <span class="hljs-keyword">to</span> be created.<br>    - Shared FileSystem: <span class="hljs-keyword">Create</span> a filesystem <span class="hljs-keyword">to</span> be shared across multiple pods (RWX)<br>    - <span class="hljs-keyword">Object</span>: <span class="hljs-keyword">Create</span> an <span class="hljs-keyword">object</span> store that <span class="hljs-keyword">is</span> accessible inside <span class="hljs-keyword">or</span> outside the Kubernetes <span class="hljs-keyword">cluster</span><br></code></pre></td></tr></table></figure></li>
<li><p>HELM</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-quote">&gt; Helm is the package manager for Kubernetes</span><br><br><span class="hljs-section"># Helm ä¸‰å¤§æ¦‚å¿µ</span><br><span class="hljs-bullet">  -</span> Chart: helmåŒ…<br><span class="hljs-code">    &gt; åŒ…å«Kubernetesé›†ç¾¤å†…éƒ¨è¿è¡Œåº”ç”¨ç¨‹åº,å·¥å…·æˆ–æœåŠ¡æ‰€éœ€çš„æ‰€æœ‰èµ„æºå®šä¹‰</span><br><span class="hljs-code">  - Repository: ä»“åº“</span><br><span class="hljs-code">    &gt; å­˜æ”¾å’Œå…±äº«charts</span><br><span class="hljs-code">  - Release:</span><br><span class="hljs-code">    &gt; è¿è¡Œåœ¨Kubernetesé›†ç¾¤ä¸­çš„chartå®ä¾‹</span><br><span class="hljs-code"></span><br><span class="hljs-section"># helm search - æŸ¥æ‰¾Charts</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Kubernetes-IN-Docker-Kind"><a href="#Kubernetes-IN-Docker-Kind" class="headerlink" title="Kubernetes IN Docker (Kind)"></a>Kubernetes IN Docker (Kind)</h2><blockquote>
<p>local clusters for testing Kubernetes</p>
</blockquote>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><code class="hljs n1ql"># Installation<br>  $ go install sigs.k8s.io/kind@v0.11.1<br><br># Creating a Cluster<br>  $ kind <span class="hljs-keyword">create</span> <span class="hljs-keyword">cluster</span> # Default <span class="hljs-keyword">cluster</span> context name <span class="hljs-keyword">is</span> <span class="hljs-symbol">`kind`</span><br>  Creating <span class="hljs-keyword">cluster</span> <span class="hljs-string">&quot;kind&quot;</span> ...<br>   âœ“ Ensuring node image (kindest/node:v1<span class="hljs-number">.21</span><span class="hljs-number">.1</span>) ğŸ–¼<br>   âœ“ Preparing nodes ğŸ“¦<br>   âœ“ Writing configuration ğŸ“œ<br>   âœ“ Starting control-plane ğŸ•¹ï¸<br>   âœ“ Installing CNI ğŸ”Œ<br>   âœ“ Installing StorageClass ğŸ’¾<br>  <span class="hljs-keyword">Set</span> kubectl context <span class="hljs-keyword">to</span> <span class="hljs-string">&quot;kind-kind&quot;</span><br>  You can now <span class="hljs-keyword">use</span> your <span class="hljs-keyword">cluster</span> <span class="hljs-keyword">with</span>:<br><br>  kubectl <span class="hljs-keyword">cluster</span>-info --context kind-kind<br><br>  <span class="hljs-keyword">Not</span> sure what <span class="hljs-keyword">to</span> <span class="hljs-keyword">do</span> next? ğŸ˜…  Check out https://kind.sigs.k8s.io/docs/<span class="hljs-keyword">user</span>/quick-<span class="hljs-keyword">start</span>/<br><br>  â¯ kubectl <span class="hljs-keyword">cluster</span>-info --context kind-kind  # interact <span class="hljs-keyword">with</span> a specific <span class="hljs-keyword">cluster</span><br>  Kubernetes control plane <span class="hljs-keyword">is</span> running at https://<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">45967</span><br>  CoreDNS <span class="hljs-keyword">is</span> running at https://<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">45967</span>/api/v1/namespaces/kube-<span class="hljs-keyword">system</span>/services/kube-dns:dns/proxy<br><br>  <span class="hljs-keyword">To</span> further debug <span class="hljs-keyword">and</span> diagnose <span class="hljs-keyword">cluster</span> problems, <span class="hljs-keyword">use</span> <span class="hljs-string">&#x27;kubectl cluster-info dump&#x27;</span>.<br><br>  â¯ kind get clusters  # list kind clusters<br>  kind<br></code></pre></td></tr></table></figure>

<h2 id="å®¹å™¨åŒ–åº”ç”¨"><a href="#å®¹å™¨åŒ–åº”ç”¨" class="headerlink" title="å®¹å™¨åŒ–åº”ç”¨"></a>å®¹å™¨åŒ–åº”ç”¨</h2><ul>
<li>Kubernetes API å¯¹è±¡å®šä¹‰<figure class="highlight gauss"><table><tr><td class="code"><pre><code class="hljs gauss">&gt; Kubernetes ä¸æ¨èä½¿ç”¨å‘½ä»¤è¡Œæ–¹å¼ç›´æ¥è¿è¡Œå®¹å™¨(kubectl <span class="hljs-keyword">run</span>), è€Œæ˜¯å¸Œæœ›ä½¿ç”¨YAMLæ–¹å¼(kubectl <span class="hljs-keyword">create</span> -f yaml)<br>&gt; ä½¿ç”¨ä¸€ä¸ªAPIå¯¹è±¡(Deployment)ç®¡ç†å¦ä¸€ç§APIå¯¹è±¡(Pod)çš„æ–¹å¼å«åšâ€œæ§åˆ¶å™¨â€æ¨¡å¼ (Controller pattern)<br>&gt; Pod æ˜¯Kubernetesä¸–ç•Œé‡Œçš„â€œåº”ç”¨â€,è€Œä¸€ä¸ªåº”ç”¨å¯ä»¥ç”±å¤šä¸ªå®¹å™¨ç»„æˆ.<br><br>- metadata: APIå¯¹è±¡çš„å…ƒæ•°æ®<br>- spec: æè¿°å®ƒè¦è¡¨è¾¾çš„åŠŸèƒ½<br>- labels: ä¸€ç»„<span class="hljs-built_in">key</span>-valueæ ¼å¼çš„æ ‡ç­¾<br>- spec.selector.matchLabels: Label Selector æ ‡ç­¾é€‰æ‹©å™¨<br>- annotations: ä¸€ç»„<span class="hljs-built_in">key</span>-valueæ ¼å¼çš„å†…éƒ¨ä¿¡æ¯(kubernetesç»„ä»¶æœ¬èº«æ„Ÿå…´è¶£, åœ¨Kubernetesè¿è¡Œè¿‡ç¨‹ä¸­è¢«è‡ªåŠ¨åŠ è½½åˆ°APIå¯¹è±¡ä¸Š)<br><br>âœ k get pods -l app=nginx<br>NAME                                READY   STATUS    RESTARTS   AGE<br>nginx-deployment<span class="hljs-number">-5</span>d59d67564<span class="hljs-number">-8</span>qtq5   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">11</span>m<br>nginx-deployment<span class="hljs-number">-5</span>d59d67564-xx29g   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">11</span>m<br><br><span class="hljs-meta"># ä½¿ç”¨kubectl apply ç»Ÿä¸€è¿›è¡Œkuberneteså¯¹è±¡çš„åˆ›å»ºå’Œæ›´æ–°æ“ä½œ</span><br>$ k apply -f nginx-deployment.yaml<br>$ k <span class="hljs-built_in">exec</span> -it nginx-deployment<span class="hljs-number">-748</span>c6fff66-plhwq -- /bin/bash<br>$ k <span class="hljs-keyword">delete</span> -f nginx-deployment.yaml<br><br><span class="hljs-meta"># emptyDir</span><br>  &gt; ä¸æ˜¾å¼å£°æ˜å®¿ä¸»ä¸»æœºç›®å½•çš„<span class="hljs-built_in">Volume</span>,Kubernetesä¼šåœ¨å®¿ä¸»ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªä¸´æ—¶ç›®å½•,è¿™ä¸ªç›®å½•ä¼šè¢«ç»‘å®šåˆ°å®¹å™¨æ‰€å£°æ˜çš„<span class="hljs-built_in">Volume</span>ç›®å½•ä¸Š(Kubernetesçš„emptyDirç±»å‹ï¼Œåªæ˜¯æŠŠkubernetesåˆ›å»ºçš„ä¸´æ—¶ç›®å½•ä½œä¸º<span class="hljs-built_in">Volume</span>å®¿ä¸»æœºç›®å½•ï¼Œäº¤ç»™Docker)<br><br><span class="hljs-meta"># hostPath</span><br>  &gt; æ˜¾å¼çš„<span class="hljs-built_in">Volume</span>å®šä¹‰<br>  ...<br>    volumes:<br>      - name: nginx-vol<br>        hostPath:<br>          path: <span class="hljs-string">&quot; /var/data&quot;</span><br></code></pre></td></tr></table></figure></li>
<li>Podå®ç°åŸç†<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">Podæ˜¯Kuberntesé¡¹ç›®çš„åŸå­è°ƒåº¦å•ä½,kubernetesé¡¹ç›®çš„è°ƒåº¦å™¨æ˜¯ç»Ÿä¸€æŒ‰ç…§Podè€Œéå®¹å™¨çš„èµ„æºéœ€æ±‚è¿›è¡Œè®¡ç®—</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">Dockerå®¹å™¨çš„æœ¬è´¨<span class="hljs-string">&quot;Namespaceéš”ç¦»ï¼ŒCgroupsé™åˆ¶ï¼Œrootfsæ–‡ä»¶ç³»ç»Ÿ&quot;</span></span><br><span class="hljs-meta">&gt;</span> <span class="javascript">Podæ˜¯Kubernetesé‡Œé™¢å­è°ƒåº¦å•ä½ï¼ŒKubernetesé¡¹ç›®çš„è°ƒåº¦å™¨æ˜¯ç»Ÿä¸€æŒ‰ç…§Podè€Œéå®¹å™¨çš„èµ„æºéœ€æ±‚è¿›è¡Œè®¡ç®—.</span><br><br># å±•ç¤ºç³»ç»Ÿä¸­æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æ ‘çŠ¶ç»“æ„<br>$ pstree - display a tree of process<br><br><span class="hljs-meta">&gt;</span> <span class="javascript">å®¹å™¨çš„<span class="hljs-string">&quot;å•è¿›ç¨‹æ¨¡å‹&quot;</span>å¹¶ä¸æ˜¯æŒ‡å®¹å™¨é‡Œåªèƒ½è¿è¡Œ<span class="hljs-string">&quot;ä¸€ä¸ª&quot;</span>è¿›ç¨‹,è€Œæ˜¯æŒ‡å®¹å™¨æ²¡æœ‰ç®¡ç†å¤šä¸ªè¿›ç¨‹çš„èƒ½åŠ›,</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">Podåœ¨Kubernetesé¡¹ç›®é‡Œâ€œå®¹å™¨è®¾è®¡æ¨¡å‹â€</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">Podå…¶å®æ˜¯ä¸€ç»„å…±äº«äº†æŸäº›èµ„æºçš„å®¹å™¨;Podé‡Œçš„æ‰€æœ‰å®¹å™¨å…±äº«çš„æ˜¯ä¸€ä¸ªNetwork Namespace,å¹¶ä¸”å¯ä»¥å£°æ˜å…±äº«ä¸€ä¸ªVolume.</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">Podå®é™…ä¸Šæ‰®æ¼”ä¼ ç»ŸåŸºç¡€è®¾æ–½é‡Œ<span class="hljs-string">&quot;è™šæ‹Ÿæœº&quot;</span>çš„è§’è‰²ï¼Œè€Œå®¹å™¨åˆ™æ˜¯è¿™ä¸ªè™šæ‹Ÿæœºé‡Œè¿è¡Œçš„ç”¨æˆ·ç¨‹åº</span><br></code></pre></td></tr></table></figure>
<ul>
<li>Pod Infraå®¹å™¨<br><img src="/misc/images/kubernetes-pod-infra.png" alt="Pod Infra"><figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">Kubernetesé¡¹ç›®ä¸­Podå®ç°ä½¿ç”¨ä¸€ä¸ªä¸­é—´å®¹å™¨ï¼Œè¿™ä¸ªå®¹å™¨å«åšInfraå®¹å™¨,åœ¨Podä¸­,Infraå®¹å™¨éƒ½æ˜¯ç¬¬ä¸€ä¸ªè¢«åˆ›å»ºçš„å®¹å™¨</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">Infra å®¹å™¨ä½¿ç”¨k8s.gcr.io/pauseé•œåƒä½¿ç”¨æ±‡ç¼–è¯­è¨€ç¼–å†™ï¼Œæ°¸è¿œå¤„äº<span class="hljs-string">&quot;æš‚åœ&quot;</span>çŠ¶æ€çš„å®¹å™¨,è§£å‹åå¤§å°åªæœ‰<span class="hljs-number">100</span>ï½200KB</span><br><span class="hljs-meta">&gt;</span> <span class="javascript">Podå£°æ˜å‘¨æœŸåªè·ŸInfraå®¹å™¨ä¸€è‡´ï¼Œè€Œä¸å®¹å™¨Aå’ŒBæ— å…³</span><br></code></pre></td></tr></table></figure></li>
<li>å®¹å™¨è®¾è®¡æ¨¡å¼<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> sidecar</span><br><span class="hljs-meta">  &gt;</span><span class="bash"> æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªPodä¸­å¯åŠ¨ä¸€ä¸ªè¾…åŠ©å®¹å™¨ï¼Œæ¥å®Œæˆä¸€äº›ç‹¬ç«‹ä¸»å®¹å™¨ä¹‹å¤–çš„å·¥ä½œ</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> Istio - å¾®æœåŠ¡æ²»ç†é¡¹ç›®</span><br><span class="hljs-meta">  &gt;</span><span class="bash"> ä½¿ç”¨sidecarå®¹å™¨å®Œæˆå¾®æœåŠ¡æ²»ç†çš„åŸç†</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li>æ·±å…¥è§£æPodå¯¹è±¡(-): åŸºæœ¬æ¦‚å¿µ<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-quote">&gt; Kubernetes é¡¹ç›®çš„æœ€å°ç¼–æ’å•å…ƒ &quot;Pod&quot;</span><br><span class="hljs-quote">&gt; Podæ‰®æ¼”çš„æ˜¯ä¼ ç»Ÿéƒ¨ç½²ç¯å¢ƒé‡Œ&quot;è™šæ‹Ÿæœº&quot;çš„è§’è‰²</span><br><br><span class="hljs-section"># Podå±æ€§</span><br><span class="hljs-bullet">  -</span> è°ƒåº¦ã€ç½‘ç»œã€å­˜å‚¨ã€å®‰å…¨<br><span class="hljs-bullet">  -</span> NodeSelector (å°†Podä¸Nodeè¿›è¡Œç»‘å®šçš„å­—æ®µ)<br><span class="hljs-bullet">  -</span> NodeName: (è°ƒåº¦çš„ç»“æœ)<br><span class="hljs-bullet">  -</span> å‡¡æ˜¯Podä¸­çš„å®¹å™¨è¦å…±äº«å®¿ä¸»æœºçš„Namespace,ä¸€å®šæ˜¯Podçº§åˆ«çš„å®šä¹‰<br><br><span class="hljs-section"># Containerå±æ€§</span><br><span class="hljs-bullet">  -</span> ImagePullPolicy: é•œåƒæ‹‰å–ç­–ç•¥<br><br><span class="hljs-section"># Podå¯¹è±¡åœ¨Kubernetesä¸­çš„å£°æ˜å‘¨æœŸ</span><br><span class="hljs-bullet">  -</span> phase:<br><span class="hljs-bullet">    -</span> Pending: Podçš„YAMLæ–‡ä»¶å·²ç»æäº¤Kubernetes, APIå¯¹è±¡å·²ç»è¢«åˆ›å»ºä¿å­˜åœ¨Etcdå½“ä¸­<br><span class="hljs-bullet">    -</span> Running: Podå·²ç»è°ƒåº¦æˆåŠŸ,ä¸å…·ä½“èŠ‚ç‚¹ç»‘å®š<br><span class="hljs-bullet">    -</span> Succeeded: Podä¸­æ‰€æœ‰å®¹å™¨éƒ½æ­£å¸¸è¿è¡Œå®Œæ¯•ï¼Œå¹¶ä¸”å·²ç»é€€å‡º<br><span class="hljs-bullet">    -</span> Failed: Podä¸­è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ä»¥ä¸æ­£å¸¸çš„çŠ¶æ€é€€å‡º<br><span class="hljs-bullet">    -</span> Unknown: PodçŠ¶æ€ä¸èƒ½æŒç»­è¢«kubeletä¸ŠæŠ¥ç»™kube-apiserver<br><span class="hljs-bullet">  -</span> status.condation<br><span class="hljs-bullet">    -</span> PodScheduled:<br><span class="hljs-bullet">    -</span> Initialized<br><span class="hljs-bullet">    -</span> Ready<br><span class="hljs-bullet">    -</span> ContainersReady<br><span class="hljs-section"># Volume</span><br><span class="hljs-bullet">  -</span> Projected Volume<br><span class="hljs-bullet">    -</span> Secret: åŠ å¯†æ•°æ®å­˜æ”¾åœ¨Etcd,é€šè¿‡Podå®¹å™¨æŒ‚è½½Volumeæ–¹å¼è®¿é—®Secret,Secretå¯¹è±¡å­˜å‚¨æ•°æ®ç»è¿‡base64è½¬ç <br><span class="hljs-bullet">    -</span> ConfigMap: ä¿å­˜ä¸éœ€è¦åŠ å¯†ã€åº”ç”¨æ‰€éœ€çš„é…ç½®ä¿¡æ¯<br><span class="hljs-bullet">    -</span> Downward API: ç›´æ¥è·å–Pod API å¯¹è±¡æœ¬èº«çš„ä¿¡æ¯<br><span class="hljs-bullet">      -</span> spec.nodeName: å®¿ä¸»æœºåå­—<br><span class="hljs-bullet">      -</span> status.hostIP: å®¿ä¸»æœºIP<br><span class="hljs-bullet">      -</span> metadata.name: Podåå­—<br><span class="hljs-bullet">      -</span> metadata.namespace: Podçš„Namespace<br><span class="hljs-bullet">      -</span> status.podIP: Podçš„IP<br><span class="hljs-bullet">      -</span> spec.serviceAccountName:<br><span class="hljs-bullet">      -</span> metadata.uid<br><span class="hljs-bullet">      -</span> metadata.labels<br><span class="hljs-bullet">      -</span> metadata.annotations<br><span class="hljs-bullet">      -</span> metadata.labels<br><span class="hljs-bullet">      -</span> metadata.annotations<br><span class="hljs-bullet">    -</span> ServiceAccountToken<br><span class="hljs-code">      &gt; Service Accountå¯¹è±¡æ˜¯Kubernetesç³»ç»Ÿå†…ç½®çš„ä¸€ç§&quot;æœåŠ¡è´¦æˆ·&quot;,æ˜¯Kubernetesè¿›è¡Œæƒé™åˆ†é…çš„å¯¹è±¡</span><br><span class="hljs-code"></span><br>ç¯å¢ƒå˜é‡è·å–ä¿¡æ¯çš„æ–¹å¼ä¸å…·å¤‡è‡ªåŠ¨æ›´æ–°çš„èƒ½åŠ›,å»ºè®®ä½¿ç”¨Volumeæ–‡ä»¶çš„æ–¹å¼è·å–è¿™äº›ä¿¡æ¯<br>è¿™ç§æŠŠKuberneteså®¢æˆ·ç«¯ä»¥å®¹å™¨çš„æ–¹å¼è¿è¡Œåœ¨é›†ç¾¤é‡Œï¼Œç„¶åä½¿ç”¨default Service Accountè‡ªåŠ¨æˆæƒçš„æ–¹å¼ï¼Œç§°ä½œ&quot;InClusterConfig&quot;ï¼ŒKubernetes APIç¼–ç¨‹çš„æˆæƒæ–¹å¼<br><br><span class="hljs-section"># å®¹å™¨å¥åº·æ£€æŸ¥å’Œæ¢å¤æœºåˆ¶</span><br><span class="hljs-bullet">  -</span> Probe(æ¢é’ˆ)<br><br>  &gt; Kubernetesä¸­å¹¶æ²¡æœ‰Dockerçš„Stop,è™½ç„¶æ˜¯Restart,<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Kubernetes-æŠ€èƒ½å›¾è°±"><a href="#Kubernetes-æŠ€èƒ½å›¾è°±" class="headerlink" title="Kubernetes æŠ€èƒ½å›¾è°±"></a>Kubernetes æŠ€èƒ½å›¾è°±</h2><p><img src="/misc/images/kubernetes-rollmap.jpg" alt="Kubernetes æŠ€èƒ½å›¾è°±"></p>
<h2 id="Awesome-Tools"><a href="#Awesome-Tools" class="headerlink" title="Awesome Tools"></a>Awesome Tools</h2><ul>
<li><a href="https://github.com/ahmetb/kubectx">kubectx + kubens: Power tools for kubectl</a></li>
<li><a href="https://github.com/ktr0731/evans">evans Universal gRPC client</a></li>
</ul>
<h3 id="WarmUp"><a href="#WarmUp" class="headerlink" title="WarmUp"></a>WarmUp</h3><ul>
<li>ä¸€æ—¦è¦è¿½æ±‚é¡¹ç›®çš„æ™®é€‚æ€§ï¼Œé‚£å°±ä¸€å®šè¦ä»é¡¶å±‚å¼€å§‹åšå¥½è®¾è®¡</li>
</ul>
<h3 id="ä¸“ä¸šæœ¯è¯­"><a href="#ä¸“ä¸šæœ¯è¯­" class="headerlink" title="ä¸“ä¸šæœ¯è¯­"></a>ä¸“ä¸šæœ¯è¯­</h3><ul>
<li>PaaS (Platform as a Service): å¹³å°å³æœåŠ¡</li>
<li>BaaS (Backend as a Service): åç«¯å³æœåŠ¡</li>
<li>GA (General Availability): ä¸€èˆ¬å¯ç”¨æ€§</li>
</ul>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul>
<li><a href="https://kubernetes.io/zh/docs/concepts/overview/">Kubernetesæ–‡æ¡£</a></li>
<li><a href="https://www.usenix.org/system/files/conference/hotcloud16/hotcloud16_burns.pdf">å®¹å™¨è®¾è®¡æ¨¡å¼</a></li>
</ul>
]]></content>
      <categories>
        <category>Cloud Native</category>
      </categories>
  </entry>
  <entry>
    <title>Prometheus+Grafana Intro</title>
    <url>/2021/09/19/Prometheus-Grafana-Intro/</url>
    <content><![CDATA[<h2 id="Prometheus"><a href="#Prometheus" class="headerlink" title="Prometheus"></a>Prometheus</h2><ul>
<li>First Steps<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># Downloading Prometheus</span><br>  âœ wget https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/prometheus/</span>prometheus<span class="hljs-regexp">/releases/</span>download<span class="hljs-regexp">/v2.30.0/</span>prometheus-<span class="hljs-number">2.30</span>.<span class="hljs-number">0</span>.linux-arm64.tar.gz<br>  âœ tar -xvf prometheus-<span class="hljs-number">2.30</span>.<span class="hljs-number">0</span>.linux-arm64.tar.gz<br>  âœ cd prometheus-<span class="hljs-number">2.30</span>.<span class="hljs-number">0</span>.linux-arm64<br><br><span class="hljs-comment"># Configuring Prometheus</span><br>  âœ tree -L <span class="hljs-number">1</span><br>  .<br>  â”œâ”€â”€ console_libraries<br>  â”œâ”€â”€ consoles<br>  â”œâ”€â”€ LICENSE<br>  â”œâ”€â”€ NOTICE<br>  â”œâ”€â”€ prometheus<br>  â”œâ”€â”€ prometheus.yml      -- a sample configuration<br>  â””â”€â”€ promtool<br><br>  <span class="hljs-number">2</span> directories, <span class="hljs-number">5</span> files<br><br><span class="hljs-comment"># Starting Prometheus</span><br><br></code></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>Cloud Native</category>
      </categories>
  </entry>
  <entry>
    <title>Cyclic redundancy check Intro</title>
    <url>/2021/09/21/Cyclic-redundancy-check-Intro/</url>
    <content><![CDATA[<h1 id="CRC-Cyclic-redundancy-check"><a href="#CRC-Cyclic-redundancy-check" class="headerlink" title="CRC - Cyclic redundancy check"></a>CRC - Cyclic redundancy check</h1><blockquote>
<p>A cyclic redundancy check (CRC) is an error-detecting code commonly used in digital network and storage device to detect accidental changes to raw data.</p>
</blockquote>
<h2 id="CRC-16-æ ¡éªŒç "><a href="#CRC-16-æ ¡éªŒç " class="headerlink" title="CRC-16 æ ¡éªŒç "></a>CRC-16 æ ¡éªŒç </h2>]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>Have Read - Structure and Interpretation of Computer Programs</title>
    <url>/2021/09/21/Have-Read-Structure-and-Interpretation-of-Computer-Programs/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Docker Intro</title>
    <url>/2021/09/26/Docker-Intro/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Go Tips Tracks</title>
    <url>/2021/09/27/Go-Tips-Tracks/</url>
    <content><![CDATA[<h1 id="Go-Tips-Tracks"><a href="#Go-Tips-Tracks" class="headerlink" title="Go Tips Tracks"></a>Go Tips Tracks</h1><span id="more"></span>

<h2 id="Go-Tips"><a href="#Go-Tips" class="headerlink" title="Go Tips"></a>Go Tips</h2><ul>
<li><p><strong>Go Tip #1</strong>: Goâ€™s Package Management and Module Systems</p>
<figure class="highlight vhdl"><table><tr><td class="code"><pre><code class="hljs vhdl">&gt; A <span class="hljs-keyword">package</span> manager <span class="hljs-keyword">is</span> a tool <span class="hljs-keyword">for</span> automating the <span class="hljs-keyword">process</span> <span class="hljs-keyword">of</span> building<br>&gt; <span class="hljs-keyword">in</span> <span class="hljs-number">2018</span>, Go team finally introduced Go modules Go <span class="hljs-number">1.11</span> but wasn<span class="hljs-symbol">&#x27;t</span> enabled by <span class="hljs-keyword">default</span>. <span class="hljs-keyword">To</span> turn it <span class="hljs-keyword">on</span>, $ GO111MODULE = <span class="hljs-keyword">on</span>, Go <span class="hljs-number">1.14</span>, modules are now enabled by <span class="hljs-keyword">default</span><br><br># GOPATH (Go workspace)<br>  &gt; assumed $HOME/go <span class="hljs-keyword">on</span> Unix system, %USERPROFILE%\go <span class="hljs-keyword">on</span> Windows<br>  &gt; As <span class="hljs-keyword">of</span> Go v1.<span class="hljs-number">13</span>, $GOPATH mechanics <span class="hljs-keyword">is</span> now largely irrelevant(æ— å…³ç´§è¦).<br><br># Getting started <span class="hljs-keyword">with</span> Modules<br>  $ go <span class="hljs-keyword">mod</span> init &lt;module name&gt; (The module name doubles as the import path, which allows internal imports <span class="hljs-keyword">to</span> be resolved inside the module.)<br><br># Installing dependencies<br>  $ go get k8s.io/client-go@latest (adds a <span class="hljs-keyword">new</span> dependency )<br>  $ go get -u &lt;&gt; (-u=patch <span class="hljs-keyword">to</span> upgrade a dependency <span class="hljs-keyword">to</span> a <span class="hljs-keyword">new</span> minor <span class="hljs-keyword">or</span> patch version)<br>  // indirect comment indicates that this <span class="hljs-keyword">package</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> currently being used <span class="hljs-keyword">in</span> the project<br><br>  $ go <span class="hljs-keyword">mod</span> tidy (cleans up unused dependencies <span class="hljs-keyword">or</span> adds missing depenencies)<br>  $ go <span class="hljs-keyword">mod</span> vendor (create a vendor directory <span class="hljs-keyword">in</span> your project root. <span class="hljs-keyword">all</span> the project dependencies (direct <span class="hljs-keyword">and</span> indirect) required <span class="hljs-keyword">to</span> build your project are copied over <span class="hljs-keyword">to</span> the directory)<br>  $ go build (compile packages <span class="hljs-keyword">and</span> dependencies)<br><br># Using replace <span class="hljs-keyword">in</span> go.<span class="hljs-keyword">mod</span> <span class="hljs-keyword">to</span> point <span class="hljs-keyword">to</span> your local module<br>  &gt; point <span class="hljs-keyword">to</span> the local version <span class="hljs-keyword">of</span> a dependency <span class="hljs-keyword">in</span> Go rather than the one over the web, <span class="hljs-keyword">use</span> the replace keyword.<br>  $ go <span class="hljs-keyword">mod</span> edit -replace github.com/pselle/bar=/Users/pselle/Projects/bar<br></code></pre></td></tr></table></figure></li>
<li><p><strong>Go Tip #2</strong>: Go module proxy</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><code class="hljs vim">&gt; Goproxy.<span class="hljs-keyword">cn</span> <span class="hljs-built_in">has</span> fully implemented the GOPROXY protocol. provide <span class="hljs-keyword">a</span> free, trusted, always <span class="hljs-keyword">on</span>, <span class="hljs-built_in">and</span> globally CDNed Go module proxy <span class="hljs-keyword">for</span> Gophers in China.<br><br>$ <span class="hljs-keyword">go</span> env -<span class="hljs-keyword">w</span> GO111MODULE=<span class="hljs-keyword">on</span><br>$ <span class="hljs-keyword">go</span> env -<span class="hljs-keyword">w</span> GOPROXY=http<span class="hljs-variable">s:</span>//goproxy.<span class="hljs-keyword">cn</span>,direct<br><br># Linux<br>  $ <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;export GO111MODULE=on&quot;</span> &gt;&gt; ~/.<span class="hljs-keyword">profile</span><br>  $ <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;export GOPROXY=https://goproxy.cn&quot;</span> &gt;&gt; ~/.<span class="hljs-keyword">profile</span><br>  $ <span class="hljs-keyword">source</span> ~/.<span class="hljs-keyword">profile</span><br></code></pre></td></tr></table></figure></li>
<li><p><strong>Go Tip #3</strong>: GOPATH, GOROOT, GOBIN</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><code class="hljs crmsh"><span class="hljs-comment"># GOPATH: is the root of the workspace and contains the following folders</span><br>  - src : <span class="hljs-keyword">location</span> <span class="hljs-title">of</span> source files: .go,.c,.g,.s<br>  - pkg : <span class="hljs-keyword">location</span> <span class="hljs-title">of</span> compiled packages (.a files)<br>  - bin : <span class="hljs-keyword">location</span> <span class="hljs-title">of</span> executables built by Go<br><span class="hljs-comment"># GOBIN:</span><br>  &gt; The directory where **go install** <span class="hljs-keyword">and</span> **go get** will place binaries after building main packages.<br><span class="hljs-comment"># GOROOT:</span><br>  &gt; The <span class="hljs-keyword">location</span> <span class="hljs-title">of</span> your Go installation. It is used to find the standard libraries.<br></code></pre></td></tr></table></figure></li>
<li><p><strong>Go Tip #4</strong>: Go Version Management goenv</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># goenv</span><br><span class="hljs-bullet">  -</span> <br></code></pre></td></tr></table></figure></li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>Awesome Tools Intro</title>
    <url>/2021/09/28/Awesome-Tools-Intro/</url>
    <content><![CDATA[<h1 id="å·¥æ¬²å–„å…¶äº‹-å¿…å…ˆåˆ©å…¶å™¨"><a href="#å·¥æ¬²å–„å…¶äº‹-å¿…å…ˆåˆ©å…¶å™¨" class="headerlink" title="å·¥æ¬²å–„å…¶äº‹ å¿…å…ˆåˆ©å…¶å™¨"></a>å·¥æ¬²å–„å…¶äº‹ å¿…å…ˆåˆ©å…¶å™¨</h1><blockquote>
<p>If you want to do good things, you must first sharpen your tools.</p>
</blockquote>
<span id="more"></span>
]]></content>
      <categories>
        <category>Computer Science</category>
      </categories>
  </entry>
  <entry>
    <title>Code Review Intro</title>
    <url>/2021/09/28/Code-Review-Intro/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Hyperledger Fabric Intro</title>
    <url>/2021/09/28/Hyperledger-Fabric-Intro/</url>
    <content><![CDATA[<h1 id="Hyperledger-Fabric"><a href="#Hyperledger-Fabric" class="headerlink" title="Hyperledger Fabric"></a>Hyperledger Fabric</h1><blockquote>
<p>Hyperledger Fabric 1.4 LTS - long-term support release<br>Hyperledger Fabric is a permissioned blockchain network(è®¸å¯åŒºå—é“¾ç½‘ç»œ).</p>
</blockquote>
<span id="more"></span>

<h2 id="Hyperledger-Fabric-Architecture"><a href="#Hyperledger-Fabric-Architecture" class="headerlink" title="Hyperledger Fabric Architecture"></a>Hyperledger Fabric Architecture</h2><ul>
<li>Simplest Hyperledger Fabric network with two organizations joining the same channel<br><img src="/misc/images/fabric-network-1.png" alt="Simplest Fabric network with two organizations joining the same channel"></li>
</ul>
  <figure class="highlight pf"><table><tr><td class="code"><pre><code class="hljs pf"><span class="hljs-comment"># Fabric components</span><br>  - Peer:<br>    &gt; is blockchain node that stores <span class="hljs-literal">all</span> transactions <span class="hljs-keyword">on</span> a joining channel.<br><br>  - Orderer:<br>    &gt; is the most important components used <span class="hljs-keyword">in</span> the Farbic consensus mechanism (å…±è¯†æœºåˆ¶)<br>    &gt; is a service responsible <span class="hljs-keyword">for</span> ordering transactions(äº¤æ˜“æ’åº), creating a new <span class="hljs-built_in">block</span> of ordered transactions, and distributing a newly created <span class="hljs-built_in">block</span> <span class="hljs-keyword">to</span> <span class="hljs-literal">all</span> peers <span class="hljs-keyword">on</span> a relevant channel.<br><br>  - CA (Certificate Authority) è¯ä¹¦é¢å‘æœºæ„:<br>    - ç®¡ç†ç”¨æˆ·è¯ä¹¦:<br>      - <span class="hljs-keyword">user</span> registration: ç”¨æˆ·æ³¨å†Œ<br>      - <span class="hljs-keyword">user</span> enrollment: ç”¨æˆ·ç™»è®°<br>      - <span class="hljs-keyword">user</span> revocation: ç”¨æˆ·æ’¤é”€<br><br>    - standard certificate: æ ‡å‡†è¯ä¹¦<br>      - Hyperledger Fabric uses an X.<span class="hljs-number">509</span> srandard certificate <span class="hljs-keyword">to</span> represent permissions, roles, and attributes <span class="hljs-keyword">to</span> each <span class="hljs-keyword">user</span>.<br>      - <span class="hljs-keyword">user</span> is able <span class="hljs-keyword">to</span> query or invoke <span class="hljs-literal">any</span> transaction <span class="hljs-keyword">on</span> <span class="hljs-literal">any</span> channel based <span class="hljs-keyword">on</span> permissions, roles, and attributes possesses.<br><br>  - Client:<br>    &gt; is considered <span class="hljs-keyword">to</span> be an application that interacts with Fabric blockchain network.<br></code></pre></td></tr></table></figure>

<ul>
<li><p>Endorsing Peer(èƒŒä¹¦) vs Committing Peer()<br><img src="/misc/images/fabric_endorse_peer_commit_peer.png" alt="Endorsing Peer vs Committing Peer"></p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># Chaincode (Smart Contract)</span><br>  - three language (Golang, Nodejs, Java) program Fabric chaincode - é“¾ç <br>  - è¦éƒ¨ç½²é“¾ç ï¼Œç½‘ç»œç®¡ç†å‘˜å°†é“¾ç å®‰è£…åˆ°ç›®æ ‡peer,ç„¶åè°ƒç”¨ordereræ’åºèŠ‚ç‚¹å°†é“¾ç å®ä¾‹åŒ–åˆ°ç‰¹å®šchannelé€šé“ä¸Š.<br>  - Endorsement policy defines which peers need <span class="hljs-keyword">to</span> agree <span class="hljs-keyword">on</span> <span class="hljs-keyword">the</span> results <span class="hljs-keyword">of</span> a <span class="hljs-keyword">transaction</span> <span class="hljs-keyword">before</span> <span class="hljs-keyword">the</span> <span class="hljs-keyword">transaction</span> can be added <span class="hljs-keyword">onto</span> ledgers <span class="hljs-keyword">of</span> all peers <span class="hljs-keyword">on</span> <span class="hljs-keyword">the</span> channel.<br>  - A chaincode developer must opt <span class="hljs-keyword">to</span> use either LevelDB <span class="hljs-keyword">or</span> CouchDB when developing a chaincode.<br><br><span class="hljs-comment"># Endorsing Peer èƒŒä¹¦èŠ‚ç‚¹</span><br>  &gt; which consists <span class="hljs-keyword">of</span> an installed chaincode <span class="hljs-keyword">and</span> a <span class="hljs-keyword">local</span> ledger <span class="hljs-keyword">on</span> <span class="hljs-keyword">it</span><br><br><span class="hljs-comment"># Committing Peer</span><br>  &gt; would have only a <span class="hljs-keyword">local</span> ledger <span class="hljs-keyword">on</span> <span class="hljs-keyword">it</span>.<br></code></pre></td></tr></table></figure></li>
<li><p>Interior components inside the Peerâ€™s ledger<br><img src="/misc/images/fabric-ledger-components.png" alt="Interior components inside the Peer&#39;s ledger"></p>
<figure class="highlight pf"><table><tr><td class="code"><pre><code class="hljs pf"><span class="hljs-comment"># Blockchain</span><br>  &gt; the history of alll transactions <span class="hljs-keyword">for</span> every chaincode <span class="hljs-keyword">on</span> a particular channel.<br><br><span class="hljs-comment"># World State:</span><br>  &gt; maintains the current <span class="hljs-keyword">state</span> of variables <span class="hljs-keyword">for</span> each specific chaincode.<br><br>  - Two type database:<br>    - LevelDB:<br>      &gt; key-value database built <span class="hljs-keyword">on</span> Fabric Peer<br><br>    - CouchDB:<br>      &gt; JSON-based database supporting rich querying operations based <span class="hljs-keyword">on</span> JSON objects.<br></code></pre></td></tr></table></figure></li>
<li><p>Fabric network with chaincodes and ledgers attached multiple channels<br><img src="/misc/images/fabric-network-2.png" alt="Fabric network with chaincodes and ledgers attached"></p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><code class="hljs livecodeserver">&gt; Actually, <span class="hljs-keyword">the</span> <span class="hljs-keyword">system</span> chaincodes <span class="hljs-keyword">and</span> ledgers are also deployed <span class="hljs-keyword">on</span> <span class="hljs-title">peers</span><br><br><span class="hljs-comment"># System Chaincodes</span><br>  &gt; collect network, channel, <span class="hljs-keyword">and</span> underlying <span class="hljs-keyword">system</span> configurations <span class="hljs-keyword">for</span> Fabric virtual machine <span class="hljs-built_in">to</span> work properly.<br><br>  - QSCC (Query System Chaincode): <span class="hljs-keyword">for</span> ledger <span class="hljs-keyword">and</span> Fabric-related queries<br>  - CSCC (Configuration System Chaincode): which helps regulate access control<br>  - LSCC (Lifecycle System Chaincode): which defines <span class="hljs-keyword">the</span> rules <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> channel<br>  - ESCC (Endorsement System Chaincode): endorsing transactions<br>  - VSCC (Validation System Chaincode): validating transactions<br><br><span class="hljs-comment"># System Ledgers</span><br><br><span class="hljs-comment"># Channel</span><br>  &gt; organizations that join <span class="hljs-keyword">the</span> same channel can secretly share business transaction <span class="hljs-keyword">or</span> information together <span class="hljs-keyword">with</span> confidence.<br><br><span class="hljs-comment"># Chaincode:</span><br>  - <span class="hljs-literal">one</span> chaincode can call another chaincode <span class="hljs-keyword">on</span> <span class="hljs-title">the</span> <span class="hljs-title">same</span> <span class="hljs-title">channel</span>.<br></code></pre></td></tr></table></figure></li>
<li><p>Fabric transaction invocation workflow (æŠ•ç¥¨æµç¨‹å›¾)<br><img src="/misc/images/fabric-transaction-invocation-workflow.png" alt="Fabric transaction invocation workflow"></p>
<figure class="highlight pf"><table><tr><td class="code"><pre><code class="hljs pf"><span class="hljs-comment"># consensus(å…±è¯†) divided into tree phases</span><br>  - <span class="hljs-number">1</span>. Endorsement (èƒŒä¹¦) (Steps <span class="hljs-number">1</span>-<span class="hljs-number">3</span>)<br>  - <span class="hljs-number">2</span>. Ordering (æ’åº) (Steps <span class="hljs-number">4</span>-<span class="hljs-number">5</span>)<br>  - <span class="hljs-number">3</span>. Validation and Commitment(éªŒè¯å’Œæ‰¿è¯º) (Steps <span class="hljs-number">6</span>)<br><br><span class="hljs-comment"># Fabric transaction workflow:</span><br>  - <span class="hljs-number">1</span>. Client:åˆ›å»ºäº¤æ˜“æè®®ï¼Œå¹¶ä½¿ç”¨ç”¨æˆ·è¯ä¹¦è¿›è¡Œç­¾åï¼Œç„¶åå‘é€äº¤æ˜“åˆ°ç‰¹å®šé€šé“ä¸Šé¢„å…ˆç¡®å®šçš„èƒŒä¹¦èŠ‚ç‚¹ä¸Š<br>  - <span class="hljs-number">2</span>. (Endorsing Peer) é¦–å…ˆä»äº¤æ˜“æè®®ä¸­éªŒè¯ç”¨æˆ·èº«ä»½å’Œæˆæƒ, éªŒè¯é€šè¿‡åï¼ŒèƒŒä¹¦èŠ‚ç‚¹æ¨¡æ‹Ÿäº¤æ˜“, ç”Ÿæˆç›¸åº”å’Œè¯»å†™é›†ï¼Œå¹¶ä½¿ç”¨è¯ä¹¦å¯¹ç”Ÿæˆçš„å“åº”è¿›è¡ŒèƒŒä¹¦<br>  - <span class="hljs-number">3</span>. Client: accumulateå¹¶æ£€æŸ¥æ¥è‡ªèƒŒä¹¦èŠ‚ç‚¹çš„èƒŒä¹¦ææ¡ˆå“åº”.<br>  - <span class="hljs-number">4</span>. Client: å°†é™„æœ‰èƒŒä¹¦ææ¡ˆå“åº”çš„äº¤æ˜“å‘ç»™Orderer.<br>  - <span class="hljs-number">5</span>. Orderer: å¯¹æ¥æ”¶åˆ°çš„äº¤æ˜“è¿›è¡Œæ’åºï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„æœ‰åºäº¤æ˜“å¿«ï¼Œå¹¶ç”¨å…¶è¯ä¹¦å¯¹ç”Ÿæˆçš„å¿«è¿›è¡Œç­¾å<br>  - <span class="hljs-number">6</span>. Orderer: å°†ç”Ÿæˆçš„å¿«å¹¿æ’­ç»™ç›¸å…³é€šé“ä¸Šçš„æ‰€æœ‰å¯¹ç­‰(endorse peer, commit peer)èŠ‚ç‚¹. ç„¶åæ¯ä¸ªPeerç¡®ä¿æ¥æ”¶åˆ°çš„åŒºå—ä¸­çš„æ¯æ¬¡äº¤æ˜“éƒ½ç”±é€‚å½“çš„èƒŒä¹¦(Endorsing Peers)ç­¾å(æ ¹æ®è°ƒç”¨çš„é“¾ç çš„èƒŒä¹¦ç­–ç•¥ç¡®å®š)å¹¶ä¸”å­˜åœ¨è¶³å¤Ÿçš„èƒŒä¹¦. ä¹‹åï¼Œå°†è¿›è¡Œç‰ˆæœ¬æ£€æŸ¥(Multi-version concurrency control MVCC æ£€æŸ¥) ä»¥éªŒè¯æ¥æ”¶åˆ°çš„å¿«çš„äº¤æ˜“çš„æ­£ç¡®æ€§. æ¯ä¸€ä¸ªPeerèŠ‚ç‚¹éƒ½ä¼šå°†æ¯ä¸ªäº¤æ˜“çš„readsetä¸å…¶åˆ†ç±»å¸çš„ä¸–ç•ŒçŠ¶æ€è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœéªŒè¯æ£€æŸ¥é€šè¿‡ï¼Œåˆ™äº¤æ˜“è¢«æ ‡è®°ä¸ºæœ‰æ•ˆï¼Œå¹¶ä¸”æ¯ä¸ªPeerçš„word <span class="hljs-keyword">state</span>éƒ½ä¼šæ›´æ–°, å¦åˆ™ï¼Œäº¤æ˜“è¢«æ ‡è®°ä¸ºæ— æ•ˆè€Œä¸æ›´æ–°world <span class="hljs-keyword">state</span>. æœ€åï¼Œæ— è®ºè¯¥<span class="hljs-built_in">block</span>æ˜¯å¦åŒ…å«ä»»ä½•æ— æ•ˆçš„äº¤æ˜“ï¼Œæ¥æ”¶åˆ°çš„<span class="hljs-built_in">block</span>éƒ½ä¼šè¿½åŠ åˆ°PeerèŠ‚ç‚¹çš„æœ¬åœ°blockchainä¸­.<br>  - <span class="hljs-number">7</span>. Client: å®¢æˆ·ç«¯ä»EventHubæœåŠ¡æ¥å—è®¢é˜…çš„äº‹ä»¶<br></code></pre></td></tr></table></figure></li>
<li><p>Fabric Orderer Service</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><code class="hljs mipsasm">&gt; It acts as a Hub for <span class="hljs-keyword">distributing </span><span class="hljs-keyword">blocks </span>of transactions to all peers on a relevant channel.<br>&gt; <span class="hljs-keyword">Orderer </span>might <span class="hljs-keyword">be </span>considered to <span class="hljs-keyword">be </span>the weakest point in the Fabric network.<br><br><span class="hljs-comment"># two type of Fabric Orderer service</span><br>  - Solo-<span class="hljs-keyword">based </span><span class="hljs-keyword">ordering </span>service (ä»…ç”¨äºå¼€å‘é˜¶æ®µ)<br><br>  - Kafka-<span class="hljs-keyword">based </span><span class="hljs-keyword">ordering </span>service (æ­å»ºKafkaé›†ç¾¤)<br>    - Kafka provide Crash Fault tolerance (CFTå´©æºƒå®¹é”™) consensus(å…±è¯†)<br></code></pre></td></tr></table></figure></li>
<li><p>Fabric network in a production environment<br><img src="/misc/images/fabric-network-production.png" alt="Fabric network in a production environment"></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># Client application interact with Fabric blockchain network in two ways:</span><br><span class="hljs-bullet">  -</span> Fabric SDK<br><span class="hljs-code">    &gt; Fabric SDK supports Go, Node.js and Java language</span><br><span class="hljs-code"></span><br><span class="hljs-bullet">  -</span> Fabric CLI<br><span class="hljs-code">    &gt; use in development or maintenance mode</span><br><span class="hljs-code"></span><br><span class="hljs-section"># CA: ç”¨æˆ·ç®¡ç†å’Œè¯ä¹¦é¢å‘</span><br><span class="hljs-bullet">  -</span> Two ways to deploy Fabric CA:<br><span class="hljs-bullet">    -</span> 1. Fabric CA without LDAP Server:<br><span class="hljs-code">      &gt; Fabric CA è´Ÿè´£ ç”¨æˆ·æ³¨å†Œã€ç”¨æˆ·è®¤è¯ã€é¢å‘ç”¨æˆ·è¯ä¹¦.</span><br><span class="hljs-code"></span><br><span class="hljs-bullet">    -</span> 2. Fabric CA with LDAP Server:<br><span class="hljs-code">      &gt; Fabric CA è´Ÿè´£é¢å‘ç”¨æˆ·è¯ä¹¦</span><br><span class="hljs-code">      &gt; LDAP Server è´Ÿè´£ ç”¨æˆ·æ³¨å†Œã€ç”¨æˆ·è®¤è¯ã€æ’¤é”€ç”¨æˆ·</span><br><span class="hljs-code">      &gt; è¿™ç§æ–¹å¼é€‚åˆç»„ç»‡å­˜åœ¨çš„AD,LDAP or Radius server.</span><br><span class="hljs-code"></span><br><span class="hljs-section"># CouchDB:</span><br>  &gt; æ”¯æŒJSON æŸ¥è¯¢ï¼Œæ•°æ®åº“ç´¢å¼•ï¼Œæ•°æ®æ‹·è´ï¼ŒACID å±æ€§<br><br><span class="hljs-section"># LevelDB:</span><br>  &gt; æ”¯æŒæœ‰é™çš„æ“ä½œ<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Private-Data-Collection"><a href="#Private-Data-Collection" class="headerlink" title="Private Data Collection"></a>Private Data Collection</h2>  <figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">Fabric <span class="hljs-number">1.2</span>æ”¯æŒè¯¥ç‰¹æ€§</span><br></code></pre></td></tr></table></figure>

<ul>
<li><p>Overview of Private Data Collection<br><img src="/misc/images/fabric-private-data-collection.png" alt="Peer&#39;s ledger enabled for Private Data Collection use"></p>
<figure class="highlight pf"><table><tr><td class="code"><pre><code class="hljs pf"><span class="hljs-comment"># public data section:</span><br>  - public <span class="hljs-built_in">block</span> storage: å…¬å…±å¿«å­˜å‚¨<br>    &gt; is a blockchain that holds the history of <span class="hljs-literal">all</span> public transactions <span class="hljs-keyword">for</span> every chaincode instantiated <span class="hljs-keyword">on</span> a channel.<br><br>  - public <span class="hljs-keyword">state</span> database å…¬å…±çŠ¶æ€æ•°æ®åº“<br>    &gt; maintains the current <span class="hljs-keyword">state</span> of public variables <span class="hljs-keyword">for</span> a specific chaincode.<br><br>  &gt; å¯¹äºä»»ä½•ç‰¹å®šé€šé“channel,å³å…¬å…±æ•°æ®éƒ¨åˆ†ä»…åŒ…å«å•ä¸ªå…¬å…±å¿«å­˜å‚¨(public <span class="hljs-built_in">block</span> storage)å®ä¾‹, ä½†è¯¥éƒ¨åˆ†å¯ä»¥åŒ…å«åŸºäºåœ¨é€šé“ä¸Šå®ä¾‹åŒ–çš„å¤šä¸ªé“¾ç (chaincode)çš„å¤šä¸ªå…¬å…±çŠ¶æ€æ•°æ®åº“å®ä¾‹.<br><br><span class="hljs-comment"># private data section:</span><br>  - private writeset storage: ç§æœ‰å†™å…¥é›†å­˜å‚¨<br>    &gt; æ”¶é›†ç‰¹å®šç§æœ‰æ•°æ®é›†åˆçš„æ‰€æœ‰ç§æœ‰äº¤æ˜“çš„å†å²è®°å½•<br>    &gt; è¿™ç§å­˜å‚¨ä¸æ˜¯åŒºå—é“¾ï¼Œè€Œæ˜¯ä¸€ç§å…¸å‹çš„æ—¥å¿—æŒä¹…åŒ–æ•°æ®åº“<br><br>  - private <span class="hljs-keyword">state</span> database:<br>    &gt;<br><br>  - transient store database: ç¬æ€å­˜å‚¨æ•°æ®åº“<br>    &gt; è¿™ç§æ•°æ®åº“ç”¨ä½œä¸´æ—¶æ•°æ®åº“ï¼Œç”¨äºåœ¨äº¤æ˜“è°ƒç”¨è¿‡ç¨‹ä¸­ä¸´æ—¶å­˜å‚¨ç§æœ‰æ•°æ®<br></code></pre></td></tr></table></figure></li>
<li><p>Peers maintaining multiple Private Data Collections<br><img src="/misc/images/fabric-private-data-collection-2.png" alt="Peers maintaining multiple Private Data Collections"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">Public State Database:</span><br><span class="hljs-meta">  &gt;</span><span class="bash"> (å…¬å…±çŠ¶æ€æ•°æ®åº“)å­˜å‚¨ç‰¹å®šé“¾ç çš„å…¬å…±å˜é‡çš„å½“å‰å€¼, è¿˜å­˜å‚¨ä¸è¯¥ç‰¹å®šé“¾ç å…³è”çš„ä¿®æ”¹åçš„ç§æœ‰æ•°æ®é›†çš„å“ˆå¸Œå€¼.</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> Private data collections:</span><br><span class="hljs-meta">  &gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Fabric-1-4-12-æºä»£ç åˆ†æ"><a href="#Fabric-1-4-12-æºä»£ç åˆ†æ" class="headerlink" title="Fabric (1.4.12) æºä»£ç åˆ†æ"></a>Fabric (1.4.12) æºä»£ç åˆ†æ</h2>  <figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># ä¸‹è½½dockeré•œåƒã€é¢„ç¼–è¯‘ç¨‹åº</span><br>âœ curl -sSL https:<span class="hljs-regexp">//</span>bit.ly/<span class="hljs-number">2</span>ysbOFE | bash -s <span class="hljs-number">1.4</span>.<span class="hljs-number">12</span><br><br>$ cat https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/hyperledger/</span>fabric<span class="hljs-regexp">/blob/</span>release-<span class="hljs-number">1.4</span><span class="hljs-regexp">/scripts/</span>bootstrap.sh<br>  export VERSION=<span class="hljs-number">1.4</span>.<span class="hljs-number">12</span><br>  export CA_VERSION=<span class="hljs-number">1.4</span>.<span class="hljs-number">9</span><br></code></pre></td></tr></table></figure>

<h3 id="Fabric-Tips-amp-amp-Tracks"><a href="#Fabric-Tips-amp-amp-Tracks" class="headerlink" title="Fabric Tips &amp;&amp; Tracks"></a>Fabric Tips &amp;&amp; Tracks</h3><ul>
<li>Read-Write set semantics<figure class="highlight"><table><tr><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="ä¸“ä¸šæœ¯è¯­"><a href="#ä¸“ä¸šæœ¯è¯­" class="headerlink" title="ä¸“ä¸šæœ¯è¯­:"></a>ä¸“ä¸šæœ¯è¯­:</h3><ul>
<li><p>transaction (äº¤æ˜“):</p>
<blockquote>
<p>chaincodeçš„invokeæˆ–instantiateæ“ä½œï¼Œinvokeæ˜¯ä»ledgerä¸­è¯·æ±‚read-write set, instantiateæ˜¯è¯·æ±‚åœ¨peerä¸Šå¯åŠ¨chaincodeå®¹å™¨</p>
</blockquote>
</li>
<li><p>system chain (ç³»ç»Ÿé“¾):</p>
<blockquote>
<p>åŒ…å«åœ¨ç³»ç»Ÿçº§å®šä¹‰ç½‘ç»œçš„é…ç½®åŒºå—ä¸­ï¼Œç³»ç»Ÿé“¾å­˜åœ¨ä¸ordering serviceä¸­,ä¸channelç±»ä¼¼.</p>
</blockquote>
</li>
<li><p>state database (stateDB):</p>
<blockquote>
<p>current stateæ•°æ®å­˜å‚¨åœ¨stateDBä¸­ï¼ŒåŒ…æ‹¬levelDBå’ŒcouchDB.</p>
</blockquote>
</li>
<li><p>proposal(ææ¡ˆ):</p>
<blockquote>
<p>ä¸€ç§å¯¹channelä¸­æŸpeerçš„èƒŒä¹¦è¯·æ±‚ï¼Œæ¯ä¸ªproposalè¦ä¹ˆæ˜¯chaincode instantiate(å®ä¾‹),è¦ä¹ˆæ˜¯chaincode invoke(è°ƒç”¨).</p>
</blockquote>
</li>
<li><p>policy(ç­–ç•¥):</p>
</li>
<li><p>peer(èŠ‚ç‚¹):</p>
<blockquote>
<p>ç½‘ç»œå®ä½“,ç»´æŠ¤ledgerå¹¶è¿è¡Œchaincodeå®¹å™¨æ¥å¯¹ledgeræ‰§è¡Œread-writeæ“ä½œ</p>
</blockquote>
</li>
<li><p>ordering service(æ’åºæœåŠ¡/å…±è¯†æœåŠ¡):</p>
<blockquote>
<p>å°†äº¤æ˜“æ’åºæ”¾å…¥blockçš„èŠ‚ç‚¹çš„é›†åˆ,ä»¥å…ˆè¿›å…ˆå¾—çš„æ–¹å¼ä¸ºç½‘ç»œä¸Šæ‰€æœ‰çš„channelæä¾›äº¤æ˜“æ’åºæœåŠ¡.</p>
</blockquote>
</li>
<li><p>membership services(æˆå‘˜æœåŠ¡):</p>
<blockquote>
<p>åœ¨è®¸å¯çš„åŒºå—é“¾ç½‘ç»œä¸Šè®¤è¯ã€æˆæƒå’Œç®¡ç†èº«ä»½. åœ¨peerå’Œorderä¸­è¿è¡Œçš„æˆå‘˜æœåŠ¡çš„ä»£ç éƒ½ä¼šè®¤è¯å’ŒæˆæƒåŒºå—é“¾æ“ä½œ, ä»–æ˜¯åŸºäºPKIçš„MSPå®ç°çš„.<br>fabric-ca ç»„ä»¶å®ç°äº†æˆå‘˜æœåŠ¡ä»¥ç®¡ç†èº«ä»½ï¼Œå¤„ç†ECertå’ŒTCertçš„é¢å‘å’Œæ’¤é”€<br>ECertæ˜¯é•¿æœŸçš„èº«ä»½å‡­è¯ï¼ŒTCertæ˜¯çŸ­æœŸèº«ä»½å‡­è¯</p>
</blockquote>
</li>
<li><p>membership service provider (MSP):</p>
<blockquote>
</blockquote>
</li>
<li><p>Member(æˆå‘˜):</p>
<blockquote>
</blockquote>
</li>
<li><p>Ledger (è´¦æœ¬):</p>
<blockquote>
</blockquote>
</li>
<li><p>leading peer (ä¸»å¯¼èŠ‚ç‚¹):</p>
<blockquote>
<p>æ¯ä¸€ä¸ªmemberåœ¨å…¶è®¢é˜…çš„channelä¸Šå¯ä»¥æ‹¥æœ‰å¤šä¸ªpeer, å…¶ä¸­ä¸€ä¸ªpeerä¼šä½œä¸ºchannelçš„leading peerä»£è¡¨è¯¥memberä¸ordering serviceé€šä¿¡. ordering serviceå°†blockä¼ é€’ç»™leading peer, è¯¥peerå†å°†blockåˆ†å‘ç»™åŒä¸€memberä¸‹çš„å…¶ä»–peer.</p>
</blockquote>
</li>
<li><p>invoke (è°ƒç”¨):</p>
<blockquote>
<p>è°ƒç”¨chaincodeå†…çš„å‡½æ•°, invokeç»“æ„å°±æ˜¯ä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªå‚æ•°æ•°ç»„.</p>
</blockquote>
</li>
<li><p>instantiate (å®ä¾‹åŒ–):</p>
<blockquote>
<p>å¯åŠ¨chaincodeå®¹å™¨çš„è¿‡ç¨‹</p>
</blockquote>
</li>
<li><p>gossip protocol (Gossip åè®®):</p>
<blockquote>
<p>Gossip æ•°æ®ä¼ è¾“åè®®æœ‰ä¸‰é¡¹åŠŸèƒ½: ç®¡ç†peer discoveryå’Œchannel æˆå‘˜; åœ¨channelä¸Šæ‰€æœ‰çš„peeré—´å¹¿æ’­è´¦æœ¬æ•°æ®;åœ¨channelä¸Šæ‰€æœ‰çš„peeré—´åŒæ­¥è´¦æœ¬æ•°æ®</p>
</blockquote>
</li>
<li><p>genesis block (åˆå§‹åŒ–åŒºå—):</p>
<blockquote>
<p>genesis blockæ˜¯åˆå§‹åŒ–åŒºå—é“¾ç½‘ç»œæˆ–channelçš„é…ç½®åŒºå—ï¼Œä¹Ÿæ˜¯é“¾ä¸Šçš„ç¬¬ä¸€ä¸ªåŒºå—</p>
</blockquote>
</li>
<li><p>fabric-ca:</p>
<blockquote>
<p>é»˜è®¤çš„è¯ä¹¦ç®¡ç†ç»„ä»¶ï¼Œå‘ç½‘ç»œæˆå‘˜åŠå…¶ç”¨æˆ·é¢å‘åŸºäºPKIçš„è¯ä¹¦ï¼ŒCAä¸ºæ¯ä¸ªæˆå‘˜é¢å‘ä¸€ä¸ªæ ¹è¯ä¹¦(rootCert), ä¸ºæ¯ä¸€ä¸ªæˆæƒç”¨æˆ·é¢å‘ä¸€ä¸ªæ³¨å†Œè¯ä¹¦(eCert), æ¯ä¸€ä¸ªæ³¨å†Œè¯ä¹¦é¢å‘å¤§é‡äº¤æ˜“è¯ä¹¦(tCert)</p>
</blockquote>
</li>
<li><p>endorser:</p>
<blockquote>
<p>èƒŒä¹¦èŠ‚ç‚¹</p>
</blockquote>
</li>
<li><p>dynamic membership (åŠ¨æ€æˆå‘˜):</p>
<blockquote>
<p>fabric æ”¯æŒåŠ¨æ€æ·»åŠ ã€ç§»é™¤membersã€peerså’ŒorderingæœåŠ¡èŠ‚ç‚¹, è€Œä¸ä¼šå½±å“æ•´ä¸ªç½‘ç»œçš„æ“ä½œæ€§. å½“ä¸šåŠ¡ç³»ç»Ÿè°ƒæ•´æˆ–å› å„ç§åŸå› éœ€è¦æ·»åŠ ã€ç§»é™¤å®ä½“æ—¶.</p>
</blockquote>
</li>
<li><p>consensus (å…±è¯†):</p>
<blockquote>
<p>ç”¨äºäº§ç”Ÿä¸€ä¸ªå¯¹äºæ’åºçš„åŒæ„ä¹¦å’Œç¡®è®¤æ„æˆåŒºå—çš„äº¤æ˜“é›†çš„æ­£ç¡®æ€§</p>
</blockquote>
</li>
<li><p>concurrency control version check (å¹¶å‘æ§åˆ¶ç‰ˆæœ¬æ£€æŸ¥):</p>
<blockquote>
<p>CCVCæ—¶ä¿æŒé€šé“ä¸­å„å¯¹ç­‰èŠ‚ç‚¹é—´çŠ¶æ€åŒæ­¥çš„ä¸€ç§æ–¹å¼ï¼Œå¯¹ç­‰èŠ‚ç‚¹å¹¶è¡Œçš„æ‰§è¡Œäº¤æ˜“</p>
</blockquote>
</li>
<li><p>committer:</p>
<blockquote>
<p>æäº¤è€…</p>
</blockquote>
</li>
</ul>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p>  <a href="https://medium.com/coinmonks/demystifying-hyperledger-fabric-2-3-private-data-collection-164220ecafa5">Demystifying Hyperledger Fabric</a></p>
]]></content>
      <categories>
        <category>Blockchain</category>
      </categories>
  </entry>
  <entry>
    <title>LevelDB Intro</title>
    <url>/2021/09/28/LevelDB-Intro/</url>
    <content><![CDATA[<h1 id="LevelDB"><a href="#LevelDB" class="headerlink" title="LevelDB"></a>LevelDB</h1><blockquote>
<p>LevelDB is a fast key-value storage library written at Google that provides an ordered mapping from string keys to string values.</p>
</blockquote>
<span id="more"></span>

<h2 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h2><ul>
<li>keyå’Œvalueæ”¯æŒå­˜å‚¨ä»»æ„é•¿åº¦çš„å­—èŠ‚æ•°ç»„</li>
<li>æ•°æ®å­˜å‚¨æ ¹æ®Keyæ’åº</li>
<li>æ”¯æŒè‡ªå®šä¹‰æ’åºè§„åˆ™</li>
<li>åŸºæœ¬æ“ä½œæ˜¯Put(Key,value), Get(Key), Delete(Key)</li>
<li>æ”¯æŒæ‰¹é‡åŸå­æ“ä½œ</li>
<li>æ”¯æŒåˆ›å»ºäº‹åŠ¡å¿«ç…§è·å–ä¸€è‡´æ€§è§†å›¾æ•°æ®</li>
<li>Forward and backward iteration is supported over the data.</li>
<li>è‡ªåŠ¨ä½¿ç”¨Snappyç®—æ³•å‹ç¼©æ•°æ®</li>
</ul>
<h2 id="Limitations"><a href="#Limitations" class="headerlink" title="Limitations"></a>Limitations</h2><ul>
<li>Not SQL database</li>
<li>Only a single process (possibly multi-threaded) can access a particular database at a time</li>
<li>No client-server support builtin to the library</li>
</ul>
]]></content>
      <categories>
        <category>Middleware</category>
      </categories>
  </entry>
  <entry>
    <title>Bash Script CheetSheet</title>
    <url>/2021/10/09/Bash-Script-CheetSheet/</url>
    <content><![CDATA[<h1 id="Bash"><a href="#Bash" class="headerlink" title="Bash"></a>Bash</h1><blockquote>
<p>Bash is a name of the unix shell, which was also distributed as the shell for the GNU operating system and as the default shell on most linux distros.</p>
</blockquote>
<span id="more"></span>

<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/usr/bin/env bash</span><br><span class="hljs-comment"># First line of the script is the shebang which tells the system how to execute</span><br><span class="hljs-comment"># the script</span><br><br><span class="hljs-comment"># Simple hello world example:</span><br><span class="hljs-built_in">echo</span> Hello world!  <span class="hljs-comment"># =&gt; Hello world!</span><br><br><span class="hljs-comment"># Each command starts on a new line, or after a semicolon:</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;This is the first line&#x27;</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;This is the second line&#x27;</span><br><span class="hljs-comment"># =&gt; This is the first line</span><br><span class="hljs-comment"># =&gt; This is the second line</span><br><br><span class="hljs-comment"># Declaring a variable looks like this:</span><br>Variable=<span class="hljs-string">&quot;Some string&quot;</span><br><br><span class="hljs-comment"># Using the variable:</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$Variable</span>  <span class="hljs-comment"># =&gt; Some string</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$Variable</span>&quot;</span> <span class="hljs-comment"># =&gt; Some string</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;$Variable&#x27;</span> <span class="hljs-comment"># =&gt; $Variable</span><br><span class="hljs-comment"># When you use the variable itself - assign it, export it, or else - you write</span><br><span class="hljs-comment"># its name without $. If you want to use the variable&#x27;s value, you should use $.</span><br><span class="hljs-comment"># Not that &#x27; (single quote) wan&#x27;t expand the variables!</span><br><br><span class="hljs-comment"># Parameter expansion $&#123; &#125;:</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;Variable&#125;</span> <span class="hljs-comment"># =&gt; Some string</span><br><span class="hljs-comment"># This is a simple usage of parameter expansion</span><br><span class="hljs-comment"># Parameter Expansion gets a value from a variable.</span><br><span class="hljs-comment"># It &quot;expands&quot; or prints the value</span><br><span class="hljs-comment"># During the expansion time the value or parameter can be modified</span><br><span class="hljs-comment"># Below are other modifications that add onto this expansion</span><br><br><span class="hljs-comment"># String substitution in variables</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;Variable/Some/A&#125;</span> <span class="hljs-comment"># =&gt; A string</span><br><span class="hljs-comment"># This will substitute the first occurrence of &quot;Some&quot; with &quot;A&quot;</span><br><br><span class="hljs-comment"># Substring from a variable</span><br>Length=7<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;Variable:0:Length&#125;</span> <span class="hljs-comment"># =&gt; Some st</span><br><span class="hljs-comment"># This will return only the first 7 characters of the value</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;Variable: -5&#125;</span> <span class="hljs-comment"># =&gt; tring</span><br><span class="hljs-comment"># This will return the last 5 characters (note the space before -5)</span><br><br><span class="hljs-comment"># String length</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;#Variable&#125;</span> <span class="hljs-comment"># =&gt; 11</span><br><br><span class="hljs-comment"># Indirect expansion</span><br>OtherVariable=<span class="hljs-string">&quot;Variable&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;!OtherVariable&#125;</span> <span class="hljs-comment"># =&gt; Some String</span><br><span class="hljs-comment"># This will expand the value of OtherVariable</span><br><br><span class="hljs-comment"># Default value for variable</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;Foo:-&quot;DefaultValueIfFooIsMissingOrEmpty&quot;&#125;</span><br><span class="hljs-comment"># =&gt; DefaultValueIfFooIsMissingOrEmpty</span><br><span class="hljs-comment"># This works for null (Foo=) and empty string (Foo=&quot;&quot;); zero (Foo=0) returns 0.</span><br><span class="hljs-comment"># Note that it only returns default value and doesn&#x27;t change variable value.</span><br><br><span class="hljs-comment"># Declare an array with 6 elements</span><br>array0=(one two three four five six)<br><span class="hljs-comment"># Print first element</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$array0</span> <span class="hljs-comment"># =&gt; &quot;one&quot;</span><br><span class="hljs-comment"># Print first element</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;array0[0]&#125;</span> <span class="hljs-comment"># =&gt; &quot;one&quot;</span><br><span class="hljs-comment"># Print all elements</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;array0[@]&#125;</span> <span class="hljs-comment"># =&gt; &quot;one two three four five six&quot;</span><br><span class="hljs-comment"># Print number of elements</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;#array0[@]&#125;</span> <span class="hljs-comment"># =&gt; &quot;6&quot;</span><br><span class="hljs-comment"># Print number of characters in third element</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;#array0[2]&#125;</span> <span class="hljs-comment"># =&gt; &quot;5&quot;</span><br><span class="hljs-comment"># Print 2 elements starting from forth</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;array0[@]:3:2&#125;</span> <span class="hljs-comment"># =&gt; &quot;four five&quot;</span><br><span class="hljs-comment"># Print all elements. Each of them on new line.</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;array0[@]&#125;</span>&quot;</span>; <span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$i</span>&quot;</span><br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment"># Brace Expansion &#123; &#125;</span><br><span class="hljs-comment"># Used to generate arbitrary strings</span><br><span class="hljs-built_in">echo</span> &#123;1..10&#125; <span class="hljs-comment"># =&gt; 1 2 3 4 5 6 7 8 9 10</span><br><span class="hljs-built_in">echo</span> &#123;a..z&#125; <span class="hljs-comment"># =&gt; a b c d e f g h i j k l m n o p q r s t u v w x y z</span><br><span class="hljs-comment"># This will output the range from the start value to the end value</span><br><br><span class="hljs-comment"># Built-in variables:</span><br><span class="hljs-comment"># There are some useful built-in variables, like</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Last program&#x27;s return value: $?&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Script&#x27;s PID: $$&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Number of arguments passed to script: <span class="hljs-variable">$#</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;All arguments passed to script: <span class="hljs-variable">$@</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Script&#x27;s arguments separated into different variables: <span class="hljs-variable">$1</span> <span class="hljs-variable">$2</span>...&quot;</span><br><br><span class="hljs-comment"># Now that we know how to echo and use variables,</span><br><span class="hljs-comment"># let&#x27;s learn some of the other basics of bash!</span><br><br><span class="hljs-comment"># Our current directory is available through the command `pwd`.</span><br><span class="hljs-comment"># `pwd` stands for &quot;print working directory&quot;.</span><br><span class="hljs-comment"># We can also use the built-in variable `$PWD`.</span><br><span class="hljs-comment"># Observe that the following are equivalent:</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;I&#x27;m in <span class="hljs-subst">$(pwd)</span>&quot;</span> <span class="hljs-comment"># execs `pwd` and interpolates output</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;I&#x27;m in <span class="hljs-variable">$PWD</span>&quot;</span> <span class="hljs-comment"># interpolates the variable</span><br><br><span class="hljs-comment"># If you get too much output in your terminal, or from a script, the command</span><br><span class="hljs-comment"># `clear` clears your screen</span><br>clear<br><span class="hljs-comment"># Ctrl-L also works for clearing output</span><br><br><span class="hljs-comment"># Reading a value from input:</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;What&#x27;s your name?&quot;</span><br><span class="hljs-built_in">read</span> Name <span class="hljs-comment"># Note that we didn&#x27;t need to declare a new variable</span><br><span class="hljs-built_in">echo</span> Hello, <span class="hljs-variable">$Name</span>!<br><br><span class="hljs-comment"># We have the usual if structure:</span><br><span class="hljs-comment"># use `man test` for more info about conditionals</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$Name</span> != <span class="hljs-variable">$USER</span> ]<br><span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Your name isn&#x27;t your username&quot;</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Your name is your username&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-comment"># True if the value of $Name is not equal to the current user&#x27;s login username</span><br><br><span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> if $Name is empty, bash sees the above condition as:</span><br><span class="hljs-keyword">if</span> [ != <span class="hljs-variable">$USER</span> ]<br><span class="hljs-comment"># which is invalid syntax</span><br><span class="hljs-comment"># so the &quot;safe&quot; way to use potentially empty variables in bash is:</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$Name</span>&quot;</span> != <span class="hljs-variable">$USER</span> ] ...<br><span class="hljs-comment"># which, when $Name is empty, is seen by bash as:</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;&quot;</span> != <span class="hljs-variable">$USER</span> ] ...<br><span class="hljs-comment"># which works as expected</span><br><br><span class="hljs-comment"># There is also conditional execution</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Always executed&quot;</span> || <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Only executed if first command fails&quot;</span><br><span class="hljs-comment"># =&gt; Always executed</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Always executed&quot;</span> &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Only executed if first command does NOT fail&quot;</span><br><span class="hljs-comment"># =&gt; Always executed</span><br><span class="hljs-comment"># =&gt; Only executed if first command does NOT fail</span><br><br><br><span class="hljs-comment"># To use &amp;&amp; and || with if statements, you need multiple pairs of square brackets:</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$Name</span>&quot;</span> == <span class="hljs-string">&quot;Steve&quot;</span> ] &amp;&amp; [ <span class="hljs-string">&quot;<span class="hljs-variable">$Age</span>&quot;</span> -eq 15 ]<br><span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;This will run if <span class="hljs-variable">$Name</span> is Steve AND <span class="hljs-variable">$Age</span> is 15.&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$Name</span>&quot;</span> == <span class="hljs-string">&quot;Daniya&quot;</span> ] || [ <span class="hljs-string">&quot;<span class="hljs-variable">$Name</span>&quot;</span> == <span class="hljs-string">&quot;Zach&quot;</span> ]<br><span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;This will run if <span class="hljs-variable">$Name</span> is Daniya OR Zach.&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># There is also the `=~` operator, which tests a string against a Regex pattern:</span><br>Email=me@example.com<br><span class="hljs-keyword">if</span> [[ <span class="hljs-string">&quot;<span class="hljs-variable">$Email</span>&quot;</span> =~ [a-z]+@[a-z]&#123;2,&#125;\.(com|net|org) ]]<br><span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Valid email!&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-comment"># Note that =~ only works within double [[ ]] square brackets,</span><br><span class="hljs-comment"># which are subtly different from single [ ].</span><br><span class="hljs-comment"># See https://www.gnu.org/software/bash/manual/bashref.html#Conditional-Constructs for more on this.</span><br><br><span class="hljs-comment"># Redefine command `ping` as alias to send only 5 packets</span><br><span class="hljs-built_in">alias</span> ping=<span class="hljs-string">&#x27;ping -c 5&#x27;</span><br><span class="hljs-comment"># Escape the alias and use command with this name instead</span><br>\ping 192.168.1.1<br><span class="hljs-comment"># Print all aliases</span><br><span class="hljs-built_in">alias</span> -p<br><br><span class="hljs-comment"># Expressions are denoted with the following format:</span><br><span class="hljs-built_in">echo</span> $(( <span class="hljs-number">10</span> + <span class="hljs-number">5</span> )) <span class="hljs-comment"># =&gt; 15</span><br><br><span class="hljs-comment"># Unlike other programming languages, bash is a shell so it works in the context</span><br><span class="hljs-comment"># of a current directory. You can list files and directories in the current</span><br><span class="hljs-comment"># directory with the ls command:</span><br>ls <span class="hljs-comment"># Lists the files and subdirectories contained in the current directory</span><br><br><span class="hljs-comment"># This command has options that control its execution:</span><br>ls -l <span class="hljs-comment"># Lists every file and directory on a separate line</span><br>ls -t <span class="hljs-comment"># Sorts the directory contents by last-modified date (descending)</span><br>ls -R <span class="hljs-comment"># Recursively `ls` this directory and all of its subdirectories</span><br><br><span class="hljs-comment"># Results of the previous command can be passed to the next command as input.</span><br><span class="hljs-comment"># The `grep` command filters the input with provided patterns.</span><br><span class="hljs-comment"># That&#x27;s how we can list .txt files in the current directory:</span><br>ls -l | grep <span class="hljs-string">&quot;\.txt&quot;</span><br><br><span class="hljs-comment"># Use `cat` to print files to stdout:</span><br>cat file.txt<br><br><span class="hljs-comment"># We can also read the file using `cat`:</span><br>Contents=$(cat file.txt)<br><span class="hljs-comment"># &quot;\n&quot; prints a new line character</span><br><span class="hljs-comment"># &quot;-e&quot; to interpret the newline escape characters as escape characters</span><br><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;START OF FILE\n<span class="hljs-variable">$Contents</span>\nEND OF FILE&quot;</span><br><span class="hljs-comment"># =&gt; START OF FILE</span><br><span class="hljs-comment"># =&gt; [contents of file.txt]</span><br><span class="hljs-comment"># =&gt; END OF FILE</span><br><br><span class="hljs-comment"># Use `cp` to copy files or directories from one place to another.</span><br><span class="hljs-comment"># `cp` creates NEW versions of the sources,</span><br><span class="hljs-comment"># so editing the copy won&#x27;t affect the original (and vice versa).</span><br><span class="hljs-comment"># Note that it will overwrite the destination if it already exists.</span><br>cp srcFile.txt clone.txt<br>cp -r srcDirectory/ dst/ <span class="hljs-comment"># recursively copy</span><br><br><span class="hljs-comment"># Look into `scp` or `sftp` if you plan on exchanging files between computers.</span><br><span class="hljs-comment"># `scp` behaves very similarly to `cp`.</span><br><span class="hljs-comment"># `sftp` is more interactive.</span><br><br><span class="hljs-comment"># Use `mv` to move files or directories from one place to another.</span><br><span class="hljs-comment"># `mv` is similar to `cp`, but it deletes the source.</span><br><span class="hljs-comment"># `mv` is also useful for renaming files!</span><br>mv s0urc3.txt dst.txt <span class="hljs-comment"># sorry, l33t hackers...</span><br><br><span class="hljs-comment"># Since bash works in the context of a current directory, you might want to</span><br><span class="hljs-comment"># run your command in some other directory. We have cd for changing location:</span><br><span class="hljs-built_in">cd</span> ~    <span class="hljs-comment"># change to home directory</span><br><span class="hljs-built_in">cd</span>      <span class="hljs-comment"># also goes to home directory</span><br><span class="hljs-built_in">cd</span> ..   <span class="hljs-comment"># go up one directory</span><br>        <span class="hljs-comment"># (^^say, from /home/username/Downloads to /home/username)</span><br><span class="hljs-built_in">cd</span> /home/username/Documents   <span class="hljs-comment"># change to specified directory</span><br><span class="hljs-built_in">cd</span> ~/Documents/..    <span class="hljs-comment"># still in home directory..isn&#x27;t it??</span><br><span class="hljs-built_in">cd</span> -    <span class="hljs-comment"># change to last directory</span><br><span class="hljs-comment"># =&gt; /home/username/Documents</span><br><br><span class="hljs-comment"># Use subshells to work across directories</span><br>(<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;First, I&#x27;m here: <span class="hljs-variable">$PWD</span>&quot;</span>) &amp;&amp; (<span class="hljs-built_in">cd</span> someDir; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Then, I&#x27;m here: <span class="hljs-variable">$PWD</span>&quot;</span>)<br><span class="hljs-built_in">pwd</span> <span class="hljs-comment"># still in first directory</span><br><br><span class="hljs-comment"># Use `mkdir` to create new directories.</span><br>mkdir myNewDir<br><span class="hljs-comment"># The `-p` flag causes new intermediate directories to be created as necessary.</span><br>mkdir -p myNewDir/with/intermediate/directories<br><span class="hljs-comment"># if the intermediate directories didn&#x27;t already exist, running the above</span><br><span class="hljs-comment"># command without the `-p` flag would return an error</span><br><br><span class="hljs-comment"># You can redirect command input and output (stdin, stdout, and stderr).</span><br><span class="hljs-comment"># Read from stdin until ^EOF$ and overwrite hello.py with the lines</span><br><span class="hljs-comment"># between &quot;EOF&quot;:</span><br>cat &gt; hello.py &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">#!/usr/bin/env python</span><br><span class="hljs-string">from __future__ import print_function</span><br><span class="hljs-string">import sys</span><br><span class="hljs-string">print(&quot;#stdout&quot;, file=sys.stdout)</span><br><span class="hljs-string">print(&quot;#stderr&quot;, file=sys.stderr)</span><br><span class="hljs-string">for line in sys.stdin:</span><br><span class="hljs-string">    print(line, file=sys.stdout)</span><br><span class="hljs-string">EOF</span><br><span class="hljs-comment"># Variables will be expanded if the first &quot;EOF&quot; is not quoted</span><br><br><span class="hljs-comment"># Run the hello.py Python script with various stdin, stdout, and</span><br><span class="hljs-comment"># stderr redirections:</span><br>python hello.py &lt; <span class="hljs-string">&quot;input.in&quot;</span> <span class="hljs-comment"># pass input.in as input to the script</span><br><br>python hello.py &gt; <span class="hljs-string">&quot;output.out&quot;</span> <span class="hljs-comment"># redirect output from the script to output.out</span><br><br>python hello.py 2&gt; <span class="hljs-string">&quot;error.err&quot;</span> <span class="hljs-comment"># redirect error output to error.err</span><br><br>python hello.py &gt; <span class="hljs-string">&quot;output-and-error.log&quot;</span> 2&gt;&amp;1<br><span class="hljs-comment"># redirect both output and errors to output-and-error.log</span><br><br>python hello.py &gt; /dev/null 2&gt;&amp;1<br><span class="hljs-comment"># redirect all output and errors to the black hole, /dev/null, i.e., no output</span><br><br><span class="hljs-comment"># The output error will overwrite the file if it exists,</span><br><span class="hljs-comment"># if you want to append instead, use &quot;&gt;&gt;&quot;:</span><br>python hello.py &gt;&gt; <span class="hljs-string">&quot;output.out&quot;</span> 2&gt;&gt; <span class="hljs-string">&quot;error.err&quot;</span><br><br><span class="hljs-comment"># Overwrite output.out, append to error.err, and count lines:</span><br>info bash <span class="hljs-string">&#x27;Basic Shell Features&#x27;</span> <span class="hljs-string">&#x27;Redirections&#x27;</span> &gt; output.out 2&gt;&gt; error.err<br>wc -l output.out error.err<br><br><span class="hljs-comment"># Run a command and print its file descriptor (e.g. /dev/fd/123)</span><br><span class="hljs-comment"># see: man fd</span><br><span class="hljs-built_in">echo</span> &lt;(<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;#helloworld&quot;</span>)<br><br><span class="hljs-comment"># Overwrite output.out with &quot;#helloworld&quot;:</span><br>cat &gt; output.out &lt;(<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;#helloworld&quot;</span>)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;#helloworld&quot;</span> &gt; output.out<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;#helloworld&quot;</span> | cat &gt; output.out<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;#helloworld&quot;</span> | tee output.out &gt;/dev/null<br><br><span class="hljs-comment"># Cleanup temporary files verbosely (add &#x27;-i&#x27; for interactive)</span><br><span class="hljs-comment"># WARNING: `rm` commands cannot be undone</span><br>rm -v output.out error.err output-and-error.log<br>rm -r tempDir/ <span class="hljs-comment"># recursively delete</span><br><span class="hljs-comment"># You can install the `trash-cli` Python package to have `trash`</span><br><span class="hljs-comment"># which puts files in the system trash and doesn&#x27;t delete them directly</span><br><span class="hljs-comment"># see https://pypi.org/project/trash-cli/ if you want to be careful</span><br><br><span class="hljs-comment"># Commands can be substituted within other commands using $( ):</span><br><span class="hljs-comment"># The following command displays the number of files and directories in the</span><br><span class="hljs-comment"># current directory.</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;There are <span class="hljs-subst">$(ls | wc -l)</span> items here.&quot;</span><br><br><span class="hljs-comment"># The same can be done using backticks `` but they can&#x27;t be nested -</span><br><span class="hljs-comment"># the preferred way is to use $( ).</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;There are `ls | wc -l` items here.&quot;</span><br><br><span class="hljs-comment"># Bash uses a `case` statement that works similarly to switch in Java and C++:</span><br><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;<span class="hljs-variable">$Variable</span>&quot;</span> <span class="hljs-keyword">in</span><br>    <span class="hljs-comment"># List patterns for the conditions you want to meet</span><br>    0) <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;There is a zero.&quot;</span>;;<br>    1) <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;There is a one.&quot;</span>;;<br>    *) <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;It is not null.&quot;</span>;;  <span class="hljs-comment"># match everything</span><br><span class="hljs-keyword">esac</span><br><br><span class="hljs-comment"># `for` loops iterate for as many arguments given:</span><br><span class="hljs-comment"># The contents of $Variable is printed three times.</span><br><span class="hljs-keyword">for</span> Variable <span class="hljs-keyword">in</span> &#123;1..3&#125;<br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$Variable</span>&quot;</span><br><span class="hljs-keyword">done</span><br><span class="hljs-comment"># =&gt; 1</span><br><span class="hljs-comment"># =&gt; 2</span><br><span class="hljs-comment"># =&gt; 3</span><br><br><br><span class="hljs-comment"># Or write it the &quot;traditional for loop&quot; way:</span><br><span class="hljs-keyword">for</span> ((a=1; a &lt;= 3; a++))<br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$a</span><br><span class="hljs-keyword">done</span><br><span class="hljs-comment"># =&gt; 1</span><br><span class="hljs-comment"># =&gt; 2</span><br><span class="hljs-comment"># =&gt; 3</span><br><br><span class="hljs-comment"># They can also be used to act on files..</span><br><span class="hljs-comment"># This will run the command `cat` on file1 and file2</span><br><span class="hljs-keyword">for</span> Variable <span class="hljs-keyword">in</span> file1 file2<br><span class="hljs-keyword">do</span><br>    cat <span class="hljs-string">&quot;<span class="hljs-variable">$Variable</span>&quot;</span><br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment"># ..or the output from a command</span><br><span class="hljs-comment"># This will `cat` the output from `ls`.</span><br><span class="hljs-keyword">for</span> Output <span class="hljs-keyword">in</span> $(ls)<br><span class="hljs-keyword">do</span><br>    cat <span class="hljs-string">&quot;<span class="hljs-variable">$Output</span>&quot;</span><br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment"># Bash can also accept patterns, like this to `cat`</span><br><span class="hljs-comment"># all the Markdown files in current directory</span><br><span class="hljs-keyword">for</span> Output <span class="hljs-keyword">in</span> ./*.markdown<br><span class="hljs-keyword">do</span><br>    cat <span class="hljs-string">&quot;<span class="hljs-variable">$Output</span>&quot;</span><br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment"># while loop:</span><br><span class="hljs-keyword">while</span> [ <span class="hljs-literal">true</span> ]<br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;loop body here...&quot;</span><br>    <span class="hljs-built_in">break</span><br><span class="hljs-keyword">done</span><br><span class="hljs-comment"># =&gt; loop body here...</span><br><br><span class="hljs-comment"># You can also define functions</span><br><span class="hljs-comment"># Definition:</span><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">foo</span></span> ()<br>&#123;<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Arguments work just like script arguments: <span class="hljs-variable">$@</span>&quot;</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;And: <span class="hljs-variable">$1</span> <span class="hljs-variable">$2</span>...&quot;</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;This is a function&quot;</span><br>    <span class="hljs-built_in">return</span> 0<br>&#125;<br><span class="hljs-comment"># Call the function `foo` with two arguments, arg1 and arg2:</span><br>foo arg1 arg2<br><span class="hljs-comment"># =&gt; Arguments work just like script arguments: arg1 arg2</span><br><span class="hljs-comment"># =&gt; And: arg1 arg2...</span><br><span class="hljs-comment"># =&gt; This is a function</span><br><br><span class="hljs-comment"># or simply</span><br><span class="hljs-function"><span class="hljs-title">bar</span></span> ()<br>&#123;<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Another way to declare functions!&quot;</span><br>    <span class="hljs-built_in">return</span> 0<br>&#125;<br><span class="hljs-comment"># Call the function `bar` with no arguments:</span><br>bar <span class="hljs-comment"># =&gt; Another way to declare functions!</span><br><br><span class="hljs-comment"># Calling your function</span><br>foo <span class="hljs-string">&quot;My name is&quot;</span> <span class="hljs-variable">$Name</span><br><br><span class="hljs-comment"># There are a lot of useful commands you should learn:</span><br><span class="hljs-comment"># prints last 10 lines of file.txt</span><br>tail -n 10 file.txt<br><br><span class="hljs-comment"># prints first 10 lines of file.txt</span><br>head -n 10 file.txt<br><br><span class="hljs-comment"># sort file.txt&#x27;s lines</span><br>sort file.txt<br><br><span class="hljs-comment"># report or omit repeated lines, with -d it reports them</span><br>uniq -d file.txt<br><br><span class="hljs-comment"># prints only the first column before the &#x27;,&#x27; character</span><br>cut -d <span class="hljs-string">&#x27;,&#x27;</span> -f 1 file.txt<br><br><span class="hljs-comment"># replaces every occurrence of &#x27;okay&#x27; with &#x27;great&#x27; in file.txt</span><br><span class="hljs-comment"># (regex compatible)</span><br>sed -i <span class="hljs-string">&#x27;s/okay/great/g&#x27;</span> file.txt<br><span class="hljs-comment"># be aware that this -i flag means that file.txt will be changed</span><br><span class="hljs-comment"># -i or --in-place erase the input file (use --in-place=.backup to keep a back-up)</span><br><br><span class="hljs-comment"># print to stdout all lines of file.txt which match some regex</span><br><span class="hljs-comment"># The example prints lines which begin with &quot;foo&quot; and end in &quot;bar&quot;</span><br>grep <span class="hljs-string">&quot;^foo.*bar$&quot;</span> file.txt<br><br><span class="hljs-comment"># pass the option &quot;-c&quot; to instead print the number of lines matching the regex</span><br>grep -c <span class="hljs-string">&quot;^foo.*bar$&quot;</span> file.txt<br><br><span class="hljs-comment"># Other useful options are:</span><br>grep -r <span class="hljs-string">&quot;^foo.*bar$&quot;</span> someDir/ <span class="hljs-comment"># recursively `grep`</span><br>grep -n <span class="hljs-string">&quot;^foo.*bar$&quot;</span> file.txt <span class="hljs-comment"># give line numbers</span><br>grep -rI <span class="hljs-string">&quot;^foo.*bar$&quot;</span> someDir/ <span class="hljs-comment"># recursively `grep`, but ignore binary files</span><br><br><span class="hljs-comment"># perform the same initial search, but filter out the lines containing &quot;baz&quot;</span><br>grep <span class="hljs-string">&quot;^foo.*bar$&quot;</span> file.txt | grep -v <span class="hljs-string">&quot;baz&quot;</span><br><br><span class="hljs-comment"># if you literally want to search for the string,</span><br><span class="hljs-comment"># and not the regex, use `fgrep` (or `grep -F`)</span><br>fgrep <span class="hljs-string">&quot;foobar&quot;</span> file.txt<br><br><span class="hljs-comment"># The `trap` command allows you to execute a command whenever your script</span><br><span class="hljs-comment"># receives a signal. Here, `trap` will execute `rm` if it receives any of the</span><br><span class="hljs-comment"># three listed signals.</span><br><span class="hljs-built_in">trap</span> <span class="hljs-string">&quot;rm <span class="hljs-variable">$TEMP_FILE</span>; exit&quot;</span> SIGHUP SIGINT SIGTERM<br><br><span class="hljs-comment"># `sudo` is used to perform commands as the superuser</span><br><span class="hljs-comment"># usually it will ask interactively the password of superuser</span><br>NAME1=$(whoami)<br>NAME2=$(sudo whoami)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Was <span class="hljs-variable">$NAME1</span>, then became more powerful <span class="hljs-variable">$NAME2</span>&quot;</span><br><br><span class="hljs-comment"># Read Bash shell built-ins documentation with the bash `help` built-in:</span><br><span class="hljs-built_in">help</span><br><span class="hljs-built_in">help</span> <span class="hljs-built_in">help</span><br><span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span><br><span class="hljs-built_in">help</span> <span class="hljs-built_in">return</span><br><span class="hljs-built_in">help</span> <span class="hljs-built_in">source</span><br><span class="hljs-built_in">help</span> .<br><br><span class="hljs-comment"># Read Bash manpage documentation with `man`</span><br>apropos bash<br>man 1 bash<br>man bash<br><br><span class="hljs-comment"># Read info documentation with `info` (`?` for help)</span><br>apropos info | grep <span class="hljs-string">&#x27;^info.*(&#x27;</span><br>man info<br>info info<br>info 5 info<br><br><span class="hljs-comment"># Read bash info documentation:</span><br>info bash<br>info bash <span class="hljs-string">&#x27;Bash Features&#x27;</span><br>info bash 6<br>info --apropos bash<br></code></pre></td></tr></table></figure>

<h2 id="Tips-amp-amp-Tracks"><a href="#Tips-amp-amp-Tracks" class="headerlink" title="Tips &amp;&amp; Tracks"></a>Tips &amp;&amp; Tracks</h2><ul>
<li>set<figure class="highlight routeros"><table><tr><td class="code"><pre><code class="hljs routeros">&gt; <span class="hljs-builtin-name">set</span> å‘½ä»¤ä¿®æ”¹Shellç¯å¢ƒçš„è¿è¡Œå‚æ•°<br>  -x: <span class="hljs-builtin-name">Print</span> a trace of<span class="hljs-built_in"> simple </span>commands<br>  Using <span class="hljs-string">&#x27;+&#x27;</span> rather than <span class="hljs-string">&#x27;-&#x27;</span> causes these options <span class="hljs-keyword">to</span> be turned off.<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Refrence"><a href="#Refrence" class="headerlink" title="Refrence"></a>Refrence</h2><ul>
<li><a href="https://devhints.io/bash">Bash scripting cheatsheet</a></li>
<li><a href="https://linuxhint.com/bash_operator_examples/">74 Bash Operators Examples</a></li>
</ul>
]]></content>
      <tags>
        <tag>Shell</tag>
      </tags>
  </entry>
  <entry>
    <title>Rust vs. Go</title>
    <url>/2021/10/09/Rust-vs-Go/</url>
    <content><![CDATA[<h2 id="When-to-use-Rust-and-when-to-use-Go"><a href="#When-to-use-Rust-and-when-to-use-Go" class="headerlink" title="When to use Rust and when to use Go"></a>When to use Rust and when to use Go</h2><span id="more"></span>
<figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">Go has a stronger focus on building web APIs and small services that can scale endlessly, especially <span class="hljs-keyword">with</span> the power <span class="hljs-keyword">of</span> goroutines.</span><br><br><span class="hljs-meta">&gt;</span> <span class="javascript">Rust works well <span class="hljs-keyword">for</span> processing large amounts <span class="hljs-keyword">of</span> data and other CPU-intensive operations, such <span class="hljs-keyword">as</span> executing algorithms.</span><br></code></pre></td></tr></table></figure>

<h3 id="Gettting-started-Rust"><a href="#Gettting-started-Rust" class="headerlink" title="Gettting started Rust"></a>Gettting started Rust</h3><blockquote>
<p>Quickly set up a Rust development environment and write a small app!</p>
</blockquote>
<ul>
<li>Rustup<figure class="highlight applescript"><table><tr><td class="code"><pre><code class="hljs applescript">&gt; <span class="hljs-keyword">the</span> Rust installer <span class="hljs-keyword">and</span> <span class="hljs-built_in">version</span> management tool<br>âœ curl <span class="hljs-comment">--proto &#x27;=https&#x27; --tlsv1.2 -sSf https://sh.rustup.rs | sh</span><br><br>info: downloading installer<br><br>Welcome <span class="hljs-keyword">to</span> Rust!<br><br>This will download <span class="hljs-keyword">and</span> install <span class="hljs-keyword">the</span> official compiler <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> Rust<br>programming language, <span class="hljs-keyword">and</span> <span class="hljs-keyword">its</span> package manager, Cargo.<br><br>Rustup metadata <span class="hljs-keyword">and</span> toolchains will be installed <span class="hljs-keyword">into</span> <span class="hljs-keyword">the</span> Rustup<br>home directory, located <span class="hljs-keyword">at</span>:<br><br>  /home/chyiyaqing/.rustup<br><br>This can be modified <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> RUSTUP_HOME environment variable.<br><br>The Cargo home directory located <span class="hljs-keyword">at</span>:<br><br>  /home/chyiyaqing/.cargo<br><br>This can be modified <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> CARGO_HOME environment variable.<br><br>The cargo, rustc, rustup <span class="hljs-keyword">and</span> other commands will be added <span class="hljs-keyword">to</span><br>Cargo&#x27;s bin directory, located <span class="hljs-keyword">at</span>:<br><br>  /home/chyiyaqing/.cargo/bin<br><br>This path will <span class="hljs-keyword">then</span> be added <span class="hljs-keyword">to</span> your PATH environment variable <span class="hljs-keyword">by</span><br>modifying <span class="hljs-keyword">the</span> profile files located <span class="hljs-keyword">at</span>:<br><br>  /home/chyiyaqing/.profile<br>  /home/chyiyaqing/.bashrc<br>  /home/chyiyaqing/.zshenv<br><br>You can uninstall <span class="hljs-keyword">at</span> any <span class="hljs-built_in">time</span> <span class="hljs-keyword">with</span> rustup self uninstall <span class="hljs-keyword">and</span><br>these changes will be reverted.<br><br>Current installation options:<br><br><br>   default host triple: x86_64-unknown-linux-gnu<br>     default toolchain: stable (default)<br>               profile: default<br>  modify PATH variable: yes<br><br><span class="hljs-number">1</span>) Proceed <span class="hljs-keyword">with</span> installation (default)<br><span class="hljs-number">2</span>) Customize installation<br><span class="hljs-number">3</span>) Cancel installation<br><br><span class="hljs-comment"># rustup: Toolchain management</span><br>  - rustup update<br><br><span class="hljs-comment"># Cargo: the Rust build tool and package manager, used to install dependencies and manage the building, testing, running, and publishing of your project.</span><br>  - cargo build : build your project<br>  - cargo <span class="hljs-built_in">run</span>: <span class="hljs-built_in">run</span> your project<br>  - cargo test: test your project<br>  - cargo doc: build documentation <span class="hljs-keyword">for</span> your project<br>  - cargo publish: publish a library <span class="hljs-keyword">to</span> crates.io<br><br><span class="hljs-comment"># rustc: the Rust compiler</span><br>  &gt; rustc <span class="hljs-keyword">is</span> invoked indirectly <span class="hljs-keyword">by</span> <span class="hljs-keyword">the</span> **cargo build** <span class="hljs-keyword">or</span> **cargo <span class="hljs-built_in">run</span>** commands.<br></code></pre></td></tr></table></figure></li>
<li>Toolchain overview<br><img src="/misc/images/rust-toolchain-overview.png" alt="Rust toolchain and ecosystem"><figure class="highlight tap"><table><tr><td class="code"><pre><code class="hljs tap">-rwxr-xr-x<span class="hljs-number"> 12 </span>chyiyaqing chyiyaqing 15M Oct <span class="hljs-number"> 9 </span>09:49 cargo          -- package manager<br>-rwxr-xr-x<span class="hljs-number"> 12 </span>chyiyaqing chyiyaqing 15M Oct <span class="hljs-number"> 9 </span>09:49 cargo-clippy<br>-rwxr-xr-x<span class="hljs-number"> 12 </span>chyiyaqing chyiyaqing 15M Oct <span class="hljs-number"> 9 </span>09:49 cargo-fmt<br>-rwxr-xr-x<span class="hljs-number"> 12 </span>chyiyaqing chyiyaqing 15M Oct <span class="hljs-number"> 9 </span>09:49 cargo-miri<br>-rwxr-xr-x<span class="hljs-number"> 12 </span>chyiyaqing chyiyaqing 15M Oct <span class="hljs-number"> 9 </span>09:49 clippy-driver<br>-rwxr-xr-x<span class="hljs-number"> 12 </span>chyiyaqing chyiyaqing 15M Oct <span class="hljs-number"> 9 </span>09:49 rls<br>-rwxr-xr-x<span class="hljs-number"> 12 </span>chyiyaqing chyiyaqing 15M Oct <span class="hljs-number"> 9 </span>09:49 rustc          -- rust compiler<br>-rwxr-xr-x<span class="hljs-number"> 12 </span>chyiyaqing chyiyaqing 15M Oct <span class="hljs-number"> 9 </span>09:49 rustdoc<br>-rwxr-xr-x<span class="hljs-number"> 12 </span>chyiyaqing chyiyaqing 15M Oct <span class="hljs-number"> 9 </span>09:49 rustfmt<br>-rwxr-xr-x<span class="hljs-number"> 12 </span>chyiyaqing chyiyaqing 15M Oct <span class="hljs-number"> 9 </span>09:49 rust-gdb<br>-rwxr-xr-x<span class="hljs-number"> 12 </span>chyiyaqing chyiyaqing 15M Oct <span class="hljs-number"> 9 </span>09:49 rust-lldb<br>-rwxr-xr-x<span class="hljs-number"> 12 </span>chyiyaqing chyiyaqing 15M Oct <span class="hljs-number"> 9 </span>09:49 rustup         -- toolchain installer<br><br>creates.io                                                          -- package repository<br>docs.rs                                                             -- create documentation<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h3><ul>
<li><p>Go</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql">&gt; Go take advantage <span class="hljs-keyword">of</span> the concurrency the <span class="hljs-keyword">language</span> offers. The <span class="hljs-keyword">language</span> provides goroutines that <span class="hljs-keyword">enable</span> run <span class="hljs-keyword">function</span> <span class="hljs-keyword">as</span> subprocesses.<br>&gt; Go concurrency model allows <span class="hljs-keyword">to</span> deploy workloads across multiple CPU cores, making it efficient <span class="hljs-keyword">language</span><br></code></pre></td></tr></table></figure></li>
<li><p>Rust</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><code class="hljs angelscript">&gt; Rust <span class="hljs-keyword">is</span> more efficient <span class="hljs-keyword">in</span> execution algorithms <span class="hljs-keyword">and</span> resource-<span class="hljs-built_in">int</span>ensive operations.<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="Concurrency"><a href="#Concurrency" class="headerlink" title="Concurrency"></a>Concurrency</h3><ul>
<li><p>Go</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">&gt; Go support concurrency.<br>&gt; For example, yo<span class="hljs-string">u&#x27;re running a web server that handles API requests. use Go&#x27;</span>s goroutines to run each request <span class="hljs-keyword">as</span> a subprocess, maximizing efficiency by offloading tasks to <span class="hljs-built_in">all</span> available CPU cores.<br><br></code></pre></td></tr></table></figure></li>
<li><p>Rust</p>
<figure class="highlight"><table><tr><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure></li>
<li><p>Channel</p>
<figure class="highlight css"><table><tr><td class="code"><pre><code class="hljs css">&gt; <span class="hljs-selector-tag">A</span> channel helps transfer <span class="hljs-selector-tag">a</span> message <span class="hljs-selector-tag">from</span> one thread <span class="hljs-selector-tag">to</span> another.<br></code></pre></td></tr></table></figure></li>
<li><p>Lock</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql">&gt; Data <span class="hljs-keyword">is</span> <span class="hljs-keyword">only</span> accessible <span class="hljs-keyword">when</span> the <span class="hljs-keyword">lock</span> <span class="hljs-keyword">is</span> held. Rust relies <span class="hljs-keyword">on</span> the principle <span class="hljs-keyword">of</span> locking data <span class="hljs-keyword">instead</span> <span class="hljs-keyword">of</span> cod<br></code></pre></td></tr></table></figure></li>
<li><p>Memory safety</p>
<figure class="highlight"><table><tr><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><ul>
<li><a href="https://blog.logrocket.com/getting-up-to-speed-with-rust/">Getting up to speed with Rust</a></li>
<li><a href="https://benchmarksgame-team.pages.debian.net/benchmarksgame/fastest/rust-go.html">åŸºå‡†æµ‹è¯•</a></li>
<li><a href="https://bitbucket.org/blog/why-rust">Bitbucket</a></li>
<li><a href="https://benchmarksgame-team.pages.debian.net/benchmarksgame/fastest/rust-go.html">bechmarksgame</a></li>
<li><a href="https://blog.rust-lang.org/2015/04/10/Fearless-Concurrency.html">å¯è¯æ˜æ­£ç¡®çš„å¹¶å‘</a></li>
<li><a href="https://doc.rust-lang.org/stable/rust-by-example/std_misc/channels.html">é€šé“</a></li>
<li><a href="https://doc.rust-lang.org/std/primitive.pointer.html">æŒ‡é’ˆ</a></li>
<li><a href="https://doc.rust-lang.org/std/sync/struct.Mutex.html">é”</a></li>
<li><a href="https://blog.rust-lang.org/2015/04/10/Fearless-Concurrency.html">ä½¿ç”¨Rustè¿›è¡Œæ— æ‰€ç•æƒ§çš„å¹¶å‘</a></li>
<li><a href="https://en.wikipedia.org/wiki/Type_safety">ç±»å‹å®‰å…¨</a></li>
<li><a href="https://kristoff.it/blog/why-go-and-not-rust/">Loris Cro</a></li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>In Memory of Steve Jobs</title>
    <url>/2021/10/10/In-Memory-of-Steve-Jobs/</url>
    <content><![CDATA[<h1 id="Steve-Jobs"><a href="#Steve-Jobs" class="headerlink" title="Steve Jobs"></a>Steve Jobs</h1><span id="more"></span>
<p><img src="/misc/images/steve-jobs/In-memory-of-Steve-Jobs.jpg" alt="Steve Jobs"></p>
]]></content>
  </entry>
  <entry>
    <title>Vim Tips &amp; Tracks</title>
    <url>/2021/10/10/Vim-Tips-Tracks/</url>
    <content><![CDATA[<h1 id="Why-I-Still-Use-Vim"><a href="#Why-I-Still-Use-Vim" class="headerlink" title="Why I Still Use Vim"></a>Why I Still Use Vim</h1><ul>
<li>Vim is exists on all Unix systems, support all file formats and programming languages</li>
<li>Mouse free navigation</li>
<li>Vim is very light-weight and fast.</li>
<li>Vim is highly configurable. (~/.vimrc)</li>
<li>Memory Usage Low</li>
<li>Startup Time short</li>
</ul>
<span id="more"></span>

<h2 id="Installing"><a href="#Installing" class="headerlink" title="Installing"></a>Installing</h2><figure class="highlight vim"><table><tr><td class="code"><pre><code class="hljs vim">&gt; Since VIM comes <span class="hljs-keyword">pre</span>-installed <span class="hljs-keyword">on</span> <span class="hljs-keyword">a</span> <span class="hljs-keyword">number</span> of *nix systems, <span class="hljs-keyword">let</span><span class="hljs-string">&#x27;s first check to see if it&#x27;</span>s installed<br>  $ <span class="hljs-keyword">vim</span> --<span class="hljs-keyword">version</span><br><br># *NIX/Linux (Debian <span class="hljs-built_in">or</span> Ubuntu)<br>  $ sudo apt-<span class="hljs-built_in">get</span> <span class="hljs-built_in">remove</span> <span class="hljs-keyword">vim</span>-tiny<br>  $ sudo apt-<span class="hljs-built_in">get</span> <span class="hljs-keyword">update</span><br>  $ sudo apt-<span class="hljs-built_in">get</span> install <span class="hljs-keyword">vim</span><br></code></pre></td></tr></table></figure>
<ul>
<li><p>VIM Extensions</p>
<ul>
<li>vim-plug<blockquote>
<p>Minimalist Vim Plugin Manager</p>
</blockquote>
</li>
</ul>
<figure class="highlight pony"><table><tr><td class="code"><pre><code class="hljs pony"><span class="hljs-string">&quot;&quot;&quot;&quot;&quot;&quot;</span><span class="hljs-string">&quot;&quot;&quot;&quot;&quot;&quot;</span><span class="hljs-string">&quot;&quot;&quot;&quot;&quot;&quot;</span><span class="hljs-string">&quot;&quot;&quot;&quot;&quot;&quot;</span><span class="hljs-string">&quot;&quot;&quot;&quot;&quot;&quot;</span><span class="hljs-string">&quot;&quot;&quot;&quot;&quot;&quot;</span><span class="hljs-string">&quot;&quot;&quot;&quot;&quot;&quot;</span><span class="hljs-string">&quot;&quot;&quot;&quot;&quot;&quot;</span><span class="hljs-string">&quot;&quot;&quot;&quot;&quot;&quot;</span><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">&quot; junegunn/vim-plug -- ğŸŒº  Minimalist Vim Plugin Manager</span><br><span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">&quot;&quot;&quot;&quot;&quot;&quot;</span><span class="hljs-string">&quot;&quot;&quot;&quot;&quot;&quot;</span><span class="hljs-string">&quot;&quot;&quot;&quot;&quot;&quot;</span><span class="hljs-string">&quot;&quot;&quot;&quot;&quot;&quot;</span><span class="hljs-string">&quot;&quot;&quot;&quot;&quot;&quot;</span><span class="hljs-string">&quot;&quot;&quot;&quot;&quot;&quot;</span><span class="hljs-string">&quot;&quot;&quot;&quot;&quot;&quot;</span><span class="hljs-string">&quot;&quot;&quot;&quot;&quot;&quot;</span><span class="hljs-string">&quot;&quot;&quot;&quot;&quot;&quot;</span><br><span class="hljs-keyword">if</span> empty(glob(<span class="hljs-string">&#x27;~/.vim/autoload/plug.vim&#x27;</span>))<br>  silent !curl -fLo ~/.vim/autoload/plug.vim --create-dirs<br>   \ https:<span class="hljs-comment">//raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim</span><br>  autocmd <span class="hljs-type">VimEnter</span> * <span class="hljs-type">PlugInstall</span> --sync | source $<span class="hljs-type">MYVIMRC</span><br>endif<br><br><span class="hljs-string">&quot; vim-plug configuration</span><br><span class="hljs-string">&quot;</span> <span class="hljs-type">For</span> <span class="hljs-type">Mac</span>/<span class="hljs-type">Linux</span> users<br><span class="hljs-string">&quot; Plugins will be download under the specified directory.</span><br><span class="hljs-string">call plug#begin(&#x27;~/.vim/plugged&#x27;)</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;</span><span class="hljs-type">List</span> ends here. <span class="hljs-type">Plugins</span> become visible to <span class="hljs-type">Vim</span> after <span class="hljs-literal">this</span> call.<br>call plug#<span class="hljs-keyword">end</span>()<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Vim-Tips"><a href="#Vim-Tips" class="headerlink" title="Vim Tips"></a>Vim Tips</h2><ul>
<li><strong>Pro Tip #1</strong>: Make sure to utilize tab completion to find files after typing</li>
<li><strong>Pro Tip #2</strong>: Specify different areas of the screen where the splits should occur by adding the following lines to the .vimrc file<figure class="highlight routeros"><table><tr><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">set</span> splitbelow<br><span class="hljs-builtin-name">set</span> splitright<br></code></pre></td></tr></table></figure></li>
<li><strong>Pro Tip #3</strong>: Jump between splits with just one key combination<figure class="highlight vim"><table><tr><td class="code"><pre><code class="hljs vim"><span class="hljs-comment">&quot; split navigations</span><br><span class="hljs-keyword">nnoremap</span> <span class="hljs-symbol">&lt;C-J&gt;</span> <span class="hljs-symbol">&lt;C-W&gt;</span><span class="hljs-symbol">&lt;C-J&gt;</span><br><span class="hljs-keyword">nnoremap</span> <span class="hljs-symbol">&lt;C-K&gt;</span> <span class="hljs-symbol">&lt;C-W&gt;</span><span class="hljs-symbol">&lt;C-K&gt;</span><br><span class="hljs-keyword">nnoremap</span> <span class="hljs-symbol">&lt;C-L&gt;</span> <span class="hljs-symbol">&lt;C-W&gt;</span><span class="hljs-symbol">&lt;C-L&gt;</span><br><span class="hljs-keyword">nnoremap</span> <span class="hljs-symbol">&lt;C-H&gt;</span> <span class="hljs-symbol">&lt;C-W&gt;</span><span class="hljs-symbol">&lt;C-H&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><strong>Pro Tip #4</strong>: Buffers<figure class="highlight vim"><table><tr><td class="code"><pre><code class="hljs vim"># :<span class="hljs-keyword">ls</span> - <span class="hljs-keyword">to</span> <span class="hljs-keyword">list</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">buffers</span><br># :<span class="hljs-keyword">b</span> &lt;<span class="hljs-keyword">buffer</span> <span class="hljs-keyword">number</span>&gt; - pick the <span class="hljs-keyword">buffer</span> immediately<br></code></pre></td></tr></table></figure></li>
<li><strong>Pro Tip #5</strong>: Code Folding<figure class="highlight vim"><table><tr><td class="code"><pre><code class="hljs vim"># Collapse (<span class="hljs-built_in">or</span> <span class="hljs-keyword">fold</span>) methods <span class="hljs-built_in">and</span> classes<br><span class="hljs-comment">&quot; Enable folding</span><br><span class="hljs-keyword">set</span> foldmethod=<span class="hljs-built_in">indent</span><br><span class="hljs-keyword">set</span> <span class="hljs-built_in">foldlevel</span>=<span class="hljs-number">99</span><br><br><span class="hljs-comment">&quot; Enable folding with the spacebar</span><br><span class="hljs-keyword">nnoremap</span> <span class="hljs-symbol">&lt;space&gt;</span> za<br><br># VimL Script<br>plug <span class="hljs-string">&quot;tmhedberg/SimpylFold&quot;</span><br><br><span class="hljs-keyword">let</span> <span class="hljs-variable">g:SimpylFold_docstring_preview</span>=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li>
<li><strong>Pro Tip #6</strong>: PEP 8<figure class="highlight vim"><table><tr><td class="code"><pre><code class="hljs vim"><span class="hljs-comment">&quot; Add the proper PEP 8 indentation</span><br><span class="hljs-keyword">au</span> BufNewFile,BufRead *.<span class="hljs-keyword">py</span><br>    \ <span class="hljs-keyword">set</span> tabstop=<span class="hljs-number">4</span><br>    \ <span class="hljs-keyword">set</span> softtabstop=<span class="hljs-number">4</span><br>    \ <span class="hljs-keyword">set</span> <span class="hljs-built_in">shiftwidth</span>=<span class="hljs-number">4</span><br>    \ <span class="hljs-keyword">set</span> textwidth=<span class="hljs-number">79</span><br>    \ <span class="hljs-keyword">set</span> expandtab<br>    \ <span class="hljs-keyword">set</span> autoindent<br>    \ <span class="hljs-keyword">set</span> fileformat=unix<br><br><span class="hljs-comment">&quot; full stack development</span><br><span class="hljs-keyword">au</span> BufNewFile,BufRead *.js, *.html, *.css<br>    \ <span class="hljs-keyword">set</span> tabstop=<span class="hljs-number">2</span><br>    \ <span class="hljs-keyword">set</span> softtabstop=<span class="hljs-number">2</span><br>    \ <span class="hljs-keyword">set</span> <span class="hljs-built_in">shiftwidth</span>=<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure></li>
<li><strong>Pro Tip #7</strong>: Flagging Unnecessary Whitespace<figure class="highlight nginx"><table><tr><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">au</span> BufRead,BufNewFile <span class="hljs-regexp">*.py</span>,<span class="hljs-regexp">*.pyw</span>,<span class="hljs-regexp">*.c</span>,<span class="hljs-regexp">*.h</span> match BadWhitespace /\s\+$/<br></code></pre></td></tr></table></figure></li>
<li><strong>Pro Tip #8</strong>: UTF-8 Support<figure class="highlight routeros"><table><tr><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">set</span> <span class="hljs-attribute">encoding</span>=utf-8<br></code></pre></td></tr></table></figure></li>
<li><strong>Pro Tip #9</strong>: Syntax Checking/Highlighting<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql"># <span class="hljs-keyword">check</span> syntax <span class="hljs-keyword">on</span> <span class="hljs-keyword">each</span> save <span class="hljs-keyword">with</span> the syntastic <span class="hljs-keyword">extension</span><br>Plug <span class="hljs-string">&#x27;vim-syntastic/syntastic&#x27;</span><br><br># <span class="hljs-keyword">add</span> PEP <span class="hljs-number">8</span> checking <span class="hljs-keyword">with</span> this nifty little plugin<br>Plug <span class="hljs-string">&#x27;nvie/vim-flake8&#x27;</span><br><br>let python_highlight_all=<span class="hljs-number">1</span><br>syntax <span class="hljs-keyword">on</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="File-Browsing"><a href="#File-Browsing" class="headerlink" title="File Browsing"></a>File Browsing</h3><ul>
<li>NERDTree<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql">&gt; File <span class="hljs-keyword">system</span> explorer <span class="hljs-keyword">for</span> the Vim. It enables you <span class="hljs-keyword">to</span> visually browse complex directory hierarchies, quickly <span class="hljs-keyword">open</span> files <span class="hljs-keyword">for</span> reading <span class="hljs-keyword">or</span> editing, <span class="hljs-keyword">and</span> <span class="hljs-keyword">perform</span> basic file <span class="hljs-keyword">system</span> operations.<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="Super-Searching"><a href="#Super-Searching" class="headerlink" title="Super Searching"></a>Super Searching</h3><ul>
<li>ctrlP<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql">Plug <span class="hljs-string">&#x27;kien/ctrlp.vim&#x27;</span><br><br>Ctrl + P : <span class="hljs-keyword">enable</span> the <span class="hljs-keyword">search</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Using-Vim-for-Python-Development"><a href="#Using-Vim-for-Python-Development" class="headerlink" title="Using Vim for Python Development"></a>Using Vim for Python Development</h2><ul>
<li>Verifying VIM Install<figure class="highlight coffeescript"><table><tr><td class="code"><pre><code class="hljs coffeescript">Make sure have installed VIM &gt; <span class="hljs-number">7.3</span> <span class="hljs-keyword">with</span> Python support.<br><br>  :python3 <span class="hljs-keyword">import</span> sys; <span class="hljs-built_in">print</span>(sys.version)<br>  <span class="hljs-number">3.8</span><span class="hljs-number">.10</span> (<span class="hljs-keyword">default</span>, Sep <span class="hljs-number">28</span> <span class="hljs-number">2021</span>, <span class="hljs-number">16</span>:<span class="hljs-number">10</span>:<span class="hljs-number">42</span>)<br>  [GCC <span class="hljs-number">9.3</span><span class="hljs-number">.0</span>]<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Using-Vim-for-Go-Development"><a href="#Using-Vim-for-Go-Development" class="headerlink" title="Using Vim for Go Development"></a>Using Vim for Go Development</h2><ul>
<li>vim-go<figure class="highlight applescript"><table><tr><td class="code"><pre><code class="hljs applescript">&gt; Go development plugin <span class="hljs-keyword">for</span> Vim. It has everything you need <span class="hljs-keyword">for</span> Go development.<br><br>:GoBuild - Compile package<br>:GoInstall - Install <span class="hljs-keyword">it</span><br>:GoTest - Test <span class="hljs-keyword">it</span><br>:GoRun - Quickly execute current <span class="hljs-built_in">file</span><br>:GoDef - Go <span class="hljs-keyword">to</span> symbol/declaration<br>:GoDoc - look up documentation<br>:GoDocBrowser -<br><br><span class="hljs-comment"># Auto Completion</span><br>  &gt; It&#x27;s really hard <span class="hljs-keyword">to</span> code <span class="hljs-keyword">without</span> auto-completion <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> being able <span class="hljs-keyword">to</span> going <span class="hljs-keyword">to</span> <span class="hljs-keyword">the</span> definition.<br>  &gt; Vim-go use **gopls** <span class="hljs-keyword">for</span> completion etc. Completion(Ctrl-x Ctrl-p) <span class="hljs-keyword">is</span> enabled <span class="hljs-keyword">by</span> default via omnifunc.<br><br>  <span class="hljs-comment"># check if vim-go has been configured correctly for autocompletetion</span><br>  :verbose setlocal omnifunc?<br><br>  <span class="hljs-comment"># autocomplete prompt to appear automatically whenever you press the dot(.)</span><br>  au filetype go inoremap &lt;buffer&gt; . .&lt;C-x&gt;&lt;C-o&gt;<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Vim-and-Rust"><a href="#Vim-and-Rust" class="headerlink" title="Vim and Rust"></a>Vim and Rust</h2><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://www.amazon.com/Practical-Vim-Edit-Speed-Thought/dp/1680501275/ref=as_li_ss_tl?ie=UTF8&qid=1501817867&sr=8-3&keywords=vim&linkCode=sl1&tag=caspbeye-20&linkId=6c394064b4e6f05b198e68c64a6f4d76">Practical Vim - Edit Text at the Speed of Thought</a></li>
<li><a href="http://vimcasts.org/">VIM CASTS.org</a></li>
<li><a href="https://realpython.com/vim-and-python-a-match-made-in-heaven/">VIM and Python - A Match Made in Heaven</a></li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>XMind Intro</title>
    <url>/2021/10/10/XMind-Intro/</url>
    <content><![CDATA[<h1 id="XMind"><a href="#XMind" class="headerlink" title="XMind"></a>XMind</h1><blockquote>
<p>XMindæ˜¯é£é¡å…¨çƒçš„æ€ç»´å¯¼å›¾å’Œå¤´è„‘é£æš´è½¯ä»¶.ä½œä¸ºå­¦ä¹ ã€å·¥ä½œã€ç”Ÿæ´»çš„æ•ˆç‡å·¥å…·.<br>XMindæ€ç»´å¯¼å›¾æ˜¯ä¸€ä¸ªå¯è§†åŒ–çš„å›¾å½¢æ€ç»´å·¥å…·.</p>
</blockquote>
<span id="more"></span>

<h2 id="ä¸»é¢˜ç±»å‹"><a href="#ä¸»é¢˜ç±»å‹" class="headerlink" title="ä¸»é¢˜ç±»å‹"></a>ä¸»é¢˜ç±»å‹</h2><ul>
<li><p>ä¸­å¿ƒä¸»é¢˜</p>
<blockquote>
<p>ä¸­å¿ƒä¸»é¢˜æ˜¯å¯¼å›¾çš„æ ¸å¿ƒä¹Ÿæ˜¯ç”»å¸ƒçš„ä¸­å¿ƒï¼Œæ¯å¼ æ€ç»´å¯¼å›¾æœ‰ä¸”ä»…ç”±ä¸€ä¸ªä¸­å¿ƒä¸»é¢˜</p>
</blockquote>
</li>
<li><p>åˆ†æ”¯ä¸»é¢˜</p>
<blockquote>
<p>ä¸­å¿ƒä¸»é¢˜å‘æ•£å‡ºæ¥çš„ç¬¬ä¸€çº§ä¸»é¢˜ä¸ºåˆ†æ”¯ä¸»é¢˜</p>
</blockquote>
</li>
<li><p>å­ä¸»é¢˜</p>
<blockquote>
<p>åˆ†æ”¯ä¸»é¢˜å‘æ•£å‡ºæ¥çš„ä¸‹ä¸€çº§ä¸»é¢˜ä¸ºå­ä¸»é¢˜</p>
</blockquote>
</li>
<li><p>è‡ªç”±ä¸»é¢˜</p>
<blockquote>
<p>è‡ªç”±ä¸»é¢˜æ˜¯åœ¨æ€ç»´å¯¼å›¾ç»“æ„å¤–ç‹¬ç«‹å­˜åœ¨çš„ä¸»é¢˜</p>
</blockquote>
</li>
</ul>
<p>  <img src="/misc/images/xmind-point.jpg" alt="ä¸»é¢˜ç±»å‹"></p>
<h2 id="é€»è¾‘å…ƒç´ "><a href="#é€»è¾‘å…ƒç´ " class="headerlink" title="é€»è¾‘å…ƒç´ "></a>é€»è¾‘å…ƒç´ </h2><ul>
<li><p>è”ç³»</p>
<blockquote>
<p>æ€ç»´å¯¼å›¾ä¸­ä»»æ„ä¸¤ä¸ªä¸»é¢˜ä¹‹é—´ç”¨äºæ˜¾ç¤ºç‰¹æ®Šå…³ç³»çš„è‡ªå®šä¹‰è¿æ¥çº¿</p>
</blockquote>
</li>
<li><p>æ¦‚è¦</p>
<blockquote>
<p>å½“å¯¹å‡ ä¸ªä¸»é¢˜è¿›è¡Œæ€»ç»“å’Œæ¦‚è¿°ï¼Œè¿›ä¸€æ­¥å¯¹ä¸»é¢˜è¿›è¡Œæ€»ç»“å’Œå‡åæ—¶ï¼Œå¯ä»¥æ·»åŠ æ¦‚è¦</p>
</blockquote>
</li>
<li><p>å¤–æ¡†</p>
<blockquote>
<p>å›´ç»•ä¸»é¢˜çš„å°é—­åŒºåŸŸ</p>
</blockquote>
</li>
<li><p>ç¬”è®°</p>
<blockquote>
<p>ç¬”è®°ç”¨äºæ³¨é‡Šä¸»é¢˜çš„å¯Œæ–‡æœ¬</p>
</blockquote>
</li>
</ul>
<h2 id="é€»è¾‘ç»“æ„"><a href="#é€»è¾‘ç»“æ„" class="headerlink" title="é€»è¾‘ç»“æ„"></a>é€»è¾‘ç»“æ„</h2><ul>
<li><p>æ€ç»´å¯¼å›¾</p>
<blockquote>
<p>å‘æ•£å’Œçºµæ·±æ€è€ƒ</p>
</blockquote>
</li>
<li><p>é±¼éª¨å›¾</p>
<blockquote>
<p>æ¯”è¾ƒæ¸…æ™°åœ°è¡¨è¾¾å› æœå…³ç³»</p>
</blockquote>
</li>
<li><p>çŸ©é˜µå›¾</p>
<blockquote>
<p>ç”¨æ¥å·¦é¡¹ç›®çš„ä»»åŠ¡ç®¡ç†æˆ–è€…ä¸ªäººçš„æŠ€æœ¯</p>
</blockquote>
</li>
<li><p>æ—¶é—´è½´</p>
<blockquote>
<p>è¡¨ç¤ºäº‹ä»¶é¡ºåºæˆ–è€…äº‹æƒ…çš„å…ˆåé€»è¾‘</p>
</blockquote>
</li>
<li><p>ç»„ç»‡ç»“æ„å›¾</p>
<blockquote>
<p>å¯ä»¥åšç»„ç»‡å±‚æ¬¡çš„äººå‘˜æ„æˆ</p>
</blockquote>
</li>
<li><p>é€»è¾‘å›¾</p>
<blockquote>
<p>è¡¨è¾¾æ€»åˆ†å…³ç³»æˆ–åˆ†æ€»å…³ç³»</p>
</blockquote>
</li>
</ul>
]]></content>
      <tags>
        <tag>æ€ç»´å¯¼å›¾</tag>
        <tag>å¤´è„‘é£æš´</tag>
      </tags>
  </entry>
  <entry>
    <title>Go Web Framework</title>
    <url>/2021/10/11/Go-Web-Framework/</url>
    <content><![CDATA[<h1 id="Go-Web-Frameworks"><a href="#Go-Web-Frameworks" class="headerlink" title="Go Web Frameworks"></a>Go Web Frameworks</h1><ul>
<li>Webæ¡†æ¶åˆ†ç±»<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> è¿è¡Œæ€§èƒ½:</span><br><span class="hljs-meta">  &gt;</span><span class="bash"> è¿½æ±‚æ€§èƒ½çš„æ¡†æ¶å¾ˆç®€æ´ï¼ŒåŒ…å«ä¸œè¥¿å¾ˆå°‘ï¼Œä¸€ä¸ªè·¯ç”±ä¸€ä¸ªMVC, æ¯”å¦‚Gin</span><br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> å¼€å‘æ•ˆç‡:</span><br><span class="hljs-meta">  &gt;</span><span class="bash"> å°è£…å¾ˆå¥½ï¼Œé›†æˆå¾ˆå¤šåŠŸèƒ½, æ¯”å¦‚Beego</span><br></code></pre></td></tr></table></figure></li>
<li>Webæ¡†æ¶é€‰å‹<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> å¯¹äºä¸­å°å‹é¡¹ç›®ï¼Œå¼€å‘æ•ˆç‡å¾€å¾€æ˜¯ä¸šåŠ¡çš„ç¬¬ä¸€éœ€æ±‚, ä»»ä½•é¢†åŸŸåšåˆ°ç¬¬ä¸€åçš„äº§å“åŸºæœ¬ä¸Šéƒ½æœ‰ä¸€ä¸ªå…±æ€§: å¼€å‘ã€è¿­ä»£é€Ÿåº¦å¿«<br><span class="hljs-bullet">2.</span> å¥½çš„æ¡†æ¶è¦èƒ½åŒºåˆ†æ¸…æ¥šä¸šåŠ¡å›¢é˜Ÿå’Œæ¶æ„å›¢é˜Ÿçš„è¾¹ç•Œï¼Œä»€ä¹ˆåº”è¯¥æ˜¯ä¸šåŠ¡è´Ÿè´£ï¼Œä»€ä¹ˆåº”è¯¥æ˜¯æ¶æ„è´Ÿè´£,<br><span class="hljs-bullet">3.</span> æ¶æ„æ˜¯ä¸ºåŠ é€Ÿä¸šåŠ¡å‘å±•è€Œç”Ÿï¼Œéœ€è¦å…¼é¡¾ä¸šåŠ¡çš„å¼€å‘æ•ˆç‡å’Œåº•å±‚çš„æ€§èƒ½æ•ˆç‡<br></code></pre></td></tr></table></figure>
<span id="more"></span></li>
</ul>
<h2 id="Go-è¯­è¨€ç‰¹æ€§"><a href="#Go-è¯­è¨€ç‰¹æ€§" class="headerlink" title="Go è¯­è¨€ç‰¹æ€§"></a>Go è¯­è¨€ç‰¹æ€§</h2><ul>
<li>Goroutine<figure class="highlight"><table><tr><td class="code"><pre><code class="hljs">Goroutineè®¾è®¡ï¼Œæä¾›â€œä¸€ä¸ªè¯·æ±‚ä¸€ä¸ªåç¨‹â€çš„è¯·æ±‚æ¨¡å‹.å¯¹æ¯”PHPçš„â€œä¸€ä¸ªè¯·æ±‚ä¸€ä¸ªè¿›ç¨‹â€çš„æ¨¡å‹ï¼Œæå‡åç«¯èµ„æºå ç”¨å’Œè°ƒåº¦è´Ÿè½½ã€‚<br></code></pre></td></tr></table></figure></li>
<li>Runtime<figure class="highlight gradle"><table><tr><td class="code"><pre><code class="hljs gradle">Goçš„<span class="hljs-keyword">Runtime</span>æœºåˆ¶è®©è¿è¡Œç¨‹åºä¸å†ä¾èµ–å„ç§ç¯å¢ƒå’Œåº“<br></code></pre></td></tr></table></figure></li>
<li>compile<figure class="highlight"><table><tr><td class="code"><pre><code class="hljs">Goæä¾›äº¤å‰ç¼–è¯‘ã€æ•°æ®ç»“æ„ã€channelç­‰è¯­è¨€çº§åˆ«æé†’ï¼Œè®©å¤„ç†Webè¯·æ±‚å˜å¾—ç®€å•<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="First-Step"><a href="#First-Step" class="headerlink" title="First Step:"></a>First Step:</h2><ul>
<li>net, net/http<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># Web Server</span><br> &gt; Web Serverçš„æœ¬è´¨ï¼Œå®é™…ä¸Šå°±æ˜¯æ¥æ”¶ã€è§£æHTTPè¯·æ±‚ä¼ è¾“çš„æ–‡æœ¬å­—ç¬¦ï¼Œç†è§£è¿™äº›æ–‡æœ¬å­—ç¬¦çš„æŒ‡ä»¤ï¼Œç„¶åè®¡ç®—ã€åœ¨å°†è¿”å›å€¼ç»„ç»‡æˆHTTPå“åº”çš„æ–‡æœ¬å­—ç¬¦ï¼Œé€šè¿‡TCPç½‘ç»œè¾“å‡ºå›å»<br> &gt; æ˜¯ä¸€ä¸ªé€šè¿‡HTTPåè®®å¤„ç†Webè¯·æ±‚çš„è®¡ç®—æœºç³»ç»Ÿ<br><span class="hljs-bullet">  -</span> HTTPåè®®: è¶…æ–‡æœ¬ä¼ è¾“åè®®<br><span class="hljs-bullet">    -</span> HTTP Head: æè¿°ä¸€èˆ¬æ˜¯å’Œä¸šåŠ¡æ— å…³ä¸ä¼ è¾“ç›¸å…³çš„ä¿¡æ¯(è¯·æ±‚åœ°å€ã€ç¼–ç æ ¼å¼ã€ç¼“å­˜æ—¶é•¿)<br><span class="hljs-bullet">    -</span> HTTP Body: æè¿°çš„æ˜¯ä¸ä¸šåŠ¡ç›¸å…³çš„ä¿¡æ¯<br><span class="hljs-section"># net åº“</span><br>  &gt; å¯¹åº”OSIçš„TCPå±‚<br><br><span class="hljs-section"># net/httpåº“</span><br>  &gt; å¯¹åº”OSIçš„HTTPå±‚, è§£æHTTPæ¶ˆæ¯ä½“<br><br><span class="hljs-section"># net/http æ ‡å‡†åº“æºä»£ç </span><br>  &gt; é˜…è¯»ä»£ç åº“çš„æŠ€å·§: åº“å‡½æ•°(function) &gt; ç»“æ„å®šä¹‰(struct/class) &gt; ç»“æ„å‡½æ•°(method)<br><span class="hljs-bullet">    -</span> åº“å‡½æ•°: è¿™ä¸ªåº“è¦æä¾›çš„åŠŸèƒ½<br><span class="hljs-bullet">    -</span> ç»“æ„å®šä¹‰: è¿™ä¸ªåº“åˆ†ä¸ºå‡ ä¸ªæ ¸å¿ƒæ¨¡å—<br><span class="hljs-bullet">    -</span> ç»“æ„å‡½æ•°: æ¯ä¸ªæ ¸å¿ƒæ¨¡å—åº”è¯¥æä¾›çš„èƒ½åŠ›<br></code></pre></td></tr></table></figure></li>
<li>context</li>
<li>router</li>
<li>middleware</li>
<li>encapsulation</li>
<li>restart</li>
</ul>
<h2 id="Second-Step"><a href="#Second-Step" class="headerlink" title="Second Step:"></a>Second Step:</h2><ul>
<li>é¢å‘æ¥å£ç¼–ç¨‹</li>
<li>è®¾è®¡ç›®å½•ç»“æ„</li>
<li>å‘½ä»¤è¡Œäº¤äº’</li>
<li>å®šæ—¶ä»»åŠ¡</li>
<li>é…ç½®å’Œç¯å¢ƒ</li>
<li>å¤šè¾“å‡ºæ—¥å¿—</li>
</ul>
<h2 id="Third-Step"><a href="#Third-Step" class="headerlink" title="Third Step:"></a>Third Step:</h2><ul>
<li>ä¸€ä½“åŒ–ã€è‡ªåŠ¨åŒ–</li>
<li>è°ƒè¯•æ¨¡å¼</li>
<li>è¿›ç¨‹ã€æ¥å£ç®¡ç†</li>
<li>GORM</li>
<li>ç¼“å­˜æœåŠ¡</li>
<li>å‘å¸ƒä¸ç»´æŠ¤</li>
</ul>
<h2 id="Fourth-Step"><a href="#Fourth-Step" class="headerlink" title="Fourth Step:"></a>Fourth Step:</h2><ul>
<li>è®¾è®¡éœ€æ±‚åˆ†æ</li>
<li>æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡</li>
<li>ç½‘ç«™ç»Ÿè®¡æœåŠ¡</li>
<li>ä¸€ç«™å¼å‰åå°</li>
</ul>
<h3 id="æ¯’é¸¡æ±¤"><a href="#æ¯’é¸¡æ±¤" class="headerlink" title="æ¯’é¸¡æ±¤"></a>æ¯’é¸¡æ±¤</h3><figure class="highlight node-repl"><table><tr><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">äº†è§£ä¸€ä¸ªä¸œè¥¿æœ€å¥½çš„åŠæ³•å°±æ˜¯å»å®ç°å®ƒ</span><br></code></pre></td></tr></table></figure>


<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul>
<li><a href="https://github.com/valyala/fasthttp">High Performance FastHTTP</a></li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>Tech Interview Handbook</title>
    <url>/2021/10/11/Tech-Interview-Handbook/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Uber Zap Intro</title>
    <url>/2021/10/12/Uber-Zap-Intro/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Apache APISIX Intro</title>
    <url>/2021/10/13/Apache-APISIX-Intro/</url>
    <content><![CDATA[<h1 id="Apache-APISIX"><a href="#Apache-APISIX" class="headerlink" title="Apache APISIX"></a>Apache APISIX</h1><blockquote>
<p>äº‘åŸç”Ÿå¾®æœåŠ¡APIç½‘å…³ï¼Œé«˜æ€§èƒ½ã€å®‰å…¨æ€§ã€å¼€æºå¯æ‰©å±•çš„æœåŠ¡å¹³å°<br>APISIX åŸºäºNginx, Etcd.ä¸ä¼ ç»Ÿçš„API ç½‘å…³ç›¸æ¯”ï¼Œå…·æœ‰åŠ¨æ€è·¯ç”±å’Œçƒ­æ’æ‹”åŠ è½½ï¼Œé€‚åˆå¾®æœåŠ¡ç³»ç»Ÿä¸‹çš„APIç®¡ç†.</p>
</blockquote>
<span id="more"></span>

<h2 id="API-Gateway"><a href="#API-Gateway" class="headerlink" title="API Gateway"></a>API Gateway</h2><blockquote>
<p>APIç½‘å…³å°†å¾®æœåŠ¡çš„é€šç”¨åŠŸèƒ½ä½œä¸ºä¸­é—´å±‚, æ¯”å¦‚ç»Ÿè®¡ã€å®‰å…¨ã€é™é€Ÿã€é™æµå’Œç¼“å­˜,è¿™æ ·æ¯ä¸ªæœåŠ¡åªéœ€è¦å…³æ³¨è‡ªå·±çš„ä¸šåŠ¡ï¼Œæ— å…³çš„éœ€æ±‚è¢«æŠ›ç»™APIç½‘å…³.</p>
</blockquote>
<ul>
<li>Traditional vs. Cloud Native<figure class="highlight less"><table><tr><td class="code"><pre><code class="hljs less"># ä¼ ç»Ÿçš„<span class="hljs-selector-tag">API</span>ç½‘å…³åŠŸèƒ½<br>  <span class="hljs-selector-tag">-</span> è¦†ç›–äº†<span class="hljs-selector-tag">Nginx</span>æ‰€æœ‰çš„åŠŸèƒ½, åŒ…æ‹¬ <span class="hljs-selector-tag">reverse</span> <span class="hljs-selector-tag">proxy</span>(åå‘ä»£ç†)ã€<span class="hljs-selector-tag">load</span> <span class="hljs-selector-tag">balancing</span>(è´Ÿè½½å‡è¡¡)ã€<span class="hljs-selector-tag">caching</span>(ç¼“å­˜)ã€<span class="hljs-selector-tag">secure</span> <span class="hljs-selector-tag">authentication</span>(å®‰å…¨è®¤è¯)ã€<span class="hljs-selector-tag">rate-limiting</span>(é™æµ)ã€<span class="hljs-selector-tag">speed-limiting</span>(é™é€Ÿ).<br>  <span class="hljs-selector-tag">-</span> æ”¯æŒä¼ ç»Ÿçš„<span class="hljs-selector-tag">Web</span>æœåŠ¡æ— æ³•å®ç°çš„åŠŸèƒ½ï¼Œæ¯”å¦‚<span class="hljs-selector-tag">dynamic</span> <span class="hljs-selector-tag">upstream</span>(åŠ¨æ€ä¸Šè¡Œ)ã€<span class="hljs-selector-tag">dynamic</span> <span class="hljs-selector-tag">SSL</span> <span class="hljs-selector-tag">certificate</span>(åŠ¨æ€SSLè¯ä¹¦)ã€<span class="hljs-selector-tag">dynamic</span> <span class="hljs-selector-tag">rate-limiting</span> <span class="hljs-selector-tag">and</span> <span class="hljs-selector-tag">speed-limiting</span>(åŠ¨æ€é™æµé™é€Ÿ)ã€<span class="hljs-selector-tag">active</span>/<span class="hljs-selector-tag">passive</span> <span class="hljs-selector-tag">health</span> <span class="hljs-selector-tag">check</span>(ä¸»åŠ¨/è¢«åŠ¨å¥åº·æ£€æŸ¥)ã€<span class="hljs-selector-tag">service</span> <span class="hljs-selector-tag">disconnection</span>(æœåŠ¡æ–­çº¿)ã€‚<br>  <span class="hljs-selector-tag">-</span> æä¾›ç”Ÿå‘½å‘¨æœŸç®¡ç†,åœ¨<span class="hljs-selector-tag">API</span>ç½‘å…³é¢†åŸŸï¼Œ<span class="hljs-selector-tag">Google</span>æ˜¯æœ€å¤§çš„å‚ä¸è€…ï¼Œ<span class="hljs-selector-tag">Google</span>åœ¨æ”¶è´­<span class="hljs-selector-tag">Apigee</span>åï¼Œæ•´åˆäº†é™¤åå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡ã€é™æµé™é€ŸåŠŸèƒ½å¤–ï¼Œ<span class="hljs-selector-tag">API</span>ç½‘å…³è¿˜åŒ…æ‹¬<span class="hljs-selector-tag">API</span>çš„è®¾è®¡ã€æ–‡ä»¶ç®¡ç†å’Œæµ‹è¯•.ä»é¡¹ç›®è®¾è®¡åˆ°äº§å“æµ‹è¯•ä¸€ç³»åˆ—åŠŸèƒ½éƒ½åŒ…å«åœ¨<span class="hljs-selector-tag">API</span>ç½‘å…³çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ä¸­.<br><br># äº‘åŸç”Ÿä¸‹<span class="hljs-selector-tag">API</span>ç½‘å…³çš„æ–°ç‰¹æ€§<br>  <span class="hljs-selector-tag">-</span> éœ€è¦å¯¹æ¥äº‘ç¯å¢ƒä¸‹çš„<span class="hljs-selector-tag">Prometheus</span>(ç³»ç»Ÿç›‘æ§æŠ¥è­¦ç»„ä»¶)ã€<span class="hljs-selector-tag">Zipkin</span>(åˆ†å¸ƒå¼æ—¥å¿—è¿½è¸ªç³»ç»Ÿ)ã€<span class="hljs-selector-tag">Skywalking</span>(è§‚å¯Ÿæ€§åˆ†æå¹³å°å’Œåº”ç”¨ç¨‹åºæ€§èƒ½ç®¡ç†ç³»ç»Ÿ).<br>  <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">gRPC</span> ä»£ç†å’Œåè®®è½¬æ¢(REST &lt;=&gt; gRPC). ç°åœ¨<span class="hljs-selector-tag">HTTP</span>åœ¨å¾®æœåŠ¡ä¸­ä½¿ç”¨è¾ƒå°‘ï¼Œå¼€å§‹ä½¿ç”¨<span class="hljs-selector-tag">gRPC</span><br>  <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">identify</span> <span class="hljs-selector-tag">authentication</span>(èº«ä»½è®¤è¯çš„å˜åŒ–): åœ¨ä¼ ç»Ÿçš„<span class="hljs-selector-tag">Nginx</span>ä¸­ï¼Œä¸€èˆ¬æµé‡è¿›æ¥ä¹‹åï¼Œæ ¹æ®è·¯ç”±è§„åˆ™æ‰§è¡Œåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ï¼Œå‘é€æµé‡çš„å®¢æˆ·ç«¯çš„èº«ä»½å¾ˆå°‘ç»è¿‡èº«ä»½éªŒè¯ï¼Œä½†æ˜¯åœ¨äº‘åŸç”Ÿè®¡ç®—ä¸­ï¼Œç”±äºå¾ˆå¤šæµé‡éƒ½åœ¨å¾®æœåŠ¡ä¸­ï¼Œå¿…é¡»è¿›è¡Œä¸¥æ ¼çš„èº«ä»½è®¤è¯ï¼ŒåŒ…æ‹¬åŠ å¯†å’Œ<span class="hljs-selector-tag">OpenID</span><br>  <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">Serverless</span>ä»Šå¹´æ¥éå¸¸æœ‰åçš„æ¦‚å¿µï¼Œå¦‚æœä½ æƒ³åœ¨è¾¹ç¼˜èŠ‚ç‚¹åŠ¨æ€è¿è¡Œä¸€ä¸ªå‡½æ•°æˆ–åœæ­¢ä¸€ä¸ªå‡½æ•°.æˆ–è€…åŠ¨æ€æ”¹å˜å†…å®¹ï¼Œå¯ä»¥åœ¨è¾¹ç¼˜èŠ‚ç‚¹éƒ¨ç½²<span class="hljs-selector-tag">API</span>ç½‘å…³,ä½¿ç”¨<span class="hljs-selector-tag">FaaS</span>(Function as a Service),è¾¹ç¼˜èŠ‚ç‚¹å°†æ›´åŠ çµæ´». <span class="hljs-selector-tag">Apache</span> <span class="hljs-selector-tag">APISIX</span>æœ€è¿‘æ”¯æŒ<span class="hljs-selector-tag">Serverless</span>,å¯ä»¥è®©<span class="hljs-selector-tag">Lua</span>å‡½æ•°åœ¨è¾¹ç¼˜èŠ‚ç‚¹åŠ¨æ€è¿è¡Œ.<br>  <span class="hljs-selector-tag">-</span> ä¿æŒæ— çŠ¶æ€ï¼ŒåŠ¨æ€ç¼©å®¹/æ‰©å®¹çš„åŠŸèƒ½,äº‘åŸç”Ÿè®¡ç®—ä¸‹çš„ä¸€ä¸ªé‡è¦æ ‡å‡†æ˜¯æ‰€æœ‰çš„æœåŠ¡éƒ½å¯ä»¥é€šè¿‡å®¹å™¨éšæ„æ‰©å®¹å’Œç¼©å®¹å¯¹<span class="hljs-selector-tag">Kubernetes</span>å‹å¥½.<br>  <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">Support</span> <span class="hljs-selector-tag">multiple</span> <span class="hljs-selector-tag">clouds</span> <span class="hljs-selector-tag">and</span> <span class="hljs-selector-tag">hybrid</span> <span class="hljs-selector-tag">clouds</span>.<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="Nginx-vs-OpenResty"><a href="#Nginx-vs-OpenResty" class="headerlink" title="Nginx vs OpenResty"></a>Nginx vs OpenResty</h3><ul>
<li>Nginx<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql">&gt; A high performance free <span class="hljs-keyword">open</span> source web <span class="hljs-keyword">server</span> powering busiest sites <span class="hljs-keyword">on</span> the Internet.<br>&gt; nginx [engine x] <span class="hljs-keyword">is</span> an HTTP <span class="hljs-keyword">and</span> <span class="hljs-keyword">reverse</span> proxy <span class="hljs-keyword">server</span>, <span class="hljs-keyword">as</span> well <span class="hljs-keyword">as</span> a mail proxy <span class="hljs-keyword">server</span><br></code></pre></td></tr></table></figure></li>
<li>OpenResty<figure class="highlight less"><table><tr><td class="code"><pre><code class="hljs less">&gt; <span class="hljs-selector-tag">OpenResty</span> (aka. ngx_openresty) <span class="hljs-selector-tag">is</span> <span class="hljs-selector-tag">full-fledged</span>(æˆç†Ÿ)çš„<span class="hljs-selector-tag">web</span>åº”ç”¨ç¨‹åºæœåŠ¡å™¨,åŸºäºæ ‡å‡†çš„<span class="hljs-selector-tag">Nginx</span>æ ¸å¿ƒå’Œè®¸å¤šç¬¬ä¸‰æ–¹<span class="hljs-selector-tag">Nginx</span>æ¨¡å—ä»¥åŠç¬¬ä¸‰æ–¹å¤–éƒ¨ä¾èµ–.<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://medium.com/@ming_wen/apache-apisixs-technology-selection-testing-and-continuous-integration-313221b02542">Apache APISIXâ€™s technology selection,testing and continuous integration</a></li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>Apple Silicon M1 New product experience</title>
    <url>/2021/10/15/Apple-Silicon-M1-New-product-experience/</url>
    <content><![CDATA[<h1 id="Apple-Silicon-M1-MacBook-Pro"><a href="#Apple-Silicon-M1-MacBook-Pro" class="headerlink" title="Apple Silicon M1 MacBook Pro"></a>Apple Silicon M1 MacBook Pro</h1><blockquote>
<p>â€œThs best way to predict the future is to invent itâ€ - Alan Kay</p>
</blockquote>
<p><img src="/misc/images/macbookpro" alt="MacBook Pro"></p>
<span id="more"></span>

<h2 id="Apple-switching-Mac-to-ARM-Architecture"><a href="#Apple-switching-Mac-to-ARM-Architecture" class="headerlink" title="Apple switching Mac to ARM Architecture"></a>Apple switching Mac to ARM Architecture</h2><ul>
<li>Pros and Cons ä¼˜ç¼ºç‚¹<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># Prosä¼˜ç‚¹</span><br>  - <span class="hljs-number">1</span>. ARM processors use significantly less amount of power<br>  - <span class="hljs-number">2</span>. MacOS is based on the [Darwin](https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/apple/</span>darwin-xnu)<br><br><span class="hljs-comment"># Consç¼ºç‚¹</span><br>  - [<span class="hljs-string">&quot;Hackintosh&quot;</span>](https:<span class="hljs-regexp">//</span>hackintosh.com/) future will be doomed.<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="ARM64-amp-amp-Intel-x86-Virtual-Machines"><a href="#ARM64-amp-amp-Intel-x86-Virtual-Machines" class="headerlink" title="ARM64 &amp;&amp; Intel x86 Virtual Machines"></a>ARM64 &amp;&amp; Intel x86 Virtual Machines</h2><ul>
<li>ARM64<figure class="highlight delphi"><table><tr><td class="code"><pre><code class="hljs delphi">&gt; Apple Silicon <span class="hljs-keyword">is</span> an ARM <span class="hljs-keyword">platform</span> (RISC)<br></code></pre></td></tr></table></figure></li>
<li>Intel x86<figure class="highlight delphi"><table><tr><td class="code"><pre><code class="hljs delphi">&gt; Intel x86 <span class="hljs-keyword">is</span> a CISC <span class="hljs-keyword">platform</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="How-to-run-x86-Virtual-Machine-on-Apple-M1"><a href="#How-to-run-x86-Virtual-Machine-on-Apple-M1" class="headerlink" title="How to run x86 Virtual Machine on Apple M1"></a>How to run x86 Virtual Machine on Apple M1</h2><ul>
<li>Virtualization or Emulation<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> Virtualization:</span><br><span class="hljs-meta">  &gt;</span><span class="bash"> åˆ›å»ºè™šæ‹Ÿçš„å‰¯æœ¬(è™šæ‹Ÿç¡¬ä»¶å’Œè®¾å¤‡ã€å­˜å‚¨è®¾å¤‡å’Œç½‘ç»œèµ„æº)</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> Emulation:</span><br><span class="hljs-meta">  &gt;</span><span class="bash"> (<span class="hljs-built_in">emulate</span> different CPU architecture ) æ¨¡æ‹Ÿä¸åŒçš„CPUæ¶æ„</span><br><br>  - QEMU : a king of emulation<br>  - UTM : emulation and virtualization solution<br></code></pre></td></tr></table></figure></li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>Harbor Intro</title>
    <url>/2021/10/15/Harbor-Intro/</url>
    <content><![CDATA[<h1 id="Harbor"><a href="#Harbor" class="headerlink" title="Harbor"></a>Harbor</h1><blockquote>
<p>Kubernetes å€¼å¾—ä¿¡èµ–çš„äº‘åŸç”Ÿé•œåƒå­˜å‚¨åº“(Image Registry)</p>
</blockquote>
<span id="more"></span>

<h2 id="Prerequisties"><a href="#Prerequisties" class="headerlink" title="Prerequisties"></a>Prerequisties</h2><ul>
<li>Domain mapped to A record to get letsencrypt certificate</li>
<li>Internet connection to the server.</li>
<li>Latest version of docker and docker-compose installed.</li>
</ul>
<h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2>  <figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># update package repository</span><br>$ sudo apt update<br><br><span class="hljs-comment"># install the certificate</span><br>$ sudo apt install certbot -y<br><br><span class="hljs-comment"># generate a sertificate (Using domain name and email)</span><br>â¯ sudo certbot certonly --standalone -d <span class="hljs-string">&quot;harbor.chyidl.com&quot;</span> --preferred-challenges http --agree-tos -n -m <span class="hljs-string">&quot;xxx@gmail.com&quot;</span> --keep-until-expiring<br>Saving debug log to <span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/letsencrypt/</span>letsencrypt.log<br>Plugins selected: Authenticator standalone, Installer None<br>Obtaining a new certificate<br>Performing the following challenges:<br>http-<span class="hljs-number">01</span> challenge <span class="hljs-keyword">for</span> harbor.xx.com<br>Waiting <span class="hljs-keyword">for</span> verification...<br>Cleaning up challenges<br><br>IMPORTANT NOTES:<br> - Congratulations! Your certificate and chain have been saved at:<br> -    <span class="hljs-regexp">/etc/</span>letsencrypt<span class="hljs-regexp">/live/</span>harbor.xx.com/fullchain.pem<br> -    Your key file has been saved at:<br> -    <span class="hljs-regexp">/etc/</span>letsencrypt<span class="hljs-regexp">/live/</span>harbor.xx.com/privkey.pem<br> -    Your cert will expire on <span class="hljs-number">2022</span>-<span class="hljs-number">01</span>-<span class="hljs-number">15</span>. To obtain a new or tweaked<br> -    version of this certificate <span class="hljs-keyword">in</span> the future, simply run certbot<br> -    again. To non-interactively renew *all* of your certificates, run<br> -    <span class="hljs-string">&quot;certbot renew&quot;</span><br> -    - If you like Certbot, please consider supporting our work by:<br>   Donating to ISRG <span class="hljs-regexp">/ Let&#x27;s Encrypt:   https:/</span><span class="hljs-regexp">/letsencrypt.org/</span>donate<br>      Donating to EFF:                    https:<span class="hljs-regexp">//</span>eff.org/donate-le<br><br><span class="hljs-comment"># certificate are generated in /etc/letsencrypt/live/harbor.xxx.com/</span><br>root <span class="hljs-keyword">in</span> unreal-pod-<span class="hljs-number">1</span> <span class="hljs-keyword">in</span> ~/Downloads took <span class="hljs-number">8</span>s<br>â¯ cd <span class="hljs-regexp">/etc/</span>letsencrypt<span class="hljs-regexp">/live/</span>harbor.xx.com/<br><br>root <span class="hljs-keyword">in</span> unreal-pod-<span class="hljs-number">1</span> <span class="hljs-keyword">in</span> letsencrypt<span class="hljs-regexp">/live/</span>harbor.xx.com<br>â¯ ll<br>total <span class="hljs-number">4.0</span>K<br>lrwxrwxrwx <span class="hljs-number">1</span> root root  <span class="hljs-number">41</span> Oct <span class="hljs-number">18</span> <span class="hljs-number">00</span>:<span class="hljs-number">31</span> cert.pem -&gt; ..<span class="hljs-regexp">/../</span>archive<span class="hljs-regexp">/harbor.xx.com/</span>cert1.pem<br>lrwxrwxrwx <span class="hljs-number">1</span> root root  <span class="hljs-number">42</span> Oct <span class="hljs-number">18</span> <span class="hljs-number">00</span>:<span class="hljs-number">31</span> chain.pem -&gt; ..<span class="hljs-regexp">/../</span>archive<span class="hljs-regexp">/harbor.xx.com/</span>chain1.pem<br>lrwxrwxrwx <span class="hljs-number">1</span> root root  <span class="hljs-number">46</span> Oct <span class="hljs-number">18</span> <span class="hljs-number">00</span>:<span class="hljs-number">31</span> fullchain.pem -&gt; ..<span class="hljs-regexp">/../</span>archive<span class="hljs-regexp">/harbor.xx.com/</span>fullchain1.pem<br>lrwxrwxrwx <span class="hljs-number">1</span> root root  <span class="hljs-number">44</span> Oct <span class="hljs-number">18</span> <span class="hljs-number">00</span>:<span class="hljs-number">31</span> privkey.pem -&gt; ..<span class="hljs-regexp">/../</span>archive<span class="hljs-regexp">/harbor.xx.com/</span>privkey1.pem<br>-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">692</span> Oct <span class="hljs-number">18</span> <span class="hljs-number">00</span>:<span class="hljs-number">31</span> README<br><br><span class="hljs-comment"># download the harbor package</span><br>$ curl -s https:<span class="hljs-regexp">//</span>api.github.com<span class="hljs-regexp">/repos/g</span>oharbor<span class="hljs-regexp">/harbor/</span>releases/latest | grep browser_download_url | cut -d <span class="hljs-string">&#x27;&quot;&#x27;</span> -f <span class="hljs-number">4</span> | grep <span class="hljs-string">&#x27;\.tgz$&#x27;</span> | wget -i -<br><br><span class="hljs-comment"># Extract the harbor</span><br>$ tar xvf harbor-offline-installer-v2.<span class="hljs-number">3.3</span>.tgz<br>$ cd harbor<br><br><span class="hljs-comment"># copy example of configuration</span><br>$ cp harbor.yml.tmpl harbor.yml<br><br><span class="hljs-comment"># open harbor.yaml</span><br>$ vim harbor.yaml<br>  hostname:<br>  http.port:<br>  https.port<br>    certificate:<br>    private_key:<br>  harbor_admin_password:<br>  database.password:<br>  database.max_idle_conns:<br>  database.max_open_conns:<br>  data_volume:<br><br><span class="hljs-comment"># notary helps to digitally sign images using keys that verify content and publish them securely</span><br>$ sudo ./install.sh --with-notary --with-chartmuseum<br><br><span class="hljs-comment"># Harbor web access</span><br>&gt; https:<span class="hljs-regexp">//</span>harbor.xxx.com (modify <span class="hljs-regexp">/etc/</span>hosts add records)<br><br>&gt; login  harbor.xxx.com<br>$ docker login -u admin_zcm -p abc@<span class="hljs-number">123</span>A harbor.xxx.com<br></code></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>Kubernetesåˆ†ææºç </title>
    <url>/2021/10/15/Kubernetes%E5%88%86%E6%9E%90%E6%BA%90%E7%A0%81/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Learning Helm: Managing Apps on Kubernetes</title>
    <url>/2021/10/15/Learning-Helm-Managing-Apps-on-Kubernetes/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>NFS Mount Intro</title>
    <url>/2021/10/15/NFS-Mount-Intro/</url>
    <content><![CDATA[<h1 id="NFS-or-Network-File-System"><a href="#NFS-or-Network-File-System" class="headerlink" title="NFS, or Network File System"></a>NFS, or Network File System</h1><blockquote>
<p>ä¸€ç§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿåè®®ï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ä¸ŠæŒ‚è½½è¿œç¨‹ç›®å½•ï¼Œä½ å¯ä»¥ç®¡ç†ä¸åŒä½ç½®çš„å­˜å‚¨ç©ºé—´å¹¶ä»å¤šå®¢æˆ·ç«¯å†™å…¥è¯¥ç©ºé—´. NFSæä¾›ä¸€ç§ç›¸å¯¹æ ‡å‡†å’Œé«˜æ•ˆçš„æ–¹å¼æ¥é€šè¿‡ç½‘ç»œè®¿é—®è¿œç¨‹ç³»ç»Ÿã€‚å¹¶ä¸”é€‚åˆè®¿é—®å…±äº«èµ„æºçš„æƒ…å†µ.</p>
</blockquote>
<span id="more"></span>

<h2 id="Step-1-Download-and-Install-the-Components"><a href="#Step-1-Download-and-Install-the-Components" class="headerlink" title="Step 1 - Download and Install the Components"></a>Step 1 - Download and Install the Components</h2><ul>
<li>On the Host<figure class="highlight elixir"><table><tr><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>sudo apt update<br><br><span class="hljs-variable">$ </span>sudo apt install nfs-kernel-server (å…è®¸ä½ åˆ†äº«æ–‡ä»¶ç›®å½•)<br></code></pre></td></tr></table></figure></li>
<li>On the Client<figure class="highlight elixir"><table><tr><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>sudo apt update<br><span class="hljs-variable">$ </span>sudo apt install nfs-common<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Step-2-Create-the-Share-DIrectories-on-the-Host"><a href="#Step-2-Create-the-Share-DIrectories-on-the-Host" class="headerlink" title="Step 2 - Create the Share DIrectories on the Host"></a>Step 2 - Create the Share DIrectories on the Host</h2><ul>
<li>Example 1: Exporting a General Purpose Mount<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk">ubuntu <span class="hljs-keyword">in</span> ~ at k8s-node1 via ğŸ <span class="hljs-number">3.8</span>.<span class="hljs-number">6</span><br>âœ sudo mkdir <span class="hljs-regexp">/var/</span>nfs/general -p  <span class="hljs-comment"># åˆ›å»ºç›®å½•</span><br><br>ubuntu <span class="hljs-keyword">in</span> ~ at k8s-node1 via ğŸ <span class="hljs-number">3.8</span>.<span class="hljs-number">6</span><br>âœ ls -la <span class="hljs-regexp">/var/</span>nfs/general<br>total <span class="hljs-number">8</span><br>drwxr-xr-x <span class="hljs-number">2</span> root root <span class="hljs-number">4096</span> Oct <span class="hljs-number">15</span> <span class="hljs-number">13</span>:<span class="hljs-number">41</span> .<br>drwxr-xr-x <span class="hljs-number">3</span> root root <span class="hljs-number">4096</span> Oct <span class="hljs-number">15</span> <span class="hljs-number">13</span>:<span class="hljs-number">41</span> ..<br><br>&gt; NFSä¼šå°†å®¢æˆ·ç«¯ä¸Šçš„ä»»ä½•æ ¹æ“ä½œè½¬æ¢ä¸ºnobody:nogroupå‡­è¯ä½œä¸ºå®‰å…¨æªæ–½ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ›´æ”¹ç›®å½•æ‰€æœ‰æƒåŒ¹é…è¿™äº›å‡­è¯.<br><br>ubuntu <span class="hljs-keyword">in</span> ~ at k8s-node1 via ğŸ <span class="hljs-number">3.8</span>.<span class="hljs-number">6</span><br>âœ sudo chown nobody:nogroup <span class="hljs-regexp">/var/</span>nfs/general<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Step-3-Configuring-the-NFS-Exports-on-the-Host-Server"><a href="#Step-3-Configuring-the-NFS-Exports-on-the-Host-Server" class="headerlink" title="Step 3 - Configuring the NFS Exports on the Host Server"></a>Step 3 - Configuring the NFS Exports on the Host Server</h2>  <figure class="highlight vim"><table><tr><td class="code"><pre><code class="hljs vim">chyi in ~ at k8s-master<br>âœ sudo <span class="hljs-keyword">vim</span> /etc/exports<br>  # This <span class="hljs-keyword">file</span> <span class="hljs-keyword">is</span> auto-generated by openmediavault (http<span class="hljs-variable">s:</span>//www.openmediavault.org)<br>  # WARNING: Do not <span class="hljs-keyword">edit</span> this <span class="hljs-keyword">file</span>, your <span class="hljs-keyword">changes</span> will <span class="hljs-built_in">get</span> lost.<br><br>  # directory_to_share  client(share_option1,...,share_optionN)<br><br>  # /etc/export<span class="hljs-variable">s:</span> the access control <span class="hljs-keyword">list</span> <span class="hljs-keyword">for</span> filesystems which may <span class="hljs-keyword">be</span> exported<br>  #               <span class="hljs-keyword">to</span> NFS clients.  See exports(<span class="hljs-number">5</span>).<br>  /export/K8sData <span class="hljs-number">172.30</span>.<span class="hljs-number">1.0</span>/<span class="hljs-number">24</span>(fsid=<span class="hljs-number">2</span>,rw,subtree_check,insecure)<br>    - r<span class="hljs-variable">w:</span> æ­¤é€‰é¡¹ä¸ºå®¢æˆ·ç«¯è®¡ç®—æœºæä¾›å¯¹å·çš„è¯»å†™è®¿é—®æƒé™<br>    - <span class="hljs-keyword">sync</span>: æ­¤é€‰é¡¹å¼ºåˆ¶NFSåœ¨å“åº”æ¢å¤ä¹‹å‰å°†æ›´æ”¹å†™å…¥ç£ç›˜ï¼Œä¼šå¯¼è‡´æ›´ç¨³å®šå’Œä¸€è‡´çš„ç¯å¢ƒï¼Œå› ä¸ºæ¢å¤å“åº”è¿œç¨‹å·çš„ä¸–çºªçŠ¶æ€ï¼Œä½†æ˜¯ä»–ä¹Ÿé™ä½äº†æ–‡ä»¶æ“ä½œçš„é€Ÿåº¦.<br>    - no_subtree_check: æ­¤é€‰é¡¹é˜²æ­¢å­æ ‘æ£€æŸ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œä¸»æœºå¿…é¡»æ£€æŸ¥è¯¥æ–‡ä»¶æ˜¯å¦åœ¨æ¯ä¸ªè¯·æ±‚çš„å¯¼å‡ºæ ‘ä¸­å®é™…ä¸Šä»ç„¶å¯ç”¨ï¼Œåœ¨å®¢æˆ·ç«¯æ‰“å¼€æ–‡ä»¶å’Œé‡å‘½åæ–‡ä»¶æ—¶<br>    - no_root_squash: é»˜è®¤æƒ…å†µä¸‹ï¼ŒNFSå°†æ¥è‡ªrootç”¨æˆ·çš„è¿œç¨‹è¯·æ±‚è½¬æ¢ä¸ºæœåŠ¡å™¨ä¸Šçš„éç‰¹æƒç”¨æˆ·ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢å®¢æˆ·ç«¯ä¸Šçš„rootè´¦æˆ·ä»¥rootèº«ä»½ä½¿ç”¨ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿçš„å®‰å…¨åŠŸèƒ½<br><br>$ sudo systemctl restart nfs-kernel-server<br></code></pre></td></tr></table></figure>

<h2 id="Step-4-Create-Mount-Points-and-Mount-Directories-on-the-Client"><a href="#Step-4-Create-Mount-Points-and-Mount-Directories-on-the-Client" class="headerlink" title="Step 4 - Create Mount Points and Mount Directories on the Client"></a>Step 4 - Create Mount Points and Mount Directories on the Client</h2>  <figure class="highlight elixir"><table><tr><td class="code"><pre><code class="hljs elixir">&gt; ä¸ºäº†ä½¿è¿œç¨‹å…±äº«åœ¨å®¢æˆ·ç«¯å¯ç”¨ï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸»æœºä¸Šè¦å…±äº«çš„ç›®å½•æŒ‚è½½åˆ°å®¢æˆ·ç«¯ä¸Šçš„ç©ºç›®å½•ä¸­<br>&gt; å¦‚æœä½ çš„æŒ‚è½½ç‚¹ä¸­æœ‰æ–‡ä»¶å’Œç›®å½•ï¼Œä¸€æ—¦ä½ æŒ‚è½½NFSå…±äº«ï¼Œä»–ä»¬å°±ä¼šè¢«éšè—ï¼Œä¸ºäº†é¿å…ä¸¢å¤±é‡è¦æ–‡ä»¶ï¼Œè¯·ç¡®ä¿ä½ æŒ‚è½½åœ¨å·²å­˜åœ¨çš„ç›®å½•ä¸­ï¼Œå¹¶ä¸”è¯¥ç›®å½•ä¸ºç©º.<br><br>ubuntu <span class="hljs-keyword">in</span> ~ at <span class="hljs-number">3</span>B<br>âœ sudo mkdir /k8s_data<br><br>ubuntu <span class="hljs-keyword">in</span> ~ at <span class="hljs-number">3</span>B<br>âœ sudo mount <span class="hljs-number">172.30</span>.<span class="hljs-number">1.14</span><span class="hljs-symbol">:/export/K8sData</span> /k8s_data<br></code></pre></td></tr></table></figure>

<h2 id="Step-5-Mounting-the-Remote-NFS-Directories-at-Boot"><a href="#Step-5-Mounting-the-Remote-NFS-Directories-at-Boot" class="headerlink" title="Step 5 - Mounting the Remote NFS Directories at Boot"></a>Step 5 - Mounting the Remote NFS Directories at Boot</h2>  <figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk">&gt; é€šè¿‡å°†è¿œç¨‹NFSå…±äº«æ·»åŠ åˆ°å®¢æˆ·ç«¯ä¸Šçš„<span class="hljs-regexp">/etc/</span>fstabæ–‡ä»¶ï¼Œå¯ä»¥åœ¨å¯åŠ¨æ˜¯è‡ªåŠ¨æŒ‚è½½è¿œç¨‹NFSå…±äº«<br><br>ubuntu <span class="hljs-keyword">in</span> ~ at <span class="hljs-number">3</span>B<br>âœ sudo vim <span class="hljs-regexp">/etc/</span>fstab<br><br>  <span class="hljs-number">172.30</span>.<span class="hljs-number">1.14</span>:<span class="hljs-regexp">/export/</span>K8sData /k8s_data nfs auto,nofail,noatime,nolock,intr,tcp,actimeo=<span class="hljs-number">1800</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>

<h2 id="Step-6-Unmounting-an-NFS-Remote-Share"><a href="#Step-6-Unmounting-an-NFS-Remote-Share" class="headerlink" title="Step 6 - Unmounting an NFS Remote Share"></a>Step 6 - Unmounting an NFS Remote Share</h2>  <figure class="highlight elixir"><table><tr><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>sudo umount /k8s_data<br></code></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>Rancher Intro</title>
    <url>/2021/10/18/Rancher-Intro/</url>
    <content><![CDATA[<h1 id="Rancher"><a href="#Rancher" class="headerlink" title="Rancher"></a>Rancher</h1><span id="more"></span>
]]></content>
  </entry>
  <entry>
    <title>æ•°æ®åº“è¿ç§» MySQL -&gt; Postgres</title>
    <url>/2021/10/21/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB-MySQL-Postgres/</url>
    <content><![CDATA[<h1 id="æ•°æ®åº“è¿ç§»-MySQL-gt-Postgres"><a href="#æ•°æ®åº“è¿ç§»-MySQL-gt-Postgres" class="headerlink" title="æ•°æ®åº“è¿ç§» MySQL -&gt; Postgres"></a>æ•°æ®åº“è¿ç§» MySQL -&gt; Postgres</h1><span id="more"></span>

<h2 id="MySQL-to-PostgreSQL-Types-Mapping"><a href="#MySQL-to-PostgreSQL-Types-Mapping" class="headerlink" title="MySQL to PostgreSQL Types Mapping"></a>MySQL to PostgreSQL Types Mapping</h2><ul>
<li><p>Types Mapping</p>
<table>
<thead>
<tr>
<th align="left">MySQL</th>
<th align="left">PostgreSQL</th>
</tr>
</thead>
<tbody><tr>
<td align="left">BIGINT</td>
<td align="left">BIGINT</td>
</tr>
<tr>
<td align="left">BINARY(n)</td>
<td align="left">BYTEA</td>
</tr>
<tr>
<td align="left">BIT</td>
<td align="left">BOOLEAN</td>
</tr>
<tr>
<td align="left">CHAR(n), CHARACTER(n)</td>
<td align="left">CHAR(n), CHARACTER(n)</td>
</tr>
<tr>
<td align="left">DATE</td>
<td align="left">DATE</td>
</tr>
<tr>
<td align="left">DATETIME</td>
<td align="left">TIMESTAMP [WITHOUT TIME ZONE]</td>
</tr>
<tr>
<td align="left">DECIMAL(p,s), DEC(p,s)</td>
<td align="left">DECIMAL(p,s), DEC(p,s)</td>
</tr>
<tr>
<td align="left">DOUBLE</td>
<td align="left">DOUBLE PERCISION</td>
</tr>
<tr>
<td align="left">FLOAT</td>
<td align="left">REAL</td>
</tr>
<tr>
<td align="left">INT, INTEGER</td>
<td align="left">INT, INTEGER</td>
</tr>
<tr>
<td align="left">MEDIUMINT</td>
<td align="left">INTEGER</td>
</tr>
<tr>
<td align="left">NUMERIC(p,s)</td>
<td align="left">NUMERIC(p,s)</td>
</tr>
<tr>
<td align="left">SMALLINT</td>
<td align="left">SMALLINT</td>
</tr>
<tr>
<td align="left">TINYINT</td>
<td align="left">SMALLINT</td>
</tr>
<tr>
<td align="left">TINYTEXT, TEXT, MEDIUMTEXT, LONGTEXT</td>
<td align="left">TEXT</td>
</tr>
<tr>
<td align="left">TIME</td>
<td align="left">TIME [WITHOUT TIME ZONE]</td>
</tr>
<tr>
<td align="left">TIMESTAMP</td>
<td align="left">TIMESTAMP [WITHOUT TIME ZONE]</td>
</tr>
<tr>
<td align="left">VARBINARY(n), VARBINARY(max)</td>
<td align="left">BYTEA</td>
</tr>
<tr>
<td align="left">VARCHAR(n)</td>
<td align="left">VARCHAR(n)</td>
</tr>
<tr>
<td align="left">VARCHAR(max)</td>
<td align="left">TEXT</td>
</tr>
</tbody></table>
</li>
<li><p>MySQL auto_increment</p>
<table>
<thead>
<tr>
<th align="left">MySQL</th>
<th align="left">PostgreSQL</th>
</tr>
</thead>
<tbody><tr>
<td align="left">BIGINT AUTO_INCREMENT</td>
<td align="left">BIGSERIAL</td>
</tr>
<tr>
<td align="left">INTEGER AUTO_INCREMENT</td>
<td align="left">SERIAL</td>
</tr>
<tr>
<td align="left">SMALLINT AUTO_INCREMENT</td>
<td align="left">SMALLSERIAL</td>
</tr>
<tr>
<td align="left">TINYINT AUTO_INCREMENT</td>
<td align="left">SMALLSERIAL</td>
</tr>
</tbody></table>
</li>
<li><p>MySQL integer types (tinyint, smallint, int, bigint) UNSIGNED</p>
<table>
<thead>
<tr>
<th align="left">MySQL</th>
<th align="left">PostgreSQL</th>
</tr>
</thead>
<tbody><tr>
<td align="left">BIGINT UNSIGNED</td>
<td align="left">NUMERIC(20)</td>
</tr>
<tr>
<td align="left">INT UNSIGNED</td>
<td align="left">BIGINT</td>
</tr>
<tr>
<td align="left">MEDIUMINT UNSIGNED</td>
<td align="left">INTEGER</td>
</tr>
<tr>
<td align="left">SMALLINT UNSIGNED</td>
<td align="left">INTEGER</td>
</tr>
<tr>
<td align="left">TINYINT UNSIGNED</td>
<td align="left">INTEGER</td>
</tr>
</tbody></table>
</li>
</ul>
<h2 id="ä½¿ç”¨pgloaderå°†MySQLæ•°æ®åº“è¿ç§»åˆ°PostgreSQL"><a href="#ä½¿ç”¨pgloaderå°†MySQLæ•°æ®åº“è¿ç§»åˆ°PostgreSQL" class="headerlink" title="ä½¿ç”¨pgloaderå°†MySQLæ•°æ®åº“è¿ç§»åˆ°PostgreSQL"></a>ä½¿ç”¨pgloaderå°†MySQLæ•°æ®åº“è¿ç§»åˆ°PostgreSQL</h2><ul>
<li><p>PGLOADER</p>
<ul>
<li><p>Supported operations include</p>
<ul>
<li>Migrate from MySQL to PostgreSQL</li>
<li>Migrate from SQLite to PostgreSQL</li>
<li>Migrate from MS SQL Server to PostgreSQL</li>
</ul>
</li>
<li><p>Install</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-quote">&gt; pgloaderä½¿ç”¨postgresqlçš„COPYå‘½ä»¤å°†æ•°æ®ä»æºæ•°æ®åº“æˆ–æ–‡ä»¶å¤åˆ¶åˆ°ç›®æ ‡PostgreSQLæ•°æ®åº“ä¸­.</span><br><span class="hljs-bullet">  -</span> sbcl: ä¸€ä¸ªCommon Lispç¼–è¯‘å™¨<br><span class="hljs-bullet">  -</span> unzip: .zipæ–‡ä»¶çš„unzipå™¨<br><span class="hljs-bullet">  -</span> libsqlite3-dev: SQLite3çš„å¼€å‘æ–‡ä»¶é›†åˆ<br><span class="hljs-bullet">  -</span> gawk: GNU awk çš„ç¼©å†™ï¼Œæ˜¯ä¸€ç§æ¨¡å¼æ‰«æå’Œå¤„ç†è¯­è¨€<br><span class="hljs-bullet">  -</span> curl: ç”¨äºä»URLä¼ è¾“æ•°æ®çš„å‘½ä»¤è¡Œå·¥å…·<br><span class="hljs-bullet">  -</span> make: ç”¨äºç®¡ç†åŒ…ç¼–è¯‘çš„å®ç”¨ç¨‹åº<br><span class="hljs-bullet">  -</span> freetds-dev: MS SQLå’ŒSybaseæ•°æ®åº“çš„å®¢æˆ·ç«¯åº“<br><span class="hljs-bullet">  -</span> libzip-dev:ç”¨äºè¯»å–ï¼Œç©¿ä»¶å’Œä¿®æ”¹zipå­˜æ¡£çš„åº“<br><span class="hljs-section"># å®‰è£…ä¾èµ–é¡¹</span><br>$ sudo apt install sbcl unzip libsqlite3-dev gawk curl make freetds-dev libzip-dev<br><br><span class="hljs-section"># ä¸‹è½½pgloader</span><br>$ wget https://github.com/dimitri/pgloader/releases/download/v3.6.2/pgloader-bundle-3.6.2.tgz<br><br><span class="hljs-section"># æå–tarball</span><br>$ tar -xvf pgloader-bundle<br><br><span class="hljs-section"># æ„å»ºpgloaderäºŒè¿›åˆ¶æ–‡ä»¶</span><br><span class="hljs-section"># make pgloader</span><br></code></pre></td></tr></table></figure></li>
<li><p>Migrate from MySQL to PostgreSQL</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><code class="hljs stylus">  &gt; Migrate <span class="hljs-selector-tag">a</span> whole MySQL database, including its schema definition of tables and indexes, primary key and foreign key constraints, comments and default values, even when they require installing <span class="hljs-selector-tag">a</span> trigger <span class="hljs-keyword">in</span> PostgreSQL.<br><br>	chyiyaqing <span class="hljs-keyword">in</span> ~ at chyiyaqing-PowerEdge-R720<br>âœ pgloader mysql:<span class="hljs-comment">//admin:x@172.16.1.129:31540/stdb pgsql://kingbasees:x@180.76.152.26:5432/stdb</span><br><span class="hljs-number">2021</span>-<span class="hljs-number">10</span>-<span class="hljs-number">29</span>T18:<span class="hljs-number">31</span>:<span class="hljs-number">21.028000</span>+<span class="hljs-number">08</span>:<span class="hljs-number">00</span> LOG pgloader version <span class="hljs-string">&quot;3.6.2&quot;</span><br><span class="hljs-number">2021</span>-<span class="hljs-number">10</span>-<span class="hljs-number">29</span>T18:<span class="hljs-number">31</span>:<span class="hljs-number">21.453000</span>+<span class="hljs-number">08</span>:<span class="hljs-number">00</span> LOG Migrating from #&lt;MYSQL-CONNECTION mysql:<span class="hljs-comment">//admin@172.16.1.129:31540/stdb &#123;10054E05A3&#125;&gt;</span><br><span class="hljs-number">2021</span>-<span class="hljs-number">10</span>-<span class="hljs-number">29</span>T18:<span class="hljs-number">31</span>:<span class="hljs-number">21.453000</span>+<span class="hljs-number">08</span>:<span class="hljs-number">00</span> LOG Migrating into #&lt;PGSQL-CONNECTION pgsql:<span class="hljs-comment">//kingbasees@180.76.152.26:5432/stdb &#123;10056315A3&#125;&gt;</span><br><span class="hljs-number">2021</span>-<span class="hljs-number">10</span>-<span class="hljs-number">29</span>T18:<span class="hljs-number">32</span>:<span class="hljs-number">49.847000</span>+<span class="hljs-number">08</span>:<span class="hljs-number">00</span> LOG report <span class="hljs-selector-tag">summary</span> reset<br>                  <span class="hljs-selector-tag">table</span> name     errors       rows      bytes      total <span class="hljs-selector-tag">time</span><br>----------------------------  ---------  ---------  ---------  --------------<br>             fetch meta data          <span class="hljs-number">0</span>        <span class="hljs-number">159</span>                     <span class="hljs-number">1.411s</span><br>              Create Schemas          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                     <span class="hljs-number">0.253s</span><br>            Create SQL Types          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                     <span class="hljs-number">0.152s</span><br>               Create tables          <span class="hljs-number">0</span>        <span class="hljs-number">134</span>                    <span class="hljs-number">25.585s</span><br>              Set Table OIDs          <span class="hljs-number">0</span>         <span class="hljs-number">67</span>                     <span class="hljs-number">0.080s</span><br>----------------------------  ---------  ---------  ---------  --------------<br>             stdb<span class="hljs-selector-class">.access_key</span>          <span class="hljs-number">0</span>          <span class="hljs-number">6</span>     <span class="hljs-number">1.6</span> kB          <span class="hljs-number">0.588s</span><br>          stdb<span class="hljs-selector-class">.alert_history</span>          <span class="hljs-number">0</span>      <span class="hljs-number">84369</span>    <span class="hljs-number">28.7</span> MB         <span class="hljs-number">28.544s</span><br>        stdb<span class="hljs-selector-class">.analysis_result</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                     <span class="hljs-number">6.861s</span><br>             stdb<span class="hljs-selector-class">.auth_group</span>          <span class="hljs-number">0</span>          <span class="hljs-number">2</span>     <span class="hljs-number">0.1</span> kB          <span class="hljs-number">7.222s</span><br>  stdb<span class="hljs-selector-class">.baas_contract_cluster</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                     <span class="hljs-number">7.661s</span><br>                  stdb<span class="hljs-selector-class">.cache</span>          <span class="hljs-number">0</span>        <span class="hljs-number">300</span>    <span class="hljs-number">49.2</span> kB          <span class="hljs-number">8.278s</span><br>            stdb<span class="hljs-selector-class">.auth_client</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                     <span class="hljs-number">2.851s</span><br>          stdb<span class="hljs-selector-class">.certification</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                     <span class="hljs-number">8.631s</span><br>           stdb<span class="hljs-selector-class">.auth_history</span>          <span class="hljs-number">0</span>         <span class="hljs-number">20</span>     <span class="hljs-number">1.6</span> kB          <span class="hljs-number">3.268s</span><br>          stdb<span class="hljs-selector-class">.chain_account</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                     <span class="hljs-number">8.968s</span><br>stdb<span class="hljs-selector-class">.baas_contract_warehouse</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                     <span class="hljs-number">3.595s</span><br>            stdb<span class="hljs-selector-class">.config_info</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                     <span class="hljs-number">9.251s</span><br>                   stdb<span class="hljs-selector-class">.cert</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                     <span class="hljs-number">4.014s</span><br>        stdb<span class="hljs-selector-class">.contract_entity</span>          <span class="hljs-number">0</span>          <span class="hljs-number">1</span>     <span class="hljs-number">0.5</span> kB          <span class="hljs-number">9.452s</span><br>                  stdb<span class="hljs-selector-class">.chain</span>          <span class="hljs-number">0</span>        <span class="hljs-number">163</span>   <span class="hljs-number">118.5</span> kB          <span class="hljs-number">4.337s</span><br> stdb<span class="hljs-selector-class">.contract_invoke_record</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                     <span class="hljs-number">9.598s</span><br>      stdb<span class="hljs-selector-class">.chain_transaction</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                     <span class="hljs-number">4.221s</span><br>   stdb<span class="hljs-selector-class">.contract_market_info</span>          <span class="hljs-number">0</span>         <span class="hljs-number">25</span>     <span class="hljs-number">3.5</span> kB          <span class="hljs-number">9.774s</span><br>       stdb<span class="hljs-selector-class">.contract_address</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                     <span class="hljs-number">4.065s</span><br>      stdb<span class="hljs-selector-class">.contract_template</span>          <span class="hljs-number">0</span>        <span class="hljs-number">129</span>    <span class="hljs-number">79.5</span> kB         <span class="hljs-number">10.058s</span><br>          stdb<span class="hljs-selector-class">.contract_info</span>          <span class="hljs-number">0</span>          <span class="hljs-number">8</span>     <span class="hljs-number">1.0</span> kB          <span class="hljs-number">4.046s</span><br>             stdb<span class="hljs-selector-class">.credential</span>          <span class="hljs-number">0</span>         <span class="hljs-number">41</span>    <span class="hljs-number">48.5</span> kB         <span class="hljs-number">10.322s</span><br>        stdb<span class="hljs-selector-class">.contract_market</span>          <span class="hljs-number">0</span>         <span class="hljs-number">16</span>    <span class="hljs-number">37.8</span> kB          <span class="hljs-number">4.197s</span><br>                 stdb<span class="hljs-selector-class">.driver</span>          <span class="hljs-number">0</span>         <span class="hljs-number">14</span>    <span class="hljs-number">94.6</span> kB         <span class="hljs-number">10.825s</span><br>        stdb<span class="hljs-selector-class">.contract_sample</span>          <span class="hljs-number">0</span>        <span class="hljs-number">664</span>     <span class="hljs-number">9.2</span> MB         <span class="hljs-number">14.125s</span><br>     stdb<span class="hljs-selector-class">.file_system_entity</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                    <span class="hljs-number">11.247s</span><br>         stdb<span class="hljs-selector-class">.gas_distribute</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                    <span class="hljs-number">11.666s</span><br>              stdb<span class="hljs-selector-class">.grade_one</span>          <span class="hljs-number">0</span>        <span class="hljs-number">664</span>    <span class="hljs-number">64.3</span> kB         <span class="hljs-number">11.957s</span><br>  stdb<span class="hljs-selector-class">.contract_version_info</span>          <span class="hljs-number">0</span>          <span class="hljs-number">1</span>     <span class="hljs-number">0.1</span> kB          <span class="hljs-number">3.688s</span><br>       stdb<span class="hljs-selector-class">.debug_properties</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                     <span class="hljs-number">4.150s</span><br>              stdb<span class="hljs-selector-class">.err_event</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                     <span class="hljs-number">4.543s</span><br>     stdb<span class="hljs-selector-class">.hibernate_sequence</span>          <span class="hljs-number">0</span>          <span class="hljs-number">1</span>     <span class="hljs-number">0.0</span> kB         <span class="hljs-number">11.902s</span><br>                   stdb<span class="hljs-selector-class">.form</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                     <span class="hljs-number">5.003s</span><br>         stdb<span class="hljs-selector-class">.instance_event</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                    <span class="hljs-number">12.349s</span><br>            stdb<span class="hljs-selector-class">.grade_group</span>          <span class="hljs-number">0</span>          <span class="hljs-number">5</span>     <span class="hljs-number">1.1</span> kB          <span class="hljs-number">5.484s</span><br>       stdb<span class="hljs-selector-class">.integral_account</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                    <span class="hljs-number">12.779s</span><br>             stdb<span class="hljs-selector-class">.grpc_event</span>          <span class="hljs-number">0</span>       <span class="hljs-number">4002</span>   <span class="hljs-number">894.1</span> kB          <span class="hljs-number">9.082s</span><br>       stdb<span class="hljs-selector-class">.java_file_entity</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                    <span class="hljs-number">13.242s</span><br>        stdb<span class="hljs-selector-class">.license_history</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                    <span class="hljs-number">13.717s</span><br>               stdb<span class="hljs-selector-class">.instance</span>          <span class="hljs-number">0</span>         <span class="hljs-number">70</span>   <span class="hljs-number">122.2</span> kB          <span class="hljs-number">9.365s</span><br>            stdb<span class="hljs-selector-class">.log_operate</span>          <span class="hljs-number">0</span>        <span class="hljs-number">439</span>   <span class="hljs-number">103.6</span> kB         <span class="hljs-number">14.198s</span><br>               stdb<span class="hljs-selector-class">.integral</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                     <span class="hljs-number">9.765s</span><br>     stdb<span class="hljs-selector-class">.monitor_indicators</span>          <span class="hljs-number">0</span>         <span class="hljs-number">52</span>    <span class="hljs-number">10.0</span> kB         <span class="hljs-number">14.635s</span><br>   stdb<span class="hljs-selector-class">.integral_transaction</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                    <span class="hljs-number">10.234s</span><br>                 stdb<span class="hljs-selector-class">.notice</span>          <span class="hljs-number">0</span>        <span class="hljs-number">270</span>   <span class="hljs-number">385.6</span> kB         <span class="hljs-number">15.572s</span><br>    stdb<span class="hljs-selector-class">.java_project_entity</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                    <span class="hljs-number">10.688s</span><br>               stdb<span class="hljs-selector-class">.log_file</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                    <span class="hljs-number">11.105s</span><br>           stdb<span class="hljs-selector-class">.organization</span>          <span class="hljs-number">0</span>         <span class="hljs-number">34</span>     <span class="hljs-number">8.1</span> kB         <span class="hljs-number">15.521s</span><br>          stdb<span class="hljs-selector-class">.monitor_alert</span>          <span class="hljs-number">0</span>         <span class="hljs-number">14</span>    <span class="hljs-number">11.2</span> kB         <span class="hljs-number">11.741s</span><br>                  stdb<span class="hljs-selector-class">.panel</span>          <span class="hljs-number">0</span>        <span class="hljs-number">169</span>     <span class="hljs-number">7.5</span> kB         <span class="hljs-number">15.474s</span><br>                   stdb<span class="hljs-selector-class">.node</span>          <span class="hljs-number">0</span>        <span class="hljs-number">333</span>   <span class="hljs-number">150.5</span> kB         <span class="hljs-number">12.311s</span><br>                stdb<span class="hljs-selector-class">.renewal</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                    <span class="hljs-number">15.791s</span><br>                   stdb<span class="hljs-selector-class">.role</span>          <span class="hljs-number">0</span>          <span class="hljs-number">6</span>     <span class="hljs-number">7.5</span> kB         <span class="hljs-number">15.830s</span><br>    stdb<span class="hljs-selector-class">.order_resource_ship</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                    <span class="hljs-number">12.207s</span><br>              stdb<span class="hljs-selector-class">.rule_type</span>          <span class="hljs-number">0</span>         <span class="hljs-number">11</span>     <span class="hljs-number">1.1</span> kB         <span class="hljs-number">15.752s</span><br>                 stdb<span class="hljs-selector-class">.output</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                    <span class="hljs-number">12.650s</span><br>              stdb<span class="hljs-selector-class">.secretkey</span>          <span class="hljs-number">0</span>         <span class="hljs-number">48</span>    <span class="hljs-number">23.2</span> kB         <span class="hljs-number">16.119s</span><br>             stdb<span class="hljs-selector-class">.prometheus</span>          <span class="hljs-number">0</span>        <span class="hljs-number">283</span>    <span class="hljs-number">56.8</span> kB         <span class="hljs-number">12.608s</span><br>  stdb<span class="hljs-selector-class">.third_contract_market</span>          <span class="hljs-number">0</span>          <span class="hljs-number">2</span>     <span class="hljs-number">0.4</span> kB         <span class="hljs-number">16.107s</span><br>       stdb<span class="hljs-selector-class">.report_id_entity</span>          <span class="hljs-number">0</span>          <span class="hljs-number">5</span>     <span class="hljs-number">0.1</span> kB         <span class="hljs-number">13.235s</span><br>           stdb<span class="hljs-selector-class">.user_setting</span>          <span class="hljs-number">0</span>          <span class="hljs-number">7</span>     <span class="hljs-number">0.5</span> kB         <span class="hljs-number">16.055s</span><br>                   stdb<span class="hljs-selector-class">.rule</span>          <span class="hljs-number">0</span>         <span class="hljs-number">39</span>    <span class="hljs-number">13.0</span> kB         <span class="hljs-number">13.143s</span><br>    stdb<span class="hljs-selector-class">.verification_result</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                    <span class="hljs-number">16.398s</span><br>     stdb<span class="hljs-selector-class">.sample_grade_model</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                    <span class="hljs-number">13.639s</span><br>           stdb<span class="hljs-selector-class">.subscription</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                    <span class="hljs-number">13.503s</span><br>                 stdb.<span class="hljs-string">&quot;user&quot;</span>          <span class="hljs-number">0</span>         <span class="hljs-number">34</span>    <span class="hljs-number">29.2</span> kB         <span class="hljs-number">14.018s</span><br>           stdb<span class="hljs-selector-class">.user_use_gas</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                    <span class="hljs-number">13.895s</span><br>----------------------------  ---------  ---------  ---------  --------------<br>     COPY Threads Completion          <span class="hljs-number">0</span>          <span class="hljs-number">4</span>                    <span class="hljs-number">28.540s</span><br>              Create Indexes          <span class="hljs-number">0</span>         <span class="hljs-number">92</span>                    <span class="hljs-number">19.382s</span><br>      Index Build Completion          <span class="hljs-number">0</span>         <span class="hljs-number">92</span>                     <span class="hljs-number">1.384s</span><br>             Reset Sequences          <span class="hljs-number">0</span>         <span class="hljs-number">16</span>                     <span class="hljs-number">0.746s</span><br>                Primary Keys          <span class="hljs-number">0</span>         <span class="hljs-number">66</span>                    <span class="hljs-number">12.146s</span><br>         Create Foreign Keys          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                     <span class="hljs-number">0.000s</span><br>             Create Triggers          <span class="hljs-number">0</span>         <span class="hljs-number">14</span>                     <span class="hljs-number">2.716s</span><br>             Set Search Path          <span class="hljs-number">0</span>          <span class="hljs-number">1</span>                     <span class="hljs-number">0.306s</span><br>            Install Comments          <span class="hljs-number">0</span>         <span class="hljs-number">74</span>                    <span class="hljs-number">13.552s</span><br>----------------------------  ---------  ---------  ---------  --------------<br>           Total import <span class="hljs-selector-tag">time</span>          âœ“      <span class="hljs-number">92247</span>    <span class="hljs-number">40.2</span> MB       <span class="hljs-number">1</span>m18.<span class="hljs-number">772s</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="ä½¿ç”¨pgbenchæµ‹è¯•PostgreSQL"><a href="#ä½¿ç”¨pgbenchæµ‹è¯•PostgreSQL" class="headerlink" title="ä½¿ç”¨pgbenchæµ‹è¯•PostgreSQL"></a>ä½¿ç”¨pgbenchæµ‹è¯•PostgreSQL</h2><ul>
<li>pgbench</li>
</ul>
<h2 id="Mysql-SQL-è¿ç§»-Postgres"><a href="#Mysql-SQL-è¿ç§»-Postgres" class="headerlink" title="Mysql SQL è¿ç§» Postgres"></a>Mysql SQL è¿ç§» Postgres</h2>  <figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># Limit ç”¨æ³•</span><br><span class="hljs-bullet">  -</span> mysql limit 0,1<br><span class="hljs-bullet">  -</span> postgres limit 1 offset 0<br><br><span class="hljs-section"># REGEXP ç”¨æ³•</span><br><span class="hljs-bullet">  -</span> mysql REGEXP<br><span class="hljs-bullet">  -</span> postgres ~<br></code></pre></td></tr></table></figure>

<h2 id="è·¯ä¸Šé‡åˆ°çš„å‘"><a href="#è·¯ä¸Šé‡åˆ°çš„å‘" class="headerlink" title="è·¯ä¸Šé‡åˆ°çš„å‘"></a>è·¯ä¸Šé‡åˆ°çš„å‘</h2><ul>
<li>PostgreSQLåˆ—ååŒºåˆ†å¤§å°å†™<figure class="highlight gherkin"><table><tr><td class="code"><pre><code class="hljs gherkin">blocface=<span class="hljs-comment"># \d public.alert</span><br>                                         Table <span class="hljs-string">&quot;public.alert&quot;</span><br>   Column    |<span class="hljs-string">            Type             </span>|<span class="hljs-string"> Collation </span>|<span class="hljs-string"> Nullable </span>|<span class="hljs-string">              Default</span><br><span class="hljs-string">-------------+-----------------------------+-----------+----------+-----------------------------------</span><br><span class="hljs-string"> id          </span>|<span class="hljs-string"> integer                     </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> not null </span>|<span class="hljs-string"> nextval(&#x27;alert_id_seq&#x27;::regclass)</span><br><span class="hljs-string"> time_create </span>|<span class="hljs-string"> timestamp without time zone </span>|<span class="hljs-string">           </span>|<span class="hljs-string">          </span>|<br> time_update |<span class="hljs-string"> timestamp without time zone </span>|<span class="hljs-string">           </span>|<span class="hljs-string">          </span>|<br> time_delete |<span class="hljs-string"> timestamp without time zone </span>|<span class="hljs-string">           </span>|<span class="hljs-string">          </span>|<br> name        |<span class="hljs-string"> character varying(255)      </span>|<span class="hljs-string">           </span>|<span class="hljs-string">          </span>|<br> mode        |<span class="hljs-string"> integer                     </span>|<span class="hljs-string">           </span>|<span class="hljs-string">          </span>|<br> condition   |<span class="hljs-string"> integer                     </span>|<span class="hljs-string">           </span>|<span class="hljs-string">          </span>|<br> silence     |<span class="hljs-string"> integer                     </span>|<span class="hljs-string">           </span>|<span class="hljs-string">          </span>|<br> user_id     |<span class="hljs-string"> character varying(64)       </span>|<span class="hljs-string">           </span>|<span class="hljs-string">          </span>|<br> group_id    |<span class="hljs-string"> character varying(64)       </span>|<span class="hljs-string">           </span>|<span class="hljs-string">          </span>|<br> viewer      |<span class="hljs-string"> character varying(32)       </span>|<span class="hljs-string">           </span>|<span class="hljs-string">          </span>|<br> isDeleted   |<span class="hljs-string"> integer                     </span>|<span class="hljs-string">           </span>|<span class="hljs-string">          </span>|<span class="hljs-string"> 0</span><br><span class="hljs-string">Indexes:</span><br><span class="hljs-string">    &quot;alert_pkey&quot; PRIMARY KEY, btree (id)</span><br><span class="hljs-string">    &quot;IDX_alert_time_delete&quot; btree (time_delete)</span><br><span class="hljs-string"></span><br><span class="hljs-string"># æ‰€æœ‰æœªåŒå¼•å·çš„æ ‡è¯†ç¬¦(åŒ…æ‹¬åˆ—å)åœ¨PostgreSQLä¸­è¢«æŠ˜å ä¸ºå°å†™ï¼Œç”¨åŒå¼•å·åˆ›å»ºçš„åˆ—åå¹¶å› æ­¤ä¿ç•™äº†å¤§å†™å­—æ¯ï¼Œå¿…é¡»åœ¨ä½™ä¸‹çš„æ—¶é—´å°†åŒå¼•å·æ‹¬èµ·æ¥(&quot;first_Name&quot;)</span><br><span class="hljs-string">blocface=# SELECT isDeleted from public.alert;</span><br><span class="hljs-string">ERROR:  column &quot;isdeleted&quot; does not exist</span><br><span class="hljs-string">LINE 1: SELECT isDeleted from public.alert;</span><br><span class="hljs-string">               ^</span><br><span class="hljs-string">HINT:  Perhaps you meant to reference the column &quot;alert.isDeleted&quot;.</span><br><span class="hljs-string">blocface=# SELECT &quot;isDeleted&quot; from public.alert;</span><br><span class="hljs-string"> isDeleted</span><br><span class="hljs-string">-----------</span><br><span class="hljs-string">(0 rows)</span><br></code></pre></td></tr></table></figure></li>
<li>PostgreSQL Duplicate Key Violates unique constraint<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql">Q: the <span class="hljs-keyword">sequence</span> was <span class="hljs-keyword">out</span> <span class="hljs-keyword">of</span> sync <span class="hljs-keyword">and</span> <span class="hljs-keyword">no</span> more records<br>A: the <span class="hljs-keyword">sequence</span> must be synchronized mannually.<br>  The <span class="hljs-type">name</span> <span class="hljs-keyword">of</span> the <span class="hljs-keyword">sequence</span> can be determined <span class="hljs-keyword">with</span> teh command PG_GET_SERIAL_SEQUENCE<br>  # Command <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> the <span class="hljs-keyword">sequence</span> <span class="hljs-type">name</span>:<br>  # the <span class="hljs-keyword">table</span> <span class="hljs-type">name</span> must be <span class="hljs-keyword">in</span> <span class="hljs-type">double</span> quotes, surrounded <span class="hljs-keyword">by</span> single quotes<br>  &gt; <span class="hljs-keyword">SELECT</span> PG_GET_SERIAL_SEQUENCE(<span class="hljs-string">&#x27;&quot;foo&quot;&#x27;</span>, <span class="hljs-string">&#x27;foo_id&#x27;</span>)<br><br>  # <span class="hljs-keyword">Validate</span>, the <span class="hljs-keyword">sequence</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">out</span>-<span class="hljs-keyword">of</span>-sync<br>  # <span class="hljs-keyword">When</span> the <span class="hljs-keyword">Current</span> <span class="hljs-keyword">Value</span> <span class="hljs-keyword">is</span> less than Max <span class="hljs-keyword">Value</span>, your <span class="hljs-keyword">sequence</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">out</span>-<span class="hljs-keyword">of</span>-sync<br>  &gt; <span class="hljs-keyword">SELECT</span> CURRVAL(PG_GET_SERIAL_SEQUENCE(<span class="hljs-string">&#x27;&quot;foo&quot;&#x27;</span>, <span class="hljs-string">&#x27;foo_id&#x27;</span>)) <span class="hljs-keyword">AS</span> &quot;Current Value&quot;, MAX(&quot;foo_id&quot;) <span class="hljs-keyword">AS</span> &quot;Max Value&quot; <span class="hljs-keyword">FROM</span> &quot;foo&quot;;<br><br>  # Correction<br>  &gt; <span class="hljs-keyword">SELECT</span> SETVAL((<span class="hljs-keyword">SELECT</span> PG_GET_SERIAL_SEQUENCE(<span class="hljs-string">&#x27;&quot;foo&quot;&#x27;</span>, <span class="hljs-string">&#x27;foo_id&#x27;</span>)), (<span class="hljs-keyword">SELECT</span> (MAX(&quot;foo_id&quot;) + <span class="hljs-number">1</span>) <span class="hljs-keyword">FROM</span> &quot;foo&quot;), <span class="hljs-keyword">FALSE</span>);<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://www.howtoing.com/how-to-migrate-mysql-database-to-postgres-using-pgloader">å¦‚æœä½¿ç”¨pgloaderå°†MySQLæ•°æ®åº“è¿ç§»åˆ°PostgreSQL</a></li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>Build Go Executables for Multiple Platforms</title>
    <url>/2021/10/26/Build-Go-Executables-for-Multiple-Platforms/</url>
    <content><![CDATA[<h1 id="æ„å»ºGoå¯æ‰§è¡Œæ–‡ä»¶"><a href="#æ„å»ºGoå¯æ‰§è¡Œæ–‡ä»¶" class="headerlink" title="æ„å»ºGoå¯æ‰§è¡Œæ–‡ä»¶"></a>æ„å»ºGoå¯æ‰§è¡Œæ–‡ä»¶</h1><blockquote>
<p>Go most powerful features is the ability to cross-build(è·¨å¹³å°äº¤å‰ç¼–è¯‘æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶)executables for any Go-supported foreign platform.</p>
</blockquote>
<span id="more"></span>

<h2 id="Installing-Go-Programs-from-Version-Control"><a href="#Installing-Go-Programs-from-Version-Control" class="headerlink" title="Installing Go Programs from Version Control"></a>Installing Go Programs from Version Control</h2><figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go">$ <span class="hljs-keyword">go</span> get -u <span class="hljs-keyword">package</span>-<span class="hljs-keyword">import</span>-path<br></code></pre></td></tr></table></figure>

<h2 id="Building-an-Executable"><a href="#Building-an-Executable" class="headerlink" title="Building an Executable"></a>Building an Executable</h2><figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># This command creates the executable, and also create the ./build directory if it doesn&#x27;t exist</span><br>$ go build -o build<span class="hljs-regexp">/caddy-server github.com/m</span>holt<span class="hljs-regexp">/caddy/</span>caddy<br></code></pre></td></tr></table></figure>

<h2 id="Installing-an-Executable"><a href="#Installing-an-Executable" class="headerlink" title="Installing an Executable"></a>Installing an Executable</h2><figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk">$ go install github.com<span class="hljs-regexp">/mholt/</span>caddy/caddy<br></code></pre></td></tr></table></figure>

<h2 id="Cross-Compiling"><a href="#Cross-Compiling" class="headerlink" title="Cross Compiling"></a>Cross Compiling</h2><figure class="highlight livecodeserver"><table><tr><td class="code"><pre><code class="hljs livecodeserver">&gt; Cross-compiling works <span class="hljs-keyword">by</span> setting required environment variables that specify <span class="hljs-keyword">the</span> target operating <span class="hljs-keyword">system</span> <span class="hljs-keyword">and</span> architecture.<br>   - GOOS: <span class="hljs-keyword">the</span> target operating <span class="hljs-keyword">system</span><br>   - GOARCH: <span class="hljs-keyword">the</span> target architecture<br><br><span class="hljs-comment"># the env command runs a program in a modified environment.</span><br>$ env GOOS=target-OS GOARCH=target-architecture go build package-import-path<br></code></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center">GOOS - Target Operating System</th>
<th align="center">GOARCH - Target Platform</th>
</tr>
</thead>
<tbody><tr>
<td align="center">android</td>
<td align="center">arm</td>
</tr>
<tr>
<td align="center">darwin</td>
<td align="center">386</td>
</tr>
<tr>
<td align="center">darwin</td>
<td align="center">amd64</td>
</tr>
<tr>
<td align="center">darwin</td>
<td align="center">arm</td>
</tr>
<tr>
<td align="center">darwin</td>
<td align="center">arm64</td>
</tr>
<tr>
<td align="center">dragonfly</td>
<td align="center">amd64</td>
</tr>
<tr>
<td align="center">freebsd</td>
<td align="center">386</td>
</tr>
<tr>
<td align="center">freebsd</td>
<td align="center">amd64</td>
</tr>
<tr>
<td align="center">freebsd</td>
<td align="center">arm</td>
</tr>
<tr>
<td align="center">linux</td>
<td align="center">386</td>
</tr>
<tr>
<td align="center">linux</td>
<td align="center">amd64</td>
</tr>
<tr>
<td align="center">linux</td>
<td align="center">arm</td>
</tr>
<tr>
<td align="center">linux</td>
<td align="center">arm64</td>
</tr>
<tr>
<td align="center">linux</td>
<td align="center">ppc64</td>
</tr>
<tr>
<td align="center">linux</td>
<td align="center">ppc64le</td>
</tr>
<tr>
<td align="center">linux</td>
<td align="center">mips</td>
</tr>
<tr>
<td align="center">linux</td>
<td align="center">mips64le</td>
</tr>
<tr>
<td align="center">netbsd</td>
<td align="center">386</td>
</tr>
<tr>
<td align="center">netbsd</td>
<td align="center">amd64</td>
</tr>
<tr>
<td align="center">netbsd</td>
<td align="center">arm</td>
</tr>
<tr>
<td align="center">openbsd</td>
<td align="center">386</td>
</tr>
<tr>
<td align="center">openbsd</td>
<td align="center">amd64</td>
</tr>
<tr>
<td align="center">openbsd</td>
<td align="center">arm</td>
</tr>
<tr>
<td align="center">plan9</td>
<td align="center">386</td>
</tr>
<tr>
<td align="center">plan9</td>
<td align="center">amd64</td>
</tr>
<tr>
<td align="center">solaris</td>
<td align="center">amd64</td>
</tr>
<tr>
<td align="center">windows</td>
<td align="center">386</td>
</tr>
<tr>
<td align="center">windows</td>
<td align="center">amd64</td>
</tr>
</tbody></table>
<h2 id="Creating-a-Script-to-Automate-Cross-Compilation"><a href="#Creating-a-Script-to-Automate-Cross-Compilation" class="headerlink" title="Creating a Script to Automate Cross-Compilation"></a>Creating a Script to Automate Cross-Compilation</h2><figure class="highlight clean"><table><tr><td class="code"><pre><code class="hljs clean">$ cd ~<br>$ vim go-executable-build.sh<br>#!/usr/bin/env bash<br><br>######################################################################<br># @author      : chyiyaqing (<span class="hljs-number">404</span>@gmail.com)<br># @file        : go-executable-build<br># @created     : Tuesday Oct <span class="hljs-number">26</span>, <span class="hljs-number">2021</span> <span class="hljs-number">18</span>:<span class="hljs-number">22</span>:<span class="hljs-number">35</span> CST<br>#<br># @description : Creating a Script to Automate Cross-Compilation go build<br>######################################################################<br><br># $<span class="hljs-number">0</span> -- contains the name <span class="hljs-keyword">of</span> the script you executed<br>package=$<span class="hljs-number">1</span><br><br># Make sure the user provided this value<br><span class="hljs-keyword">if</span> [[ -z <span class="hljs-string">&quot;$package&quot;</span>  ]]; then<br>   echo <span class="hljs-string">&quot;usage: $0 &lt;package-name&gt;&quot;</span><br>   # <span class="hljs-number">0</span> for successful executions and any non-zero value for unsuccessful executions<br>   exit <span class="hljs-number">1</span><br>fi<br><br># extract the package name <span class="hljs-keyword">from</span> the ath<br>package_split=($&#123;package<span class="hljs-comment">//\// &#125;)</span><br>package_name=$&#123;package_split[<span class="hljs-number">-1</span>]&#125;<br><br>platforms=(<span class="hljs-string">&quot;linux/amd64&quot;</span>, <span class="hljs-string">&quot;darwin/amd64&quot;</span>, <span class="hljs-string">&quot;linux/arm64&quot;</span>, <span class="hljs-string">&quot;darwin/arm64&quot;</span>)<br><br># ierate though the array <span class="hljs-keyword">of</span> platforms, split each platform into values for the GOOS and GOARCH<br>for platform <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;$&#123;platform[@]&#125;&quot;</span><br>do<br>   platform_split = ($&#123;platform<span class="hljs-comment">//\// &#125;)</span><br>   GOOS=$&#123;platform_split[<span class="hljs-number">0</span>]&#125;<br>   GOARCH=$&#123;platform_split[<span class="hljs-number">1</span>]&#125;<br><br>   output_name=$package_name<span class="hljs-string">&#x27;-&#x27;</span>$GOOS<span class="hljs-string">&#x27;-&#x27;</span>$GOARCH<br><br>   <span class="hljs-keyword">if</span> [ $GOOS = <span class="hljs-string">&quot;windows&quot;</span>  ]; then<br>    Â¦   output_name+=<span class="hljs-string">&#x27;.exe&#x27;</span><br>   fi<br><br>   env GOOS=$GOOS GOARCH=$GOARCH go build -o $output_name $package<br><br>   # check <span class="hljs-keyword">if</span> there were errors building the executable<br>   <span class="hljs-keyword">if</span> [ $? -ne <span class="hljs-number">0</span>  ]; then<br>      echo <span class="hljs-string">&#x27;An error has occurred! Aborting the script execution...&#x27;</span><br>     Â¦exec <span class="hljs-number">1</span><br>   fi<br>done<br></code></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>Git Intro</title>
    <url>/2021/10/26/Git-Intro/</url>
    <content><![CDATA[<h1 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h1><span id="more"></span>

<h2 id="git-commit-message"><a href="#git-commit-message" class="headerlink" title="git commit message"></a>git commit message</h2><ul>
<li>git commit -m â€œ<type>(<scope>): <subject>â€œ<figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># type:</span><br><span class="hljs-bullet">  -</span> feat: feature<br><span class="hljs-bullet">  -</span> fix: fix bug<br><span class="hljs-bullet">  -</span> docs: ä¿®æ”¹README<br><span class="hljs-bullet">  -</span> style: æ ¼å¼åŒ–<br><span class="hljs-bullet">  -</span> refactor: ä»£ç é‡æ„<br><span class="hljs-bullet">  -</span> test: æµ‹è¯•<br><span class="hljs-bullet">  -</span> chore: æ”¹å˜æ„å»ºæµç¨‹ï¼Œå¢åŠ ä¾èµ–åº“<br><span class="hljs-bullet">  -</span> perf: æ€§èƒ½ä¼˜åŒ–<br><span class="hljs-bullet">  -</span> revert: å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬<br><br><span class="hljs-section"># scope:</span><br>  &gt; è¯´æ˜commitå½±å“çš„èŒƒå›´ [æ•°æ®å±‚ã€æ§åˆ¶å±‚ã€è§†å›¾å±‚]<br><br><span class="hljs-section"># subject:</span><br>  &gt; commitç›®çš„çš„ç®€çŸ­æè¿°,ä¸è¶…è¿‡50ä¸ªå­—ç¬¦<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Git-Stats"><a href="#Git-Stats" class="headerlink" title="Git Stats"></a>Git Stats</h2><ul>
<li><ol>
<li>Roll your own stats with gitâ€™s command line options<figure class="highlight"><table><tr><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>Unix&amp;Linux FAQ</title>
    <url>/2021/10/27/Unix-Linux-FAQ/</url>
    <content><![CDATA[<h2 id="æŸ¥çœ‹çŠ¶æ€ä¿¡æ¯"><a href="#æŸ¥çœ‹çŠ¶æ€ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹çŠ¶æ€ä¿¡æ¯"></a>æŸ¥çœ‹çŠ¶æ€ä¿¡æ¯</h2><ul>
<li><ol>
<li>calculate total disk space<figure class="highlight brainfuck"><table><tr><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">$</span> <span class="hljs-comment">df</span> <span class="hljs-literal">-</span><span class="hljs-comment">h</span> --<span class="hljs-comment">output=size</span> --<span class="hljs-comment">total</span><br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><ol start="2">
<li>dig &amp; nslookup<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> dig, nslookup ç”¨äºç½‘ç»œæ•…éšœæ’é™¤å’Œæ”¶é›†æœ‰å…³åŸŸåçš„ä¿¡æ¯</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> Dig: Domain Information Gopher</span><br><span class="hljs-meta">  &gt;</span><span class="bash"> ä¸€ç§DNSæŸ¥æ‰¾ç¨‹åº,ç”¨äºæ¢æµ‹DNSæœåŠ¡å™¨å¹¶å¯¹ä¸DNSæœåŠ¡ç›¸å…³çš„é—®é¢˜è¿›è¡Œæ•…éšœæ’æŸ¥</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> Nslookup:</span> <br></code></pre></td></tr></table></figure>
<h2 id="å†…æ ¸å‚æ•°è°ƒä¼˜"><a href="#å†…æ ¸å‚æ•°è°ƒä¼˜" class="headerlink" title="å†…æ ¸å‚æ•°è°ƒä¼˜"></a>å†…æ ¸å‚æ•°è°ƒä¼˜</h2></li>
</ol>
</li>
<li></li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>Hacker Scripts</title>
    <url>/2021/10/31/Hacker-Scripts/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>My World</title>
    <url>/2021/11/03/My-World/</url>
    <content><![CDATA[<h1 id="My-World-æˆ‘çš„ä¸–ç•Œ"><a href="#My-World-æˆ‘çš„ä¸–ç•Œ" class="headerlink" title="My World (æˆ‘çš„ä¸–ç•Œ)"></a>My World (æˆ‘çš„ä¸–ç•Œ)</h1><span id="more"></span>
<h2 id="Jargon"><a href="#Jargon" class="headerlink" title="Jargon"></a>Jargon</h2><ul>
<li>IMO: In My Opinion</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>School of SRE</title>
    <url>/2021/11/16/School-of-SRE/</url>
    <content><![CDATA[<h1 id="SRE-Site-Reliability-Engineers"><a href="#SRE-Site-Reliability-Engineers" class="headerlink" title="SRE (Site Reliability Engineers)"></a>SRE (Site Reliability Engineers)</h1><ul>
<li>Level 101<ul>
<li><a href="#fundamentals-series">Fundamentals Series</a><ul>
<li>Linux Basics</li>
<li>Git</li>
<li>Linux Networking</li>
</ul>
</li>
<li><a href="#python-and-web">Python and Web</a></li>
<li>Data<ul>
<li>Relational databasees(MySQL)</li>
<li>NoSQL concepts</li>
<li>Big Data</li>
</ul>
</li>
<li>Systems Design</li>
<li>Metrics and Monitoring</li>
<li>Security</li>
</ul>
</li>
<li>Level 102<ul>
<li>Linux Intermediate</li>
<li>Linux Advanced<ul>
<li>Containers and orchestration</li>
<li>System Calls and Signals</li>
</ul>
</li>
<li>Networking</li>
<li>System Design</li>
<li>System troubleshooting and performance improvements</li>
<li>Continuous Integration and Continuous Delivery</li>
</ul>
</li>
</ul>
<span id="more"></span>


<h2 id="Fundamentals-Series"><a href="#Fundamentals-Series" class="headerlink" title="Fundamentals Series"></a>Fundamentals Series</h2><figure class="highlight applescript"><table><tr><td class="code"><pre><code class="hljs applescript"><span class="hljs-built_in">say</span> hello<br></code></pre></td></tr></table></figure>

<h2 id="Python-and-Web"><a href="#Python-and-Web" class="headerlink" title="Python and Web"></a>Python and Web</h2><figure class="highlight applescript"><table><tr><td class="code"><pre><code class="hljs applescript"><span class="hljs-built_in">say</span> python<br></code></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>Markdown Intro</title>
    <url>/2021/11/18/Markdown-Intro/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Patterns of Distributed Systems</title>
    <url>/2021/11/25/Patterns-of-Distributed-Systems/</url>
    <content><![CDATA[<h1 id="Patterns-of-Distributed-Systems"><a href="#Patterns-of-Distributed-Systems" class="headerlink" title="Patterns of Distributed Systems"></a>Patterns of Distributed Systems</h1><ul>
<li>Distributed systems - An implementation perspective<table>
<thead>
<tr>
<th align="left">Type of platform/framework</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Databases</td>
<td align="left">Cassandra, HBase, Riak</td>
</tr>
<tr>
<td align="left">Message Brokers</td>
<td align="left">Kafka, Pulsar</td>
</tr>
<tr>
<td align="left">Infrastructure</td>
<td align="left">Kubernetes, Mesos, Zookeeper, etcd, Consul</td>
</tr>
<tr>
<td align="left">In Memory Data/Compute Grids</td>
<td align="left">Hazelcast, Pivotal Gemfire</td>
</tr>
<tr>
<td align="left">Stateful Microservices</td>
<td align="left">Akka Actors, Axon</td>
</tr>
<tr>
<td align="left">File Systems</td>
<td align="left">HDFS, Ceph</td>
</tr>
</tbody></table>
</li>
</ul>
<span id="more"></span>


<h2 id="Problems-and-Their-Recurriing-Solutions"><a href="#Problems-and-Their-Recurriing-Solutions" class="headerlink" title="Problems and Their Recurriing Solutions"></a>Problems and Their Recurriing Solutions</h2><blockquote>
<p>Serveral things can go wrong when data is stored on multiple servers.</p>
</blockquote>
<ul>
<li><p>Process crashes</p>
<ul>
<li>It can be taken down for routine maintenance by system administrators</li>
<li>It can be killed doing some file IO because the disk if full and the exception is not properly handled.</li>
<li>It cloud environments, it can be even trickier, as some unrelated events can bring the servers down.<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql">&gt; Flushing data <span class="hljs-keyword">to</span> the disk <span class="hljs-keyword">is</span> one <span class="hljs-keyword">of</span> the most <span class="hljs-type">time</span> consuming operations, <span class="hljs-keyword">not</span> every <span class="hljs-keyword">insert</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">update</span> <span class="hljs-keyword">to</span> the <span class="hljs-keyword">storage</span> can be flushed <span class="hljs-keyword">to</span> disk.<br><br># <span class="hljs-keyword">Write</span>-Ahead <span class="hljs-keyword">Log</span><br>&gt; Servers store <span class="hljs-keyword">each</span> state change <span class="hljs-keyword">as</span> a command <span class="hljs-keyword">in</span> an append-<span class="hljs-keyword">only</span> file <span class="hljs-keyword">on</span> a hard disk. Appending a file <span class="hljs-keyword">is</span> generally a very fast operation, so it can be done <span class="hljs-keyword">without</span> impacting performance. This gives a durability guarantee. The data will <span class="hljs-keyword">not</span> <span class="hljs-keyword">get</span> lost even <span class="hljs-keyword">if</span> the <span class="hljs-keyword">server</span> abruptly crashes <span class="hljs-keyword">and</span> <span class="hljs-keyword">then</span> restarts<br><br>&gt; But clients will <span class="hljs-keyword">not</span> be able <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> <span class="hljs-keyword">or</span> store <span class="hljs-keyword">any</span> data till the <span class="hljs-keyword">server</span> <span class="hljs-keyword">is</span> back up. lack availability <span class="hljs-keyword">in</span> the <span class="hljs-keyword">case</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">server</span> failure. One <span class="hljs-keyword">of</span> the obvious solutions <span class="hljs-keyword">is</span> <span class="hljs-keyword">to</span> store the data <span class="hljs-keyword">on</span> multiple servers. So we can replicate the <span class="hljs-keyword">write</span> ahead <span class="hljs-keyword">log</span> <span class="hljs-keyword">on</span> multiple servers.<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Network delays(å»¶è¿Ÿ)</p>
<blockquote>
<p>In the TCP/IP protocol stack, there is no upper bound on delays caused in transmitting messages across a network.</p>
</blockquote>
<ul>
<li>A particular server can not wait indefinitely(æ— æœŸé™) to know if another server has crashed.<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><code class="hljs livecodeserver">&gt; To tackle <span class="hljs-keyword">the</span> <span class="hljs-keyword">first</span> problem, every server sends <span class="hljs-keyword">a</span> HeartBeat message <span class="hljs-built_in">to</span> other servers <span class="hljs-keyword">at</span> <span class="hljs-keyword">a</span> regular interval.<br></code></pre></td></tr></table></figure></li>
<li>There should not be two set of servers, each considering another set to have failed, and therefore continuing to serve different sets of clients. This is called the split brain(è„‘è£‚)<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><code class="hljs livecodeserver">In gneral, If we want <span class="hljs-built_in">to</span> tolerate f failures we need <span class="hljs-built_in">to</span> cluster size <span class="hljs-keyword">of</span> <span class="hljs-number">2</span>f + <span class="hljs-number">1.</span><br><br>Leader <span class="hljs-keyword">and</span> Followers is used <span class="hljs-keyword">in</span> this situation. One <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> servers is elected <span class="hljs-keyword">a</span> leader <span class="hljs-keyword">and</span> <span class="hljs-keyword">the</span> other servers acts <span class="hljs-keyword">as</span> followers.<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Process Pauses</p>
<ul>
<li>Generation Clock<blockquote>
<p>A monotenically increasing number indicating the generation of the server.</p>
</blockquote>
</li>
</ul>
</li>
<li><p>Unsynchronized Clocks and Ordering Events</p>
<blockquote>
<p>The main reason we can not use system clocks is that system clocks across servers are not guaranteed to be synchronized. A time-of-the day clock in a computer is amanaged by a quartz crystal and measures time based on the oscilations of the crystal.<br>The clocks across a set of servers are synchronized by a service called NTP. This service periodically checks a set of global time servers, and adjusts the computer clock accordingly.</p>
</blockquote>
<ul>
<li>Lamport(çƒ‚æ³¢ç‰¹) Clock<blockquote>
<p>Use logical timestamps as a version for a value to allow ordering of values across servers.</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h2 id="Pattern-Sequence"><a href="#Pattern-Sequence" class="headerlink" title="Pattern Sequence"></a>Pattern Sequence</h2><blockquote>
<p>In very simple terms, Consensus(å…±è¯†) refers to a set of servers which agree on stored data, the order in which the data is stored and when to make that data visible to the clients.</p>
</blockquote>
<ul>
<li>Pattern Sequence(åºåˆ—) for implementing consensus<figure class="highlight pf"><table><tr><td class="code"><pre><code class="hljs pf">Consensus implementations use <span class="hljs-keyword">state</span> machine replication <span class="hljs-keyword">to</span> achieve fault tolerance.<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><ul>
<li>Raft</li>
<li>Zab</li>
<li>Cassandra</li>
<li>Epochâ€™s in Kafka</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>websocket intro</title>
    <url>/2021/12/01/websocket-intro/</url>
    <content><![CDATA[<h1 id="The-Websocket-Protocol"><a href="#The-Websocket-Protocol" class="headerlink" title="The Websocket Protocol"></a>The Websocket Protocol</h1><ul>
<li><p>Introduction</p>
<ul>
<li><p>Background</p>
<ul>
<li>variety of problem<ul>
<li>The server is forced to use a number of different underlying TCP connections for each client: one for sending information to the client and a new one for each incoming message.</li>
<li>The wire protocol has a high overhead, with each client-to-server message having an HTTP header.</li>
<li>The client-side script is forced to maintain a mapping from the outgoing connections to the incoming connection to track replies.</li>
</ul>
</li>
</ul>
</li>
<li><p>Protocol Overview</p>
<ul>
<li>The protocol has two parts: a handshake and the data transfer.<ul>
<li>The handshake from the client looks as follows<figure class="highlight"><table><tr><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<span id="more"></span>

<ul>
<li>publisher-subscriber server<ul>
<li>(as known as a bus, message broker, or event-channel)<ul>
<li>receive notifications about state changes on the one hand, and subscriptions for such notifications on the other.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/misc/images/websocket.png" alt="websocket"></p>
<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><p>[]</p>
]]></content>
  </entry>
  <entry>
    <title>RAID Intro</title>
    <url>/2021/12/12/RAID-Intro/</url>
    <content><![CDATA[<h1 id="RAID"><a href="#RAID" class="headerlink" title="RAID"></a>RAID</h1><blockquote>
<p>stands for Redundant Array of Inexpensive Disks(å»‰ä»·ç£ç›˜å†—ä½™é˜µåˆ—)</p>
</blockquote>
<ul>
<li><p>Hardware RAID</p>
<blockquote>
<p>Hardware RAID using controllers or RAID cards to manage the RAID configuration independently from the operating system.</p>
</blockquote>
</li>
<li><p>Software RAID</p>
<blockquote>
<p>Software RAID tends to be slower than hardware RAID.</p>
</blockquote>
</li>
</ul>
<span id="more"></span>

<h2 id="RAID-Level-Comparision"><a href="#RAID-Level-Comparision" class="headerlink" title="RAID Level Comparision"></a>RAID Level Comparision</h2><ul>
<li><p>RAID 0<br><img src="/misc/images/raid/raid0.jpg" alt="raid 0"></p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><code class="hljs livecodeserver">&gt; data are <span class="hljs-built_in">split</span> up <span class="hljs-keyword">into</span> blocks that <span class="hljs-built_in">get</span> written across all <span class="hljs-keyword">the</span> drivers <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> array. By <span class="hljs-keyword">using</span> multiple disks (<span class="hljs-keyword">at</span> least <span class="hljs-number">2</span>) <span class="hljs-keyword">at</span> <span class="hljs-keyword">the</span> same <span class="hljs-built_in">time</span>, this offers fast <span class="hljs-built_in">read</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">write</span> speeds.<br><span class="hljs-comment"># Downside</span><br>  - RAID <span class="hljs-number">0</span> is <span class="hljs-keyword">not</span> redundant, <span class="hljs-keyword">the</span> loss <span class="hljs-keyword">of</span> <span class="hljs-keyword">any</span> individual will cause complete data loss.<br></code></pre></td></tr></table></figure></li>
<li><p>RAID 1<br><img src="/misc/images/raid/raid1.jpg" alt="raid 1"></p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><code class="hljs livecodeserver">RAID <span class="hljs-number">1</span> is setup <span class="hljs-keyword">of</span> <span class="hljs-keyword">at</span> least <span class="hljs-literal">two</span> drives.<br>RAID <span class="hljs-number">1</span> is high <span class="hljs-built_in">read</span> performance, <span class="hljs-keyword">as</span> data can be <span class="hljs-built_in">read</span> off <span class="hljs-keyword">any</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> drives <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> array.<br>Since <span class="hljs-keyword">the</span> data needs <span class="hljs-built_in">to</span> be written <span class="hljs-built_in">to</span> all <span class="hljs-keyword">the</span> drives <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> array, <span class="hljs-keyword">the</span> <span class="hljs-built_in">write</span> speed is slower than <span class="hljs-keyword">a</span> RAID <span class="hljs-number">0</span> array.<br></code></pre></td></tr></table></figure></li>
<li><p>RAID 5<br><img src="/misc/images/raid/raid5.jpg" alt="raid 5"></p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><code class="hljs applescript"><span class="hljs-string">&quot;parity&quot;</span> distributed across <span class="hljs-keyword">the</span> drives.<br>READ speed <span class="hljs-keyword">is</span> very fast <span class="hljs-keyword">but</span> <span class="hljs-built_in">write</span> speed <span class="hljs-keyword">is</span> somewhat slower due <span class="hljs-keyword">to</span> <span class="hljs-keyword">the</span> partity <span class="hljs-keyword">that</span> has <span class="hljs-keyword">to</span> be calculated.<br></code></pre></td></tr></table></figure></li>
<li><p>RAID 6<br><img src="/misc/images/raid/raid6.jpg" alt="raid 6"></p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><code class="hljs applescript">Read speed <span class="hljs-keyword">is</span> <span class="hljs-keyword">as</span> fast <span class="hljs-keyword">as</span> RAID <span class="hljs-number">5</span>, <span class="hljs-keyword">but</span> <span class="hljs-built_in">write</span> speed <span class="hljs-keyword">is</span> slower than RAID <span class="hljs-number">5.</span><br>RAID <span class="hljs-number">6</span> <span class="hljs-keyword">is</span> a very good option <span class="hljs-keyword">for</span> a standard web server, <span class="hljs-keyword">where</span> most <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> transactions are reads, <span class="hljs-keyword">but</span> <span class="hljs-keyword">its</span> <span class="hljs-keyword">not</span> recommanded <span class="hljs-keyword">for</span> a heavy <span class="hljs-built_in">write</span> environment.<br></code></pre></td></tr></table></figure></li>
<li><p>RAID 10<br><img src="/misc/images/raid/raid10.jpg" alt="raid 10"></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">RAID</span> <span class="hljs-number">10</span> can provide the speed of RAID <span class="hljs-number">0</span> with the redundancy of RAID <span class="hljs-number">1</span>.<br></code></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight tcl"><table><tr><td class="code"><pre><code class="hljs tcl">chyiyaqing in ~ at chyiyaqing-PowerEdge-R720<br>âœ cat /<span class="hljs-keyword">proc</span>/scsi/scsi<span class="hljs-title"></span><br><span class="hljs-title">Attached</span> devices:<span class="hljs-title"></span><br><span class="hljs-title">Host:</span> scsi0<span class="hljs-title"> Channel:</span> 02<span class="hljs-title"> Id:</span> 00<span class="hljs-title"> Lun:</span> 00<span class="hljs-title"></span><br><span class="hljs-title">  Vendor:</span> DELL<span class="hljs-title">     Model:</span> PERC<span class="hljs-title"> H710</span> <span class="hljs-title">       Rev:</span> 3.13<span class="hljs-title"></span><br><span class="hljs-title">  Type:</span> <span class="hljs-title">  Direct-Access</span> <span class="hljs-title">                   ANSI</span> <span class="hljs-title"> SCSI</span> revision: 05<br></code></pre></td></tr></table></figure>


<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://medium.com/@dataplugshk/raid-level-comparison-raid-0-raid-1-raid-5-raid-6-and-raid-10-6d64210544a9">raid level</a></p>
]]></content>
  </entry>
  <entry>
    <title>Kubernetes NodePort vs LoadBalancer vs Ingress Intro</title>
    <url>/2021/12/13/Kubernetes-NodePort-vs-LoadBalancer-vs-Ingress-Intro/</url>
    <content><![CDATA[<h1 id="NodePort-vs-LoadBalancer-vs-Ingress"><a href="#NodePort-vs-LoadBalancer-vs-Ingress" class="headerlink" title="NodePort vs LoadBalancer vs Ingress"></a>NodePort vs LoadBalancer vs Ingress</h1><span id="more"></span>

<h2 id="ClusterIP"><a href="#ClusterIP" class="headerlink" title="ClusterIP"></a>ClusterIP</h2><blockquote>
<p>A ClusterIP service is the default Kubernetes service. It gives you a service inside your cluster that other apps inside your cluster can access. There is no external access.</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">my-internal-service</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">my-app</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span><br>  <span class="hljs-attr">ports:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">http</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">80</span><br>    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">80</span><br>    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br></code></pre></td></tr></table></figure>
<p><img src="/misc/images/k8s_clusterip.png" alt="Kubernetes ClusterIP"></p>
<h2 id="NodePort"><a href="#NodePort" class="headerlink" title="NodePort"></a>NodePort</h2><blockquote>
<p>NodePort, opens a specific port on all the Nodes, and any traffic that is sent to this port is forwarded to the service.</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">my-nodeport-service</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">my-app</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span><br>  <span class="hljs-attr">ports:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">http</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">80</span><br>    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">80</span><br>    <span class="hljs-attr">nodePort:</span> <span class="hljs-number">30036</span><br>    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br></code></pre></td></tr></table></figure>

<p><img src="/misc/images/k8s_nodeport.png" alt="Kubernetes NodePort"></p>
<figure class="highlight vhdl"><table><tr><td class="code"><pre><code class="hljs vhdl"><span class="hljs-number">1</span>. You can only have one service per <span class="hljs-keyword">port</span><br><span class="hljs-number">2</span>. You can only <span class="hljs-keyword">use</span> ports <span class="hljs-number">30000</span>-<span class="hljs-number">32767</span><br><span class="hljs-number">3</span>. You need <span class="hljs-keyword">to</span> track which node have pods <span class="hljs-keyword">with</span> exposed ports<br><br>Don<span class="hljs-symbol">&#x27;t</span> recommand using this method <span class="hljs-keyword">in</span> production <span class="hljs-keyword">to</span> directly expose your service.<br></code></pre></td></tr></table></figure>

<h2 id="LoadBalancer"><a href="#LoadBalancer" class="headerlink" title="LoadBalancer"></a>LoadBalancer</h2><blockquote>
<p>A LoadBalancer service is the standard way to expose a service to the interne.</p>
</blockquote>
<p><img src="/misc/images/k8s_loadbalancer.png" alt="Kubernetes LoadBalancer"></p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql">Traffic <span class="hljs-keyword">on</span> the port you specify will be forwarded <span class="hljs-keyword">to</span> the service. There <span class="hljs-keyword">is</span> <span class="hljs-keyword">no</span> filtering, <span class="hljs-keyword">no</span> routing, etc. This means you can send almost <span class="hljs-keyword">any</span> kind <span class="hljs-keyword">of</span> traffic <span class="hljs-keyword">to</span> it. <span class="hljs-keyword">like</span> HTTP, TCP, UDP, Websockets, gRPC, <span class="hljs-keyword">or</span> whatever.<br></code></pre></td></tr></table></figure>

<h2 id="Ingress-L7-HTTP-Load-Balancer"><a href="#Ingress-L7-HTTP-Load-Balancer" class="headerlink" title="Ingress - L7 HTTP Load Balancer"></a>Ingress - L7 HTTP Load Balancer</h2><blockquote>
<p>Ingress is not a type of service, Instead, it sits in front of multiple services and act as a â€œsmart routerâ€ or entrypoint into your cluster.</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">extensions/v1beta1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Ingress</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">my-ingress</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">backend:</span><br>    <span class="hljs-attr">serviceName:</span> <span class="hljs-string">other</span><br>    <span class="hljs-attr">servicePort:</span> <span class="hljs-number">8080</span><br>  <span class="hljs-attr">rules:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">host:</span> <span class="hljs-string">foo.mydomain.com</span><br>    <span class="hljs-attr">http:</span><br>      <span class="hljs-attr">paths:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">backend:</span><br>        <span class="hljs-attr">serviceName:</span> <span class="hljs-string">foo</span><br>        <span class="hljs-attr">servicePort:</span> <span class="hljs-number">8080</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">host:</span> <span class="hljs-string">mydomain.com</span><br>    <span class="hljs-attr">http:</span><br>      <span class="hljs-attr">paths:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">path:</span> <span class="hljs-string">/bar/*</span><br>        <span class="hljs-attr">backend:</span><br>          <span class="hljs-attr">seviceName:</span> <span class="hljs-string">bar</span><br>          <span class="hljs-attr">servicePort:</span> <span class="hljs-number">8080</span><br></code></pre></td></tr></table></figure>

<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><code class="hljs livecodeserver">Ingress is <span class="hljs-keyword">the</span> most useful <span class="hljs-keyword">if</span> you want <span class="hljs-built_in">to</span> expose multiple services under <span class="hljs-keyword">the</span> same IP address, <span class="hljs-keyword">and</span> these servcies all use same L7 protocol<br><br>Under <span class="hljs-keyword">the</span> hood, Ingress will use <span class="hljs-keyword">a</span> NodePort <span class="hljs-keyword">or</span> LoadBalancer service <span class="hljs-built_in">to</span> expose itself <span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> world so <span class="hljs-keyword">it</span> can act <span class="hljs-keyword">as</span> that proxy.<br></code></pre></td></tr></table></figure>

<h2 id="Cheat-Sheet"><a href="#Cheat-Sheet" class="headerlink" title="Cheat Sheet"></a>Cheat Sheet</h2><table>
<thead>
<tr>
<th align="left"></th>
<th align="left">NodePort</th>
<th align="left">LoadBalancer</th>
<th align="left">Ingress</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Supported by core Kubernetes</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">Works on every platform Kubernetes will deploy</td>
<td align="left">Yes</td>
<td align="left">Only supports a few public clouds. MetalLB project allows use on-premises.</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">Direct access to service</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
<td align="left">No</td>
</tr>
<tr>
<td align="left">Proxies each service through third party(NGINX, HAProxy)</td>
<td align="left">No</td>
<td align="left">No</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">Multiple ports per service</td>
<td align="left">No</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">Multiple services per IP</td>
<td align="left">Yes</td>
<td align="left">No</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">Allows use of standard service ports (80,443,etc)</td>
<td align="left">No</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">Have to track individual node IPs</td>
<td align="left">Yes</td>
<td align="left">No</td>
<td align="left">Yes, When using NodePort; No, when using LoadBalancer</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Cloud Native</category>
      </categories>
  </entry>
  <entry>
    <title>Kubernetes Volumes Intro</title>
    <url>/2021/12/16/Kubernetes-Volumes-Intro/</url>
    <content><![CDATA[<h1 id="Volumes-in-Kubernetes"><a href="#Volumes-in-Kubernetes" class="headerlink" title="Volumes in Kubernetes"></a>Volumes in Kubernetes</h1><span id="more"></span>

<h2 id="Types-of-Kubernetes-Volumes"><a href="#Types-of-Kubernetes-Volumes" class="headerlink" title="Types of Kubernetes Volumes"></a>Types of Kubernetes Volumes</h2><ul>
<li>emptyDir:</li>
</ul>
<figure class="highlight applescript"><table><tr><td class="code"><pre><code class="hljs applescript">It <span class="hljs-keyword">is</span> a type <span class="hljs-keyword">of</span> volume <span class="hljs-keyword">is</span> created when a Pod <span class="hljs-keyword">is</span> <span class="hljs-keyword">first</span> assigned <span class="hljs-keyword">to</span> a Node. It remains active <span class="hljs-keyword">as</span> long <span class="hljs-keyword">as</span> <span class="hljs-keyword">the</span> Pod <span class="hljs-keyword">is</span> <span class="hljs-built_in">running</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">that</span> node. The volume <span class="hljs-keyword">is</span> initially empty <span class="hljs-keyword">and</span> <span class="hljs-keyword">the</span> containers <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> pod can <span class="hljs-built_in">read</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">write</span> <span class="hljs-keyword">the</span> files <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> emptyDir volume. Once <span class="hljs-keyword">the</span> Pod <span class="hljs-keyword">is</span> removed <span class="hljs-keyword">from</span> <span class="hljs-keyword">the</span> node, <span class="hljs-keyword">the</span> data <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> emptyDir <span class="hljs-keyword">is</span> erased.<br></code></pre></td></tr></table></figure>

<ul>
<li>hostPath:</li>
</ul>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><code class="hljs livecodeserver">This type <span class="hljs-keyword">of</span> volume mounts <span class="hljs-keyword">a</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">directory</span> <span class="hljs-built_in">from</span> <span class="hljs-keyword">the</span> host node<span class="hljs-string">&#x27;s filesystem into your pod.</span><br></code></pre></td></tr></table></figure>

<ul>
<li>gcePersistentDisk</li>
</ul>
<figure class="highlight haskell"><table><tr><td class="code"><pre><code class="hljs haskell"><span class="hljs-type">This</span> <span class="hljs-class"><span class="hljs-keyword">type</span> of volume mounts a <span class="hljs-type">Google</span> <span class="hljs-type">Compute</span> <span class="hljs-type">Engine</span> (<span class="hljs-type">GCE</span>) <span class="hljs-type">Persistent</span> <span class="hljs-type">Disk</span> into your <span class="hljs-type">Pod</span>. <span class="hljs-type">The</span> <span class="hljs-keyword">data</span> in gcePersistentDisk remains intact when the <span class="hljs-type">Pod</span> is removed from the node.</span><br></code></pre></td></tr></table></figure>

<ul>
<li>awsElasticBlockStore</li>
</ul>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><code class="hljs livecodeserver">This type <span class="hljs-keyword">of</span> volume mounts <span class="hljs-keyword">an</span> Amazon Web Services (AWS) Elastic Block Store <span class="hljs-keyword">into</span> your Pod. Just like gcePersistentDisk, <span class="hljs-keyword">the</span> data <span class="hljs-keyword">in</span> <span class="hljs-keyword">an</span> awsElasticBlockStore remains intact when <span class="hljs-keyword">the</span> Pod is removed <span class="hljs-built_in">from</span> <span class="hljs-keyword">the</span> node.<br></code></pre></td></tr></table></figure>

<ul>
<li>nfs</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><code class="hljs pgsql">An nfs volume allows an existing NFS (Network File <span class="hljs-keyword">System</span>) <span class="hljs-keyword">to</span> be mounted <span class="hljs-keyword">into</span> your Pod. the data <span class="hljs-keyword">in</span> an nfs volume <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> erased <span class="hljs-keyword">when</span> the Pod <span class="hljs-keyword">is</span> removed <span class="hljs-keyword">from</span> the node. The volume <span class="hljs-keyword">is</span> <span class="hljs-keyword">only</span> unmounted<br></code></pre></td></tr></table></figure>

<ul>
<li>gitRepo</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Cloud Native</category>
      </categories>
  </entry>
  <entry>
    <title>Virsh Commands CheatSheet Intro</title>
    <url>/2021/12/28/Virsh-Commands-CheatSheet-Intro/</url>
    <content><![CDATA[<h1 id="Virsh-Commands-CheatSheet"><a href="#Virsh-Commands-CheatSheet" class="headerlink" title="Virsh Commands CheatSheet"></a>Virsh Commands CheatSheet</h1><blockquote>
<p>Virsh interacts with Libviry which is a library aimed at providing a long-term stable C API. It currently supports Xen, QEMU, KVM, LXC, OpenVZ, VirtualBox and VMware ESX.</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml">$ virsh [OPTION]â€¦ <span class="hljs-tag">&lt;<span class="hljs-name">command</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">domain</span>&gt;</span> [ARG]â€¦<br></code></pre></td></tr></table></figure>

<span id="more"></span>

<ul>
<li><ol>
<li>Virsh displat node information<figure class="highlight stylus"><table><tr><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[blocface@centos ~]</span>$ sudo virsh nodeinfo<br>setlocale: No such file or directory<br>CPU model:           x86_64<br><span class="hljs-function"><span class="hljs-title">CPU</span><span class="hljs-params">(s)</span></span>:              <span class="hljs-number">48</span><br>CPU frequency:       <span class="hljs-number">1883</span> MHz<br>CPU socket(s):       <span class="hljs-number">1</span><br><span class="hljs-function"><span class="hljs-title">Core</span><span class="hljs-params">(s)</span></span> per socket:  <span class="hljs-number">12</span><br><span class="hljs-function"><span class="hljs-title">Thread</span><span class="hljs-params">(s)</span></span> per core:  <span class="hljs-number">2</span><br>NUMA cell(s):        <span class="hljs-number">2</span><br>Memory size:         <span class="hljs-number">131608380</span> KiB<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><ol start="2">
<li>Virsh list all domains<figure class="highlight asciidoc"><table><tr><td class="code"><pre><code class="hljs asciidoc">[blocface@centos ~]$ sudo virsh list --all<br>setlocale: No such file or directory<br><span class="hljs-section"> Id    Name                           State</span><br><span class="hljs-section">----------------------------------------------------</span><br><span class="hljs-code"> 4     node4                          running</span><br><span class="hljs-code"> 14    node1                          running</span><br><span class="hljs-code"> 15    node5                          running</span><br><span class="hljs-code"> 17    node3                          running</span><br><span class="hljs-code"> 18    node2                          running</span><br><span class="hljs-code"> -     centos                         shut off</span><br><span class="hljs-code"> -     template                       shut off</span><br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><ol start="3">
<li>Virsh rename domain<figure class="highlight"><table><tr><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h2 id="å‚è€ƒæ‰‹å†Œ"><a href="#å‚è€ƒæ‰‹å†Œ" class="headerlink" title="å‚è€ƒæ‰‹å†Œ"></a>å‚è€ƒæ‰‹å†Œ</h2><ul>
<li><a href="https://computingforgeeks.com/virsh-commands-cheatsheet/">Virsh Commands</a></li>
</ul>
]]></content>
      <categories>
        <category>CLI</category>
      </categories>
  </entry>
  <entry>
    <title>Service Mesh And API Gateway</title>
    <url>/2022/01/05/Service-Mesh-And-API-Gateway/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>å—åŒ—&amp;ä¸œè¥¿æµé‡</title>
    <url>/2022/01/05/%E5%8D%97%E5%8C%97-%E4%B8%9C%E8%A5%BF%E6%B5%81%E9%87%8F/</url>
    <content><![CDATA[<h1 id="å—åŒ—æµé‡-amp-ä¸œè¥¿æµé‡"><a href="#å—åŒ—æµé‡-amp-ä¸œè¥¿æµé‡" class="headerlink" title="å—åŒ—æµé‡ &amp; ä¸œè¥¿æµé‡"></a>å—åŒ—æµé‡ &amp; ä¸œè¥¿æµé‡</h1><blockquote>
<p>å—åŒ—æµé‡å’Œä¸œè¥¿æµé‡æ˜¯æ•°æ®ä¸­å¿ƒç¯å¢ƒä¸­ç½‘ç»œæµé‡æ¨¡å¼.</p>
</blockquote>
<ul>
<li><ol>
<li>ä»€ä¹ˆæ˜¯å—åŒ—å‘æµé‡?</li>
</ol>
</li>
<li><ol start="2">
<li>ä»€ä¹ˆæ˜¯ä¸œè¥¿å‘æµé‡?</li>
</ol>
</li>
<li><ol start="3">
<li>ä»€ä¹ˆæ˜¯åŠ¨æ€æµé‡?</li>
</ol>
</li>
</ul>
<blockquote>
<p>å½“æˆ‘ä»¬è®¿é—®webåº”ç”¨æ—¶ï¼Œä¼šå‘ç”Ÿä¸€ä¸‹ç±»å‹çš„ç½‘ç»œæµé‡:</p>
<blockquote>
<p>1.å®¢æˆ·ç«¯(ä½äºæ•°æ®ä¸­å¿ƒä¸€ä¾§çš„æµè§ˆå™¨)ä¸è´Ÿè½½å‡è¡¡å™¨(ä½äºæ•°æ®ä¸­å¿ƒ)ä¹‹é—´çš„ç½‘ç»œæµé‡.<br>2.è´Ÿè½½å‡è¡¡å™¨ã€åº”ç”¨æœåŠ¡å™¨ã€æ•°æ®åº“ç­‰ä¹‹é—´çš„ç½‘ç»œæµé‡ï¼Œä»–ä»¬éƒ½ä½äºæ•°æ®ä¸­å¿ƒ.</p>
</blockquote>
</blockquote>
<p><img src="/misc/images/north-south-east-west-traffic.png" alt="ç½‘ç»œæµé‡"></p>
<span id="more"></span>

<h2 id="Traffic-Trends-In-Data-Center"><a href="#Traffic-Trends-In-Data-Center" class="headerlink" title="Traffic Trends In Data Center"></a>Traffic Trends In Data Center</h2><p><img src="/misc/images/traffic-trends-in-data-center.png" alt="Traffic Trends In Data Center"></p>
<h2 id="å—åŒ—æµé‡-North-South-traffic"><a href="#å—åŒ—æµé‡-North-South-traffic" class="headerlink" title="å—åŒ—æµé‡(North-South traffic)"></a>å—åŒ—æµé‡(North-South traffic)</h2><blockquote>
<p>å—åŒ—æµé‡æ˜¯server-clientæµé‡</p>
</blockquote>
<h2 id="ä¸œè¥¿æµé‡-East-West-traffic"><a href="#ä¸œè¥¿æµé‡-East-West-traffic" class="headerlink" title="ä¸œè¥¿æµé‡(East-West traffic)"></a>ä¸œè¥¿æµé‡(East-West traffic)</h2><blockquote>
<p>ä¸åŒæœåŠ¡å™¨ä¹‹é—´çš„æµé‡ä¸æ•°æ®ä¸­å¿ƒæˆ–ä¸åŒæ•°æ®ä¸­å¿ƒä¹‹é—´çš„ç½‘ç»œæµè¢«ç§°ä¸ºä¸œè¥¿æµé‡, ä¸œè¥¿æµé‡æ˜¯server-serveræµé‡.<br>server-serveræµé‡è¿œå¤§äºserver-clientæµé‡<br>ä¸œè¥¿æµé‡ã€å—åŒ—æµé‡è¿™æ ·å‘½åæ¥è‡ªäºç»˜åˆ¶å…¸å‹network diagramsçš„ä¹ æƒ¯ï¼Œåœ¨å›¾è¡¨ä¸­ï¼Œé€šå¸¸æ ¸å¿ƒç½‘ç»œç»„ä»¶ç»˜åˆ¶åœ¨åº•éƒ¨éƒ¨(South),å®¢æˆ·ç«¯ä¼šåœ¨é¡¶éƒ¨(North). è€Œæ•°æ®ä¸­å¿ƒå†…çš„ä¸åŒæœåŠ¡å™¨æ°´å¹³ä¹‹é—´(East-West)ç»˜åˆ¶.</p>
</blockquote>
]]></content>
  </entry>
</search>
