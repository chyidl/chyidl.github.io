<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Docker Tips &amp; Tricks</title>
    <url>/2021/09/01/docker/</url>
    <content><![CDATA[<h2 id="Docker-Info"><a href="#Docker-Info" class="headerlink" title="Docker  Info"></a>Docker  Info</h2><figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line">å®¹å™¨æŠ€æœ¯çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå°±æ˜¯é€šè¿‡çº¦æŸå’Œä¿®æ”¹è¿›ç¨‹çš„åŠ¨æ€è¡¨ç°ï¼Œä»è€Œä¸ºå…¶åˆ›é€ å‡ºä¸€ä¸ªâ€œè¾¹ç•Œâ€</span><br><span class="line"></span><br><span class="line">CgroupsæŠ€æœ¯æ˜¯ç”¨æ¥åˆ¶é€ çº¦æŸçš„ä¸»è¦æ‰‹æ®µ</span><br><span class="line"><span class="keyword">Namespace</span>æŠ€æœ¯åˆ™æ˜¯ç”¨æ¥ä¿®æ”¹è¿›ç¨‹è¯•å›¾çš„ä¸»è¦æ–¹æ³•</span><br></pre></td></tr></table></figure>
<span id="more"></span>

<h2 id="Docker-architecture"><a href="#Docker-architecture" class="headerlink" title="Docker architecture"></a>Docker architecture</h2><blockquote>
<p>Docker uses a client-server architecture.</p>
</blockquote>
<p><img src="/misc/images/architecture.svg" alt="docker architecture"></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Docker ä»“åº“æ“ä½œ</span></span><br><span class="line">  docker pull/push</span><br><span class="line"></span><br><span class="line"><span class="comment"># Docker é•œåƒç®¡ç†</span></span><br><span class="line">  docker images/rmi/build</span><br><span class="line"></span><br><span class="line"><span class="comment"># Docker ç”Ÿå‘½å‘¨æœŸç®¡ç†</span></span><br><span class="line">  docker run/<span class="built_in">start</span>/stop/<span class="built_in">rm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># to delete all containers including its volumes use,</span></span><br><span class="line"><span class="variable">$</span> docker <span class="built_in">rm</span> <span class="literal">-vf</span> <span class="variable">$</span>(docker <span class="built_in">ps</span> <span class="literal">-a</span> <span class="literal">-q</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># to delete all the images</span></span><br><span class="line"><span class="variable">$</span> docker rmi <span class="operator">-f</span> <span class="variable">$</span>(docker images <span class="literal">-a</span> <span class="literal">-q</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Docker-Tips"><a href="#Docker-Tips" class="headerlink" title="Docker Tips"></a>Docker Tips</h2><ul>
<li><p><strong>Docker Tip #1</strong>: Docker å®¹å™¨è¿›ç¨‹</p>
<blockquote>
<p>A Docker container is just a process/service that runs directly on your machine. It is slightly different than a regular process because the Docker daemon along with the linux kernel do a few things(<strong>Cgroups</strong>ã€<strong>Namespace</strong>) to ensure it runs in total isolation<br>Dockerå®¹å™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿›ç¨‹,å’Œè™šæ‹Ÿæœºå·®åˆ«å¾ˆå¤§</p>
</blockquote>
</li>
<li><p><strong>Docker Tip #2</strong>: COPY vs. ADD in a Dockerfile</p>
<blockquote>
<p>COPY å’Œ ADD åŠŸèƒ½å¾ˆç›¸ä¼¼ï¼Œéƒ½å¯ä»¥ä»æŒ‡å®šç›®å½•æ‹·è´æ•°æ®åˆ°Dockeré•œåƒä¸­.</p>
</blockquote>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line"># <span class="keyword">COPY</span> å’Œ <span class="keyword">ADD</span> åŒºåˆ«</span><br><span class="line"><span class="number">1</span>. <span class="keyword">COPY</span>: åªèƒ½ä»æœ¬æœºæ–‡ä»¶æˆ–ç›®å½•ä¸­æ‹·è´åˆ°é•œåƒä¸­</span><br><span class="line"><span class="number">2</span>. <span class="keyword">ADD</span>: ä¸ä»…å¯ä»¥ä»æœ¬æœºæ–‡ä»¶æˆ–ç›®å½•ä¸­æ‹·è´ï¼Œè¿˜å¯ä»¥ä½¿ç”¨URLå¼•å…¥å¤–éƒ¨çš„æ–‡ä»¶åœ°å€æ‹·è´åˆ°é•œåƒä¸­</span><br><span class="line">  $ <span class="keyword">ADD</span> rootfs.tar.gz /</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #3</strong>: è¿½åŠ  Docker Run æŒ‡ä»¤å‡å°‘é•œåƒå¤§å°</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Before Dockerfile -- æ–°å¢ä¸‰ä¸ªå±‚lager</span></span><br><span class="line">RUN wget -O myfile.tar.gz http:<span class="regexp">//</span>example.com/myfile.tar.gz</span><br><span class="line">RUN tar -xvf myfile.tar.gz -C <span class="regexp">/usr/</span>src/myapp</span><br><span class="line">RUN rm myfile.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># After Dockerfile -- æ–°å¢ä¸€ä¸ªå±‚layer</span></span><br><span class="line">RUN wget -O myfile.tar.gz http:<span class="regexp">//</span>example.com/myfile.tar.gz \</span><br><span class="line">  &amp;&amp; tar -xvf myfile.tar.gz -C <span class="regexp">/usr/</span>src/myapp \</span><br><span class="line">  &amp;&amp; rm myfile.tar.gz</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #4</strong>: Docker Baseé•œåƒOSå’ŒHost OSæ²¡æœ‰å…³ç³»</p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line">Docker <span class="built_in">Image</span> OS: å®šä¹‰åœ¨Dockerfileæ–‡ä»¶çš„Baseé•œåƒçš„ç³»ç»Ÿ</span><br><span class="line">Host OS: è¿è¡ŒDocker <span class="built_in">image</span>çš„ç¯å¢ƒ</span><br><span class="line">You can use whatever base <span class="built_in">image</span> you want <span class="keyword">for</span> your Docker images.</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #5</strong>: ä½¿ç”¨ç›¸åŒBaseé•œåƒçš„å¥½å¤„</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">You could use a different base OS <span class="keyword">for</span> <span class="keyword">each</span> Docker image, but <span class="keyword">then</span> you lose <span class="keyword">out</span> <span class="keyword">on</span> the ability <span class="keyword">to</span> <span class="keyword">cache</span> it across all of your images</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #6</strong>: RUN vs. CMD in a Dockerfile</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">RUN:</span> åœ¨é•œåƒå†…æ‰§è¡Œå‘½ä»¤ï¼Œè¿™äº›æŒ‡ä»¤ä»…ä»…åœ¨æ„å»ºbuildé•œåƒä¸­æ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”å°†æ„å»ºç»“æœå†™å…¥æ–°largerå±‚ä¸­.</span><br><span class="line"><span class="symbol">CMD:</span> åœ¨å¯åŠ¨å®¹å™¨æ—¶å®šä¹‰é»˜è®¤çš„è¿è¡Œçš„æŒ‡ä»¤, è¿™ç§åŠ¨ä½œå‘ç”Ÿè¿è¡Œæ—¶run-time, è¦†ç›–æ–¹å¼</span><br><span class="line"><span class="symbol">ENTRYPOINT:</span> æ‰§è¡Œå‘½ä»¤å‚æ•°è¿½åŠ æ–¹å¼</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #7</strong>: Base Docker Image Alpine</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">Why Alpine?</span><br><span class="line">&gt; Small. Simple. Secure. Alpine Linux is a security-<span class="keyword">oriented, </span>lightweight Linux <span class="keyword">distribution </span><span class="keyword">based </span>on musl libc <span class="keyword">and </span><span class="keyword">busybox.</span></span><br><span class="line"><span class="keyword"></span>&gt; Alpine is about <span class="number">30</span>x smaller than Debian.</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #8</strong>: Project Structure with Multiple Dockerfiles and Docker Compose</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">ubuntu in ~/chyi/micro-services at <span class="number">3</span>BPlus <span class="keyword">on</span> ğŸ³ v20.<span class="number">10.8</span></span><br><span class="line">âœ tree -L <span class="number">2</span></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ auth</span><br><span class="line">â”‚Â Â  â””â”€â”€ Dockerfile</span><br><span class="line">â”œâ”€â”€ billing</span><br><span class="line">â”‚Â Â  â””â”€â”€ Dockerfile</span><br><span class="line">â”œâ”€â”€ contact</span><br><span class="line">â”‚Â Â  â””â”€â”€ Dockerfile</span><br><span class="line">â”œâ”€â”€ docker-compose.yml</span><br><span class="line">â””â”€â”€ user</span><br><span class="line">    â””â”€â”€ Dockerfile</span><br><span class="line"></span><br><span class="line"><span class="number">4</span> directories, <span class="number">5</span> <span class="keyword">files</span></span><br><span class="line"></span><br><span class="line">The docker-compose.yaml</span><br><span class="line">ubuntu in ~/chyi/micro-services at <span class="number">3</span>BPlus <span class="keyword">on</span> ğŸ³ v20.<span class="number">10.8</span></span><br><span class="line">âœ <span class="keyword">cat</span> docker-compose.yml</span><br><span class="line"><span class="keyword">version</span>: <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line">service<span class="variable">s:</span></span><br><span class="line">    auth:</span><br><span class="line">        build: <span class="string">&#x27;./auth&#x27;</span></span><br><span class="line">    billin<span class="variable">g:</span></span><br><span class="line">        build: <span class="string">&#x27;./billing&#x27;</span></span><br><span class="line">    contac<span class="variable">t:</span></span><br><span class="line">        build: <span class="string">&#x27;./contact&#x27;</span></span><br><span class="line">    user:</span><br><span class="line">        build: <span class="string">&#x27;./user&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #9</strong>: ä½¿ç”¨Volumes</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># docker-compose.yaml</span></span><br><span class="line"><span class="attr">services</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">app</span>:<span class="string"></span></span><br><span class="line"><span class="comment">    # Mount the crrent directoy into `/app` inside the running container.</span></span><br><span class="line">    <span class="attr">volumes</span>:<span class="string"></span></span><br><span class="line">      <span class="meta">-</span> <span class="string">&#x27;.:/app&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #10</strong>: Published Ports</p>
<blockquote>
<p>Creates a firwaall rule which maps a container port to a port on the Docker host to the outside world.</p>
</blockquote>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">Flag value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-p 8080:80</td>
<td align="left">Map TCP port 80 in the container to port 8080 on the Docker host.</td>
</tr>
<tr>
<td align="left">-p 192.168.1.100:8080:80</td>
<td align="left">Map TCP port 80 in the container to port 8080 on the Docker host for connections to host IP 192.168.1.100.</td>
</tr>
<tr>
<td align="left">-p 8080:80/udp</td>
<td align="left">Map UDP port 80 in the container to port 8080 on the Docker host.</td>
</tr>
<tr>
<td align="left">-p 8080:80/tcp -p 8080:80/udp</td>
<td align="left">Map TCP port 80 in the container to TCP port 8080 on the Docker host, and map UDP port 80 in the container to UDP port 8080 on the Docker host.</td>
</tr>
</tbody></table>
<ul>
<li><p><strong>Docker Tip #11</strong>: dockerignore file</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">.dockerignore</span>: ignore certain files and folders from your Docker images</span><br><span class="line">  <span class="string">.git</span></span><br><span class="line">  <span class="string">.dockerignore</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #12</strong>: Manage Docker without sudo on Linux</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Add a docker group and then add your user to it:</span></span><br><span class="line"><span class="variable">$ </span>sudo groupadd docker</span><br><span class="line"><span class="variable">$ </span>docker usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #13</strong>: Measure Docker Containerâ€™s Resources</p>
<blockquote>
<p>How much resources containers are using</p>
</blockquote>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line">$ docker stats</span><br><span class="line">CONTAINER ID   NAME                                                                                         <span class="meta">CPU</span> %     MEM USAGE / LIMIT     MEM %     NET I/O     BLOCK I/O         PIDS</span><br><span class="line">298d90f942e1   k8s_POD_kafka-zookeeper-0_default_a243d677-<span class="number">101b</span>-493b-a076-d94f46785f22_0                     <span class="number">0.00</span>%     724KiB / <span class="number">3.</span>704GiB     <span class="number">0.02</span>%     <span class="number">0B</span> / <span class="number">0B</span>     <span class="number">0B</span> / <span class="number">0B</span>           <span class="number">1</span></span><br><span class="line">1d92a13e4a6f   k8s_POD_kafka-0_default_f7374645-<span class="number">9904</span>-436c-bc8d-43ed415833c1_0                               <span class="number">0.00</span>%     872KiB / <span class="number">3.</span>704GiB     <span class="number">0.02</span>%     <span class="number">0B</span> / <span class="number">0B</span>     <span class="number">0B</span> / <span class="number">0B</span>           <span class="number">1</span></span><br><span class="line">b638c1bbd855   k8s_POD_postgres-postgresql-0_infrastructure_d9067ee1-<span class="number">6874</span>-<span class="number">4018</span>-a008-09362ad9330d_16         <span class="number">0.00</span>%     868KiB / <span class="number">3.</span>704GiB     <span class="number">0.02</span>%     <span class="number">0B</span> / <span class="number">0B</span>     <span class="number">0B</span> / <span class="number">0B</span>           <span class="number">1</span></span><br><span class="line">0fdc76799b4e   k8s_kube-flannel_kube-flannel-<span class="built_in">ds</span>-nk6tj_kube-system_0a186e7a-c0d7-<span class="number">4282</span>-9f5d-65ee20d0e13a_12   <span class="number">0.07</span>%     <span class="number">15.</span>4MiB / 50MiB       <span class="number">30.80</span>%    <span class="number">0B</span> / <span class="number">0B</span>     <span class="number">33.</span>1MB / <span class="number">0B</span>       <span class="number">11</span></span><br><span class="line">4c3705247efa   k8s_kube-proxy_kube-proxy-xwfvl_kube-system_f46216cb-d018-4d82-b510-9be5e01cefca_12          <span class="number">0.00</span>%     <span class="number">23.</span>36MiB / <span class="number">3.</span>704GiB   <span class="number">0.62</span>%     <span class="number">0B</span> / <span class="number">0B</span>     <span class="number">43.</span>7MB / <span class="number">12.</span>3kB   <span class="number">8</span></span><br><span class="line">16d5db1e7447   k8s_POD_kube-proxy-xwfvl_kube-system_f46216cb-d018-4d82-b510-9be5e01cefca_13                 <span class="number">0.00</span>%     <span class="number">1.</span>996MiB / <span class="number">3.</span>704GiB   <span class="number">0.05</span>%     <span class="number">0B</span> / <span class="number">0B</span>     487kB / <span class="number">0B</span>        <span class="number">1</span></span><br><span class="line">496aacf5fddf   k8s_POD_kube-flannel-<span class="built_in">ds</span>-nk6tj_kube-system_0a186e7a-c0d7-<span class="number">4282</span>-9f5d-65ee20d0e13a_13            <span class="number">0.00</span>%     768KiB / <span class="number">3.</span>704GiB     <span class="number">0.02</span>%     <span class="number">0B</span> / <span class="number">0B</span>     <span class="number">0B</span> / <span class="number">0B</span>           <span class="number">1</span></span><br><span class="line">1e328afeb116   dapr_zipkin                                                                                  <span class="number">0.17</span>%     <span class="number">250.</span>2MiB / <span class="number">3.</span>704GiB   <span class="number">6.60</span>%     18MB / <span class="number">0B</span>   60MB / <span class="number">0B</span>         <span class="number">55</span></span><br><span class="line">27872f88cae3   dapr_placement                                                                               <span class="number">0.11</span>%     <span class="number">5.</span>992MiB / <span class="number">3.</span>704GiB   <span class="number">0.16</span>%     18MB / <span class="number">0B</span>   <span class="number">13.</span>6MB / <span class="number">0B</span>       <span class="number">10</span></span><br><span class="line">27c1f6daa81c   dapr_redis                                                                                   <span class="number">0.35</span>%     <span class="number">5.</span>633MiB / <span class="number">3.</span>704GiB   <span class="number">0.15</span>%     18MB / <span class="number">0B</span>   <span class="number">10.</span>7MB / <span class="number">0B</span>       <span class="number">5</span></span><br><span class="line"></span><br><span class="line">$ docker stats --format <span class="string">&quot;table &#123;&#123;.Container&#125;&#125;\t&#123;&#123;.CPUPerc&#125;&#125;\t&#123;&#123;.MemUsage&#125;&#125;&quot;</span></span><br><span class="line">CONTAINER      <span class="meta">CPU</span> %     MEM USAGE / LIMIT</span><br><span class="line">298d90f942e1   <span class="number">0.00</span>%     724KiB / <span class="number">3.</span>704GiB</span><br><span class="line">1d92a13e4a6f   <span class="number">0.00</span>%     872KiB / <span class="number">3.</span>704GiB</span><br><span class="line">b638c1bbd855   <span class="number">0.00</span>%     868KiB / <span class="number">3.</span>704GiB</span><br><span class="line">0fdc76799b4e   <span class="number">2.37</span>%     <span class="number">15.</span>42MiB / 50MiB</span><br><span class="line">4c3705247efa   <span class="number">0.00</span>%     <span class="number">23.</span>36MiB / <span class="number">3.</span>704GiB</span><br><span class="line">16d5db1e7447   <span class="number">0.00</span>%     <span class="number">1.</span>996MiB / <span class="number">3.</span>704GiB</span><br><span class="line">496aacf5fddf   <span class="number">0.00</span>%     768KiB / <span class="number">3.</span>704GiB</span><br><span class="line">1e328afeb116   <span class="number">0.21</span>%     <span class="number">250.</span>2MiB / <span class="number">3.</span>704GiB</span><br><span class="line">27872f88cae3   <span class="number">0.12</span>%     <span class="number">5.</span>992MiB / <span class="number">3.</span>704GiB</span><br><span class="line">27c1f6daa81c   <span class="number">0.34</span>%     <span class="number">5.</span>633MiB / <span class="number">3.</span>704GiB</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #14</strong>: Docker Compose vs Docker Stack</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Docker Compose: is an official tool that helps you manage your Docker containers by letting you define everything through a docker-compose.yml file.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># docker stack: is a command that&#x27;s embedded into the Docker CLI. Lets you manage a cluster of Docker containers through Docker Swarm.</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #15</strong>: Metadata Docker Images with Labels</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Dockerfile example of adding 2 labels with 1 LABEL instruction:</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> &lt;key&gt;=&lt;value&gt;</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> version=<span class="string">&quot;1.0&quot;</span> maintainer=<span class="string">&quot;chyi &lt;nick.chyi@gmail.com&gt;&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Docker build example to add dynamic labels to your Docker images:</span></span><br><span class="line">$ docker build . --<span class="keyword">label</span><span class="bash"> <span class="string">&quot;version=1.0&quot;</span> --label <span class="string">&quot;maintaner=chyi &lt;nick.chyi@gmail.com&gt;&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># docker inspect images</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #16</strong>: Named Volumes vs Path Based Volumes</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Named volumes</span></span><br><span class="line">  postgres:<span class="regexp">/var/</span>lib<span class="regexp">/postgresql/</span>data</span><br><span class="line"></span><br><span class="line">  docker-compose automatically create the postgres volume, <span class="keyword">if</span> not you could running __$ docker volume create postgres__.</span><br><span class="line">  On Linux, the volume will get saved to <span class="regexp">/var/</span>lib<span class="regexp">/docker/</span>volumes<span class="regexp">/postgres/</span>_data</span><br><span class="line"></span><br><span class="line"><span class="comment"># Path based volumes</span></span><br><span class="line">  .<span class="regexp">/postgres:/</span>var<span class="regexp">/lib/</span>postgresql/data</span><br><span class="line"></span><br><span class="line">  postgres/ directory would get created <span class="keyword">in</span> the current directory on the Docker host.</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #17</strong>: The Volume or Mount Flag</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Setting up a volume the old way with docker run:</span></span><br><span class="line">$ docker container run â€¦ -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>:/myapp</span><br><span class="line"></span><br><span class="line"><span class="comment"># Setting up the same volumes using the mount flag with docker run:</span></span><br><span class="line">$ docker container run â€¦ --mount <span class="built_in">type</span>=<span class="built_in">bind</span>,<span class="built_in">source</span>=<span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>,target=/myapp</span><br><span class="line"></span><br><span class="line"><span class="comment"># Docker compose</span></span><br><span class="line">volumes:</span><br><span class="line">  - <span class="built_in">type</span>: <span class="string">&quot;bind&quot;</span></span><br><span class="line">    <span class="built_in">source</span>: <span class="string">&quot;.&quot;</span></span><br><span class="line">    target: <span class="string">&quot;/myapp&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #18</strong>: Connect to a Service Running on Docker Host</p>
<blockquote>
<p>Implementation of connecting to Docker host over a custom network with a static IP address.</p>
</blockquote>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Create a custom bridge Docker network</span></span><br><span class="line">ubuntu <span class="keyword">in</span> ~ at <span class="number">3</span>BPlus</span><br><span class="line">âœ docker network create -d bridge --subnet <span class="number">192.168</span>.<span class="number">0.0</span>/<span class="number">24</span> --gateway <span class="number">192.168</span>.<span class="number">0.1</span> mynet</span><br><span class="line"><span class="number">0330</span>b879fcc8fb23eeb092cb66fd86f1796e7f0abe37df4978903cf8fd07217b</span><br><span class="line"></span><br><span class="line">ubuntu <span class="keyword">in</span> ~ at <span class="number">3</span>BPlus</span><br><span class="line">âœ ifconfig</span><br><span class="line">br-<span class="number">0330</span>b879fcc8: flags=<span class="number">4099</span>&lt;UP,BROADCAST,MULTICAST&gt;  mtu <span class="number">1500</span></span><br><span class="line">        inet <span class="number">192.168</span>.<span class="number">0.1</span>  netmask <span class="number">255.255</span>.<span class="number">255.0</span>  broadcast <span class="number">192.168</span>.<span class="number">0.255</span></span><br><span class="line">        ether <span class="number">02</span>:<span class="number">42</span>:<span class="number">16</span>:<span class="number">0</span>c:c0:<span class="number">51</span>  txqueuelen <span class="number">0</span>  (Ethernet)</span><br><span class="line">        RX packets <span class="number">0</span>  bytes <span class="number">0</span> (<span class="number">0.0</span> B)</span><br><span class="line">        RX errors <span class="number">0</span>  dropped <span class="number">0</span>  overruns <span class="number">0</span>  frame <span class="number">0</span></span><br><span class="line">        TX packets <span class="number">0</span>  bytes <span class="number">0</span> (<span class="number">0.0</span> B)</span><br><span class="line">        TX errors <span class="number">0</span>  dropped <span class="number">0</span> overruns <span class="number">0</span>  carrier <span class="number">0</span>  collisions <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Start the Alpine container and drop into a Shell prompt.</span></span><br><span class="line">ubuntu <span class="keyword">in</span> ~ at <span class="number">3</span>BPlus</span><br><span class="line">âœ docker container run --rm -it alpine sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install the ping utility.</span></span><br><span class="line">/ <span class="comment"># apk update &amp;&amp; apk add iputils</span></span><br><span class="line">fetch https:<span class="regexp">//</span>dl-cdn.alpinelinux.org<span class="regexp">/alpine/</span>v3.<span class="number">14</span><span class="regexp">/main/</span>aarch64/APKINDEX.tar.gz</span><br><span class="line">fetch https:<span class="regexp">//</span>dl-cdn.alpinelinux.org<span class="regexp">/alpine/</span>v3.<span class="number">14</span><span class="regexp">/community/</span>aarch64/APKINDEX.tar.gz</span><br><span class="line">v3.<span class="number">14.2</span>-<span class="number">5</span>-gd4163d4c6c [https:<span class="regexp">//</span>dl-cdn.alpinelinux.org<span class="regexp">/alpine/</span>v3.<span class="number">14</span>/main]</span><br><span class="line">v3.<span class="number">14.2</span>-<span class="number">4</span>-ga15b4dc067 [https:<span class="regexp">//</span>dl-cdn.alpinelinux.org<span class="regexp">/alpine/</span>v3.<span class="number">14</span>/community]</span><br><span class="line">OK: <span class="number">14810</span> distinct packages available</span><br><span class="line">(<span class="number">1</span>/<span class="number">2</span>) Installing libcap (<span class="number">2.50</span>-r0)</span><br><span class="line">(<span class="number">2</span>/<span class="number">2</span>) Installing iputils (<span class="number">20210202</span>-r0)</span><br><span class="line">Executing busybox-<span class="number">1.33</span>.<span class="number">1</span>-r3.trigger</span><br><span class="line">OK: <span class="number">6</span> MiB <span class="keyword">in</span> <span class="number">16</span> packages</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ping the custom IP address we set up.</span></span><br><span class="line">/ <span class="comment"># ping 192.168.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># You should see this output (hit CTRL+C to stop it)</span></span><br><span class="line">PING <span class="number">192.168</span>.<span class="number">0.1</span> (<span class="number">192.168</span>.<span class="number">0.1</span>) <span class="number">56</span>(<span class="number">84</span>) bytes of data.</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">192.168</span>.<span class="number">0.1</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">0.336</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">192.168</span>.<span class="number">0.1</span>: icmp_seq=<span class="number">2</span> ttl=<span class="number">64</span> time=<span class="number">0.293</span> ms</span><br><span class="line">^C</span><br><span class="line">--- <span class="number">192.168</span>.<span class="number">0.1</span> ping statistics ---</span><br><span class="line"><span class="number">2</span> packets transmitted, <span class="number">2</span> received, <span class="number">0</span>% packet loss, time <span class="number">1013</span>ms</span><br><span class="line">rtt min<span class="regexp">/avg/m</span>ax<span class="regexp">/mdev = 0.293/</span><span class="number">0.314</span><span class="regexp">/0.336/</span><span class="number">0.021</span> ms</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #19</strong>: Show Total Disk Space Used by Docker</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">ubuntu in ~ at 3BPlus</span><br><span class="line">âœ docker system df</span><br><span class="line">TYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLE</span><br><span class="line">Images         <span class="number"> 3 </span>       <span class="number"> 2 </span>        203.9MB   198.5MB (97%)</span><br><span class="line">Containers     <span class="number"> 3 </span>       <span class="number"> 1 </span>        2.524MB   0B (0%)</span><br><span class="line">Local Volumes  <span class="number"> 1 </span>       <span class="number"> 0 </span>        0B        0B</span><br><span class="line">Build Cache    <span class="number"> 0 </span>       <span class="number"> 0 </span>        0B        0B</span><br><span class="line"></span><br><span class="line"><span class="comment"># -v flag (verbose) - will show the unique image size for each image</span></span><br><span class="line">ubuntu in ~ at 3BPlus</span><br><span class="line">âœ docker system df -v</span><br><span class="line">Images space usage:</span><br><span class="line"></span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED       SIZE      SHARED SIZE   UNIQUE SIZE   CONTAINERS</span><br><span class="line">alpine                latest    bb3de5531c18  <span class="number"> 4 </span>days ago    5.337MB   0B            5.337MB       2</span><br><span class="line">hello-world           latest    bc11b176a293  <span class="number"> 7 </span>weeks ago   9.136kB   0B            9.136kB       1</span><br><span class="line">bahamat/unix-1st-ed   latest    37aa142d2113  <span class="number"> 5 </span>years ago   198.5MB   0B            198.5MB       0</span><br><span class="line"></span><br><span class="line">Containers space usage:</span><br><span class="line"></span><br><span class="line">CONTAINER ID   IMAGE         COMMAND            LOCAL VOLUMES   SIZE      CREATED       STATUS                   NAMES</span><br><span class="line">9023720cdee7   alpine        &quot;sh&quot;              <span class="number"> 0 </span>              2.52MB   <span class="number"> 5 </span>hours ago   Up<span class="number"> 5 </span>hours               upbeat_kepler</span><br><span class="line">9e272ab58362   alpine        &quot;sh -c &#x27;exit 1&#x27;&quot;  <span class="number"> 0 </span>              0B       <span class="number"> 6 </span>hours ago   Exited (1)<span class="number"> 6 </span>hours ago   naughty_blackburn</span><br><span class="line">d95cc7e19d43   hello-world   &quot;/hello&quot;          <span class="number"> 0 </span>              0B       <span class="number"> 7 </span>weeks ago   Exited (0)<span class="number"> 7 </span>weeks ago   nifty_hellman</span><br><span class="line"></span><br><span class="line">Local Volumes space usage:</span><br><span class="line"></span><br><span class="line">VOLUME NAME   LINKS     SIZE</span><br><span class="line">user_my-db   <span class="number"> 0 </span>        0B</span><br><span class="line"></span><br><span class="line">Build cache usage: 0B</span><br><span class="line"></span><br><span class="line">CACHE ID   CACHE TYPE   SIZE      CREATED   LAST USED   USAGE     SHARED</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #20</strong>: Docker Compose Stop vs Down</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="comment"># docker-compose stop</span></span><br><span class="line">&gt; stop container, <span class="keyword">but</span> <span class="keyword">it</span> won&#x27;t remove them</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker-compose down</span></span><br><span class="line">&gt; stop container, removes <span class="keyword">the</span> stopped containers <span class="keyword">as</span> well <span class="keyword">as</span> any networks <span class="keyword">that</span> were created.</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker-compose down -v</span></span><br><span class="line">&gt; add remove all volumes too.</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker Tip #21</strong>: Difference between Docker Create, Start and Run</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Create:</span></span><br><span class="line">  adds a writeable container <span class="keyword">on</span> top <span class="keyword">of</span> your image <span class="keyword">and</span> sets <span class="keyword">it</span> up <span class="keyword">for</span> <span class="built_in">running</span> whatever command you specified <span class="keyword">in</span> you CMD. The container ID <span class="keyword">is</span> reported <span class="keyword">back</span> <span class="keyword">but</span> <span class="keyword">it</span>&#x27;s <span class="keyword">not</span> started.</span><br><span class="line"></span><br><span class="line"><span class="comment"># Start:</span></span><br><span class="line">  will start any stopped container.</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run:</span></span><br><span class="line">  combination <span class="keyword">of</span> create <span class="keyword">and</span> start, It creates <span class="keyword">the</span> container <span class="keyword">and</span> starts <span class="keyword">it</span>.</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Have-a-Fun"><a href="#Have-a-Fun" class="headerlink" title="Have a Fun"></a>Have a Fun</h2><ul>
<li>Run the First Edition of Unix (1972) with Docker<blockquote>
<p>Run a PDP-11 simulator through Docker to interact with Unix as it was back in 1972</p>
</blockquote>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">$ docker <span class="keyword">run</span> --<span class="keyword">rm</span> -it bahamat/unix-1st-<span class="keyword">ed</span></span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>Docker</tag>
        <tag>Dockerfile</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo-next-gitalk</title>
    <url>/2021/09/01/hexo-next-gitalk/</url>
    <content><![CDATA[<h3 id="ç«™ç‚¹æ­å»ºè¿‡ç¨‹"><a href="#ç«™ç‚¹æ­å»ºè¿‡ç¨‹" class="headerlink" title="ç«™ç‚¹æ­å»ºè¿‡ç¨‹"></a>ç«™ç‚¹æ­å»ºè¿‡ç¨‹</h3><ul>
<li><a href="https://hexo.io/zh-cn/">hexo</a> : å¿«é€Ÿã€ç®€æ´ä¸”é«˜æ ¡çš„åšå®¢æ¡†æ¶</li>
<li><a href="https://github.com/next-theme/hexo-theme-next/blob/master/docs/zh-CN/README.md">next</a> : Hexoä¸»é¢˜</li>
<li><a href="https://github.com/gitalk/gitalk">gitalk</a> : ä¾é GitHub issueçš„è¯„è®ºç³»ç»Ÿ</li>
</ul>
<span id="more"></span>

<h3 id="Settings-amp-Tips"><a href="#Settings-amp-Tips" class="headerlink" title="Settings &amp; Tips"></a>Settings &amp; Tips</h3><ul>
<li><p><strong>Show descripion</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"># ä¿®æ”¹themes/next/_config.yml</span><br><span class="line">excerpt_description: true</span><br><span class="line"></span><br><span class="line"># æ–‡ç« æˆªæ–­</span><br><span class="line"><span class="comment">&lt;!--more--&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>å­—æ•°ç»Ÿè®¡</strong></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…æ’ä»¶ hexo-symbols-count-time</span></span><br><span class="line"><span class="string">$</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">hexo-symbols-count-time</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹hexoé…ç½®æ–‡ä»¶_config.yml</span></span><br><span class="line">  <span class="comment"># Symbols count and time to read of articles for Hexo.</span></span><br><span class="line">  <span class="attr">symbols_count_time:</span></span><br><span class="line">      <span class="attr">symbols:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">time:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">total_symbols:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">total_time:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹Nexté…ç½®æ–‡ä»¶</span></span><br><span class="line">  <span class="comment"># Post wordcount display settings</span></span><br><span class="line">  <span class="comment"># Dependencies: https://github.com/next-theme/hexo-word-counter</span></span><br><span class="line">  <span class="attr">symbols_count_time:</span></span><br><span class="line">    <span class="attr">separated_meta:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">item_text_post:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">item_text_total:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">awl:</span> <span class="number">4</span></span><br><span class="line">    <span class="attr">wpm:</span> <span class="number">275</span></span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>blog</tag>
      </tags>
  </entry>
  <entry>
    <title>micro-services</title>
    <url>/2021/09/01/micro-services/</url>
    <content><![CDATA[<span id="more"></span>

<h2 id="é¡¹ç›®å·¥ç¨‹åŒ–"><a href="#é¡¹ç›®å·¥ç¨‹åŒ–" class="headerlink" title="é¡¹ç›®å·¥ç¨‹åŒ–"></a>é¡¹ç›®å·¥ç¨‹åŒ–</h2><ul>
<li><p>å¼€æºè§„èŒƒ</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># å¼€æºåè®®</span></span><br><span class="line"><span class="bullet">  1.</span> GPL - General Public License</span><br><span class="line"><span class="code">    &gt; è¡ç”Ÿä»£ç çš„åˆ†å‘éœ€è¦å¼€æºå¹¶ä¸”ä¹Ÿè¦éµå®ˆæ­¤åè®®</span></span><br><span class="line"><span class="code">  2. MPL</span></span><br><span class="line"><span class="code">    &gt; å…è®¸å…è´¹é‡å‘å¸ƒã€å…è´¹ä¿®æ”¹ï¼Œä½†è¦æ±‚ä¿®æ”¹çš„ä»£ç ç‰ˆæƒå½’è½¯ä»¶å‘èµ·è€…ï¼Œè¿™ç§æˆæƒç»´æŠ¤äº†å•†ä¸šè½¯ä»¶çš„åˆ©ç›Šï¼Œè¦æ±‚åŸºäºè¿™ç§è½¯ä»¶çš„ä¿®æ”¹æ— å¿è´¡çŒ®ç‰ˆæƒç»™è¯¥è½¯ä»¶</span></span><br><span class="line"><span class="code">  3. LGPL</span></span><br><span class="line"><span class="code">  4. Apache</span></span><br><span class="line"><span class="code">    &gt; Apache 2.0åè®®é™¤äº†ä¸ºç”¨æˆ·æä¾›ç‰ˆæƒè®¸å¯ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸“åˆ©è®¸å¯ï¼Œé€‚åˆè®¾è®¡ä¸“åˆ©å†…å®¹çš„é¡¹ç›®</span></span><br><span class="line"><span class="code">  5. BSD</span></span><br><span class="line"><span class="code">    &gt;</span></span><br><span class="line"><span class="code">  6. MIT</span></span><br><span class="line"><span class="code">    &gt; MIT åè®®æ˜¯æ‰€æœ‰å¼€æºè®¸å¯ä¸­æœ€å®½æ¾çš„ä¸€ä¸ªï¼Œé™¤äº†ç»†ç¬”åŒ…å«è®¸å¯å£°æ˜ä¹‹å¤–ï¼Œå†æ— ä»»ä½•é™åˆ¶</span></span><br></pre></td></tr></table></figure></li>
<li><p>å¼€æºè§„èŒƒ</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> é¡¹ç›®ç»“æ„:</span><br><span class="line"><span class="bullet">2.</span> ä¸¥æ ¼éµå¾ªä»£ç è§„èŒƒ:</span><br><span class="line"><span class="bullet">3.</span> ä»£ç è´¨é‡:</span><br><span class="line"><span class="bullet">4.</span> å•å…ƒæµ‹è¯•è¦†ç›–ç‡:</span><br><span class="line"><span class="bullet">5.</span> ç‰ˆæœ¬å‘å¸ƒè§„èŒƒ:</span><br><span class="line"><span class="bullet">6.</span> å‘ä¸‹å…¼å®¹:</span><br><span class="line"><span class="bullet">7.</span> è¯¦ç»†çš„æ–‡æ¡£è¯´æ˜:</span><br><span class="line"><span class="bullet">8.</span> å®‰å…¨:</span><br></pre></td></tr></table></figure></li>
<li><p>æ–‡æ¡£è§„èŒƒ</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> READMEæ–‡æ¡£</span><br><span class="line">  ä»‹ç»é¡¹ç›®åŠŸèƒ½ã€å®‰è£…ã€éƒ¨ç½²ã€ä½¿ç”¨</span><br><span class="line"><span class="bullet">2.</span> é¡¹ç›®æ–‡æ¡£</span><br><span class="line">  å¼€å‘æ–‡æ¡£: è¯´æ˜é¡¹ç›®çš„å¼€å‘æµç¨‹</span><br><span class="line">  ç”¨æˆ·æ–‡æ¡£:</span><br><span class="line"><span class="bullet">3.</span> APIæ¥å£æ–‡æ¡£</span><br></pre></td></tr></table></figure></li>
<li><p>ç‰ˆæœ¬è§„èŒƒ</p>
<figure class="highlight tp"><table><tr><td class="code"><pre><span class="line">è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ: SemVer: ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å· (<span class="keyword">X</span>.<span class="keyword">Y</span>.<span class="keyword">Z</span>), XYZä¸ºéè´Ÿçš„æ•´æ•°ï¼Œç¦æ­¢åœ¨æ•°å­—å‰æ–¹è¡¥é›¶</span><br><span class="line">  ä¸»ç‰ˆæœ¬å·: MAJOR: å½“åšäº†ä¸å…¼å®¹APIä¿®æ”¹</span><br><span class="line">  æ¬¡ç‰ˆæœ¬å·: MINOR: å½“åšäº†å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ–°å¢åŠä¿®æ”¹ -- å¶æ•°ä¸ºç¨³å®šç‰ˆæœ¬ï¼Œå¥‡æ•°ä¸ºå¼€å‘ç‰ˆæœ¬</span><br><span class="line">  ä¿®è®¢å·:PATCH: å‘ä¸‹å…¼å®¹é—®é¢˜ä¿®æ­£</span><br><span class="line"></span><br><span class="line"><span class="keyword">X</span>.<span class="keyword">Y</span>.<span class="keyword">Z</span>[-å…ˆè¡Œç‰ˆæœ¬å·][+ç‰ˆæœ¬ç¼–è¯‘å…ƒæ•°æ®]</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. å®é™…å¼€å‘çš„æ—¶å€™ï¼Œä½¿ç”¨<span class="number">0</span><span class="number">.1</span><span class="number">.0</span>ä½œä¸ºç¬¬ä¸€å¼€å‘ç‰ˆæœ¬å·</span><br><span class="line">fixç±»å‹çš„commit å¯ä»¥å°†ä¿®è®¢å·+<span class="number">1</span></span><br><span class="line">featç±»å‹çš„commitå¯ä»¥å°†æ¬¡ç‰ˆæœ¬å·+<span class="number">1</span></span><br><span class="line">breaking changeçš„commitå°†ä¸»ç‰ˆæœ¬å·+<span class="number">1</span></span><br></pre></td></tr></table></figure></li>
<li><p>Commit è§„èŒƒ</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line">Commit MessageåŒ…å«ä¸‰éƒ¨åˆ†:</span><br><span class="line"><span class="symbol">  Header:</span> <span class="params">&lt;type&gt;</span>[optional scope]: <span class="params">&lt;description&gt;</span></span><br><span class="line"><span class="symbol">    type:</span></span><br><span class="line"><span class="symbol">      feat:</span> æ–°å¢åŠŸèƒ½</span><br><span class="line"><span class="symbol">      fix:</span> Bugä¿®å¤</span><br><span class="line"><span class="symbol">      perf:</span> æé«˜ä»£ç æ€§èƒ½çš„å˜æ›´</span><br><span class="line"><span class="symbol">      style:</span> ä»£ç æ ¼å¼ç±»çš„å˜æ›´</span><br><span class="line"><span class="symbol">      refactor:</span> å…¶ä»–ä»£ç ç±»çš„å˜æ›´ï¼Œè¿™äº›å˜æ›´ä¸å±äºfeat,fix,perfå’Œstyle. ç®€åŒ–ä»£ç ï¼Œé‡å‘½åå˜é‡ã€åˆ é™¤å†—ä½™ä»£ç </span><br><span class="line"><span class="symbol">      test:</span> æ–°å¢æµ‹è¯•ç”¨ä¾‹æˆ–æ˜¯æ›´æ–°ç°æœ‰æµ‹è¯•ç”¨ä¾‹</span><br><span class="line"><span class="symbol">      ci:</span> æŒç»­é›†æˆå’Œéƒ¨ç½²æƒ³å¹²æ”¹åŠ¨ï¼Œ</span><br><span class="line"><span class="symbol">      docs:</span> æ–‡æ¡£ç±»æ›´æ–°</span><br><span class="line"><span class="symbol">      chore:</span> å…¶ä»–ç±»å‹ï¼Œæ„å»ºæµç¨‹ã€ä¾èµ–ç®¡ç†æˆ–è€…è¾…åŠ©å·¥å…·çš„å˜åŠ¨</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">    scope:</span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">    description:</span> åŠ¨è¯å¼€å¤´ï¼Œä½¿ç”¨ç°åœ¨æ—¶</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">  Body:</span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">  Footer:</span></span><br><span class="line"></span><br><span class="line">git rebase: é‡å†™å†å²</span><br><span class="line">  git rebase -i <span class="params">&lt;commit ID&gt;</span> è¿™é‡Œæ˜¯éœ€è¦åˆå¹¶commitä¸­æœ€æ—§commitçš„çˆ¶commit ID</span><br><span class="line"></span><br><span class="line">git reset HEAD~<span class="number">3</span>A æ’¤é”€è¿‡å»çš„commit,é‡æ–°æäº¤</span><br><span class="line"></span><br><span class="line">git commit --amend: ä¿®æ”¹æœ€è¿‘ä¸€æ¬¡commit çš„ message</span><br><span class="line"></span><br><span class="line">Commit Messageæ˜¯commitæ•°æ®ç»“æ„ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œå¦‚æœCommit Messageæœ‰å˜æ›´ï¼Œåˆ™commit IDä¸€å®šä¼šå˜ï¼Œgit commit --amendåªä¼šå˜æ›´æœ€åä¸€æ¬¡çš„commit ID, git rebase -i ä¼šå˜æ›´çˆ¶commit IDä¹‹åçš„æ‰€æœ‰æäº¤commit ID.</span><br><span class="line"></span><br><span class="line">å¦‚æœå½“å‰åˆ†ä¹‹æœ‰æœªcommitçš„ä»£ç ï¼Œéœ€è¦å…ˆæ‰§è¡Œgit stashå°†å·¥ä½œçŠ¶æ€è¿›è¡Œæš‚å­˜ï¼Œå½“ä¿®æ”¹å®Œæˆååœ¨æ‰§è¡Œgit stash popæ¢å¤ä¹‹å‰çš„å·¥ä½œçŠ¶æ€</span><br></pre></td></tr></table></figure></li>
<li><p>ç›®å½•ç»“æ„è®¾è®¡</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç»“æ„åŒ–ç›®å½•ç»“æ„</span></span><br><span class="line">  /cmd            <span class="comment">-- ç»„ä»¶</span></span><br><span class="line">  /internal       <span class="comment">-- ç§æœ‰åº”ç”¨å’Œåº“ä»£ç ,ä¸å¸Œæœ›åœ¨å…¶ä»–åº”ç”¨å’Œåº“ä¸­è¢«å¯¼å…¥</span></span><br><span class="line">  /pkg            <span class="comment">-- å­˜æ”¾å¯ä»¥è¢«å¤–éƒ¨åº”ç”¨ä½¿ç”¨çš„ä»£ç åº“</span></span><br><span class="line"><span class="comment"># å¹³é“ºå¼ç›®å½•ç»“æ„</span></span><br><span class="line">  &gt; è¿™ç§æ–¹å¼åœ¨å¾ˆå¤šæ¡†æ¶/åº“ä¸­å­˜åœ¨,å¥½å¤„å¼å¼•ç”¨è·¯å¾„é•¿åº¦çŸ­</span><br></pre></td></tr></table></figure></li>
<li><p>å·¥ä½œæµè®¾è®¡</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é›†ä¸­å¼å·¥ä½œæµ</span></span><br><span class="line">  &gt; é€‚ç”¨äºå›¢é˜Ÿäººæ•°å°‘ã€å¼€å‘ä¸é¢‘ç¹ã€ä¸éœ€è¦åŒæ—¶ç»´æŠ¤å¤šä¸ªç‰ˆæœ¬çš„å°é¡¹ç›®</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠŸèƒ½åˆ†æ”¯å·¥ä½œæµ</span></span><br><span class="line">  &gt; ä¸åŒåŠŸèƒ½åœ¨ä¸åŒçš„åˆ†æ”¯è¿›è¡Œå¼€å‘ï¼Œæœ€ååˆå¹¶åˆ°<span class="literal">master</span>åˆ†æ”¯</span><br><span class="line">  Merge pull request:</span><br><span class="line">    <span class="number">1</span>. Create a merge commit: git merge --no-ff. featureåˆ†æ”¯ä¸Šæ‰€æœ‰çš„commitéƒ½ä¼šåŠ åˆ°<span class="literal">master</span>åˆ†æ”¯ä¸Šï¼Œå¹¶ä¸”ä¼šç”Ÿæˆä¸€ä¸ªmerge commitã€‚</span><br><span class="line">    <span class="number">2</span>. Squash <span class="keyword">and</span> merge: git merge --squash. featureåˆ†æ”¯ä¸Šæ‰€æœ‰çš„commitéƒ½åˆå¹¶æˆä¸€ä¸ªcommit.ç„¶ååŠ åˆ°<span class="literal">master</span>åˆ†æ”¯,åŸæ¥çš„commitå†å²ä¼šä¸¢å¤±</span><br><span class="line">    <span class="number">3</span>. Rebase <span class="keyword">and</span> merge: git rebase. å°†pull requestä¸Šæ‰€æœ‰æäº¤å†å²æŒ‰ç…§åŸæœ‰é¡ºåºä¾æ¬¡æ·»åŠ åˆ°<span class="literal">master</span>åˆ†æ”¯çš„å¤´éƒ¨HEAD.</span><br><span class="line"></span><br><span class="line"><span class="comment"># Git Flowå·¥ä½œæµ</span></span><br><span class="line">  &gt; æ¯”è¾ƒé€‚åˆå¤§å‹çš„é¡¹ç›®æˆ–è€…è¿­ä»£é€Ÿåº¦å¿«çš„é¡¹ç›®</span><br><span class="line">  <span class="literal">master</span>: è¯¥åˆ†æ”¯æœ€æ–°ä»£ç æ˜¯å‘å¸ƒçŠ¶æ€ï¼Œä¸èƒ½ç›´æ¥åœ¨è¯¥åˆ†æ”¯ä¸Šå¼€å‘ï¼Œ<span class="literal">master</span>åˆ†æ”¯æ¯åˆå¹¶ä¸€ä¸ªhotfix/releaseåˆ†æ”¯ï¼Œéƒ½ä¼šæ‰“ä¸€ä¸ªç‰ˆæœ¬æ ‡ç­¾</span><br><span class="line">  develop: è¯¥åˆ†æ”¯æ˜¯å¼€å‘ä¸­çš„æœ€æ–°ä»£ç ï¼Œè¯¥åˆ†æ”¯åªåšåˆå¹¶æ“ä½œï¼Œä¸èƒ½ç›´æ¥åœ¨è¯¥åˆ†æ”¯ä¸Šå¼€å‘</span><br><span class="line">  feature: åŠŸèƒ½å¼€å‘,åŸºäºdevelopåˆ†æ”¯æ–°å»ºä¸€ä¸ªfeatureåˆ†æ”¯ï¼Œfeatureåˆ†æ”¯åˆå¹¶ä¹‹å‰å…ˆpullä¸€ä¸‹developåˆ†æ”¯ï¼Œ</span><br><span class="line">  release: åœ¨å‘å¸ƒé˜¶æ®µä½œä¸ºç‰ˆæœ¬å‘å¸ƒçš„é¢„å‘å¸ƒåˆ†æ”¯ï¼ŒåŸºäºdevelopåˆ†æ”¯åˆ›å»º, æµ‹è¯•é€šè¿‡åï¼Œå°†releaseåˆ†æ”¯åˆå¹¶åˆ°<span class="literal">master</span>å’Œdevelopï¼Œå¹¶åœ¨<span class="literal">master</span>åˆ†æ”¯ä¸Šç‰ˆæœ¬æ ‡ç­¾ï¼Œæœ€ååˆ é™¤releaseç‰ˆæœ¬åˆ†æ”¯</span><br><span class="line">  hotfix: åœ¨ç»´æŠ¤é˜¶æ®µåšç´§æ€¥Bugä¿®å¤åˆ†æ”¯ï¼Œhotfixåˆ†æ”¯åˆå¹¶åˆ°<span class="literal">master</span>å’Œdevelopåˆ†æ”¯ï¼Œå¹¶åœ¨<span class="literal">master</span>åˆ†æ”¯æ‰“ä¸Šä¿®å¤åçš„ç‰ˆæœ¬æ ‡ç­¾,æœ€ååˆ é™¤hotfixåˆ†æ”¯</span><br><span class="line"></span><br><span class="line"><span class="comment"># Forking å·¥ä½œæµ</span></span><br><span class="line">  é¡¹ç›®è¿œç¨‹ä»“åº“å’Œå¼€å‘è€…è¿œç¨‹ä»“åº“å®Œå…¨ç‹¬ç«‹ï¼Œå¼€å‘è€…é€šè¿‡Pull Requestçš„æ–¹å¼ç»™è¿œç¨‹ä»“åº“è´¡çŒ®ä»£ç ï¼Œé¡¹ç›®ç»´æŠ¤è€…é€‰æ‹©æ€§åœ°æ¥æ”¶ä»»ä½•å¼€å‘è€…çš„æäº¤ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥é¿å…å¼€å‘è€…é¡¹ç›®è¿œç¨‹ä»“åº“çš„æƒé™,ä»è€Œæé«˜é¡¹ç›®è¿œç¨‹ä»“åº“çš„å®‰å…¨æ€§</span><br></pre></td></tr></table></figure></li>
<li><p>ç ”å‘æµç¨‹</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="ä»‹ç»å¾®æœåŠ¡æ¶æ„è®¾è®¡"><a href="#ä»‹ç»å¾®æœåŠ¡æ¶æ„è®¾è®¡" class="headerlink" title="ä»‹ç»å¾®æœåŠ¡æ¶æ„è®¾è®¡"></a>ä»‹ç»å¾®æœåŠ¡æ¶æ„è®¾è®¡</h2><figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;Hello, world!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç§‘å­¦</category>
      </categories>
      <tags>
        <tag>å¾®æœåŠ¡</tag>
        <tag>DDD</tag>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>å·¥ç¨‹åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>Distributed ID Generator</title>
    <url>/2021/09/02/Distributed-ID-Generator/</url>
    <content><![CDATA[<span id="more"></span>

<h1 id="Distributed-ID-Generator"><a href="#Distributed-ID-Generator" class="headerlink" title="Distributed ID Generator"></a>Distributed ID Generator</h1><ul>
<li>UUID<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">  <span class="string">&quot;testing&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;github.com/google/uuid&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func BenchmarkUUID(t *testing.B) &#123;</span><br><span class="line">  for i := 0; i &lt; t.N; i++ &#123;</span><br><span class="line">    _ = uuid.New()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">~/Downloads/uuid_demo via ğŸ¹ v1.17 took 13s</span><br><span class="line">âœ go test -bench=.</span><br><span class="line"><span class="section">goos: darwin</span></span><br><span class="line"><span class="section">goarch: amd64</span></span><br><span class="line"><span class="section">pkg: uuid_demo</span></span><br><span class="line"><span class="section">cpu: Intel(R) Core(TM) i5-5257U CPU @ 2.70GHz</span></span><br><span class="line">BenchmarkUUID-4   	 1390710	       844.7 ns/op</span><br><span class="line">PASS</span><br><span class="line">ok  	uuid_demo	2.351s</span><br><span class="line"></span><br><span class="line"><span class="comment"># UUIDs are 128-bit hexadecimal numbers that are globally unique</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¼˜ç‚¹:</span></span><br><span class="line">  1. ç”Ÿæˆè¶³å¤Ÿç®€å•ï¼Œæœ¬åœ°ç”Ÿæˆæ— ç½‘ç»œæ¶ˆè€—ï¼Œå…·æœ‰å”¯ä¸€æ€§</span><br><span class="line"><span class="comment"># ç¼ºç‚¹:</span></span><br><span class="line">  1. æ— åºçš„å­—ç¬¦ä¸²ï¼Œä¸å…·å¤‡è¶‹åŠ¿è‡ªå¢ç‰¹æ€§</span><br><span class="line">  2. æ²¡æœ‰å…·ä½“çš„ä¸šåŠ¡å«ä¹‰</span><br><span class="line">  3. é•¿åº¦è¿‡é•¿16å­—èŠ‚128ä½,36ä½é•¿åº¦çš„å­—ç¬¦ä¸²,å­˜å‚¨ä»¥åŠæŸ¥è¯¢æ•°æ®åº“æ€§èƒ½æ¶ˆè€—è¾ƒå¤§,æ•°æ®åº“å»ºè®®ä¸»é”®å°½é‡è¶ŠçŸ­è¶Šå¥½ï¼Œä½œä¸ºæ•°æ®åº“ä¸»é”®UUIDçš„æ— åºæ€§ä¼šå¯¼è‡´æ•°æ®ä½ç½®é¢‘ç¹å˜åŠ¨ï¼Œä¸¥é‡å½±å“æ€§èƒ½</span><br></pre></td></tr></table></figure></li>
<li>åŸºäºæ•°æ®åº“è‡ªå¢ID<blockquote>
<p>åŸºäºæ•°æ®åº“çš„auto_incrementè‡ªå¢IDå®Œæˆå¯ä»¥å……å½“åˆ†å¸ƒå¼ID</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"># åˆ›å»ºæ•°æ®è¡¨</span><br><span class="line">mysql&gt; <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> SEQUENCE_ID (id <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> auto_increment, <span class="keyword">value</span> <span class="type">char</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span>, <span class="keyword">PRIMARY KEY</span> (id)) ENGINE=MyISAM;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected, <span class="number">1</span> <span class="built_in">warning</span> (<span class="number">0.08</span> sec)</span><br><span class="line"></span><br><span class="line"># MySQLä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æ’å…¥æ•°æ®</span><br><span class="line"><span class="keyword">delimiter</span> $$<span class="pgsql"></span></span><br><span class="line"><span class="pgsql"><span class="keyword">create</span> <span class="keyword">procedure</span> bench_insert(count <span class="type">int</span> unsigned)</span></span><br><span class="line"><span class="pgsql"><span class="keyword">BEGIN</span></span></span><br><span class="line"><span class="pgsql">  <span class="keyword">declare</span> num <span class="type">int</span> unsigned <span class="keyword">default</span> <span class="number">1</span>;</span></span><br><span class="line"><span class="pgsql">  <span class="keyword">declare</span> c <span class="type">char</span>(<span class="number">10</span>) <span class="keyword">default</span> repeat(<span class="string">&#x27;c&#x27;</span>,<span class="number">10</span>);</span></span><br><span class="line"><span class="pgsql">  <span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span></span><br><span class="line"><span class="pgsql">  <span class="keyword">while</span> num &lt;= count <span class="keyword">DO</span></span></span><br><span class="line"><span class="pgsql">    <span class="keyword">insert</span> <span class="keyword">into</span> SEQUENCE_ID(`<span class="keyword">value</span>`) <span class="keyword">values</span>(c);</span></span><br><span class="line"><span class="pgsql">    <span class="keyword">set</span> num=num+<span class="number">1</span>;</span></span><br><span class="line"><span class="pgsql">  <span class="keyword">end</span> <span class="keyword">while</span>;</span></span><br><span class="line"><span class="pgsql"><span class="keyword">COMMIT</span>;</span></span><br><span class="line"><span class="pgsql"><span class="keyword">END</span>$$</span> <span class="keyword">delimiter</span> ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> bench_insert(<span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">PROCEDURE</span> bench_insert;</span><br><span class="line"></span><br><span class="line"># å½“éœ€è¦IDçš„æ—¶å€™ï¼Œå‘è¡¨ä¸­æ’å…¥è®°å½•è¿”å›ä¸»é”®ID.</span><br><span class="line"></span><br><span class="line"># ä¼˜ç‚¹:</span><br><span class="line">  <span class="number">1.</span> å®ç°ç®€å•ã€IDå•è°ƒè‡ªå¢ã€æ•°å€¼ç±»å‹æŸ¥è¯¢é€Ÿåº¦å¿«</span><br><span class="line"></span><br><span class="line">ç¼ºç‚¹:</span><br><span class="line">  <span class="number">1.</span> DBå•ç‚¹å­˜åœ¨å®•æœºé£é™©ï¼Œæ— æ³•æ‰›ä½é«˜å¹¶å‘åœºæ™¯</span><br></pre></td></tr></table></figure></li>
<li>åŸºäºæ•°æ®åº“é›†ç¾¤æ¨¡å¼<blockquote>
<p>å¤šæ•°æ®åº“å®ä¾‹å•ç‹¬ç”Ÿäº§è‡ªå¢ID</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># è®¾ç½®å¯å§‹å€¼å’Œè‡ªå¢å¸ƒé•¿</span><br><span class="line">  DB1:</span><br><span class="line">    <span class="keyword">set</span> @<span class="variable">@auto</span>_increment_offset <span class="operator">=</span> <span class="number">1</span>; <span class="comment">-- èµ·å§‹å€¼</span></span><br><span class="line">    <span class="keyword">set</span> @<span class="variable">@auto</span>_increment_increment <span class="operator">=</span> <span class="number">2</span>; <span class="comment">-- æ­¥é•¿</span></span><br><span class="line">  DB2:</span><br><span class="line">    <span class="keyword">set</span> @<span class="variable">@auto</span>_increment_offset <span class="operator">=</span> <span class="number">2</span>; <span class="comment">-- èµ·å§‹å€¼</span></span><br><span class="line">    <span class="keyword">set</span> @<span class="variable">@auto</span>_increment_increment <span class="operator">=</span> <span class="number">2</span>; <span class="comment">-- æ­¥é•¿</span></span><br><span class="line"></span><br><span class="line"># ä¼˜ç‚¹:</span><br><span class="line">  è§£å†³DBå•ç‚¹é—®é¢˜</span><br><span class="line"></span><br><span class="line"># ç¼ºç‚¹:</span><br><span class="line">  ä¸åˆ©äºåç»­æ‰©å®¹ï¼Œè€Œä¸”å®é™…ä¸Šå•ä¸ªæ•°æ®åº“è‡ªèº«å‹åŠ›è¿˜æ˜¯å¾ˆå¤§ï¼Œä¾æ—§æ— æ³•æ»¡è¶³é«˜å¹¶å‘åœºæ™¯</span><br></pre></td></tr></table></figure></li>
<li>åŸºäºæ•°æ®åº“çš„å·æ®µæ¨¡å¼<blockquote>
<p>å·æ®µæ¨¡å¼æ˜¯åˆ†å¸ƒå¼IDç”Ÿæˆå™¨ä¸»æµå®ç°æ–¹å¼ä¹‹ä¸€ï¼Œæ‰¹é‡è·å–è‡ªå¢IDï¼Œæ¯æ¬¡ä»æ•°æ®åº“å–å‡ºä¸€ä¸ªå·æ®µèŒƒå›´ï¼Œå…·ä½“ä¸šåŠ¡æœåŠ¡å°†æœ¬å·æ®µç”Ÿæˆçš„è‡ªå¢IDåŠ è½½å†…å­˜</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">  mysql&gt; <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> id_generator (id <span class="type">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, max_id <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;å½“å‰æœ€å¤§id&#x27;</span>, step <span class="type">int</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;å·æ®µçš„å¸ƒé•¿&#x27;</span>, biz_type <span class="type">int</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;ä¸šåŠ¡ç±»å‹&#x27;</span>, <span class="keyword">version</span> <span class="type">int</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;ç‰ˆæœ¬å·&#x27;</span>, <span class="keyword">PRIMARY KEY</span>(`id`));</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected, <span class="number">5</span> warnings (<span class="number">0.11</span> sec)</span><br><span class="line"></span><br><span class="line">  mysql&gt; describe id_generator;</span><br><span class="line">  +<span class="comment">----------+--------+------+-----+---------+-------+</span></span><br><span class="line">  | Field    | <span class="keyword">Type</span>   | <span class="keyword">Null</span> | Key | <span class="keyword">Default</span> | Extra |</span><br><span class="line">  +<span class="comment">----------+--------+------+-----+---------+-------+</span></span><br><span class="line">  | id       | <span class="type">int</span>    | <span class="keyword">NO</span>   | PRI | <span class="keyword">NULL</span>    |       |</span><br><span class="line">  | max_id   | <span class="type">bigint</span> | <span class="keyword">NO</span>   |     | <span class="keyword">NULL</span>    |       |  <span class="comment">-- å½“å‰æœ€å¤§çš„å¯ç”¨id</span></span><br><span class="line">  | step     | <span class="type">int</span>    | <span class="keyword">NO</span>   |     | <span class="keyword">NULL</span>    |       |  <span class="comment">-- ä»£è¡¨å·æ®µçš„é•¿åº¦</span></span><br><span class="line">  | biz_type | <span class="type">int</span>    | <span class="keyword">NO</span>   |     | <span class="keyword">NULL</span>    |       |  <span class="comment">-- ä¸åŒä¸šåŠ¡ç±»å‹</span></span><br><span class="line">  | <span class="keyword">version</span>  | <span class="type">int</span>    | <span class="keyword">NO</span>   |     | <span class="keyword">NULL</span>    |       |  <span class="comment">-- ä¹è§‚é”ï¼Œæ¯æ¬¡éƒ½æ›´æ–°versionï¼Œä¿è¯å¹¶å‘æ—¶æ•°æ®çš„æ­£ç¡®æ€§</span></span><br><span class="line">  +<span class="comment">----------+--------+------+-----+---------+-------+</span></span><br><span class="line">  <span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.04</span> sec)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">update</span> id_generator <span class="keyword">set</span> max_id = #&#123;max_id+step&#125;, version = <span class="keyword">version</span> + <span class="number">1</span> <span class="keyword">where</span> version = # &#123;<span class="keyword">version</span>&#125; <span class="keyword">and</span> biz_type = XXX</span><br></pre></td></tr></table></figure></li>
<li>åŸºäºRedisæ¨¡å¼<blockquote>
<p>åˆ©ç”¨redis Incr åŸå­æ€§è‡ªå¢</p>
</blockquote>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  <span class="number">172.30.1.23</span>:<span class="number">6002</span>&gt; set seq_id <span class="number">1</span></span><br><span class="line">  OK</span><br><span class="line">  <span class="number">172.30.1.23</span>:<span class="number">6002</span>&gt; incr seq_id</span><br><span class="line">  (integer) <span class="number">2</span></span><br><span class="line">  <span class="number">172.30.1.23</span>:<span class="number">6002</span>&gt; get seq_id</span><br><span class="line">  &quot;<span class="number">2</span>&quot;</span><br><span class="line">  <span class="number">172.30.1.23</span>:<span class="number">6002</span>&gt;</span><br><span class="line"></span><br><span class="line"># Benchmark</span><br><span class="line">ubuntu in ~ at <span class="number">3</span>BPlus took <span class="number">4</span>s</span><br><span class="line">âœ redis-benchmark -n <span class="number">1000000</span> -t set,get,incr -P <span class="number">16</span> -q -h <span class="number">127.0.0.1</span> -p <span class="number">6001</span> --cluster</span><br><span class="line">Cluster has <span class="number">3</span> master nodes:</span><br><span class="line"></span><br><span class="line">Master <span class="number">0</span>: a733c21d3b735b9d026eb4d462ef6b367d8ebb<span class="number">98 172.30.1</span>.<span class="number">23</span>:<span class="number">6002</span></span><br><span class="line">Master <span class="number">1</span>: <span class="number">9</span>c35a4e211f6534861ed768dba592e<span class="number">85539b1377</span> <span class="number">172.30.1.23</span>:<span class="number">6003</span></span><br><span class="line">Master <span class="number">2</span>: a901e497cb72819cf0765e9e4eb16c36399c437b <span class="number">172.30.1.23</span>:<span class="number">6001</span></span><br><span class="line"></span><br><span class="line">SET: <span class="number">47001.32</span> requests per second, p<span class="number">50=15.199</span> msec</span><br><span class="line">GET: <span class="number">101936.80</span> requests per second, p<span class="number">50=5.679</span> msec</span><br><span class="line">INCR: <span class="number">46496.49</span> requests per second, p<span class="number">50=13.879</span> msec   -- å¹¶å‘<span class="number">5</span>ä¸‡/s</span><br></pre></td></tr></table></figure></li>
<li>twitter snowflake<blockquote>
<p>é›ªèŠ±ç®—æ³• (Snowflake) Twitterå†…éƒ¨åˆ†å¸ƒå¼é‡‡ç”¨çš„IDç”Ÿæˆç®—æ³•</p>
</blockquote>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="section"># The default Twitter format shown below.</span></span><br><span class="line"><span class="section">+--------------------------------------------------------------------------+</span></span><br><span class="line"><span class="section">| 1 Bit Unused | 41 Bit Timestamp |  10 Bit NodeID  |   12 Bit Sequence ID |</span></span><br><span class="line"><span class="section">+--------------------------------------------------------------------------+</span></span><br><span class="line"></span><br><span class="line">41 bits: store a timestamp with millisecond precision</span><br><span class="line">10 bits: store a node id - a range from 0 through 1023</span><br><span class="line">12 bits: store a sequence number - a range from 0 through 4095</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>ID Generator</tag>
      </tags>
  </entry>
  <entry>
    <title>Kafka Tips &amp; Tracks</title>
    <url>/2021/09/02/Kafka-Tips-Tracks/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>MySQL Tips &amp; Tracks</title>
    <url>/2021/09/02/MySQL-Tips-Tracks/</url>
    <content><![CDATA[<h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><h2 id="æ•°æ®åº“æ—¥å¿—"><a href="#æ•°æ®åº“æ—¥å¿—" class="headerlink" title="æ•°æ®åº“æ—¥å¿—"></a>æ•°æ®åº“æ—¥å¿—</h2><ul>
<li>é‡åšæ—¥å¿— - redo log<blockquote>
<p>è®°å½•ä¿®æ”¹åçš„æ•°æ®</p>
</blockquote>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>æ•°æ®åº“</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis Tips &amp; Tracks</title>
    <url>/2021/09/02/Redis-Tips-Tracks/</url>
    <content><![CDATA[<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><blockquote>
<p>Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache, and message broker.</p>
</blockquote>
<span id="more"></span>

<h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><ul>
<li>é€šä¿¡åè®®<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">rediså®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å‘é€çš„å‘½ä»¤å’Œæ•°æ®ä¸€å¾‹ä»¥\r\n (<span class="literal">CR</span> LF)ç»“å°¾</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯·æ±‚åè®®:</span></span><br><span class="line">  *&lt;å‚æ•°æ•°é‡&gt; <span class="literal">CR</span> LF</span><br><span class="line">  $&lt;å‚æ•°çš„å­—èŠ‚æ•°é‡&gt; <span class="literal">CR</span> LF</span><br><span class="line">  &lt;å‚æ•°çš„æ•°æ®&gt; <span class="literal">CR</span> LF</span><br><span class="line"></span><br><span class="line">  ubuntu <span class="keyword">in</span> / î‚¢ <span class="keyword">at</span> <span class="number">3</span>BPlus took <span class="number">11</span>s</span><br><span class="line">  âœ tail appendonly.aof</span><br><span class="line">  $<span class="number">3</span></span><br><span class="line">  <span class="built_in">set</span></span><br><span class="line">  $<span class="number">4</span></span><br><span class="line">  name</span><br><span class="line">  $<span class="number">10</span></span><br><span class="line">  chyiyaqing</span><br><span class="line"></span><br><span class="line"><span class="comment"># å›å¤åè®®:</span></span><br><span class="line">  &gt; åœ¨å›å¤åè®®ä¸­ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œç¡®å®šè¿™ä¸ªå›å¤æ˜¯ä»€ä¹ˆç±»å‹</span><br><span class="line">  - çŠ¶æ€å›å¤ (status reply) ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ <span class="string">&quot;+&quot;</span></span><br><span class="line">  - é”™è¯¯å›å¤ (error reply) ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ <span class="string">&quot;-&quot;</span></span><br><span class="line">  - æ•´æ•°å›å¤ (<span class="keyword">integer</span> reply) ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ <span class="string">&quot;.&quot;</span></span><br><span class="line">  - æ‰¹é‡å›å¤ (bulk reply) ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ <span class="string">&quot;$&quot;</span></span><br><span class="line">  - å¤šæ¡æ‰¹é‡å›å¤ (multi bulk reply) ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="æ€§èƒ½è°ƒä¼˜"><a href="#æ€§èƒ½è°ƒä¼˜" class="headerlink" title="æ€§èƒ½è°ƒä¼˜"></a>æ€§èƒ½è°ƒä¼˜</h2><h2 id="æŒä¹…åŒ–"><a href="#æŒä¹…åŒ–" class="headerlink" title="æŒä¹…åŒ–"></a>æŒä¹…åŒ–</h2><blockquote>
<p>Redis æŒä¹…åŒ–ä¸»è¦ä¸¤å¤§æœºåˆ¶: AOF (Append Only File) æ—¥å¿—å’ŒRDB å¿«ç…§</p>
</blockquote>
<ul>
<li><p>AOF - Append Only File</p>
<blockquote>
<p>AOFæ—¥å¿—æ˜¯Redisæ‰§è¡Œå®Œå‘½ä»¤ï¼ŒæŠŠæ•°æ®å†™å…¥å†…å­˜ï¼Œç„¶åæ‰è®°å½•æ—¥å¿—,è®°å½•çš„æ˜¯Redisæ”¶åˆ°çš„æ¯ä¸€æ¡å‘½ä»¤</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># å†™åæ—¥å¿—è¿™ç§æ–¹å¼ï¼Œå…ˆè®©ç³»ç»Ÿæ‰§è¡Œå‘½ä»¤ï¼Œåªæœ‰å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œæ‰ä¼šè¢«è®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œé¿å…å‡ºç°è®°å½•é”™è¯¯å‘½ä»¤çš„æƒ…å†µ</span></span><br><span class="line"><span class="section"># AOF æ˜¯åœ¨å‘½ä»¤æ‰§è¡Œåæ‰è®°å½•æ—¥å¿—ï¼Œä¸ä¼šé˜»å¡å½“å‰å†™æ“ä½œ</span></span><br><span class="line"></span><br><span class="line"><span class="section"># å†™å›ç£ç›˜ç­–ç•¥ appendfsync</span></span><br><span class="line"><span class="bullet">  1.</span> Always: åŒæ­¥å†™å›, æ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œç«‹é©¬åŒæ­¥å°†æ—¥å¿—å†™å›ç£ç›˜</span><br><span class="line"><span class="code">    &gt; è½ç›˜æ“ä½œå±äºæ…¢é€Ÿï¼Œå›å½±å“ä¸»çº¿ç¨‹æ€§èƒ½</span></span><br><span class="line"><span class="code">  2. Everysec: æ¯ç§’å†™å›,æ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ°AOFæ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œæ¯éš”ä¸€ç§’æŠŠç¼“å†²åŒºä¸­çš„å†…å®¹å†™å…¥ç£ç›˜</span></span><br><span class="line"><span class="code">    &gt; åœ¨é¿å…å½±å“ä¸»çº¿ç¨‹å’Œé¿å…æ•°æ®ä¸¢å¤±ä¸¤è€…ä¹‹é—´trade-offæ–¹å¼</span></span><br><span class="line"><span class="code">  3. No: æ“ä½œç³»ç»Ÿæ§åˆ¶å†™å›ï¼Œæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œåªæ˜¯å…ˆæŠŠæ—¥å¿—å†™åˆ°AOFæ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†ç¼“å†²åŒºå†…å®¹å†™å›ç£ç›˜</span></span><br><span class="line"><span class="code">    &gt; è½ç›˜æ—¶æœºäº¤ç»™æ“ä½œç³»ç»Ÿï¼Œåªè¦AOFè®°å½•æ²¡æœ‰å†™å›ç£ç›˜ï¼Œå®•æœºå¯¹åº”çš„æ•°æ®å°±ä¸¢å¤±</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># è§£å†³AOFæ–‡ä»¶è¿‡å¤§çš„æ€§èƒ½é—®é¢˜: AOF é‡å†™</span></span><br><span class="line"></span><br><span class="line">  é—®é¢˜:</span><br><span class="line"><span class="bullet">    1.</span> æ–‡ä»¶ç³»ç»Ÿæœ¬èº«å¯¹æ–‡ä»¶å¤§å°æœ‰é™åˆ¶ï¼Œæ— æ³•ä¿å­˜è¿‡å¤§çš„æ–‡ä»¶</span><br><span class="line"><span class="bullet">    2.</span> æ–‡ä»¶è¿‡å¤§ï¼Œè¿½åŠ å‘½ä»¤è®°å½•æ•ˆç‡å˜ä½</span><br><span class="line"><span class="bullet">    3.</span> å‘ç”Ÿå®•æœºï¼ŒAOFè®°å½•å‘½ä»¤è¦è¢«é‡æ–°æ‰§è¡Œï¼Œæ•…éšœæ¢å¤æ¯”è¾ƒç¼“æ…¢ï¼Œä¼šå½±å“Redisæ­£å¸¸ä½¿ç”¨</span><br><span class="line"></span><br><span class="line">  AOFé‡å†™:</span><br><span class="line"><span class="code">    &gt; é‡å†™æœºåˆ¶å¯ä»¥å°†æ—§æ—¥å¿—æ–‡ä»¶ä¸­çš„å¤šæ¡å‘½ä»¤ï¼Œåœ¨é‡å†™åçš„æ–°æ—¥å¿—ä¸­å˜æˆä¸€æ¡å‘½ä»¤</span></span><br><span class="line"><span class="code">    &gt; AOFé‡å†™è¿‡ç¨‹æ˜¯ç”±åå°å­è¿›ç¨‹bgrewriteaofå®Œæˆï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™</span></span><br><span class="line"><span class="code">    &gt; æ¯æ¬¡AOFé‡å†™æ—¶ï¼ŒRedisä¼šæ‰§è¡Œä¸€ä¸ªå†…å­˜æ‹·è´ï¼Œç”¨äºé‡å†™ï¼Œç„¶åä½¿ç”¨ä¸¤ä¸ªæ—¥å¿—ä¿è¯é‡å†™è¿‡ç¨‹ä¸­ï¼Œæ–°å†™å…¥çš„æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œè€Œä¸”ï¼ŒRedisé‡‡ç”¨é¢å¤–çš„çº¿ç¨‹è¿›è¡Œæ•°æ®é‡å†™ï¼Œè¿‡ç¨‹ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹</span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure></li>
<li><p>RDB - å†…å­˜å¿«ç…§</p>
<blockquote>
<p>å†…å­˜å¿«ç…§ï¼šæŒ‡å†…å­˜ä¸­çš„æ•°æ®åœ¨æŸä¸€ä¸ªæ—¶åˆ»çš„çŠ¶æ€è®°å½•</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># Redisä¸¤ç§å‘½ä»¤ç”ŸæˆRDBæ–‡ä»¶</span></span><br><span class="line"><span class="bullet">  1.</span> save: åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œä¼šå¯¼è‡´é˜»å¡</span><br><span class="line"><span class="bullet">  2.</span> bgsave: åˆ›å»ºå­è¿›ç¨‹ï¼Œä¸“é—¨ç”¨äºå†™å…¥RDBæ–‡ä»¶ï¼Œé¿å…ä¸»çº¿ç¨‹é˜»å¡</span><br><span class="line"><span class="code">    &gt; bgsaveå­è¿›ç¨‹ç”±ä¸»çº¿ç¨‹forkç”Ÿæˆï¼Œå…±äº«ä¸»çº¿ç¨‹çš„æ‰€æœ‰å†…å­˜æ•°æ®ï¼Œbgsaveå­è¿›ç¨‹è¿è¡Œåï¼Œå¼€å§‹è¯»å–ä¸»çº¿ç¨‹çš„å†…å­˜æ•°æ®ï¼Œå¹¶æŠŠæ•°æ®å†™å…¥RDBæ–‡ä»¶</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># å¢é‡å¿«ç…§:</span></span><br><span class="line"><span class="quote">&gt; åšä¸€æ¬¡å…¨é‡å¿«ç…§åï¼Œåç»­çš„å¿«ç…§æ”¯é˜Ÿä¿®æ”¹çš„æ•°æ®è¿›è¡Œå¿«ç…§è®°å½•ï¼Œå¯ä»¥é¿å…æ¯æ¬¡å…¨é‡å¿«ç…§çš„å¼€é”€</span></span><br><span class="line"></span><br><span class="line"><span class="section"># æ··åˆä½¿ç”¨AOFæ—¥å¿—å’Œå†…å­˜å¿«ç…§</span></span><br><span class="line"><span class="quote">&gt; å†…å­˜å¿«ç…§ä»¥ä¸€å®šçš„é¢‘ç‡æ‰§è¡Œï¼Œä¸¤æ¬¡å¿«ç…§ä¹‹é—´ï¼Œä½¿ç”¨AOFæ—¥å¿—è®°å½•è¿™æœŸé—´çš„æ‰€æœ‰å‘½ä»¤æ“ä½œ</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Redis-åº”ç”¨åœºæ™¯-æ¶ˆæ¯é˜Ÿåˆ—"><a href="#Redis-åº”ç”¨åœºæ™¯-æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="Redis åº”ç”¨åœºæ™¯ - æ¶ˆæ¯é˜Ÿåˆ—"></a>Redis åº”ç”¨åœºæ™¯ - æ¶ˆæ¯é˜Ÿåˆ—</h2>  <figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># æ¶ˆæ¯é˜Ÿåˆ—éœ€è¦æ»¡è¶³çš„åŠŸèƒ½:</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">  1.</span> æ”¯æŒé˜»å¡ç­‰å¾…æ‹‰å–æ¶ˆæ¯</span><br><span class="line"><span class="bullet">  2.</span> æ”¯æŒå‘å¸ƒ/è®¢é˜…æ¨¡å¼</span><br><span class="line"><span class="bullet">  3.</span> æ¶ˆè´¹å¤±è´¥ï¼Œå¯é‡æ–°æ¶ˆè´¹ï¼Œæ¶ˆæ¯ä¸ä¸¢å¤±</span><br><span class="line"><span class="bullet">  4.</span> å®ä¾‹å®•æœºï¼Œæ¶ˆæ¯ä¸ä¸¢å¤±ã€æ•°æ®å¯æŒä¹…åŒ–</span><br><span class="line"><span class="bullet">  5.</span> æ¶ˆæ¯å¯å †ç§¯</span><br></pre></td></tr></table></figure>

<ul>
<li><p>List - é˜Ÿåˆ—:</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line">ubuntu in ~ at 3BPlus</span><br><span class="line">âœ redis-cli -c -p <span class="number">6001</span></span><br><span class="line"><span class="number">127.0.0.1:6001</span>&gt; ping</span><br><span class="line">PONG</span><br><span class="line"><span class="number">127.0.0.1:6001</span>&gt; LPUSH queue msg1    # å¢åŠ æ¶ˆæ¯</span><br><span class="line">-&gt; Redirected to slot <span class="string">[13011]</span> located at <span class="number">172</span>.<span class="number">30</span>.<span class="number">1</span>.<span class="number">23</span>:<span class="number">6003</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">172.30.1.23:6003</span>&gt; LPUSH queue msg2</span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">172.30.1.23:6003</span>&gt; RPOP queue        # æ‹‰å–æ¶ˆæ¯</span><br><span class="line"><span class="string">&quot;msg1&quot;</span></span><br><span class="line"><span class="number">172.30.1.23:6003</span>&gt; RPOP queue</span><br><span class="line"><span class="string">&quot;msg2&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6001</span>&gt; RPOP queue          # é˜Ÿåˆ—ä¸ºç©ºï¼ŒRPOPè¿”å›NULL</span><br><span class="line">-&gt; Redirected to slot <span class="string">[13011]</span> located at <span class="number">172</span>.<span class="number">30</span>.<span class="number">1</span>.<span class="number">23</span>:<span class="number">6003</span></span><br><span class="line">(nil)</span><br><span class="line"><span class="number">127.0.0.1:6001</span>&gt; BRPOP queue <span class="number">5</span>       # BRPOPé˜»å¡å¼æ‹‰å–æ¶ˆæ¯ï¼Œæ”¯æŒä¼ å…¥è¶…æ—¶æ—¶é—´</span><br><span class="line">-&gt; Redirected to slot <span class="string">[13011]</span> located at <span class="number">172</span>.<span class="number">30</span>.<span class="number">1</span>.<span class="number">23</span>:<span class="number">6003</span></span><br><span class="line">(nil)</span><br><span class="line">(<span class="number">5</span>.00s)</span><br><span class="line"><span class="number">172.30.1.23:6003</span>&gt; BRPOP queue <span class="number">0</span>     # ä¸è®¾ç½®è¶…æ—¶ï¼Œç›´åˆ°æœ‰æ–°æ¶ˆæ¯æ‰è¿”å›</span><br><span class="line">^C</span><br><span class="line"><span class="number">172.30.1.23:6003</span>&gt; exit</span><br><span class="line"></span><br><span class="line">æ³¨æ„: å¦‚æœè®¾ç½®è¶…æ—¶æ—¶é—´å¤ªé•¿ï¼Œè¿æ¥å¤ªä¹…æ²¡æœ‰æ´»è·ƒï¼Œæœ‰å¯èƒ½ä¼šè¢«Redis serveråˆ¤å®šä¸ºæ— æ•ˆè¿æ¥ï¼Œä¹‹åRedis Serverä¼šå¼ºåˆ¶æŠŠè¿™ä¸ªå®¢æˆ·ç«¯è¸¢ä¸‹çº¿ï¼Œå®¢æˆ·ç«¯è¦æœ‰é‡è¿æœºåˆ¶</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. ä¸æ”¯æŒé‡å¤æ¶ˆè´¹ï¼šæ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯åï¼Œè¯¥æ¶ˆæ¯å°±ä»Listä¸­åˆ é™¤ï¼Œæ— æ³•è¢«å…¶ä»–æ¶ˆè´¹è€…åœ¨æ­¤æ¶ˆè´¹ï¼Œå³ä¸æ”¯æŒå¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹åŒä¸€æ‰¹æ•°æ®</span><br><span class="line"><span class="number">2</span>. æ¶ˆæ¯ä¸¢å¤±ï¼Œæ¶ˆè´¹è€…æ‹‰å–åˆ°æ¶ˆæ¯åï¼Œå¦‚æœå‘ç”Ÿå¼‚å¸¸å®•æœºï¼Œè¿™æ¡æ¶ˆæ¯å°±ä¸¢å¤±</span><br><span class="line"></span><br><span class="line"># å•æœºæµ‹è¯„</span><br><span class="line">ubuntu in ~ at 3BPlus took 37s</span><br><span class="line">âœ redis-benchmark -n <span class="number">1000000</span> -t lpush,rpop -P <span class="number">16</span> -q -h <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> -p <span class="number">6001</span> --cluster</span><br><span class="line">Cluster has <span class="number">3</span> master nodes:</span><br><span class="line"></span><br><span class="line">Master <span class="number">0</span>: a733c21d3b735b9d026eb4d462ef6b367d8ebb98 <span class="number">172</span>.<span class="number">30</span>.<span class="number">1</span>.<span class="number">23</span>:<span class="number">6002</span></span><br><span class="line">Master <span class="number">1</span>: 9c35a4e211f6534861ed768dba592e85539b1377 <span class="number">172</span>.<span class="number">30</span>.<span class="number">1</span>.<span class="number">23</span>:<span class="number">6003</span></span><br><span class="line">Master <span class="number">2</span>: a901e497cb72819cf0765e9e4eb16c36399c437b <span class="number">172</span>.<span class="number">30</span>.<span class="number">1</span>.<span class="number">23</span>:<span class="number">6001</span></span><br><span class="line"></span><br><span class="line">LPUSH: <span class="number">41529</span>.<span class="number">96</span> requests per second, p50=<span class="number">17</span>.<span class="number">199</span> msec</span><br><span class="line">RPOP: <span class="number">46539</span>.<span class="number">77</span> requests per second, p50=<span class="number">15</span>.<span class="number">463</span> msec</span><br></pre></td></tr></table></figure></li>
<li><p>Pub/Sub - å‘å¸ƒè®¢é˜…æ¨¡å‹</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¶ˆè´¹è€…1</span></span><br><span class="line">ubuntu <span class="keyword">in</span> ~ <span class="keyword">at</span> <span class="number">3</span>BPlus</span><br><span class="line">âœ redis-cli -c -p <span class="number">6001</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6001</span>&gt; SUBSCRIBE queue</span><br><span class="line">Reading messages... (press Ctrl-C <span class="keyword">to</span> quit)</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;queue&quot;</span></span><br><span class="line"><span class="number">3</span>) (<span class="built_in">integer</span>) <span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;message&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;queue&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;msg1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¶ˆè´¹è€…2</span></span><br><span class="line">ubuntu <span class="keyword">in</span> ~ <span class="keyword">at</span> <span class="number">3</span>BPlus</span><br><span class="line">âœ redis-cli -c -p <span class="number">6001</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6001</span>&gt; SUBSCRIBE queue</span><br><span class="line">Reading messages... (press Ctrl-C <span class="keyword">to</span> quit)</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;queue&quot;</span></span><br><span class="line"><span class="number">3</span>) (<span class="built_in">integer</span>) <span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;message&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;queue&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;msg1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿäº§è€…</span></span><br><span class="line">ubuntu <span class="keyword">in</span> ~ <span class="keyword">at</span> <span class="number">3</span>BPlus</span><br><span class="line">âœ redis-cli -c -p <span class="number">6001</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6001</span>&gt; PUBLISH queue msg1</span><br><span class="line">(<span class="built_in">integer</span>) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6001</span>&gt; PUBLISH queue msg2</span><br><span class="line">(<span class="built_in">integer</span>) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6001</span>&gt; <span class="keyword">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pub/Sub æ”¯æŒé˜»å¡å¼æ‹‰å–æ¶ˆæ¯ï¼Œæ»¡è¶³å¤šç»„æ¶ˆè´¹è€…ï¼ŒåŒ¹é…è®¢é˜…æ¨¡å¼,å…è®¸æ¶ˆè´¹è€…è®¢é˜…å¤šä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6001</span>&gt; PUBLISH queue.p1 msg1       <span class="comment">-- ç”Ÿäº§è€…</span></span><br><span class="line">(<span class="built_in">integer</span>) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6001</span>&gt; PUBLISH queue.p2 msg2</span><br><span class="line">(<span class="built_in">integer</span>) <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6001</span>&gt; PSUBSCRIBE queue.*          <span class="comment">-- æ¶ˆè´¹è€… åŒ¹é…è®¢é˜…</span></span><br><span class="line">Reading messages... (press Ctrl-C <span class="keyword">to</span> quit)</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;psubscribe&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;queue.*&quot;</span></span><br><span class="line"><span class="number">3</span>) (<span class="built_in">integer</span>) <span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;pmessage&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;queue.*&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;queue.p1&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;msg1&quot;</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;pmessage&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;queue.*&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;queue.p2&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;msg2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pub/Sub å®ç°åŸç†</span></span><br><span class="line">&gt; æ²¡æœ‰åŸºäºä»»ä½•æ•°æ®ç±»å‹ï¼Œæ²¡æœ‰åšä»»ä½•æ•°æ®å­˜å‚¨ï¼Œåªæ˜¯å•çº¯åœ°ä¸ºç”Ÿäº§è€…ã€æ¶ˆè´¹è€…å»ºç«‹æ•°æ®è½¬å‘é€šé“ï¼ŒæŠŠç¬¦åˆè§„åˆ™çš„æ•°æ®ï¼Œä»ä¸€ç«¯è½¬å‘åˆ°å¦ä¸€ç«¯</span><br><span class="line">&gt; **åœ¨ä½¿ç”¨Pub/Subæ—¶ï¼Œæ¶ˆè´¹è€…å¿…é¡»å…ˆè®¢é˜…é˜Ÿåˆ—ï¼Œç”Ÿäº§è€…æ‰èƒ½å‘å¸ƒæ¶ˆæ¯ï¼Œå¦åˆ™æ¶ˆæ¯ä¼šä¸¢å¤±**</span><br><span class="line">&gt; Listå±äºâ€œæ‹‰å–æ¨¡å¼â€, Pub/Subå±äºâ€œæ¨æ¨¡å¼â€</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ä½¿ç”¨Pub/Subä¼šä¸¢æ•°æ®</span></span><br><span class="line"><span class="number">1.</span> æ¶ˆè´¹è€…ä¸‹çº¿,é‡æ–°ä¸Šçº¿ï¼Œåªèƒ½æ¥æ”¶æ–°çš„æ¶ˆæ¯ï¼Œåœ¨ä¸‹çº¿æœŸé—´ç”Ÿäº§è€…å‘å¸ƒçš„æ¶ˆæ¯ï¼Œå› ä¸ºæ‰¾ä¸åˆ°æ¶ˆè´¹è€…ï¼Œä¼šè¢«ä¸¢å¼ƒæ‰.</span><br><span class="line"><span class="number">2.</span> Rediså®•æœº, Pub/Subç›¸å…³æ“ä½œï¼Œä¸ä¼šå†™å…¥RDBå’ŒAOFä¸­ï¼Œå½“Rediså®•æœºé‡å¯ï¼ŒPub/Subçš„æ•°æ®ä¼šå…¨éƒ¨ä¸¢å¤±</span><br><span class="line"><span class="number">3.</span> æ¶ˆè´¹å †ç§¯, æ¯ä¸ªæ¶ˆè´¹è€…è®¢é˜…ä¸€ä¸ªé˜Ÿåˆ—ï¼ŒRediséƒ½ä¼šåœ¨Serverç»™æ¶ˆè´¹è€…åˆ†é…ä¸€ä¸ªã€ç¼“å†²åŒºã€‘,è¿™ä¸ªç¼“å†²åŒºå…¶å®å°±æ˜¯ä¸€å—å†…å­˜ï¼Œå½“ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯æ—¶ï¼ŒRediså…ˆæŠŠæ¶ˆæ¯å†™åˆ°å¯¹åº”æ¶ˆè´¹è€…çš„ç¼“å†²åŒº,ä¹‹åæ¶ˆè´¹è€…ä¸æ–­ä»ç¼“å†²åŒºè¯»å–ã€å¤„ç†æ¶ˆæ¯, ç¼“å†²åŒºä¸Šçº¿,ä¼šè¢«å¼ºåˆ¶ä¸‹çº¿.</span><br></pre></td></tr></table></figure></li>
<li><p>Stream</p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Stream é€šè¿‡XADD å’Œ XREADå®Œæˆç®€å•çš„ç”Ÿäº§ã€æ¶ˆè´¹æ¨¡å‹</span></span><br><span class="line">  XADD: å‘å¸ƒæ¶ˆæ¯</span><br><span class="line">  XREAD: è¯»å–æ¶ˆæ¯</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6001</span>&gt; XADD <span class="keyword">queue</span> * name <span class="number">2021</span>      <span class="comment"># * è¡¨ç¤ºè‡ªåŠ¨ç”Ÿæˆå”¯ä¸€æ¶ˆæ¯ID</span></span><br><span class="line">-&gt; Redirected <span class="keyword">to</span> slot [<span class="number">13011</span>] located at <span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span></span><br><span class="line"><span class="string">&quot;1630886765690-0&quot;</span>                           <span class="comment">#æ¶ˆæ¯IDæ ¼å¼: æ—¶é—´æˆ³-è‡ªå¢åºå·</span></span><br><span class="line"><span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span>&gt; XADD <span class="keyword">queue</span> * name <span class="number">09</span>-<span class="number">06</span></span><br><span class="line"><span class="string">&quot;1630886777470-0&quot;</span></span><br><span class="line"><span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6001</span>&gt; XREAD COUNT <span class="number">5</span> STREAMS <span class="keyword">queue</span> <span class="number">0</span>-<span class="number">0</span>   <span class="comment"># ä»å¼€å¤´è¯»å–5æ¡æ¶ˆæ¯ï¼Œ0-0è¡¨ç¤ºä»å¼€å¤´è¯»å–</span></span><br><span class="line">-&gt; Redirected <span class="keyword">to</span> slot [<span class="number">13011</span>] located at <span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span></span><br><span class="line"><span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;queue&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;1630886765690-0&quot;</span></span><br><span class="line">         <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line">            <span class="number">2</span>) <span class="string">&quot;2021&quot;</span></span><br><span class="line">      <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;1630886777470-0&quot;</span></span><br><span class="line">         <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line">            <span class="number">2</span>) <span class="string">&quot;09-06&quot;</span></span><br><span class="line"><span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span>&gt; XREAD COUNT <span class="number">5</span> STREAMS <span class="keyword">queue</span> <span class="number">1630886777470</span>-<span class="number">0</span>  <span class="comment"># ç»§ç»­æ‹‰å–æ¶ˆæ¯,ä¼ å…¥ä¸Šä¸€æ¡æ¶ˆæ¯çš„ID</span></span><br><span class="line"><span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span>&gt; XREAD COUNT <span class="number">5</span> BLOCK <span class="number">0</span> STREAMS <span class="keyword">queue</span> <span class="number">1630886777470</span>-<span class="number">0</span>  <span class="comment"># BLOCK é˜»å¡å¼æ‹‰å–æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Stream æ”¯æŒå‘å¸ƒ/è®¢é˜…æ¨¡å¼</span></span><br><span class="line">  - XGROUP: åˆ›å»ºæ¶ˆè´¹è€…ç»„</span><br><span class="line">  - XREADGROUP: åœ¨æŒ‡å®šæ¶ˆè´¹ç»„ä¸‹ï¼Œå¼€å¯æ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯</span><br><span class="line"></span><br><span class="line">  <span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span>&gt; XGROUP CREATE <span class="keyword">queue</span> group1 <span class="number">0</span>-<span class="number">0</span>  <span class="comment"># åˆ›å»ºæ¶ˆè´¹è€…ç»„1ï¼Œ 0-0è¡¨ç¤ºä»å¤´æ‹‰å–æ¶ˆè´¹</span></span><br><span class="line">  OK</span><br><span class="line">  <span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span>&gt; XGROUP CREATE <span class="keyword">queue</span> group2 <span class="number">0</span>-<span class="number">0</span>  <span class="comment"># åˆ›å»ºæ¶ˆè´¹è€…ç»„2ï¼Œ0-0</span></span><br><span class="line">  OK</span><br><span class="line"></span><br><span class="line">  <span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span>&gt; XREADGROUP GROUP group1 consumer COUNT <span class="number">5</span> STREAMS <span class="keyword">queue</span> &gt;  <span class="comment"># group1 çš„consumerå¼€å§‹æ¶ˆè´¹ï¼Œ&gt;è¡¨ç¤ºæ‹‰å–æœ€æ–°æ•°æ®</span></span><br><span class="line"><span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;queue&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;1630886765690-0&quot;</span></span><br><span class="line">         <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line">            <span class="number">2</span>) <span class="string">&quot;2021&quot;</span></span><br><span class="line">      <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;1630886777470-0&quot;</span></span><br><span class="line">         <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line">            <span class="number">2</span>) <span class="string">&quot;09-06&quot;</span></span><br><span class="line">      <span class="number">3</span>) <span class="number">1</span>) <span class="string">&quot;1630887243865-0&quot;</span></span><br><span class="line">         <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line">            <span class="number">2</span>) <span class="string">&quot;08-14&quot;</span></span><br><span class="line">  <span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span>&gt; XREADGROUP GROUP group2 consumer COUNT <span class="number">5</span> STREAMS <span class="keyword">queue</span> &gt;</span><br><span class="line"><span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;queue&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;1630886765690-0&quot;</span></span><br><span class="line">         <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line">            <span class="number">2</span>) <span class="string">&quot;2021&quot;</span></span><br><span class="line">      <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;1630886777470-0&quot;</span></span><br><span class="line">         <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line">            <span class="number">2</span>) <span class="string">&quot;09-06&quot;</span></span><br><span class="line">      <span class="number">3</span>) <span class="number">1</span>) <span class="string">&quot;1630887243865-0&quot;</span></span><br><span class="line">         <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line">            <span class="number">2</span>) <span class="string">&quot;08-14&quot;</span></span><br><span class="line">  <span class="number">172.30</span>.<span class="number">1.23</span>:<span class="number">6003</span>&gt; XACK <span class="keyword">queue</span> group1 <span class="number">1630887243865</span>-<span class="number">0</span>  <span class="comment"># XACK å‘½ä»¤å‘ŠçŸ¥Redisæ¶ˆè´¹è€…å¤„ç†å®Œ</span></span><br><span class="line">  (integer) <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Stream æ•°æ®ä¼šå†™å…¥RDBå’ŒAOFåšæŒä¹…åŒ–A</span></span><br><span class="line"><span class="comment"># æ¶ˆæ¯å †ç§¯ï¼ŒStreamä¼šåªä¿ç•™å›ºå®šé•¿åº¦çš„æ–°æ¶ˆæ¯,å½“é˜Ÿåˆ—é•¿åº¦è¶…è¿‡ä¸Šé™ï¼Œå°±æ¶ˆæ¯ä¼šè¢«åˆ é™¤ï¼Œåªä¿ç•™å›ºå®šé•¿åº¦çš„æ–°æ¶ˆæ¯</span></span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>ç¼“å­˜</tag>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>echo-go-web-framework</title>
    <url>/2021/09/02/echo-go-web-framework/</url>
    <content><![CDATA[<h1 id="Echo"><a href="#Echo" class="headerlink" title="Echo"></a>Echo</h1><blockquote>
<p>é«˜æ€§èƒ½ã€å¯æ‰©å±•ã€ç²¾ç®€çš„Go Webæ¡†æ¶</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">âœ go run main.go</span><br><span class="line"></span><br><span class="line">   <span class="strong">____</span>    <span class="strong">__</span></span><br><span class="line"><span class="strong">  / __</span>/<span class="strong">__<span class="emphasis">_/ /  <span class="strong">__<span class="emphasis">_</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"> / _</span>// __</span>/ _</span> \/ <span class="emphasis">_ \</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">/<span class="strong">__<span class="emphasis">_/\<span class="strong">__/<span class="emphasis">_//_</span>/\__</span>_</span>/ v4.5.0</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">High performance, minimalist Go web framework</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">https://echo.labstack.com</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">__</span><span class="strong">____</span><span class="strong">____</span><span class="strong">____</span><span class="strong">____</span><span class="strong">____</span><span class="strong">____</span><span class="strong">____</span><span class="strong">____</span><span class="strong">__O/__</span><span class="strong">____</span>_</span></span></span><br><span class="line"><span class="strong">                                    O\</span></span><br><span class="line"><span class="strong">â‡¨ http server started on [::]:8080</span></span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h2 id="åŠŸèƒ½æ¦‚è¿°"><a href="#åŠŸèƒ½æ¦‚è¿°" class="headerlink" title="åŠŸèƒ½æ¦‚è¿°"></a>åŠŸèƒ½æ¦‚è¿°</h2><ul>
<li>Optimized HTTP router which smartly prioritize routes</li>
<li>Build robust and scalable RESTful APIs</li>
<li>Group APIs</li>
<li>Extensible middleware framework</li>
<li>Define middleware at root, group or route level</li>
<li>Data binding for JSON, XML and form payload</li>
<li>Handy functions to send variety of HTTP response</li>
<li>Centralized HTTP error handling</li>
<li>Template rendering with any template engine</li>
<li>Define your format for the logger</li>
<li>Highly customizable</li>
<li>Automatic TLS via Letâ€™s Encrypt</li>
<li>HTTP/2 support</li>
</ul>
]]></content>
      <tags>
        <tag>æ¡†æ¶</tag>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title>Dev-Ops Tips &amp; Tracks</title>
    <url>/2021/09/03/Dev-Ops-Tips-Tracks/</url>
    <content><![CDATA[<h1 id="DevOps"><a href="#DevOps" class="headerlink" title="DevOps"></a>DevOps</h1><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> Programming</span><br><span class="line"><span class="bullet">2.</span> Software Testing</span><br><span class="line"><span class="bullet">3.</span> Operations</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>DevOps</tag>
      </tags>
  </entry>
  <entry>
    <title>Distribute Scraping for Gophers</title>
    <url>/2021/09/03/Distribute-Scraping-for-Gophers/</url>
    <content><![CDATA[<h1 id="åˆ†å¸ƒå¼çˆ¬è™«"><a href="#åˆ†å¸ƒå¼çˆ¬è™«" class="headerlink" title="åˆ†å¸ƒå¼çˆ¬è™«"></a>åˆ†å¸ƒå¼çˆ¬è™«</h1><blockquote>
<p>åˆ†å¸ƒå¼çˆ¬è™«æ˜¯ä¸€å¥—ä»»åŠ¡åˆ†å‘å’Œæ‰§è¡Œç³»ç»Ÿï¼Œå¸¸è§çš„ä»»åŠ¡åˆ†å‘ï¼Œå› ä¸ºä¸Šä¸‹æ¸¸å­˜åœ¨é€Ÿåº¦ä¸åŒ¹é…é—®é¢˜ï¼Œéœ€è¦å€ŸåŠ©æ¶ˆæ¯é˜Ÿåˆ—</p>
</blockquote>
<span id="more"></span>

<h2 id="åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—"><a href="#åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—"></a>åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—</h2><ul>
<li>nats<blockquote>
<p>natsæ˜¯Goå®ç°çš„é«˜æ€§èƒ½åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé€‚ç”¨äºé«˜å¹¶å‘ååé‡çš„æ¶ˆæ¯åˆ†å‘åœºæ™¯.</p>
</blockquote>
</li>
</ul>
]]></content>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>çˆ¬è™«</tag>
      </tags>
  </entry>
  <entry>
    <title>Elasticsearch Tips &amp; Tracks</title>
    <url>/2021/09/03/Elasticsearch-Tips-Tracks/</url>
    <content><![CDATA[<h1 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h1><blockquote>
<p>Elasticsearchæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æœç´¢ä¸åˆ†æå¼•æ“ï¼Œæä¾›è¿‘å®æ—¶æœç´¢å’ŒèšåˆåŠŸèƒ½<br>Elastic Stackä¸»è¦åº”ç”¨äºï¼šæœç´¢ã€æ—¥å¿—ç®¡ç†ã€å®‰å…¨åˆ†æã€æŒ‡æ ‡åˆ†æã€ä¸šåŠ¡åˆ†æã€åº”ç”¨æ€§èƒ½ç›‘æ§ç­‰å¤šä¸ªé¢†åŸŸ<br>â€œSearch is something that any application should have.â€</p>
</blockquote>
<span id="more"></span>

<h2 id="Elastic-Stack-ç”Ÿæ€åœˆ"><a href="#Elastic-Stack-ç”Ÿæ€åœˆ" class="headerlink" title="Elastic Stack ç”Ÿæ€åœˆ"></a>Elastic Stack ç”Ÿæ€åœˆ</h2><ul>
<li><p>è§£å†³æ–¹æ¡ˆ:</p>
<ul>
<li>æœç´¢</li>
<li>æ—¥å¿—åˆ†æ</li>
<li>æŒ‡æ ‡åˆ†æ</li>
<li>å®‰å…¨åˆ†æ</li>
</ul>
</li>
<li><p>å¯è§†åŒ–:</p>
<ul>
<li>Kibana: å¯è§†åŒ–åˆ†æ</li>
</ul>
</li>
<li><p>å­˜å‚¨/è®¡ç®—:</p>
<ul>
<li>Elasticsearch: æ ¸å¿ƒå¼•æ“,æä¾›æ•°æ®å­˜å‚¨ã€æœç´¢å’Œèšåˆçš„èƒ½åŠ›</li>
</ul>
</li>
<li><p>æ•°æ®æŠ“å–:</p>
<ul>
<li>Logstash<blockquote>
<p>å¼€æºçš„æœåŠ¡å™¨ç«¯æ•°æ®å¤„ç†ç®¡é“ï¼Œæ”¯æŒä»ä¸åŒæ¥æºé‡‡é›†æ•°æ®ï¼Œè½¬æ¢æ•°æ®ï¼Œå¹¶å°†æ•°æ®å‘é€åˆ°ä¸åŒçš„å­˜å‚¨åº“ä¸­</p>
</blockquote>
</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># ç‰¹æ€§:</span></span><br><span class="line"><span class="bullet">  1.</span> å®æ—¶è§£æå’Œè½¬æ¢æ•°æ®</span><br><span class="line"><span class="code">    &gt; ä»IPåœ°å€ç ´è¯‘åœ°ç†ä½ç½®</span></span><br><span class="line"><span class="code">    &gt; ä»PIIæ•°æ®åŒ¿ååŒ–ï¼Œæ’é™¤æ•æ„Ÿå­—æ®µ</span></span><br><span class="line"><span class="code">  2. å¯æ‰©å±•</span></span><br><span class="line"><span class="code">  3. å¯é æ€§å®‰å…¨æ€§</span></span><br><span class="line"><span class="code">    &gt; Logstash é€šè¿‡æŒä¹…åŒ–é˜Ÿåˆ—ä¿è¯è‡³å°‘å°†è¿è¡Œä¸­çš„äº‹ä»¶é€è¾¾ä¸€æ¬¡</span></span><br><span class="line"><span class="code">    &gt; æ•°æ®ä¼ è¾“åŠ å¯†</span></span><br><span class="line"><span class="code">  4. åŠ å¯†</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Beats<blockquote>
<p>è½»é‡çº§åˆ«æ•°æ®é‡‡é›†å™¨</p>
</blockquote>
</li>
</ul>
</li>
<li><p>X-Pack: å•†ä¸šåŒ–å¥—ä»¶</p>
</li>
</ul>
<blockquote>
<p>Elasticsearchä¸æ•°æ®åº“çš„é›†æˆ</p>
</blockquote>
<p><img src="/misc/images/Elastichsearch.png" alt="Elastichsearch"></p>
<blockquote>
<p>æŒ‡æ ‡åˆ†æ/æ—¥å¿—åˆ†æ</p>
</blockquote>
<ul>
<li>Data Collection(beats) -&gt; Buffering(redis,Kafkak) -&gt; Data Aggregation &amp; Processing(logstash) -&gt; Indexing &amp; storage(elasticsearch) -&gt; Analysis &amp; visualization(Kbana)</li>
</ul>
<h2 id="Elasticsearch-1"><a href="#Elasticsearch-1" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h2><ul>
<li><p>Elasticsearch ç›®å½•ç»“æ„</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">ubuntu <span class="keyword">in</span> ~/elasticsearch-<span class="number">7.14</span>.<span class="number">1</span> <span class="keyword">at</span> k8s-node1 took <span class="number">45</span>s</span><br><span class="line">âœ tree -L <span class="number">1</span></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ bin                 <span class="comment">-- è„šæœ¬æ–‡ä»¶ï¼ŒåŒ…æ‹¬å¯åŠ¨elasticsearch,å®‰è£…æ’ä»¶ï¼Œè¿è¡Œç»Ÿè®¡æ•°æ®</span></span><br><span class="line">â”œâ”€â”€ config              <span class="comment">-- elasticsearch.yml é›†ç¾¤é…ç½®æ–‡ä»¶ï¼Œuser, role based ç›¸å…³é…ç½®</span></span><br><span class="line">â”œâ”€â”€ jdk                 <span class="comment">-- Java è¿è¡Œç¯å¢ƒ</span></span><br><span class="line">â”œâ”€â”€ lib                 <span class="comment">-- Java ç±»åº“</span></span><br><span class="line">â”œâ”€â”€ LICENSE.txt</span><br><span class="line">â”œâ”€â”€ logs                <span class="comment">-- path.log æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">â”œâ”€â”€ modules             <span class="comment">-- åŒ…å«æ‰€æœ‰ESæ¨¡å—</span></span><br><span class="line">â”œâ”€â”€ NOTICE.txt</span><br><span class="line">â”œâ”€â”€ plugins             <span class="comment">-- åŒ…å«æ‰€æœ‰å·²å®‰è£…æ’ä»¶</span></span><br><span class="line">â””â”€â”€ README.asciidoc</span><br></pre></td></tr></table></figure></li>
<li><p>JVM é…ç½®</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line"><span class="attr"># ä¿®æ”¹JVM - config/jvm.options</span></span><br><span class="line"><span class="attr">  -Xmså’ŒXms æœ€å°æœ€å¤§å†…å­˜è®¾ç½®æˆä¸€æ ·</span></span><br><span class="line"><span class="attr">  -Xmxä¸è¶…è¿‡æœºå™¨å†…å­˜çš„50</span><span class="meta">%</span></span><br></pre></td></tr></table></figure></li>
<li><p>Run</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">$ bin/elasticsearch</span><br><span class="line"><span class="symbol">~ took 11m 31s</span></span><br><span class="line"><span class="symbol">âœ curl http</span>:<span class="comment">//localhost:9200</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span> : <span class="string">&quot;a714f28827d5&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;docker-cluster&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;96jmRuNUQxqFsGeWJjIo6g&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;number&quot;</span> : <span class="string">&quot;7.14.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_flavor&quot;</span> : <span class="string">&quot;default&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_type&quot;</span> : <span class="string">&quot;docker&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_hash&quot;</span> : <span class="string">&quot;66b55ebfa59c92c15db3f69a335d500018b3331e&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_date&quot;</span> : <span class="string">&quot;2021-08-26T09:01:05.390870785Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_snapshot&quot;</span> : false,</span><br><span class="line">    <span class="string">&quot;lucene_version&quot;</span> : <span class="string">&quot;8.9.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_wire_compatibility_version&quot;</span> : <span class="string">&quot;6.8.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_index_compatibility_version&quot;</span> : <span class="string">&quot;6.0.0-beta1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;tagline&quot;</span> : <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Plugin æœºåˆ¶å¯¹ç³»ç»Ÿæ‰©å±•</p>
<blockquote>
<p>Discovery Plugin<br>Analysis Plugin<br>Security Plugin<br>Management Plugin<br>Ingest Plugin<br>Mapper Plugin<br>Backup Plugin</p>
</blockquote>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">ubuntu <span class="keyword">in</span> ~ at k8s-node1 via ğŸ <span class="number">3.8</span><span class="number">.6</span></span><br><span class="line">âœ elasticsearch-plugin install analysis-icu  # åˆ†è¯æ’ä»¶</span><br><span class="line">-&gt; Installing analysis-icu</span><br><span class="line">-&gt; Downloading analysis-icu <span class="keyword">from</span> elastic</span><br><span class="line">[=================================================] <span class="number">100</span>%</span><br><span class="line">-&gt; Installed analysis-icu</span><br><span class="line">-&gt; Please restart Elasticsearch to activate any plugins installed</span><br><span class="line"></span><br><span class="line">ubuntu <span class="keyword">in</span> ~ at k8s-node1 via ğŸ <span class="number">3.8</span><span class="number">.6</span> took <span class="number">23</span>s</span><br><span class="line">âœ elasticsearch-plugin list</span><br><span class="line">analysis-icu</span><br><span class="line"></span><br><span class="line">ubuntu <span class="keyword">in</span> ~ at k8s-node1 via ğŸ <span class="number">3.8</span><span class="number">.6</span></span><br><span class="line">âœ curl http:<span class="comment">//localhost:9200/_cat/plugins</span></span><br><span class="line">k8s-node1 analysis-icu <span class="number">7.14</span><span class="number">.1</span></span><br></pre></td></tr></table></figure></li>
<li><p>å¤šé›†ç¾¤<br><a href="/misc/code/elasticsearch/docker-compose.yml">docker-compose.yml</a></p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line">âœ curl -X GET <span class="string">&quot;localhost:9200/_cat/nodes?v=true&amp;pretty&quot;</span></span><br><span class="line">ip         heap.percent ram.percent cpu load_1m load_5m load_15m node.role   master name</span><br><span class="line"><span class="number">172.24.0.2</span>           <span class="number">41</span>          <span class="number">97</span>  <span class="number">85</span>    <span class="number">4</span>.<span class="number">28</span>    <span class="number">1</span>.<span class="number">24</span>     <span class="number">0</span>.<span class="number">43</span> cdfhilmrstw -      es01</span><br><span class="line"><span class="number">172.24.0.3</span>           <span class="number">56</span>          <span class="number">97</span>  <span class="number">85</span>    <span class="number">4</span>.<span class="number">28</span>    <span class="number">1</span>.<span class="number">24</span>     <span class="number">0</span>.<span class="number">43</span> cdfhilmrstw -      es03</span><br><span class="line"><span class="number">172.24.0.4</span>           <span class="number">27</span>          <span class="number">97</span>  <span class="number">85</span>    <span class="number">4</span>.<span class="number">28</span>    <span class="number">1</span>.<span class="number">24</span>     <span class="number">0</span>.<span class="number">43</span> cdfhilmrstw *      es02</span><br></pre></td></tr></table></figure></li>
<li><p>Kibana:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> <span class="built_in">curl</span> http://localhost:<span class="number">5601</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Kibana Plugins æ’ä»¶</span></span><br><span class="line"><span class="variable">$</span> kibana<span class="literal">-plugin</span> install</span><br><span class="line"><span class="variable">$</span> kibana<span class="literal">-plugin</span> list</span><br><span class="line"><span class="variable">$</span> kibana remove</span><br></pre></td></tr></table></figure></li>
<li><p>Logstash:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Elasticsearch-åŸºæœ¬æ¦‚å¿µ"><a href="#Elasticsearch-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="Elasticsearch åŸºæœ¬æ¦‚å¿µ"></a>Elasticsearch åŸºæœ¬æ¦‚å¿µ</h2><ul>
<li><p>æ–‡æ¡£ Document</p>
<blockquote>
<p>Elasticsearch æ˜¯é¢å‘æ–‡æ¡£çš„ï¼Œæ–‡æ¡£æ˜¯æ‰€æœ‰å¯æœç´¢æ•°æ®çš„æœ€å°å•ä½<br>æ–‡æ¡£ä¼šè¢«åºåˆ—åŒ–æˆJSONæ ¼å¼ï¼Œä¿å­˜åœ¨Elasticsearchä¸­<br>æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰ä¸€ä¸ªUnique ID</p>
</blockquote>
<figure class="highlight elm"><table><tr><td class="code"><pre><span class="line"># æ–‡æ¡£å…ƒæ•°æ®<span class="type">Metadata</span> - æ ‡æ³¨æ–‡æ¡£çš„ç›¸å…³ä¿¡æ¯</span><br><span class="line">  _index - æ–‡æ¡£æ‰€å±çš„ç´¢å¼•å</span><br><span class="line">  _<span class="keyword">type</span>  - æ–‡æ¡£æ‰€å±ç±»å‹å</span><br><span class="line">  _id    - æ–‡æ¡£å”¯ä¸€<span class="type">ID</span></span><br><span class="line">  _source - æ–‡æ¡£åŸå§‹<span class="type">JSON</span>æ•°æ®</span><br><span class="line">  _version - æ–‡æ¡£çš„ç‰ˆæœ¬ä¿¡æ¯ <span class="comment">-- è§£å†³å¹¶å‘è¯»å†™å†²çª</span></span><br><span class="line">  _score  - ç›¸å…³æ€§æ‰“åˆ†</span><br></pre></td></tr></table></figure></li>
<li><p>ç´¢å¼• Index</p>
<blockquote>
<p>å°†æ–‡æ¡£å†™å…¥Elasticsearchçš„è¿‡ç¨‹å«ç´¢å¼•indexing</p>
</blockquote>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">Mapping:</span> å®šä¹‰åŒ…å«çš„æ–‡æ¡£çš„å­—æ®µåå’Œå­—æ®µç±»å‹</span><br><span class="line"><span class="symbol">Setting:</span> å®šä¹‰ä¸åŒæ•°æ®åˆ†å¸ƒ</span><br><span class="line"><span class="symbol">Shard:</span> ç´¢å¼•ä¸­çš„æ•°æ®åˆ†æ•£åœ¨Shardsä¸Š</span><br></pre></td></tr></table></figure></li>
<li><p>èŠ‚ç‚¹ Node</p>
<blockquote>
<p>èŠ‚ç‚¹æ˜¯Elasticsearch å®ä¾‹</p>
</blockquote>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">-E node.<span class="attr">name=</span>node1</span><br><span class="line">æ¯ä¸ªèŠ‚ç‚¹å¯åŠ¨åï¼Œä¼šåˆ†é…ä¸€ä¸ªUIDï¼Œä¿å­˜åœ¨dataç›®å½•ä¸‹</span><br><span class="line"></span><br><span class="line"><span class="comment"># Master-eligible nodes å’Œ Master Node</span></span><br><span class="line">  <span class="number">1</span>. èŠ‚ç‚¹å¯åŠ¨é»˜è®¤æ˜¯ä¸€ä¸ª<span class="literal">Master</span>-eligibleèŠ‚ç‚¹, -E node.<span class="literal">master</span>:<span class="literal">false</span> ç¦æ­¢</span><br><span class="line">  <span class="number">2</span>. <span class="literal">Master</span>-eligibleèŠ‚ç‚¹å¯ä»¥å‚åŠ é€‰ä¸»æµç¨‹ï¼Œç§°ä¸º<span class="literal">Master</span>èŠ‚ç‚¹</span><br><span class="line">  <span class="number">3</span>. æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¿å­˜é›†ç¾¤çŠ¶æ€ï¼Œåªæœ‰<span class="literal">master</span>èŠ‚ç‚¹æ‰èƒ½ä¿®æ”¹é›†ç¾¤çŠ¶æ€</span><br><span class="line"></span><br><span class="line"><span class="comment"># é›†ç¾¤çŠ¶æ€ Cluster State</span></span><br><span class="line">  <span class="number">1</span>. æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯</span><br><span class="line">  <span class="number">2</span>. æ‰€æœ‰çš„ç´¢å¼•å’Œç›¸å…³Mapping ä¸ Settingä¿¡æ¯</span><br><span class="line">  <span class="number">3</span>. åˆ†ç‰‡çš„è·¯ç”±ä¿¡æ¯</span><br><span class="line"></span><br><span class="line"><span class="comment"># Data Node &amp; Coordinating Node</span></span><br><span class="line">  <span class="number">1</span>. Data <span class="keyword">Node</span><span class="title">: å¯ä»¥ä¿å­˜æ•°æ®çš„èŠ‚ç‚¹ï¼Œä¿å­˜åˆ†ç‰‡æ•°æ®</span></span><br><span class="line"><span class="title">  2</span>. Coordinating <span class="keyword">Node</span><span class="title">: è´Ÿè´£æ¥å—Client</span>è¯·æ±‚ï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°åˆé€‚çš„èŠ‚ç‚¹ï¼Œæœ€ç»ˆæŠŠç»“æœæ±‡é›†åˆ°ä¸€èµ·</span><br><span class="line"></span><br><span class="line"><span class="comment"># Hot &amp; Warm Node</span></span><br><span class="line"><span class="comment"># Machine Learning Node</span></span><br><span class="line"><span class="comment"># Tribe Node</span></span><br></pre></td></tr></table></figure></li>
<li><p>åˆ†ç‰‡ Primary Shard &amp; Replica Shard</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section">#ä¸»åˆ†ç‰‡: è§£å†³æ•°æ®æ°´å¹³æ‰©å±•çš„é—®é¢˜</span></span><br><span class="line"><span class="bullet">  1.</span> ä¸€ä¸ªåˆ†ç‰‡æ˜¯ä¸€ä¸ªè¿è¡Œçš„Luceneçš„å®ä¾‹</span><br><span class="line"><span class="bullet">  2.</span> ä¸»åˆ†ç‰‡åœ¨ç´¢å¼•åˆ›å»ºæ—¶æŒ‡å®šï¼Œåç»­ä¸å…è®¸ä¿®æ”¹,ä½¿ç”¨ Reindexä¿®æ”¹</span><br><span class="line"></span><br><span class="line"><span class="section">#å‰¯æœ¬: è§£å†³æ•°æ®é«˜å¯ç”¨çš„é—®é¢˜</span></span><br><span class="line"><span class="bullet">  1.</span> å‰¯æœ¬åˆ†ç‰‡æ•°ï¼Œå¯ä»¥åŠ¨æ€è°ƒæ•´</span><br><span class="line"><span class="bullet">  2.</span> å¢åŠ å‰¯æœ¬æ•°ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜æœåŠ¡çš„å¯ç”¨æ€§ (è¯»å–çš„åå)</span><br><span class="line"></span><br><span class="line"><span class="section">#åˆ†ç‰‡è®¾å®š-å®¹é‡è§„åˆ’</span></span><br><span class="line"><span class="bullet">  1.</span> åˆ†ç‰‡æ•°è®¾ç½®è¿‡å°:</span><br><span class="line"><span class="code">    a. åç»­æ— æ³•å¢åŠ èŠ‚ç‚¹å®ç°æ°´å¹³æ‰©å±•</span></span><br><span class="line"><span class="code">    b. å•ä¸ªåˆ†ç‰‡çš„æ•°æ®é‡è¿‡å¤§ï¼Œå¯¼è‡´æ•°æ®é‡æ–°åˆ†é…è€—æ—¶</span></span><br><span class="line"><span class="code">  2. åˆ†ç‰‡è®¾ç½®è¿‡å¤§:</span></span><br><span class="line"><span class="code">    a. å½±å“æœç´¢ç»“æœçš„ç›¸å…³æ€§æ‰“åˆ†ï¼Œå½±å“ç»Ÿè®¡ç»“æœå‡†ç¡®æ€§</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</span></span><br><span class="line">  Green: ä¸»åˆ†ç‰‡å’Œå‰¯ç‰‡æ­£å¸¸</span><br><span class="line">  Yellow: ä¸»åˆ†ç‰‡æ­£å¸¸ï¼Œå‰¯ç‰‡ä¸æ­£å¸¸</span><br><span class="line">  Red: ä¸»åˆ†ç‰‡æœªèƒ½åˆ†é…</span><br></pre></td></tr></table></figure></li>
<li><p>Elasticsearch vs å…³ç³»å‹æ•°æ®åº“ æŠ½è±¡ä¸ç±»æ¯”</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">RDBMS</th>
<th align="left">Elasticsearch</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Table</td>
<td align="left">Index</td>
</tr>
<tr>
<td align="left">Row</td>
<td align="left">Document</td>
</tr>
<tr>
<td align="left">Column</td>
<td align="left">Field</td>
</tr>
<tr>
<td align="left">Schema</td>
<td align="left">Mapping</td>
</tr>
<tr>
<td align="left">SQL</td>
<td align="left">DSL</td>
</tr>
</tbody></table>
<ul>
<li><p>æ–‡æ¡£Document CRUD</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">//</span>create document. è‡ªåŠ¨ç”Ÿæˆ_id</span><br><span class="line">POST users/_doc</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;user&quot;</span>: <span class="string">&quot;Mike&quot;</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;trying out Kibana&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>create document. æŒ‡å®šId, å¦‚æœIDå·²ç»å­˜åœ¨ï¼ŒæŠ¥é”™</span><br><span class="line">PUT users<span class="regexp">/_doc/</span><span class="number">1</span>?op_type=create</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;user&quot;</span>: <span class="string">&quot;Jack&quot;</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;trying out Elasticsearch&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>create document. æŒ‡å®šId, å¦‚æœIDå·²ç»å­˜åœ¨ï¼ŒæŠ¥é”™</span><br><span class="line">PUT users<span class="regexp">/_create/</span><span class="number">1</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;user&quot;</span>: <span class="string">&quot;Jack&quot;</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;trying out Elasticsearch&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> Get the document by ID</span><br><span class="line">GET users<span class="regexp">/_doc/</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> Index</span><br><span class="line">PUT users<span class="regexp">/_doc/</span><span class="number">1</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;user&quot;</span>: <span class="string">&quot;Mike&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>Update åœ¨åŸæ–‡æ¡£ä¸Šå¢åŠ å­—æ®µ</span><br><span class="line">POST users<span class="regexp">/_update/</span><span class="number">1</span>/</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;doc&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;message&quot;</span>: <span class="string">&quot;trying out Elasticsearch 3&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><ul>
<li>Bulk API<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">1. æ”¯æŒåœ¨ä¸€æ¬¡APIè°ƒç”¨ä¸­ï¼Œå¯¹ä¸åŒçš„ç´¢å¼•è¿›è¡Œæ“ä½œ</span><br><span class="line">2. æ”¯æŒå››ç§ç±»å‹æ“ä½œ:</span><br><span class="line">  <span class="keyword">Index</span></span><br><span class="line">  <span class="keyword">Create</span></span><br><span class="line">  <span class="keyword">Update</span></span><br><span class="line">  <span class="keyword">Delete</span></span><br><span class="line"><span class="number">3.</span> æ“ä½œå•æ¡æ“ä½œå¤±è´¥ï¼Œä¸ä¼šå½±å“å…¶ä»–æ“ä½œ</span><br><span class="line"><span class="number">4.</span> è¿”å›ç»“æœåŒ…æ‹¬æ¯ä¸€æ¡æ“ä½œçš„æ‰§è¡Œç»“æœ</span><br><span class="line"></span><br><span class="line">//Bulkæ“ä½œ</span><br><span class="line">POST _bulk</span><br><span class="line">&#123;<span class="string">&quot;index&quot;</span>: &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;test&quot;</span>, <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;field1&quot;</span>: <span class="string">&quot;value1&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;delete&quot;</span>: &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;test&quot;</span>, <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;2&quot;</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;create&quot;</span>: &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;test2&quot;</span>, <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;3&quot;</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;field1&quot;</span>: <span class="string">&quot;value3&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;update&quot;</span>: &#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>, <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;test&quot;</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;doc&quot;</span>: &#123;<span class="string">&quot;field2&quot;</span>: <span class="string">&quot;value2&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>mget</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">//mg</span>et -- æ‰¹é‡è¯»å–</span><br><span class="line"><span class="regexp">//</span>å¯ä»¥å‡å°‘ç½‘ç»œè¿æ¥ï¼Œæé«˜æ€§èƒ½</span><br><span class="line">GET _mget</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;docs&quot;</span>: [</span><br><span class="line">    &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;users&quot;</span>, <span class="string">&quot;_id&quot;</span>:<span class="number">1</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;comment&quot;</span>, <span class="string">&quot;_id&quot;</span>:<span class="number">1</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Elasticsearch-åŸç†"><a href="#Elasticsearch-åŸç†" class="headerlink" title="Elasticsearch åŸç†"></a>Elasticsearch åŸç†</h2><ul>
<li>å›¾ä¹¦å’Œæœç´¢å¼•æ“ç±»æ¯”</li>
</ul>
<table>
<thead>
<tr>
<th align="left">Type</th>
<th align="left">æ­£æ’ç´¢å¼•</th>
<th align="left">å€’æ’ç´¢å¼•</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å›¾ä¹¦</td>
<td align="left">ç›®å½•é¡µ</td>
<td align="left">ç´¢å¼•é¡µ</td>
</tr>
<tr>
<td align="left">æœç´¢å¼•æ“</td>
<td align="left">æ–‡æ¡£ID-&gt;æ–‡æ¡£å†…å®¹å’Œå•è¯çš„å…³è”</td>
<td align="left">å•è¯åˆ°æ–‡æ¡£IDçš„å…³ç³»</td>
</tr>
</tbody></table>
<ul>
<li><p>Elasticsearch å€’æ’ç´¢å¼•</p>
<blockquote>
<p>Elasticsearchçš„JSONæ–‡æ¡£ä¸­æ¯ä¸ªå­—æ®µï¼Œéƒ½æœ‰è‡ªå·±çš„å€’æ’ç´¢å¼•</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># å•è¯è¯å…¸(Term Dictionary)</span></span><br><span class="line"><span class="quote">&gt; è®°å½•æ‰€æœ‰æ–‡æ¡£çš„å•è¯ï¼Œè®°å½•å•è¯åˆ°å€’æ’åˆ—è¡¨çš„å…³è”å…³ç³»</span></span><br><span class="line"><span class="quote">&gt; é€šè¿‡B+æ ‘æˆ–å“ˆå¸Œé“¾è¡¨å®ç°ï¼Œæ»¡è¶³é«˜æ€§èƒ½çš„æ’å…¥ä¸æŸ¥è¯¢</span></span><br><span class="line"></span><br><span class="line"><span class="section"># å€’æ’åˆ—è¡¨(Posting List)</span></span><br><span class="line"><span class="quote">&gt; è®°å½•å•è¯å¯¹åº”çš„æ–‡æ¡£ç»“åˆ</span></span><br><span class="line"><span class="bullet">  -</span> å€’æ’ç´¢å¼•é¡¹(Posting)</span><br><span class="line"><span class="bullet">    -</span> æ–‡æ¡£ID</span><br><span class="line"><span class="bullet">    -</span> è¯é¢‘TF - å•è¯åœ¨æ–‡æ¡£å‡ºç°çš„æ¬¡æ•°</span><br><span class="line"><span class="bullet">    -</span> ä½ç½®Position - å•è¯åœ¨æ–‡æ¡£ä¸­åˆ†è¯çš„ä½ç½®ï¼Œç”¨äºè¯­å¥æœç´¢ phrase query</span><br><span class="line"><span class="bullet">    -</span> åç§»Offset - è®°å½•å•è¯çš„å¼€å§‹ç»“æŸä½ç½®ï¼Œå®ç°é«˜é‡æ˜¾ç¤º</span><br></pre></td></tr></table></figure></li>
<li><p>Elasticsearch åˆ†è¯å™¨</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Analysis</span></span><br><span class="line">  - Analysis: æ–‡æœ¬åˆ†ææ˜¯æŠŠå…¨æ–‡æœ¬è½¬æ¢ä¸€ç³»åˆ—å•è¯ term/tokençš„è¿‡ç¨‹</span><br><span class="line">  - Analysisæ˜¯é€šè¿‡Analyzerå®ç°</span><br><span class="line"></span><br><span class="line"><span class="comment"># Analyzer:</span></span><br><span class="line">  - Character Filters: é’ˆå¯¹åŸå§‹æ–‡æœ¬å¤„ç†</span><br><span class="line">    - HTML strip - å»é™¤htmlæ ‡ç­¾</span><br><span class="line">    - Mapping - å­—ç¬¦ä¸²æ›¿æ¢</span><br><span class="line">    - Pattern repalce - æ­£åˆ™åŒ¹é…æ›¿æ¢</span><br><span class="line"></span><br><span class="line">  - Tokenizer: å°†åŸå§‹çš„æ–‡æœ¬æŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼Œåˆ‡åˆ†ä¸ºè¯ term or token</span><br><span class="line">    - whitespace</span><br><span class="line">    - standard</span><br><span class="line">    - uax_url_email</span><br><span class="line">    - pattern</span><br><span class="line">    - keyward</span><br><span class="line">    - path hierarchy</span><br><span class="line"></span><br><span class="line">  - Token Filter: å°†åˆ‡åˆ†çš„å•è¯è¿›è¡ŒåŠ å·¥ï¼Œå°å†™ï¼Œåˆ é™¤stopwords,å¢åŠ åŒä¹‰è¯</span><br><span class="line">    - Lowercase</span><br><span class="line">    - stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># Elasticsearchå†…ç½®åˆ†è¯å™¨</span></span><br><span class="line"><span class="regexp">//</span>é»˜è®¤åˆ†è¯å™¨ standard</span><br><span class="line"><span class="regexp">//</span> æŒ‰è¯åˆ‡åˆ†ï¼Œå°å†™å¤„ç†</span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;standard&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>Simple Analyzer</span><br><span class="line"><span class="regexp">//</span> æŒ‰ç…§éå­—æ¯åˆ‡åˆ†ï¼Œéå­—æ¯è¢«å»é™¤</span><br><span class="line"><span class="regexp">//</span> å°å†™å¤„ç†</span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;simple&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> Whitespace Analyzer</span><br><span class="line"><span class="regexp">//</span> æŒ‰ç…§ç©ºæ ¼åˆ‡åˆ†</span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;whitespace&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> Stop Analyzer</span><br><span class="line"><span class="regexp">//</span> stop filter: å»é™¤the, a, is ä¿®é¥°æ€§è¯</span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;stop&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>Keyward Analyzer</span><br><span class="line"><span class="regexp">//</span>ä¸åˆ†è¯ï¼Œç›´æ¥å°†è¾“å…¥å½“è¾“å‡º</span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œåˆ†è¯</span><br><span class="line"><span class="regexp">//</span>é»˜è®¤éå­—ç¬¦çš„ç¬¦å·è¿›è¡Œåˆ†éš”</span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;pattern&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>english</span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;english&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> analysis_icu</span><br><span class="line"><span class="regexp">//</span> elasticsearch-plugin install analysis_icu</span><br><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;icu_analyzer&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>:<span class="string">&quot;ä»–è¯´çš„ç¡®å®åœ¨ç†&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Search API</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># URI Search - é€šè¿‡URI queryå®ç°æœç´¢</span></span><br><span class="line">  q: æŒ‡å®šæŸ¥è¯¢è¯­å¥, ä½¿ç”¨Query String Syntax</span><br><span class="line">  df: é»˜è®¤å­—æ®µ, ä¸æŒ‡å®šä¼šå¯¹æ‰€æœ‰å­—æ®µè¿›è¡ŒæŸ¥è¯¢</span><br><span class="line">  Sort: æ’åº/from å’Œ size ç”¨äºåˆ†é¡µ</span><br><span class="line">  Profile: æŸ¥çœ‹æŸ¥è¯¢æ˜¯å¦‚ä½•è¢«æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">  <span class="number">1</span>. æŒ‡å®šå­—æ®µ vs. æ³›æŸ¥è¯¢</span><br><span class="line">  <span class="regexp">//</span>å¸¦profile æ™®é€šæŸ¥è¯¢</span><br><span class="line">  GET <span class="regexp">/movies/</span>_search?q=<span class="number">2012</span>&amp;df=title</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;profile&quot;</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="regexp">//</span>å¸¦profile æ³›æŸ¥è¯¢</span><br><span class="line">  GET <span class="regexp">/movies/</span>_search?q=<span class="number">2012</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;profile&quot;</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="regexp">//</span>å¸¦profile æŒ‡å®šå­—æ®µ</span><br><span class="line">  GET <span class="regexp">/movies/</span>_search?q=title:<span class="number">2012</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;profile&quot;</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">2</span>. Term vs. Phrase</span><br><span class="line">    <span class="comment"># Term: Beautiful Mind ç­‰æ•ˆäº Beautiful OR Mind</span></span><br><span class="line">    <span class="comment"># Phrase: &quot;Beautifuk Mind&quot; ç­‰æ•ˆäº Beautiful And Mind, å‰åé¡ºåºä¿æŒä¸€è‡´</span></span><br><span class="line">  <span class="regexp">//</span>ä½¿ç”¨å¼•å· æŸ¥è¯¢</span><br><span class="line">  GET <span class="regexp">/movies/</span>_search?q=title:<span class="string">&quot;Beautiful Mind&quot;</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;profile&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="regexp">//</span>ä½¿ç”¨å¼•å· Mind æ³› æŸ¥è¯¢</span><br><span class="line">  GET <span class="regexp">/movies/</span>_search?q=title:Beautiful Mind</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;profile&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="regexp">//</span>ä½¿ç”¨å¼•å· Bool æ³› æŸ¥è¯¢</span><br><span class="line">  GET <span class="regexp">/movies/</span>_search?q=title:(Beautiful Mind)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;profile&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">3</span>. å¸ƒå°”æ“ä½œ</span><br><span class="line">    AND <span class="regexp">/ OR /</span> NOT æˆ–è€… &amp;&amp; <span class="regexp">/ || /</span> !</span><br><span class="line">    title:(matrix NOT reloaded)</span><br><span class="line"></span><br><span class="line">  <span class="number">4</span>. åˆ†ç»„</span><br><span class="line">    + è¡¨ç¤º must</span><br><span class="line">    - è¡¨ç¤º must_not</span><br><span class="line">    title:(+matrix -reloaded)</span><br><span class="line"></span><br><span class="line">  <span class="number">5</span>. èŒƒå›´æŸ¥è¯¢</span><br><span class="line">    []é—­åŒºé—´ &#123;&#125;å¼€åŒºé—´</span><br><span class="line"></span><br><span class="line">  <span class="number">6</span>. ç®—æ•°ç¬¦å·</span><br><span class="line">    year:&gt;<span class="number">2010</span></span><br><span class="line"></span><br><span class="line">  <span class="number">7</span>. é€šé…ç¬¦æŸ¥è¯¢(é€šé…ç¬¦æŸ¥è¯¢æ•ˆç‡ä½ï¼Œå ç”¨å†…å­˜å¤§ï¼Œä¸å»ºè®®ä½¿ç”¨)</span><br><span class="line">    ? ä»£è¡¨<span class="number">1</span>ä¸ªå­—ç¬¦</span><br><span class="line">    * ä»£è¡¨<span class="number">0</span>æˆ–å¤šä¸ªå­—ç¬¦</span><br><span class="line"></span><br><span class="line">  <span class="number">8</span>. æ­£åˆ™è¡¨è¾¾å¼</span><br><span class="line">    title:[bt]oy</span><br><span class="line"></span><br><span class="line">  <span class="number">9</span>. æ¨¡ç³ŠåŒ¹é…ä¸è¿‘ä¼¼æŸ¥è¯¢</span><br><span class="line">    title:befutifl~<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Request Body Search</span></span><br><span class="line">  <span class="number">1</span>. åˆ†é¡µ:</span><br><span class="line">    from, size</span><br><span class="line"></span><br><span class="line">  <span class="number">2</span>. sort:</span><br><span class="line"></span><br><span class="line">  <span class="number">3</span>. _source filtering: å¦‚æœ_sourceæ²¡æœ‰å­˜å‚¨ï¼Œå°±åªè¿”å›åŒ¹é…çš„æ–‡æ¡£çš„å…ƒæ•°æ®</span><br><span class="line"></span><br><span class="line">  <span class="number">4</span>. è„šæœ¬å­—æ®µ:</span><br><span class="line"></span><br><span class="line">  <span class="number">5</span>. æŸ¥è¯¢è¡¨è¾¾å¼ - Match</span><br><span class="line"></span><br><span class="line">  <span class="number">6</span>. Match</span><br><span class="line"></span><br><span class="line"><span class="comment"># Page Rankç®—æ³•</span></span><br><span class="line">  <span class="number">1</span>. è¡¡é‡ç›¸å…³æ€§ Information Retrieval</span><br><span class="line">    a. Precision (æŸ¥å‡†ç‡) - å°½å¯èƒ½è¿”å›è¾ƒå°‘çš„æ— å…³æ–‡æ¡£</span><br><span class="line">    b. Recall(æŸ¥å…¨ç‡)     - å°½é‡è¿”å›è¾ƒå¤šçš„ç›¸å…³æ–‡æ¡£</span><br><span class="line">    c. Ranking            - æ˜¯å¦èƒ½å¤ŸæŒ‰ç…§ç›¸å…³åº¦è¿›è¡Œæ’åº</span><br></pre></td></tr></table></figure></li>
<li><p>Mapping</p>
<blockquote>
<p>ç±»ä¼¼æ•°æ®åº“ä¸­çš„scehmaå®šä¹‰</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> å®šä¹‰ç´¢å¼•ä¸­çš„å­—æ®µåç§°</span><br><span class="line"><span class="number">2.</span> å®šä¹‰å­—æ®µçš„æ•°æ®ç±»å‹</span><br><span class="line"><span class="keyword">Mapping</span> æŠŠ<span class="type">JSON</span>æ–‡æ¡£æ˜ å°„æˆLuceneæ‰€éœ€è¦çš„æ‰å¹³æ ¼å¼</span><br><span class="line">ä¸€ä¸ª<span class="keyword">Mapping</span>å±äºä¸€ä¸ªç´¢å¼•çš„<span class="keyword">type</span></span><br><span class="line"></span><br><span class="line"># å››ç§ä¸åŒçº§åˆ«çš„<span class="keyword">Index</span> <span class="keyword">Options</span> - æ§åˆ¶å€’æ’ç´¢å¼•è®°å½•çš„å†…å®¹</span><br><span class="line">  docs - è®°å½•doc id</span><br><span class="line">  freqs - è®°å½• doc id å’Œ term frequencies</span><br><span class="line">  positions - è®°å½• doc id/term frequencies/term position</span><br><span class="line">  offsets - è®°å½• doc id/term frequencies/term position/<span class="type">character</span> offsets</span><br></pre></td></tr></table></figure></li>
<li><p>æ•°æ®ç±»å‹<br>JSON -&gt; Elasticsearchç±»å‹</p>
<table>
<thead>
<tr>
<th align="left">JSONç±»å‹</th>
<th align="left">Elasticsearch ç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å­—ç¬¦ä¸²</td>
<td align="left">åŒ¹é…æ—¥æœŸæ ¼å¼ -&gt; Date</td>
</tr>
<tr>
<td align="left">å¸ƒå°”å€¼</td>
<td align="left">boolean</td>
</tr>
<tr>
<td align="left">æµ®ç‚¹æ•°</td>
<td align="left">float</td>
</tr>
<tr>
<td align="left">æ•´æ•°</td>
<td align="left">long</td>
</tr>
<tr>
<td align="left">å¯¹è±¡</td>
<td align="left">Object</td>
</tr>
<tr>
<td align="left">æ•°ç»„</td>
<td align="left">ç”±ç¬¬ä¸€ä¸ªéç©ºæ•°å€¼çš„ç±»å‹æ‰€å†³å®š</td>
</tr>
<tr>
<td align="left">ç©ºå€¼</td>
<td align="left">å¿½ç•¥</td>
</tr>
</tbody></table>
</li>
</ul>
  <figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># ç®€å•ç±»å‹:</span></span><br><span class="line"><span class="bullet">  1.</span> Text/Keyword</span><br><span class="line"><span class="bullet">  2.</span> Date</span><br><span class="line"><span class="bullet">  3.</span> Integer / Floating</span><br><span class="line"><span class="bullet">  4.</span> Boolean</span><br><span class="line"><span class="bullet">  5.</span> IPv4 &amp; IPv6</span><br><span class="line"></span><br><span class="line"><span class="section"># å¤æ‚ç±»å‹ - å¯¹è±¡å’ŒåµŒå¥—å¯¹è±¡</span></span><br><span class="line">  å¯¹è±¡ç±»å‹/åµŒå¥—ç±»å‹</span><br><span class="line"></span><br><span class="line"><span class="section"># ç‰¹æ®Šç±»å‹</span></span><br><span class="line">  geo<span class="emphasis">_point &amp; geo_</span>shape / percolator</span><br></pre></td></tr></table></figure>

<h2 id="Elasticsearch-èšåˆ-Aggregation"><a href="#Elasticsearch-èšåˆ-Aggregation" class="headerlink" title="Elasticsearch èšåˆ (Aggregation)"></a>Elasticsearch èšåˆ (Aggregation)</h2><blockquote>
<p>Elasticsearch é™¤äº†æœç´¢ä»¥å¤–è¿˜æä¾›é’ˆå¯¹ESæ•°æ®è¿›è¡Œç»Ÿè®¡åˆ†æ</p>
</blockquote>
<ul>
<li>é›†åˆåˆ†ç±»<figure class="highlight q"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> Bucket Aggregation: æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æ–‡æ¡£é›†åˆ</span><br><span class="line">  <span class="built_in">group</span> <span class="keyword">by</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> Metric Aggregation: æ•°å­¦è¿ç®—ï¼Œå¯¹æ–‡æ¡£å­—æ®µç»Ÿè®¡åˆ†æ</span><br><span class="line">  <span class="built_in">min</span>/<span class="built_in">max</span>/<span class="built_in">sum</span>/<span class="built_in">avg</span>/cardinality</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> Pipeline Aggregation: å¯¹èšåˆç»“æœè¿›è¡ŒäºŒæ¬¡èšåˆ</span><br><span class="line"><span class="number">4.</span> Matrix Aggregation: æ”¯æŒå¤šä¸ªå­—æ®µçš„æ“ä½œå¹¶æä¾›ç»“æœçŸ©é˜µ</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Elasticsearch-åˆ†å¸ƒå¼ç»“æ„"><a href="#Elasticsearch-åˆ†å¸ƒå¼ç»“æ„" class="headerlink" title="Elasticsearch åˆ†å¸ƒå¼ç»“æ„"></a>Elasticsearch åˆ†å¸ƒå¼ç»“æ„</h2><ul>
<li><p>é«˜å¯ç”¨</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> æœåŠ¡å¯ç”¨æ€§ - å…è®¸æœ‰èŠ‚ç‚¹åœæ­¢æœåŠ¡</span><br><span class="line"><span class="bullet">2.</span> æ•°æ®å¯ç”¨æ€§ - éƒ¨åˆ†èŠ‚ç‚¹ä¸¢å¤±ï¼Œä¸ä¼šä¸¢å¤±æ•°æ®</span><br></pre></td></tr></table></figure></li>
<li><p>å¯æ‰©å±•æ€§</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> è¯·æ±‚é‡æå‡/æ•°æ®ä¸æ–­å¢åŠ (å°†æ•°æ®åˆ†å¸ƒåˆ°æ‰€æœ‰èŠ‚ç‚¹ä¸Š)</span><br></pre></td></tr></table></figure></li>
<li><p>Elasticsearchåˆ†å¸ƒå¼æ¶æ„</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> ä¸åŒçš„é›†ç¾¤é€šè¿‡ä¸åŒçš„åå­—åŒºåˆ†ï¼Œ-E <span class="keyword">cluster</span>.name=geektime</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="ELK-å¤§æ•°æ®åˆ†æ"><a href="#ELK-å¤§æ•°æ®åˆ†æ" class="headerlink" title="ELK å¤§æ•°æ®åˆ†æ"></a>ELK å¤§æ•°æ®åˆ†æ</h2>]]></content>
      <tags>
        <tag>æœç´¢å¼•æ“</tag>
        <tag>ES</tag>
      </tags>
  </entry>
  <entry>
    <title>golang pkg Tips &amp; Tracks</title>
    <url>/2021/09/03/golang-pkg-Tips-Tracks/</url>
    <content><![CDATA[<h2 id="Golang"><a href="#Golang" class="headerlink" title="Golang"></a>Golang</h2><ul>
<li>Goals<blockquote>
<p>The efficientcy of a statically-typed compiled language with the ease of programming of a dynamic language.<br>Safety: type-safe and memory-safe<br>Good support for concurrency and communication.<br>Efficient, latency-free garbage collection.<br>High-speed compilation.</p>
</blockquote>
</li>
</ul>
<span id="more"></span>

<ul>
<li><p>Design principles</p>
<blockquote>
<p>Keep concept orthogonal(æ­£äº¤).<br>Keep the grammar regular and simple.<br>Reduce typing. Let the language work things out.<br>Reduce typing. Keep the type system clear.</p>
</blockquote>
</li>
<li><p>The Big Picture</p>
<blockquote>
<p>Fundamentals:</p>
</blockquote>
<ul>
<li>Clean, concise syntax.</li>
<li>Lightweight type system.</li>
<li>No implicit conversions: keep things explicit.</li>
<li>Untyped unsized constants:</li>
<li>Strict separation of interface and implementation.<blockquote>
<p>Run-time:</p>
</blockquote>
</li>
<li>Garbage collection.</li>
<li>Strings, maps, communication channels</li>
<li>Concurrency.<blockquote>
<p>Package model:<br>Explicit dependencies to enable faster builds.</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h2 id="Golang-Frequently-Asked-Questions-FAQ"><a href="#Golang-Frequently-Asked-Questions-FAQ" class="headerlink" title="Golang Frequently Asked Questions (FAQ)"></a>Golang Frequently Asked Questions (FAQ)</h2><ul>
<li><p>Map access is unsafe only when updates are occurring.</p>
</li>
<li><p>How can I gurantee my type satisfies an interface?</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> I <span class="keyword">interface</span> &#123;</span><br><span class="line">    Say(<span class="keyword">string</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> T <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *T)</span> <span class="title">Say</span><span class="params">(s <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    fmt.Println(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Ask the compiler to check that the type T implements the interface I by</span></span><br><span class="line"><span class="keyword">var</span> _ I = (*T)(<span class="literal">nil</span>) <span class="comment">// Verify that *T implements I.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    t := T&#123;&#125;</span><br><span class="line">    t.Say(<span class="string">&quot;Say Hello&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Should I define methods on values or pointers?</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">func (s *MyStruct) pointerMethod() &#123;&#125;   // <span class="keyword">method</span> <span class="keyword">on</span> pointer</span><br><span class="line">func (s MyStruct) valueMethod() &#123;&#125;      // <span class="keyword">method</span> <span class="keyword">on</span> <span class="keyword">value</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="keyword">When</span> defining a <span class="keyword">method</span> <span class="keyword">on</span> a <span class="keyword">type</span>, the receiver behaves exactly <span class="keyword">as</span> <span class="keyword">if</span> it were an argument <span class="keyword">to</span> the <span class="keyword">method</span>. Whether <span class="keyword">to</span> define the receiver <span class="keyword">as</span> a <span class="keyword">value</span> <span class="keyword">or</span> <span class="keyword">as</span> a pointer <span class="keyword">is</span> the same question, <span class="keyword">then</span>, <span class="keyword">as</span> whether a <span class="keyword">function</span> argument should be a <span class="keyword">value</span> <span class="keyword">or</span> poiner.</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> First, <span class="keyword">and</span> most important, does the <span class="keyword">method</span> need <span class="keyword">to</span> modify the receiver?</span><br><span class="line"><span class="number">2.</span> Second <span class="keyword">is</span> the consideration <span class="keyword">of</span> efficiency. <span class="keyword">If</span> the receiver <span class="keyword">is</span> <span class="keyword">large</span>, a big struct <span class="keyword">for</span> instance, it will be much cheaper <span class="keyword">to</span> use a pointer receiver.</span><br></pre></td></tr></table></figure></li>
<li><p>What operations are atomic? What about mutexes?</p>
<blockquote>
<p>Do not communicate by sharing memory. Instead, share memory by communicating.</p>
</blockquote>
</li>
<li><p>How can I control the number of CPUs?</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">The runtime can allocate more threads than the value of GOMAXPROCS to service multiple outstanding I/O requests. GOMAXPROCS only affects how many goroutines can actually<span class="built_in"> execute </span>at once; arbitrarily more may be blocked in<span class="keyword"> system</span> calls.</span><br></pre></td></tr></table></figure></li>
<li><p>Who do I write a unit test?</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> Create a <span class="keyword">new</span> file ending <span class="keyword">in</span> <span class="module-access"><span class="module"><span class="identifier">_test</span>.</span></span>go <span class="keyword">in</span> the same directory <span class="keyword">as</span> your package sources. Inside that file, import <span class="string">&quot;testing&quot;</span> <span class="keyword">and</span> write functions <span class="keyword">of</span> the form</span><br><span class="line"></span><br><span class="line">func <span class="constructor">TestFoo(<span class="params">t</span> <span class="operator">*</span><span class="params">testing</span>.T)</span> &#123;</span><br><span class="line">  â€¦</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>What compiler technology is used to build the compilers?</p>
<blockquote>
<p>The default compiler, gc, was originally written in C, but since the Go 1.5 release the compiler has been a Go program.</p>
</blockquote>
</li>
<li><p>Why do garbage collection? Wonâ€™t it be too expensive?</p>
<figure class="highlight mercury"><table><tr><td class="code"><pre><span class="line">The current <span class="keyword">implementation</span> <span class="keyword">is</span> a mark-and-sweep collector.</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Golang-Tips-amp-Tracks"><a href="#Golang-Tips-amp-Tracks" class="headerlink" title="Golang Tips &amp; Tracks"></a>Golang Tips &amp; Tracks</h2><ul>
<li><strong>è´Ÿè½½å‡è¡¡ç®—æ³•å¯¹æ¯”</strong><blockquote>
<p>è´Ÿè½½å‡è¡¡æœ€é‡è¦çš„å°±æ˜¯å‡è¡¡</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;math/rand&quot;</span></span><br><span class="line">  <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">  rand.Seed(time.Now().UnixNano())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">normal_shuffle</span><span class="params">(slice []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(slice); i++ &#123;</span><br><span class="line">    a := rand.Intn(<span class="built_in">len</span>(slice))</span><br><span class="line">    b := rand.Intn(<span class="built_in">len</span>(slice))</span><br><span class="line">    slice[a], slice[b] = slice[b], slice[a]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">shuffle</span><span class="params">(indexes []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="built_in">len</span>(indexes); i &gt; <span class="number">0</span>; i-- &#123;</span><br><span class="line">    lastIdx := i - <span class="number">1</span></span><br><span class="line">    idx := rand.Intn(i)</span><br><span class="line">    indexes[lastIdx], indexes[idx] = indexes[idx], indexes[lastIdx]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> cnt1 = <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">var</span> sl = []<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;</span><br><span class="line">    normal_shuffle(sl)</span><br><span class="line">    cnt1[sl[<span class="number">0</span>]]++</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> cnt2 = <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">var</span> sl = []<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;</span><br><span class="line">    shuffle(sl)</span><br><span class="line">    cnt2[sl[<span class="number">0</span>]]++</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fmt.Println(<span class="string">&quot;normal shuffle: &quot;</span>, cnt1)</span><br><span class="line">  fmt.Println(<span class="string">&quot;fisher yates  : &quot;</span>, cnt2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">chyi/<span class="keyword">go</span>-awesome-prj/shuffle via ğŸ¹ v1<span class="number">.17</span> took <span class="number">38</span>s</span><br><span class="line">âœ <span class="keyword">go</span> run main.<span class="keyword">go</span></span><br><span class="line">normal shuffle:  <span class="keyword">map</span>[<span class="number">0</span>:<span class="number">224558</span> <span class="number">1</span>:<span class="number">128887</span> <span class="number">2</span>:<span class="number">129201</span> <span class="number">3</span>:<span class="number">129493</span> <span class="number">4</span>:<span class="number">129487</span> <span class="number">5</span>:<span class="number">129202</span> <span class="number">6</span>:<span class="number">129172</span>]</span><br><span class="line">fisher yates  :  <span class="keyword">map</span>[<span class="number">0</span>:<span class="number">142974</span> <span class="number">1</span>:<span class="number">143116</span> <span class="number">2</span>:<span class="number">142768</span> <span class="number">3</span>:<span class="number">142660</span> <span class="number">4</span>:<span class="number">142930</span> <span class="number">5</span>:<span class="number">142505</span> <span class="number">6</span>:<span class="number">143047</span>]</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>Go</tag>
      </tags>
  </entry>
  <entry>
    <title>Middleware Tips &amp; Tracks</title>
    <url>/2021/09/06/Middleware-Tips-Tracks/</url>
    <content><![CDATA[<h2 id="æŠ€æœ¯é€‰å‹"><a href="#æŠ€æœ¯é€‰å‹" class="headerlink" title="æŠ€æœ¯é€‰å‹"></a>æŠ€æœ¯é€‰å‹</h2><blockquote>
<p>é¢å¯¹æŠ€æœ¯é€‰å‹æ—¶ï¼Œå°±æ˜¯ä¸€ä¸ªå…³äºå¦‚ä½•å–èˆçš„é—®é¢˜ï¼Œä¸è¦ä¸ç»è¿‡æ€è€ƒå°±è§‰å¾—é‚£ä¸ªæ–¹æ¡ˆå¥½ï¼Œé‚£ä¸ªæ–¹æ¡ˆä¸å¥½ã€‚éœ€è¦æ ¹æ®å…·ä½“åœºæ™¯åˆ†æ<br>æŠ€æœ¯é€‰å‹ä¸åªæ˜¯æŠ€æœ¯é—®é¢˜ï¼Œè¿˜ä¸å›¢é˜Ÿã€ç®¡ç†ã€ç»„ç»‡ç»“æ„æœ‰å…³</p>
</blockquote>
<ul>
<li>ä¸šåŠ¡åŠŸèƒ½è§’åº¦</li>
<li>æŠ€æœ¯èµ„æºè§’åº¦<blockquote>
<p>æ‰€å¤„çš„ç¯å¢ƒã€æŠ€æœ¯èµ„æºèƒ½å¦åŒ¹é…è¿™äº›æŠ€æœ¯æ–¹æ¡ˆ</p>
</blockquote>
</li>
</ul>
<span id="more"></span>

<h2 id="æ¶ˆæ¯ä¸­é—´ä»¶"><a href="#æ¶ˆæ¯ä¸­é—´ä»¶" class="headerlink" title="æ¶ˆæ¯ä¸­é—´ä»¶"></a>æ¶ˆæ¯ä¸­é—´ä»¶</h2><figure class="highlight haml"><table><tr><td class="code"><pre><span class="line"># ä¸“ä¸šæ¶ˆæ¯ä¸­é—´ä»¶éœ€è¦æ»¡è¶³:</span><br><span class="line">  1. æ¶ˆæ¯ä¸ä¸¢å¤±</span><br><span class="line">    a. ç”Ÿäº§è€…ä¼šä¸ä¼šä¸¢æ¶ˆæ¯?</span><br><span class="line">      -<span class="ruby"> æ¶ˆæ¯æ²¡å‘é€å‡ºå»: ç½‘ç»œæ•…éšœæˆ–è€…å…¶ä»–åŸå› å¯¼è‡´å‘å¸ƒå¤±è´¥ï¼Œä¸­é—´ä»¶ç›´æ¥è¿”å›å¤±è´¥</span></span><br><span class="line"><span class="ruby"></span>      -<span class="ruby"> ä¸ç¡®å®šæ˜¯å¦å‘é€æˆåŠŸ: ç½‘ç»œé—®é¢˜å¯¼è‡´å‘å¸ƒè¶…æ—¶ï¼Œå¯èƒ½æ•°æ®å·²å‘é€æˆåŠŸï¼Œä½†æ˜¯è¯»å–å“åº”ç»“æœè¶…æ—¶</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line">      ç”Ÿäº§è€…è®¾ç½®æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œè¶…è¿‡ä¸Šé™ä¾æ—§å¤±è´¥ï¼Œéœ€è¦è®°å½•æ—¥å¿—æŠ¥è­¦å¤„ç†, ç”Ÿäº§è€…ä¼šä¸ä¼šä¸¢æ¶ˆæ¯ï¼Œå–å†³äºç”Ÿäº§è€…å¯¹äºå¼‚å¸¸æƒ…å†µçš„å¤„ç†æ˜¯å¦åˆç†, ä¿è¯æ¶ˆæ¯ä¸ä¸¢ï¼Œå®å¯é‡å‘ï¼Œä¹Ÿä¸èƒ½ä¸¢å¼ƒ</span><br><span class="line">    b. æ¶ˆè´¹è€…ä¼šä¸ä¼šä¸¢æ¶ˆæ¯?</span><br><span class="line">      -<span class="ruby"> æ¶ˆè´¹è€…åœ¨å¤„ç†å®Œæ¶ˆæ¯åï¼Œå¿…é¡»å‘ŠçŸ¥é˜Ÿåˆ—ä¸­é—´ä»¶ï¼Œé˜Ÿåˆ—ä¸­é—´ä»¶æ‰ä¼šæŠŠæ ‡è®°å·²å¤„ç†ï¼Œå¦åˆ™ä»æ—§æŠŠè¿™äº›æ•°æ®å‘ç»™æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="ruby"></span>    c. é˜Ÿåˆ—ä¸­é—´ä»¶ä¼šä¸ä¼šä¸¢æ¶ˆæ¯?</span><br><span class="line">      -<span class="ruby"> ç”Ÿäº§è€…åœ¨å‘å¸ƒæ¶ˆæ¯æ—¶ï¼Œé˜Ÿåˆ—ä¸­é—´ä»¶é€šå¸¸ä¼šå†™å¤šä¸ªèŠ‚ç‚¹ï¼Œä»¥æ­¤ä¿è¯æ¶ˆæ¯çš„å®Œæ•´æ€§ï¼Œå³ä¾¿å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹æŒ‚ï¼Œä¹Ÿèƒ½ä¿è¯é›†ç¾¤æ•°æ®ä¸ä¸¢å¤±</span></span><br><span class="line"><span class="ruby"></span>  2. æ¶ˆæ¯å¯å †ç§¯</span><br></pre></td></tr></table></figure>
<ul>
<li>Redis ä½œä¸ºæ¶ˆæ¯ä¸­é—´ä»¶<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> Redisæœ¬èº«å¯èƒ½ä¼šä¸¢æ•°æ®</span><br><span class="line"><span class="bullet">2.</span> é¢å¯¹æ¶ˆæ¯ç§¯å‹ï¼ŒRediså†…å­˜èµ„æºç´§å¼ </span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>ä¸­é—´ä»¶</tag>
        <tag>Middleware</tag>
      </tags>
  </entry>
  <entry>
    <title>CS - Time</title>
    <url>/2021/09/06/CS-Time/</url>
    <content><![CDATA[<span id="more"></span>

<h2 id="Time-æ—¶é—´"><a href="#Time-æ—¶é—´" class="headerlink" title="Time æ—¶é—´"></a>Time æ—¶é—´</h2><ul>
<li><p>Universal Time: ä¸–ç•Œæ—¶</p>
<blockquote>
<p>ä¾é è§‚æµ‹å¤©æ–‡ç°è±¡æ¥æµ‹é‡æ—¶é—´ï¼ŒåŸºäºåœ°çƒè‡ªè½¬è§„å¾‹</p>
</blockquote>
</li>
<li><p>International Atomic Time: å›½é™…åŸå­æ—¶</p>
<blockquote>
<p>ä»¥å¾®è§‚æ—¶é—´é“¯åŸå­çš„éœ‡è¡é¢‘ç‡ä¸ºåŸºå‡†ï¼Œåˆ¶é€ åŸå­é’Ÿ</p>
</blockquote>
</li>
<li><p>Coordinated Universal Time: åè°ƒä¸–ç•Œæ—¶</p>
<blockquote>
<p>æ ¹æ®ä¸–é—´æ—¶å’ŒåŸå­æ—¶ï¼Œæœ€ç»ˆç¡®ç«‹æ–°çš„æ—¶é—´æ ‡å‡†ï¼Œå®šä¹‰æˆä¸ºå…¨çƒçš„æ—¶é—´æ ‡å‡†</p>
</blockquote>
</li>
<li><p>NTP Network Time Protocol åŒæ­¥æ—¶é—´</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>. NTPå¦‚ä½•åŒæ­¥æ—¶é—´</span><br><span class="line">  &gt; å‡è®¾ç½‘ç»œæ¥å›è·¯å¾„å¯¹ç§°ï¼Œå¹¶ä¸”å»¶è¿Ÿç›¸åŒ</span><br><span class="line">  ç½‘ç»œå»¶æ—¶ = (t4 - t1) - (t3 - t2)</span><br><span class="line">  æ—¶é—´å·® = t2 - t1 - ç½‘ç»œå»¶è¿Ÿ<span class="regexp">/2 = ((t2-t1) + (t3-t4))/</span><span class="number">2</span></span><br><span class="line"><span class="number">2</span>. åŒæ­¥æ—¶é—´æ—¶ï¼Œå¯¹æ­£åœ¨è¿è¡Œçš„ç¨‹åºæœ‰æ²¡æœ‰å½±å“</span><br><span class="line">  <span class="comment"># å¢™ä¸Šæ—¶é’Ÿ: ä¸–ç•Œåè°ƒæ—¶UTCï¼Œæ ¡å‡†æ—¶é—´åï¼Œå¯èƒ½å‘ç”Ÿå›æ‹¨</span></span><br><span class="line">  <span class="comment"># å•è°ƒæ—¶é’Ÿ: è®¡ç®—æœºè‡ªå¯åŠ¨ä»¥åçš„çº³ç§’æ•°ï¼Œä¸ä¼šå›æ‹¨</span></span><br><span class="line"></span><br><span class="line">NTPæ ¡å‡†æ—¶é—´æä¾›<span class="number">2</span>ä¸­æ–¹å¼:</span><br><span class="line">  <span class="number">1</span>. ntpdate: ä¸€åˆ‡å·²æœåŠ¡å™¨ç«¯æ—¶é—´ä¸ºå‡†ï¼Œå¼ºåˆ¶ä¿®æ”¹æœ¬æœºæ—¶é—´</span><br><span class="line">  <span class="number">2</span>. ntpd: æŠŠæ—¶é—´å·®å‡æ‘Šåˆ°æ¯æ¬¡å°çš„è°ƒæ•´ä¸Š -- é¿å…å‘ç”Ÿå€’æµ</span><br></pre></td></tr></table></figure></li>
</ul>
<p>  -</p>
]]></content>
      <tags>
        <tag>è®¡ç®—æœº</tag>
      </tags>
  </entry>
</search>
